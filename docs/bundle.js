(function() {
    function r(e, n, t) {
        function o(i, f) {
            if (!n[i]) {
                if (!e[i]) {
                    var c = "function" == typeof require && require;
                    if (!f && c) return c(i, !0);
                    if (u) return u(i, !0);
                    var a = new Error("Cannot find module '" + i + "'");
                    throw a.code = "MODULE_NOT_FOUND", a;
                }
                var p = n[i] = {
                    exports: {}
                };
                e[i][0].call(p.exports, function(r) {
                    var n = e[i][1][r];
                    return o(n || r);
                }, p, p.exports, r, e, n, t);
            }
            return n[i].exports;
        }
        for (var u = "function" == typeof require && require, i = 0; i < t.length; i++) o(t[i]);
        return o;
    }
    return r;
})()({
    1: [ function(require, module, exports) {
        var InstiMap = require("instimapweb");
        var autocomplete = require("autocomplete.js");
        var Fuse = require("fuse.js");
        var Hammer = require("hammerjs");
        var locations = [];
        var fuse;
        var fuse_options = {
            shouldSort: true,
            threshold: .3,
            tokenize: true,
            location: 0,
            distance: 7,
            maxPatternLength: 10,
            minMatchCharLength: 1,
            keys: [ "name", "short_name" ]
        };
        function locSearch(query, cb) {
            cb(fuse.search(query).slice(0, 10));
        }
        autocomplete("#search", {
            hint: true
        }, [ {
            source: locSearch,
            displayKey: "short_name",
            templates: {
                suggestion: function(suggestion) {
                    return suggestion.short_name;
                }
            }
        } ]).on("autocomplete:selected", function(event, suggestion, dataset, context) {
            InstiMap.moveToLocation(suggestion);
            locationSelected(suggestion);
        });
        function locationSelected(loc) {
            if (loc == undefined) {
                document.getElementById("infobox").style.opacity = 0;
                document.getElementById("locfab").classList.remove("translate");
                setTimeout(function() {
                    document.getElementById("infobox").style.display = "none";
                    document.getElementById("locname").innerText = "";
                    document.getElementById("locdesc").innerText = "";
                }, 300);
            } else {
                document.getElementById("infobox").style.display = "block";
                document.getElementById("locfab").classList.add("translate");
                setTimeout(function() {
                    document.getElementById("infobox").style.opacity = 1;
                }, 100);
                document.getElementById("locname").innerText = loc.name;
                document.getElementById("locdesc").innerText = loc.description;
            }
        }
        fetch("https://api.insti.app/api/locations").then(function(response) {
            return response.json();
        }).then(function(jsonResponse) {
            locations = jsonResponse;
            fuse = new Fuse(locations, fuse_options);
            InstiMap.getMap({
                mapPath: "assets/map.jpg",
                mapMinPath: "assets/map-min.jpg",
                markersBase: "assets/map/",
                attributions: '<a href="http://mrane.com/" target="_blank">Prof. Mandar Rane</a>',
                map_id: "map",
                marker_id: "marker",
                user_marker_id: "user-marker"
            }, locations, function(location) {
                locationSelected(location);
            }, function() {
                console.log("map loaded");
            });
        });
        var squares = document.querySelector("#infobox, #infobox *");
        var square = document.querySelector("#infobox");
        var manager = new Hammer.Manager(squares);
        var Swipe = new Hammer.Swipe();
        manager.add(Swipe);
        manager.on("swipe", function(e) {
            var direction = e.offsetDirection;
            if (direction === 8) {
                square.classList.add("expanded");
            } else if (direction == 16) {
                square.classList.remove("expanded");
            }
        });
        document.getElementById("locfab").addEventListener("click", function() {
            InstiMap.getGPS();
        });
    }, {
        "autocomplete.js": 2,
        "fuse.js": 20,
        hammerjs: 21,
        instimapweb: 28
    } ],
    2: [ function(require, module, exports) {
        "use strict";
        module.exports = require("./src/standalone/");
    }, {
        "./src/standalone/": 17
    } ],
    3: [ function(require, module, exports) {
        "use strict";
        var _ = require("../common/utils.js");
        var css = {
            wrapper: {
                position: "relative",
                display: "inline-block"
            },
            hint: {
                position: "absolute",
                top: "0",
                left: "0",
                borderColor: "transparent",
                boxShadow: "none",
                opacity: "1"
            },
            input: {
                position: "relative",
                verticalAlign: "top",
                backgroundColor: "transparent"
            },
            inputWithNoHint: {
                position: "relative",
                verticalAlign: "top"
            },
            dropdown: {
                position: "absolute",
                top: "100%",
                left: "0",
                zIndex: "100",
                display: "none"
            },
            suggestions: {
                display: "block"
            },
            suggestion: {
                whiteSpace: "nowrap",
                cursor: "pointer"
            },
            suggestionChild: {
                whiteSpace: "normal"
            },
            ltr: {
                left: "0",
                right: "auto"
            },
            rtl: {
                left: "auto",
                right: "0"
            },
            defaultClasses: {
                root: "algolia-autocomplete",
                prefix: "aa",
                noPrefix: false,
                dropdownMenu: "dropdown-menu",
                input: "input",
                hint: "hint",
                suggestions: "suggestions",
                suggestion: "suggestion",
                cursor: "cursor",
                dataset: "dataset",
                empty: "empty"
            },
            appendTo: {
                wrapper: {
                    position: "absolute",
                    zIndex: "100",
                    display: "none"
                },
                input: {},
                inputWithNoHint: {},
                dropdown: {
                    display: "block"
                }
            }
        };
        if (_.isMsie()) {
            _.mixin(css.input, {
                backgroundImage: "url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"
            });
        }
        if (_.isMsie() && _.isMsie() <= 7) {
            _.mixin(css.input, {
                marginTop: "-1px"
            });
        }
        module.exports = css;
    }, {
        "../common/utils.js": 13
    } ],
    4: [ function(require, module, exports) {
        "use strict";
        var datasetKey = "aaDataset";
        var valueKey = "aaValue";
        var datumKey = "aaDatum";
        var _ = require("../common/utils.js");
        var DOM = require("../common/dom.js");
        var html = require("./html.js");
        var css = require("./css.js");
        var EventEmitter = require("./event_emitter.js");
        function Dataset(o) {
            o = o || {};
            o.templates = o.templates || {};
            if (!o.source) {
                _.error("missing source");
            }
            if (o.name && !isValidName(o.name)) {
                _.error("invalid dataset name: " + o.name);
            }
            this.query = null;
            this._isEmpty = true;
            this.highlight = !!o.highlight;
            this.name = typeof o.name === "undefined" || o.name === null ? _.getUniqueId() : o.name;
            this.source = o.source;
            this.displayFn = getDisplayFn(o.display || o.displayKey);
            this.debounce = o.debounce;
            this.cache = o.cache !== false;
            this.templates = getTemplates(o.templates, this.displayFn);
            this.css = _.mixin({}, css, o.appendTo ? css.appendTo : {});
            this.cssClasses = o.cssClasses = _.mixin({}, css.defaultClasses, o.cssClasses || {});
            this.cssClasses.prefix = o.cssClasses.formattedPrefix || _.formatPrefix(this.cssClasses.prefix, this.cssClasses.noPrefix);
            var clazz = _.className(this.cssClasses.prefix, this.cssClasses.dataset);
            this.$el = o.$menu && o.$menu.find(clazz + "-" + this.name).length > 0 ? DOM.element(o.$menu.find(clazz + "-" + this.name)[0]) : DOM.element(html.dataset.replace("%CLASS%", this.name).replace("%PREFIX%", this.cssClasses.prefix).replace("%DATASET%", this.cssClasses.dataset));
            this.$menu = o.$menu;
            this.clearCachedSuggestions();
        }
        Dataset.extractDatasetName = function extractDatasetName(el) {
            return DOM.element(el).data(datasetKey);
        };
        Dataset.extractValue = function extractValue(el) {
            return DOM.element(el).data(valueKey);
        };
        Dataset.extractDatum = function extractDatum(el) {
            var datum = DOM.element(el).data(datumKey);
            if (typeof datum === "string") {
                datum = JSON.parse(datum);
            }
            return datum;
        };
        _.mixin(Dataset.prototype, EventEmitter, {
            _render: function render(query, suggestions) {
                if (!this.$el) {
                    return;
                }
                var that = this;
                var hasSuggestions;
                var renderArgs = [].slice.call(arguments, 2);
                this.$el.empty();
                hasSuggestions = suggestions && suggestions.length;
                this._isEmpty = !hasSuggestions;
                if (!hasSuggestions && this.templates.empty) {
                    this.$el.html(getEmptyHtml.apply(this, renderArgs)).prepend(that.templates.header ? getHeaderHtml.apply(this, renderArgs) : null).append(that.templates.footer ? getFooterHtml.apply(this, renderArgs) : null);
                } else if (hasSuggestions) {
                    this.$el.html(getSuggestionsHtml.apply(this, renderArgs)).prepend(that.templates.header ? getHeaderHtml.apply(this, renderArgs) : null).append(that.templates.footer ? getFooterHtml.apply(this, renderArgs) : null);
                } else if (suggestions && !Array.isArray(suggestions)) {
                    throw new TypeError("suggestions must be an array");
                }
                if (this.$menu) {
                    this.$menu.addClass(this.cssClasses.prefix + (hasSuggestions ? "with" : "without") + "-" + this.name).removeClass(this.cssClasses.prefix + (hasSuggestions ? "without" : "with") + "-" + this.name);
                }
                this.trigger("rendered", query);
                function getEmptyHtml() {
                    var args = [].slice.call(arguments, 0);
                    args = [ {
                        query: query,
                        isEmpty: true
                    } ].concat(args);
                    return that.templates.empty.apply(this, args);
                }
                function getSuggestionsHtml() {
                    var args = [].slice.call(arguments, 0);
                    var $suggestions;
                    var nodes;
                    var self = this;
                    var suggestionsHtml = html.suggestions.replace("%PREFIX%", this.cssClasses.prefix).replace("%SUGGESTIONS%", this.cssClasses.suggestions);
                    $suggestions = DOM.element(suggestionsHtml).css(this.css.suggestions);
                    nodes = _.map(suggestions, getSuggestionNode);
                    $suggestions.append.apply($suggestions, nodes);
                    return $suggestions;
                    function getSuggestionNode(suggestion) {
                        var $el;
                        var suggestionHtml = html.suggestion.replace("%PREFIX%", self.cssClasses.prefix).replace("%SUGGESTION%", self.cssClasses.suggestion);
                        $el = DOM.element(suggestionHtml).attr({
                            role: "option",
                            id: [ "option", Math.floor(Math.random() * 1e8) ].join("-")
                        }).append(that.templates.suggestion.apply(this, [ suggestion ].concat(args)));
                        $el.data(datasetKey, that.name);
                        $el.data(valueKey, that.displayFn(suggestion) || undefined);
                        $el.data(datumKey, JSON.stringify(suggestion));
                        $el.children().each(function() {
                            DOM.element(this).css(self.css.suggestionChild);
                        });
                        return $el;
                    }
                }
                function getHeaderHtml() {
                    var args = [].slice.call(arguments, 0);
                    args = [ {
                        query: query,
                        isEmpty: !hasSuggestions
                    } ].concat(args);
                    return that.templates.header.apply(this, args);
                }
                function getFooterHtml() {
                    var args = [].slice.call(arguments, 0);
                    args = [ {
                        query: query,
                        isEmpty: !hasSuggestions
                    } ].concat(args);
                    return that.templates.footer.apply(this, args);
                }
            },
            getRoot: function getRoot() {
                return this.$el;
            },
            update: function update(query) {
                function handleSuggestions(suggestions) {
                    if (!this.canceled && query === this.query) {
                        var extraArgs = [].slice.call(arguments, 1);
                        this.cacheSuggestions(query, suggestions, extraArgs);
                        this._render.apply(this, [ query, suggestions ].concat(extraArgs));
                    }
                }
                this.query = query;
                this.canceled = false;
                if (this.shouldFetchFromCache(query)) {
                    handleSuggestions.apply(this, [ this.cachedSuggestions ].concat(this.cachedRenderExtraArgs));
                } else {
                    var that = this;
                    var execSource = function() {
                        if (!that.canceled) {
                            that.source(query, handleSuggestions.bind(that));
                        }
                    };
                    if (this.debounce) {
                        var later = function() {
                            that.debounceTimeout = null;
                            execSource();
                        };
                        clearTimeout(this.debounceTimeout);
                        this.debounceTimeout = setTimeout(later, this.debounce);
                    } else {
                        execSource();
                    }
                }
            },
            cacheSuggestions: function cacheSuggestions(query, suggestions, extraArgs) {
                this.cachedQuery = query;
                this.cachedSuggestions = suggestions;
                this.cachedRenderExtraArgs = extraArgs;
            },
            shouldFetchFromCache: function shouldFetchFromCache(query) {
                return this.cache && this.cachedQuery === query && this.cachedSuggestions && this.cachedSuggestions.length;
            },
            clearCachedSuggestions: function clearCachedSuggestions() {
                delete this.cachedQuery;
                delete this.cachedSuggestions;
                delete this.cachedRenderExtraArgs;
            },
            cancel: function cancel() {
                this.canceled = true;
            },
            clear: function clear() {
                this.cancel();
                this.$el.empty();
                this.trigger("rendered", "");
            },
            isEmpty: function isEmpty() {
                return this._isEmpty;
            },
            destroy: function destroy() {
                this.clearCachedSuggestions();
                this.$el = null;
            }
        });
        function getDisplayFn(display) {
            display = display || "value";
            return _.isFunction(display) ? display : displayFn;
            function displayFn(obj) {
                return obj[display];
            }
        }
        function getTemplates(templates, displayFn) {
            return {
                empty: templates.empty && _.templatify(templates.empty),
                header: templates.header && _.templatify(templates.header),
                footer: templates.footer && _.templatify(templates.footer),
                suggestion: templates.suggestion || suggestionTemplate
            };
            function suggestionTemplate(context) {
                return "<p>" + displayFn(context) + "</p>";
            }
        }
        function isValidName(str) {
            return /^[_a-zA-Z0-9-]+$/.test(str);
        }
        module.exports = Dataset;
    }, {
        "../common/dom.js": 11,
        "../common/utils.js": 13,
        "./css.js": 3,
        "./event_emitter.js": 7,
        "./html.js": 8
    } ],
    5: [ function(require, module, exports) {
        "use strict";
        var _ = require("../common/utils.js");
        var DOM = require("../common/dom.js");
        var EventEmitter = require("./event_emitter.js");
        var Dataset = require("./dataset.js");
        var css = require("./css.js");
        function Dropdown(o) {
            var that = this;
            var onSuggestionClick;
            var onSuggestionMouseEnter;
            var onSuggestionMouseLeave;
            o = o || {};
            if (!o.menu) {
                _.error("menu is required");
            }
            if (!_.isArray(o.datasets) && !_.isObject(o.datasets)) {
                _.error("1 or more datasets required");
            }
            if (!o.datasets) {
                _.error("datasets is required");
            }
            this.isOpen = false;
            this.isEmpty = true;
            this.minLength = o.minLength || 0;
            this.templates = {};
            this.appendTo = o.appendTo || false;
            this.css = _.mixin({}, css, o.appendTo ? css.appendTo : {});
            this.cssClasses = o.cssClasses = _.mixin({}, css.defaultClasses, o.cssClasses || {});
            this.cssClasses.prefix = o.cssClasses.formattedPrefix || _.formatPrefix(this.cssClasses.prefix, this.cssClasses.noPrefix);
            onSuggestionClick = _.bind(this._onSuggestionClick, this);
            onSuggestionMouseEnter = _.bind(this._onSuggestionMouseEnter, this);
            onSuggestionMouseLeave = _.bind(this._onSuggestionMouseLeave, this);
            var cssClass = _.className(this.cssClasses.prefix, this.cssClasses.suggestion);
            this.$menu = DOM.element(o.menu).on("mouseenter.aa", cssClass, onSuggestionMouseEnter).on("mouseleave.aa", cssClass, onSuggestionMouseLeave).on("click.aa", cssClass, onSuggestionClick);
            this.$container = o.appendTo ? o.wrapper : this.$menu;
            if (o.templates && o.templates.header) {
                this.templates.header = _.templatify(o.templates.header);
                this.$menu.prepend(this.templates.header());
            }
            if (o.templates && o.templates.empty) {
                this.templates.empty = _.templatify(o.templates.empty);
                this.$empty = DOM.element('<div class="' + _.className(this.cssClasses.prefix, this.cssClasses.empty, true) + '">' + "</div>");
                this.$menu.append(this.$empty);
                this.$empty.hide();
            }
            this.datasets = _.map(o.datasets, function(oDataset) {
                return initializeDataset(that.$menu, oDataset, o.cssClasses);
            });
            _.each(this.datasets, function(dataset) {
                var root = dataset.getRoot();
                if (root && root.parent().length === 0) {
                    that.$menu.append(root);
                }
                dataset.onSync("rendered", that._onRendered, that);
            });
            if (o.templates && o.templates.footer) {
                this.templates.footer = _.templatify(o.templates.footer);
                this.$menu.append(this.templates.footer());
            }
            var self = this;
            DOM.element(window).resize(function() {
                self._redraw();
            });
        }
        _.mixin(Dropdown.prototype, EventEmitter, {
            _onSuggestionClick: function onSuggestionClick($e) {
                this.trigger("suggestionClicked", DOM.element($e.currentTarget));
            },
            _onSuggestionMouseEnter: function onSuggestionMouseEnter($e) {
                var elt = DOM.element($e.currentTarget);
                if (elt.hasClass(_.className(this.cssClasses.prefix, this.cssClasses.cursor, true))) {
                    return;
                }
                this._removeCursor();
                var suggestion = this;
                setTimeout(function() {
                    suggestion._setCursor(elt, false);
                }, 0);
            },
            _onSuggestionMouseLeave: function onSuggestionMouseLeave($e) {
                if ($e.relatedTarget) {
                    var elt = DOM.element($e.relatedTarget);
                    if (elt.closest("." + _.className(this.cssClasses.prefix, this.cssClasses.cursor, true)).length > 0) {
                        return;
                    }
                }
                this._removeCursor();
                this.trigger("cursorRemoved");
            },
            _onRendered: function onRendered(e, query) {
                this.isEmpty = _.every(this.datasets, isDatasetEmpty);
                if (this.isEmpty) {
                    if (query.length >= this.minLength) {
                        this.trigger("empty");
                    }
                    if (this.$empty) {
                        if (query.length < this.minLength) {
                            this._hide();
                        } else {
                            var html = this.templates.empty({
                                query: this.datasets[0] && this.datasets[0].query
                            });
                            this.$empty.html(html);
                            this.$empty.show();
                            this._show();
                        }
                    } else if (_.any(this.datasets, hasEmptyTemplate)) {
                        if (query.length < this.minLength) {
                            this._hide();
                        } else {
                            this._show();
                        }
                    } else {
                        this._hide();
                    }
                } else if (this.isOpen) {
                    if (this.$empty) {
                        this.$empty.empty();
                        this.$empty.hide();
                    }
                    if (query.length >= this.minLength) {
                        this._show();
                    } else {
                        this._hide();
                    }
                }
                this.trigger("datasetRendered");
                function isDatasetEmpty(dataset) {
                    return dataset.isEmpty();
                }
                function hasEmptyTemplate(dataset) {
                    return dataset.templates && dataset.templates.empty;
                }
            },
            _hide: function() {
                this.$container.hide();
            },
            _show: function() {
                this.$container.css("display", "block");
                this._redraw();
                this.trigger("shown");
            },
            _redraw: function redraw() {
                if (!this.isOpen || !this.appendTo) return;
                this.trigger("redrawn");
            },
            _getSuggestions: function getSuggestions() {
                return this.$menu.find(_.className(this.cssClasses.prefix, this.cssClasses.suggestion));
            },
            _getCursor: function getCursor() {
                return this.$menu.find(_.className(this.cssClasses.prefix, this.cssClasses.cursor)).first();
            },
            _setCursor: function setCursor($el, updateInput) {
                $el.first().addClass(_.className(this.cssClasses.prefix, this.cssClasses.cursor, true)).attr("aria-selected", "true");
                this.trigger("cursorMoved", updateInput);
            },
            _removeCursor: function removeCursor() {
                this._getCursor().removeClass(_.className(this.cssClasses.prefix, this.cssClasses.cursor, true)).removeAttr("aria-selected");
            },
            _moveCursor: function moveCursor(increment) {
                var $suggestions;
                var $oldCursor;
                var newCursorIndex;
                var $newCursor;
                if (!this.isOpen) {
                    return;
                }
                $oldCursor = this._getCursor();
                $suggestions = this._getSuggestions();
                this._removeCursor();
                newCursorIndex = $suggestions.index($oldCursor) + increment;
                newCursorIndex = (newCursorIndex + 1) % ($suggestions.length + 1) - 1;
                if (newCursorIndex === -1) {
                    this.trigger("cursorRemoved");
                    return;
                } else if (newCursorIndex < -1) {
                    newCursorIndex = $suggestions.length - 1;
                }
                this._setCursor($newCursor = $suggestions.eq(newCursorIndex), true);
                this._ensureVisible($newCursor);
            },
            _ensureVisible: function ensureVisible($el) {
                var elTop;
                var elBottom;
                var menuScrollTop;
                var menuHeight;
                elTop = $el.position().top;
                elBottom = elTop + $el.height() + parseInt($el.css("margin-top"), 10) + parseInt($el.css("margin-bottom"), 10);
                menuScrollTop = this.$menu.scrollTop();
                menuHeight = this.$menu.height() + parseInt(this.$menu.css("padding-top"), 10) + parseInt(this.$menu.css("padding-bottom"), 10);
                if (elTop < 0) {
                    this.$menu.scrollTop(menuScrollTop + elTop);
                } else if (menuHeight < elBottom) {
                    this.$menu.scrollTop(menuScrollTop + (elBottom - menuHeight));
                }
            },
            close: function close() {
                if (this.isOpen) {
                    this.isOpen = false;
                    this._removeCursor();
                    this._hide();
                    this.trigger("closed");
                }
            },
            open: function open() {
                if (!this.isOpen) {
                    this.isOpen = true;
                    if (!this.isEmpty) {
                        this._show();
                    }
                    this.trigger("opened");
                }
            },
            setLanguageDirection: function setLanguageDirection(dir) {
                this.$menu.css(dir === "ltr" ? this.css.ltr : this.css.rtl);
            },
            moveCursorUp: function moveCursorUp() {
                this._moveCursor(-1);
            },
            moveCursorDown: function moveCursorDown() {
                this._moveCursor(+1);
            },
            getDatumForSuggestion: function getDatumForSuggestion($el) {
                var datum = null;
                if ($el.length) {
                    datum = {
                        raw: Dataset.extractDatum($el),
                        value: Dataset.extractValue($el),
                        datasetName: Dataset.extractDatasetName($el)
                    };
                }
                return datum;
            },
            getCurrentCursor: function getCurrentCursor() {
                return this._getCursor().first();
            },
            getDatumForCursor: function getDatumForCursor() {
                return this.getDatumForSuggestion(this._getCursor().first());
            },
            getDatumForTopSuggestion: function getDatumForTopSuggestion() {
                return this.getDatumForSuggestion(this._getSuggestions().first());
            },
            cursorTopSuggestion: function cursorTopSuggestion() {
                this._setCursor(this._getSuggestions().first(), false);
            },
            update: function update(query) {
                _.each(this.datasets, updateDataset);
                function updateDataset(dataset) {
                    dataset.update(query);
                }
            },
            empty: function empty() {
                _.each(this.datasets, clearDataset);
                this.isEmpty = true;
                function clearDataset(dataset) {
                    dataset.clear();
                }
            },
            isVisible: function isVisible() {
                return this.isOpen && !this.isEmpty;
            },
            destroy: function destroy() {
                this.$menu.off(".aa");
                this.$menu = null;
                _.each(this.datasets, destroyDataset);
                function destroyDataset(dataset) {
                    dataset.destroy();
                }
            }
        });
        Dropdown.Dataset = Dataset;
        function initializeDataset($menu, oDataset, cssClasses) {
            return new Dropdown.Dataset(_.mixin({
                $menu: $menu,
                cssClasses: cssClasses
            }, oDataset));
        }
        module.exports = Dropdown;
    }, {
        "../common/dom.js": 11,
        "../common/utils.js": 13,
        "./css.js": 3,
        "./dataset.js": 4,
        "./event_emitter.js": 7
    } ],
    6: [ function(require, module, exports) {
        "use strict";
        var namespace = "autocomplete:";
        var _ = require("../common/utils.js");
        var DOM = require("../common/dom.js");
        function EventBus(o) {
            if (!o || !o.el) {
                _.error("EventBus initialized without el");
            }
            this.$el = DOM.element(o.el);
        }
        _.mixin(EventBus.prototype, {
            trigger: function(type, suggestion, dataset, context) {
                var event = _.Event(namespace + type);
                this.$el.trigger(event, [ suggestion, dataset, context ]);
                return event;
            }
        });
        module.exports = EventBus;
    }, {
        "../common/dom.js": 11,
        "../common/utils.js": 13
    } ],
    7: [ function(require, module, exports) {
        "use strict";
        var immediate = require("immediate");
        var splitter = /\s+/;
        module.exports = {
            onSync: onSync,
            onAsync: onAsync,
            off: off,
            trigger: trigger
        };
        function on(method, types, cb, context) {
            var type;
            if (!cb) {
                return this;
            }
            types = types.split(splitter);
            cb = context ? bindContext(cb, context) : cb;
            this._callbacks = this._callbacks || {};
            while (type = types.shift()) {
                this._callbacks[type] = this._callbacks[type] || {
                    sync: [],
                    async: []
                };
                this._callbacks[type][method].push(cb);
            }
            return this;
        }
        function onAsync(types, cb, context) {
            return on.call(this, "async", types, cb, context);
        }
        function onSync(types, cb, context) {
            return on.call(this, "sync", types, cb, context);
        }
        function off(types) {
            var type;
            if (!this._callbacks) {
                return this;
            }
            types = types.split(splitter);
            while (type = types.shift()) {
                delete this._callbacks[type];
            }
            return this;
        }
        function trigger(types) {
            var type;
            var callbacks;
            var args;
            var syncFlush;
            var asyncFlush;
            if (!this._callbacks) {
                return this;
            }
            types = types.split(splitter);
            args = [].slice.call(arguments, 1);
            while ((type = types.shift()) && (callbacks = this._callbacks[type])) {
                syncFlush = getFlush(callbacks.sync, this, [ type ].concat(args));
                asyncFlush = getFlush(callbacks.async, this, [ type ].concat(args));
                if (syncFlush()) {
                    immediate(asyncFlush);
                }
            }
            return this;
        }
        function getFlush(callbacks, context, args) {
            return flush;
            function flush() {
                var cancelled;
                for (var i = 0, len = callbacks.length; !cancelled && i < len; i += 1) {
                    cancelled = callbacks[i].apply(context, args) === false;
                }
                return !cancelled;
            }
        }
        function bindContext(fn, context) {
            return fn.bind ? fn.bind(context) : function() {
                fn.apply(context, [].slice.call(arguments, 0));
            };
        }
    }, {
        immediate: 22
    } ],
    8: [ function(require, module, exports) {
        "use strict";
        module.exports = {
            wrapper: '<span class="%ROOT%"></span>',
            dropdown: '<span class="%PREFIX%%DROPDOWN_MENU%"></span>',
            dataset: '<div class="%PREFIX%%DATASET%-%CLASS%"></div>',
            suggestions: '<span class="%PREFIX%%SUGGESTIONS%"></span>',
            suggestion: '<div class="%PREFIX%%SUGGESTION%"></div>'
        };
    }, {} ],
    9: [ function(require, module, exports) {
        "use strict";
        var specialKeyCodeMap;
        specialKeyCodeMap = {
            9: "tab",
            27: "esc",
            37: "left",
            39: "right",
            13: "enter",
            38: "up",
            40: "down"
        };
        var _ = require("../common/utils.js");
        var DOM = require("../common/dom.js");
        var EventEmitter = require("./event_emitter.js");
        function Input(o) {
            var that = this;
            var onBlur;
            var onFocus;
            var onKeydown;
            var onInput;
            o = o || {};
            if (!o.input) {
                _.error("input is missing");
            }
            onBlur = _.bind(this._onBlur, this);
            onFocus = _.bind(this._onFocus, this);
            onKeydown = _.bind(this._onKeydown, this);
            onInput = _.bind(this._onInput, this);
            this.$hint = DOM.element(o.hint);
            this.$input = DOM.element(o.input).on("blur.aa", onBlur).on("focus.aa", onFocus).on("keydown.aa", onKeydown);
            if (this.$hint.length === 0) {
                this.setHint = this.getHint = this.clearHint = this.clearHintIfInvalid = _.noop;
            }
            if (!_.isMsie()) {
                this.$input.on("input.aa", onInput);
            } else {
                this.$input.on("keydown.aa keypress.aa cut.aa paste.aa", function($e) {
                    if (specialKeyCodeMap[$e.which || $e.keyCode]) {
                        return;
                    }
                    _.defer(_.bind(that._onInput, that, $e));
                });
            }
            this.query = this.$input.val();
            this.$overflowHelper = buildOverflowHelper(this.$input);
        }
        Input.normalizeQuery = function(str) {
            return (str || "").replace(/^\s*/g, "").replace(/\s{2,}/g, " ");
        };
        _.mixin(Input.prototype, EventEmitter, {
            _onBlur: function onBlur() {
                this.resetInputValue();
                this.$input.removeAttr("aria-activedescendant");
                this.trigger("blurred");
            },
            _onFocus: function onFocus() {
                this.trigger("focused");
            },
            _onKeydown: function onKeydown($e) {
                var keyName = specialKeyCodeMap[$e.which || $e.keyCode];
                this._managePreventDefault(keyName, $e);
                if (keyName && this._shouldTrigger(keyName, $e)) {
                    this.trigger(keyName + "Keyed", $e);
                }
            },
            _onInput: function onInput() {
                this._checkInputValue();
            },
            _managePreventDefault: function managePreventDefault(keyName, $e) {
                var preventDefault;
                var hintValue;
                var inputValue;
                switch (keyName) {
                  case "tab":
                    hintValue = this.getHint();
                    inputValue = this.getInputValue();
                    preventDefault = hintValue && hintValue !== inputValue && !withModifier($e);
                    break;

                  case "up":
                  case "down":
                    preventDefault = !withModifier($e);
                    break;

                  default:
                    preventDefault = false;
                }
                if (preventDefault) {
                    $e.preventDefault();
                }
            },
            _shouldTrigger: function shouldTrigger(keyName, $e) {
                var trigger;
                switch (keyName) {
                  case "tab":
                    trigger = !withModifier($e);
                    break;

                  default:
                    trigger = true;
                }
                return trigger;
            },
            _checkInputValue: function checkInputValue() {
                var inputValue;
                var areEquivalent;
                var hasDifferentWhitespace;
                inputValue = this.getInputValue();
                areEquivalent = areQueriesEquivalent(inputValue, this.query);
                hasDifferentWhitespace = areEquivalent && this.query ? this.query.length !== inputValue.length : false;
                this.query = inputValue;
                if (!areEquivalent) {
                    this.trigger("queryChanged", this.query);
                } else if (hasDifferentWhitespace) {
                    this.trigger("whitespaceChanged", this.query);
                }
            },
            focus: function focus() {
                this.$input.focus();
            },
            blur: function blur() {
                this.$input.blur();
            },
            getQuery: function getQuery() {
                return this.query;
            },
            setQuery: function setQuery(query) {
                this.query = query;
            },
            getInputValue: function getInputValue() {
                return this.$input.val();
            },
            setInputValue: function setInputValue(value, silent) {
                if (typeof value === "undefined") {
                    value = this.query;
                }
                this.$input.val(value);
                if (silent) {
                    this.clearHint();
                } else {
                    this._checkInputValue();
                }
            },
            expand: function expand() {
                this.$input.attr("aria-expanded", "true");
            },
            collapse: function collapse() {
                this.$input.attr("aria-expanded", "false");
            },
            setActiveDescendant: function setActiveDescendant(activedescendantId) {
                this.$input.attr("aria-activedescendant", activedescendantId);
            },
            removeActiveDescendant: function removeActiveDescendant() {
                this.$input.removeAttr("aria-activedescendant");
            },
            resetInputValue: function resetInputValue() {
                this.setInputValue(this.query, true);
            },
            getHint: function getHint() {
                return this.$hint.val();
            },
            setHint: function setHint(value) {
                this.$hint.val(value);
            },
            clearHint: function clearHint() {
                this.setHint("");
            },
            clearHintIfInvalid: function clearHintIfInvalid() {
                var val;
                var hint;
                var valIsPrefixOfHint;
                var isValid;
                val = this.getInputValue();
                hint = this.getHint();
                valIsPrefixOfHint = val !== hint && hint.indexOf(val) === 0;
                isValid = val !== "" && valIsPrefixOfHint && !this.hasOverflow();
                if (!isValid) {
                    this.clearHint();
                }
            },
            getLanguageDirection: function getLanguageDirection() {
                return (this.$input.css("direction") || "ltr").toLowerCase();
            },
            hasOverflow: function hasOverflow() {
                var constraint = this.$input.width() - 2;
                this.$overflowHelper.text(this.getInputValue());
                return this.$overflowHelper.width() >= constraint;
            },
            isCursorAtEnd: function() {
                var valueLength;
                var selectionStart;
                var range;
                valueLength = this.$input.val().length;
                selectionStart = this.$input[0].selectionStart;
                if (_.isNumber(selectionStart)) {
                    return selectionStart === valueLength;
                } else if (document.selection) {
                    range = document.selection.createRange();
                    range.moveStart("character", -valueLength);
                    return valueLength === range.text.length;
                }
                return true;
            },
            destroy: function destroy() {
                this.$hint.off(".aa");
                this.$input.off(".aa");
                this.$hint = this.$input = this.$overflowHelper = null;
            }
        });
        function buildOverflowHelper($input) {
            return DOM.element('<pre aria-hidden="true"></pre>').css({
                position: "absolute",
                visibility: "hidden",
                whiteSpace: "pre",
                fontFamily: $input.css("font-family"),
                fontSize: $input.css("font-size"),
                fontStyle: $input.css("font-style"),
                fontVariant: $input.css("font-variant"),
                fontWeight: $input.css("font-weight"),
                wordSpacing: $input.css("word-spacing"),
                letterSpacing: $input.css("letter-spacing"),
                textIndent: $input.css("text-indent"),
                textRendering: $input.css("text-rendering"),
                textTransform: $input.css("text-transform")
            }).insertAfter($input);
        }
        function areQueriesEquivalent(a, b) {
            return Input.normalizeQuery(a) === Input.normalizeQuery(b);
        }
        function withModifier($e) {
            return $e.altKey || $e.ctrlKey || $e.metaKey || $e.shiftKey;
        }
        module.exports = Input;
    }, {
        "../common/dom.js": 11,
        "../common/utils.js": 13,
        "./event_emitter.js": 7
    } ],
    10: [ function(require, module, exports) {
        "use strict";
        var attrsKey = "aaAttrs";
        var _ = require("../common/utils.js");
        var DOM = require("../common/dom.js");
        var EventBus = require("./event_bus.js");
        var Input = require("./input.js");
        var Dropdown = require("./dropdown.js");
        var html = require("./html.js");
        var css = require("./css.js");
        function Typeahead(o) {
            var $menu;
            var $hint;
            o = o || {};
            if (!o.input) {
                _.error("missing input");
            }
            this.isActivated = false;
            this.debug = !!o.debug;
            this.autoselect = !!o.autoselect;
            this.autoselectOnBlur = !!o.autoselectOnBlur;
            this.openOnFocus = !!o.openOnFocus;
            this.minLength = _.isNumber(o.minLength) ? o.minLength : 1;
            this.autoWidth = o.autoWidth === undefined ? true : !!o.autoWidth;
            this.clearOnSelected = !!o.clearOnSelected;
            this.tabAutocomplete = o.tabAutocomplete === undefined ? true : !!o.tabAutocomplete;
            o.hint = !!o.hint;
            if (o.hint && o.appendTo) {
                throw new Error("[autocomplete.js] hint and appendTo options can't be used at the same time");
            }
            this.css = o.css = _.mixin({}, css, o.appendTo ? css.appendTo : {});
            this.cssClasses = o.cssClasses = _.mixin({}, css.defaultClasses, o.cssClasses || {});
            this.cssClasses.prefix = o.cssClasses.formattedPrefix = _.formatPrefix(this.cssClasses.prefix, this.cssClasses.noPrefix);
            this.listboxId = o.listboxId = [ this.cssClasses.root, "listbox", _.getUniqueId() ].join("-");
            var domElts = buildDom(o);
            this.$node = domElts.wrapper;
            var $input = this.$input = domElts.input;
            $menu = domElts.menu;
            $hint = domElts.hint;
            if (o.dropdownMenuContainer) {
                DOM.element(o.dropdownMenuContainer).css("position", "relative").append($menu.css("top", "0"));
            }
            $input.on("blur.aa", function($e) {
                var active = document.activeElement;
                if (_.isMsie() && ($menu[0] === active || $menu[0].contains(active))) {
                    $e.preventDefault();
                    $e.stopImmediatePropagation();
                    _.defer(function() {
                        $input.focus();
                    });
                }
            });
            $menu.on("mousedown.aa", function($e) {
                $e.preventDefault();
            });
            this.eventBus = o.eventBus || new EventBus({
                el: $input
            });
            this.dropdown = new Typeahead.Dropdown({
                appendTo: o.appendTo,
                wrapper: this.$node,
                menu: $menu,
                datasets: o.datasets,
                templates: o.templates,
                cssClasses: o.cssClasses,
                minLength: this.minLength
            }).onSync("suggestionClicked", this._onSuggestionClicked, this).onSync("cursorMoved", this._onCursorMoved, this).onSync("cursorRemoved", this._onCursorRemoved, this).onSync("opened", this._onOpened, this).onSync("closed", this._onClosed, this).onSync("shown", this._onShown, this).onSync("empty", this._onEmpty, this).onSync("redrawn", this._onRedrawn, this).onAsync("datasetRendered", this._onDatasetRendered, this);
            this.input = new Typeahead.Input({
                input: $input,
                hint: $hint
            }).onSync("focused", this._onFocused, this).onSync("blurred", this._onBlurred, this).onSync("enterKeyed", this._onEnterKeyed, this).onSync("tabKeyed", this._onTabKeyed, this).onSync("escKeyed", this._onEscKeyed, this).onSync("upKeyed", this._onUpKeyed, this).onSync("downKeyed", this._onDownKeyed, this).onSync("leftKeyed", this._onLeftKeyed, this).onSync("rightKeyed", this._onRightKeyed, this).onSync("queryChanged", this._onQueryChanged, this).onSync("whitespaceChanged", this._onWhitespaceChanged, this);
            this._bindKeyboardShortcuts(o);
            this._setLanguageDirection();
        }
        _.mixin(Typeahead.prototype, {
            _bindKeyboardShortcuts: function(options) {
                if (!options.keyboardShortcuts) {
                    return;
                }
                var $input = this.$input;
                var keyboardShortcuts = [];
                _.each(options.keyboardShortcuts, function(key) {
                    if (typeof key === "string") {
                        key = key.toUpperCase().charCodeAt(0);
                    }
                    keyboardShortcuts.push(key);
                });
                DOM.element(document).keydown(function(event) {
                    var elt = event.target || event.srcElement;
                    var tagName = elt.tagName;
                    if (elt.isContentEditable || tagName === "INPUT" || tagName === "SELECT" || tagName === "TEXTAREA") {
                        return;
                    }
                    var which = event.which || event.keyCode;
                    if (keyboardShortcuts.indexOf(which) === -1) {
                        return;
                    }
                    $input.focus();
                    event.stopPropagation();
                    event.preventDefault();
                });
            },
            _onSuggestionClicked: function onSuggestionClicked(type, $el) {
                var datum;
                var context = {
                    selectionMethod: "click"
                };
                if (datum = this.dropdown.getDatumForSuggestion($el)) {
                    this._select(datum, context);
                }
            },
            _onCursorMoved: function onCursorMoved(event, updateInput) {
                var datum = this.dropdown.getDatumForCursor();
                var currentCursorId = this.dropdown.getCurrentCursor().attr("id");
                this.input.setActiveDescendant(currentCursorId);
                if (datum) {
                    if (updateInput) {
                        this.input.setInputValue(datum.value, true);
                    }
                    this.eventBus.trigger("cursorchanged", datum.raw, datum.datasetName);
                }
            },
            _onCursorRemoved: function onCursorRemoved() {
                this.input.resetInputValue();
                this._updateHint();
                this.eventBus.trigger("cursorremoved");
            },
            _onDatasetRendered: function onDatasetRendered() {
                this._updateHint();
                this.eventBus.trigger("updated");
            },
            _onOpened: function onOpened() {
                this._updateHint();
                this.input.expand();
                this.eventBus.trigger("opened");
            },
            _onEmpty: function onEmpty() {
                this.eventBus.trigger("empty");
            },
            _onRedrawn: function onRedrawn() {
                this.$node.css("top", 0 + "px");
                this.$node.css("left", 0 + "px");
                var inputRect = this.$input[0].getBoundingClientRect();
                if (this.autoWidth) {
                    this.$node.css("width", inputRect.width + "px");
                }
                var wrapperRect = this.$node[0].getBoundingClientRect();
                var top = inputRect.bottom - wrapperRect.top;
                this.$node.css("top", top + "px");
                var left = inputRect.left - wrapperRect.left;
                this.$node.css("left", left + "px");
                this.eventBus.trigger("redrawn");
            },
            _onShown: function onShown() {
                this.eventBus.trigger("shown");
                if (this.autoselect) {
                    this.dropdown.cursorTopSuggestion();
                }
            },
            _onClosed: function onClosed() {
                this.input.clearHint();
                this.input.removeActiveDescendant();
                this.input.collapse();
                this.eventBus.trigger("closed");
            },
            _onFocused: function onFocused() {
                this.isActivated = true;
                if (this.openOnFocus) {
                    var query = this.input.getQuery();
                    if (query.length >= this.minLength) {
                        this.dropdown.update(query);
                    } else {
                        this.dropdown.empty();
                    }
                    this.dropdown.open();
                }
            },
            _onBlurred: function onBlurred() {
                var cursorDatum;
                var topSuggestionDatum;
                cursorDatum = this.dropdown.getDatumForCursor();
                topSuggestionDatum = this.dropdown.getDatumForTopSuggestion();
                var context = {
                    selectionMethod: "blur"
                };
                if (!this.debug) {
                    if (this.autoselectOnBlur && cursorDatum) {
                        this._select(cursorDatum, context);
                    } else if (this.autoselectOnBlur && topSuggestionDatum) {
                        this._select(topSuggestionDatum, context);
                    } else {
                        this.isActivated = false;
                        this.dropdown.empty();
                        this.dropdown.close();
                    }
                }
            },
            _onEnterKeyed: function onEnterKeyed(type, $e) {
                var cursorDatum;
                var topSuggestionDatum;
                cursorDatum = this.dropdown.getDatumForCursor();
                topSuggestionDatum = this.dropdown.getDatumForTopSuggestion();
                var context = {
                    selectionMethod: "enterKey"
                };
                if (cursorDatum) {
                    this._select(cursorDatum, context);
                    $e.preventDefault();
                } else if (this.autoselect && topSuggestionDatum) {
                    this._select(topSuggestionDatum, context);
                    $e.preventDefault();
                }
            },
            _onTabKeyed: function onTabKeyed(type, $e) {
                if (!this.tabAutocomplete) {
                    this.dropdown.close();
                    return;
                }
                var datum;
                var context = {
                    selectionMethod: "tabKey"
                };
                if (datum = this.dropdown.getDatumForCursor()) {
                    this._select(datum, context);
                    $e.preventDefault();
                } else {
                    this._autocomplete(true);
                }
            },
            _onEscKeyed: function onEscKeyed() {
                this.dropdown.close();
                this.input.resetInputValue();
            },
            _onUpKeyed: function onUpKeyed() {
                var query = this.input.getQuery();
                if (this.dropdown.isEmpty && query.length >= this.minLength) {
                    this.dropdown.update(query);
                } else {
                    this.dropdown.moveCursorUp();
                }
                this.dropdown.open();
            },
            _onDownKeyed: function onDownKeyed() {
                var query = this.input.getQuery();
                if (this.dropdown.isEmpty && query.length >= this.minLength) {
                    this.dropdown.update(query);
                } else {
                    this.dropdown.moveCursorDown();
                }
                this.dropdown.open();
            },
            _onLeftKeyed: function onLeftKeyed() {
                if (this.dir === "rtl") {
                    this._autocomplete();
                }
            },
            _onRightKeyed: function onRightKeyed() {
                if (this.dir === "ltr") {
                    this._autocomplete();
                }
            },
            _onQueryChanged: function onQueryChanged(e, query) {
                this.input.clearHintIfInvalid();
                if (query.length >= this.minLength) {
                    this.dropdown.update(query);
                } else {
                    this.dropdown.empty();
                }
                this.dropdown.open();
                this._setLanguageDirection();
            },
            _onWhitespaceChanged: function onWhitespaceChanged() {
                this._updateHint();
                this.dropdown.open();
            },
            _setLanguageDirection: function setLanguageDirection() {
                var dir = this.input.getLanguageDirection();
                if (this.dir !== dir) {
                    this.dir = dir;
                    this.$node.css("direction", dir);
                    this.dropdown.setLanguageDirection(dir);
                }
            },
            _updateHint: function updateHint() {
                var datum;
                var val;
                var query;
                var escapedQuery;
                var frontMatchRegEx;
                var match;
                datum = this.dropdown.getDatumForTopSuggestion();
                if (datum && this.dropdown.isVisible() && !this.input.hasOverflow()) {
                    val = this.input.getInputValue();
                    query = Input.normalizeQuery(val);
                    escapedQuery = _.escapeRegExChars(query);
                    frontMatchRegEx = new RegExp("^(?:" + escapedQuery + ")(.+$)", "i");
                    match = frontMatchRegEx.exec(datum.value);
                    if (match) {
                        this.input.setHint(val + match[1]);
                    } else {
                        this.input.clearHint();
                    }
                } else {
                    this.input.clearHint();
                }
            },
            _autocomplete: function autocomplete(laxCursor) {
                var hint;
                var query;
                var isCursorAtEnd;
                var datum;
                hint = this.input.getHint();
                query = this.input.getQuery();
                isCursorAtEnd = laxCursor || this.input.isCursorAtEnd();
                if (hint && query !== hint && isCursorAtEnd) {
                    datum = this.dropdown.getDatumForTopSuggestion();
                    if (datum) {
                        this.input.setInputValue(datum.value);
                    }
                    this.eventBus.trigger("autocompleted", datum.raw, datum.datasetName);
                }
            },
            _select: function select(datum, context) {
                if (typeof datum.value !== "undefined") {
                    this.input.setQuery(datum.value);
                }
                if (this.clearOnSelected) {
                    this.setVal("");
                } else {
                    this.input.setInputValue(datum.value, true);
                }
                this._setLanguageDirection();
                var event = this.eventBus.trigger("selected", datum.raw, datum.datasetName, context);
                if (event.isDefaultPrevented() === false) {
                    this.dropdown.close();
                    _.defer(_.bind(this.dropdown.empty, this.dropdown));
                }
            },
            open: function open() {
                if (!this.isActivated) {
                    var query = this.input.getInputValue();
                    if (query.length >= this.minLength) {
                        this.dropdown.update(query);
                    } else {
                        this.dropdown.empty();
                    }
                }
                this.dropdown.open();
            },
            close: function close() {
                this.dropdown.close();
            },
            setVal: function setVal(val) {
                val = _.toStr(val);
                if (this.isActivated) {
                    this.input.setInputValue(val);
                } else {
                    this.input.setQuery(val);
                    this.input.setInputValue(val, true);
                }
                this._setLanguageDirection();
            },
            getVal: function getVal() {
                return this.input.getQuery();
            },
            destroy: function destroy() {
                this.input.destroy();
                this.dropdown.destroy();
                destroyDomStructure(this.$node, this.cssClasses);
                this.$node = null;
            },
            getWrapper: function getWrapper() {
                return this.dropdown.$container[0];
            }
        });
        function buildDom(options) {
            var $input;
            var $wrapper;
            var $dropdown;
            var $hint;
            $input = DOM.element(options.input);
            $wrapper = DOM.element(html.wrapper.replace("%ROOT%", options.cssClasses.root)).css(options.css.wrapper);
            if (!options.appendTo && $input.css("display") === "block" && $input.parent().css("display") === "table") {
                $wrapper.css("display", "table-cell");
            }
            var dropdownHtml = html.dropdown.replace("%PREFIX%", options.cssClasses.prefix).replace("%DROPDOWN_MENU%", options.cssClasses.dropdownMenu);
            $dropdown = DOM.element(dropdownHtml).css(options.css.dropdown).attr({
                role: "listbox",
                id: options.listboxId
            });
            if (options.templates && options.templates.dropdownMenu) {
                $dropdown.html(_.templatify(options.templates.dropdownMenu)());
            }
            $hint = $input.clone().css(options.css.hint).css(getBackgroundStyles($input));
            $hint.val("").addClass(_.className(options.cssClasses.prefix, options.cssClasses.hint, true)).removeAttr("id name placeholder required").prop("readonly", true).attr({
                "aria-hidden": "true",
                autocomplete: "off",
                spellcheck: "false",
                tabindex: -1
            });
            if ($hint.removeData) {
                $hint.removeData();
            }
            $input.data(attrsKey, {
                "aria-autocomplete": $input.attr("aria-autocomplete"),
                "aria-expanded": $input.attr("aria-expanded"),
                "aria-owns": $input.attr("aria-owns"),
                autocomplete: $input.attr("autocomplete"),
                dir: $input.attr("dir"),
                role: $input.attr("role"),
                spellcheck: $input.attr("spellcheck"),
                style: $input.attr("style"),
                type: $input.attr("type")
            });
            $input.addClass(_.className(options.cssClasses.prefix, options.cssClasses.input, true)).attr({
                autocomplete: "off",
                spellcheck: false,
                role: "combobox",
                "aria-autocomplete": options.datasets && options.datasets[0] && options.datasets[0].displayKey ? "both" : "list",
                "aria-expanded": "false",
                "aria-label": options.ariaLabel,
                "aria-owns": options.listboxId
            }).css(options.hint ? options.css.input : options.css.inputWithNoHint);
            try {
                if (!$input.attr("dir")) {
                    $input.attr("dir", "auto");
                }
            } catch (e) {}
            $wrapper = options.appendTo ? $wrapper.appendTo(DOM.element(options.appendTo).eq(0)).eq(0) : $input.wrap($wrapper).parent();
            $wrapper.prepend(options.hint ? $hint : null).append($dropdown);
            return {
                wrapper: $wrapper,
                input: $input,
                hint: $hint,
                menu: $dropdown
            };
        }
        function getBackgroundStyles($el) {
            return {
                backgroundAttachment: $el.css("background-attachment"),
                backgroundClip: $el.css("background-clip"),
                backgroundColor: $el.css("background-color"),
                backgroundImage: $el.css("background-image"),
                backgroundOrigin: $el.css("background-origin"),
                backgroundPosition: $el.css("background-position"),
                backgroundRepeat: $el.css("background-repeat"),
                backgroundSize: $el.css("background-size")
            };
        }
        function destroyDomStructure($node, cssClasses) {
            var $input = $node.find(_.className(cssClasses.prefix, cssClasses.input));
            _.each($input.data(attrsKey), function(val, key) {
                if (val === undefined) {
                    $input.removeAttr(key);
                } else {
                    $input.attr(key, val);
                }
            });
            $input.detach().removeClass(_.className(cssClasses.prefix, cssClasses.input, true)).insertAfter($node);
            if ($input.removeData) {
                $input.removeData(attrsKey);
            }
            $node.remove();
        }
        Typeahead.Dropdown = Dropdown;
        Typeahead.Input = Input;
        Typeahead.sources = require("../sources/index.js");
        module.exports = Typeahead;
    }, {
        "../common/dom.js": 11,
        "../common/utils.js": 13,
        "../sources/index.js": 15,
        "./css.js": 3,
        "./dropdown.js": 5,
        "./event_bus.js": 6,
        "./html.js": 8,
        "./input.js": 9
    } ],
    11: [ function(require, module, exports) {
        "use strict";
        module.exports = {
            element: null
        };
    }, {} ],
    12: [ function(require, module, exports) {
        "use strict";
        module.exports = function parseAlgoliaClientVersion(agent) {
            var parsed = agent.match(/Algolia for vanilla JavaScript (\d+\.)(\d+\.)(\d+)/);
            if (parsed) return [ parsed[1], parsed[2], parsed[3] ];
            return undefined;
        };
    }, {} ],
    13: [ function(require, module, exports) {
        "use strict";
        var DOM = require("./dom.js");
        function escapeRegExp(str) {
            return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
        }
        module.exports = {
            isArray: null,
            isFunction: null,
            isObject: null,
            bind: null,
            each: null,
            map: null,
            mixin: null,
            isMsie: function(agentString) {
                if (agentString === undefined) {
                    agentString = navigator.userAgent;
                }
                if (/(msie|trident)/i.test(agentString)) {
                    var match = agentString.match(/(msie |rv:)(\d+(.\d+)?)/i);
                    if (match) {
                        return match[2];
                    }
                }
                return false;
            },
            escapeRegExChars: function(str) {
                return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
            },
            isNumber: function(obj) {
                return typeof obj === "number";
            },
            toStr: function toStr(s) {
                return s === undefined || s === null ? "" : s + "";
            },
            cloneDeep: function cloneDeep(obj) {
                var clone = this.mixin({}, obj);
                var self = this;
                this.each(clone, function(value, key) {
                    if (value) {
                        if (self.isArray(value)) {
                            clone[key] = [].concat(value);
                        } else if (self.isObject(value)) {
                            clone[key] = self.cloneDeep(value);
                        }
                    }
                });
                return clone;
            },
            error: function(msg) {
                throw new Error(msg);
            },
            every: function(obj, test) {
                var result = true;
                if (!obj) {
                    return result;
                }
                this.each(obj, function(val, key) {
                    if (result) {
                        result = test.call(null, val, key, obj) && result;
                    }
                });
                return !!result;
            },
            any: function(obj, test) {
                var found = false;
                if (!obj) {
                    return found;
                }
                this.each(obj, function(val, key) {
                    if (test.call(null, val, key, obj)) {
                        found = true;
                        return false;
                    }
                });
                return found;
            },
            getUniqueId: function() {
                var counter = 0;
                return function() {
                    return counter++;
                };
            }(),
            templatify: function templatify(obj) {
                if (this.isFunction(obj)) {
                    return obj;
                }
                var $template = DOM.element(obj);
                if ($template.prop("tagName") === "SCRIPT") {
                    return function template() {
                        return $template.text();
                    };
                }
                return function template() {
                    return String(obj);
                };
            },
            defer: function(fn) {
                setTimeout(fn, 0);
            },
            noop: function() {},
            formatPrefix: function(prefix, noPrefix) {
                return noPrefix ? "" : prefix + "-";
            },
            className: function(prefix, clazz, skipDot) {
                return (skipDot ? "" : ".") + prefix + clazz;
            },
            escapeHighlightedString: function(str, highlightPreTag, highlightPostTag) {
                highlightPreTag = highlightPreTag || "<em>";
                var pre = document.createElement("div");
                pre.appendChild(document.createTextNode(highlightPreTag));
                highlightPostTag = highlightPostTag || "</em>";
                var post = document.createElement("div");
                post.appendChild(document.createTextNode(highlightPostTag));
                var div = document.createElement("div");
                div.appendChild(document.createTextNode(str));
                return div.innerHTML.replace(RegExp(escapeRegExp(pre.innerHTML), "g"), highlightPreTag).replace(RegExp(escapeRegExp(post.innerHTML), "g"), highlightPostTag);
            }
        };
    }, {
        "./dom.js": 11
    } ],
    14: [ function(require, module, exports) {
        "use strict";
        var _ = require("../common/utils.js");
        var version = require("../../version.js");
        var parseAlgoliaClientVersion = require("../common/parseAlgoliaClientVersion.js");
        module.exports = function search(index, params) {
            var algoliaVersion = parseAlgoliaClientVersion(index.as._ua);
            if (algoliaVersion && algoliaVersion[0] >= 3 && algoliaVersion[1] > 20) {
                params = params || {};
                params.additionalUA = "autocomplete.js " + version;
            }
            return sourceFn;
            function sourceFn(query, cb) {
                index.search(query, params, function(error, content) {
                    if (error) {
                        _.error(error.message);
                        return;
                    }
                    cb(content.hits, content);
                });
            }
        };
    }, {
        "../../version.js": 18,
        "../common/parseAlgoliaClientVersion.js": 12,
        "../common/utils.js": 13
    } ],
    15: [ function(require, module, exports) {
        "use strict";
        module.exports = {
            hits: require("./hits.js"),
            popularIn: require("./popularIn.js")
        };
    }, {
        "./hits.js": 14,
        "./popularIn.js": 16
    } ],
    16: [ function(require, module, exports) {
        "use strict";
        var _ = require("../common/utils.js");
        var version = require("../../version.js");
        var parseAlgoliaClientVersion = require("../common/parseAlgoliaClientVersion.js");
        module.exports = function popularIn(index, params, details, options) {
            var algoliaVersion = parseAlgoliaClientVersion(index.as._ua);
            if (algoliaVersion && algoliaVersion[0] >= 3 && algoliaVersion[1] > 20) {
                params = params || {};
                params.additionalUA = "autocomplete.js " + version;
            }
            if (!details.source) {
                return _.error("Missing 'source' key");
            }
            var source = _.isFunction(details.source) ? details.source : function(hit) {
                return hit[details.source];
            };
            if (!details.index) {
                return _.error("Missing 'index' key");
            }
            var detailsIndex = details.index;
            options = options || {};
            return sourceFn;
            function sourceFn(query, cb) {
                index.search(query, params, function(error, content) {
                    if (error) {
                        _.error(error.message);
                        return;
                    }
                    if (content.hits.length > 0) {
                        var first = content.hits[0];
                        var detailsParams = _.mixin({
                            hitsPerPage: 0
                        }, details);
                        delete detailsParams.source;
                        delete detailsParams.index;
                        var detailsAlgoliaVersion = parseAlgoliaClientVersion(detailsIndex.as._ua);
                        if (detailsAlgoliaVersion && detailsAlgoliaVersion[0] >= 3 && detailsAlgoliaVersion[1] > 20) {
                            params.additionalUA = "autocomplete.js " + version;
                        }
                        detailsIndex.search(source(first), detailsParams, function(error2, content2) {
                            if (error2) {
                                _.error(error2.message);
                                return;
                            }
                            var suggestions = [];
                            if (options.includeAll) {
                                var label = options.allTitle || "All departments";
                                suggestions.push(_.mixin({
                                    facet: {
                                        value: label,
                                        count: content2.nbHits
                                    }
                                }, _.cloneDeep(first)));
                            }
                            _.each(content2.facets, function(values, facet) {
                                _.each(values, function(count, value) {
                                    suggestions.push(_.mixin({
                                        facet: {
                                            facet: facet,
                                            value: value,
                                            count: count
                                        }
                                    }, _.cloneDeep(first)));
                                });
                            });
                            for (var i = 1; i < content.hits.length; ++i) {
                                suggestions.push(content.hits[i]);
                            }
                            cb(suggestions, content);
                        });
                        return;
                    }
                    cb([]);
                });
            }
        };
    }, {
        "../../version.js": 18,
        "../common/parseAlgoliaClientVersion.js": 12,
        "../common/utils.js": 13
    } ],
    17: [ function(require, module, exports) {
        "use strict";
        var zepto = require("../../zepto.js");
        var DOM = require("../common/dom.js");
        DOM.element = zepto;
        var _ = require("../common/utils.js");
        _.isArray = zepto.isArray;
        _.isFunction = zepto.isFunction;
        _.isObject = zepto.isPlainObject;
        _.bind = zepto.proxy;
        _.each = function(collection, cb) {
            zepto.each(collection, reverseArgs);
            function reverseArgs(index, value) {
                return cb(value, index);
            }
        };
        _.map = zepto.map;
        _.mixin = zepto.extend;
        _.Event = zepto.Event;
        var typeaheadKey = "aaAutocomplete";
        var Typeahead = require("../autocomplete/typeahead.js");
        var EventBus = require("../autocomplete/event_bus.js");
        function autocomplete(selector, options, datasets, typeaheadObject) {
            datasets = _.isArray(datasets) ? datasets : [].slice.call(arguments, 2);
            var inputs = zepto(selector).each(function(i, input) {
                var $input = zepto(input);
                var eventBus = new EventBus({
                    el: $input
                });
                var typeahead = typeaheadObject || new Typeahead({
                    input: $input,
                    eventBus: eventBus,
                    dropdownMenuContainer: options.dropdownMenuContainer,
                    hint: options.hint === undefined ? true : !!options.hint,
                    minLength: options.minLength,
                    autoselect: options.autoselect,
                    autoselectOnBlur: options.autoselectOnBlur,
                    tabAutocomplete: options.tabAutocomplete,
                    openOnFocus: options.openOnFocus,
                    templates: options.templates,
                    debug: options.debug,
                    clearOnSelected: options.clearOnSelected,
                    cssClasses: options.cssClasses,
                    datasets: datasets,
                    keyboardShortcuts: options.keyboardShortcuts,
                    appendTo: options.appendTo,
                    autoWidth: options.autoWidth
                });
                $input.data(typeaheadKey, typeahead);
            });
            inputs.autocomplete = {};
            _.each([ "open", "close", "getVal", "setVal", "destroy", "getWrapper" ], function(method) {
                inputs.autocomplete[method] = function() {
                    var methodArguments = arguments;
                    var result;
                    inputs.each(function(j, input) {
                        var typeahead = zepto(input).data(typeaheadKey);
                        result = typeahead[method].apply(typeahead, methodArguments);
                    });
                    return result;
                };
            });
            return inputs;
        }
        autocomplete.sources = Typeahead.sources;
        autocomplete.escapeHighlightedString = _.escapeHighlightedString;
        var wasAutocompleteSet = "autocomplete" in window;
        var oldAutocomplete = window.autocomplete;
        autocomplete.noConflict = function noConflict() {
            if (wasAutocompleteSet) {
                window.autocomplete = oldAutocomplete;
            } else {
                delete window.autocomplete;
            }
            return autocomplete;
        };
        module.exports = autocomplete;
    }, {
        "../../zepto.js": 19,
        "../autocomplete/event_bus.js": 6,
        "../autocomplete/typeahead.js": 10,
        "../common/dom.js": 11,
        "../common/utils.js": 13
    } ],
    18: [ function(require, module, exports) {
        module.exports = "0.35.0";
    }, {} ],
    19: [ function(require, module, exports) {
        (function(global, factory) {
            module.exports = factory(global);
        })(window, function(window) {
            var Zepto = function() {
                var undefined, key, $, classList, emptyArray = [], concat = emptyArray.concat, filter = emptyArray.filter, slice = emptyArray.slice, document = window.document, elementDisplay = {}, classCache = {}, cssNumber = {
                    "column-count": 1,
                    columns: 1,
                    "font-weight": 1,
                    "line-height": 1,
                    opacity: 1,
                    "z-index": 1,
                    zoom: 1
                }, fragmentRE = /^\s*<(\w+|!)[^>]*>/, singleTagRE = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, tagExpanderRE = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, rootNodeRE = /^(?:body|html)$/i, capitalRE = /([A-Z])/g, methodAttributes = [ "val", "css", "html", "text", "data", "width", "height", "offset" ], adjacencyOperators = [ "after", "prepend", "before", "append" ], table = document.createElement("table"), tableRow = document.createElement("tr"), containers = {
                    tr: document.createElement("tbody"),
                    tbody: table,
                    thead: table,
                    tfoot: table,
                    td: tableRow,
                    th: tableRow,
                    "*": document.createElement("div")
                }, readyRE = /complete|loaded|interactive/, simpleSelectorRE = /^[\w-]*$/, class2type = {}, toString = class2type.toString, zepto = {}, camelize, uniq, tempParent = document.createElement("div"), propMap = {
                    tabindex: "tabIndex",
                    readonly: "readOnly",
                    for: "htmlFor",
                    class: "className",
                    maxlength: "maxLength",
                    cellspacing: "cellSpacing",
                    cellpadding: "cellPadding",
                    rowspan: "rowSpan",
                    colspan: "colSpan",
                    usemap: "useMap",
                    frameborder: "frameBorder",
                    contenteditable: "contentEditable"
                }, isArray = Array.isArray || function(object) {
                    return object instanceof Array;
                };
                zepto.matches = function(element, selector) {
                    if (!selector || !element || element.nodeType !== 1) return false;
                    var matchesSelector = element.matches || element.webkitMatchesSelector || element.mozMatchesSelector || element.oMatchesSelector || element.matchesSelector;
                    if (matchesSelector) return matchesSelector.call(element, selector);
                    var match, parent = element.parentNode, temp = !parent;
                    if (temp) (parent = tempParent).appendChild(element);
                    match = ~zepto.qsa(parent, selector).indexOf(element);
                    temp && tempParent.removeChild(element);
                    return match;
                };
                function type(obj) {
                    return obj == null ? String(obj) : class2type[toString.call(obj)] || "object";
                }
                function isFunction(value) {
                    return type(value) == "function";
                }
                function isWindow(obj) {
                    return obj != null && obj == obj.window;
                }
                function isDocument(obj) {
                    return obj != null && obj.nodeType == obj.DOCUMENT_NODE;
                }
                function isObject(obj) {
                    return type(obj) == "object";
                }
                function isPlainObject(obj) {
                    return isObject(obj) && !isWindow(obj) && Object.getPrototypeOf(obj) == Object.prototype;
                }
                function likeArray(obj) {
                    var length = !!obj && "length" in obj && obj.length, type = $.type(obj);
                    return "function" != type && !isWindow(obj) && ("array" == type || length === 0 || typeof length == "number" && length > 0 && length - 1 in obj);
                }
                function compact(array) {
                    return filter.call(array, function(item) {
                        return item != null;
                    });
                }
                function flatten(array) {
                    return array.length > 0 ? $.fn.concat.apply([], array) : array;
                }
                camelize = function(str) {
                    return str.replace(/-+(.)?/g, function(match, chr) {
                        return chr ? chr.toUpperCase() : "";
                    });
                };
                function dasherize(str) {
                    return str.replace(/::/g, "/").replace(/([A-Z]+)([A-Z][a-z])/g, "$1_$2").replace(/([a-z\d])([A-Z])/g, "$1_$2").replace(/_/g, "-").toLowerCase();
                }
                uniq = function(array) {
                    return filter.call(array, function(item, idx) {
                        return array.indexOf(item) == idx;
                    });
                };
                function classRE(name) {
                    return name in classCache ? classCache[name] : classCache[name] = new RegExp("(^|\\s)" + name + "(\\s|$)");
                }
                function maybeAddPx(name, value) {
                    return typeof value == "number" && !cssNumber[dasherize(name)] ? value + "px" : value;
                }
                function defaultDisplay(nodeName) {
                    var element, display;
                    if (!elementDisplay[nodeName]) {
                        element = document.createElement(nodeName);
                        document.body.appendChild(element);
                        display = getComputedStyle(element, "").getPropertyValue("display");
                        element.parentNode.removeChild(element);
                        display == "none" && (display = "block");
                        elementDisplay[nodeName] = display;
                    }
                    return elementDisplay[nodeName];
                }
                function children(element) {
                    return "children" in element ? slice.call(element.children) : $.map(element.childNodes, function(node) {
                        if (node.nodeType == 1) return node;
                    });
                }
                function Z(dom, selector) {
                    var i, len = dom ? dom.length : 0;
                    for (i = 0; i < len; i++) this[i] = dom[i];
                    this.length = len;
                    this.selector = selector || "";
                }
                zepto.fragment = function(html, name, properties) {
                    var dom, nodes, container;
                    if (singleTagRE.test(html)) dom = $(document.createElement(RegExp.$1));
                    if (!dom) {
                        if (html.replace) html = html.replace(tagExpanderRE, "<$1></$2>");
                        if (name === undefined) name = fragmentRE.test(html) && RegExp.$1;
                        if (!(name in containers)) name = "*";
                        container = containers[name];
                        container.innerHTML = "" + html;
                        dom = $.each(slice.call(container.childNodes), function() {
                            container.removeChild(this);
                        });
                    }
                    if (isPlainObject(properties)) {
                        nodes = $(dom);
                        $.each(properties, function(key, value) {
                            if (methodAttributes.indexOf(key) > -1) nodes[key](value); else nodes.attr(key, value);
                        });
                    }
                    return dom;
                };
                zepto.Z = function(dom, selector) {
                    return new Z(dom, selector);
                };
                zepto.isZ = function(object) {
                    return object instanceof zepto.Z;
                };
                zepto.init = function(selector, context) {
                    var dom;
                    if (!selector) return zepto.Z(); else if (typeof selector == "string") {
                        selector = selector.trim();
                        if (selector[0] == "<" && fragmentRE.test(selector)) dom = zepto.fragment(selector, RegExp.$1, context), 
                        selector = null; else if (context !== undefined) return $(context).find(selector); else dom = zepto.qsa(document, selector);
                    } else if (isFunction(selector)) return $(document).ready(selector); else if (zepto.isZ(selector)) return selector; else {
                        if (isArray(selector)) dom = compact(selector); else if (isObject(selector)) dom = [ selector ], 
                        selector = null; else if (fragmentRE.test(selector)) dom = zepto.fragment(selector.trim(), RegExp.$1, context), 
                        selector = null; else if (context !== undefined) return $(context).find(selector); else dom = zepto.qsa(document, selector);
                    }
                    return zepto.Z(dom, selector);
                };
                $ = function(selector, context) {
                    return zepto.init(selector, context);
                };
                function extend(target, source, deep) {
                    for (key in source) if (deep && (isPlainObject(source[key]) || isArray(source[key]))) {
                        if (isPlainObject(source[key]) && !isPlainObject(target[key])) target[key] = {};
                        if (isArray(source[key]) && !isArray(target[key])) target[key] = [];
                        extend(target[key], source[key], deep);
                    } else if (source[key] !== undefined) target[key] = source[key];
                }
                $.extend = function(target) {
                    var deep, args = slice.call(arguments, 1);
                    if (typeof target == "boolean") {
                        deep = target;
                        target = args.shift();
                    }
                    args.forEach(function(arg) {
                        extend(target, arg, deep);
                    });
                    return target;
                };
                zepto.qsa = function(element, selector) {
                    var found, maybeID = selector[0] == "#", maybeClass = !maybeID && selector[0] == ".", nameOnly = maybeID || maybeClass ? selector.slice(1) : selector, isSimple = simpleSelectorRE.test(nameOnly);
                    return element.getElementById && isSimple && maybeID ? (found = element.getElementById(nameOnly)) ? [ found ] : [] : element.nodeType !== 1 && element.nodeType !== 9 && element.nodeType !== 11 ? [] : slice.call(isSimple && !maybeID && element.getElementsByClassName ? maybeClass ? element.getElementsByClassName(nameOnly) : element.getElementsByTagName(selector) : element.querySelectorAll(selector));
                };
                function filtered(nodes, selector) {
                    return selector == null ? $(nodes) : $(nodes).filter(selector);
                }
                $.contains = document.documentElement.contains ? function(parent, node) {
                    return parent !== node && parent.contains(node);
                } : function(parent, node) {
                    while (node && (node = node.parentNode)) if (node === parent) return true;
                    return false;
                };
                function funcArg(context, arg, idx, payload) {
                    return isFunction(arg) ? arg.call(context, idx, payload) : arg;
                }
                function setAttribute(node, name, value) {
                    value == null ? node.removeAttribute(name) : node.setAttribute(name, value);
                }
                function className(node, value) {
                    var klass = node.className || "", svg = klass && klass.baseVal !== undefined;
                    if (value === undefined) return svg ? klass.baseVal : klass;
                    svg ? klass.baseVal = value : node.className = value;
                }
                function deserializeValue(value) {
                    try {
                        return value ? value == "true" || (value == "false" ? false : value == "null" ? null : +value + "" == value ? +value : /^[\[\{]/.test(value) ? $.parseJSON(value) : value) : value;
                    } catch (e) {
                        return value;
                    }
                }
                $.type = type;
                $.isFunction = isFunction;
                $.isWindow = isWindow;
                $.isArray = isArray;
                $.isPlainObject = isPlainObject;
                $.isEmptyObject = function(obj) {
                    var name;
                    for (name in obj) return false;
                    return true;
                };
                $.isNumeric = function(val) {
                    var num = Number(val), type = typeof val;
                    return val != null && type != "boolean" && (type != "string" || val.length) && !isNaN(num) && isFinite(num) || false;
                };
                $.inArray = function(elem, array, i) {
                    return emptyArray.indexOf.call(array, elem, i);
                };
                $.camelCase = camelize;
                $.trim = function(str) {
                    return str == null ? "" : String.prototype.trim.call(str);
                };
                $.uuid = 0;
                $.support = {};
                $.expr = {};
                $.noop = function() {};
                $.map = function(elements, callback) {
                    var value, values = [], i, key;
                    if (likeArray(elements)) for (i = 0; i < elements.length; i++) {
                        value = callback(elements[i], i);
                        if (value != null) values.push(value);
                    } else for (key in elements) {
                        value = callback(elements[key], key);
                        if (value != null) values.push(value);
                    }
                    return flatten(values);
                };
                $.each = function(elements, callback) {
                    var i, key;
                    if (likeArray(elements)) {
                        for (i = 0; i < elements.length; i++) if (callback.call(elements[i], i, elements[i]) === false) return elements;
                    } else {
                        for (key in elements) if (callback.call(elements[key], key, elements[key]) === false) return elements;
                    }
                    return elements;
                };
                $.grep = function(elements, callback) {
                    return filter.call(elements, callback);
                };
                if (window.JSON) $.parseJSON = JSON.parse;
                $.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function(i, name) {
                    class2type["[object " + name + "]"] = name.toLowerCase();
                });
                $.fn = {
                    constructor: zepto.Z,
                    length: 0,
                    forEach: emptyArray.forEach,
                    reduce: emptyArray.reduce,
                    push: emptyArray.push,
                    sort: emptyArray.sort,
                    splice: emptyArray.splice,
                    indexOf: emptyArray.indexOf,
                    concat: function() {
                        var i, value, args = [];
                        for (i = 0; i < arguments.length; i++) {
                            value = arguments[i];
                            args[i] = zepto.isZ(value) ? value.toArray() : value;
                        }
                        return concat.apply(zepto.isZ(this) ? this.toArray() : this, args);
                    },
                    map: function(fn) {
                        return $($.map(this, function(el, i) {
                            return fn.call(el, i, el);
                        }));
                    },
                    slice: function() {
                        return $(slice.apply(this, arguments));
                    },
                    ready: function(callback) {
                        if (readyRE.test(document.readyState) && document.body) callback($); else document.addEventListener("DOMContentLoaded", function() {
                            callback($);
                        }, false);
                        return this;
                    },
                    get: function(idx) {
                        return idx === undefined ? slice.call(this) : this[idx >= 0 ? idx : idx + this.length];
                    },
                    toArray: function() {
                        return this.get();
                    },
                    size: function() {
                        return this.length;
                    },
                    remove: function() {
                        return this.each(function() {
                            if (this.parentNode != null) this.parentNode.removeChild(this);
                        });
                    },
                    each: function(callback) {
                        emptyArray.every.call(this, function(el, idx) {
                            return callback.call(el, idx, el) !== false;
                        });
                        return this;
                    },
                    filter: function(selector) {
                        if (isFunction(selector)) return this.not(this.not(selector));
                        return $(filter.call(this, function(element) {
                            return zepto.matches(element, selector);
                        }));
                    },
                    add: function(selector, context) {
                        return $(uniq(this.concat($(selector, context))));
                    },
                    is: function(selector) {
                        return this.length > 0 && zepto.matches(this[0], selector);
                    },
                    not: function(selector) {
                        var nodes = [];
                        if (isFunction(selector) && selector.call !== undefined) this.each(function(idx) {
                            if (!selector.call(this, idx)) nodes.push(this);
                        }); else {
                            var excludes = typeof selector == "string" ? this.filter(selector) : likeArray(selector) && isFunction(selector.item) ? slice.call(selector) : $(selector);
                            this.forEach(function(el) {
                                if (excludes.indexOf(el) < 0) nodes.push(el);
                            });
                        }
                        return $(nodes);
                    },
                    has: function(selector) {
                        return this.filter(function() {
                            return isObject(selector) ? $.contains(this, selector) : $(this).find(selector).size();
                        });
                    },
                    eq: function(idx) {
                        return idx === -1 ? this.slice(idx) : this.slice(idx, +idx + 1);
                    },
                    first: function() {
                        var el = this[0];
                        return el && !isObject(el) ? el : $(el);
                    },
                    last: function() {
                        var el = this[this.length - 1];
                        return el && !isObject(el) ? el : $(el);
                    },
                    find: function(selector) {
                        var result, $this = this;
                        if (!selector) result = $(); else if (typeof selector == "object") result = $(selector).filter(function() {
                            var node = this;
                            return emptyArray.some.call($this, function(parent) {
                                return $.contains(parent, node);
                            });
                        }); else if (this.length == 1) result = $(zepto.qsa(this[0], selector)); else result = this.map(function() {
                            return zepto.qsa(this, selector);
                        });
                        return result;
                    },
                    closest: function(selector, context) {
                        var nodes = [], collection = typeof selector == "object" && $(selector);
                        this.each(function(_, node) {
                            while (node && !(collection ? collection.indexOf(node) >= 0 : zepto.matches(node, selector))) node = node !== context && !isDocument(node) && node.parentNode;
                            if (node && nodes.indexOf(node) < 0) nodes.push(node);
                        });
                        return $(nodes);
                    },
                    parents: function(selector) {
                        var ancestors = [], nodes = this;
                        while (nodes.length > 0) nodes = $.map(nodes, function(node) {
                            if ((node = node.parentNode) && !isDocument(node) && ancestors.indexOf(node) < 0) {
                                ancestors.push(node);
                                return node;
                            }
                        });
                        return filtered(ancestors, selector);
                    },
                    parent: function(selector) {
                        return filtered(uniq(this.pluck("parentNode")), selector);
                    },
                    children: function(selector) {
                        return filtered(this.map(function() {
                            return children(this);
                        }), selector);
                    },
                    contents: function() {
                        return this.map(function() {
                            return this.contentDocument || slice.call(this.childNodes);
                        });
                    },
                    siblings: function(selector) {
                        return filtered(this.map(function(i, el) {
                            return filter.call(children(el.parentNode), function(child) {
                                return child !== el;
                            });
                        }), selector);
                    },
                    empty: function() {
                        return this.each(function() {
                            this.innerHTML = "";
                        });
                    },
                    pluck: function(property) {
                        return $.map(this, function(el) {
                            return el[property];
                        });
                    },
                    show: function() {
                        return this.each(function() {
                            this.style.display == "none" && (this.style.display = "");
                            if (getComputedStyle(this, "").getPropertyValue("display") == "none") this.style.display = defaultDisplay(this.nodeName);
                        });
                    },
                    replaceWith: function(newContent) {
                        return this.before(newContent).remove();
                    },
                    wrap: function(structure) {
                        var func = isFunction(structure);
                        if (this[0] && !func) var dom = $(structure).get(0), clone = dom.parentNode || this.length > 1;
                        return this.each(function(index) {
                            $(this).wrapAll(func ? structure.call(this, index) : clone ? dom.cloneNode(true) : dom);
                        });
                    },
                    wrapAll: function(structure) {
                        if (this[0]) {
                            $(this[0]).before(structure = $(structure));
                            var children;
                            while ((children = structure.children()).length) structure = children.first();
                            $(structure).append(this);
                        }
                        return this;
                    },
                    wrapInner: function(structure) {
                        var func = isFunction(structure);
                        return this.each(function(index) {
                            var self = $(this), contents = self.contents(), dom = func ? structure.call(this, index) : structure;
                            contents.length ? contents.wrapAll(dom) : self.append(dom);
                        });
                    },
                    unwrap: function() {
                        this.parent().each(function() {
                            $(this).replaceWith($(this).children());
                        });
                        return this;
                    },
                    clone: function() {
                        return this.map(function() {
                            return this.cloneNode(true);
                        });
                    },
                    hide: function() {
                        return this.css("display", "none");
                    },
                    toggle: function(setting) {
                        return this.each(function() {
                            var el = $(this);
                            (setting === undefined ? el.css("display") == "none" : setting) ? el.show() : el.hide();
                        });
                    },
                    prev: function(selector) {
                        return $(this.pluck("previousElementSibling")).filter(selector || "*");
                    },
                    next: function(selector) {
                        return $(this.pluck("nextElementSibling")).filter(selector || "*");
                    },
                    html: function(html) {
                        return 0 in arguments ? this.each(function(idx) {
                            var originHtml = this.innerHTML;
                            $(this).empty().append(funcArg(this, html, idx, originHtml));
                        }) : 0 in this ? this[0].innerHTML : null;
                    },
                    text: function(text) {
                        return 0 in arguments ? this.each(function(idx) {
                            var newText = funcArg(this, text, idx, this.textContent);
                            this.textContent = newText == null ? "" : "" + newText;
                        }) : 0 in this ? this.pluck("textContent").join("") : null;
                    },
                    attr: function(name, value) {
                        var result;
                        return typeof name == "string" && !(1 in arguments) ? 0 in this && this[0].nodeType == 1 && (result = this[0].getAttribute(name)) != null ? result : undefined : this.each(function(idx) {
                            if (this.nodeType !== 1) return;
                            if (isObject(name)) for (key in name) setAttribute(this, key, name[key]); else setAttribute(this, name, funcArg(this, value, idx, this.getAttribute(name)));
                        });
                    },
                    removeAttr: function(name) {
                        return this.each(function() {
                            this.nodeType === 1 && name.split(" ").forEach(function(attribute) {
                                setAttribute(this, attribute);
                            }, this);
                        });
                    },
                    prop: function(name, value) {
                        name = propMap[name] || name;
                        return 1 in arguments ? this.each(function(idx) {
                            this[name] = funcArg(this, value, idx, this[name]);
                        }) : this[0] && this[0][name];
                    },
                    removeProp: function(name) {
                        name = propMap[name] || name;
                        return this.each(function() {
                            delete this[name];
                        });
                    },
                    data: function(name, value) {
                        var attrName = "data-" + name.replace(capitalRE, "-$1").toLowerCase();
                        var data = 1 in arguments ? this.attr(attrName, value) : this.attr(attrName);
                        return data !== null ? deserializeValue(data) : undefined;
                    },
                    val: function(value) {
                        if (0 in arguments) {
                            if (value == null) value = "";
                            return this.each(function(idx) {
                                this.value = funcArg(this, value, idx, this.value);
                            });
                        } else {
                            return this[0] && (this[0].multiple ? $(this[0]).find("option").filter(function() {
                                return this.selected;
                            }).pluck("value") : this[0].value);
                        }
                    },
                    offset: function(coordinates) {
                        if (coordinates) return this.each(function(index) {
                            var $this = $(this), coords = funcArg(this, coordinates, index, $this.offset()), parentOffset = $this.offsetParent().offset(), props = {
                                top: coords.top - parentOffset.top,
                                left: coords.left - parentOffset.left
                            };
                            if ($this.css("position") == "static") props["position"] = "relative";
                            $this.css(props);
                        });
                        if (!this.length) return null;
                        if (document.documentElement !== this[0] && !$.contains(document.documentElement, this[0])) return {
                            top: 0,
                            left: 0
                        };
                        var obj = this[0].getBoundingClientRect();
                        return {
                            left: obj.left + window.pageXOffset,
                            top: obj.top + window.pageYOffset,
                            width: Math.round(obj.width),
                            height: Math.round(obj.height)
                        };
                    },
                    css: function(property, value) {
                        if (arguments.length < 2) {
                            var element = this[0];
                            if (typeof property == "string") {
                                if (!element) return;
                                return element.style[camelize(property)] || getComputedStyle(element, "").getPropertyValue(property);
                            } else if (isArray(property)) {
                                if (!element) return;
                                var props = {};
                                var computedStyle = getComputedStyle(element, "");
                                $.each(property, function(_, prop) {
                                    props[prop] = element.style[camelize(prop)] || computedStyle.getPropertyValue(prop);
                                });
                                return props;
                            }
                        }
                        var css = "";
                        if (type(property) == "string") {
                            if (!value && value !== 0) this.each(function() {
                                this.style.removeProperty(dasherize(property));
                            }); else css = dasherize(property) + ":" + maybeAddPx(property, value);
                        } else {
                            for (key in property) if (!property[key] && property[key] !== 0) this.each(function() {
                                this.style.removeProperty(dasherize(key));
                            }); else css += dasherize(key) + ":" + maybeAddPx(key, property[key]) + ";";
                        }
                        return this.each(function() {
                            this.style.cssText += ";" + css;
                        });
                    },
                    index: function(element) {
                        return element ? this.indexOf($(element)[0]) : this.parent().children().indexOf(this[0]);
                    },
                    hasClass: function(name) {
                        if (!name) return false;
                        return emptyArray.some.call(this, function(el) {
                            return this.test(className(el));
                        }, classRE(name));
                    },
                    addClass: function(name) {
                        if (!name) return this;
                        return this.each(function(idx) {
                            if (!("className" in this)) return;
                            classList = [];
                            var cls = className(this), newName = funcArg(this, name, idx, cls);
                            newName.split(/\s+/g).forEach(function(klass) {
                                if (!$(this).hasClass(klass)) classList.push(klass);
                            }, this);
                            classList.length && className(this, cls + (cls ? " " : "") + classList.join(" "));
                        });
                    },
                    removeClass: function(name) {
                        return this.each(function(idx) {
                            if (!("className" in this)) return;
                            if (name === undefined) return className(this, "");
                            classList = className(this);
                            funcArg(this, name, idx, classList).split(/\s+/g).forEach(function(klass) {
                                classList = classList.replace(classRE(klass), " ");
                            });
                            className(this, classList.trim());
                        });
                    },
                    toggleClass: function(name, when) {
                        if (!name) return this;
                        return this.each(function(idx) {
                            var $this = $(this), names = funcArg(this, name, idx, className(this));
                            names.split(/\s+/g).forEach(function(klass) {
                                (when === undefined ? !$this.hasClass(klass) : when) ? $this.addClass(klass) : $this.removeClass(klass);
                            });
                        });
                    },
                    scrollTop: function(value) {
                        if (!this.length) return;
                        var hasScrollTop = "scrollTop" in this[0];
                        if (value === undefined) return hasScrollTop ? this[0].scrollTop : this[0].pageYOffset;
                        return this.each(hasScrollTop ? function() {
                            this.scrollTop = value;
                        } : function() {
                            this.scrollTo(this.scrollX, value);
                        });
                    },
                    scrollLeft: function(value) {
                        if (!this.length) return;
                        var hasScrollLeft = "scrollLeft" in this[0];
                        if (value === undefined) return hasScrollLeft ? this[0].scrollLeft : this[0].pageXOffset;
                        return this.each(hasScrollLeft ? function() {
                            this.scrollLeft = value;
                        } : function() {
                            this.scrollTo(value, this.scrollY);
                        });
                    },
                    position: function() {
                        if (!this.length) return;
                        var elem = this[0], offsetParent = this.offsetParent(), offset = this.offset(), parentOffset = rootNodeRE.test(offsetParent[0].nodeName) ? {
                            top: 0,
                            left: 0
                        } : offsetParent.offset();
                        offset.top -= parseFloat($(elem).css("margin-top")) || 0;
                        offset.left -= parseFloat($(elem).css("margin-left")) || 0;
                        parentOffset.top += parseFloat($(offsetParent[0]).css("border-top-width")) || 0;
                        parentOffset.left += parseFloat($(offsetParent[0]).css("border-left-width")) || 0;
                        return {
                            top: offset.top - parentOffset.top,
                            left: offset.left - parentOffset.left
                        };
                    },
                    offsetParent: function() {
                        return this.map(function() {
                            var parent = this.offsetParent || document.body;
                            while (parent && !rootNodeRE.test(parent.nodeName) && $(parent).css("position") == "static") parent = parent.offsetParent;
                            return parent;
                        });
                    }
                };
                $.fn.detach = $.fn.remove;
                [ "width", "height" ].forEach(function(dimension) {
                    var dimensionProperty = dimension.replace(/./, function(m) {
                        return m[0].toUpperCase();
                    });
                    $.fn[dimension] = function(value) {
                        var offset, el = this[0];
                        if (value === undefined) return isWindow(el) ? el["inner" + dimensionProperty] : isDocument(el) ? el.documentElement["scroll" + dimensionProperty] : (offset = this.offset()) && offset[dimension]; else return this.each(function(idx) {
                            el = $(this);
                            el.css(dimension, funcArg(this, value, idx, el[dimension]()));
                        });
                    };
                });
                function traverseNode(node, fun) {
                    fun(node);
                    for (var i = 0, len = node.childNodes.length; i < len; i++) traverseNode(node.childNodes[i], fun);
                }
                adjacencyOperators.forEach(function(operator, operatorIndex) {
                    var inside = operatorIndex % 2;
                    $.fn[operator] = function() {
                        var argType, nodes = $.map(arguments, function(arg) {
                            var arr = [];
                            argType = type(arg);
                            if (argType == "array") {
                                arg.forEach(function(el) {
                                    if (el.nodeType !== undefined) return arr.push(el); else if ($.zepto.isZ(el)) return arr = arr.concat(el.get());
                                    arr = arr.concat(zepto.fragment(el));
                                });
                                return arr;
                            }
                            return argType == "object" || arg == null ? arg : zepto.fragment(arg);
                        }), parent, copyByClone = this.length > 1;
                        if (nodes.length < 1) return this;
                        return this.each(function(_, target) {
                            parent = inside ? target : target.parentNode;
                            target = operatorIndex == 0 ? target.nextSibling : operatorIndex == 1 ? target.firstChild : operatorIndex == 2 ? target : null;
                            var parentInDocument = $.contains(document.documentElement, parent);
                            nodes.forEach(function(node) {
                                if (copyByClone) node = node.cloneNode(true); else if (!parent) return $(node).remove();
                                parent.insertBefore(node, target);
                                if (parentInDocument) traverseNode(node, function(el) {
                                    if (el.nodeName != null && el.nodeName.toUpperCase() === "SCRIPT" && (!el.type || el.type === "text/javascript") && !el.src) {
                                        var target = el.ownerDocument ? el.ownerDocument.defaultView : window;
                                        target["eval"].call(target, el.innerHTML);
                                    }
                                });
                            });
                        });
                    };
                    $.fn[inside ? operator + "To" : "insert" + (operatorIndex ? "Before" : "After")] = function(html) {
                        $(html)[operator](this);
                        return this;
                    };
                });
                zepto.Z.prototype = Z.prototype = $.fn;
                zepto.uniq = uniq;
                zepto.deserializeValue = deserializeValue;
                $.zepto = zepto;
                return $;
            }();
            (function($) {
                var _zid = 1, undefined, slice = Array.prototype.slice, isFunction = $.isFunction, isString = function(obj) {
                    return typeof obj == "string";
                }, handlers = {}, specialEvents = {}, focusinSupported = "onfocusin" in window, focus = {
                    focus: "focusin",
                    blur: "focusout"
                }, hover = {
                    mouseenter: "mouseover",
                    mouseleave: "mouseout"
                };
                specialEvents.click = specialEvents.mousedown = specialEvents.mouseup = specialEvents.mousemove = "MouseEvents";
                function zid(element) {
                    return element._zid || (element._zid = _zid++);
                }
                function findHandlers(element, event, fn, selector) {
                    event = parse(event);
                    if (event.ns) var matcher = matcherFor(event.ns);
                    return (handlers[zid(element)] || []).filter(function(handler) {
                        return handler && (!event.e || handler.e == event.e) && (!event.ns || matcher.test(handler.ns)) && (!fn || zid(handler.fn) === zid(fn)) && (!selector || handler.sel == selector);
                    });
                }
                function parse(event) {
                    var parts = ("" + event).split(".");
                    return {
                        e: parts[0],
                        ns: parts.slice(1).sort().join(" ")
                    };
                }
                function matcherFor(ns) {
                    return new RegExp("(?:^| )" + ns.replace(" ", " .* ?") + "(?: |$)");
                }
                function eventCapture(handler, captureSetting) {
                    return handler.del && (!focusinSupported && handler.e in focus) || !!captureSetting;
                }
                function realEvent(type) {
                    return hover[type] || focusinSupported && focus[type] || type;
                }
                function add(element, events, fn, data, selector, delegator, capture) {
                    var id = zid(element), set = handlers[id] || (handlers[id] = []);
                    events.split(/\s/).forEach(function(event) {
                        if (event == "ready") return $(document).ready(fn);
                        var handler = parse(event);
                        handler.fn = fn;
                        handler.sel = selector;
                        if (handler.e in hover) fn = function(e) {
                            var related = e.relatedTarget;
                            if (!related || related !== this && !$.contains(this, related)) return handler.fn.apply(this, arguments);
                        };
                        handler.del = delegator;
                        var callback = delegator || fn;
                        handler.proxy = function(e) {
                            e = compatible(e);
                            if (e.isImmediatePropagationStopped()) return;
                            try {
                                var dataPropDescriptor = Object.getOwnPropertyDescriptor(e, "data");
                                if (!dataPropDescriptor || dataPropDescriptor.writable) e.data = data;
                            } catch (e) {}
                            var result = callback.apply(element, e._args == undefined ? [ e ] : [ e ].concat(e._args));
                            if (result === false) e.preventDefault(), e.stopPropagation();
                            return result;
                        };
                        handler.i = set.length;
                        set.push(handler);
                        if ("addEventListener" in element) element.addEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture));
                    });
                }
                function remove(element, events, fn, selector, capture) {
                    var id = zid(element);
                    (events || "").split(/\s/).forEach(function(event) {
                        findHandlers(element, event, fn, selector).forEach(function(handler) {
                            delete handlers[id][handler.i];
                            if ("removeEventListener" in element) element.removeEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture));
                        });
                    });
                }
                $.event = {
                    add: add,
                    remove: remove
                };
                $.proxy = function(fn, context) {
                    var args = 2 in arguments && slice.call(arguments, 2);
                    if (isFunction(fn)) {
                        var proxyFn = function() {
                            return fn.apply(context, args ? args.concat(slice.call(arguments)) : arguments);
                        };
                        proxyFn._zid = zid(fn);
                        return proxyFn;
                    } else if (isString(context)) {
                        if (args) {
                            args.unshift(fn[context], fn);
                            return $.proxy.apply(null, args);
                        } else {
                            return $.proxy(fn[context], fn);
                        }
                    } else {
                        throw new TypeError("expected function");
                    }
                };
                $.fn.bind = function(event, data, callback) {
                    return this.on(event, data, callback);
                };
                $.fn.unbind = function(event, callback) {
                    return this.off(event, callback);
                };
                $.fn.one = function(event, selector, data, callback) {
                    return this.on(event, selector, data, callback, 1);
                };
                var returnTrue = function() {
                    return true;
                }, returnFalse = function() {
                    return false;
                }, ignoreProperties = /^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/, eventMethods = {
                    preventDefault: "isDefaultPrevented",
                    stopImmediatePropagation: "isImmediatePropagationStopped",
                    stopPropagation: "isPropagationStopped"
                };
                function compatible(event, source) {
                    if (source || !event.isDefaultPrevented) {
                        source || (source = event);
                        $.each(eventMethods, function(name, predicate) {
                            var sourceMethod = source[name];
                            event[name] = function() {
                                this[predicate] = returnTrue;
                                return sourceMethod && sourceMethod.apply(source, arguments);
                            };
                            event[predicate] = returnFalse;
                        });
                        event.timeStamp || (event.timeStamp = Date.now());
                        if (source.defaultPrevented !== undefined ? source.defaultPrevented : "returnValue" in source ? source.returnValue === false : source.getPreventDefault && source.getPreventDefault()) event.isDefaultPrevented = returnTrue;
                    }
                    return event;
                }
                function createProxy(event) {
                    var key, proxy = {
                        originalEvent: event
                    };
                    for (key in event) if (!ignoreProperties.test(key) && event[key] !== undefined) proxy[key] = event[key];
                    return compatible(proxy, event);
                }
                $.fn.delegate = function(selector, event, callback) {
                    return this.on(event, selector, callback);
                };
                $.fn.undelegate = function(selector, event, callback) {
                    return this.off(event, selector, callback);
                };
                $.fn.live = function(event, callback) {
                    $(document.body).delegate(this.selector, event, callback);
                    return this;
                };
                $.fn.die = function(event, callback) {
                    $(document.body).undelegate(this.selector, event, callback);
                    return this;
                };
                $.fn.on = function(event, selector, data, callback, one) {
                    var autoRemove, delegator, $this = this;
                    if (event && !isString(event)) {
                        $.each(event, function(type, fn) {
                            $this.on(type, selector, data, fn, one);
                        });
                        return $this;
                    }
                    if (!isString(selector) && !isFunction(callback) && callback !== false) callback = data, 
                    data = selector, selector = undefined;
                    if (callback === undefined || data === false) callback = data, data = undefined;
                    if (callback === false) callback = returnFalse;
                    return $this.each(function(_, element) {
                        if (one) autoRemove = function(e) {
                            remove(element, e.type, callback);
                            return callback.apply(this, arguments);
                        };
                        if (selector) delegator = function(e) {
                            var evt, match = $(e.target).closest(selector, element).get(0);
                            if (match && match !== element) {
                                evt = $.extend(createProxy(e), {
                                    currentTarget: match,
                                    liveFired: element
                                });
                                return (autoRemove || callback).apply(match, [ evt ].concat(slice.call(arguments, 1)));
                            }
                        };
                        add(element, event, callback, data, selector, delegator || autoRemove);
                    });
                };
                $.fn.off = function(event, selector, callback) {
                    var $this = this;
                    if (event && !isString(event)) {
                        $.each(event, function(type, fn) {
                            $this.off(type, selector, fn);
                        });
                        return $this;
                    }
                    if (!isString(selector) && !isFunction(callback) && callback !== false) callback = selector, 
                    selector = undefined;
                    if (callback === false) callback = returnFalse;
                    return $this.each(function() {
                        remove(this, event, callback, selector);
                    });
                };
                $.fn.trigger = function(event, args) {
                    event = isString(event) || $.isPlainObject(event) ? $.Event(event) : compatible(event);
                    event._args = args;
                    return this.each(function() {
                        if (event.type in focus && typeof this[event.type] == "function") this[event.type](); else if ("dispatchEvent" in this) this.dispatchEvent(event); else $(this).triggerHandler(event, args);
                    });
                };
                $.fn.triggerHandler = function(event, args) {
                    var e, result;
                    this.each(function(i, element) {
                        e = createProxy(isString(event) ? $.Event(event) : event);
                        e._args = args;
                        e.target = element;
                        $.each(findHandlers(element, event.type || event), function(i, handler) {
                            result = handler.proxy(e);
                            if (e.isImmediatePropagationStopped()) return false;
                        });
                    });
                    return result;
                };
                ("focusin focusout focus blur load resize scroll unload click dblclick " + "mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave " + "change select keydown keypress keyup error").split(" ").forEach(function(event) {
                    $.fn[event] = function(callback) {
                        return 0 in arguments ? this.bind(event, callback) : this.trigger(event);
                    };
                });
                $.Event = function(type, props) {
                    if (!isString(type)) props = type, type = props.type;
                    var event = document.createEvent(specialEvents[type] || "Events"), bubbles = true;
                    if (props) for (var name in props) name == "bubbles" ? bubbles = !!props[name] : event[name] = props[name];
                    event.initEvent(type, bubbles, true);
                    return compatible(event);
                };
            })(Zepto);
            (function($) {
                var cache = [], timeout;
                $.fn.remove = function() {
                    return this.each(function() {
                        if (this.parentNode) {
                            if (this.tagName === "IMG") {
                                cache.push(this);
                                this.src = "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";
                                if (timeout) clearTimeout(timeout);
                                timeout = setTimeout(function() {
                                    cache = [];
                                }, 6e4);
                            }
                            this.parentNode.removeChild(this);
                        }
                    });
                };
            })(Zepto);
            (function($) {
                var data = {}, dataAttr = $.fn.data, camelize = $.camelCase, exp = $.expando = "Zepto" + +new Date(), emptyArray = [];
                function getData(node, name) {
                    var id = node[exp], store = id && data[id];
                    if (name === undefined) return store || setData(node); else {
                        if (store) {
                            if (name in store) return store[name];
                            var camelName = camelize(name);
                            if (camelName in store) return store[camelName];
                        }
                        return dataAttr.call($(node), name);
                    }
                }
                function setData(node, name, value) {
                    var id = node[exp] || (node[exp] = ++$.uuid), store = data[id] || (data[id] = attributeData(node));
                    if (name !== undefined) store[camelize(name)] = value;
                    return store;
                }
                function attributeData(node) {
                    var store = {};
                    $.each(node.attributes || emptyArray, function(i, attr) {
                        if (attr.name.indexOf("data-") == 0) store[camelize(attr.name.replace("data-", ""))] = $.zepto.deserializeValue(attr.value);
                    });
                    return store;
                }
                $.fn.data = function(name, value) {
                    return value === undefined ? $.isPlainObject(name) ? this.each(function(i, node) {
                        $.each(name, function(key, value) {
                            setData(node, key, value);
                        });
                    }) : 0 in this ? getData(this[0], name) : undefined : this.each(function() {
                        setData(this, name, value);
                    });
                };
                $.data = function(elem, name, value) {
                    return $(elem).data(name, value);
                };
                $.hasData = function(elem) {
                    var id = elem[exp], store = id && data[id];
                    return store ? !$.isEmptyObject(store) : false;
                };
                $.fn.removeData = function(names) {
                    if (typeof names == "string") names = names.split(/\s+/);
                    return this.each(function() {
                        var id = this[exp], store = id && data[id];
                        if (store) $.each(names || store, function(key) {
                            delete store[names ? camelize(this) : key];
                        });
                    });
                };
                [ "remove", "empty" ].forEach(function(methodName) {
                    var origFn = $.fn[methodName];
                    $.fn[methodName] = function() {
                        var elements = this.find("*");
                        if (methodName === "remove") elements = elements.add(this);
                        elements.removeData();
                        return origFn.call(this);
                    };
                });
            })(Zepto);
            return Zepto;
        });
    }, {} ],
    20: [ function(require, module, exports) {
        (function webpackUniversalModuleDefinition(root, factory) {
            if (typeof exports === "object" && typeof module === "object") module.exports = factory(); else if (typeof define === "function" && define.amd) define("Fuse", [], factory); else if (typeof exports === "object") exports["Fuse"] = factory(); else root["Fuse"] = factory();
        })(this, function() {
            return function(modules) {
                var installedModules = {};
                function __webpack_require__(moduleId) {
                    if (installedModules[moduleId]) {
                        return installedModules[moduleId].exports;
                    }
                    var module = installedModules[moduleId] = {
                        i: moduleId,
                        l: false,
                        exports: {}
                    };
                    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
                    module.l = true;
                    return module.exports;
                }
                __webpack_require__.m = modules;
                __webpack_require__.c = installedModules;
                __webpack_require__.d = function(exports, name, getter) {
                    if (!__webpack_require__.o(exports, name)) {
                        Object.defineProperty(exports, name, {
                            enumerable: true,
                            get: getter
                        });
                    }
                };
                __webpack_require__.r = function(exports) {
                    if (typeof Symbol !== "undefined" && Symbol.toStringTag) {
                        Object.defineProperty(exports, Symbol.toStringTag, {
                            value: "Module"
                        });
                    }
                    Object.defineProperty(exports, "__esModule", {
                        value: true
                    });
                };
                __webpack_require__.t = function(value, mode) {
                    if (mode & 1) value = __webpack_require__(value);
                    if (mode & 8) return value;
                    if (mode & 4 && typeof value === "object" && value && value.__esModule) return value;
                    var ns = Object.create(null);
                    __webpack_require__.r(ns);
                    Object.defineProperty(ns, "default", {
                        enumerable: true,
                        value: value
                    });
                    if (mode & 2 && typeof value != "string") for (var key in value) __webpack_require__.d(ns, key, function(key) {
                        return value[key];
                    }.bind(null, key));
                    return ns;
                };
                __webpack_require__.n = function(module) {
                    var getter = module && module.__esModule ? function getDefault() {
                        return module["default"];
                    } : function getModuleExports() {
                        return module;
                    };
                    __webpack_require__.d(getter, "a", getter);
                    return getter;
                };
                __webpack_require__.o = function(object, property) {
                    return Object.prototype.hasOwnProperty.call(object, property);
                };
                __webpack_require__.p = "";
                return __webpack_require__(__webpack_require__.s = "./src/index.js");
            }({
                "./src/bitap/bitap_matched_indices.js": function(module, exports) {
                    module.exports = function() {
                        var matchmask = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
                        var minMatchCharLength = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
                        var matchedIndices = [];
                        var start = -1;
                        var end = -1;
                        var i = 0;
                        for (var len = matchmask.length; i < len; i += 1) {
                            var match = matchmask[i];
                            if (match && start === -1) {
                                start = i;
                            } else if (!match && start !== -1) {
                                end = i - 1;
                                if (end - start + 1 >= minMatchCharLength) {
                                    matchedIndices.push([ start, end ]);
                                }
                                start = -1;
                            }
                        }
                        if (matchmask[i - 1] && i - start >= minMatchCharLength) {
                            matchedIndices.push([ start, i - 1 ]);
                        }
                        return matchedIndices;
                    };
                },
                "./src/bitap/bitap_pattern_alphabet.js": function(module, exports) {
                    module.exports = function(pattern) {
                        var mask = {};
                        var len = pattern.length;
                        for (var i = 0; i < len; i += 1) {
                            mask[pattern.charAt(i)] = 0;
                        }
                        for (var _i = 0; _i < len; _i += 1) {
                            mask[pattern.charAt(_i)] |= 1 << len - _i - 1;
                        }
                        return mask;
                    };
                },
                "./src/bitap/bitap_regex_search.js": function(module, exports) {
                    var SPECIAL_CHARS_REGEX = /[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;
                    module.exports = function(text, pattern) {
                        var tokenSeparator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : / +/g;
                        var regex = new RegExp(pattern.replace(SPECIAL_CHARS_REGEX, "\\$&").replace(tokenSeparator, "|"));
                        var matches = text.match(regex);
                        var isMatch = !!matches;
                        var matchedIndices = [];
                        if (isMatch) {
                            for (var i = 0, matchesLen = matches.length; i < matchesLen; i += 1) {
                                var match = matches[i];
                                matchedIndices.push([ text.indexOf(match), match.length - 1 ]);
                            }
                        }
                        return {
                            score: isMatch ? .5 : 1,
                            isMatch: isMatch,
                            matchedIndices: matchedIndices
                        };
                    };
                },
                "./src/bitap/bitap_score.js": function(module, exports) {
                    module.exports = function(pattern, _ref) {
                        var _ref$errors = _ref.errors, errors = _ref$errors === void 0 ? 0 : _ref$errors, _ref$currentLocation = _ref.currentLocation, currentLocation = _ref$currentLocation === void 0 ? 0 : _ref$currentLocation, _ref$expectedLocation = _ref.expectedLocation, expectedLocation = _ref$expectedLocation === void 0 ? 0 : _ref$expectedLocation, _ref$distance = _ref.distance, distance = _ref$distance === void 0 ? 100 : _ref$distance;
                        var accuracy = errors / pattern.length;
                        var proximity = Math.abs(expectedLocation - currentLocation);
                        if (!distance) {
                            return proximity ? 1 : accuracy;
                        }
                        return accuracy + proximity / distance;
                    };
                },
                "./src/bitap/bitap_search.js": function(module, exports, __webpack_require__) {
                    var bitapScore = __webpack_require__("./src/bitap/bitap_score.js");
                    var matchedIndices = __webpack_require__("./src/bitap/bitap_matched_indices.js");
                    module.exports = function(text, pattern, patternAlphabet, _ref) {
                        var _ref$location = _ref.location, location = _ref$location === void 0 ? 0 : _ref$location, _ref$distance = _ref.distance, distance = _ref$distance === void 0 ? 100 : _ref$distance, _ref$threshold = _ref.threshold, threshold = _ref$threshold === void 0 ? .6 : _ref$threshold, _ref$findAllMatches = _ref.findAllMatches, findAllMatches = _ref$findAllMatches === void 0 ? false : _ref$findAllMatches, _ref$minMatchCharLeng = _ref.minMatchCharLength, minMatchCharLength = _ref$minMatchCharLeng === void 0 ? 1 : _ref$minMatchCharLeng;
                        var expectedLocation = location;
                        var textLen = text.length;
                        var currentThreshold = threshold;
                        var bestLocation = text.indexOf(pattern, expectedLocation);
                        var patternLen = pattern.length;
                        var matchMask = [];
                        for (var i = 0; i < textLen; i += 1) {
                            matchMask[i] = 0;
                        }
                        if (bestLocation !== -1) {
                            var score = bitapScore(pattern, {
                                errors: 0,
                                currentLocation: bestLocation,
                                expectedLocation: expectedLocation,
                                distance: distance
                            });
                            currentThreshold = Math.min(score, currentThreshold);
                            bestLocation = text.lastIndexOf(pattern, expectedLocation + patternLen);
                            if (bestLocation !== -1) {
                                var _score = bitapScore(pattern, {
                                    errors: 0,
                                    currentLocation: bestLocation,
                                    expectedLocation: expectedLocation,
                                    distance: distance
                                });
                                currentThreshold = Math.min(_score, currentThreshold);
                            }
                        }
                        bestLocation = -1;
                        var lastBitArr = [];
                        var finalScore = 1;
                        var binMax = patternLen + textLen;
                        var mask = 1 << patternLen - 1;
                        for (var _i = 0; _i < patternLen; _i += 1) {
                            var binMin = 0;
                            var binMid = binMax;
                            while (binMin < binMid) {
                                var _score3 = bitapScore(pattern, {
                                    errors: _i,
                                    currentLocation: expectedLocation + binMid,
                                    expectedLocation: expectedLocation,
                                    distance: distance
                                });
                                if (_score3 <= currentThreshold) {
                                    binMin = binMid;
                                } else {
                                    binMax = binMid;
                                }
                                binMid = Math.floor((binMax - binMin) / 2 + binMin);
                            }
                            binMax = binMid;
                            var start = Math.max(1, expectedLocation - binMid + 1);
                            var finish = findAllMatches ? textLen : Math.min(expectedLocation + binMid, textLen) + patternLen;
                            var bitArr = Array(finish + 2);
                            bitArr[finish + 1] = (1 << _i) - 1;
                            for (var j = finish; j >= start; j -= 1) {
                                var currentLocation = j - 1;
                                var charMatch = patternAlphabet[text.charAt(currentLocation)];
                                if (charMatch) {
                                    matchMask[currentLocation] = 1;
                                }
                                bitArr[j] = (bitArr[j + 1] << 1 | 1) & charMatch;
                                if (_i !== 0) {
                                    bitArr[j] |= (lastBitArr[j + 1] | lastBitArr[j]) << 1 | 1 | lastBitArr[j + 1];
                                }
                                if (bitArr[j] & mask) {
                                    finalScore = bitapScore(pattern, {
                                        errors: _i,
                                        currentLocation: currentLocation,
                                        expectedLocation: expectedLocation,
                                        distance: distance
                                    });
                                    if (finalScore <= currentThreshold) {
                                        currentThreshold = finalScore;
                                        bestLocation = currentLocation;
                                        if (bestLocation <= expectedLocation) {
                                            break;
                                        }
                                        start = Math.max(1, 2 * expectedLocation - bestLocation);
                                    }
                                }
                            }
                            var _score2 = bitapScore(pattern, {
                                errors: _i + 1,
                                currentLocation: expectedLocation,
                                expectedLocation: expectedLocation,
                                distance: distance
                            });
                            if (_score2 > currentThreshold) {
                                break;
                            }
                            lastBitArr = bitArr;
                        }
                        return {
                            isMatch: bestLocation >= 0,
                            score: finalScore === 0 ? .001 : finalScore,
                            matchedIndices: matchedIndices(matchMask, minMatchCharLength)
                        };
                    };
                },
                "./src/bitap/index.js": function(module, exports, __webpack_require__) {
                    function _classCallCheck(instance, Constructor) {
                        if (!(instance instanceof Constructor)) {
                            throw new TypeError("Cannot call a class as a function");
                        }
                    }
                    function _defineProperties(target, props) {
                        for (var i = 0; i < props.length; i++) {
                            var descriptor = props[i];
                            descriptor.enumerable = descriptor.enumerable || false;
                            descriptor.configurable = true;
                            if ("value" in descriptor) descriptor.writable = true;
                            Object.defineProperty(target, descriptor.key, descriptor);
                        }
                    }
                    function _createClass(Constructor, protoProps, staticProps) {
                        if (protoProps) _defineProperties(Constructor.prototype, protoProps);
                        if (staticProps) _defineProperties(Constructor, staticProps);
                        return Constructor;
                    }
                    var bitapRegexSearch = __webpack_require__("./src/bitap/bitap_regex_search.js");
                    var bitapSearch = __webpack_require__("./src/bitap/bitap_search.js");
                    var patternAlphabet = __webpack_require__("./src/bitap/bitap_pattern_alphabet.js");
                    var Bitap = function() {
                        function Bitap(pattern, _ref) {
                            var _ref$location = _ref.location, location = _ref$location === void 0 ? 0 : _ref$location, _ref$distance = _ref.distance, distance = _ref$distance === void 0 ? 100 : _ref$distance, _ref$threshold = _ref.threshold, threshold = _ref$threshold === void 0 ? .6 : _ref$threshold, _ref$maxPatternLength = _ref.maxPatternLength, maxPatternLength = _ref$maxPatternLength === void 0 ? 32 : _ref$maxPatternLength, _ref$isCaseSensitive = _ref.isCaseSensitive, isCaseSensitive = _ref$isCaseSensitive === void 0 ? false : _ref$isCaseSensitive, _ref$tokenSeparator = _ref.tokenSeparator, tokenSeparator = _ref$tokenSeparator === void 0 ? / +/g : _ref$tokenSeparator, _ref$findAllMatches = _ref.findAllMatches, findAllMatches = _ref$findAllMatches === void 0 ? false : _ref$findAllMatches, _ref$minMatchCharLeng = _ref.minMatchCharLength, minMatchCharLength = _ref$minMatchCharLeng === void 0 ? 1 : _ref$minMatchCharLeng;
                            _classCallCheck(this, Bitap);
                            this.options = {
                                location: location,
                                distance: distance,
                                threshold: threshold,
                                maxPatternLength: maxPatternLength,
                                isCaseSensitive: isCaseSensitive,
                                tokenSeparator: tokenSeparator,
                                findAllMatches: findAllMatches,
                                minMatchCharLength: minMatchCharLength
                            };
                            this.pattern = this.options.isCaseSensitive ? pattern : pattern.toLowerCase();
                            if (this.pattern.length <= maxPatternLength) {
                                this.patternAlphabet = patternAlphabet(this.pattern);
                            }
                        }
                        _createClass(Bitap, [ {
                            key: "search",
                            value: function search(text) {
                                if (!this.options.isCaseSensitive) {
                                    text = text.toLowerCase();
                                }
                                if (this.pattern === text) {
                                    return {
                                        isMatch: true,
                                        score: 0,
                                        matchedIndices: [ [ 0, text.length - 1 ] ]
                                    };
                                }
                                var _this$options = this.options, maxPatternLength = _this$options.maxPatternLength, tokenSeparator = _this$options.tokenSeparator;
                                if (this.pattern.length > maxPatternLength) {
                                    return bitapRegexSearch(text, this.pattern, tokenSeparator);
                                }
                                var _this$options2 = this.options, location = _this$options2.location, distance = _this$options2.distance, threshold = _this$options2.threshold, findAllMatches = _this$options2.findAllMatches, minMatchCharLength = _this$options2.minMatchCharLength;
                                return bitapSearch(text, this.pattern, this.patternAlphabet, {
                                    location: location,
                                    distance: distance,
                                    threshold: threshold,
                                    findAllMatches: findAllMatches,
                                    minMatchCharLength: minMatchCharLength
                                });
                            }
                        } ]);
                        return Bitap;
                    }();
                    module.exports = Bitap;
                },
                "./src/helpers/deep_value.js": function(module, exports, __webpack_require__) {
                    var isArray = __webpack_require__("./src/helpers/is_array.js");
                    var deepValue = function deepValue(obj, path, list) {
                        if (!path) {
                            list.push(obj);
                        } else {
                            var dotIndex = path.indexOf(".");
                            var firstSegment = path;
                            var remaining = null;
                            if (dotIndex !== -1) {
                                firstSegment = path.slice(0, dotIndex);
                                remaining = path.slice(dotIndex + 1);
                            }
                            var value = obj[firstSegment];
                            if (value !== null && value !== undefined) {
                                if (!remaining && (typeof value === "string" || typeof value === "number")) {
                                    list.push(value.toString());
                                } else if (isArray(value)) {
                                    for (var i = 0, len = value.length; i < len; i += 1) {
                                        deepValue(value[i], remaining, list);
                                    }
                                } else if (remaining) {
                                    deepValue(value, remaining, list);
                                }
                            }
                        }
                        return list;
                    };
                    module.exports = function(obj, path) {
                        return deepValue(obj, path, []);
                    };
                },
                "./src/helpers/is_array.js": function(module, exports) {
                    module.exports = function(obj) {
                        return !Array.isArray ? Object.prototype.toString.call(obj) === "[object Array]" : Array.isArray(obj);
                    };
                },
                "./src/index.js": function(module, exports, __webpack_require__) {
                    function _typeof(obj) {
                        if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {
                            _typeof = function _typeof(obj) {
                                return typeof obj;
                            };
                        } else {
                            _typeof = function _typeof(obj) {
                                return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
                            };
                        }
                        return _typeof(obj);
                    }
                    function _classCallCheck(instance, Constructor) {
                        if (!(instance instanceof Constructor)) {
                            throw new TypeError("Cannot call a class as a function");
                        }
                    }
                    function _defineProperties(target, props) {
                        for (var i = 0; i < props.length; i++) {
                            var descriptor = props[i];
                            descriptor.enumerable = descriptor.enumerable || false;
                            descriptor.configurable = true;
                            if ("value" in descriptor) descriptor.writable = true;
                            Object.defineProperty(target, descriptor.key, descriptor);
                        }
                    }
                    function _createClass(Constructor, protoProps, staticProps) {
                        if (protoProps) _defineProperties(Constructor.prototype, protoProps);
                        if (staticProps) _defineProperties(Constructor, staticProps);
                        return Constructor;
                    }
                    var Bitap = __webpack_require__("./src/bitap/index.js");
                    var deepValue = __webpack_require__("./src/helpers/deep_value.js");
                    var isArray = __webpack_require__("./src/helpers/is_array.js");
                    var Fuse = function() {
                        function Fuse(list, _ref) {
                            var _ref$location = _ref.location, location = _ref$location === void 0 ? 0 : _ref$location, _ref$distance = _ref.distance, distance = _ref$distance === void 0 ? 100 : _ref$distance, _ref$threshold = _ref.threshold, threshold = _ref$threshold === void 0 ? .6 : _ref$threshold, _ref$maxPatternLength = _ref.maxPatternLength, maxPatternLength = _ref$maxPatternLength === void 0 ? 32 : _ref$maxPatternLength, _ref$caseSensitive = _ref.caseSensitive, caseSensitive = _ref$caseSensitive === void 0 ? false : _ref$caseSensitive, _ref$tokenSeparator = _ref.tokenSeparator, tokenSeparator = _ref$tokenSeparator === void 0 ? / +/g : _ref$tokenSeparator, _ref$findAllMatches = _ref.findAllMatches, findAllMatches = _ref$findAllMatches === void 0 ? false : _ref$findAllMatches, _ref$minMatchCharLeng = _ref.minMatchCharLength, minMatchCharLength = _ref$minMatchCharLeng === void 0 ? 1 : _ref$minMatchCharLeng, _ref$id = _ref.id, id = _ref$id === void 0 ? null : _ref$id, _ref$keys = _ref.keys, keys = _ref$keys === void 0 ? [] : _ref$keys, _ref$shouldSort = _ref.shouldSort, shouldSort = _ref$shouldSort === void 0 ? true : _ref$shouldSort, _ref$getFn = _ref.getFn, getFn = _ref$getFn === void 0 ? deepValue : _ref$getFn, _ref$sortFn = _ref.sortFn, sortFn = _ref$sortFn === void 0 ? function(a, b) {
                                return a.score - b.score;
                            } : _ref$sortFn, _ref$tokenize = _ref.tokenize, tokenize = _ref$tokenize === void 0 ? false : _ref$tokenize, _ref$matchAllTokens = _ref.matchAllTokens, matchAllTokens = _ref$matchAllTokens === void 0 ? false : _ref$matchAllTokens, _ref$includeMatches = _ref.includeMatches, includeMatches = _ref$includeMatches === void 0 ? false : _ref$includeMatches, _ref$includeScore = _ref.includeScore, includeScore = _ref$includeScore === void 0 ? false : _ref$includeScore, _ref$verbose = _ref.verbose, verbose = _ref$verbose === void 0 ? false : _ref$verbose;
                            _classCallCheck(this, Fuse);
                            this.options = {
                                location: location,
                                distance: distance,
                                threshold: threshold,
                                maxPatternLength: maxPatternLength,
                                isCaseSensitive: caseSensitive,
                                tokenSeparator: tokenSeparator,
                                findAllMatches: findAllMatches,
                                minMatchCharLength: minMatchCharLength,
                                id: id,
                                keys: keys,
                                includeMatches: includeMatches,
                                includeScore: includeScore,
                                shouldSort: shouldSort,
                                getFn: getFn,
                                sortFn: sortFn,
                                verbose: verbose,
                                tokenize: tokenize,
                                matchAllTokens: matchAllTokens
                            };
                            this.setCollection(list);
                        }
                        _createClass(Fuse, [ {
                            key: "setCollection",
                            value: function setCollection(list) {
                                this.list = list;
                                return list;
                            }
                        }, {
                            key: "search",
                            value: function search(pattern) {
                                var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
                                    limit: false
                                };
                                this._log('---------\nSearch pattern: "'.concat(pattern, '"'));
                                var _this$_prepareSearche = this._prepareSearchers(pattern), tokenSearchers = _this$_prepareSearche.tokenSearchers, fullSearcher = _this$_prepareSearche.fullSearcher;
                                var _this$_search = this._search(tokenSearchers, fullSearcher), weights = _this$_search.weights, results = _this$_search.results;
                                this._computeScore(weights, results);
                                if (this.options.shouldSort) {
                                    this._sort(results);
                                }
                                if (opts.limit && typeof opts.limit === "number") {
                                    results = results.slice(0, opts.limit);
                                }
                                return this._format(results);
                            }
                        }, {
                            key: "_prepareSearchers",
                            value: function _prepareSearchers() {
                                var pattern = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
                                var tokenSearchers = [];
                                if (this.options.tokenize) {
                                    var tokens = pattern.split(this.options.tokenSeparator);
                                    for (var i = 0, len = tokens.length; i < len; i += 1) {
                                        tokenSearchers.push(new Bitap(tokens[i], this.options));
                                    }
                                }
                                var fullSearcher = new Bitap(pattern, this.options);
                                return {
                                    tokenSearchers: tokenSearchers,
                                    fullSearcher: fullSearcher
                                };
                            }
                        }, {
                            key: "_search",
                            value: function _search() {
                                var tokenSearchers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
                                var fullSearcher = arguments.length > 1 ? arguments[1] : undefined;
                                var list = this.list;
                                var resultMap = {};
                                var results = [];
                                if (typeof list[0] === "string") {
                                    for (var i = 0, len = list.length; i < len; i += 1) {
                                        this._analyze({
                                            key: "",
                                            value: list[i],
                                            record: i,
                                            index: i
                                        }, {
                                            resultMap: resultMap,
                                            results: results,
                                            tokenSearchers: tokenSearchers,
                                            fullSearcher: fullSearcher
                                        });
                                    }
                                    return {
                                        weights: null,
                                        results: results
                                    };
                                }
                                var weights = {};
                                for (var _i = 0, _len = list.length; _i < _len; _i += 1) {
                                    var item = list[_i];
                                    for (var j = 0, keysLen = this.options.keys.length; j < keysLen; j += 1) {
                                        var key = this.options.keys[j];
                                        if (typeof key !== "string") {
                                            weights[key.name] = {
                                                weight: 1 - key.weight || 1
                                            };
                                            if (key.weight <= 0 || key.weight > 1) {
                                                throw new Error("Key weight has to be > 0 and <= 1");
                                            }
                                            key = key.name;
                                        } else {
                                            weights[key] = {
                                                weight: 1
                                            };
                                        }
                                        this._analyze({
                                            key: key,
                                            value: this.options.getFn(item, key),
                                            record: item,
                                            index: _i
                                        }, {
                                            resultMap: resultMap,
                                            results: results,
                                            tokenSearchers: tokenSearchers,
                                            fullSearcher: fullSearcher
                                        });
                                    }
                                }
                                return {
                                    weights: weights,
                                    results: results
                                };
                            }
                        }, {
                            key: "_analyze",
                            value: function _analyze(_ref2, _ref3) {
                                var key = _ref2.key, _ref2$arrayIndex = _ref2.arrayIndex, arrayIndex = _ref2$arrayIndex === void 0 ? -1 : _ref2$arrayIndex, value = _ref2.value, record = _ref2.record, index = _ref2.index;
                                var _ref3$tokenSearchers = _ref3.tokenSearchers, tokenSearchers = _ref3$tokenSearchers === void 0 ? [] : _ref3$tokenSearchers, _ref3$fullSearcher = _ref3.fullSearcher, fullSearcher = _ref3$fullSearcher === void 0 ? [] : _ref3$fullSearcher, _ref3$resultMap = _ref3.resultMap, resultMap = _ref3$resultMap === void 0 ? {} : _ref3$resultMap, _ref3$results = _ref3.results, results = _ref3$results === void 0 ? [] : _ref3$results;
                                if (value === undefined || value === null) {
                                    return;
                                }
                                var exists = false;
                                var averageScore = -1;
                                var numTextMatches = 0;
                                if (typeof value === "string") {
                                    this._log("\nKey: ".concat(key === "" ? "-" : key));
                                    var mainSearchResult = fullSearcher.search(value);
                                    this._log('Full text: "'.concat(value, '", score: ').concat(mainSearchResult.score));
                                    if (this.options.tokenize) {
                                        var words = value.split(this.options.tokenSeparator);
                                        var scores = [];
                                        for (var i = 0; i < tokenSearchers.length; i += 1) {
                                            var tokenSearcher = tokenSearchers[i];
                                            this._log('\nPattern: "'.concat(tokenSearcher.pattern, '"'));
                                            var hasMatchInText = false;
                                            for (var j = 0; j < words.length; j += 1) {
                                                var word = words[j];
                                                var tokenSearchResult = tokenSearcher.search(word);
                                                var obj = {};
                                                if (tokenSearchResult.isMatch) {
                                                    obj[word] = tokenSearchResult.score;
                                                    exists = true;
                                                    hasMatchInText = true;
                                                    scores.push(tokenSearchResult.score);
                                                } else {
                                                    obj[word] = 1;
                                                    if (!this.options.matchAllTokens) {
                                                        scores.push(1);
                                                    }
                                                }
                                                this._log('Token: "'.concat(word, '", score: ').concat(obj[word]));
                                            }
                                            if (hasMatchInText) {
                                                numTextMatches += 1;
                                            }
                                        }
                                        averageScore = scores[0];
                                        var scoresLen = scores.length;
                                        for (var _i2 = 1; _i2 < scoresLen; _i2 += 1) {
                                            averageScore += scores[_i2];
                                        }
                                        averageScore = averageScore / scoresLen;
                                        this._log("Token score average:", averageScore);
                                    }
                                    var finalScore = mainSearchResult.score;
                                    if (averageScore > -1) {
                                        finalScore = (finalScore + averageScore) / 2;
                                    }
                                    this._log("Score average:", finalScore);
                                    var checkTextMatches = this.options.tokenize && this.options.matchAllTokens ? numTextMatches >= tokenSearchers.length : true;
                                    this._log("\nCheck Matches: ".concat(checkTextMatches));
                                    if ((exists || mainSearchResult.isMatch) && checkTextMatches) {
                                        var existingResult = resultMap[index];
                                        if (existingResult) {
                                            existingResult.output.push({
                                                key: key,
                                                arrayIndex: arrayIndex,
                                                value: value,
                                                score: finalScore,
                                                matchedIndices: mainSearchResult.matchedIndices
                                            });
                                        } else {
                                            resultMap[index] = {
                                                item: record,
                                                output: [ {
                                                    key: key,
                                                    arrayIndex: arrayIndex,
                                                    value: value,
                                                    score: finalScore,
                                                    matchedIndices: mainSearchResult.matchedIndices
                                                } ]
                                            };
                                            results.push(resultMap[index]);
                                        }
                                    }
                                } else if (isArray(value)) {
                                    for (var _i3 = 0, len = value.length; _i3 < len; _i3 += 1) {
                                        this._analyze({
                                            key: key,
                                            arrayIndex: _i3,
                                            value: value[_i3],
                                            record: record,
                                            index: index
                                        }, {
                                            resultMap: resultMap,
                                            results: results,
                                            tokenSearchers: tokenSearchers,
                                            fullSearcher: fullSearcher
                                        });
                                    }
                                }
                            }
                        }, {
                            key: "_computeScore",
                            value: function _computeScore(weights, results) {
                                this._log("\n\nComputing score:\n");
                                for (var i = 0, len = results.length; i < len; i += 1) {
                                    var output = results[i].output;
                                    var scoreLen = output.length;
                                    var currScore = 1;
                                    var bestScore = 1;
                                    for (var j = 0; j < scoreLen; j += 1) {
                                        var weight = weights ? weights[output[j].key].weight : 1;
                                        var score = weight === 1 ? output[j].score : output[j].score || .001;
                                        var nScore = score * weight;
                                        if (weight !== 1) {
                                            bestScore = Math.min(bestScore, nScore);
                                        } else {
                                            output[j].nScore = nScore;
                                            currScore *= nScore;
                                        }
                                    }
                                    results[i].score = bestScore === 1 ? currScore : bestScore;
                                    this._log(results[i]);
                                }
                            }
                        }, {
                            key: "_sort",
                            value: function _sort(results) {
                                this._log("\n\nSorting....");
                                results.sort(this.options.sortFn);
                            }
                        }, {
                            key: "_format",
                            value: function _format(results) {
                                var finalOutput = [];
                                if (this.options.verbose) {
                                    var cache = [];
                                    this._log("\n\nOutput:\n\n", JSON.stringify(results, function(key, value) {
                                        if (_typeof(value) === "object" && value !== null) {
                                            if (cache.indexOf(value) !== -1) {
                                                return;
                                            }
                                            cache.push(value);
                                        }
                                        return value;
                                    }));
                                    cache = null;
                                }
                                var transformers = [];
                                if (this.options.includeMatches) {
                                    transformers.push(function(result, data) {
                                        var output = result.output;
                                        data.matches = [];
                                        for (var i = 0, len = output.length; i < len; i += 1) {
                                            var item = output[i];
                                            if (item.matchedIndices.length === 0) {
                                                continue;
                                            }
                                            var obj = {
                                                indices: item.matchedIndices,
                                                value: item.value
                                            };
                                            if (item.key) {
                                                obj.key = item.key;
                                            }
                                            if (item.hasOwnProperty("arrayIndex") && item.arrayIndex > -1) {
                                                obj.arrayIndex = item.arrayIndex;
                                            }
                                            data.matches.push(obj);
                                        }
                                    });
                                }
                                if (this.options.includeScore) {
                                    transformers.push(function(result, data) {
                                        data.score = result.score;
                                    });
                                }
                                for (var i = 0, len = results.length; i < len; i += 1) {
                                    var result = results[i];
                                    if (this.options.id) {
                                        result.item = this.options.getFn(result.item, this.options.id)[0];
                                    }
                                    if (!transformers.length) {
                                        finalOutput.push(result.item);
                                        continue;
                                    }
                                    var data = {
                                        item: result.item
                                    };
                                    for (var j = 0, _len2 = transformers.length; j < _len2; j += 1) {
                                        transformers[j](result, data);
                                    }
                                    finalOutput.push(data);
                                }
                                return finalOutput;
                            }
                        }, {
                            key: "_log",
                            value: function _log() {
                                if (this.options.verbose) {
                                    var _console;
                                    (_console = console).log.apply(_console, arguments);
                                }
                            }
                        } ]);
                        return Fuse;
                    }();
                    module.exports = Fuse;
                }
            });
        });
    }, {} ],
    21: [ function(require, module, exports) {
        (function(window, document, exportName, undefined) {
            "use strict";
            var VENDOR_PREFIXES = [ "", "webkit", "Moz", "MS", "ms", "o" ];
            var TEST_ELEMENT = document.createElement("div");
            var TYPE_FUNCTION = "function";
            var round = Math.round;
            var abs = Math.abs;
            var now = Date.now;
            function setTimeoutContext(fn, timeout, context) {
                return setTimeout(bindFn(fn, context), timeout);
            }
            function invokeArrayArg(arg, fn, context) {
                if (Array.isArray(arg)) {
                    each(arg, context[fn], context);
                    return true;
                }
                return false;
            }
            function each(obj, iterator, context) {
                var i;
                if (!obj) {
                    return;
                }
                if (obj.forEach) {
                    obj.forEach(iterator, context);
                } else if (obj.length !== undefined) {
                    i = 0;
                    while (i < obj.length) {
                        iterator.call(context, obj[i], i, obj);
                        i++;
                    }
                } else {
                    for (i in obj) {
                        obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);
                    }
                }
            }
            function deprecate(method, name, message) {
                var deprecationMessage = "DEPRECATED METHOD: " + name + "\n" + message + " AT \n";
                return function() {
                    var e = new Error("get-stack-trace");
                    var stack = e && e.stack ? e.stack.replace(/^[^\(]+?[\n$]/gm, "").replace(/^\s+at\s+/gm, "").replace(/^Object.<anonymous>\s*\(/gm, "{anonymous}()@") : "Unknown Stack Trace";
                    var log = window.console && (window.console.warn || window.console.log);
                    if (log) {
                        log.call(window.console, deprecationMessage, stack);
                    }
                    return method.apply(this, arguments);
                };
            }
            var assign;
            if (typeof Object.assign !== "function") {
                assign = function assign(target) {
                    if (target === undefined || target === null) {
                        throw new TypeError("Cannot convert undefined or null to object");
                    }
                    var output = Object(target);
                    for (var index = 1; index < arguments.length; index++) {
                        var source = arguments[index];
                        if (source !== undefined && source !== null) {
                            for (var nextKey in source) {
                                if (source.hasOwnProperty(nextKey)) {
                                    output[nextKey] = source[nextKey];
                                }
                            }
                        }
                    }
                    return output;
                };
            } else {
                assign = Object.assign;
            }
            var extend = deprecate(function extend(dest, src, merge) {
                var keys = Object.keys(src);
                var i = 0;
                while (i < keys.length) {
                    if (!merge || merge && dest[keys[i]] === undefined) {
                        dest[keys[i]] = src[keys[i]];
                    }
                    i++;
                }
                return dest;
            }, "extend", "Use `assign`.");
            var merge = deprecate(function merge(dest, src) {
                return extend(dest, src, true);
            }, "merge", "Use `assign`.");
            function inherit(child, base, properties) {
                var baseP = base.prototype, childP;
                childP = child.prototype = Object.create(baseP);
                childP.constructor = child;
                childP._super = baseP;
                if (properties) {
                    assign(childP, properties);
                }
            }
            function bindFn(fn, context) {
                return function boundFn() {
                    return fn.apply(context, arguments);
                };
            }
            function boolOrFn(val, args) {
                if (typeof val == TYPE_FUNCTION) {
                    return val.apply(args ? args[0] || undefined : undefined, args);
                }
                return val;
            }
            function ifUndefined(val1, val2) {
                return val1 === undefined ? val2 : val1;
            }
            function addEventListeners(target, types, handler) {
                each(splitStr(types), function(type) {
                    target.addEventListener(type, handler, false);
                });
            }
            function removeEventListeners(target, types, handler) {
                each(splitStr(types), function(type) {
                    target.removeEventListener(type, handler, false);
                });
            }
            function hasParent(node, parent) {
                while (node) {
                    if (node == parent) {
                        return true;
                    }
                    node = node.parentNode;
                }
                return false;
            }
            function inStr(str, find) {
                return str.indexOf(find) > -1;
            }
            function splitStr(str) {
                return str.trim().split(/\s+/g);
            }
            function inArray(src, find, findByKey) {
                if (src.indexOf && !findByKey) {
                    return src.indexOf(find);
                } else {
                    var i = 0;
                    while (i < src.length) {
                        if (findByKey && src[i][findByKey] == find || !findByKey && src[i] === find) {
                            return i;
                        }
                        i++;
                    }
                    return -1;
                }
            }
            function toArray(obj) {
                return Array.prototype.slice.call(obj, 0);
            }
            function uniqueArray(src, key, sort) {
                var results = [];
                var values = [];
                var i = 0;
                while (i < src.length) {
                    var val = key ? src[i][key] : src[i];
                    if (inArray(values, val) < 0) {
                        results.push(src[i]);
                    }
                    values[i] = val;
                    i++;
                }
                if (sort) {
                    if (!key) {
                        results = results.sort();
                    } else {
                        results = results.sort(function sortUniqueArray(a, b) {
                            return a[key] > b[key];
                        });
                    }
                }
                return results;
            }
            function prefixed(obj, property) {
                var prefix, prop;
                var camelProp = property[0].toUpperCase() + property.slice(1);
                var i = 0;
                while (i < VENDOR_PREFIXES.length) {
                    prefix = VENDOR_PREFIXES[i];
                    prop = prefix ? prefix + camelProp : property;
                    if (prop in obj) {
                        return prop;
                    }
                    i++;
                }
                return undefined;
            }
            var _uniqueId = 1;
            function uniqueId() {
                return _uniqueId++;
            }
            function getWindowForElement(element) {
                var doc = element.ownerDocument || element;
                return doc.defaultView || doc.parentWindow || window;
            }
            var MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;
            var SUPPORT_TOUCH = "ontouchstart" in window;
            var SUPPORT_POINTER_EVENTS = prefixed(window, "PointerEvent") !== undefined;
            var SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);
            var INPUT_TYPE_TOUCH = "touch";
            var INPUT_TYPE_PEN = "pen";
            var INPUT_TYPE_MOUSE = "mouse";
            var INPUT_TYPE_KINECT = "kinect";
            var COMPUTE_INTERVAL = 25;
            var INPUT_START = 1;
            var INPUT_MOVE = 2;
            var INPUT_END = 4;
            var INPUT_CANCEL = 8;
            var DIRECTION_NONE = 1;
            var DIRECTION_LEFT = 2;
            var DIRECTION_RIGHT = 4;
            var DIRECTION_UP = 8;
            var DIRECTION_DOWN = 16;
            var DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;
            var DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;
            var DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;
            var PROPS_XY = [ "x", "y" ];
            var PROPS_CLIENT_XY = [ "clientX", "clientY" ];
            function Input(manager, callback) {
                var self = this;
                this.manager = manager;
                this.callback = callback;
                this.element = manager.element;
                this.target = manager.options.inputTarget;
                this.domHandler = function(ev) {
                    if (boolOrFn(manager.options.enable, [ manager ])) {
                        self.handler(ev);
                    }
                };
                this.init();
            }
            Input.prototype = {
                handler: function() {},
                init: function() {
                    this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);
                    this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);
                    this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);
                },
                destroy: function() {
                    this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);
                    this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);
                    this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);
                }
            };
            function createInputInstance(manager) {
                var Type;
                var inputClass = manager.options.inputClass;
                if (inputClass) {
                    Type = inputClass;
                } else if (SUPPORT_POINTER_EVENTS) {
                    Type = PointerEventInput;
                } else if (SUPPORT_ONLY_TOUCH) {
                    Type = TouchInput;
                } else if (!SUPPORT_TOUCH) {
                    Type = MouseInput;
                } else {
                    Type = TouchMouseInput;
                }
                return new Type(manager, inputHandler);
            }
            function inputHandler(manager, eventType, input) {
                var pointersLen = input.pointers.length;
                var changedPointersLen = input.changedPointers.length;
                var isFirst = eventType & INPUT_START && pointersLen - changedPointersLen === 0;
                var isFinal = eventType & (INPUT_END | INPUT_CANCEL) && pointersLen - changedPointersLen === 0;
                input.isFirst = !!isFirst;
                input.isFinal = !!isFinal;
                if (isFirst) {
                    manager.session = {};
                }
                input.eventType = eventType;
                computeInputData(manager, input);
                manager.emit("hammer.input", input);
                manager.recognize(input);
                manager.session.prevInput = input;
            }
            function computeInputData(manager, input) {
                var session = manager.session;
                var pointers = input.pointers;
                var pointersLength = pointers.length;
                if (!session.firstInput) {
                    session.firstInput = simpleCloneInputData(input);
                }
                if (pointersLength > 1 && !session.firstMultiple) {
                    session.firstMultiple = simpleCloneInputData(input);
                } else if (pointersLength === 1) {
                    session.firstMultiple = false;
                }
                var firstInput = session.firstInput;
                var firstMultiple = session.firstMultiple;
                var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;
                var center = input.center = getCenter(pointers);
                input.timeStamp = now();
                input.deltaTime = input.timeStamp - firstInput.timeStamp;
                input.angle = getAngle(offsetCenter, center);
                input.distance = getDistance(offsetCenter, center);
                computeDeltaXY(session, input);
                input.offsetDirection = getDirection(input.deltaX, input.deltaY);
                var overallVelocity = getVelocity(input.deltaTime, input.deltaX, input.deltaY);
                input.overallVelocityX = overallVelocity.x;
                input.overallVelocityY = overallVelocity.y;
                input.overallVelocity = abs(overallVelocity.x) > abs(overallVelocity.y) ? overallVelocity.x : overallVelocity.y;
                input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;
                input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;
                input.maxPointers = !session.prevInput ? input.pointers.length : input.pointers.length > session.prevInput.maxPointers ? input.pointers.length : session.prevInput.maxPointers;
                computeIntervalInputData(session, input);
                var target = manager.element;
                if (hasParent(input.srcEvent.target, target)) {
                    target = input.srcEvent.target;
                }
                input.target = target;
            }
            function computeDeltaXY(session, input) {
                var center = input.center;
                var offset = session.offsetDelta || {};
                var prevDelta = session.prevDelta || {};
                var prevInput = session.prevInput || {};
                if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {
                    prevDelta = session.prevDelta = {
                        x: prevInput.deltaX || 0,
                        y: prevInput.deltaY || 0
                    };
                    offset = session.offsetDelta = {
                        x: center.x,
                        y: center.y
                    };
                }
                input.deltaX = prevDelta.x + (center.x - offset.x);
                input.deltaY = prevDelta.y + (center.y - offset.y);
            }
            function computeIntervalInputData(session, input) {
                var last = session.lastInterval || input, deltaTime = input.timeStamp - last.timeStamp, velocity, velocityX, velocityY, direction;
                if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {
                    var deltaX = input.deltaX - last.deltaX;
                    var deltaY = input.deltaY - last.deltaY;
                    var v = getVelocity(deltaTime, deltaX, deltaY);
                    velocityX = v.x;
                    velocityY = v.y;
                    velocity = abs(v.x) > abs(v.y) ? v.x : v.y;
                    direction = getDirection(deltaX, deltaY);
                    session.lastInterval = input;
                } else {
                    velocity = last.velocity;
                    velocityX = last.velocityX;
                    velocityY = last.velocityY;
                    direction = last.direction;
                }
                input.velocity = velocity;
                input.velocityX = velocityX;
                input.velocityY = velocityY;
                input.direction = direction;
            }
            function simpleCloneInputData(input) {
                var pointers = [];
                var i = 0;
                while (i < input.pointers.length) {
                    pointers[i] = {
                        clientX: round(input.pointers[i].clientX),
                        clientY: round(input.pointers[i].clientY)
                    };
                    i++;
                }
                return {
                    timeStamp: now(),
                    pointers: pointers,
                    center: getCenter(pointers),
                    deltaX: input.deltaX,
                    deltaY: input.deltaY
                };
            }
            function getCenter(pointers) {
                var pointersLength = pointers.length;
                if (pointersLength === 1) {
                    return {
                        x: round(pointers[0].clientX),
                        y: round(pointers[0].clientY)
                    };
                }
                var x = 0, y = 0, i = 0;
                while (i < pointersLength) {
                    x += pointers[i].clientX;
                    y += pointers[i].clientY;
                    i++;
                }
                return {
                    x: round(x / pointersLength),
                    y: round(y / pointersLength)
                };
            }
            function getVelocity(deltaTime, x, y) {
                return {
                    x: x / deltaTime || 0,
                    y: y / deltaTime || 0
                };
            }
            function getDirection(x, y) {
                if (x === y) {
                    return DIRECTION_NONE;
                }
                if (abs(x) >= abs(y)) {
                    return x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;
                }
                return y < 0 ? DIRECTION_UP : DIRECTION_DOWN;
            }
            function getDistance(p1, p2, props) {
                if (!props) {
                    props = PROPS_XY;
                }
                var x = p2[props[0]] - p1[props[0]], y = p2[props[1]] - p1[props[1]];
                return Math.sqrt(x * x + y * y);
            }
            function getAngle(p1, p2, props) {
                if (!props) {
                    props = PROPS_XY;
                }
                var x = p2[props[0]] - p1[props[0]], y = p2[props[1]] - p1[props[1]];
                return Math.atan2(y, x) * 180 / Math.PI;
            }
            function getRotation(start, end) {
                return getAngle(end[1], end[0], PROPS_CLIENT_XY) + getAngle(start[1], start[0], PROPS_CLIENT_XY);
            }
            function getScale(start, end) {
                return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);
            }
            var MOUSE_INPUT_MAP = {
                mousedown: INPUT_START,
                mousemove: INPUT_MOVE,
                mouseup: INPUT_END
            };
            var MOUSE_ELEMENT_EVENTS = "mousedown";
            var MOUSE_WINDOW_EVENTS = "mousemove mouseup";
            function MouseInput() {
                this.evEl = MOUSE_ELEMENT_EVENTS;
                this.evWin = MOUSE_WINDOW_EVENTS;
                this.pressed = false;
                Input.apply(this, arguments);
            }
            inherit(MouseInput, Input, {
                handler: function MEhandler(ev) {
                    var eventType = MOUSE_INPUT_MAP[ev.type];
                    if (eventType & INPUT_START && ev.button === 0) {
                        this.pressed = true;
                    }
                    if (eventType & INPUT_MOVE && ev.which !== 1) {
                        eventType = INPUT_END;
                    }
                    if (!this.pressed) {
                        return;
                    }
                    if (eventType & INPUT_END) {
                        this.pressed = false;
                    }
                    this.callback(this.manager, eventType, {
                        pointers: [ ev ],
                        changedPointers: [ ev ],
                        pointerType: INPUT_TYPE_MOUSE,
                        srcEvent: ev
                    });
                }
            });
            var POINTER_INPUT_MAP = {
                pointerdown: INPUT_START,
                pointermove: INPUT_MOVE,
                pointerup: INPUT_END,
                pointercancel: INPUT_CANCEL,
                pointerout: INPUT_CANCEL
            };
            var IE10_POINTER_TYPE_ENUM = {
                2: INPUT_TYPE_TOUCH,
                3: INPUT_TYPE_PEN,
                4: INPUT_TYPE_MOUSE,
                5: INPUT_TYPE_KINECT
            };
            var POINTER_ELEMENT_EVENTS = "pointerdown";
            var POINTER_WINDOW_EVENTS = "pointermove pointerup pointercancel";
            if (window.MSPointerEvent && !window.PointerEvent) {
                POINTER_ELEMENT_EVENTS = "MSPointerDown";
                POINTER_WINDOW_EVENTS = "MSPointerMove MSPointerUp MSPointerCancel";
            }
            function PointerEventInput() {
                this.evEl = POINTER_ELEMENT_EVENTS;
                this.evWin = POINTER_WINDOW_EVENTS;
                Input.apply(this, arguments);
                this.store = this.manager.session.pointerEvents = [];
            }
            inherit(PointerEventInput, Input, {
                handler: function PEhandler(ev) {
                    var store = this.store;
                    var removePointer = false;
                    var eventTypeNormalized = ev.type.toLowerCase().replace("ms", "");
                    var eventType = POINTER_INPUT_MAP[eventTypeNormalized];
                    var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;
                    var isTouch = pointerType == INPUT_TYPE_TOUCH;
                    var storeIndex = inArray(store, ev.pointerId, "pointerId");
                    if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {
                        if (storeIndex < 0) {
                            store.push(ev);
                            storeIndex = store.length - 1;
                        }
                    } else if (eventType & (INPUT_END | INPUT_CANCEL)) {
                        removePointer = true;
                    }
                    if (storeIndex < 0) {
                        return;
                    }
                    store[storeIndex] = ev;
                    this.callback(this.manager, eventType, {
                        pointers: store,
                        changedPointers: [ ev ],
                        pointerType: pointerType,
                        srcEvent: ev
                    });
                    if (removePointer) {
                        store.splice(storeIndex, 1);
                    }
                }
            });
            var SINGLE_TOUCH_INPUT_MAP = {
                touchstart: INPUT_START,
                touchmove: INPUT_MOVE,
                touchend: INPUT_END,
                touchcancel: INPUT_CANCEL
            };
            var SINGLE_TOUCH_TARGET_EVENTS = "touchstart";
            var SINGLE_TOUCH_WINDOW_EVENTS = "touchstart touchmove touchend touchcancel";
            function SingleTouchInput() {
                this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;
                this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;
                this.started = false;
                Input.apply(this, arguments);
            }
            inherit(SingleTouchInput, Input, {
                handler: function TEhandler(ev) {
                    var type = SINGLE_TOUCH_INPUT_MAP[ev.type];
                    if (type === INPUT_START) {
                        this.started = true;
                    }
                    if (!this.started) {
                        return;
                    }
                    var touches = normalizeSingleTouches.call(this, ev, type);
                    if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {
                        this.started = false;
                    }
                    this.callback(this.manager, type, {
                        pointers: touches[0],
                        changedPointers: touches[1],
                        pointerType: INPUT_TYPE_TOUCH,
                        srcEvent: ev
                    });
                }
            });
            function normalizeSingleTouches(ev, type) {
                var all = toArray(ev.touches);
                var changed = toArray(ev.changedTouches);
                if (type & (INPUT_END | INPUT_CANCEL)) {
                    all = uniqueArray(all.concat(changed), "identifier", true);
                }
                return [ all, changed ];
            }
            var TOUCH_INPUT_MAP = {
                touchstart: INPUT_START,
                touchmove: INPUT_MOVE,
                touchend: INPUT_END,
                touchcancel: INPUT_CANCEL
            };
            var TOUCH_TARGET_EVENTS = "touchstart touchmove touchend touchcancel";
            function TouchInput() {
                this.evTarget = TOUCH_TARGET_EVENTS;
                this.targetIds = {};
                Input.apply(this, arguments);
            }
            inherit(TouchInput, Input, {
                handler: function MTEhandler(ev) {
                    var type = TOUCH_INPUT_MAP[ev.type];
                    var touches = getTouches.call(this, ev, type);
                    if (!touches) {
                        return;
                    }
                    this.callback(this.manager, type, {
                        pointers: touches[0],
                        changedPointers: touches[1],
                        pointerType: INPUT_TYPE_TOUCH,
                        srcEvent: ev
                    });
                }
            });
            function getTouches(ev, type) {
                var allTouches = toArray(ev.touches);
                var targetIds = this.targetIds;
                if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {
                    targetIds[allTouches[0].identifier] = true;
                    return [ allTouches, allTouches ];
                }
                var i, targetTouches, changedTouches = toArray(ev.changedTouches), changedTargetTouches = [], target = this.target;
                targetTouches = allTouches.filter(function(touch) {
                    return hasParent(touch.target, target);
                });
                if (type === INPUT_START) {
                    i = 0;
                    while (i < targetTouches.length) {
                        targetIds[targetTouches[i].identifier] = true;
                        i++;
                    }
                }
                i = 0;
                while (i < changedTouches.length) {
                    if (targetIds[changedTouches[i].identifier]) {
                        changedTargetTouches.push(changedTouches[i]);
                    }
                    if (type & (INPUT_END | INPUT_CANCEL)) {
                        delete targetIds[changedTouches[i].identifier];
                    }
                    i++;
                }
                if (!changedTargetTouches.length) {
                    return;
                }
                return [ uniqueArray(targetTouches.concat(changedTargetTouches), "identifier", true), changedTargetTouches ];
            }
            var DEDUP_TIMEOUT = 2500;
            var DEDUP_DISTANCE = 25;
            function TouchMouseInput() {
                Input.apply(this, arguments);
                var handler = bindFn(this.handler, this);
                this.touch = new TouchInput(this.manager, handler);
                this.mouse = new MouseInput(this.manager, handler);
                this.primaryTouch = null;
                this.lastTouches = [];
            }
            inherit(TouchMouseInput, Input, {
                handler: function TMEhandler(manager, inputEvent, inputData) {
                    var isTouch = inputData.pointerType == INPUT_TYPE_TOUCH, isMouse = inputData.pointerType == INPUT_TYPE_MOUSE;
                    if (isMouse && inputData.sourceCapabilities && inputData.sourceCapabilities.firesTouchEvents) {
                        return;
                    }
                    if (isTouch) {
                        recordTouches.call(this, inputEvent, inputData);
                    } else if (isMouse && isSyntheticEvent.call(this, inputData)) {
                        return;
                    }
                    this.callback(manager, inputEvent, inputData);
                },
                destroy: function destroy() {
                    this.touch.destroy();
                    this.mouse.destroy();
                }
            });
            function recordTouches(eventType, eventData) {
                if (eventType & INPUT_START) {
                    this.primaryTouch = eventData.changedPointers[0].identifier;
                    setLastTouch.call(this, eventData);
                } else if (eventType & (INPUT_END | INPUT_CANCEL)) {
                    setLastTouch.call(this, eventData);
                }
            }
            function setLastTouch(eventData) {
                var touch = eventData.changedPointers[0];
                if (touch.identifier === this.primaryTouch) {
                    var lastTouch = {
                        x: touch.clientX,
                        y: touch.clientY
                    };
                    this.lastTouches.push(lastTouch);
                    var lts = this.lastTouches;
                    var removeLastTouch = function() {
                        var i = lts.indexOf(lastTouch);
                        if (i > -1) {
                            lts.splice(i, 1);
                        }
                    };
                    setTimeout(removeLastTouch, DEDUP_TIMEOUT);
                }
            }
            function isSyntheticEvent(eventData) {
                var x = eventData.srcEvent.clientX, y = eventData.srcEvent.clientY;
                for (var i = 0; i < this.lastTouches.length; i++) {
                    var t = this.lastTouches[i];
                    var dx = Math.abs(x - t.x), dy = Math.abs(y - t.y);
                    if (dx <= DEDUP_DISTANCE && dy <= DEDUP_DISTANCE) {
                        return true;
                    }
                }
                return false;
            }
            var PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, "touchAction");
            var NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;
            var TOUCH_ACTION_COMPUTE = "compute";
            var TOUCH_ACTION_AUTO = "auto";
            var TOUCH_ACTION_MANIPULATION = "manipulation";
            var TOUCH_ACTION_NONE = "none";
            var TOUCH_ACTION_PAN_X = "pan-x";
            var TOUCH_ACTION_PAN_Y = "pan-y";
            var TOUCH_ACTION_MAP = getTouchActionProps();
            function TouchAction(manager, value) {
                this.manager = manager;
                this.set(value);
            }
            TouchAction.prototype = {
                set: function(value) {
                    if (value == TOUCH_ACTION_COMPUTE) {
                        value = this.compute();
                    }
                    if (NATIVE_TOUCH_ACTION && this.manager.element.style && TOUCH_ACTION_MAP[value]) {
                        this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;
                    }
                    this.actions = value.toLowerCase().trim();
                },
                update: function() {
                    this.set(this.manager.options.touchAction);
                },
                compute: function() {
                    var actions = [];
                    each(this.manager.recognizers, function(recognizer) {
                        if (boolOrFn(recognizer.options.enable, [ recognizer ])) {
                            actions = actions.concat(recognizer.getTouchAction());
                        }
                    });
                    return cleanTouchActions(actions.join(" "));
                },
                preventDefaults: function(input) {
                    var srcEvent = input.srcEvent;
                    var direction = input.offsetDirection;
                    if (this.manager.session.prevented) {
                        srcEvent.preventDefault();
                        return;
                    }
                    var actions = this.actions;
                    var hasNone = inStr(actions, TOUCH_ACTION_NONE) && !TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];
                    var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];
                    var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];
                    if (hasNone) {
                        var isTapPointer = input.pointers.length === 1;
                        var isTapMovement = input.distance < 2;
                        var isTapTouchTime = input.deltaTime < 250;
                        if (isTapPointer && isTapMovement && isTapTouchTime) {
                            return;
                        }
                    }
                    if (hasPanX && hasPanY) {
                        return;
                    }
                    if (hasNone || hasPanY && direction & DIRECTION_HORIZONTAL || hasPanX && direction & DIRECTION_VERTICAL) {
                        return this.preventSrc(srcEvent);
                    }
                },
                preventSrc: function(srcEvent) {
                    this.manager.session.prevented = true;
                    srcEvent.preventDefault();
                }
            };
            function cleanTouchActions(actions) {
                if (inStr(actions, TOUCH_ACTION_NONE)) {
                    return TOUCH_ACTION_NONE;
                }
                var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);
                var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);
                if (hasPanX && hasPanY) {
                    return TOUCH_ACTION_NONE;
                }
                if (hasPanX || hasPanY) {
                    return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;
                }
                if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {
                    return TOUCH_ACTION_MANIPULATION;
                }
                return TOUCH_ACTION_AUTO;
            }
            function getTouchActionProps() {
                if (!NATIVE_TOUCH_ACTION) {
                    return false;
                }
                var touchMap = {};
                var cssSupports = window.CSS && window.CSS.supports;
                [ "auto", "manipulation", "pan-y", "pan-x", "pan-x pan-y", "none" ].forEach(function(val) {
                    touchMap[val] = cssSupports ? window.CSS.supports("touch-action", val) : true;
                });
                return touchMap;
            }
            var STATE_POSSIBLE = 1;
            var STATE_BEGAN = 2;
            var STATE_CHANGED = 4;
            var STATE_ENDED = 8;
            var STATE_RECOGNIZED = STATE_ENDED;
            var STATE_CANCELLED = 16;
            var STATE_FAILED = 32;
            function Recognizer(options) {
                this.options = assign({}, this.defaults, options || {});
                this.id = uniqueId();
                this.manager = null;
                this.options.enable = ifUndefined(this.options.enable, true);
                this.state = STATE_POSSIBLE;
                this.simultaneous = {};
                this.requireFail = [];
            }
            Recognizer.prototype = {
                defaults: {},
                set: function(options) {
                    assign(this.options, options);
                    this.manager && this.manager.touchAction.update();
                    return this;
                },
                recognizeWith: function(otherRecognizer) {
                    if (invokeArrayArg(otherRecognizer, "recognizeWith", this)) {
                        return this;
                    }
                    var simultaneous = this.simultaneous;
                    otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
                    if (!simultaneous[otherRecognizer.id]) {
                        simultaneous[otherRecognizer.id] = otherRecognizer;
                        otherRecognizer.recognizeWith(this);
                    }
                    return this;
                },
                dropRecognizeWith: function(otherRecognizer) {
                    if (invokeArrayArg(otherRecognizer, "dropRecognizeWith", this)) {
                        return this;
                    }
                    otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
                    delete this.simultaneous[otherRecognizer.id];
                    return this;
                },
                requireFailure: function(otherRecognizer) {
                    if (invokeArrayArg(otherRecognizer, "requireFailure", this)) {
                        return this;
                    }
                    var requireFail = this.requireFail;
                    otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
                    if (inArray(requireFail, otherRecognizer) === -1) {
                        requireFail.push(otherRecognizer);
                        otherRecognizer.requireFailure(this);
                    }
                    return this;
                },
                dropRequireFailure: function(otherRecognizer) {
                    if (invokeArrayArg(otherRecognizer, "dropRequireFailure", this)) {
                        return this;
                    }
                    otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
                    var index = inArray(this.requireFail, otherRecognizer);
                    if (index > -1) {
                        this.requireFail.splice(index, 1);
                    }
                    return this;
                },
                hasRequireFailures: function() {
                    return this.requireFail.length > 0;
                },
                canRecognizeWith: function(otherRecognizer) {
                    return !!this.simultaneous[otherRecognizer.id];
                },
                emit: function(input) {
                    var self = this;
                    var state = this.state;
                    function emit(event) {
                        self.manager.emit(event, input);
                    }
                    if (state < STATE_ENDED) {
                        emit(self.options.event + stateStr(state));
                    }
                    emit(self.options.event);
                    if (input.additionalEvent) {
                        emit(input.additionalEvent);
                    }
                    if (state >= STATE_ENDED) {
                        emit(self.options.event + stateStr(state));
                    }
                },
                tryEmit: function(input) {
                    if (this.canEmit()) {
                        return this.emit(input);
                    }
                    this.state = STATE_FAILED;
                },
                canEmit: function() {
                    var i = 0;
                    while (i < this.requireFail.length) {
                        if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {
                            return false;
                        }
                        i++;
                    }
                    return true;
                },
                recognize: function(inputData) {
                    var inputDataClone = assign({}, inputData);
                    if (!boolOrFn(this.options.enable, [ this, inputDataClone ])) {
                        this.reset();
                        this.state = STATE_FAILED;
                        return;
                    }
                    if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {
                        this.state = STATE_POSSIBLE;
                    }
                    this.state = this.process(inputDataClone);
                    if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {
                        this.tryEmit(inputDataClone);
                    }
                },
                process: function(inputData) {},
                getTouchAction: function() {},
                reset: function() {}
            };
            function stateStr(state) {
                if (state & STATE_CANCELLED) {
                    return "cancel";
                } else if (state & STATE_ENDED) {
                    return "end";
                } else if (state & STATE_CHANGED) {
                    return "move";
                } else if (state & STATE_BEGAN) {
                    return "start";
                }
                return "";
            }
            function directionStr(direction) {
                if (direction == DIRECTION_DOWN) {
                    return "down";
                } else if (direction == DIRECTION_UP) {
                    return "up";
                } else if (direction == DIRECTION_LEFT) {
                    return "left";
                } else if (direction == DIRECTION_RIGHT) {
                    return "right";
                }
                return "";
            }
            function getRecognizerByNameIfManager(otherRecognizer, recognizer) {
                var manager = recognizer.manager;
                if (manager) {
                    return manager.get(otherRecognizer);
                }
                return otherRecognizer;
            }
            function AttrRecognizer() {
                Recognizer.apply(this, arguments);
            }
            inherit(AttrRecognizer, Recognizer, {
                defaults: {
                    pointers: 1
                },
                attrTest: function(input) {
                    var optionPointers = this.options.pointers;
                    return optionPointers === 0 || input.pointers.length === optionPointers;
                },
                process: function(input) {
                    var state = this.state;
                    var eventType = input.eventType;
                    var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);
                    var isValid = this.attrTest(input);
                    if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {
                        return state | STATE_CANCELLED;
                    } else if (isRecognized || isValid) {
                        if (eventType & INPUT_END) {
                            return state | STATE_ENDED;
                        } else if (!(state & STATE_BEGAN)) {
                            return STATE_BEGAN;
                        }
                        return state | STATE_CHANGED;
                    }
                    return STATE_FAILED;
                }
            });
            function PanRecognizer() {
                AttrRecognizer.apply(this, arguments);
                this.pX = null;
                this.pY = null;
            }
            inherit(PanRecognizer, AttrRecognizer, {
                defaults: {
                    event: "pan",
                    threshold: 10,
                    pointers: 1,
                    direction: DIRECTION_ALL
                },
                getTouchAction: function() {
                    var direction = this.options.direction;
                    var actions = [];
                    if (direction & DIRECTION_HORIZONTAL) {
                        actions.push(TOUCH_ACTION_PAN_Y);
                    }
                    if (direction & DIRECTION_VERTICAL) {
                        actions.push(TOUCH_ACTION_PAN_X);
                    }
                    return actions;
                },
                directionTest: function(input) {
                    var options = this.options;
                    var hasMoved = true;
                    var distance = input.distance;
                    var direction = input.direction;
                    var x = input.deltaX;
                    var y = input.deltaY;
                    if (!(direction & options.direction)) {
                        if (options.direction & DIRECTION_HORIZONTAL) {
                            direction = x === 0 ? DIRECTION_NONE : x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;
                            hasMoved = x != this.pX;
                            distance = Math.abs(input.deltaX);
                        } else {
                            direction = y === 0 ? DIRECTION_NONE : y < 0 ? DIRECTION_UP : DIRECTION_DOWN;
                            hasMoved = y != this.pY;
                            distance = Math.abs(input.deltaY);
                        }
                    }
                    input.direction = direction;
                    return hasMoved && distance > options.threshold && direction & options.direction;
                },
                attrTest: function(input) {
                    return AttrRecognizer.prototype.attrTest.call(this, input) && (this.state & STATE_BEGAN || !(this.state & STATE_BEGAN) && this.directionTest(input));
                },
                emit: function(input) {
                    this.pX = input.deltaX;
                    this.pY = input.deltaY;
                    var direction = directionStr(input.direction);
                    if (direction) {
                        input.additionalEvent = this.options.event + direction;
                    }
                    this._super.emit.call(this, input);
                }
            });
            function PinchRecognizer() {
                AttrRecognizer.apply(this, arguments);
            }
            inherit(PinchRecognizer, AttrRecognizer, {
                defaults: {
                    event: "pinch",
                    threshold: 0,
                    pointers: 2
                },
                getTouchAction: function() {
                    return [ TOUCH_ACTION_NONE ];
                },
                attrTest: function(input) {
                    return this._super.attrTest.call(this, input) && (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);
                },
                emit: function(input) {
                    if (input.scale !== 1) {
                        var inOut = input.scale < 1 ? "in" : "out";
                        input.additionalEvent = this.options.event + inOut;
                    }
                    this._super.emit.call(this, input);
                }
            });
            function PressRecognizer() {
                Recognizer.apply(this, arguments);
                this._timer = null;
                this._input = null;
            }
            inherit(PressRecognizer, Recognizer, {
                defaults: {
                    event: "press",
                    pointers: 1,
                    time: 251,
                    threshold: 9
                },
                getTouchAction: function() {
                    return [ TOUCH_ACTION_AUTO ];
                },
                process: function(input) {
                    var options = this.options;
                    var validPointers = input.pointers.length === options.pointers;
                    var validMovement = input.distance < options.threshold;
                    var validTime = input.deltaTime > options.time;
                    this._input = input;
                    if (!validMovement || !validPointers || input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime) {
                        this.reset();
                    } else if (input.eventType & INPUT_START) {
                        this.reset();
                        this._timer = setTimeoutContext(function() {
                            this.state = STATE_RECOGNIZED;
                            this.tryEmit();
                        }, options.time, this);
                    } else if (input.eventType & INPUT_END) {
                        return STATE_RECOGNIZED;
                    }
                    return STATE_FAILED;
                },
                reset: function() {
                    clearTimeout(this._timer);
                },
                emit: function(input) {
                    if (this.state !== STATE_RECOGNIZED) {
                        return;
                    }
                    if (input && input.eventType & INPUT_END) {
                        this.manager.emit(this.options.event + "up", input);
                    } else {
                        this._input.timeStamp = now();
                        this.manager.emit(this.options.event, this._input);
                    }
                }
            });
            function RotateRecognizer() {
                AttrRecognizer.apply(this, arguments);
            }
            inherit(RotateRecognizer, AttrRecognizer, {
                defaults: {
                    event: "rotate",
                    threshold: 0,
                    pointers: 2
                },
                getTouchAction: function() {
                    return [ TOUCH_ACTION_NONE ];
                },
                attrTest: function(input) {
                    return this._super.attrTest.call(this, input) && (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);
                }
            });
            function SwipeRecognizer() {
                AttrRecognizer.apply(this, arguments);
            }
            inherit(SwipeRecognizer, AttrRecognizer, {
                defaults: {
                    event: "swipe",
                    threshold: 10,
                    velocity: .3,
                    direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,
                    pointers: 1
                },
                getTouchAction: function() {
                    return PanRecognizer.prototype.getTouchAction.call(this);
                },
                attrTest: function(input) {
                    var direction = this.options.direction;
                    var velocity;
                    if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {
                        velocity = input.overallVelocity;
                    } else if (direction & DIRECTION_HORIZONTAL) {
                        velocity = input.overallVelocityX;
                    } else if (direction & DIRECTION_VERTICAL) {
                        velocity = input.overallVelocityY;
                    }
                    return this._super.attrTest.call(this, input) && direction & input.offsetDirection && input.distance > this.options.threshold && input.maxPointers == this.options.pointers && abs(velocity) > this.options.velocity && input.eventType & INPUT_END;
                },
                emit: function(input) {
                    var direction = directionStr(input.offsetDirection);
                    if (direction) {
                        this.manager.emit(this.options.event + direction, input);
                    }
                    this.manager.emit(this.options.event, input);
                }
            });
            function TapRecognizer() {
                Recognizer.apply(this, arguments);
                this.pTime = false;
                this.pCenter = false;
                this._timer = null;
                this._input = null;
                this.count = 0;
            }
            inherit(TapRecognizer, Recognizer, {
                defaults: {
                    event: "tap",
                    pointers: 1,
                    taps: 1,
                    interval: 300,
                    time: 250,
                    threshold: 9,
                    posThreshold: 10
                },
                getTouchAction: function() {
                    return [ TOUCH_ACTION_MANIPULATION ];
                },
                process: function(input) {
                    var options = this.options;
                    var validPointers = input.pointers.length === options.pointers;
                    var validMovement = input.distance < options.threshold;
                    var validTouchTime = input.deltaTime < options.time;
                    this.reset();
                    if (input.eventType & INPUT_START && this.count === 0) {
                        return this.failTimeout();
                    }
                    if (validMovement && validTouchTime && validPointers) {
                        if (input.eventType != INPUT_END) {
                            return this.failTimeout();
                        }
                        var validInterval = this.pTime ? input.timeStamp - this.pTime < options.interval : true;
                        var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;
                        this.pTime = input.timeStamp;
                        this.pCenter = input.center;
                        if (!validMultiTap || !validInterval) {
                            this.count = 1;
                        } else {
                            this.count += 1;
                        }
                        this._input = input;
                        var tapCount = this.count % options.taps;
                        if (tapCount === 0) {
                            if (!this.hasRequireFailures()) {
                                return STATE_RECOGNIZED;
                            } else {
                                this._timer = setTimeoutContext(function() {
                                    this.state = STATE_RECOGNIZED;
                                    this.tryEmit();
                                }, options.interval, this);
                                return STATE_BEGAN;
                            }
                        }
                    }
                    return STATE_FAILED;
                },
                failTimeout: function() {
                    this._timer = setTimeoutContext(function() {
                        this.state = STATE_FAILED;
                    }, this.options.interval, this);
                    return STATE_FAILED;
                },
                reset: function() {
                    clearTimeout(this._timer);
                },
                emit: function() {
                    if (this.state == STATE_RECOGNIZED) {
                        this._input.tapCount = this.count;
                        this.manager.emit(this.options.event, this._input);
                    }
                }
            });
            function Hammer(element, options) {
                options = options || {};
                options.recognizers = ifUndefined(options.recognizers, Hammer.defaults.preset);
                return new Manager(element, options);
            }
            Hammer.VERSION = "2.0.7";
            Hammer.defaults = {
                domEvents: false,
                touchAction: TOUCH_ACTION_COMPUTE,
                enable: true,
                inputTarget: null,
                inputClass: null,
                preset: [ [ RotateRecognizer, {
                    enable: false
                } ], [ PinchRecognizer, {
                    enable: false
                }, [ "rotate" ] ], [ SwipeRecognizer, {
                    direction: DIRECTION_HORIZONTAL
                } ], [ PanRecognizer, {
                    direction: DIRECTION_HORIZONTAL
                }, [ "swipe" ] ], [ TapRecognizer ], [ TapRecognizer, {
                    event: "doubletap",
                    taps: 2
                }, [ "tap" ] ], [ PressRecognizer ] ],
                cssProps: {
                    userSelect: "none",
                    touchSelect: "none",
                    touchCallout: "none",
                    contentZooming: "none",
                    userDrag: "none",
                    tapHighlightColor: "rgba(0,0,0,0)"
                }
            };
            var STOP = 1;
            var FORCED_STOP = 2;
            function Manager(element, options) {
                this.options = assign({}, Hammer.defaults, options || {});
                this.options.inputTarget = this.options.inputTarget || element;
                this.handlers = {};
                this.session = {};
                this.recognizers = [];
                this.oldCssProps = {};
                this.element = element;
                this.input = createInputInstance(this);
                this.touchAction = new TouchAction(this, this.options.touchAction);
                toggleCssProps(this, true);
                each(this.options.recognizers, function(item) {
                    var recognizer = this.add(new item[0](item[1]));
                    item[2] && recognizer.recognizeWith(item[2]);
                    item[3] && recognizer.requireFailure(item[3]);
                }, this);
            }
            Manager.prototype = {
                set: function(options) {
                    assign(this.options, options);
                    if (options.touchAction) {
                        this.touchAction.update();
                    }
                    if (options.inputTarget) {
                        this.input.destroy();
                        this.input.target = options.inputTarget;
                        this.input.init();
                    }
                    return this;
                },
                stop: function(force) {
                    this.session.stopped = force ? FORCED_STOP : STOP;
                },
                recognize: function(inputData) {
                    var session = this.session;
                    if (session.stopped) {
                        return;
                    }
                    this.touchAction.preventDefaults(inputData);
                    var recognizer;
                    var recognizers = this.recognizers;
                    var curRecognizer = session.curRecognizer;
                    if (!curRecognizer || curRecognizer && curRecognizer.state & STATE_RECOGNIZED) {
                        curRecognizer = session.curRecognizer = null;
                    }
                    var i = 0;
                    while (i < recognizers.length) {
                        recognizer = recognizers[i];
                        if (session.stopped !== FORCED_STOP && (!curRecognizer || recognizer == curRecognizer || recognizer.canRecognizeWith(curRecognizer))) {
                            recognizer.recognize(inputData);
                        } else {
                            recognizer.reset();
                        }
                        if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {
                            curRecognizer = session.curRecognizer = recognizer;
                        }
                        i++;
                    }
                },
                get: function(recognizer) {
                    if (recognizer instanceof Recognizer) {
                        return recognizer;
                    }
                    var recognizers = this.recognizers;
                    for (var i = 0; i < recognizers.length; i++) {
                        if (recognizers[i].options.event == recognizer) {
                            return recognizers[i];
                        }
                    }
                    return null;
                },
                add: function(recognizer) {
                    if (invokeArrayArg(recognizer, "add", this)) {
                        return this;
                    }
                    var existing = this.get(recognizer.options.event);
                    if (existing) {
                        this.remove(existing);
                    }
                    this.recognizers.push(recognizer);
                    recognizer.manager = this;
                    this.touchAction.update();
                    return recognizer;
                },
                remove: function(recognizer) {
                    if (invokeArrayArg(recognizer, "remove", this)) {
                        return this;
                    }
                    recognizer = this.get(recognizer);
                    if (recognizer) {
                        var recognizers = this.recognizers;
                        var index = inArray(recognizers, recognizer);
                        if (index !== -1) {
                            recognizers.splice(index, 1);
                            this.touchAction.update();
                        }
                    }
                    return this;
                },
                on: function(events, handler) {
                    if (events === undefined) {
                        return;
                    }
                    if (handler === undefined) {
                        return;
                    }
                    var handlers = this.handlers;
                    each(splitStr(events), function(event) {
                        handlers[event] = handlers[event] || [];
                        handlers[event].push(handler);
                    });
                    return this;
                },
                off: function(events, handler) {
                    if (events === undefined) {
                        return;
                    }
                    var handlers = this.handlers;
                    each(splitStr(events), function(event) {
                        if (!handler) {
                            delete handlers[event];
                        } else {
                            handlers[event] && handlers[event].splice(inArray(handlers[event], handler), 1);
                        }
                    });
                    return this;
                },
                emit: function(event, data) {
                    if (this.options.domEvents) {
                        triggerDomEvent(event, data);
                    }
                    var handlers = this.handlers[event] && this.handlers[event].slice();
                    if (!handlers || !handlers.length) {
                        return;
                    }
                    data.type = event;
                    data.preventDefault = function() {
                        data.srcEvent.preventDefault();
                    };
                    var i = 0;
                    while (i < handlers.length) {
                        handlers[i](data);
                        i++;
                    }
                },
                destroy: function() {
                    this.element && toggleCssProps(this, false);
                    this.handlers = {};
                    this.session = {};
                    this.input.destroy();
                    this.element = null;
                }
            };
            function toggleCssProps(manager, add) {
                var element = manager.element;
                if (!element.style) {
                    return;
                }
                var prop;
                each(manager.options.cssProps, function(value, name) {
                    prop = prefixed(element.style, name);
                    if (add) {
                        manager.oldCssProps[prop] = element.style[prop];
                        element.style[prop] = value;
                    } else {
                        element.style[prop] = manager.oldCssProps[prop] || "";
                    }
                });
                if (!add) {
                    manager.oldCssProps = {};
                }
            }
            function triggerDomEvent(event, data) {
                var gestureEvent = document.createEvent("Event");
                gestureEvent.initEvent(event, true, true);
                gestureEvent.gesture = data;
                data.target.dispatchEvent(gestureEvent);
            }
            assign(Hammer, {
                INPUT_START: INPUT_START,
                INPUT_MOVE: INPUT_MOVE,
                INPUT_END: INPUT_END,
                INPUT_CANCEL: INPUT_CANCEL,
                STATE_POSSIBLE: STATE_POSSIBLE,
                STATE_BEGAN: STATE_BEGAN,
                STATE_CHANGED: STATE_CHANGED,
                STATE_ENDED: STATE_ENDED,
                STATE_RECOGNIZED: STATE_RECOGNIZED,
                STATE_CANCELLED: STATE_CANCELLED,
                STATE_FAILED: STATE_FAILED,
                DIRECTION_NONE: DIRECTION_NONE,
                DIRECTION_LEFT: DIRECTION_LEFT,
                DIRECTION_RIGHT: DIRECTION_RIGHT,
                DIRECTION_UP: DIRECTION_UP,
                DIRECTION_DOWN: DIRECTION_DOWN,
                DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,
                DIRECTION_VERTICAL: DIRECTION_VERTICAL,
                DIRECTION_ALL: DIRECTION_ALL,
                Manager: Manager,
                Input: Input,
                TouchAction: TouchAction,
                TouchInput: TouchInput,
                MouseInput: MouseInput,
                PointerEventInput: PointerEventInput,
                TouchMouseInput: TouchMouseInput,
                SingleTouchInput: SingleTouchInput,
                Recognizer: Recognizer,
                AttrRecognizer: AttrRecognizer,
                Tap: TapRecognizer,
                Pan: PanRecognizer,
                Swipe: SwipeRecognizer,
                Pinch: PinchRecognizer,
                Rotate: RotateRecognizer,
                Press: PressRecognizer,
                on: addEventListeners,
                off: removeEventListeners,
                each: each,
                merge: merge,
                extend: extend,
                assign: assign,
                inherit: inherit,
                bindFn: bindFn,
                prefixed: prefixed
            });
            var freeGlobal = typeof window !== "undefined" ? window : typeof self !== "undefined" ? self : {};
            freeGlobal.Hammer = Hammer;
            if (typeof define === "function" && define.amd) {
                define(function() {
                    return Hammer;
                });
            } else if (typeof module != "undefined" && module.exports) {
                module.exports = Hammer;
            } else {
                window[exportName] = Hammer;
            }
        })(window, document, "Hammer");
    }, {} ],
    22: [ function(require, module, exports) {
        "use strict";
        var types = [ require("./nextTick"), require("./mutation.js"), require("./messageChannel"), require("./stateChange"), require("./timeout") ];
        var draining;
        var currentQueue;
        var queueIndex = -1;
        var queue = [];
        var scheduled = false;
        function cleanUpNextTick() {
            if (!draining || !currentQueue) {
                return;
            }
            draining = false;
            if (currentQueue.length) {
                queue = currentQueue.concat(queue);
            } else {
                queueIndex = -1;
            }
            if (queue.length) {
                nextTick();
            }
        }
        function nextTick() {
            if (draining) {
                return;
            }
            scheduled = false;
            draining = true;
            var len = queue.length;
            var timeout = setTimeout(cleanUpNextTick);
            while (len) {
                currentQueue = queue;
                queue = [];
                while (currentQueue && ++queueIndex < len) {
                    currentQueue[queueIndex].run();
                }
                queueIndex = -1;
                len = queue.length;
            }
            currentQueue = null;
            queueIndex = -1;
            draining = false;
            clearTimeout(timeout);
        }
        var scheduleDrain;
        var i = -1;
        var len = types.length;
        while (++i < len) {
            if (types[i] && types[i].test && types[i].test()) {
                scheduleDrain = types[i].install(nextTick);
                break;
            }
        }
        function Item(fun, array) {
            this.fun = fun;
            this.array = array;
        }
        Item.prototype.run = function() {
            var fun = this.fun;
            var array = this.array;
            switch (array.length) {
              case 0:
                return fun();

              case 1:
                return fun(array[0]);

              case 2:
                return fun(array[0], array[1]);

              case 3:
                return fun(array[0], array[1], array[2]);

              default:
                return fun.apply(null, array);
            }
        };
        module.exports = immediate;
        function immediate(task) {
            var args = new Array(arguments.length - 1);
            if (arguments.length > 1) {
                for (var i = 1; i < arguments.length; i++) {
                    args[i - 1] = arguments[i];
                }
            }
            queue.push(new Item(task, args));
            if (!scheduled && !draining) {
                scheduled = true;
                scheduleDrain();
            }
        }
    }, {
        "./messageChannel": 23,
        "./mutation.js": 24,
        "./nextTick": 25,
        "./stateChange": 26,
        "./timeout": 27
    } ],
    23: [ function(require, module, exports) {
        (function(global) {
            "use strict";
            exports.test = function() {
                if (global.setImmediate) {
                    return false;
                }
                return typeof global.MessageChannel !== "undefined";
            };
            exports.install = function(func) {
                var channel = new global.MessageChannel();
                channel.port1.onmessage = func;
                return function() {
                    channel.port2.postMessage(0);
                };
            };
        }).call(this, typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {});
    }, {} ],
    24: [ function(require, module, exports) {
        (function(global) {
            "use strict";
            var Mutation = global.MutationObserver || global.WebKitMutationObserver;
            exports.test = function() {
                return Mutation;
            };
            exports.install = function(handle) {
                var called = 0;
                var observer = new Mutation(handle);
                var element = global.document.createTextNode("");
                observer.observe(element, {
                    characterData: true
                });
                return function() {
                    element.data = called = ++called % 2;
                };
            };
        }).call(this, typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {});
    }, {} ],
    25: [ function(require, module, exports) {
        (function(process) {
            "use strict";
            exports.test = function() {
                return typeof process !== "undefined" && !process.browser;
            };
            exports.install = function(func) {
                return function() {
                    process.nextTick(func);
                };
            };
        }).call(this, require("_process"));
    }, {
        _process: 256
    } ],
    26: [ function(require, module, exports) {
        (function(global) {
            "use strict";
            exports.test = function() {
                return "document" in global && "onreadystatechange" in global.document.createElement("script");
            };
            exports.install = function(handle) {
                return function() {
                    var scriptEl = global.document.createElement("script");
                    scriptEl.onreadystatechange = function() {
                        handle();
                        scriptEl.onreadystatechange = null;
                        scriptEl.parentNode.removeChild(scriptEl);
                        scriptEl = null;
                    };
                    global.document.documentElement.appendChild(scriptEl);
                    return handle;
                };
            };
        }).call(this, typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {});
    }, {} ],
    27: [ function(require, module, exports) {
        "use strict";
        exports.test = function() {
            return true;
        };
        exports.install = function(t) {
            return function() {
                setTimeout(t, 0);
            };
        };
    }, {} ],
    28: [ function(require, module, exports) {
        "use strict";
        var __importDefault = this && this.__importDefault || function(mod) {
            return mod && mod.__esModule ? mod : {
                default: mod
            };
        };
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var map_1 = __importDefault(require("ol/map"));
        var image_1 = __importDefault(require("ol/layer/image"));
        var view_1 = __importDefault(require("ol/view"));
        var extent_1 = __importDefault(require("ol/extent"));
        var overlay_1 = __importDefault(require("ol/overlay"));
        var vector_1 = __importDefault(require("ol/layer/vector"));
        var imagestatic_1 = __importDefault(require("ol/source/imagestatic"));
        var vector_2 = __importDefault(require("ol/source/vector"));
        var projection_1 = __importDefault(require("ol/proj/projection"));
        var feature_1 = __importDefault(require("ol/feature"));
        var point_1 = __importDefault(require("ol/geom/point"));
        var polygon_1 = __importDefault(require("ol/geom/polygon"));
        var style_1 = __importDefault(require("ol/style/style"));
        var icon_1 = __importDefault(require("ol/style/icon"));
        var text_1 = __importDefault(require("ol/style/text"));
        var stroke_1 = __importDefault(require("ol/style/stroke"));
        var fill_1 = __importDefault(require("ol/style/fill"));
        var interaction_1 = __importDefault(require("ol/interaction"));
        var _config;
        var map;
        var view;
        var vectorLayer;
        var imlayer;
        var imExtent;
        var imProjection;
        var attributions;
        var followingUser = false;
        var geoLocationId;
        var geoLocationLast;
        var showResidences = false;
        var MAP_Xn = 19.133691;
        var MAP_Yn = 72.916984;
        var MAP_Zn = 4189;
        var MAP_Zyn = 1655;
        var MAP_WEIGHTS_X = [ -7.769917472065843, 159.26978694839946, 244.46989575495544, -6.003894110679995, -.28864271213341297, .010398324019718075, 4.215508849724247, -.6078830146963545, -7.0400449629241395 ];
        var MAP_WEIGHTS_Y = [ 14.199431377059842, -158.80601990819815, 68.9630034040724, 5.796703402034644, 1.1348242200568706, .11891051684489184, -.2930832938484276, .1448231125788526, -5.282895700923075 ];
        function getMap(config, locations, locationSelectCallback, mapLoadedCallback) {
            _config = config;
            var features = [];
            for (var _i = 0, locations_1 = locations; _i < locations_1.length; _i++) {
                var loc = locations_1[_i];
                var pos = [ loc.pixel_x, 3575 - loc.pixel_y ];
                if (loc.parent === null) {
                    var iconFeature = new feature_1.default({
                        geometry: new point_1.default(pos),
                        loc: loc
                    });
                    features.push(iconFeature);
                }
            }
            var vectorSource = new vector_2.default({
                features: features
            });
            var vectorLayerStyle = function(feature) {
                var zoom = map.getView().getZoom();
                var loc = feature.get("loc");
                if (loc.group_id === 3 && !showResidences) {
                    return;
                }
                var font_size = zoom * 3;
                var loc_name = loc.name;
                if (loc.short_name !== "0") {
                    loc_name = loc.short_name;
                }
                var icon_color;
                if (loc.group_id === 1 || loc.group_id === 4 || loc.group_id === 12) {
                    icon_color = "blue";
                } else if (loc.group_id === 3) {
                    icon_color = "green";
                } else if (loc.group_id === 2) {
                    icon_color = "yellow";
                } else {
                    icon_color = "gray";
                }
                var text = new text_1.default({
                    offsetY: 20,
                    padding: [ 20, 20, 20, 20 ],
                    font: font_size + "px Roboto",
                    text: loc_name,
                    fill: new fill_1.default({
                        color: "#ffffff"
                    }),
                    stroke: new stroke_1.default({
                        color: "#444",
                        width: 3
                    })
                });
                var icon = new icon_1.default({
                    src: _config.markersBase + "marker_dot_" + icon_color + ".png",
                    scale: .2
                });
                var style = new style_1.default({
                    image: zoom >= 3 ? icon : undefined,
                    text: zoom >= 4 ? text : undefined
                });
                return [ style ];
            };
            vectorLayer = new vector_1.default({
                source: vectorSource,
                style: vectorLayerStyle
            });
            imExtent = [ 0, 0, 5430, 3575 ];
            imProjection = new projection_1.default({
                code: "instiMAP",
                units: "pixels",
                extent: imExtent
            });
            var staticSource = new imagestatic_1.default({
                url: config.mapMinPath,
                attributions: attributions,
                projection: imProjection,
                imageExtent: imExtent,
                imageLoadFunction: function(image, src) {
                    var img = image.getImage();
                    img.src = src;
                    img.onload = function() {
                        loadHighRes();
                        mapLoadedCallback();
                    };
                }
            });
            imlayer = new image_1.default({
                source: staticSource
            });
            var interactions = interaction_1.default.defaults({
                altShiftDragRotate: false,
                pinchRotate: false
            });
            view = new view_1.default({
                projection: imProjection,
                center: extent_1.default.getCenter(imExtent),
                zoom: 3.4,
                minZoom: 2,
                maxZoom: 5.5,
                extent: [ 300, 300, 5e3, 3e3 ]
            });
            map = new map_1.default({
                interactions: interactions,
                layers: [ imlayer, vectorLayer ],
                target: _config.map_id,
                view: view,
                controls: []
            });
            map.on("click", function(evt) {
                var pixel = evt.pixel;
                var pixelOffSet = 30;
                var pixelWithOffsetMin = [ pixel[0] - pixelOffSet, pixel[1] + pixelOffSet ];
                var pixelWithOffsetMax = [ pixel[0] + pixelOffSet, pixel[1] - pixelOffSet ];
                var XYMin = map.getCoordinateFromPixel(pixelWithOffsetMin);
                var XYMax = map.getCoordinateFromPixel(pixelWithOffsetMax);
                var ext = XYMax.concat(XYMin);
                var extentFeat = new feature_1.default(new polygon_1.default([ [ [ ext[0], ext[1] ], [ ext[0], ext[3] ], [ ext[2], ext[3] ], [ ext[2], ext[1] ], [ ext[0], ext[1] ] ] ]));
                var feature = vectorLayer.getSource().forEachFeatureIntersectingExtent(extentFeat.getGeometry().getExtent(), function(f) {
                    return f;
                });
                if (feature) {
                    var location_1 = feature.get("loc");
                    moveToLocation(location_1);
                    locationSelectCallback(location_1);
                } else {
                    moveMarker(-50, -50, false);
                    locationSelectCallback();
                }
            });
            map.on("pointermove", function(e) {
                var pixel = map.getEventPixel(e.originalEvent);
                var hit = map.hasFeatureAtPixel(pixel);
                var nativeElem = document.getElementById(_config.map_id);
                if (nativeElem != null) {
                    nativeElem.style.cursor = hit ? "pointer" : "move";
                }
            });
            map.on("pointerdrag", function() {
                followingUser = false;
            });
            return map;
        }
        exports.getMap = getMap;
        function moveToLocation(loc) {
            moveMarker(loc.pixel_x, loc.pixel_y, true);
        }
        exports.moveToLocation = moveToLocation;
        function moveMarker(x, y, center, markerid) {
            if (center === void 0) {
                center = true;
            }
            if (markerid === void 0) {
                markerid = _config.marker_id;
            }
            var pos = [ Number(x), 3575 - Number(y) ];
            var element = document.getElementById(markerid);
            var marker = new overlay_1.default({
                position: pos,
                positioning: "bottom-center",
                element: element,
                stopEvent: false,
                offset: [ 0, 0 ]
            });
            map.addOverlay(marker);
            if (center) {
                view.animate({
                    center: pos
                });
                view.animate({
                    zoom: 4.5
                });
            }
        }
        exports.moveMarker = moveMarker;
        function setResidencesVisible(visible) {
            showResidences = visible;
            vectorLayer.getSource().changed();
        }
        exports.setResidencesVisible = setResidencesVisible;
        function loadHighRes() {
            var highResSource = new imagestatic_1.default({
                url: _config.mapPath,
                attributions: attributions,
                projection: imProjection,
                imageExtent: imExtent
            });
            var highRes = new Image();
            highRes.src = _config.mapPath;
            highRes.onload = function() {
                imlayer.setSource(highResSource);
            };
        }
        function hasGeolocation() {
            return navigator.geolocation ? true : false;
        }
        exports.hasGeolocation = hasGeolocation;
        function getGPS(failedCallback) {
            if (hasGeolocation()) {
                followingUser = true;
                if (geoLocationId != null) {
                    moveGPS(true);
                    return;
                }
                geoLocationId = navigator.geolocation.watchPosition(function(position) {
                    var follow = followingUser || geoLocationLast == null;
                    var l = getMapXY(position);
                    if (l.pixel_x > 0 && l.pixel_y > 0 && l.pixel_x < 5430 && l.pixel_y < 5375) {
                        geoLocationLast = l;
                        moveGPS(follow);
                    }
                }, function() {}, {
                    enableHighAccuracy: true
                });
            } else {
                if (failedCallback) {
                    failedCallback();
                }
            }
        }
        exports.getGPS = getGPS;
        function moveGPS(center) {
            if (geoLocationLast == null) {
                return;
            }
            moveMarker(geoLocationLast.pixel_x, geoLocationLast.pixel_y, center, _config.user_marker_id);
        }
        function getMapXY(position) {
            var x = (position.coords.latitude - MAP_Xn) * 1e3;
            var y = (position.coords.longitude - MAP_Yn) * 1e3;
            var A = MAP_WEIGHTS_X;
            var px = Math.round(MAP_Zn + A[0] + A[1] * x + A[2] * y + A[3] * x * x + A[4] * x * x * y + A[5] * x * x * y * y + A[6] * y * y + A[7] * x * y * y + A[8] * x * y);
            A = MAP_WEIGHTS_Y;
            var py = Math.round(MAP_Zyn + A[0] + A[1] * x + A[2] * y + A[3] * x * x + A[4] * x * x * y + A[5] * x * x * y * y + A[6] * y * y + A[7] * x * y * y + A[8] * x * y);
            return {
                pixel_x: px,
                pixel_y: py
            };
        }
        exports.getMapXY = getMapXY;
        function isFollowingUser() {
            return followingUser;
        }
        exports.isFollowingUser = isFollowingUser;
        function getGeolocationLast() {
            return geoLocationLast;
        }
        exports.getGeolocationLast = getGeolocationLast;
        function cleanup() {
            if (geoLocationId != null && geoLocationId != undefined) {
                navigator.geolocation.clearWatch(geoLocationId);
            }
        }
        exports.cleanup = cleanup;
    }, {
        "ol/extent": 54,
        "ol/feature": 57,
        "ol/geom/point": 81,
        "ol/geom/polygon": 82,
        "ol/interaction": 90,
        "ol/layer/image": 107,
        "ol/layer/vector": 110,
        "ol/map": 115,
        "ol/overlay": 128,
        "ol/proj/projection": 145,
        "ol/source/imagestatic": 210,
        "ol/source/vector": 213,
        "ol/style/fill": 225,
        "ol/style/icon": 226,
        "ol/style/stroke": 233,
        "ol/style/style": 234,
        "ol/style/text": 235,
        "ol/view": 245
    } ],
    29: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_array_ = {};
        _ol_array_.binarySearch = function(haystack, needle, opt_comparator) {
            var mid, cmp;
            var comparator = opt_comparator || _ol_array_.numberSafeCompareFunction;
            var low = 0;
            var high = haystack.length;
            var found = false;
            while (low < high) {
                mid = low + (high - low >> 1);
                cmp = +comparator(haystack[mid], needle);
                if (cmp < 0) {
                    low = mid + 1;
                } else {
                    high = mid;
                    found = !cmp;
                }
            }
            return found ? low : ~low;
        };
        _ol_array_.numberSafeCompareFunction = function(a, b) {
            return a > b ? 1 : a < b ? -1 : 0;
        };
        _ol_array_.includes = function(arr, obj) {
            return arr.indexOf(obj) >= 0;
        };
        _ol_array_.linearFindNearest = function(arr, target, direction) {
            var n = arr.length;
            if (arr[0] <= target) {
                return 0;
            } else if (target <= arr[n - 1]) {
                return n - 1;
            } else {
                var i;
                if (direction > 0) {
                    for (i = 1; i < n; ++i) {
                        if (arr[i] < target) {
                            return i - 1;
                        }
                    }
                } else if (direction < 0) {
                    for (i = 1; i < n; ++i) {
                        if (arr[i] <= target) {
                            return i;
                        }
                    }
                } else {
                    for (i = 1; i < n; ++i) {
                        if (arr[i] == target) {
                            return i;
                        } else if (arr[i] < target) {
                            if (arr[i - 1] - target < target - arr[i]) {
                                return i - 1;
                            } else {
                                return i;
                            }
                        }
                    }
                }
                return n - 1;
            }
        };
        _ol_array_.reverseSubArray = function(arr, begin, end) {
            while (begin < end) {
                var tmp = arr[begin];
                arr[begin] = arr[end];
                arr[end] = tmp;
                ++begin;
                --end;
            }
        };
        _ol_array_.extend = function(arr, data) {
            var i;
            var extension = Array.isArray(data) ? data : [ data ];
            var length = extension.length;
            for (i = 0; i < length; i++) {
                arr[arr.length] = extension[i];
            }
        };
        _ol_array_.remove = function(arr, obj) {
            var i = arr.indexOf(obj);
            var found = i > -1;
            if (found) {
                arr.splice(i, 1);
            }
            return found;
        };
        _ol_array_.find = function(arr, func) {
            var length = arr.length >>> 0;
            var value;
            for (var i = 0; i < length; i++) {
                value = arr[i];
                if (func(value, i, arr)) {
                    return value;
                }
            }
            return null;
        };
        _ol_array_.equals = function(arr1, arr2) {
            var len1 = arr1.length;
            if (len1 !== arr2.length) {
                return false;
            }
            for (var i = 0; i < len1; i++) {
                if (arr1[i] !== arr2[i]) {
                    return false;
                }
            }
            return true;
        };
        _ol_array_.stableSort = function(arr, compareFnc) {
            var length = arr.length;
            var tmp = Array(arr.length);
            var i;
            for (i = 0; i < length; i++) {
                tmp[i] = {
                    index: i,
                    value: arr[i]
                };
            }
            tmp.sort(function(a, b) {
                return compareFnc(a.value, b.value) || a.index - b.index;
            });
            for (i = 0; i < arr.length; i++) {
                arr[i] = tmp[i].value;
            }
        };
        _ol_array_.findIndex = function(arr, func) {
            var index;
            var found = !arr.every(function(el, idx) {
                index = idx;
                return !func(el, idx, arr);
            });
            return found ? index : -1;
        };
        _ol_array_.isSorted = function(arr, opt_func, opt_strict) {
            var compare = opt_func || _ol_array_.numberSafeCompareFunction;
            return arr.every(function(currentVal, index) {
                if (index === 0) {
                    return true;
                }
                var res = compare(arr[index - 1], currentVal);
                return !(res > 0 || opt_strict && res === 0);
            });
        };
        exports.default = _ol_array_;
    }, {} ],
    30: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_AssertionError_ = function(code) {
            var path = _index2.default.VERSION ? _index2.default.VERSION.split("-")[0] : "latest";
            this.message = "Assertion failed. See https://openlayers.org/en/" + path + "/doc/errors/#" + code + " for details.";
            this.code = code;
            this.name = "AssertionError";
        };
        _index2.default.inherits(_ol_AssertionError_, Error);
        exports.default = _ol_AssertionError_;
    }, {
        "./index.js": 89
    } ],
    31: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _assertionerror = require("./assertionerror.js");
        var _assertionerror2 = _interopRequireDefault(_assertionerror);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_asserts_ = {};
        _ol_asserts_.assert = function(assertion, errorCode) {
            if (!assertion) {
                throw new _assertionerror2.default(errorCode);
            }
        };
        exports.default = _ol_asserts_;
    }, {
        "./assertionerror.js": 30
    } ],
    32: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _tilerange = require("./tilerange.js");
        var _tilerange2 = _interopRequireDefault(_tilerange);
        var _math = require("./math.js");
        var _math2 = _interopRequireDefault(_math);
        var _tilegrid = require("./tilegrid.js");
        var _tilegrid2 = _interopRequireDefault(_tilegrid);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_Attribution_ = function(options) {
            this.html_ = options.html;
            this.tileRanges_ = options.tileRanges ? options.tileRanges : null;
        };
        _ol_Attribution_.prototype.getHTML = function() {
            return this.html_;
        };
        _ol_Attribution_.prototype.intersectsAnyTileRange = function(tileRanges, tileGrid, projection) {
            if (!this.tileRanges_) {
                return true;
            }
            var i, ii, tileRange, zKey;
            for (zKey in tileRanges) {
                if (!(zKey in this.tileRanges_)) {
                    continue;
                }
                tileRange = tileRanges[zKey];
                var testTileRange;
                for (i = 0, ii = this.tileRanges_[zKey].length; i < ii; ++i) {
                    testTileRange = this.tileRanges_[zKey][i];
                    if (testTileRange.intersects(tileRange)) {
                        return true;
                    }
                    var extentTileRange = tileGrid.getTileRangeForExtentAndZ(_tilegrid2.default.extentFromProjection(projection), parseInt(zKey, 10));
                    var width = extentTileRange.getWidth();
                    if (tileRange.minX < extentTileRange.minX || tileRange.maxX > extentTileRange.maxX) {
                        if (testTileRange.intersects(new _tilerange2.default(_math2.default.modulo(tileRange.minX, width), _math2.default.modulo(tileRange.maxX, width), tileRange.minY, tileRange.maxY))) {
                            return true;
                        }
                        if (tileRange.getWidth() > width && testTileRange.intersects(extentTileRange)) {
                            return true;
                        }
                    }
                }
            }
            return false;
        };
        exports.default = _ol_Attribution_;
    }, {
        "./math.js": 123,
        "./tilegrid.js": 238,
        "./tilerange.js": 241
    } ],
    33: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _math = require("./math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_CenterConstraint_ = {};
        _ol_CenterConstraint_.createExtent = function(extent) {
            return function(center) {
                if (center) {
                    return [ _math2.default.clamp(center[0], extent[0], extent[2]), _math2.default.clamp(center[1], extent[1], extent[3]) ];
                } else {
                    return undefined;
                }
            };
        };
        _ol_CenterConstraint_.none = function(center) {
            return center;
        };
        exports.default = _ol_CenterConstraint_;
    }, {
        "./math.js": 123
    } ],
    34: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _assertionerror = require("./assertionerror.js");
        var _assertionerror2 = _interopRequireDefault(_assertionerror);
        var _collectioneventtype = require("./collectioneventtype.js");
        var _collectioneventtype2 = _interopRequireDefault(_collectioneventtype);
        var _object = require("./object.js");
        var _object2 = _interopRequireDefault(_object);
        var _event = require("./events/event.js");
        var _event2 = _interopRequireDefault(_event);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_Collection_ = function(opt_array, opt_options) {
            _object2.default.call(this);
            var options = opt_options || {};
            this.unique_ = !!options.unique;
            this.array_ = opt_array ? opt_array : [];
            if (this.unique_) {
                for (var i = 0, ii = this.array_.length; i < ii; ++i) {
                    this.assertUnique_(this.array_[i], i);
                }
            }
            this.updateLength_();
        };
        _index2.default.inherits(_ol_Collection_, _object2.default);
        _ol_Collection_.prototype.clear = function() {
            while (this.getLength() > 0) {
                this.pop();
            }
        };
        _ol_Collection_.prototype.extend = function(arr) {
            var i, ii;
            for (i = 0, ii = arr.length; i < ii; ++i) {
                this.push(arr[i]);
            }
            return this;
        };
        _ol_Collection_.prototype.forEach = function(f, opt_this) {
            var fn = opt_this ? f.bind(opt_this) : f;
            var array = this.array_;
            for (var i = 0, ii = array.length; i < ii; ++i) {
                fn(array[i], i, array);
            }
        };
        _ol_Collection_.prototype.getArray = function() {
            return this.array_;
        };
        _ol_Collection_.prototype.item = function(index) {
            return this.array_[index];
        };
        _ol_Collection_.prototype.getLength = function() {
            return this.get(_ol_Collection_.Property_.LENGTH);
        };
        _ol_Collection_.prototype.insertAt = function(index, elem) {
            if (this.unique_) {
                this.assertUnique_(elem);
            }
            this.array_.splice(index, 0, elem);
            this.updateLength_();
            this.dispatchEvent(new _ol_Collection_.Event(_collectioneventtype2.default.ADD, elem));
        };
        _ol_Collection_.prototype.pop = function() {
            return this.removeAt(this.getLength() - 1);
        };
        _ol_Collection_.prototype.push = function(elem) {
            if (this.unique_) {
                this.assertUnique_(elem);
            }
            var n = this.getLength();
            this.insertAt(n, elem);
            return this.getLength();
        };
        _ol_Collection_.prototype.remove = function(elem) {
            var arr = this.array_;
            var i, ii;
            for (i = 0, ii = arr.length; i < ii; ++i) {
                if (arr[i] === elem) {
                    return this.removeAt(i);
                }
            }
            return undefined;
        };
        _ol_Collection_.prototype.removeAt = function(index) {
            var prev = this.array_[index];
            this.array_.splice(index, 1);
            this.updateLength_();
            this.dispatchEvent(new _ol_Collection_.Event(_collectioneventtype2.default.REMOVE, prev));
            return prev;
        };
        _ol_Collection_.prototype.setAt = function(index, elem) {
            var n = this.getLength();
            if (index < n) {
                if (this.unique_) {
                    this.assertUnique_(elem, index);
                }
                var prev = this.array_[index];
                this.array_[index] = elem;
                this.dispatchEvent(new _ol_Collection_.Event(_collectioneventtype2.default.REMOVE, prev));
                this.dispatchEvent(new _ol_Collection_.Event(_collectioneventtype2.default.ADD, elem));
            } else {
                var j;
                for (j = n; j < index; ++j) {
                    this.insertAt(j, undefined);
                }
                this.insertAt(index, elem);
            }
        };
        _ol_Collection_.prototype.updateLength_ = function() {
            this.set(_ol_Collection_.Property_.LENGTH, this.array_.length);
        };
        _ol_Collection_.prototype.assertUnique_ = function(elem, opt_except) {
            for (var i = 0, ii = this.array_.length; i < ii; ++i) {
                if (this.array_[i] === elem && i !== opt_except) {
                    throw new _assertionerror2.default(58);
                }
            }
        };
        _ol_Collection_.Property_ = {
            LENGTH: "length"
        };
        _ol_Collection_.Event = function(type, opt_element) {
            _event2.default.call(this, type);
            this.element = opt_element;
        };
        _index2.default.inherits(_ol_Collection_.Event, _event2.default);
        exports.default = _ol_Collection_;
    }, {
        "./assertionerror.js": 30,
        "./collectioneventtype.js": 35,
        "./events/event.js": 50,
        "./index.js": 89,
        "./object.js": 125
    } ],
    35: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_CollectionEventType_ = {
            ADD: "add",
            REMOVE: "remove"
        };
        exports.default = _ol_CollectionEventType_;
    }, {} ],
    36: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _asserts = require("./asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _math = require("./math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_color_ = {};
        _ol_color_.HEX_COLOR_RE_ = /^#(?:[0-9a-f]{3,4}){1,2}$/i;
        _ol_color_.NAMED_COLOR_RE_ = /^([a-z]*)$/i;
        _ol_color_.asArray = function(color) {
            if (Array.isArray(color)) {
                return color;
            } else {
                return _ol_color_.fromString(color);
            }
        };
        _ol_color_.asString = function(color) {
            if (typeof color === "string") {
                return color;
            } else {
                return _ol_color_.toString(color);
            }
        };
        _ol_color_.fromNamed = function(color) {
            var el = document.createElement("div");
            el.style.color = color;
            document.body.appendChild(el);
            var rgb = getComputedStyle(el).color;
            document.body.removeChild(el);
            return rgb;
        };
        _ol_color_.fromString = function() {
            var MAX_CACHE_SIZE = 1024;
            var cache = {};
            var cacheSize = 0;
            return function(s) {
                var color;
                if (cache.hasOwnProperty(s)) {
                    color = cache[s];
                } else {
                    if (cacheSize >= MAX_CACHE_SIZE) {
                        var i = 0;
                        var key;
                        for (key in cache) {
                            if ((i++ & 3) === 0) {
                                delete cache[key];
                                --cacheSize;
                            }
                        }
                    }
                    color = _ol_color_.fromStringInternal_(s);
                    cache[s] = color;
                    ++cacheSize;
                }
                return color;
            };
        }();
        _ol_color_.fromStringInternal_ = function(s) {
            var r, g, b, a, color, parts;
            if (_ol_color_.NAMED_COLOR_RE_.exec(s)) {
                s = _ol_color_.fromNamed(s);
            }
            if (_ol_color_.HEX_COLOR_RE_.exec(s)) {
                var n = s.length - 1;
                var d;
                if (n <= 4) {
                    d = 1;
                } else {
                    d = 2;
                }
                var hasAlpha = n === 4 || n === 8;
                r = parseInt(s.substr(1 + 0 * d, d), 16);
                g = parseInt(s.substr(1 + 1 * d, d), 16);
                b = parseInt(s.substr(1 + 2 * d, d), 16);
                if (hasAlpha) {
                    a = parseInt(s.substr(1 + 3 * d, d), 16);
                } else {
                    a = 255;
                }
                if (d == 1) {
                    r = (r << 4) + r;
                    g = (g << 4) + g;
                    b = (b << 4) + b;
                    if (hasAlpha) {
                        a = (a << 4) + a;
                    }
                }
                color = [ r, g, b, a / 255 ];
            } else if (s.indexOf("rgba(") == 0) {
                parts = s.slice(5, -1).split(",").map(Number);
                color = _ol_color_.normalize(parts);
            } else if (s.indexOf("rgb(") == 0) {
                parts = s.slice(4, -1).split(",").map(Number);
                parts.push(1);
                color = _ol_color_.normalize(parts);
            } else {
                _asserts2.default.assert(false, 14);
            }
            return color;
        };
        _ol_color_.normalize = function(color, opt_color) {
            var result = opt_color || [];
            result[0] = _math2.default.clamp(color[0] + .5 | 0, 0, 255);
            result[1] = _math2.default.clamp(color[1] + .5 | 0, 0, 255);
            result[2] = _math2.default.clamp(color[2] + .5 | 0, 0, 255);
            result[3] = _math2.default.clamp(color[3], 0, 1);
            return result;
        };
        _ol_color_.toString = function(color) {
            var r = color[0];
            if (r != (r | 0)) {
                r = r + .5 | 0;
            }
            var g = color[1];
            if (g != (g | 0)) {
                g = g + .5 | 0;
            }
            var b = color[2];
            if (b != (b | 0)) {
                b = b + .5 | 0;
            }
            var a = color[3] === undefined ? 1 : color[3];
            return "rgba(" + r + "," + g + "," + b + "," + a + ")";
        };
        exports.default = _ol_color_;
    }, {
        "./asserts.js": 31,
        "./math.js": 123
    } ],
    37: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _color = require("./color.js");
        var _color2 = _interopRequireDefault(_color);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_colorlike_ = {};
        _ol_colorlike_.asColorLike = function(color) {
            if (_ol_colorlike_.isColorLike(color)) {
                return color;
            } else {
                return _color2.default.asString(color);
            }
        };
        _ol_colorlike_.isColorLike = function(color) {
            return typeof color === "string" || color instanceof CanvasPattern || color instanceof CanvasGradient;
        };
        exports.default = _ol_colorlike_;
    }, {
        "./color.js": 36
    } ],
    38: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _collection = require("./collection.js");
        var _collection2 = _interopRequireDefault(_collection);
        var _attribution = require("./control/attribution.js");
        var _attribution2 = _interopRequireDefault(_attribution);
        var _rotate = require("./control/rotate.js");
        var _rotate2 = _interopRequireDefault(_rotate);
        var _zoom = require("./control/zoom.js");
        var _zoom2 = _interopRequireDefault(_zoom);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_control_ = {};
        _ol_control_.defaults = function(opt_options) {
            var options = opt_options ? opt_options : {};
            var controls = new _collection2.default();
            var zoomControl = options.zoom !== undefined ? options.zoom : true;
            if (zoomControl) {
                controls.push(new _zoom2.default(options.zoomOptions));
            }
            var rotateControl = options.rotate !== undefined ? options.rotate : true;
            if (rotateControl) {
                controls.push(new _rotate2.default(options.rotateOptions));
            }
            var attributionControl = options.attribution !== undefined ? options.attribution : true;
            if (attributionControl) {
                controls.push(new _attribution2.default(options.attributionOptions));
            }
            return controls;
        };
        exports.default = _ol_control_;
    }, {
        "./collection.js": 34,
        "./control/attribution.js": 39,
        "./control/rotate.js": 41,
        "./control/zoom.js": 42
    } ],
    39: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _control = require("../control/control.js");
        var _control2 = _interopRequireDefault(_control);
        var _css = require("../css.js");
        var _css2 = _interopRequireDefault(_css);
        var _dom = require("../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _layer = require("../layer/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_control_Attribution_ = function(opt_options) {
            var options = opt_options ? opt_options : {};
            this.ulElement_ = document.createElement("UL");
            this.logoLi_ = document.createElement("LI");
            this.ulElement_.appendChild(this.logoLi_);
            this.logoLi_.style.display = "none";
            this.collapsed_ = options.collapsed !== undefined ? options.collapsed : true;
            this.collapsible_ = options.collapsible !== undefined ? options.collapsible : true;
            if (!this.collapsible_) {
                this.collapsed_ = false;
            }
            var className = options.className !== undefined ? options.className : "ol-attribution";
            var tipLabel = options.tipLabel !== undefined ? options.tipLabel : "Attributions";
            var collapseLabel = options.collapseLabel !== undefined ? options.collapseLabel : "";
            if (typeof collapseLabel === "string") {
                this.collapseLabel_ = document.createElement("span");
                this.collapseLabel_.textContent = collapseLabel;
            } else {
                this.collapseLabel_ = collapseLabel;
            }
            var label = options.label !== undefined ? options.label : "i";
            if (typeof label === "string") {
                this.label_ = document.createElement("span");
                this.label_.textContent = label;
            } else {
                this.label_ = label;
            }
            var activeLabel = this.collapsible_ && !this.collapsed_ ? this.collapseLabel_ : this.label_;
            var button = document.createElement("button");
            button.setAttribute("type", "button");
            button.title = tipLabel;
            button.appendChild(activeLabel);
            _events2.default.listen(button, _eventtype2.default.CLICK, this.handleClick_, this);
            var cssClasses = className + " " + _css2.default.CLASS_UNSELECTABLE + " " + _css2.default.CLASS_CONTROL + (this.collapsed_ && this.collapsible_ ? " ol-collapsed" : "") + (this.collapsible_ ? "" : " ol-uncollapsible");
            var element = document.createElement("div");
            element.className = cssClasses;
            element.appendChild(this.ulElement_);
            element.appendChild(button);
            var render = options.render ? options.render : _ol_control_Attribution_.render;
            _control2.default.call(this, {
                element: element,
                render: render,
                target: options.target
            });
            this.renderedAttributions_ = [];
            this.renderedVisible_ = true;
            this.logoElements_ = {};
        };
        _index2.default.inherits(_ol_control_Attribution_, _control2.default);
        _ol_control_Attribution_.prototype.getSourceAttributions_ = function(frameState) {
            var lookup = {};
            var visibleAttributions = [];
            var layerStatesArray = frameState.layerStatesArray;
            var resolution = frameState.viewState.resolution;
            for (var i = 0, ii = layerStatesArray.length; i < ii; ++i) {
                var layerState = layerStatesArray[i];
                if (!_layer2.default.visibleAtResolution(layerState, resolution)) {
                    continue;
                }
                var source = layerState.layer.getSource();
                if (!source) {
                    continue;
                }
                var attributionGetter = source.getAttributions2();
                if (!attributionGetter) {
                    continue;
                }
                var attributions = attributionGetter(frameState);
                if (!attributions) {
                    continue;
                }
                if (Array.isArray(attributions)) {
                    for (var j = 0, jj = attributions.length; j < jj; ++j) {
                        if (!(attributions[j] in lookup)) {
                            visibleAttributions.push(attributions[j]);
                            lookup[attributions[j]] = true;
                        }
                    }
                } else {
                    if (!(attributions in lookup)) {
                        visibleAttributions.push(attributions);
                        lookup[attributions] = true;
                    }
                }
            }
            return visibleAttributions;
        };
        _ol_control_Attribution_.render = function(mapEvent) {
            this.updateElement_(mapEvent.frameState);
        };
        _ol_control_Attribution_.prototype.updateElement_ = function(frameState) {
            if (!frameState) {
                if (this.renderedVisible_) {
                    this.element.style.display = "none";
                    this.renderedVisible_ = false;
                }
                return;
            }
            var attributions = this.getSourceAttributions_(frameState);
            if (_array2.default.equals(attributions, this.renderedAttributions_)) {
                return;
            }
            while (this.ulElement_.lastChild !== this.logoLi_) {
                this.ulElement_.removeChild(this.ulElement_.lastChild);
            }
            for (var i = 0, ii = attributions.length; i < ii; ++i) {
                var element = document.createElement("LI");
                element.innerHTML = attributions[i];
                this.ulElement_.appendChild(element);
            }
            if (attributions.length === 0 && this.renderedAttributions_.length > 0) {
                this.element.classList.add("ol-logo-only");
            } else if (this.renderedAttributions_.length === 0 && attributions.length > 0) {
                this.element.classList.remove("ol-logo-only");
            }
            var visible = attributions.length > 0 || !_obj2.default.isEmpty(frameState.logos);
            if (this.renderedVisible_ != visible) {
                this.element.style.display = visible ? "" : "none";
                this.renderedVisible_ = visible;
            }
            this.renderedAttributions_ = attributions;
            this.insertLogos_(frameState);
        };
        _ol_control_Attribution_.prototype.insertLogos_ = function(frameState) {
            var logo;
            var logos = frameState.logos;
            var logoElements = this.logoElements_;
            for (logo in logoElements) {
                if (!(logo in logos)) {
                    _dom2.default.removeNode(logoElements[logo]);
                    delete logoElements[logo];
                }
            }
            var image, logoElement, logoKey;
            for (logoKey in logos) {
                var logoValue = logos[logoKey];
                if (logoValue instanceof HTMLElement) {
                    this.logoLi_.appendChild(logoValue);
                    logoElements[logoKey] = logoValue;
                }
                if (!(logoKey in logoElements)) {
                    image = new Image();
                    image.src = logoKey;
                    if (logoValue === "") {
                        logoElement = image;
                    } else {
                        logoElement = document.createElement("a");
                        logoElement.href = logoValue;
                        logoElement.appendChild(image);
                    }
                    this.logoLi_.appendChild(logoElement);
                    logoElements[logoKey] = logoElement;
                }
            }
            this.logoLi_.style.display = !_obj2.default.isEmpty(logos) ? "" : "none";
        };
        _ol_control_Attribution_.prototype.handleClick_ = function(event) {
            event.preventDefault();
            this.handleToggle_();
        };
        _ol_control_Attribution_.prototype.handleToggle_ = function() {
            this.element.classList.toggle("ol-collapsed");
            if (this.collapsed_) {
                _dom2.default.replaceNode(this.collapseLabel_, this.label_);
            } else {
                _dom2.default.replaceNode(this.label_, this.collapseLabel_);
            }
            this.collapsed_ = !this.collapsed_;
        };
        _ol_control_Attribution_.prototype.getCollapsible = function() {
            return this.collapsible_;
        };
        _ol_control_Attribution_.prototype.setCollapsible = function(collapsible) {
            if (this.collapsible_ === collapsible) {
                return;
            }
            this.collapsible_ = collapsible;
            this.element.classList.toggle("ol-uncollapsible");
            if (!collapsible && this.collapsed_) {
                this.handleToggle_();
            }
        };
        _ol_control_Attribution_.prototype.setCollapsed = function(collapsed) {
            if (!this.collapsible_ || this.collapsed_ === collapsed) {
                return;
            }
            this.handleToggle_();
        };
        _ol_control_Attribution_.prototype.getCollapsed = function() {
            return this.collapsed_;
        };
        exports.default = _ol_control_Attribution_;
    }, {
        "../array.js": 29,
        "../control/control.js": 40,
        "../css.js": 44,
        "../dom.js": 46,
        "../events.js": 48,
        "../events/eventtype.js": 52,
        "../index.js": 89,
        "../layer/layer.js": 108,
        "../obj.js": 124
    } ],
    40: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _mapeventtype = require("../mapeventtype.js");
        var _mapeventtype2 = _interopRequireDefault(_mapeventtype);
        var _object = require("../object.js");
        var _object2 = _interopRequireDefault(_object);
        var _dom = require("../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_control_Control_ = function(options) {
            _object2.default.call(this);
            this.element = options.element ? options.element : null;
            this.target_ = null;
            this.map_ = null;
            this.listenerKeys = [];
            this.render = options.render ? options.render : _index2.default.nullFunction;
            if (options.target) {
                this.setTarget(options.target);
            }
        };
        _index2.default.inherits(_ol_control_Control_, _object2.default);
        _ol_control_Control_.prototype.disposeInternal = function() {
            _dom2.default.removeNode(this.element);
            _object2.default.prototype.disposeInternal.call(this);
        };
        _ol_control_Control_.prototype.getMap = function() {
            return this.map_;
        };
        _ol_control_Control_.prototype.setMap = function(map) {
            if (this.map_) {
                _dom2.default.removeNode(this.element);
            }
            for (var i = 0, ii = this.listenerKeys.length; i < ii; ++i) {
                _events2.default.unlistenByKey(this.listenerKeys[i]);
            }
            this.listenerKeys.length = 0;
            this.map_ = map;
            if (this.map_) {
                var target = this.target_ ? this.target_ : map.getOverlayContainerStopEvent();
                target.appendChild(this.element);
                if (this.render !== _index2.default.nullFunction) {
                    this.listenerKeys.push(_events2.default.listen(map, _mapeventtype2.default.POSTRENDER, this.render, this));
                }
                map.render();
            }
        };
        _ol_control_Control_.prototype.setTarget = function(target) {
            this.target_ = typeof target === "string" ? document.getElementById(target) : target;
        };
        exports.default = _ol_control_Control_;
    }, {
        "../dom.js": 46,
        "../events.js": 48,
        "../index.js": 89,
        "../mapeventtype.js": 121,
        "../object.js": 125
    } ],
    41: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _control = require("../control/control.js");
        var _control2 = _interopRequireDefault(_control);
        var _css = require("../css.js");
        var _css2 = _interopRequireDefault(_css);
        var _easing = require("../easing.js");
        var _easing2 = _interopRequireDefault(_easing);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_control_Rotate_ = function(opt_options) {
            var options = opt_options ? opt_options : {};
            var className = options.className !== undefined ? options.className : "ol-rotate";
            var label = options.label !== undefined ? options.label : "";
            this.label_ = null;
            if (typeof label === "string") {
                this.label_ = document.createElement("span");
                this.label_.className = "ol-compass";
                this.label_.textContent = label;
            } else {
                this.label_ = label;
                this.label_.classList.add("ol-compass");
            }
            var tipLabel = options.tipLabel ? options.tipLabel : "Reset rotation";
            var button = document.createElement("button");
            button.className = className + "-reset";
            button.setAttribute("type", "button");
            button.title = tipLabel;
            button.appendChild(this.label_);
            _events2.default.listen(button, _eventtype2.default.CLICK, _ol_control_Rotate_.prototype.handleClick_, this);
            var cssClasses = className + " " + _css2.default.CLASS_UNSELECTABLE + " " + _css2.default.CLASS_CONTROL;
            var element = document.createElement("div");
            element.className = cssClasses;
            element.appendChild(button);
            var render = options.render ? options.render : _ol_control_Rotate_.render;
            this.callResetNorth_ = options.resetNorth ? options.resetNorth : undefined;
            _control2.default.call(this, {
                element: element,
                render: render,
                target: options.target
            });
            this.duration_ = options.duration !== undefined ? options.duration : 250;
            this.autoHide_ = options.autoHide !== undefined ? options.autoHide : true;
            this.rotation_ = undefined;
            if (this.autoHide_) {
                this.element.classList.add(_css2.default.CLASS_HIDDEN);
            }
        };
        _index2.default.inherits(_ol_control_Rotate_, _control2.default);
        _ol_control_Rotate_.prototype.handleClick_ = function(event) {
            event.preventDefault();
            if (this.callResetNorth_ !== undefined) {
                this.callResetNorth_();
            } else {
                this.resetNorth_();
            }
        };
        _ol_control_Rotate_.prototype.resetNorth_ = function() {
            var map = this.getMap();
            var view = map.getView();
            if (!view) {
                return;
            }
            if (view.getRotation() !== undefined) {
                if (this.duration_ > 0) {
                    view.animate({
                        rotation: 0,
                        duration: this.duration_,
                        easing: _easing2.default.easeOut
                    });
                } else {
                    view.setRotation(0);
                }
            }
        };
        _ol_control_Rotate_.render = function(mapEvent) {
            var frameState = mapEvent.frameState;
            if (!frameState) {
                return;
            }
            var rotation = frameState.viewState.rotation;
            if (rotation != this.rotation_) {
                var transform = "rotate(" + rotation + "rad)";
                if (this.autoHide_) {
                    var contains = this.element.classList.contains(_css2.default.CLASS_HIDDEN);
                    if (!contains && rotation === 0) {
                        this.element.classList.add(_css2.default.CLASS_HIDDEN);
                    } else if (contains && rotation !== 0) {
                        this.element.classList.remove(_css2.default.CLASS_HIDDEN);
                    }
                }
                this.label_.style.msTransform = transform;
                this.label_.style.webkitTransform = transform;
                this.label_.style.transform = transform;
            }
            this.rotation_ = rotation;
        };
        exports.default = _ol_control_Rotate_;
    }, {
        "../control/control.js": 40,
        "../css.js": 44,
        "../easing.js": 47,
        "../events.js": 48,
        "../events/eventtype.js": 52,
        "../index.js": 89
    } ],
    42: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _control = require("../control/control.js");
        var _control2 = _interopRequireDefault(_control);
        var _css = require("../css.js");
        var _css2 = _interopRequireDefault(_css);
        var _easing = require("../easing.js");
        var _easing2 = _interopRequireDefault(_easing);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_control_Zoom_ = function(opt_options) {
            var options = opt_options ? opt_options : {};
            var className = options.className !== undefined ? options.className : "ol-zoom";
            var delta = options.delta !== undefined ? options.delta : 1;
            var zoomInLabel = options.zoomInLabel !== undefined ? options.zoomInLabel : "+";
            var zoomOutLabel = options.zoomOutLabel !== undefined ? options.zoomOutLabel : "";
            var zoomInTipLabel = options.zoomInTipLabel !== undefined ? options.zoomInTipLabel : "Zoom in";
            var zoomOutTipLabel = options.zoomOutTipLabel !== undefined ? options.zoomOutTipLabel : "Zoom out";
            var inElement = document.createElement("button");
            inElement.className = className + "-in";
            inElement.setAttribute("type", "button");
            inElement.title = zoomInTipLabel;
            inElement.appendChild(typeof zoomInLabel === "string" ? document.createTextNode(zoomInLabel) : zoomInLabel);
            _events2.default.listen(inElement, _eventtype2.default.CLICK, _ol_control_Zoom_.prototype.handleClick_.bind(this, delta));
            var outElement = document.createElement("button");
            outElement.className = className + "-out";
            outElement.setAttribute("type", "button");
            outElement.title = zoomOutTipLabel;
            outElement.appendChild(typeof zoomOutLabel === "string" ? document.createTextNode(zoomOutLabel) : zoomOutLabel);
            _events2.default.listen(outElement, _eventtype2.default.CLICK, _ol_control_Zoom_.prototype.handleClick_.bind(this, -delta));
            var cssClasses = className + " " + _css2.default.CLASS_UNSELECTABLE + " " + _css2.default.CLASS_CONTROL;
            var element = document.createElement("div");
            element.className = cssClasses;
            element.appendChild(inElement);
            element.appendChild(outElement);
            _control2.default.call(this, {
                element: element,
                target: options.target
            });
            this.duration_ = options.duration !== undefined ? options.duration : 250;
        };
        _index2.default.inherits(_ol_control_Zoom_, _control2.default);
        _ol_control_Zoom_.prototype.handleClick_ = function(delta, event) {
            event.preventDefault();
            this.zoomByDelta_(delta);
        };
        _ol_control_Zoom_.prototype.zoomByDelta_ = function(delta) {
            var map = this.getMap();
            var view = map.getView();
            if (!view) {
                return;
            }
            var currentResolution = view.getResolution();
            if (currentResolution) {
                var newResolution = view.constrainResolution(currentResolution, delta);
                if (this.duration_ > 0) {
                    if (view.getAnimating()) {
                        view.cancelAnimations();
                    }
                    view.animate({
                        resolution: newResolution,
                        duration: this.duration_,
                        easing: _easing2.default.easeOut
                    });
                } else {
                    view.setResolution(newResolution);
                }
            }
        };
        exports.default = _ol_control_Zoom_;
    }, {
        "../control/control.js": 40,
        "../css.js": 44,
        "../easing.js": 47,
        "../events.js": 48,
        "../events/eventtype.js": 52,
        "../index.js": 89
    } ],
    43: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _math = require("./math.js");
        var _math2 = _interopRequireDefault(_math);
        var _string = require("./string.js");
        var _string2 = _interopRequireDefault(_string);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_coordinate_ = {};
        _ol_coordinate_.add = function(coordinate, delta) {
            coordinate[0] += delta[0];
            coordinate[1] += delta[1];
            return coordinate;
        };
        _ol_coordinate_.closestOnCircle = function(coordinate, circle) {
            var r = circle.getRadius();
            var center = circle.getCenter();
            var x0 = center[0];
            var y0 = center[1];
            var x1 = coordinate[0];
            var y1 = coordinate[1];
            var dx = x1 - x0;
            var dy = y1 - y0;
            if (dx === 0 && dy === 0) {
                dx = 1;
            }
            var d = Math.sqrt(dx * dx + dy * dy);
            var x, y;
            x = x0 + r * dx / d;
            y = y0 + r * dy / d;
            return [ x, y ];
        };
        _ol_coordinate_.closestOnSegment = function(coordinate, segment) {
            var x0 = coordinate[0];
            var y0 = coordinate[1];
            var start = segment[0];
            var end = segment[1];
            var x1 = start[0];
            var y1 = start[1];
            var x2 = end[0];
            var y2 = end[1];
            var dx = x2 - x1;
            var dy = y2 - y1;
            var along = dx === 0 && dy === 0 ? 0 : (dx * (x0 - x1) + dy * (y0 - y1)) / (dx * dx + dy * dy || 0);
            var x, y;
            if (along <= 0) {
                x = x1;
                y = y1;
            } else if (along >= 1) {
                x = x2;
                y = y2;
            } else {
                x = x1 + along * dx;
                y = y1 + along * dy;
            }
            return [ x, y ];
        };
        _ol_coordinate_.createStringXY = function(opt_fractionDigits) {
            return function(coordinate) {
                return _ol_coordinate_.toStringXY(coordinate, opt_fractionDigits);
            };
        };
        _ol_coordinate_.degreesToStringHDMS = function(hemispheres, degrees, opt_fractionDigits) {
            var normalizedDegrees = _math2.default.modulo(degrees + 180, 360) - 180;
            var x = Math.abs(3600 * normalizedDegrees);
            var dflPrecision = opt_fractionDigits || 0;
            var precision = Math.pow(10, dflPrecision);
            var deg = Math.floor(x / 3600);
            var min = Math.floor((x - deg * 3600) / 60);
            var sec = x - deg * 3600 - min * 60;
            sec = Math.ceil(sec * precision) / precision;
            if (sec >= 60) {
                sec = 0;
                min += 1;
            }
            if (min >= 60) {
                min = 0;
                deg += 1;
            }
            return deg + " " + _string2.default.padNumber(min, 2) + " " + _string2.default.padNumber(sec, 2, dflPrecision) + "" + (normalizedDegrees == 0 ? "" : " " + hemispheres.charAt(normalizedDegrees < 0 ? 1 : 0));
        };
        _ol_coordinate_.format = function(coordinate, template, opt_fractionDigits) {
            if (coordinate) {
                return template.replace("{x}", coordinate[0].toFixed(opt_fractionDigits)).replace("{y}", coordinate[1].toFixed(opt_fractionDigits));
            } else {
                return "";
            }
        };
        _ol_coordinate_.equals = function(coordinate1, coordinate2) {
            var equals = true;
            for (var i = coordinate1.length - 1; i >= 0; --i) {
                if (coordinate1[i] != coordinate2[i]) {
                    equals = false;
                    break;
                }
            }
            return equals;
        };
        _ol_coordinate_.rotate = function(coordinate, angle) {
            var cosAngle = Math.cos(angle);
            var sinAngle = Math.sin(angle);
            var x = coordinate[0] * cosAngle - coordinate[1] * sinAngle;
            var y = coordinate[1] * cosAngle + coordinate[0] * sinAngle;
            coordinate[0] = x;
            coordinate[1] = y;
            return coordinate;
        };
        _ol_coordinate_.scale = function(coordinate, scale) {
            coordinate[0] *= scale;
            coordinate[1] *= scale;
            return coordinate;
        };
        _ol_coordinate_.sub = function(coordinate, delta) {
            coordinate[0] -= delta[0];
            coordinate[1] -= delta[1];
            return coordinate;
        };
        _ol_coordinate_.squaredDistance = function(coord1, coord2) {
            var dx = coord1[0] - coord2[0];
            var dy = coord1[1] - coord2[1];
            return dx * dx + dy * dy;
        };
        _ol_coordinate_.distance = function(coord1, coord2) {
            return Math.sqrt(_ol_coordinate_.squaredDistance(coord1, coord2));
        };
        _ol_coordinate_.squaredDistanceToSegment = function(coordinate, segment) {
            return _ol_coordinate_.squaredDistance(coordinate, _ol_coordinate_.closestOnSegment(coordinate, segment));
        };
        _ol_coordinate_.toStringHDMS = function(coordinate, opt_fractionDigits) {
            if (coordinate) {
                return _ol_coordinate_.degreesToStringHDMS("NS", coordinate[1], opt_fractionDigits) + " " + _ol_coordinate_.degreesToStringHDMS("EW", coordinate[0], opt_fractionDigits);
            } else {
                return "";
            }
        };
        _ol_coordinate_.toStringXY = function(coordinate, opt_fractionDigits) {
            return _ol_coordinate_.format(coordinate, "{x}, {y}", opt_fractionDigits);
        };
        exports.default = _ol_coordinate_;
    }, {
        "./math.js": 123,
        "./string.js": 216
    } ],
    44: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_css_ = {};
        _ol_css_.CLASS_HIDDEN = "ol-hidden";
        _ol_css_.CLASS_SELECTABLE = "ol-selectable";
        _ol_css_.CLASS_UNSELECTABLE = "ol-unselectable";
        _ol_css_.CLASS_UNSUPPORTED = "ol-unsupported";
        _ol_css_.CLASS_CONTROL = "ol-control";
        _ol_css_.getFontFamilies = function() {
            var style;
            var cache = {};
            return function(font) {
                if (!style) {
                    style = document.createElement("div").style;
                }
                if (!(font in cache)) {
                    style.font = font;
                    var family = style.fontFamily;
                    style.font = "";
                    if (!family) {
                        return null;
                    }
                    cache[font] = family.split(/,\s?/);
                }
                return cache[font];
            };
        }();
        exports.default = _ol_css_;
    }, {} ],
    45: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_Disposable_ = function() {};
        _ol_Disposable_.prototype.disposed_ = false;
        _ol_Disposable_.prototype.dispose = function() {
            if (!this.disposed_) {
                this.disposed_ = true;
                this.disposeInternal();
            }
        };
        _ol_Disposable_.prototype.disposeInternal = _index2.default.nullFunction;
        exports.default = _ol_Disposable_;
    }, {
        "./index.js": 89
    } ],
    46: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_dom_ = {};
        _ol_dom_.createCanvasContext2D = function(opt_width, opt_height) {
            var canvas = document.createElement("CANVAS");
            if (opt_width) {
                canvas.width = opt_width;
            }
            if (opt_height) {
                canvas.height = opt_height;
            }
            return canvas.getContext("2d");
        };
        _ol_dom_.outerWidth = function(element) {
            var width = element.offsetWidth;
            var style = getComputedStyle(element);
            width += parseInt(style.marginLeft, 10) + parseInt(style.marginRight, 10);
            return width;
        };
        _ol_dom_.outerHeight = function(element) {
            var height = element.offsetHeight;
            var style = getComputedStyle(element);
            height += parseInt(style.marginTop, 10) + parseInt(style.marginBottom, 10);
            return height;
        };
        _ol_dom_.replaceNode = function(newNode, oldNode) {
            var parent = oldNode.parentNode;
            if (parent) {
                parent.replaceChild(newNode, oldNode);
            }
        };
        _ol_dom_.removeNode = function(node) {
            return node && node.parentNode ? node.parentNode.removeChild(node) : null;
        };
        _ol_dom_.removeChildren = function(node) {
            while (node.lastChild) {
                node.removeChild(node.lastChild);
            }
        };
        exports.default = _ol_dom_;
    }, {} ],
    47: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_easing_ = {};
        _ol_easing_.easeIn = function(t) {
            return Math.pow(t, 3);
        };
        _ol_easing_.easeOut = function(t) {
            return 1 - _ol_easing_.easeIn(1 - t);
        };
        _ol_easing_.inAndOut = function(t) {
            return 3 * t * t - 2 * t * t * t;
        };
        _ol_easing_.linear = function(t) {
            return t;
        };
        _ol_easing_.upAndDown = function(t) {
            if (t < .5) {
                return _ol_easing_.inAndOut(2 * t);
            } else {
                return 1 - _ol_easing_.inAndOut(2 * (t - .5));
            }
        };
        exports.default = _ol_easing_;
    }, {} ],
    48: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _obj = require("./obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_events_ = {};
        _ol_events_.bindListener_ = function(listenerObj) {
            var boundListener = function(evt) {
                var listener = listenerObj.listener;
                var bindTo = listenerObj.bindTo || listenerObj.target;
                if (listenerObj.callOnce) {
                    _ol_events_.unlistenByKey(listenerObj);
                }
                return listener.call(bindTo, evt);
            };
            listenerObj.boundListener = boundListener;
            return boundListener;
        };
        _ol_events_.findListener_ = function(listeners, listener, opt_this, opt_setDeleteIndex) {
            var listenerObj;
            for (var i = 0, ii = listeners.length; i < ii; ++i) {
                listenerObj = listeners[i];
                if (listenerObj.listener === listener && listenerObj.bindTo === opt_this) {
                    if (opt_setDeleteIndex) {
                        listenerObj.deleteIndex = i;
                    }
                    return listenerObj;
                }
            }
            return undefined;
        };
        _ol_events_.getListeners = function(target, type) {
            var listenerMap = target.ol_lm;
            return listenerMap ? listenerMap[type] : undefined;
        };
        _ol_events_.getListenerMap_ = function(target) {
            var listenerMap = target.ol_lm;
            if (!listenerMap) {
                listenerMap = target.ol_lm = {};
            }
            return listenerMap;
        };
        _ol_events_.removeListeners_ = function(target, type) {
            var listeners = _ol_events_.getListeners(target, type);
            if (listeners) {
                for (var i = 0, ii = listeners.length; i < ii; ++i) {
                    target.removeEventListener(type, listeners[i].boundListener);
                    _obj2.default.clear(listeners[i]);
                }
                listeners.length = 0;
                var listenerMap = target.ol_lm;
                if (listenerMap) {
                    delete listenerMap[type];
                    if (Object.keys(listenerMap).length === 0) {
                        delete target.ol_lm;
                    }
                }
            }
        };
        _ol_events_.listen = function(target, type, listener, opt_this, opt_once) {
            var listenerMap = _ol_events_.getListenerMap_(target);
            var listeners = listenerMap[type];
            if (!listeners) {
                listeners = listenerMap[type] = [];
            }
            var listenerObj = _ol_events_.findListener_(listeners, listener, opt_this, false);
            if (listenerObj) {
                if (!opt_once) {
                    listenerObj.callOnce = false;
                }
            } else {
                listenerObj = {
                    bindTo: opt_this,
                    callOnce: !!opt_once,
                    listener: listener,
                    target: target,
                    type: type
                };
                target.addEventListener(type, _ol_events_.bindListener_(listenerObj));
                listeners.push(listenerObj);
            }
            return listenerObj;
        };
        _ol_events_.listenOnce = function(target, type, listener, opt_this) {
            return _ol_events_.listen(target, type, listener, opt_this, true);
        };
        _ol_events_.unlisten = function(target, type, listener, opt_this) {
            var listeners = _ol_events_.getListeners(target, type);
            if (listeners) {
                var listenerObj = _ol_events_.findListener_(listeners, listener, opt_this, true);
                if (listenerObj) {
                    _ol_events_.unlistenByKey(listenerObj);
                }
            }
        };
        _ol_events_.unlistenByKey = function(key) {
            if (key && key.target) {
                key.target.removeEventListener(key.type, key.boundListener);
                var listeners = _ol_events_.getListeners(key.target, key.type);
                if (listeners) {
                    var i = "deleteIndex" in key ? key.deleteIndex : listeners.indexOf(key);
                    if (i !== -1) {
                        listeners.splice(i, 1);
                    }
                    if (listeners.length === 0) {
                        _ol_events_.removeListeners_(key.target, key.type);
                    }
                }
                _obj2.default.clear(key);
            }
        };
        _ol_events_.unlistenAll = function(target) {
            var listenerMap = _ol_events_.getListenerMap_(target);
            for (var type in listenerMap) {
                _ol_events_.removeListeners_(target, type);
            }
        };
        exports.default = _ol_events_;
    }, {
        "./obj.js": 124
    } ],
    49: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _mapbrowsereventtype = require("../mapbrowsereventtype.js");
        var _mapbrowsereventtype2 = _interopRequireDefault(_mapbrowsereventtype);
        var _asserts = require("../asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _has = require("../has.js");
        var _has2 = _interopRequireDefault(_has);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_events_condition_ = {};
        _ol_events_condition_.altKeyOnly = function(mapBrowserEvent) {
            var originalEvent = mapBrowserEvent.originalEvent;
            return originalEvent.altKey && !(originalEvent.metaKey || originalEvent.ctrlKey) && !originalEvent.shiftKey;
        };
        _ol_events_condition_.altShiftKeysOnly = function(mapBrowserEvent) {
            var originalEvent = mapBrowserEvent.originalEvent;
            return originalEvent.altKey && !(originalEvent.metaKey || originalEvent.ctrlKey) && originalEvent.shiftKey;
        };
        _ol_events_condition_.always = _functions2.default.TRUE;
        _ol_events_condition_.click = function(mapBrowserEvent) {
            return mapBrowserEvent.type == _mapbrowsereventtype2.default.CLICK;
        };
        _ol_events_condition_.mouseActionButton = function(mapBrowserEvent) {
            var originalEvent = mapBrowserEvent.originalEvent;
            return originalEvent.button == 0 && !(_has2.default.WEBKIT && _has2.default.MAC && originalEvent.ctrlKey);
        };
        _ol_events_condition_.never = _functions2.default.FALSE;
        _ol_events_condition_.pointerMove = function(mapBrowserEvent) {
            return mapBrowserEvent.type == "pointermove";
        };
        _ol_events_condition_.singleClick = function(mapBrowserEvent) {
            return mapBrowserEvent.type == _mapbrowsereventtype2.default.SINGLECLICK;
        };
        _ol_events_condition_.doubleClick = function(mapBrowserEvent) {
            return mapBrowserEvent.type == _mapbrowsereventtype2.default.DBLCLICK;
        };
        _ol_events_condition_.noModifierKeys = function(mapBrowserEvent) {
            var originalEvent = mapBrowserEvent.originalEvent;
            return !originalEvent.altKey && !(originalEvent.metaKey || originalEvent.ctrlKey) && !originalEvent.shiftKey;
        };
        _ol_events_condition_.platformModifierKeyOnly = function(mapBrowserEvent) {
            var originalEvent = mapBrowserEvent.originalEvent;
            return !originalEvent.altKey && (_has2.default.MAC ? originalEvent.metaKey : originalEvent.ctrlKey) && !originalEvent.shiftKey;
        };
        _ol_events_condition_.shiftKeyOnly = function(mapBrowserEvent) {
            var originalEvent = mapBrowserEvent.originalEvent;
            return !originalEvent.altKey && !(originalEvent.metaKey || originalEvent.ctrlKey) && originalEvent.shiftKey;
        };
        _ol_events_condition_.targetNotEditable = function(mapBrowserEvent) {
            var target = mapBrowserEvent.originalEvent.target;
            var tagName = target.tagName;
            return tagName !== "INPUT" && tagName !== "SELECT" && tagName !== "TEXTAREA";
        };
        _ol_events_condition_.mouseOnly = function(mapBrowserEvent) {
            _asserts2.default.assert(mapBrowserEvent.pointerEvent, 56);
            return mapBrowserEvent.pointerEvent.pointerType == "mouse";
        };
        _ol_events_condition_.primaryAction = function(mapBrowserEvent) {
            var pointerEvent = mapBrowserEvent.pointerEvent;
            return pointerEvent.isPrimary && pointerEvent.button === 0;
        };
        exports.default = _ol_events_condition_;
    }, {
        "../asserts.js": 31,
        "../functions.js": 60,
        "../has.js": 84,
        "../mapbrowsereventtype.js": 118
    } ],
    50: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_events_Event_ = function(type) {
            this.propagationStopped;
            this.type = type;
            this.target = null;
        };
        _ol_events_Event_.prototype.preventDefault = _ol_events_Event_.prototype.stopPropagation = function() {
            this.propagationStopped = true;
        };
        _ol_events_Event_.stopPropagation = function(evt) {
            evt.stopPropagation();
        };
        _ol_events_Event_.preventDefault = function(evt) {
            evt.preventDefault();
        };
        exports.default = _ol_events_Event_;
    }, {} ],
    51: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _disposable = require("../disposable.js");
        var _disposable2 = _interopRequireDefault(_disposable);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _event = require("../events/event.js");
        var _event2 = _interopRequireDefault(_event);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_events_EventTarget_ = function() {
            _disposable2.default.call(this);
            this.pendingRemovals_ = {};
            this.dispatching_ = {};
            this.listeners_ = {};
        };
        _index2.default.inherits(_ol_events_EventTarget_, _disposable2.default);
        _ol_events_EventTarget_.prototype.addEventListener = function(type, listener) {
            var listeners = this.listeners_[type];
            if (!listeners) {
                listeners = this.listeners_[type] = [];
            }
            if (listeners.indexOf(listener) === -1) {
                listeners.push(listener);
            }
        };
        _ol_events_EventTarget_.prototype.dispatchEvent = function(event) {
            var evt = typeof event === "string" ? new _event2.default(event) : event;
            var type = evt.type;
            evt.target = this;
            var listeners = this.listeners_[type];
            var propagate;
            if (listeners) {
                if (!(type in this.dispatching_)) {
                    this.dispatching_[type] = 0;
                    this.pendingRemovals_[type] = 0;
                }
                ++this.dispatching_[type];
                for (var i = 0, ii = listeners.length; i < ii; ++i) {
                    if (listeners[i].call(this, evt) === false || evt.propagationStopped) {
                        propagate = false;
                        break;
                    }
                }
                --this.dispatching_[type];
                if (this.dispatching_[type] === 0) {
                    var pendingRemovals = this.pendingRemovals_[type];
                    delete this.pendingRemovals_[type];
                    while (pendingRemovals--) {
                        this.removeEventListener(type, _index2.default.nullFunction);
                    }
                    delete this.dispatching_[type];
                }
                return propagate;
            }
        };
        _ol_events_EventTarget_.prototype.disposeInternal = function() {
            _events2.default.unlistenAll(this);
        };
        _ol_events_EventTarget_.prototype.getListeners = function(type) {
            return this.listeners_[type];
        };
        _ol_events_EventTarget_.prototype.hasListener = function(opt_type) {
            return opt_type ? opt_type in this.listeners_ : Object.keys(this.listeners_).length > 0;
        };
        _ol_events_EventTarget_.prototype.removeEventListener = function(type, listener) {
            var listeners = this.listeners_[type];
            if (listeners) {
                var index = listeners.indexOf(listener);
                if (type in this.pendingRemovals_) {
                    listeners[index] = _index2.default.nullFunction;
                    ++this.pendingRemovals_[type];
                } else {
                    listeners.splice(index, 1);
                    if (listeners.length === 0) {
                        delete this.listeners_[type];
                    }
                }
            }
        };
        exports.default = _ol_events_EventTarget_;
    }, {
        "../disposable.js": 45,
        "../events.js": 48,
        "../events/event.js": 50,
        "../index.js": 89
    } ],
    52: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_events_EventType_ = {
            CHANGE: "change",
            CLEAR: "clear",
            CLICK: "click",
            DBLCLICK: "dblclick",
            DRAGENTER: "dragenter",
            DRAGOVER: "dragover",
            DROP: "drop",
            ERROR: "error",
            KEYDOWN: "keydown",
            KEYPRESS: "keypress",
            LOAD: "load",
            MOUSEDOWN: "mousedown",
            MOUSEMOVE: "mousemove",
            MOUSEOUT: "mouseout",
            MOUSEUP: "mouseup",
            MOUSEWHEEL: "mousewheel",
            MSPOINTERDOWN: "MSPointerDown",
            RESIZE: "resize",
            TOUCHSTART: "touchstart",
            TOUCHMOVE: "touchmove",
            TOUCHEND: "touchend",
            WHEEL: "wheel"
        };
        exports.default = _ol_events_EventType_;
    }, {} ],
    53: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_events_KeyCode_ = {
            LEFT: 37,
            UP: 38,
            RIGHT: 39,
            DOWN: 40
        };
        exports.default = _ol_events_KeyCode_;
    }, {} ],
    54: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _asserts = require("./asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _corner = require("./extent/corner.js");
        var _corner2 = _interopRequireDefault(_corner);
        var _relationship = require("./extent/relationship.js");
        var _relationship2 = _interopRequireDefault(_relationship);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_extent_ = {};
        _ol_extent_.boundingExtent = function(coordinates) {
            var extent = _ol_extent_.createEmpty();
            for (var i = 0, ii = coordinates.length; i < ii; ++i) {
                _ol_extent_.extendCoordinate(extent, coordinates[i]);
            }
            return extent;
        };
        _ol_extent_.boundingExtentXYs_ = function(xs, ys, opt_extent) {
            var minX = Math.min.apply(null, xs);
            var minY = Math.min.apply(null, ys);
            var maxX = Math.max.apply(null, xs);
            var maxY = Math.max.apply(null, ys);
            return _ol_extent_.createOrUpdate(minX, minY, maxX, maxY, opt_extent);
        };
        _ol_extent_.buffer = function(extent, value, opt_extent) {
            if (opt_extent) {
                opt_extent[0] = extent[0] - value;
                opt_extent[1] = extent[1] - value;
                opt_extent[2] = extent[2] + value;
                opt_extent[3] = extent[3] + value;
                return opt_extent;
            } else {
                return [ extent[0] - value, extent[1] - value, extent[2] + value, extent[3] + value ];
            }
        };
        _ol_extent_.clone = function(extent, opt_extent) {
            if (opt_extent) {
                opt_extent[0] = extent[0];
                opt_extent[1] = extent[1];
                opt_extent[2] = extent[2];
                opt_extent[3] = extent[3];
                return opt_extent;
            } else {
                return extent.slice();
            }
        };
        _ol_extent_.closestSquaredDistanceXY = function(extent, x, y) {
            var dx, dy;
            if (x < extent[0]) {
                dx = extent[0] - x;
            } else if (extent[2] < x) {
                dx = x - extent[2];
            } else {
                dx = 0;
            }
            if (y < extent[1]) {
                dy = extent[1] - y;
            } else if (extent[3] < y) {
                dy = y - extent[3];
            } else {
                dy = 0;
            }
            return dx * dx + dy * dy;
        };
        _ol_extent_.containsCoordinate = function(extent, coordinate) {
            return _ol_extent_.containsXY(extent, coordinate[0], coordinate[1]);
        };
        _ol_extent_.containsExtent = function(extent1, extent2) {
            return extent1[0] <= extent2[0] && extent2[2] <= extent1[2] && extent1[1] <= extent2[1] && extent2[3] <= extent1[3];
        };
        _ol_extent_.containsXY = function(extent, x, y) {
            return extent[0] <= x && x <= extent[2] && extent[1] <= y && y <= extent[3];
        };
        _ol_extent_.coordinateRelationship = function(extent, coordinate) {
            var minX = extent[0];
            var minY = extent[1];
            var maxX = extent[2];
            var maxY = extent[3];
            var x = coordinate[0];
            var y = coordinate[1];
            var relationship = _relationship2.default.UNKNOWN;
            if (x < minX) {
                relationship = relationship | _relationship2.default.LEFT;
            } else if (x > maxX) {
                relationship = relationship | _relationship2.default.RIGHT;
            }
            if (y < minY) {
                relationship = relationship | _relationship2.default.BELOW;
            } else if (y > maxY) {
                relationship = relationship | _relationship2.default.ABOVE;
            }
            if (relationship === _relationship2.default.UNKNOWN) {
                relationship = _relationship2.default.INTERSECTING;
            }
            return relationship;
        };
        _ol_extent_.createEmpty = function() {
            return [ Infinity, Infinity, -Infinity, -Infinity ];
        };
        _ol_extent_.createOrUpdate = function(minX, minY, maxX, maxY, opt_extent) {
            if (opt_extent) {
                opt_extent[0] = minX;
                opt_extent[1] = minY;
                opt_extent[2] = maxX;
                opt_extent[3] = maxY;
                return opt_extent;
            } else {
                return [ minX, minY, maxX, maxY ];
            }
        };
        _ol_extent_.createOrUpdateEmpty = function(opt_extent) {
            return _ol_extent_.createOrUpdate(Infinity, Infinity, -Infinity, -Infinity, opt_extent);
        };
        _ol_extent_.createOrUpdateFromCoordinate = function(coordinate, opt_extent) {
            var x = coordinate[0];
            var y = coordinate[1];
            return _ol_extent_.createOrUpdate(x, y, x, y, opt_extent);
        };
        _ol_extent_.createOrUpdateFromCoordinates = function(coordinates, opt_extent) {
            var extent = _ol_extent_.createOrUpdateEmpty(opt_extent);
            return _ol_extent_.extendCoordinates(extent, coordinates);
        };
        _ol_extent_.createOrUpdateFromFlatCoordinates = function(flatCoordinates, offset, end, stride, opt_extent) {
            var extent = _ol_extent_.createOrUpdateEmpty(opt_extent);
            return _ol_extent_.extendFlatCoordinates(extent, flatCoordinates, offset, end, stride);
        };
        _ol_extent_.createOrUpdateFromRings = function(rings, opt_extent) {
            var extent = _ol_extent_.createOrUpdateEmpty(opt_extent);
            return _ol_extent_.extendRings(extent, rings);
        };
        _ol_extent_.equals = function(extent1, extent2) {
            return extent1[0] == extent2[0] && extent1[2] == extent2[2] && extent1[1] == extent2[1] && extent1[3] == extent2[3];
        };
        _ol_extent_.extend = function(extent1, extent2) {
            if (extent2[0] < extent1[0]) {
                extent1[0] = extent2[0];
            }
            if (extent2[2] > extent1[2]) {
                extent1[2] = extent2[2];
            }
            if (extent2[1] < extent1[1]) {
                extent1[1] = extent2[1];
            }
            if (extent2[3] > extent1[3]) {
                extent1[3] = extent2[3];
            }
            return extent1;
        };
        _ol_extent_.extendCoordinate = function(extent, coordinate) {
            if (coordinate[0] < extent[0]) {
                extent[0] = coordinate[0];
            }
            if (coordinate[0] > extent[2]) {
                extent[2] = coordinate[0];
            }
            if (coordinate[1] < extent[1]) {
                extent[1] = coordinate[1];
            }
            if (coordinate[1] > extent[3]) {
                extent[3] = coordinate[1];
            }
        };
        _ol_extent_.extendCoordinates = function(extent, coordinates) {
            var i, ii;
            for (i = 0, ii = coordinates.length; i < ii; ++i) {
                _ol_extent_.extendCoordinate(extent, coordinates[i]);
            }
            return extent;
        };
        _ol_extent_.extendFlatCoordinates = function(extent, flatCoordinates, offset, end, stride) {
            for (;offset < end; offset += stride) {
                _ol_extent_.extendXY(extent, flatCoordinates[offset], flatCoordinates[offset + 1]);
            }
            return extent;
        };
        _ol_extent_.extendRings = function(extent, rings) {
            var i, ii;
            for (i = 0, ii = rings.length; i < ii; ++i) {
                _ol_extent_.extendCoordinates(extent, rings[i]);
            }
            return extent;
        };
        _ol_extent_.extendXY = function(extent, x, y) {
            extent[0] = Math.min(extent[0], x);
            extent[1] = Math.min(extent[1], y);
            extent[2] = Math.max(extent[2], x);
            extent[3] = Math.max(extent[3], y);
        };
        _ol_extent_.forEachCorner = function(extent, callback, opt_this) {
            var val;
            val = callback.call(opt_this, _ol_extent_.getBottomLeft(extent));
            if (val) {
                return val;
            }
            val = callback.call(opt_this, _ol_extent_.getBottomRight(extent));
            if (val) {
                return val;
            }
            val = callback.call(opt_this, _ol_extent_.getTopRight(extent));
            if (val) {
                return val;
            }
            val = callback.call(opt_this, _ol_extent_.getTopLeft(extent));
            if (val) {
                return val;
            }
            return false;
        };
        _ol_extent_.getArea = function(extent) {
            var area = 0;
            if (!_ol_extent_.isEmpty(extent)) {
                area = _ol_extent_.getWidth(extent) * _ol_extent_.getHeight(extent);
            }
            return area;
        };
        _ol_extent_.getBottomLeft = function(extent) {
            return [ extent[0], extent[1] ];
        };
        _ol_extent_.getBottomRight = function(extent) {
            return [ extent[2], extent[1] ];
        };
        _ol_extent_.getCenter = function(extent) {
            return [ (extent[0] + extent[2]) / 2, (extent[1] + extent[3]) / 2 ];
        };
        _ol_extent_.getCorner = function(extent, corner) {
            var coordinate;
            if (corner === _corner2.default.BOTTOM_LEFT) {
                coordinate = _ol_extent_.getBottomLeft(extent);
            } else if (corner === _corner2.default.BOTTOM_RIGHT) {
                coordinate = _ol_extent_.getBottomRight(extent);
            } else if (corner === _corner2.default.TOP_LEFT) {
                coordinate = _ol_extent_.getTopLeft(extent);
            } else if (corner === _corner2.default.TOP_RIGHT) {
                coordinate = _ol_extent_.getTopRight(extent);
            } else {
                _asserts2.default.assert(false, 13);
            }
            return coordinate;
        };
        _ol_extent_.getEnlargedArea = function(extent1, extent2) {
            var minX = Math.min(extent1[0], extent2[0]);
            var minY = Math.min(extent1[1], extent2[1]);
            var maxX = Math.max(extent1[2], extent2[2]);
            var maxY = Math.max(extent1[3], extent2[3]);
            return (maxX - minX) * (maxY - minY);
        };
        _ol_extent_.getForViewAndSize = function(center, resolution, rotation, size, opt_extent) {
            var dx = resolution * size[0] / 2;
            var dy = resolution * size[1] / 2;
            var cosRotation = Math.cos(rotation);
            var sinRotation = Math.sin(rotation);
            var xCos = dx * cosRotation;
            var xSin = dx * sinRotation;
            var yCos = dy * cosRotation;
            var ySin = dy * sinRotation;
            var x = center[0];
            var y = center[1];
            var x0 = x - xCos + ySin;
            var x1 = x - xCos - ySin;
            var x2 = x + xCos - ySin;
            var x3 = x + xCos + ySin;
            var y0 = y - xSin - yCos;
            var y1 = y - xSin + yCos;
            var y2 = y + xSin + yCos;
            var y3 = y + xSin - yCos;
            return _ol_extent_.createOrUpdate(Math.min(x0, x1, x2, x3), Math.min(y0, y1, y2, y3), Math.max(x0, x1, x2, x3), Math.max(y0, y1, y2, y3), opt_extent);
        };
        _ol_extent_.getHeight = function(extent) {
            return extent[3] - extent[1];
        };
        _ol_extent_.getIntersectionArea = function(extent1, extent2) {
            var intersection = _ol_extent_.getIntersection(extent1, extent2);
            return _ol_extent_.getArea(intersection);
        };
        _ol_extent_.getIntersection = function(extent1, extent2, opt_extent) {
            var intersection = opt_extent ? opt_extent : _ol_extent_.createEmpty();
            if (_ol_extent_.intersects(extent1, extent2)) {
                if (extent1[0] > extent2[0]) {
                    intersection[0] = extent1[0];
                } else {
                    intersection[0] = extent2[0];
                }
                if (extent1[1] > extent2[1]) {
                    intersection[1] = extent1[1];
                } else {
                    intersection[1] = extent2[1];
                }
                if (extent1[2] < extent2[2]) {
                    intersection[2] = extent1[2];
                } else {
                    intersection[2] = extent2[2];
                }
                if (extent1[3] < extent2[3]) {
                    intersection[3] = extent1[3];
                } else {
                    intersection[3] = extent2[3];
                }
            }
            return intersection;
        };
        _ol_extent_.getMargin = function(extent) {
            return _ol_extent_.getWidth(extent) + _ol_extent_.getHeight(extent);
        };
        _ol_extent_.getSize = function(extent) {
            return [ extent[2] - extent[0], extent[3] - extent[1] ];
        };
        _ol_extent_.getTopLeft = function(extent) {
            return [ extent[0], extent[3] ];
        };
        _ol_extent_.getTopRight = function(extent) {
            return [ extent[2], extent[3] ];
        };
        _ol_extent_.getWidth = function(extent) {
            return extent[2] - extent[0];
        };
        _ol_extent_.intersects = function(extent1, extent2) {
            return extent1[0] <= extent2[2] && extent1[2] >= extent2[0] && extent1[1] <= extent2[3] && extent1[3] >= extent2[1];
        };
        _ol_extent_.isEmpty = function(extent) {
            return extent[2] < extent[0] || extent[3] < extent[1];
        };
        _ol_extent_.returnOrUpdate = function(extent, opt_extent) {
            if (opt_extent) {
                opt_extent[0] = extent[0];
                opt_extent[1] = extent[1];
                opt_extent[2] = extent[2];
                opt_extent[3] = extent[3];
                return opt_extent;
            } else {
                return extent;
            }
        };
        _ol_extent_.scaleFromCenter = function(extent, value) {
            var deltaX = (extent[2] - extent[0]) / 2 * (value - 1);
            var deltaY = (extent[3] - extent[1]) / 2 * (value - 1);
            extent[0] -= deltaX;
            extent[2] += deltaX;
            extent[1] -= deltaY;
            extent[3] += deltaY;
        };
        _ol_extent_.intersectsSegment = function(extent, start, end) {
            var intersects = false;
            var startRel = _ol_extent_.coordinateRelationship(extent, start);
            var endRel = _ol_extent_.coordinateRelationship(extent, end);
            if (startRel === _relationship2.default.INTERSECTING || endRel === _relationship2.default.INTERSECTING) {
                intersects = true;
            } else {
                var minX = extent[0];
                var minY = extent[1];
                var maxX = extent[2];
                var maxY = extent[3];
                var startX = start[0];
                var startY = start[1];
                var endX = end[0];
                var endY = end[1];
                var slope = (endY - startY) / (endX - startX);
                var x, y;
                if (!!(endRel & _relationship2.default.ABOVE) && !(startRel & _relationship2.default.ABOVE)) {
                    x = endX - (endY - maxY) / slope;
                    intersects = x >= minX && x <= maxX;
                }
                if (!intersects && !!(endRel & _relationship2.default.RIGHT) && !(startRel & _relationship2.default.RIGHT)) {
                    y = endY - (endX - maxX) * slope;
                    intersects = y >= minY && y <= maxY;
                }
                if (!intersects && !!(endRel & _relationship2.default.BELOW) && !(startRel & _relationship2.default.BELOW)) {
                    x = endX - (endY - minY) / slope;
                    intersects = x >= minX && x <= maxX;
                }
                if (!intersects && !!(endRel & _relationship2.default.LEFT) && !(startRel & _relationship2.default.LEFT)) {
                    y = endY - (endX - minX) * slope;
                    intersects = y >= minY && y <= maxY;
                }
            }
            return intersects;
        };
        _ol_extent_.applyTransform = function(extent, transformFn, opt_extent) {
            var coordinates = [ extent[0], extent[1], extent[0], extent[3], extent[2], extent[1], extent[2], extent[3] ];
            transformFn(coordinates, coordinates, 2);
            var xs = [ coordinates[0], coordinates[2], coordinates[4], coordinates[6] ];
            var ys = [ coordinates[1], coordinates[3], coordinates[5], coordinates[7] ];
            return _ol_extent_.boundingExtentXYs_(xs, ys, opt_extent);
        };
        exports.default = _ol_extent_;
    }, {
        "./asserts.js": 31,
        "./extent/corner.js": 55,
        "./extent/relationship.js": 56
    } ],
    55: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_extent_Corner_ = {
            BOTTOM_LEFT: "bottom-left",
            BOTTOM_RIGHT: "bottom-right",
            TOP_LEFT: "top-left",
            TOP_RIGHT: "top-right"
        };
        exports.default = _ol_extent_Corner_;
    }, {} ],
    56: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_extent_Relationship_ = {
            UNKNOWN: 0,
            INTERSECTING: 1,
            ABOVE: 2,
            RIGHT: 4,
            BELOW: 8,
            LEFT: 16
        };
        exports.default = _ol_extent_Relationship_;
    }, {} ],
    57: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _asserts = require("./asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _events = require("./events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("./events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _object = require("./object.js");
        var _object2 = _interopRequireDefault(_object);
        var _geometry = require("./geom/geometry.js");
        var _geometry2 = _interopRequireDefault(_geometry);
        var _style = require("./style/style.js");
        var _style2 = _interopRequireDefault(_style);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_Feature_ = function(opt_geometryOrProperties) {
            _object2.default.call(this);
            this.id_ = undefined;
            this.geometryName_ = "geometry";
            this.style_ = null;
            this.styleFunction_ = undefined;
            this.geometryChangeKey_ = null;
            _events2.default.listen(this, _object2.default.getChangeEventType(this.geometryName_), this.handleGeometryChanged_, this);
            if (opt_geometryOrProperties !== undefined) {
                if (opt_geometryOrProperties instanceof _geometry2.default || !opt_geometryOrProperties) {
                    var geometry = opt_geometryOrProperties;
                    this.setGeometry(geometry);
                } else {
                    var properties = opt_geometryOrProperties;
                    this.setProperties(properties);
                }
            }
        };
        _index2.default.inherits(_ol_Feature_, _object2.default);
        _ol_Feature_.prototype.clone = function() {
            var clone = new _ol_Feature_(this.getProperties());
            clone.setGeometryName(this.getGeometryName());
            var geometry = this.getGeometry();
            if (geometry) {
                clone.setGeometry(geometry.clone());
            }
            var style = this.getStyle();
            if (style) {
                clone.setStyle(style);
            }
            return clone;
        };
        _ol_Feature_.prototype.getGeometry = function() {
            return this.get(this.geometryName_);
        };
        _ol_Feature_.prototype.getId = function() {
            return this.id_;
        };
        _ol_Feature_.prototype.getGeometryName = function() {
            return this.geometryName_;
        };
        _ol_Feature_.prototype.getStyle = function() {
            return this.style_;
        };
        _ol_Feature_.prototype.getStyleFunction = function() {
            return this.styleFunction_;
        };
        _ol_Feature_.prototype.handleGeometryChange_ = function() {
            this.changed();
        };
        _ol_Feature_.prototype.handleGeometryChanged_ = function() {
            if (this.geometryChangeKey_) {
                _events2.default.unlistenByKey(this.geometryChangeKey_);
                this.geometryChangeKey_ = null;
            }
            var geometry = this.getGeometry();
            if (geometry) {
                this.geometryChangeKey_ = _events2.default.listen(geometry, _eventtype2.default.CHANGE, this.handleGeometryChange_, this);
            }
            this.changed();
        };
        _ol_Feature_.prototype.setGeometry = function(geometry) {
            this.set(this.geometryName_, geometry);
        };
        _ol_Feature_.prototype.setStyle = function(style) {
            this.style_ = style;
            this.styleFunction_ = !style ? undefined : _ol_Feature_.createStyleFunction(style);
            this.changed();
        };
        _ol_Feature_.prototype.setId = function(id) {
            this.id_ = id;
            this.changed();
        };
        _ol_Feature_.prototype.setGeometryName = function(name) {
            _events2.default.unlisten(this, _object2.default.getChangeEventType(this.geometryName_), this.handleGeometryChanged_, this);
            this.geometryName_ = name;
            _events2.default.listen(this, _object2.default.getChangeEventType(this.geometryName_), this.handleGeometryChanged_, this);
            this.handleGeometryChanged_();
        };
        _ol_Feature_.createStyleFunction = function(obj) {
            var styleFunction;
            if (typeof obj === "function") {
                if (obj.length == 2) {
                    styleFunction = function(resolution) {
                        return obj(this, resolution);
                    };
                } else {
                    styleFunction = obj;
                }
            } else {
                var styles;
                if (Array.isArray(obj)) {
                    styles = obj;
                } else {
                    _asserts2.default.assert(obj instanceof _style2.default, 41);
                    styles = [ obj ];
                }
                styleFunction = function() {
                    return styles;
                };
            }
            return styleFunction;
        };
        exports.default = _ol_Feature_;
    }, {
        "./asserts.js": 31,
        "./events.js": 48,
        "./events/eventtype.js": 52,
        "./geom/geometry.js": 77,
        "./index.js": 89,
        "./object.js": 125,
        "./style/style.js": 234
    } ],
    58: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _formattype = require("./format/formattype.js");
        var _formattype2 = _interopRequireDefault(_formattype);
        var _xml = require("./xml.js");
        var _xml2 = _interopRequireDefault(_xml);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_featureloader_ = {};
        _ol_featureloader_.loadFeaturesXhr = function(url, format, success, failure) {
            return function(extent, resolution, projection) {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", typeof url === "function" ? url(extent, resolution, projection) : url, true);
                if (format.getType() == _formattype2.default.ARRAY_BUFFER) {
                    xhr.responseType = "arraybuffer";
                }
                xhr.onload = function(event) {
                    if (!xhr.status || xhr.status >= 200 && xhr.status < 300) {
                        var type = format.getType();
                        var source;
                        if (type == _formattype2.default.JSON || type == _formattype2.default.TEXT) {
                            source = xhr.responseText;
                        } else if (type == _formattype2.default.XML) {
                            source = xhr.responseXML;
                            if (!source) {
                                source = _xml2.default.parse(xhr.responseText);
                            }
                        } else if (type == _formattype2.default.ARRAY_BUFFER) {
                            source = xhr.response;
                        }
                        if (source) {
                            success.call(this, format.readFeatures(source, {
                                featureProjection: projection
                            }), format.readProjection(source), format.getLastExtent());
                        } else {
                            failure.call(this);
                        }
                    } else {
                        failure.call(this);
                    }
                }.bind(this);
                xhr.onerror = function() {
                    failure.call(this);
                }.bind(this);
                xhr.send();
            };
        };
        _ol_featureloader_.xhr = function(url, format) {
            return _ol_featureloader_.loadFeaturesXhr(url, format, function(features, dataProjection) {
                this.addFeatures(features);
            }, _index2.default.nullFunction);
        };
        exports.default = _ol_featureloader_;
    }, {
        "./format/formattype.js": 59,
        "./index.js": 89,
        "./xml.js": 255
    } ],
    59: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_format_FormatType_ = {
            ARRAY_BUFFER: "arraybuffer",
            JSON: "json",
            TEXT: "text",
            XML: "xml"
        };
        exports.default = _ol_format_FormatType_;
    }, {} ],
    60: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_functions_ = {};
        _ol_functions_.TRUE = function() {
            return true;
        };
        _ol_functions_.FALSE = function() {
            return false;
        };
        exports.default = _ol_functions_;
    }, {} ],
    61: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_geom_flat_area_ = {};
        _ol_geom_flat_area_.linearRing = function(flatCoordinates, offset, end, stride) {
            var twiceArea = 0;
            var x1 = flatCoordinates[end - stride];
            var y1 = flatCoordinates[end - stride + 1];
            for (;offset < end; offset += stride) {
                var x2 = flatCoordinates[offset];
                var y2 = flatCoordinates[offset + 1];
                twiceArea += y1 * x2 - x1 * y2;
                x1 = x2;
                y1 = y2;
            }
            return twiceArea / 2;
        };
        _ol_geom_flat_area_.linearRings = function(flatCoordinates, offset, ends, stride) {
            var area = 0;
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                var end = ends[i];
                area += _ol_geom_flat_area_.linearRing(flatCoordinates, offset, end, stride);
                offset = end;
            }
            return area;
        };
        _ol_geom_flat_area_.linearRingss = function(flatCoordinates, offset, endss, stride) {
            var area = 0;
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                var ends = endss[i];
                area += _ol_geom_flat_area_.linearRings(flatCoordinates, offset, ends, stride);
                offset = ends[ends.length - 1];
            }
            return area;
        };
        exports.default = _ol_geom_flat_area_;
    }, {} ],
    62: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _math = require("../../math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_flat_closest_ = {};
        _ol_geom_flat_closest_.point = function(flatCoordinates, offset1, offset2, stride, x, y, closestPoint) {
            var x1 = flatCoordinates[offset1];
            var y1 = flatCoordinates[offset1 + 1];
            var dx = flatCoordinates[offset2] - x1;
            var dy = flatCoordinates[offset2 + 1] - y1;
            var i, offset;
            if (dx === 0 && dy === 0) {
                offset = offset1;
            } else {
                var t = ((x - x1) * dx + (y - y1) * dy) / (dx * dx + dy * dy);
                if (t > 1) {
                    offset = offset2;
                } else if (t > 0) {
                    for (i = 0; i < stride; ++i) {
                        closestPoint[i] = _math2.default.lerp(flatCoordinates[offset1 + i], flatCoordinates[offset2 + i], t);
                    }
                    closestPoint.length = stride;
                    return;
                } else {
                    offset = offset1;
                }
            }
            for (i = 0; i < stride; ++i) {
                closestPoint[i] = flatCoordinates[offset + i];
            }
            closestPoint.length = stride;
        };
        _ol_geom_flat_closest_.getMaxSquaredDelta = function(flatCoordinates, offset, end, stride, maxSquaredDelta) {
            var x1 = flatCoordinates[offset];
            var y1 = flatCoordinates[offset + 1];
            for (offset += stride; offset < end; offset += stride) {
                var x2 = flatCoordinates[offset];
                var y2 = flatCoordinates[offset + 1];
                var squaredDelta = _math2.default.squaredDistance(x1, y1, x2, y2);
                if (squaredDelta > maxSquaredDelta) {
                    maxSquaredDelta = squaredDelta;
                }
                x1 = x2;
                y1 = y2;
            }
            return maxSquaredDelta;
        };
        _ol_geom_flat_closest_.getsMaxSquaredDelta = function(flatCoordinates, offset, ends, stride, maxSquaredDelta) {
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                var end = ends[i];
                maxSquaredDelta = _ol_geom_flat_closest_.getMaxSquaredDelta(flatCoordinates, offset, end, stride, maxSquaredDelta);
                offset = end;
            }
            return maxSquaredDelta;
        };
        _ol_geom_flat_closest_.getssMaxSquaredDelta = function(flatCoordinates, offset, endss, stride, maxSquaredDelta) {
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                var ends = endss[i];
                maxSquaredDelta = _ol_geom_flat_closest_.getsMaxSquaredDelta(flatCoordinates, offset, ends, stride, maxSquaredDelta);
                offset = ends[ends.length - 1];
            }
            return maxSquaredDelta;
        };
        _ol_geom_flat_closest_.getClosestPoint = function(flatCoordinates, offset, end, stride, maxDelta, isRing, x, y, closestPoint, minSquaredDistance, opt_tmpPoint) {
            if (offset == end) {
                return minSquaredDistance;
            }
            var i, squaredDistance;
            if (maxDelta === 0) {
                squaredDistance = _math2.default.squaredDistance(x, y, flatCoordinates[offset], flatCoordinates[offset + 1]);
                if (squaredDistance < minSquaredDistance) {
                    for (i = 0; i < stride; ++i) {
                        closestPoint[i] = flatCoordinates[offset + i];
                    }
                    closestPoint.length = stride;
                    return squaredDistance;
                } else {
                    return minSquaredDistance;
                }
            }
            var tmpPoint = opt_tmpPoint ? opt_tmpPoint : [ NaN, NaN ];
            var index = offset + stride;
            while (index < end) {
                _ol_geom_flat_closest_.point(flatCoordinates, index - stride, index, stride, x, y, tmpPoint);
                squaredDistance = _math2.default.squaredDistance(x, y, tmpPoint[0], tmpPoint[1]);
                if (squaredDistance < minSquaredDistance) {
                    minSquaredDistance = squaredDistance;
                    for (i = 0; i < stride; ++i) {
                        closestPoint[i] = tmpPoint[i];
                    }
                    closestPoint.length = stride;
                    index += stride;
                } else {
                    index += stride * Math.max((Math.sqrt(squaredDistance) - Math.sqrt(minSquaredDistance)) / maxDelta | 0, 1);
                }
            }
            if (isRing) {
                _ol_geom_flat_closest_.point(flatCoordinates, end - stride, offset, stride, x, y, tmpPoint);
                squaredDistance = _math2.default.squaredDistance(x, y, tmpPoint[0], tmpPoint[1]);
                if (squaredDistance < minSquaredDistance) {
                    minSquaredDistance = squaredDistance;
                    for (i = 0; i < stride; ++i) {
                        closestPoint[i] = tmpPoint[i];
                    }
                    closestPoint.length = stride;
                }
            }
            return minSquaredDistance;
        };
        _ol_geom_flat_closest_.getsClosestPoint = function(flatCoordinates, offset, ends, stride, maxDelta, isRing, x, y, closestPoint, minSquaredDistance, opt_tmpPoint) {
            var tmpPoint = opt_tmpPoint ? opt_tmpPoint : [ NaN, NaN ];
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                var end = ends[i];
                minSquaredDistance = _ol_geom_flat_closest_.getClosestPoint(flatCoordinates, offset, end, stride, maxDelta, isRing, x, y, closestPoint, minSquaredDistance, tmpPoint);
                offset = end;
            }
            return minSquaredDistance;
        };
        _ol_geom_flat_closest_.getssClosestPoint = function(flatCoordinates, offset, endss, stride, maxDelta, isRing, x, y, closestPoint, minSquaredDistance, opt_tmpPoint) {
            var tmpPoint = opt_tmpPoint ? opt_tmpPoint : [ NaN, NaN ];
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                var ends = endss[i];
                minSquaredDistance = _ol_geom_flat_closest_.getsClosestPoint(flatCoordinates, offset, ends, stride, maxDelta, isRing, x, y, closestPoint, minSquaredDistance, tmpPoint);
                offset = ends[ends.length - 1];
            }
            return minSquaredDistance;
        };
        exports.default = _ol_geom_flat_closest_;
    }, {
        "../../math.js": 123
    } ],
    63: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_flat_contains_ = {};
        _ol_geom_flat_contains_.linearRingContainsExtent = function(flatCoordinates, offset, end, stride, extent) {
            var outside = _extent2.default.forEachCorner(extent, function(coordinate) {
                return !_ol_geom_flat_contains_.linearRingContainsXY(flatCoordinates, offset, end, stride, coordinate[0], coordinate[1]);
            });
            return !outside;
        };
        _ol_geom_flat_contains_.linearRingContainsXY = function(flatCoordinates, offset, end, stride, x, y) {
            var wn = 0;
            var x1 = flatCoordinates[end - stride];
            var y1 = flatCoordinates[end - stride + 1];
            for (;offset < end; offset += stride) {
                var x2 = flatCoordinates[offset];
                var y2 = flatCoordinates[offset + 1];
                if (y1 <= y) {
                    if (y2 > y && (x2 - x1) * (y - y1) - (x - x1) * (y2 - y1) > 0) {
                        wn++;
                    }
                } else if (y2 <= y && (x2 - x1) * (y - y1) - (x - x1) * (y2 - y1) < 0) {
                    wn--;
                }
                x1 = x2;
                y1 = y2;
            }
            return wn !== 0;
        };
        _ol_geom_flat_contains_.linearRingsContainsXY = function(flatCoordinates, offset, ends, stride, x, y) {
            if (ends.length === 0) {
                return false;
            }
            if (!_ol_geom_flat_contains_.linearRingContainsXY(flatCoordinates, offset, ends[0], stride, x, y)) {
                return false;
            }
            var i, ii;
            for (i = 1, ii = ends.length; i < ii; ++i) {
                if (_ol_geom_flat_contains_.linearRingContainsXY(flatCoordinates, ends[i - 1], ends[i], stride, x, y)) {
                    return false;
                }
            }
            return true;
        };
        _ol_geom_flat_contains_.linearRingssContainsXY = function(flatCoordinates, offset, endss, stride, x, y) {
            if (endss.length === 0) {
                return false;
            }
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                var ends = endss[i];
                if (_ol_geom_flat_contains_.linearRingsContainsXY(flatCoordinates, offset, ends, stride, x, y)) {
                    return true;
                }
                offset = ends[ends.length - 1];
            }
            return false;
        };
        exports.default = _ol_geom_flat_contains_;
    }, {
        "../../extent.js": 54
    } ],
    64: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_geom_flat_deflate_ = {};
        _ol_geom_flat_deflate_.coordinate = function(flatCoordinates, offset, coordinate, stride) {
            var i, ii;
            for (i = 0, ii = coordinate.length; i < ii; ++i) {
                flatCoordinates[offset++] = coordinate[i];
            }
            return offset;
        };
        _ol_geom_flat_deflate_.coordinates = function(flatCoordinates, offset, coordinates, stride) {
            var i, ii;
            for (i = 0, ii = coordinates.length; i < ii; ++i) {
                var coordinate = coordinates[i];
                var j;
                for (j = 0; j < stride; ++j) {
                    flatCoordinates[offset++] = coordinate[j];
                }
            }
            return offset;
        };
        _ol_geom_flat_deflate_.coordinatess = function(flatCoordinates, offset, coordinatess, stride, opt_ends) {
            var ends = opt_ends ? opt_ends : [];
            var i = 0;
            var j, jj;
            for (j = 0, jj = coordinatess.length; j < jj; ++j) {
                var end = _ol_geom_flat_deflate_.coordinates(flatCoordinates, offset, coordinatess[j], stride);
                ends[i++] = end;
                offset = end;
            }
            ends.length = i;
            return ends;
        };
        _ol_geom_flat_deflate_.coordinatesss = function(flatCoordinates, offset, coordinatesss, stride, opt_endss) {
            var endss = opt_endss ? opt_endss : [];
            var i = 0;
            var j, jj;
            for (j = 0, jj = coordinatesss.length; j < jj; ++j) {
                var ends = _ol_geom_flat_deflate_.coordinatess(flatCoordinates, offset, coordinatesss[j], stride, endss[i]);
                endss[i++] = ends;
                offset = ends[ends.length - 1];
            }
            endss.length = i;
            return endss;
        };
        exports.default = _ol_geom_flat_deflate_;
    }, {} ],
    65: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_geom_flat_inflate_ = {};
        _ol_geom_flat_inflate_.coordinates = function(flatCoordinates, offset, end, stride, opt_coordinates) {
            var coordinates = opt_coordinates !== undefined ? opt_coordinates : [];
            var i = 0;
            var j;
            for (j = offset; j < end; j += stride) {
                coordinates[i++] = flatCoordinates.slice(j, j + stride);
            }
            coordinates.length = i;
            return coordinates;
        };
        _ol_geom_flat_inflate_.coordinatess = function(flatCoordinates, offset, ends, stride, opt_coordinatess) {
            var coordinatess = opt_coordinatess !== undefined ? opt_coordinatess : [];
            var i = 0;
            var j, jj;
            for (j = 0, jj = ends.length; j < jj; ++j) {
                var end = ends[j];
                coordinatess[i++] = _ol_geom_flat_inflate_.coordinates(flatCoordinates, offset, end, stride, coordinatess[i]);
                offset = end;
            }
            coordinatess.length = i;
            return coordinatess;
        };
        _ol_geom_flat_inflate_.coordinatesss = function(flatCoordinates, offset, endss, stride, opt_coordinatesss) {
            var coordinatesss = opt_coordinatesss !== undefined ? opt_coordinatesss : [];
            var i = 0;
            var j, jj;
            for (j = 0, jj = endss.length; j < jj; ++j) {
                var ends = endss[j];
                coordinatesss[i++] = _ol_geom_flat_inflate_.coordinatess(flatCoordinates, offset, ends, stride, coordinatesss[i]);
                offset = ends[ends.length - 1];
            }
            coordinatesss.length = i;
            return coordinatesss;
        };
        exports.default = _ol_geom_flat_inflate_;
    }, {} ],
    66: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _contains = require("../flat/contains.js");
        var _contains2 = _interopRequireDefault(_contains);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_flat_interiorpoint_ = {};
        _ol_geom_flat_interiorpoint_.linearRings = function(flatCoordinates, offset, ends, stride, flatCenters, flatCentersOffset, opt_dest) {
            var i, ii, x, x1, x2, y1, y2;
            var y = flatCenters[flatCentersOffset + 1];
            var intersections = [];
            for (var r = 0, rr = ends.length; r < rr; ++r) {
                var end = ends[r];
                x1 = flatCoordinates[end - stride];
                y1 = flatCoordinates[end - stride + 1];
                for (i = offset; i < end; i += stride) {
                    x2 = flatCoordinates[i];
                    y2 = flatCoordinates[i + 1];
                    if (y <= y1 && y2 <= y || y1 <= y && y <= y2) {
                        x = (y - y1) / (y2 - y1) * (x2 - x1) + x1;
                        intersections.push(x);
                    }
                    x1 = x2;
                    y1 = y2;
                }
            }
            var pointX = NaN;
            var maxSegmentLength = -Infinity;
            intersections.sort(_array2.default.numberSafeCompareFunction);
            x1 = intersections[0];
            for (i = 1, ii = intersections.length; i < ii; ++i) {
                x2 = intersections[i];
                var segmentLength = Math.abs(x2 - x1);
                if (segmentLength > maxSegmentLength) {
                    x = (x1 + x2) / 2;
                    if (_contains2.default.linearRingsContainsXY(flatCoordinates, offset, ends, stride, x, y)) {
                        pointX = x;
                        maxSegmentLength = segmentLength;
                    }
                }
                x1 = x2;
            }
            if (isNaN(pointX)) {
                pointX = flatCenters[flatCentersOffset];
            }
            if (opt_dest) {
                opt_dest.push(pointX, y, maxSegmentLength);
                return opt_dest;
            } else {
                return [ pointX, y, maxSegmentLength ];
            }
        };
        _ol_geom_flat_interiorpoint_.linearRingss = function(flatCoordinates, offset, endss, stride, flatCenters) {
            var interiorPoints = [];
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                var ends = endss[i];
                interiorPoints = _ol_geom_flat_interiorpoint_.linearRings(flatCoordinates, offset, ends, stride, flatCenters, 2 * i, interiorPoints);
                offset = ends[ends.length - 1];
            }
            return interiorPoints;
        };
        exports.default = _ol_geom_flat_interiorpoint_;
    }, {
        "../../array.js": 29,
        "../flat/contains.js": 63
    } ],
    67: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _contains = require("../flat/contains.js");
        var _contains2 = _interopRequireDefault(_contains);
        var _segments = require("../flat/segments.js");
        var _segments2 = _interopRequireDefault(_segments);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_flat_intersectsextent_ = {};
        _ol_geom_flat_intersectsextent_.lineString = function(flatCoordinates, offset, end, stride, extent) {
            var coordinatesExtent = _extent2.default.extendFlatCoordinates(_extent2.default.createEmpty(), flatCoordinates, offset, end, stride);
            if (!_extent2.default.intersects(extent, coordinatesExtent)) {
                return false;
            }
            if (_extent2.default.containsExtent(extent, coordinatesExtent)) {
                return true;
            }
            if (coordinatesExtent[0] >= extent[0] && coordinatesExtent[2] <= extent[2]) {
                return true;
            }
            if (coordinatesExtent[1] >= extent[1] && coordinatesExtent[3] <= extent[3]) {
                return true;
            }
            return _segments2.default.forEach(flatCoordinates, offset, end, stride, function(point1, point2) {
                return _extent2.default.intersectsSegment(extent, point1, point2);
            });
        };
        _ol_geom_flat_intersectsextent_.lineStrings = function(flatCoordinates, offset, ends, stride, extent) {
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                if (_ol_geom_flat_intersectsextent_.lineString(flatCoordinates, offset, ends[i], stride, extent)) {
                    return true;
                }
                offset = ends[i];
            }
            return false;
        };
        _ol_geom_flat_intersectsextent_.linearRing = function(flatCoordinates, offset, end, stride, extent) {
            if (_ol_geom_flat_intersectsextent_.lineString(flatCoordinates, offset, end, stride, extent)) {
                return true;
            }
            if (_contains2.default.linearRingContainsXY(flatCoordinates, offset, end, stride, extent[0], extent[1])) {
                return true;
            }
            if (_contains2.default.linearRingContainsXY(flatCoordinates, offset, end, stride, extent[0], extent[3])) {
                return true;
            }
            if (_contains2.default.linearRingContainsXY(flatCoordinates, offset, end, stride, extent[2], extent[1])) {
                return true;
            }
            if (_contains2.default.linearRingContainsXY(flatCoordinates, offset, end, stride, extent[2], extent[3])) {
                return true;
            }
            return false;
        };
        _ol_geom_flat_intersectsextent_.linearRings = function(flatCoordinates, offset, ends, stride, extent) {
            if (!_ol_geom_flat_intersectsextent_.linearRing(flatCoordinates, offset, ends[0], stride, extent)) {
                return false;
            }
            if (ends.length === 1) {
                return true;
            }
            var i, ii;
            for (i = 1, ii = ends.length; i < ii; ++i) {
                if (_contains2.default.linearRingContainsExtent(flatCoordinates, ends[i - 1], ends[i], stride, extent)) {
                    return false;
                }
            }
            return true;
        };
        _ol_geom_flat_intersectsextent_.linearRingss = function(flatCoordinates, offset, endss, stride, extent) {
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                var ends = endss[i];
                if (_ol_geom_flat_intersectsextent_.linearRings(flatCoordinates, offset, ends, stride, extent)) {
                    return true;
                }
                offset = ends[ends.length - 1];
            }
            return false;
        };
        exports.default = _ol_geom_flat_intersectsextent_;
    }, {
        "../../extent.js": 54,
        "../flat/contains.js": 63,
        "../flat/segments.js": 71
    } ],
    68: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_geom_flat_length_ = {};
        _ol_geom_flat_length_.lineString = function(flatCoordinates, offset, end, stride) {
            var x1 = flatCoordinates[offset];
            var y1 = flatCoordinates[offset + 1];
            var length = 0;
            var i;
            for (i = offset + stride; i < end; i += stride) {
                var x2 = flatCoordinates[i];
                var y2 = flatCoordinates[i + 1];
                length += Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));
                x1 = x2;
                y1 = y2;
            }
            return length;
        };
        _ol_geom_flat_length_.linearRing = function(flatCoordinates, offset, end, stride) {
            var perimeter = _ol_geom_flat_length_.lineString(flatCoordinates, offset, end, stride);
            var dx = flatCoordinates[end - stride] - flatCoordinates[offset];
            var dy = flatCoordinates[end - stride + 1] - flatCoordinates[offset + 1];
            perimeter += Math.sqrt(dx * dx + dy * dy);
            return perimeter;
        };
        exports.default = _ol_geom_flat_length_;
    }, {} ],
    69: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _reverse = require("../flat/reverse.js");
        var _reverse2 = _interopRequireDefault(_reverse);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_flat_orient_ = {};
        _ol_geom_flat_orient_.linearRingIsClockwise = function(flatCoordinates, offset, end, stride) {
            var edge = 0;
            var x1 = flatCoordinates[end - stride];
            var y1 = flatCoordinates[end - stride + 1];
            for (;offset < end; offset += stride) {
                var x2 = flatCoordinates[offset];
                var y2 = flatCoordinates[offset + 1];
                edge += (x2 - x1) * (y2 + y1);
                x1 = x2;
                y1 = y2;
            }
            return edge > 0;
        };
        _ol_geom_flat_orient_.linearRingsAreOriented = function(flatCoordinates, offset, ends, stride, opt_right) {
            var right = opt_right !== undefined ? opt_right : false;
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                var end = ends[i];
                var isClockwise = _ol_geom_flat_orient_.linearRingIsClockwise(flatCoordinates, offset, end, stride);
                if (i === 0) {
                    if (right && isClockwise || !right && !isClockwise) {
                        return false;
                    }
                } else {
                    if (right && !isClockwise || !right && isClockwise) {
                        return false;
                    }
                }
                offset = end;
            }
            return true;
        };
        _ol_geom_flat_orient_.linearRingssAreOriented = function(flatCoordinates, offset, endss, stride, opt_right) {
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                if (!_ol_geom_flat_orient_.linearRingsAreOriented(flatCoordinates, offset, endss[i], stride, opt_right)) {
                    return false;
                }
            }
            return true;
        };
        _ol_geom_flat_orient_.orientLinearRings = function(flatCoordinates, offset, ends, stride, opt_right) {
            var right = opt_right !== undefined ? opt_right : false;
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                var end = ends[i];
                var isClockwise = _ol_geom_flat_orient_.linearRingIsClockwise(flatCoordinates, offset, end, stride);
                var reverse = i === 0 ? right && isClockwise || !right && !isClockwise : right && !isClockwise || !right && isClockwise;
                if (reverse) {
                    _reverse2.default.coordinates(flatCoordinates, offset, end, stride);
                }
                offset = end;
            }
            return offset;
        };
        _ol_geom_flat_orient_.orientLinearRingss = function(flatCoordinates, offset, endss, stride, opt_right) {
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                offset = _ol_geom_flat_orient_.orientLinearRings(flatCoordinates, offset, endss[i], stride, opt_right);
            }
            return offset;
        };
        exports.default = _ol_geom_flat_orient_;
    }, {
        "../flat/reverse.js": 70
    } ],
    70: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_geom_flat_reverse_ = {};
        _ol_geom_flat_reverse_.coordinates = function(flatCoordinates, offset, end, stride) {
            while (offset < end - stride) {
                var i;
                for (i = 0; i < stride; ++i) {
                    var tmp = flatCoordinates[offset + i];
                    flatCoordinates[offset + i] = flatCoordinates[end - stride + i];
                    flatCoordinates[end - stride + i] = tmp;
                }
                offset += stride;
                end -= stride;
            }
        };
        exports.default = _ol_geom_flat_reverse_;
    }, {} ],
    71: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_geom_flat_segments_ = {};
        _ol_geom_flat_segments_.forEach = function(flatCoordinates, offset, end, stride, callback, opt_this) {
            var point1 = [ flatCoordinates[offset], flatCoordinates[offset + 1] ];
            var point2 = [];
            var ret;
            for (;offset + stride < end; offset += stride) {
                point2[0] = flatCoordinates[offset + stride];
                point2[1] = flatCoordinates[offset + stride + 1];
                ret = callback.call(opt_this, point1, point2);
                if (ret) {
                    return ret;
                }
                point1[0] = point2[0];
                point1[1] = point2[1];
            }
            return false;
        };
        exports.default = _ol_geom_flat_segments_;
    }, {} ],
    72: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _math = require("../../math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_flat_simplify_ = {};
        _ol_geom_flat_simplify_.lineString = function(flatCoordinates, offset, end, stride, squaredTolerance, highQuality, opt_simplifiedFlatCoordinates) {
            var simplifiedFlatCoordinates = opt_simplifiedFlatCoordinates !== undefined ? opt_simplifiedFlatCoordinates : [];
            if (!highQuality) {
                end = _ol_geom_flat_simplify_.radialDistance(flatCoordinates, offset, end, stride, squaredTolerance, simplifiedFlatCoordinates, 0);
                flatCoordinates = simplifiedFlatCoordinates;
                offset = 0;
                stride = 2;
            }
            simplifiedFlatCoordinates.length = _ol_geom_flat_simplify_.douglasPeucker(flatCoordinates, offset, end, stride, squaredTolerance, simplifiedFlatCoordinates, 0);
            return simplifiedFlatCoordinates;
        };
        _ol_geom_flat_simplify_.douglasPeucker = function(flatCoordinates, offset, end, stride, squaredTolerance, simplifiedFlatCoordinates, simplifiedOffset) {
            var n = (end - offset) / stride;
            if (n < 3) {
                for (;offset < end; offset += stride) {
                    simplifiedFlatCoordinates[simplifiedOffset++] = flatCoordinates[offset];
                    simplifiedFlatCoordinates[simplifiedOffset++] = flatCoordinates[offset + 1];
                }
                return simplifiedOffset;
            }
            var markers = new Array(n);
            markers[0] = 1;
            markers[n - 1] = 1;
            var stack = [ offset, end - stride ];
            var index = 0;
            var i;
            while (stack.length > 0) {
                var last = stack.pop();
                var first = stack.pop();
                var maxSquaredDistance = 0;
                var x1 = flatCoordinates[first];
                var y1 = flatCoordinates[first + 1];
                var x2 = flatCoordinates[last];
                var y2 = flatCoordinates[last + 1];
                for (i = first + stride; i < last; i += stride) {
                    var x = flatCoordinates[i];
                    var y = flatCoordinates[i + 1];
                    var squaredDistance = _math2.default.squaredSegmentDistance(x, y, x1, y1, x2, y2);
                    if (squaredDistance > maxSquaredDistance) {
                        index = i;
                        maxSquaredDistance = squaredDistance;
                    }
                }
                if (maxSquaredDistance > squaredTolerance) {
                    markers[(index - offset) / stride] = 1;
                    if (first + stride < index) {
                        stack.push(first, index);
                    }
                    if (index + stride < last) {
                        stack.push(index, last);
                    }
                }
            }
            for (i = 0; i < n; ++i) {
                if (markers[i]) {
                    simplifiedFlatCoordinates[simplifiedOffset++] = flatCoordinates[offset + i * stride];
                    simplifiedFlatCoordinates[simplifiedOffset++] = flatCoordinates[offset + i * stride + 1];
                }
            }
            return simplifiedOffset;
        };
        _ol_geom_flat_simplify_.douglasPeuckers = function(flatCoordinates, offset, ends, stride, squaredTolerance, simplifiedFlatCoordinates, simplifiedOffset, simplifiedEnds) {
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                var end = ends[i];
                simplifiedOffset = _ol_geom_flat_simplify_.douglasPeucker(flatCoordinates, offset, end, stride, squaredTolerance, simplifiedFlatCoordinates, simplifiedOffset);
                simplifiedEnds.push(simplifiedOffset);
                offset = end;
            }
            return simplifiedOffset;
        };
        _ol_geom_flat_simplify_.douglasPeuckerss = function(flatCoordinates, offset, endss, stride, squaredTolerance, simplifiedFlatCoordinates, simplifiedOffset, simplifiedEndss) {
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                var ends = endss[i];
                var simplifiedEnds = [];
                simplifiedOffset = _ol_geom_flat_simplify_.douglasPeuckers(flatCoordinates, offset, ends, stride, squaredTolerance, simplifiedFlatCoordinates, simplifiedOffset, simplifiedEnds);
                simplifiedEndss.push(simplifiedEnds);
                offset = ends[ends.length - 1];
            }
            return simplifiedOffset;
        };
        _ol_geom_flat_simplify_.radialDistance = function(flatCoordinates, offset, end, stride, squaredTolerance, simplifiedFlatCoordinates, simplifiedOffset) {
            if (end <= offset + stride) {
                for (;offset < end; offset += stride) {
                    simplifiedFlatCoordinates[simplifiedOffset++] = flatCoordinates[offset];
                    simplifiedFlatCoordinates[simplifiedOffset++] = flatCoordinates[offset + 1];
                }
                return simplifiedOffset;
            }
            var x1 = flatCoordinates[offset];
            var y1 = flatCoordinates[offset + 1];
            simplifiedFlatCoordinates[simplifiedOffset++] = x1;
            simplifiedFlatCoordinates[simplifiedOffset++] = y1;
            var x2 = x1;
            var y2 = y1;
            for (offset += stride; offset < end; offset += stride) {
                x2 = flatCoordinates[offset];
                y2 = flatCoordinates[offset + 1];
                if (_math2.default.squaredDistance(x1, y1, x2, y2) > squaredTolerance) {
                    simplifiedFlatCoordinates[simplifiedOffset++] = x2;
                    simplifiedFlatCoordinates[simplifiedOffset++] = y2;
                    x1 = x2;
                    y1 = y2;
                }
            }
            if (x2 != x1 || y2 != y1) {
                simplifiedFlatCoordinates[simplifiedOffset++] = x2;
                simplifiedFlatCoordinates[simplifiedOffset++] = y2;
            }
            return simplifiedOffset;
        };
        _ol_geom_flat_simplify_.snap = function(value, tolerance) {
            return tolerance * Math.round(value / tolerance);
        };
        _ol_geom_flat_simplify_.quantize = function(flatCoordinates, offset, end, stride, tolerance, simplifiedFlatCoordinates, simplifiedOffset) {
            if (offset == end) {
                return simplifiedOffset;
            }
            var x1 = _ol_geom_flat_simplify_.snap(flatCoordinates[offset], tolerance);
            var y1 = _ol_geom_flat_simplify_.snap(flatCoordinates[offset + 1], tolerance);
            offset += stride;
            simplifiedFlatCoordinates[simplifiedOffset++] = x1;
            simplifiedFlatCoordinates[simplifiedOffset++] = y1;
            var x2, y2;
            do {
                x2 = _ol_geom_flat_simplify_.snap(flatCoordinates[offset], tolerance);
                y2 = _ol_geom_flat_simplify_.snap(flatCoordinates[offset + 1], tolerance);
                offset += stride;
                if (offset == end) {
                    simplifiedFlatCoordinates[simplifiedOffset++] = x2;
                    simplifiedFlatCoordinates[simplifiedOffset++] = y2;
                    return simplifiedOffset;
                }
            } while (x2 == x1 && y2 == y1);
            while (offset < end) {
                var x3, y3;
                x3 = _ol_geom_flat_simplify_.snap(flatCoordinates[offset], tolerance);
                y3 = _ol_geom_flat_simplify_.snap(flatCoordinates[offset + 1], tolerance);
                offset += stride;
                if (x3 == x2 && y3 == y2) {
                    continue;
                }
                var dx1 = x2 - x1;
                var dy1 = y2 - y1;
                var dx2 = x3 - x1;
                var dy2 = y3 - y1;
                if (dx1 * dy2 == dy1 * dx2 && (dx1 < 0 && dx2 < dx1 || dx1 == dx2 || dx1 > 0 && dx2 > dx1) && (dy1 < 0 && dy2 < dy1 || dy1 == dy2 || dy1 > 0 && dy2 > dy1)) {
                    x2 = x3;
                    y2 = y3;
                    continue;
                }
                simplifiedFlatCoordinates[simplifiedOffset++] = x2;
                simplifiedFlatCoordinates[simplifiedOffset++] = y2;
                x1 = x2;
                y1 = y2;
                x2 = x3;
                y2 = y3;
            }
            simplifiedFlatCoordinates[simplifiedOffset++] = x2;
            simplifiedFlatCoordinates[simplifiedOffset++] = y2;
            return simplifiedOffset;
        };
        _ol_geom_flat_simplify_.quantizes = function(flatCoordinates, offset, ends, stride, tolerance, simplifiedFlatCoordinates, simplifiedOffset, simplifiedEnds) {
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                var end = ends[i];
                simplifiedOffset = _ol_geom_flat_simplify_.quantize(flatCoordinates, offset, end, stride, tolerance, simplifiedFlatCoordinates, simplifiedOffset);
                simplifiedEnds.push(simplifiedOffset);
                offset = end;
            }
            return simplifiedOffset;
        };
        _ol_geom_flat_simplify_.quantizess = function(flatCoordinates, offset, endss, stride, tolerance, simplifiedFlatCoordinates, simplifiedOffset, simplifiedEndss) {
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                var ends = endss[i];
                var simplifiedEnds = [];
                simplifiedOffset = _ol_geom_flat_simplify_.quantizes(flatCoordinates, offset, ends, stride, tolerance, simplifiedFlatCoordinates, simplifiedOffset, simplifiedEnds);
                simplifiedEndss.push(simplifiedEnds);
                offset = ends[ends.length - 1];
            }
            return simplifiedOffset;
        };
        exports.default = _ol_geom_flat_simplify_;
    }, {
        "../../math.js": 123
    } ],
    73: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_geom_flat_straightchunk_ = {};
        _ol_geom_flat_straightchunk_.lineString = function(maxAngle, flatCoordinates, offset, end, stride) {
            var chunkStart = offset;
            var chunkEnd = offset;
            var chunkM = 0;
            var m = 0;
            var start = offset;
            var acos, i, m12, m23, x1, y1, x12, y12, x23, y23;
            for (i = offset; i < end; i += stride) {
                var x2 = flatCoordinates[i];
                var y2 = flatCoordinates[i + 1];
                if (x1 !== undefined) {
                    x23 = x2 - x1;
                    y23 = y2 - y1;
                    m23 = Math.sqrt(x23 * x23 + y23 * y23);
                    if (x12 !== undefined) {
                        m += m12;
                        acos = Math.acos((x12 * x23 + y12 * y23) / (m12 * m23));
                        if (acos > maxAngle) {
                            if (m > chunkM) {
                                chunkM = m;
                                chunkStart = start;
                                chunkEnd = i;
                            }
                            m = 0;
                            start = i - stride;
                        }
                    }
                    m12 = m23;
                    x12 = x23;
                    y12 = y23;
                }
                x1 = x2;
                y1 = y2;
            }
            m += m23;
            return m > chunkM ? [ start, i ] : [ chunkStart, chunkEnd ];
        };
        exports.default = _ol_geom_flat_straightchunk_;
    }, {} ],
    74: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _math = require("../../math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_flat_textpath_ = {};
        _ol_geom_flat_textpath_.lineString = function(flatCoordinates, offset, end, stride, text, measure, startM, maxAngle) {
            var result = [];
            var reverse = flatCoordinates[offset] > flatCoordinates[end - stride];
            var numChars = text.length;
            var x1 = flatCoordinates[offset];
            var y1 = flatCoordinates[offset + 1];
            offset += stride;
            var x2 = flatCoordinates[offset];
            var y2 = flatCoordinates[offset + 1];
            var segmentM = 0;
            var segmentLength = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            var chunk = "";
            var chunkLength = 0;
            var data, index, previousAngle;
            for (var i = 0; i < numChars; ++i) {
                index = reverse ? numChars - i - 1 : i;
                var char = text.charAt(index);
                chunk = reverse ? char + chunk : chunk + char;
                var charLength = measure(chunk) - chunkLength;
                chunkLength += charLength;
                var charM = startM + charLength / 2;
                while (offset < end - stride && segmentM + segmentLength < charM) {
                    x1 = x2;
                    y1 = y2;
                    offset += stride;
                    x2 = flatCoordinates[offset];
                    y2 = flatCoordinates[offset + 1];
                    segmentM += segmentLength;
                    segmentLength = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                }
                var segmentPos = charM - segmentM;
                var angle = Math.atan2(y2 - y1, x2 - x1);
                if (reverse) {
                    angle += angle > 0 ? -Math.PI : Math.PI;
                }
                if (previousAngle !== undefined) {
                    var delta = angle - previousAngle;
                    delta += delta > Math.PI ? -2 * Math.PI : delta < -Math.PI ? 2 * Math.PI : 0;
                    if (Math.abs(delta) > maxAngle) {
                        return null;
                    }
                }
                var interpolate = segmentPos / segmentLength;
                var x = _math2.default.lerp(x1, x2, interpolate);
                var y = _math2.default.lerp(y1, y2, interpolate);
                if (previousAngle == angle) {
                    if (reverse) {
                        data[0] = x;
                        data[1] = y;
                        data[2] = charLength / 2;
                    }
                    data[4] = chunk;
                } else {
                    chunk = char;
                    chunkLength = charLength;
                    data = [ x, y, charLength / 2, angle, chunk ];
                    if (reverse) {
                        result.unshift(data);
                    } else {
                        result.push(data);
                    }
                    previousAngle = angle;
                }
                startM += charLength;
            }
            return result;
        };
        exports.default = _ol_geom_flat_textpath_;
    }, {
        "../../math.js": 123
    } ],
    75: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _area = require("../flat/area.js");
        var _area2 = _interopRequireDefault(_area);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_flat_topology_ = {};
        _ol_geom_flat_topology_.lineStringIsClosed = function(flatCoordinates, offset, end, stride) {
            var lastCoord = end - stride;
            if (flatCoordinates[offset] === flatCoordinates[lastCoord] && flatCoordinates[offset + 1] === flatCoordinates[lastCoord + 1] && (end - offset) / stride > 3) {
                return !!_area2.default.linearRing(flatCoordinates, offset, end, stride);
            }
            return false;
        };
        exports.default = _ol_geom_flat_topology_;
    }, {
        "../flat/area.js": 61
    } ],
    76: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_geom_flat_transform_ = {};
        _ol_geom_flat_transform_.transform2D = function(flatCoordinates, offset, end, stride, transform, opt_dest) {
            var dest = opt_dest ? opt_dest : [];
            var i = 0;
            var j;
            for (j = offset; j < end; j += stride) {
                var x = flatCoordinates[j];
                var y = flatCoordinates[j + 1];
                dest[i++] = transform[0] * x + transform[2] * y + transform[4];
                dest[i++] = transform[1] * x + transform[3] * y + transform[5];
            }
            if (opt_dest && dest.length != i) {
                dest.length = i;
            }
            return dest;
        };
        _ol_geom_flat_transform_.rotate = function(flatCoordinates, offset, end, stride, angle, anchor, opt_dest) {
            var dest = opt_dest ? opt_dest : [];
            var cos = Math.cos(angle);
            var sin = Math.sin(angle);
            var anchorX = anchor[0];
            var anchorY = anchor[1];
            var i = 0;
            for (var j = offset; j < end; j += stride) {
                var deltaX = flatCoordinates[j] - anchorX;
                var deltaY = flatCoordinates[j + 1] - anchorY;
                dest[i++] = anchorX + deltaX * cos - deltaY * sin;
                dest[i++] = anchorY + deltaX * sin + deltaY * cos;
                for (var k = j + 2; k < j + stride; ++k) {
                    dest[i++] = flatCoordinates[k];
                }
            }
            if (opt_dest && dest.length != i) {
                dest.length = i;
            }
            return dest;
        };
        _ol_geom_flat_transform_.scale = function(flatCoordinates, offset, end, stride, sx, sy, anchor, opt_dest) {
            var dest = opt_dest ? opt_dest : [];
            var anchorX = anchor[0];
            var anchorY = anchor[1];
            var i = 0;
            for (var j = offset; j < end; j += stride) {
                var deltaX = flatCoordinates[j] - anchorX;
                var deltaY = flatCoordinates[j + 1] - anchorY;
                dest[i++] = anchorX + sx * deltaX;
                dest[i++] = anchorY + sy * deltaY;
                for (var k = j + 2; k < j + stride; ++k) {
                    dest[i++] = flatCoordinates[k];
                }
            }
            if (opt_dest && dest.length != i) {
                dest.length = i;
            }
            return dest;
        };
        _ol_geom_flat_transform_.translate = function(flatCoordinates, offset, end, stride, deltaX, deltaY, opt_dest) {
            var dest = opt_dest ? opt_dest : [];
            var i = 0;
            var j, k;
            for (j = offset; j < end; j += stride) {
                dest[i++] = flatCoordinates[j] + deltaX;
                dest[i++] = flatCoordinates[j + 1] + deltaY;
                for (k = j + 2; k < j + stride; ++k) {
                    dest[i++] = flatCoordinates[k];
                }
            }
            if (opt_dest && dest.length != i) {
                dest.length = i;
            }
            return dest;
        };
        exports.default = _ol_geom_flat_transform_;
    }, {} ],
    77: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _object = require("../object.js");
        var _object2 = _interopRequireDefault(_object);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _transform = require("../geom/flat/transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _proj = require("../proj.js");
        var _proj2 = _interopRequireDefault(_proj);
        var _units = require("../proj/units.js");
        var _units2 = _interopRequireDefault(_units);
        var _transform3 = require("../transform.js");
        var _transform4 = _interopRequireDefault(_transform3);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_Geometry_ = function() {
            _object2.default.call(this);
            this.extent_ = _extent2.default.createEmpty();
            this.extentRevision_ = -1;
            this.simplifiedGeometryCache = {};
            this.simplifiedGeometryMaxMinSquaredTolerance = 0;
            this.simplifiedGeometryRevision = 0;
            this.tmpTransform_ = _transform4.default.create();
        };
        _index2.default.inherits(_ol_geom_Geometry_, _object2.default);
        _ol_geom_Geometry_.prototype.clone = function() {};
        _ol_geom_Geometry_.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {};
        _ol_geom_Geometry_.prototype.getClosestPoint = function(point, opt_closestPoint) {
            var closestPoint = opt_closestPoint ? opt_closestPoint : [ NaN, NaN ];
            this.closestPointXY(point[0], point[1], closestPoint, Infinity);
            return closestPoint;
        };
        _ol_geom_Geometry_.prototype.intersectsCoordinate = function(coordinate) {
            return this.containsXY(coordinate[0], coordinate[1]);
        };
        _ol_geom_Geometry_.prototype.computeExtent = function(extent) {};
        _ol_geom_Geometry_.prototype.containsXY = _functions2.default.FALSE;
        _ol_geom_Geometry_.prototype.getExtent = function(opt_extent) {
            if (this.extentRevision_ != this.getRevision()) {
                this.extent_ = this.computeExtent(this.extent_);
                this.extentRevision_ = this.getRevision();
            }
            return _extent2.default.returnOrUpdate(this.extent_, opt_extent);
        };
        _ol_geom_Geometry_.prototype.rotate = function(angle, anchor) {};
        _ol_geom_Geometry_.prototype.scale = function(sx, opt_sy, opt_anchor) {};
        _ol_geom_Geometry_.prototype.simplify = function(tolerance) {
            return this.getSimplifiedGeometry(tolerance * tolerance);
        };
        _ol_geom_Geometry_.prototype.getSimplifiedGeometry = function(squaredTolerance) {};
        _ol_geom_Geometry_.prototype.getType = function() {};
        _ol_geom_Geometry_.prototype.applyTransform = function(transformFn) {};
        _ol_geom_Geometry_.prototype.intersectsExtent = function(extent) {};
        _ol_geom_Geometry_.prototype.translate = function(deltaX, deltaY) {};
        _ol_geom_Geometry_.prototype.transform = function(source, destination) {
            var tmpTransform = this.tmpTransform_;
            source = _proj2.default.get(source);
            var transformFn = source.getUnits() == _units2.default.TILE_PIXELS ? function(inCoordinates, outCoordinates, stride) {
                var pixelExtent = source.getExtent();
                var projectedExtent = source.getWorldExtent();
                var scale = _extent2.default.getHeight(projectedExtent) / _extent2.default.getHeight(pixelExtent);
                _transform4.default.compose(tmpTransform, projectedExtent[0], projectedExtent[3], scale, -scale, 0, 0, 0);
                _transform2.default.transform2D(inCoordinates, 0, inCoordinates.length, stride, tmpTransform, outCoordinates);
                return _proj2.default.getTransform(source, destination)(inCoordinates, outCoordinates, stride);
            } : _proj2.default.getTransform(source, destination);
            this.applyTransform(transformFn);
            return this;
        };
        exports.default = _ol_geom_Geometry_;
    }, {
        "../extent.js": 54,
        "../functions.js": 60,
        "../geom/flat/transform.js": 76,
        "../index.js": 89,
        "../object.js": 125,
        "../proj.js": 141,
        "../proj/units.js": 148,
        "../transform.js": 243
    } ],
    78: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_geom_GeometryLayout_ = {
            XY: "XY",
            XYZ: "XYZ",
            XYM: "XYM",
            XYZM: "XYZM"
        };
        exports.default = _ol_geom_GeometryLayout_;
    }, {} ],
    79: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_geom_GeometryType_ = {
            POINT: "Point",
            LINE_STRING: "LineString",
            LINEAR_RING: "LinearRing",
            POLYGON: "Polygon",
            MULTI_POINT: "MultiPoint",
            MULTI_LINE_STRING: "MultiLineString",
            MULTI_POLYGON: "MultiPolygon",
            GEOMETRY_COLLECTION: "GeometryCollection",
            CIRCLE: "Circle"
        };
        exports.default = _ol_geom_GeometryType_;
    }, {} ],
    80: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _geometrylayout = require("../geom/geometrylayout.js");
        var _geometrylayout2 = _interopRequireDefault(_geometrylayout);
        var _geometrytype = require("../geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _simplegeometry = require("../geom/simplegeometry.js");
        var _simplegeometry2 = _interopRequireDefault(_simplegeometry);
        var _area = require("../geom/flat/area.js");
        var _area2 = _interopRequireDefault(_area);
        var _closest = require("../geom/flat/closest.js");
        var _closest2 = _interopRequireDefault(_closest);
        var _deflate = require("../geom/flat/deflate.js");
        var _deflate2 = _interopRequireDefault(_deflate);
        var _inflate = require("../geom/flat/inflate.js");
        var _inflate2 = _interopRequireDefault(_inflate);
        var _simplify = require("../geom/flat/simplify.js");
        var _simplify2 = _interopRequireDefault(_simplify);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_LinearRing_ = function(coordinates, opt_layout) {
            _simplegeometry2.default.call(this);
            this.maxDelta_ = -1;
            this.maxDeltaRevision_ = -1;
            this.setCoordinates(coordinates, opt_layout);
        };
        _index2.default.inherits(_ol_geom_LinearRing_, _simplegeometry2.default);
        _ol_geom_LinearRing_.prototype.clone = function() {
            var linearRing = new _ol_geom_LinearRing_(null);
            linearRing.setFlatCoordinates(this.layout, this.flatCoordinates.slice());
            return linearRing;
        };
        _ol_geom_LinearRing_.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {
            if (minSquaredDistance < _extent2.default.closestSquaredDistanceXY(this.getExtent(), x, y)) {
                return minSquaredDistance;
            }
            if (this.maxDeltaRevision_ != this.getRevision()) {
                this.maxDelta_ = Math.sqrt(_closest2.default.getMaxSquaredDelta(this.flatCoordinates, 0, this.flatCoordinates.length, this.stride, 0));
                this.maxDeltaRevision_ = this.getRevision();
            }
            return _closest2.default.getClosestPoint(this.flatCoordinates, 0, this.flatCoordinates.length, this.stride, this.maxDelta_, true, x, y, closestPoint, minSquaredDistance);
        };
        _ol_geom_LinearRing_.prototype.getArea = function() {
            return _area2.default.linearRing(this.flatCoordinates, 0, this.flatCoordinates.length, this.stride);
        };
        _ol_geom_LinearRing_.prototype.getCoordinates = function() {
            return _inflate2.default.coordinates(this.flatCoordinates, 0, this.flatCoordinates.length, this.stride);
        };
        _ol_geom_LinearRing_.prototype.getSimplifiedGeometryInternal = function(squaredTolerance) {
            var simplifiedFlatCoordinates = [];
            simplifiedFlatCoordinates.length = _simplify2.default.douglasPeucker(this.flatCoordinates, 0, this.flatCoordinates.length, this.stride, squaredTolerance, simplifiedFlatCoordinates, 0);
            var simplifiedLinearRing = new _ol_geom_LinearRing_(null);
            simplifiedLinearRing.setFlatCoordinates(_geometrylayout2.default.XY, simplifiedFlatCoordinates);
            return simplifiedLinearRing;
        };
        _ol_geom_LinearRing_.prototype.getType = function() {
            return _geometrytype2.default.LINEAR_RING;
        };
        _ol_geom_LinearRing_.prototype.intersectsExtent = function(extent) {};
        _ol_geom_LinearRing_.prototype.setCoordinates = function(coordinates, opt_layout) {
            if (!coordinates) {
                this.setFlatCoordinates(_geometrylayout2.default.XY, null);
            } else {
                this.setLayout(opt_layout, coordinates, 1);
                if (!this.flatCoordinates) {
                    this.flatCoordinates = [];
                }
                this.flatCoordinates.length = _deflate2.default.coordinates(this.flatCoordinates, 0, coordinates, this.stride);
                this.changed();
            }
        };
        _ol_geom_LinearRing_.prototype.setFlatCoordinates = function(layout, flatCoordinates) {
            this.setFlatCoordinatesInternal(layout, flatCoordinates);
            this.changed();
        };
        exports.default = _ol_geom_LinearRing_;
    }, {
        "../extent.js": 54,
        "../geom/flat/area.js": 61,
        "../geom/flat/closest.js": 62,
        "../geom/flat/deflate.js": 64,
        "../geom/flat/inflate.js": 65,
        "../geom/flat/simplify.js": 72,
        "../geom/geometrylayout.js": 78,
        "../geom/geometrytype.js": 79,
        "../geom/simplegeometry.js": 83,
        "../index.js": 89
    } ],
    81: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _geometrylayout = require("../geom/geometrylayout.js");
        var _geometrylayout2 = _interopRequireDefault(_geometrylayout);
        var _geometrytype = require("../geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _simplegeometry = require("../geom/simplegeometry.js");
        var _simplegeometry2 = _interopRequireDefault(_simplegeometry);
        var _deflate = require("../geom/flat/deflate.js");
        var _deflate2 = _interopRequireDefault(_deflate);
        var _math = require("../math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_Point_ = function(coordinates, opt_layout) {
            _simplegeometry2.default.call(this);
            this.setCoordinates(coordinates, opt_layout);
        };
        _index2.default.inherits(_ol_geom_Point_, _simplegeometry2.default);
        _ol_geom_Point_.prototype.clone = function() {
            var point = new _ol_geom_Point_(null);
            point.setFlatCoordinates(this.layout, this.flatCoordinates.slice());
            return point;
        };
        _ol_geom_Point_.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {
            var flatCoordinates = this.flatCoordinates;
            var squaredDistance = _math2.default.squaredDistance(x, y, flatCoordinates[0], flatCoordinates[1]);
            if (squaredDistance < minSquaredDistance) {
                var stride = this.stride;
                var i;
                for (i = 0; i < stride; ++i) {
                    closestPoint[i] = flatCoordinates[i];
                }
                closestPoint.length = stride;
                return squaredDistance;
            } else {
                return minSquaredDistance;
            }
        };
        _ol_geom_Point_.prototype.getCoordinates = function() {
            return !this.flatCoordinates ? [] : this.flatCoordinates.slice();
        };
        _ol_geom_Point_.prototype.computeExtent = function(extent) {
            return _extent2.default.createOrUpdateFromCoordinate(this.flatCoordinates, extent);
        };
        _ol_geom_Point_.prototype.getType = function() {
            return _geometrytype2.default.POINT;
        };
        _ol_geom_Point_.prototype.intersectsExtent = function(extent) {
            return _extent2.default.containsXY(extent, this.flatCoordinates[0], this.flatCoordinates[1]);
        };
        _ol_geom_Point_.prototype.setCoordinates = function(coordinates, opt_layout) {
            if (!coordinates) {
                this.setFlatCoordinates(_geometrylayout2.default.XY, null);
            } else {
                this.setLayout(opt_layout, coordinates, 0);
                if (!this.flatCoordinates) {
                    this.flatCoordinates = [];
                }
                this.flatCoordinates.length = _deflate2.default.coordinate(this.flatCoordinates, 0, coordinates, this.stride);
                this.changed();
            }
        };
        _ol_geom_Point_.prototype.setFlatCoordinates = function(layout, flatCoordinates) {
            this.setFlatCoordinatesInternal(layout, flatCoordinates);
            this.changed();
        };
        exports.default = _ol_geom_Point_;
    }, {
        "../extent.js": 54,
        "../geom/flat/deflate.js": 64,
        "../geom/geometrylayout.js": 78,
        "../geom/geometrytype.js": 79,
        "../geom/simplegeometry.js": 83,
        "../index.js": 89,
        "../math.js": 123
    } ],
    82: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _geometrylayout = require("../geom/geometrylayout.js");
        var _geometrylayout2 = _interopRequireDefault(_geometrylayout);
        var _geometrytype = require("../geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _linearring = require("../geom/linearring.js");
        var _linearring2 = _interopRequireDefault(_linearring);
        var _point = require("../geom/point.js");
        var _point2 = _interopRequireDefault(_point);
        var _simplegeometry = require("../geom/simplegeometry.js");
        var _simplegeometry2 = _interopRequireDefault(_simplegeometry);
        var _area = require("../geom/flat/area.js");
        var _area2 = _interopRequireDefault(_area);
        var _closest = require("../geom/flat/closest.js");
        var _closest2 = _interopRequireDefault(_closest);
        var _contains = require("../geom/flat/contains.js");
        var _contains2 = _interopRequireDefault(_contains);
        var _deflate = require("../geom/flat/deflate.js");
        var _deflate2 = _interopRequireDefault(_deflate);
        var _inflate = require("../geom/flat/inflate.js");
        var _inflate2 = _interopRequireDefault(_inflate);
        var _interiorpoint = require("../geom/flat/interiorpoint.js");
        var _interiorpoint2 = _interopRequireDefault(_interiorpoint);
        var _intersectsextent = require("../geom/flat/intersectsextent.js");
        var _intersectsextent2 = _interopRequireDefault(_intersectsextent);
        var _orient = require("../geom/flat/orient.js");
        var _orient2 = _interopRequireDefault(_orient);
        var _simplify = require("../geom/flat/simplify.js");
        var _simplify2 = _interopRequireDefault(_simplify);
        var _math = require("../math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_Polygon_ = function(coordinates, opt_layout) {
            _simplegeometry2.default.call(this);
            this.ends_ = [];
            this.flatInteriorPointRevision_ = -1;
            this.flatInteriorPoint_ = null;
            this.maxDelta_ = -1;
            this.maxDeltaRevision_ = -1;
            this.orientedRevision_ = -1;
            this.orientedFlatCoordinates_ = null;
            this.setCoordinates(coordinates, opt_layout);
        };
        _index2.default.inherits(_ol_geom_Polygon_, _simplegeometry2.default);
        _ol_geom_Polygon_.prototype.appendLinearRing = function(linearRing) {
            if (!this.flatCoordinates) {
                this.flatCoordinates = linearRing.getFlatCoordinates().slice();
            } else {
                _array2.default.extend(this.flatCoordinates, linearRing.getFlatCoordinates());
            }
            this.ends_.push(this.flatCoordinates.length);
            this.changed();
        };
        _ol_geom_Polygon_.prototype.clone = function() {
            var polygon = new _ol_geom_Polygon_(null);
            polygon.setFlatCoordinates(this.layout, this.flatCoordinates.slice(), this.ends_.slice());
            return polygon;
        };
        _ol_geom_Polygon_.prototype.closestPointXY = function(x, y, closestPoint, minSquaredDistance) {
            if (minSquaredDistance < _extent2.default.closestSquaredDistanceXY(this.getExtent(), x, y)) {
                return minSquaredDistance;
            }
            if (this.maxDeltaRevision_ != this.getRevision()) {
                this.maxDelta_ = Math.sqrt(_closest2.default.getsMaxSquaredDelta(this.flatCoordinates, 0, this.ends_, this.stride, 0));
                this.maxDeltaRevision_ = this.getRevision();
            }
            return _closest2.default.getsClosestPoint(this.flatCoordinates, 0, this.ends_, this.stride, this.maxDelta_, true, x, y, closestPoint, minSquaredDistance);
        };
        _ol_geom_Polygon_.prototype.containsXY = function(x, y) {
            return _contains2.default.linearRingsContainsXY(this.getOrientedFlatCoordinates(), 0, this.ends_, this.stride, x, y);
        };
        _ol_geom_Polygon_.prototype.getArea = function() {
            return _area2.default.linearRings(this.getOrientedFlatCoordinates(), 0, this.ends_, this.stride);
        };
        _ol_geom_Polygon_.prototype.getCoordinates = function(opt_right) {
            var flatCoordinates;
            if (opt_right !== undefined) {
                flatCoordinates = this.getOrientedFlatCoordinates().slice();
                _orient2.default.orientLinearRings(flatCoordinates, 0, this.ends_, this.stride, opt_right);
            } else {
                flatCoordinates = this.flatCoordinates;
            }
            return _inflate2.default.coordinatess(flatCoordinates, 0, this.ends_, this.stride);
        };
        _ol_geom_Polygon_.prototype.getEnds = function() {
            return this.ends_;
        };
        _ol_geom_Polygon_.prototype.getFlatInteriorPoint = function() {
            if (this.flatInteriorPointRevision_ != this.getRevision()) {
                var flatCenter = _extent2.default.getCenter(this.getExtent());
                this.flatInteriorPoint_ = _interiorpoint2.default.linearRings(this.getOrientedFlatCoordinates(), 0, this.ends_, this.stride, flatCenter, 0);
                this.flatInteriorPointRevision_ = this.getRevision();
            }
            return this.flatInteriorPoint_;
        };
        _ol_geom_Polygon_.prototype.getInteriorPoint = function() {
            return new _point2.default(this.getFlatInteriorPoint(), _geometrylayout2.default.XYM);
        };
        _ol_geom_Polygon_.prototype.getLinearRingCount = function() {
            return this.ends_.length;
        };
        _ol_geom_Polygon_.prototype.getLinearRing = function(index) {
            if (index < 0 || this.ends_.length <= index) {
                return null;
            }
            var linearRing = new _linearring2.default(null);
            linearRing.setFlatCoordinates(this.layout, this.flatCoordinates.slice(index === 0 ? 0 : this.ends_[index - 1], this.ends_[index]));
            return linearRing;
        };
        _ol_geom_Polygon_.prototype.getLinearRings = function() {
            var layout = this.layout;
            var flatCoordinates = this.flatCoordinates;
            var ends = this.ends_;
            var linearRings = [];
            var offset = 0;
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                var end = ends[i];
                var linearRing = new _linearring2.default(null);
                linearRing.setFlatCoordinates(layout, flatCoordinates.slice(offset, end));
                linearRings.push(linearRing);
                offset = end;
            }
            return linearRings;
        };
        _ol_geom_Polygon_.prototype.getOrientedFlatCoordinates = function() {
            if (this.orientedRevision_ != this.getRevision()) {
                var flatCoordinates = this.flatCoordinates;
                if (_orient2.default.linearRingsAreOriented(flatCoordinates, 0, this.ends_, this.stride)) {
                    this.orientedFlatCoordinates_ = flatCoordinates;
                } else {
                    this.orientedFlatCoordinates_ = flatCoordinates.slice();
                    this.orientedFlatCoordinates_.length = _orient2.default.orientLinearRings(this.orientedFlatCoordinates_, 0, this.ends_, this.stride);
                }
                this.orientedRevision_ = this.getRevision();
            }
            return this.orientedFlatCoordinates_;
        };
        _ol_geom_Polygon_.prototype.getSimplifiedGeometryInternal = function(squaredTolerance) {
            var simplifiedFlatCoordinates = [];
            var simplifiedEnds = [];
            simplifiedFlatCoordinates.length = _simplify2.default.quantizes(this.flatCoordinates, 0, this.ends_, this.stride, Math.sqrt(squaredTolerance), simplifiedFlatCoordinates, 0, simplifiedEnds);
            var simplifiedPolygon = new _ol_geom_Polygon_(null);
            simplifiedPolygon.setFlatCoordinates(_geometrylayout2.default.XY, simplifiedFlatCoordinates, simplifiedEnds);
            return simplifiedPolygon;
        };
        _ol_geom_Polygon_.prototype.getType = function() {
            return _geometrytype2.default.POLYGON;
        };
        _ol_geom_Polygon_.prototype.intersectsExtent = function(extent) {
            return _intersectsextent2.default.linearRings(this.getOrientedFlatCoordinates(), 0, this.ends_, this.stride, extent);
        };
        _ol_geom_Polygon_.prototype.setCoordinates = function(coordinates, opt_layout) {
            if (!coordinates) {
                this.setFlatCoordinates(_geometrylayout2.default.XY, null, this.ends_);
            } else {
                this.setLayout(opt_layout, coordinates, 2);
                if (!this.flatCoordinates) {
                    this.flatCoordinates = [];
                }
                var ends = _deflate2.default.coordinatess(this.flatCoordinates, 0, coordinates, this.stride, this.ends_);
                this.flatCoordinates.length = ends.length === 0 ? 0 : ends[ends.length - 1];
                this.changed();
            }
        };
        _ol_geom_Polygon_.prototype.setFlatCoordinates = function(layout, flatCoordinates, ends) {
            this.setFlatCoordinatesInternal(layout, flatCoordinates);
            this.ends_ = ends;
            this.changed();
        };
        _ol_geom_Polygon_.circular = function(sphere, center, radius, opt_n) {
            var n = opt_n ? opt_n : 32;
            var flatCoordinates = [];
            var i;
            for (i = 0; i < n; ++i) {
                _array2.default.extend(flatCoordinates, sphere.offset(center, radius, 2 * Math.PI * i / n));
            }
            flatCoordinates.push(flatCoordinates[0], flatCoordinates[1]);
            var polygon = new _ol_geom_Polygon_(null);
            polygon.setFlatCoordinates(_geometrylayout2.default.XY, flatCoordinates, [ flatCoordinates.length ]);
            return polygon;
        };
        _ol_geom_Polygon_.fromExtent = function(extent) {
            var minX = extent[0];
            var minY = extent[1];
            var maxX = extent[2];
            var maxY = extent[3];
            var flatCoordinates = [ minX, minY, minX, maxY, maxX, maxY, maxX, minY, minX, minY ];
            var polygon = new _ol_geom_Polygon_(null);
            polygon.setFlatCoordinates(_geometrylayout2.default.XY, flatCoordinates, [ flatCoordinates.length ]);
            return polygon;
        };
        _ol_geom_Polygon_.fromCircle = function(circle, opt_sides, opt_angle) {
            var sides = opt_sides ? opt_sides : 32;
            var stride = circle.getStride();
            var layout = circle.getLayout();
            var polygon = new _ol_geom_Polygon_(null, layout);
            var arrayLength = stride * (sides + 1);
            var flatCoordinates = new Array(arrayLength);
            for (var i = 0; i < arrayLength; i++) {
                flatCoordinates[i] = 0;
            }
            var ends = [ flatCoordinates.length ];
            polygon.setFlatCoordinates(layout, flatCoordinates, ends);
            _ol_geom_Polygon_.makeRegular(polygon, circle.getCenter(), circle.getRadius(), opt_angle);
            return polygon;
        };
        _ol_geom_Polygon_.makeRegular = function(polygon, center, radius, opt_angle) {
            var flatCoordinates = polygon.getFlatCoordinates();
            var layout = polygon.getLayout();
            var stride = polygon.getStride();
            var ends = polygon.getEnds();
            var sides = flatCoordinates.length / stride - 1;
            var startAngle = opt_angle ? opt_angle : 0;
            var angle, offset;
            for (var i = 0; i <= sides; ++i) {
                offset = i * stride;
                angle = startAngle + _math2.default.modulo(i, sides) * 2 * Math.PI / sides;
                flatCoordinates[offset] = center[0] + radius * Math.cos(angle);
                flatCoordinates[offset + 1] = center[1] + radius * Math.sin(angle);
            }
            polygon.setFlatCoordinates(layout, flatCoordinates, ends);
        };
        exports.default = _ol_geom_Polygon_;
    }, {
        "../array.js": 29,
        "../extent.js": 54,
        "../geom/flat/area.js": 61,
        "../geom/flat/closest.js": 62,
        "../geom/flat/contains.js": 63,
        "../geom/flat/deflate.js": 64,
        "../geom/flat/inflate.js": 65,
        "../geom/flat/interiorpoint.js": 66,
        "../geom/flat/intersectsextent.js": 67,
        "../geom/flat/orient.js": 69,
        "../geom/flat/simplify.js": 72,
        "../geom/geometrylayout.js": 78,
        "../geom/geometrytype.js": 79,
        "../geom/linearring.js": 80,
        "../geom/point.js": 81,
        "../geom/simplegeometry.js": 83,
        "../index.js": 89,
        "../math.js": 123
    } ],
    83: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _geometry = require("../geom/geometry.js");
        var _geometry2 = _interopRequireDefault(_geometry);
        var _geometrylayout = require("../geom/geometrylayout.js");
        var _geometrylayout2 = _interopRequireDefault(_geometrylayout);
        var _transform = require("../geom/flat/transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_geom_SimpleGeometry_ = function() {
            _geometry2.default.call(this);
            this.layout = _geometrylayout2.default.XY;
            this.stride = 2;
            this.flatCoordinates = null;
        };
        _index2.default.inherits(_ol_geom_SimpleGeometry_, _geometry2.default);
        _ol_geom_SimpleGeometry_.getLayoutForStride_ = function(stride) {
            var layout;
            if (stride == 2) {
                layout = _geometrylayout2.default.XY;
            } else if (stride == 3) {
                layout = _geometrylayout2.default.XYZ;
            } else if (stride == 4) {
                layout = _geometrylayout2.default.XYZM;
            }
            return layout;
        };
        _ol_geom_SimpleGeometry_.getStrideForLayout = function(layout) {
            var stride;
            if (layout == _geometrylayout2.default.XY) {
                stride = 2;
            } else if (layout == _geometrylayout2.default.XYZ || layout == _geometrylayout2.default.XYM) {
                stride = 3;
            } else if (layout == _geometrylayout2.default.XYZM) {
                stride = 4;
            }
            return stride;
        };
        _ol_geom_SimpleGeometry_.prototype.containsXY = _functions2.default.FALSE;
        _ol_geom_SimpleGeometry_.prototype.computeExtent = function(extent) {
            return _extent2.default.createOrUpdateFromFlatCoordinates(this.flatCoordinates, 0, this.flatCoordinates.length, this.stride, extent);
        };
        _ol_geom_SimpleGeometry_.prototype.getCoordinates = function() {};
        _ol_geom_SimpleGeometry_.prototype.getFirstCoordinate = function() {
            return this.flatCoordinates.slice(0, this.stride);
        };
        _ol_geom_SimpleGeometry_.prototype.getFlatCoordinates = function() {
            return this.flatCoordinates;
        };
        _ol_geom_SimpleGeometry_.prototype.getLastCoordinate = function() {
            return this.flatCoordinates.slice(this.flatCoordinates.length - this.stride);
        };
        _ol_geom_SimpleGeometry_.prototype.getLayout = function() {
            return this.layout;
        };
        _ol_geom_SimpleGeometry_.prototype.getSimplifiedGeometry = function(squaredTolerance) {
            if (this.simplifiedGeometryRevision != this.getRevision()) {
                _obj2.default.clear(this.simplifiedGeometryCache);
                this.simplifiedGeometryMaxMinSquaredTolerance = 0;
                this.simplifiedGeometryRevision = this.getRevision();
            }
            if (squaredTolerance < 0 || this.simplifiedGeometryMaxMinSquaredTolerance !== 0 && squaredTolerance <= this.simplifiedGeometryMaxMinSquaredTolerance) {
                return this;
            }
            var key = squaredTolerance.toString();
            if (this.simplifiedGeometryCache.hasOwnProperty(key)) {
                return this.simplifiedGeometryCache[key];
            } else {
                var simplifiedGeometry = this.getSimplifiedGeometryInternal(squaredTolerance);
                var simplifiedFlatCoordinates = simplifiedGeometry.getFlatCoordinates();
                if (simplifiedFlatCoordinates.length < this.flatCoordinates.length) {
                    this.simplifiedGeometryCache[key] = simplifiedGeometry;
                    return simplifiedGeometry;
                } else {
                    this.simplifiedGeometryMaxMinSquaredTolerance = squaredTolerance;
                    return this;
                }
            }
        };
        _ol_geom_SimpleGeometry_.prototype.getSimplifiedGeometryInternal = function(squaredTolerance) {
            return this;
        };
        _ol_geom_SimpleGeometry_.prototype.getStride = function() {
            return this.stride;
        };
        _ol_geom_SimpleGeometry_.prototype.setFlatCoordinatesInternal = function(layout, flatCoordinates) {
            this.stride = _ol_geom_SimpleGeometry_.getStrideForLayout(layout);
            this.layout = layout;
            this.flatCoordinates = flatCoordinates;
        };
        _ol_geom_SimpleGeometry_.prototype.setCoordinates = function(coordinates, opt_layout) {};
        _ol_geom_SimpleGeometry_.prototype.setLayout = function(layout, coordinates, nesting) {
            var stride;
            if (layout) {
                stride = _ol_geom_SimpleGeometry_.getStrideForLayout(layout);
            } else {
                var i;
                for (i = 0; i < nesting; ++i) {
                    if (coordinates.length === 0) {
                        this.layout = _geometrylayout2.default.XY;
                        this.stride = 2;
                        return;
                    } else {
                        coordinates = coordinates[0];
                    }
                }
                stride = coordinates.length;
                layout = _ol_geom_SimpleGeometry_.getLayoutForStride_(stride);
            }
            this.layout = layout;
            this.stride = stride;
        };
        _ol_geom_SimpleGeometry_.prototype.applyTransform = function(transformFn) {
            if (this.flatCoordinates) {
                transformFn(this.flatCoordinates, this.flatCoordinates, this.stride);
                this.changed();
            }
        };
        _ol_geom_SimpleGeometry_.prototype.rotate = function(angle, anchor) {
            var flatCoordinates = this.getFlatCoordinates();
            if (flatCoordinates) {
                var stride = this.getStride();
                _transform2.default.rotate(flatCoordinates, 0, flatCoordinates.length, stride, angle, anchor, flatCoordinates);
                this.changed();
            }
        };
        _ol_geom_SimpleGeometry_.prototype.scale = function(sx, opt_sy, opt_anchor) {
            var sy = opt_sy;
            if (sy === undefined) {
                sy = sx;
            }
            var anchor = opt_anchor;
            if (!anchor) {
                anchor = _extent2.default.getCenter(this.getExtent());
            }
            var flatCoordinates = this.getFlatCoordinates();
            if (flatCoordinates) {
                var stride = this.getStride();
                _transform2.default.scale(flatCoordinates, 0, flatCoordinates.length, stride, sx, sy, anchor, flatCoordinates);
                this.changed();
            }
        };
        _ol_geom_SimpleGeometry_.prototype.translate = function(deltaX, deltaY) {
            var flatCoordinates = this.getFlatCoordinates();
            if (flatCoordinates) {
                var stride = this.getStride();
                _transform2.default.translate(flatCoordinates, 0, flatCoordinates.length, stride, deltaX, deltaY, flatCoordinates);
                this.changed();
            }
        };
        _ol_geom_SimpleGeometry_.transform2D = function(simpleGeometry, transform, opt_dest) {
            var flatCoordinates = simpleGeometry.getFlatCoordinates();
            if (!flatCoordinates) {
                return null;
            } else {
                var stride = simpleGeometry.getStride();
                return _transform2.default.transform2D(flatCoordinates, 0, flatCoordinates.length, stride, transform, opt_dest);
            }
        };
        exports.default = _ol_geom_SimpleGeometry_;
    }, {
        "../extent.js": 54,
        "../functions.js": 60,
        "../geom/flat/transform.js": 76,
        "../geom/geometry.js": 77,
        "../geom/geometrylayout.js": 78,
        "../index.js": 89,
        "../obj.js": 124
    } ],
    84: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _webgl = require("./webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_has_ = {};
        var ua = typeof navigator !== "undefined" ? navigator.userAgent.toLowerCase() : "";
        _ol_has_.FIREFOX = ua.indexOf("firefox") !== -1;
        _ol_has_.SAFARI = ua.indexOf("safari") !== -1 && ua.indexOf("chrom") == -1;
        _ol_has_.WEBKIT = ua.indexOf("webkit") !== -1 && ua.indexOf("edge") == -1;
        _ol_has_.MAC = ua.indexOf("macintosh") !== -1;
        _ol_has_.DEVICE_PIXEL_RATIO = window.devicePixelRatio || 1;
        _ol_has_.CANVAS_LINE_DASH = false;
        _ol_has_.CANVAS = _index2.default.ENABLE_CANVAS && function() {
            if (!("HTMLCanvasElement" in window)) {
                return false;
            }
            try {
                var context = document.createElement("CANVAS").getContext("2d");
                if (!context) {
                    return false;
                } else {
                    if (context.setLineDash !== undefined) {
                        _ol_has_.CANVAS_LINE_DASH = true;
                    }
                    return true;
                }
            } catch (e) {
                return false;
            }
        }();
        _ol_has_.DEVICE_ORIENTATION = "DeviceOrientationEvent" in window;
        _ol_has_.GEOLOCATION = "geolocation" in navigator;
        _ol_has_.TOUCH = _index2.default.ASSUME_TOUCH || "ontouchstart" in window;
        _ol_has_.POINTER = "PointerEvent" in window;
        _ol_has_.MSPOINTER = !!navigator.msPointerEnabled;
        _ol_has_.WEBGL;
        (function() {
            if (_index2.default.ENABLE_WEBGL) {
                var hasWebGL = false;
                var textureSize;
                var extensions = [];
                if ("WebGLRenderingContext" in window) {
                    try {
                        var canvas = document.createElement("CANVAS");
                        var gl = _webgl2.default.getContext(canvas, {
                            failIfMajorPerformanceCaveat: true
                        });
                        if (gl) {
                            hasWebGL = true;
                            textureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);
                            extensions = gl.getSupportedExtensions();
                        }
                    } catch (e) {}
                }
                _ol_has_.WEBGL = hasWebGL;
                _index2.default.WEBGL_EXTENSIONS = extensions;
                _index2.default.WEBGL_MAX_TEXTURE_SIZE = textureSize;
            }
        })();
        exports.default = _ol_has_;
    }, {
        "./index.js": 89,
        "./webgl.js": 248
    } ],
    85: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _imagebase = require("./imagebase.js");
        var _imagebase2 = _interopRequireDefault(_imagebase);
        var _imagestate = require("./imagestate.js");
        var _imagestate2 = _interopRequireDefault(_imagestate);
        var _events = require("./events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("./events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _extent = require("./extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_Image_ = function(extent, resolution, pixelRatio, src, crossOrigin, imageLoadFunction) {
            _imagebase2.default.call(this, extent, resolution, pixelRatio, _imagestate2.default.IDLE);
            this.src_ = src;
            this.image_ = new Image();
            if (crossOrigin !== null) {
                this.image_.crossOrigin = crossOrigin;
            }
            this.imageListenerKeys_ = null;
            this.state = _imagestate2.default.IDLE;
            this.imageLoadFunction_ = imageLoadFunction;
        };
        _index2.default.inherits(_ol_Image_, _imagebase2.default);
        _ol_Image_.prototype.getImage = function() {
            return this.image_;
        };
        _ol_Image_.prototype.handleImageError_ = function() {
            this.state = _imagestate2.default.ERROR;
            this.unlistenImage_();
            this.changed();
        };
        _ol_Image_.prototype.handleImageLoad_ = function() {
            if (this.resolution === undefined) {
                this.resolution = _extent2.default.getHeight(this.extent) / this.image_.height;
            }
            this.state = _imagestate2.default.LOADED;
            this.unlistenImage_();
            this.changed();
        };
        _ol_Image_.prototype.load = function() {
            if (this.state == _imagestate2.default.IDLE || this.state == _imagestate2.default.ERROR) {
                this.state = _imagestate2.default.LOADING;
                this.changed();
                this.imageListenerKeys_ = [ _events2.default.listenOnce(this.image_, _eventtype2.default.ERROR, this.handleImageError_, this), _events2.default.listenOnce(this.image_, _eventtype2.default.LOAD, this.handleImageLoad_, this) ];
                this.imageLoadFunction_(this, this.src_);
            }
        };
        _ol_Image_.prototype.setImage = function(image) {
            this.image_ = image;
        };
        _ol_Image_.prototype.unlistenImage_ = function() {
            this.imageListenerKeys_.forEach(_events2.default.unlistenByKey);
            this.imageListenerKeys_ = null;
        };
        exports.default = _ol_Image_;
    }, {
        "./events.js": 48,
        "./events/eventtype.js": 52,
        "./extent.js": 54,
        "./imagebase.js": 86,
        "./imagestate.js": 88,
        "./index.js": 89
    } ],
    86: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _eventtarget = require("./events/eventtarget.js");
        var _eventtarget2 = _interopRequireDefault(_eventtarget);
        var _eventtype = require("./events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_ImageBase_ = function(extent, resolution, pixelRatio, state) {
            _eventtarget2.default.call(this);
            this.extent = extent;
            this.pixelRatio_ = pixelRatio;
            this.resolution = resolution;
            this.state = state;
        };
        _index2.default.inherits(_ol_ImageBase_, _eventtarget2.default);
        _ol_ImageBase_.prototype.changed = function() {
            this.dispatchEvent(_eventtype2.default.CHANGE);
        };
        _ol_ImageBase_.prototype.getExtent = function() {
            return this.extent;
        };
        _ol_ImageBase_.prototype.getImage = function() {};
        _ol_ImageBase_.prototype.getPixelRatio = function() {
            return this.pixelRatio_;
        };
        _ol_ImageBase_.prototype.getResolution = function() {
            return this.resolution;
        };
        _ol_ImageBase_.prototype.getState = function() {
            return this.state;
        };
        _ol_ImageBase_.prototype.load = function() {};
        exports.default = _ol_ImageBase_;
    }, {
        "./events/eventtarget.js": 51,
        "./events/eventtype.js": 52,
        "./index.js": 89
    } ],
    87: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _imagebase = require("./imagebase.js");
        var _imagebase2 = _interopRequireDefault(_imagebase);
        var _imagestate = require("./imagestate.js");
        var _imagestate2 = _interopRequireDefault(_imagestate);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_ImageCanvas_ = function(extent, resolution, pixelRatio, canvas, opt_loader) {
            this.loader_ = opt_loader !== undefined ? opt_loader : null;
            var state = opt_loader !== undefined ? _imagestate2.default.IDLE : _imagestate2.default.LOADED;
            _imagebase2.default.call(this, extent, resolution, pixelRatio, state);
            this.canvas_ = canvas;
            this.error_ = null;
        };
        _index2.default.inherits(_ol_ImageCanvas_, _imagebase2.default);
        _ol_ImageCanvas_.prototype.getError = function() {
            return this.error_;
        };
        _ol_ImageCanvas_.prototype.handleLoad_ = function(err) {
            if (err) {
                this.error_ = err;
                this.state = _imagestate2.default.ERROR;
            } else {
                this.state = _imagestate2.default.LOADED;
            }
            this.changed();
        };
        _ol_ImageCanvas_.prototype.load = function() {
            if (this.state == _imagestate2.default.IDLE) {
                this.state = _imagestate2.default.LOADING;
                this.changed();
                this.loader_(this.handleLoad_.bind(this));
            }
        };
        _ol_ImageCanvas_.prototype.getImage = function() {
            return this.canvas_;
        };
        exports.default = _ol_ImageCanvas_;
    }, {
        "./imagebase.js": 86,
        "./imagestate.js": 88,
        "./index.js": 89
    } ],
    88: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_ImageState_ = {
            IDLE: 0,
            LOADING: 1,
            LOADED: 2,
            ERROR: 3
        };
        exports.default = _ol_ImageState_;
    }, {} ],
    89: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_ = {};
        _ol_.ASSUME_TOUCH = false;
        _ol_.DEFAULT_MAX_ZOOM = 42;
        _ol_.DEFAULT_MIN_ZOOM = 0;
        _ol_.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD = .5;
        _ol_.DEFAULT_TILE_SIZE = 256;
        _ol_.DEFAULT_WMS_VERSION = "1.3.0";
        _ol_.ENABLE_CANVAS = true;
        _ol_.ENABLE_PROJ4JS = true;
        _ol_.ENABLE_RASTER_REPROJECTION = true;
        _ol_.ENABLE_WEBGL = true;
        _ol_.DEBUG_WEBGL = true;
        _ol_.INITIAL_ATLAS_SIZE = 256;
        _ol_.MAX_ATLAS_SIZE = -1;
        _ol_.MOUSEWHEELZOOM_MAXDELTA = 1;
        _ol_.OVERVIEWMAP_MAX_RATIO = .75;
        _ol_.OVERVIEWMAP_MIN_RATIO = .1;
        _ol_.RASTER_REPROJECTION_MAX_SOURCE_TILES = 100;
        _ol_.RASTER_REPROJECTION_MAX_SUBDIVISION = 10;
        _ol_.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH = .25;
        _ol_.SIMPLIFY_TOLERANCE = .5;
        _ol_.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK = 1024;
        _ol_.VERSION = "v4.6.4";
        _ol_.WEBGL_MAX_TEXTURE_SIZE;
        _ol_.WEBGL_EXTENSIONS;
        _ol_.inherits = function(childCtor, parentCtor) {
            childCtor.prototype = Object.create(parentCtor.prototype);
            childCtor.prototype.constructor = childCtor;
        };
        _ol_.nullFunction = function() {};
        _ol_.getUid = function(obj) {
            return obj.ol_uid || (obj.ol_uid = ++_ol_.uidCounter_);
        };
        _ol_.uidCounter_ = 0;
        exports.default = _ol_;
    }, {} ],
    90: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _collection = require("./collection.js");
        var _collection2 = _interopRequireDefault(_collection);
        var _kinetic = require("./kinetic.js");
        var _kinetic2 = _interopRequireDefault(_kinetic);
        var _doubleclickzoom = require("./interaction/doubleclickzoom.js");
        var _doubleclickzoom2 = _interopRequireDefault(_doubleclickzoom);
        var _dragpan = require("./interaction/dragpan.js");
        var _dragpan2 = _interopRequireDefault(_dragpan);
        var _dragrotate = require("./interaction/dragrotate.js");
        var _dragrotate2 = _interopRequireDefault(_dragrotate);
        var _dragzoom = require("./interaction/dragzoom.js");
        var _dragzoom2 = _interopRequireDefault(_dragzoom);
        var _keyboardpan = require("./interaction/keyboardpan.js");
        var _keyboardpan2 = _interopRequireDefault(_keyboardpan);
        var _keyboardzoom = require("./interaction/keyboardzoom.js");
        var _keyboardzoom2 = _interopRequireDefault(_keyboardzoom);
        var _mousewheelzoom = require("./interaction/mousewheelzoom.js");
        var _mousewheelzoom2 = _interopRequireDefault(_mousewheelzoom);
        var _pinchrotate = require("./interaction/pinchrotate.js");
        var _pinchrotate2 = _interopRequireDefault(_pinchrotate);
        var _pinchzoom = require("./interaction/pinchzoom.js");
        var _pinchzoom2 = _interopRequireDefault(_pinchzoom);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_ = {};
        _ol_interaction_.defaults = function(opt_options) {
            var options = opt_options ? opt_options : {};
            var interactions = new _collection2.default();
            var kinetic = new _kinetic2.default(-.005, .05, 100);
            var altShiftDragRotate = options.altShiftDragRotate !== undefined ? options.altShiftDragRotate : true;
            if (altShiftDragRotate) {
                interactions.push(new _dragrotate2.default());
            }
            var doubleClickZoom = options.doubleClickZoom !== undefined ? options.doubleClickZoom : true;
            if (doubleClickZoom) {
                interactions.push(new _doubleclickzoom2.default({
                    delta: options.zoomDelta,
                    duration: options.zoomDuration
                }));
            }
            var dragPan = options.dragPan !== undefined ? options.dragPan : true;
            if (dragPan) {
                interactions.push(new _dragpan2.default({
                    kinetic: kinetic
                }));
            }
            var pinchRotate = options.pinchRotate !== undefined ? options.pinchRotate : true;
            if (pinchRotate) {
                interactions.push(new _pinchrotate2.default());
            }
            var pinchZoom = options.pinchZoom !== undefined ? options.pinchZoom : true;
            if (pinchZoom) {
                interactions.push(new _pinchzoom2.default({
                    constrainResolution: options.constrainResolution,
                    duration: options.zoomDuration
                }));
            }
            var keyboard = options.keyboard !== undefined ? options.keyboard : true;
            if (keyboard) {
                interactions.push(new _keyboardpan2.default());
                interactions.push(new _keyboardzoom2.default({
                    delta: options.zoomDelta,
                    duration: options.zoomDuration
                }));
            }
            var mouseWheelZoom = options.mouseWheelZoom !== undefined ? options.mouseWheelZoom : true;
            if (mouseWheelZoom) {
                interactions.push(new _mousewheelzoom2.default({
                    constrainResolution: options.constrainResolution,
                    duration: options.zoomDuration
                }));
            }
            var shiftDragZoom = options.shiftDragZoom !== undefined ? options.shiftDragZoom : true;
            if (shiftDragZoom) {
                interactions.push(new _dragzoom2.default({
                    duration: options.zoomDuration
                }));
            }
            return interactions;
        };
        exports.default = _ol_interaction_;
    }, {
        "./collection.js": 34,
        "./interaction/doubleclickzoom.js": 91,
        "./interaction/dragpan.js": 93,
        "./interaction/dragrotate.js": 94,
        "./interaction/dragzoom.js": 95,
        "./interaction/keyboardpan.js": 97,
        "./interaction/keyboardzoom.js": 98,
        "./interaction/mousewheelzoom.js": 99,
        "./interaction/pinchrotate.js": 100,
        "./interaction/pinchzoom.js": 101,
        "./kinetic.js": 104
    } ],
    91: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _mapbrowsereventtype = require("../mapbrowsereventtype.js");
        var _mapbrowsereventtype2 = _interopRequireDefault(_mapbrowsereventtype);
        var _interaction = require("../interaction/interaction.js");
        var _interaction2 = _interopRequireDefault(_interaction);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_DoubleClickZoom_ = function(opt_options) {
            var options = opt_options ? opt_options : {};
            this.delta_ = options.delta ? options.delta : 1;
            _interaction2.default.call(this, {
                handleEvent: _ol_interaction_DoubleClickZoom_.handleEvent
            });
            this.duration_ = options.duration !== undefined ? options.duration : 250;
        };
        _index2.default.inherits(_ol_interaction_DoubleClickZoom_, _interaction2.default);
        _ol_interaction_DoubleClickZoom_.handleEvent = function(mapBrowserEvent) {
            var stopEvent = false;
            var browserEvent = mapBrowserEvent.originalEvent;
            if (mapBrowserEvent.type == _mapbrowsereventtype2.default.DBLCLICK) {
                var map = mapBrowserEvent.map;
                var anchor = mapBrowserEvent.coordinate;
                var delta = browserEvent.shiftKey ? -this.delta_ : this.delta_;
                var view = map.getView();
                _interaction2.default.zoomByDelta(view, delta, anchor, this.duration_);
                mapBrowserEvent.preventDefault();
                stopEvent = true;
            }
            return !stopEvent;
        };
        exports.default = _ol_interaction_DoubleClickZoom_;
    }, {
        "../index.js": 89,
        "../interaction/interaction.js": 96,
        "../mapbrowsereventtype.js": 118
    } ],
    92: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _event = require("../events/event.js");
        var _event2 = _interopRequireDefault(_event);
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _condition = require("../events/condition.js");
        var _condition2 = _interopRequireDefault(_condition);
        var _pointer = require("../interaction/pointer.js");
        var _pointer2 = _interopRequireDefault(_pointer);
        var _box = require("../render/box.js");
        var _box2 = _interopRequireDefault(_box);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_DragBox_ = function(opt_options) {
            _pointer2.default.call(this, {
                handleDownEvent: _ol_interaction_DragBox_.handleDownEvent_,
                handleDragEvent: _ol_interaction_DragBox_.handleDragEvent_,
                handleUpEvent: _ol_interaction_DragBox_.handleUpEvent_
            });
            var options = opt_options ? opt_options : {};
            this.box_ = new _box2.default(options.className || "ol-dragbox");
            this.minArea_ = options.minArea !== undefined ? options.minArea : 64;
            this.startPixel_ = null;
            this.condition_ = options.condition ? options.condition : _condition2.default.always;
            this.boxEndCondition_ = options.boxEndCondition ? options.boxEndCondition : _ol_interaction_DragBox_.defaultBoxEndCondition;
        };
        _index2.default.inherits(_ol_interaction_DragBox_, _pointer2.default);
        _ol_interaction_DragBox_.defaultBoxEndCondition = function(mapBrowserEvent, startPixel, endPixel) {
            var width = endPixel[0] - startPixel[0];
            var height = endPixel[1] - startPixel[1];
            return width * width + height * height >= this.minArea_;
        };
        _ol_interaction_DragBox_.handleDragEvent_ = function(mapBrowserEvent) {
            if (!_condition2.default.mouseOnly(mapBrowserEvent)) {
                return;
            }
            this.box_.setPixels(this.startPixel_, mapBrowserEvent.pixel);
            this.dispatchEvent(new _ol_interaction_DragBox_.Event(_ol_interaction_DragBox_.EventType_.BOXDRAG, mapBrowserEvent.coordinate, mapBrowserEvent));
        };
        _ol_interaction_DragBox_.prototype.getGeometry = function() {
            return this.box_.getGeometry();
        };
        _ol_interaction_DragBox_.prototype.onBoxEnd = _index2.default.nullFunction;
        _ol_interaction_DragBox_.handleUpEvent_ = function(mapBrowserEvent) {
            if (!_condition2.default.mouseOnly(mapBrowserEvent)) {
                return true;
            }
            this.box_.setMap(null);
            if (this.boxEndCondition_(mapBrowserEvent, this.startPixel_, mapBrowserEvent.pixel)) {
                this.onBoxEnd(mapBrowserEvent);
                this.dispatchEvent(new _ol_interaction_DragBox_.Event(_ol_interaction_DragBox_.EventType_.BOXEND, mapBrowserEvent.coordinate, mapBrowserEvent));
            }
            return false;
        };
        _ol_interaction_DragBox_.handleDownEvent_ = function(mapBrowserEvent) {
            if (!_condition2.default.mouseOnly(mapBrowserEvent)) {
                return false;
            }
            if (_condition2.default.mouseActionButton(mapBrowserEvent) && this.condition_(mapBrowserEvent)) {
                this.startPixel_ = mapBrowserEvent.pixel;
                this.box_.setMap(mapBrowserEvent.map);
                this.box_.setPixels(this.startPixel_, this.startPixel_);
                this.dispatchEvent(new _ol_interaction_DragBox_.Event(_ol_interaction_DragBox_.EventType_.BOXSTART, mapBrowserEvent.coordinate, mapBrowserEvent));
                return true;
            } else {
                return false;
            }
        };
        _ol_interaction_DragBox_.EventType_ = {
            BOXSTART: "boxstart",
            BOXDRAG: "boxdrag",
            BOXEND: "boxend"
        };
        _ol_interaction_DragBox_.Event = function(type, coordinate, mapBrowserEvent) {
            _event2.default.call(this, type);
            this.coordinate = coordinate;
            this.mapBrowserEvent = mapBrowserEvent;
        };
        _index2.default.inherits(_ol_interaction_DragBox_.Event, _event2.default);
        exports.default = _ol_interaction_DragBox_;
    }, {
        "../events/condition.js": 49,
        "../events/event.js": 50,
        "../index.js": 89,
        "../interaction/pointer.js": 102,
        "../render/box.js": 149
    } ],
    93: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _viewhint = require("../viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _coordinate = require("../coordinate.js");
        var _coordinate2 = _interopRequireDefault(_coordinate);
        var _easing = require("../easing.js");
        var _easing2 = _interopRequireDefault(_easing);
        var _condition = require("../events/condition.js");
        var _condition2 = _interopRequireDefault(_condition);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _pointer = require("../interaction/pointer.js");
        var _pointer2 = _interopRequireDefault(_pointer);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_DragPan_ = function(opt_options) {
            _pointer2.default.call(this, {
                handleDownEvent: _ol_interaction_DragPan_.handleDownEvent_,
                handleDragEvent: _ol_interaction_DragPan_.handleDragEvent_,
                handleUpEvent: _ol_interaction_DragPan_.handleUpEvent_
            });
            var options = opt_options ? opt_options : {};
            this.kinetic_ = options.kinetic;
            this.lastCentroid = null;
            this.lastPointersCount_;
            this.condition_ = options.condition ? options.condition : _condition2.default.noModifierKeys;
            this.noKinetic_ = false;
        };
        _index2.default.inherits(_ol_interaction_DragPan_, _pointer2.default);
        _ol_interaction_DragPan_.handleDragEvent_ = function(mapBrowserEvent) {
            var targetPointers = this.targetPointers;
            var centroid = _pointer2.default.centroid(targetPointers);
            if (targetPointers.length == this.lastPointersCount_) {
                if (this.kinetic_) {
                    this.kinetic_.update(centroid[0], centroid[1]);
                }
                if (this.lastCentroid) {
                    var deltaX = this.lastCentroid[0] - centroid[0];
                    var deltaY = centroid[1] - this.lastCentroid[1];
                    var map = mapBrowserEvent.map;
                    var view = map.getView();
                    var viewState = view.getState();
                    var center = [ deltaX, deltaY ];
                    _coordinate2.default.scale(center, viewState.resolution);
                    _coordinate2.default.rotate(center, viewState.rotation);
                    _coordinate2.default.add(center, viewState.center);
                    center = view.constrainCenter(center);
                    view.setCenter(center);
                }
            } else if (this.kinetic_) {
                this.kinetic_.begin();
            }
            this.lastCentroid = centroid;
            this.lastPointersCount_ = targetPointers.length;
        };
        _ol_interaction_DragPan_.handleUpEvent_ = function(mapBrowserEvent) {
            var map = mapBrowserEvent.map;
            var view = map.getView();
            if (this.targetPointers.length === 0) {
                if (!this.noKinetic_ && this.kinetic_ && this.kinetic_.end()) {
                    var distance = this.kinetic_.getDistance();
                    var angle = this.kinetic_.getAngle();
                    var center = view.getCenter();
                    var centerpx = map.getPixelFromCoordinate(center);
                    var dest = map.getCoordinateFromPixel([ centerpx[0] - distance * Math.cos(angle), centerpx[1] - distance * Math.sin(angle) ]);
                    view.animate({
                        center: view.constrainCenter(dest),
                        duration: 500,
                        easing: _easing2.default.easeOut
                    });
                }
                view.setHint(_viewhint2.default.INTERACTING, -1);
                return false;
            } else {
                if (this.kinetic_) {
                    this.kinetic_.begin();
                }
                this.lastCentroid = null;
                return true;
            }
        };
        _ol_interaction_DragPan_.handleDownEvent_ = function(mapBrowserEvent) {
            if (this.targetPointers.length > 0 && this.condition_(mapBrowserEvent)) {
                var map = mapBrowserEvent.map;
                var view = map.getView();
                this.lastCentroid = null;
                if (!this.handlingDownUpSequence) {
                    view.setHint(_viewhint2.default.INTERACTING, 1);
                }
                if (view.getAnimating()) {
                    view.setCenter(mapBrowserEvent.frameState.viewState.center);
                }
                if (this.kinetic_) {
                    this.kinetic_.begin();
                }
                this.noKinetic_ = this.targetPointers.length > 1;
                return true;
            } else {
                return false;
            }
        };
        _ol_interaction_DragPan_.prototype.shouldStopEvent = _functions2.default.FALSE;
        exports.default = _ol_interaction_DragPan_;
    }, {
        "../coordinate.js": 43,
        "../easing.js": 47,
        "../events/condition.js": 49,
        "../functions.js": 60,
        "../index.js": 89,
        "../interaction/pointer.js": 102,
        "../viewhint.js": 246
    } ],
    94: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _rotationconstraint = require("../rotationconstraint.js");
        var _rotationconstraint2 = _interopRequireDefault(_rotationconstraint);
        var _viewhint = require("../viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _condition = require("../events/condition.js");
        var _condition2 = _interopRequireDefault(_condition);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _interaction = require("../interaction/interaction.js");
        var _interaction2 = _interopRequireDefault(_interaction);
        var _pointer = require("../interaction/pointer.js");
        var _pointer2 = _interopRequireDefault(_pointer);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_DragRotate_ = function(opt_options) {
            var options = opt_options ? opt_options : {};
            _pointer2.default.call(this, {
                handleDownEvent: _ol_interaction_DragRotate_.handleDownEvent_,
                handleDragEvent: _ol_interaction_DragRotate_.handleDragEvent_,
                handleUpEvent: _ol_interaction_DragRotate_.handleUpEvent_
            });
            this.condition_ = options.condition ? options.condition : _condition2.default.altShiftKeysOnly;
            this.lastAngle_ = undefined;
            this.duration_ = options.duration !== undefined ? options.duration : 250;
        };
        _index2.default.inherits(_ol_interaction_DragRotate_, _pointer2.default);
        _ol_interaction_DragRotate_.handleDragEvent_ = function(mapBrowserEvent) {
            if (!_condition2.default.mouseOnly(mapBrowserEvent)) {
                return;
            }
            var map = mapBrowserEvent.map;
            var view = map.getView();
            if (view.getConstraints().rotation === _rotationconstraint2.default.disable) {
                return;
            }
            var size = map.getSize();
            var offset = mapBrowserEvent.pixel;
            var theta = Math.atan2(size[1] / 2 - offset[1], offset[0] - size[0] / 2);
            if (this.lastAngle_ !== undefined) {
                var delta = theta - this.lastAngle_;
                var rotation = view.getRotation();
                _interaction2.default.rotateWithoutConstraints(view, rotation - delta);
            }
            this.lastAngle_ = theta;
        };
        _ol_interaction_DragRotate_.handleUpEvent_ = function(mapBrowserEvent) {
            if (!_condition2.default.mouseOnly(mapBrowserEvent)) {
                return true;
            }
            var map = mapBrowserEvent.map;
            var view = map.getView();
            view.setHint(_viewhint2.default.INTERACTING, -1);
            var rotation = view.getRotation();
            _interaction2.default.rotate(view, rotation, undefined, this.duration_);
            return false;
        };
        _ol_interaction_DragRotate_.handleDownEvent_ = function(mapBrowserEvent) {
            if (!_condition2.default.mouseOnly(mapBrowserEvent)) {
                return false;
            }
            if (_condition2.default.mouseActionButton(mapBrowserEvent) && this.condition_(mapBrowserEvent)) {
                var map = mapBrowserEvent.map;
                map.getView().setHint(_viewhint2.default.INTERACTING, 1);
                this.lastAngle_ = undefined;
                return true;
            } else {
                return false;
            }
        };
        _ol_interaction_DragRotate_.prototype.shouldStopEvent = _functions2.default.FALSE;
        exports.default = _ol_interaction_DragRotate_;
    }, {
        "../events/condition.js": 49,
        "../functions.js": 60,
        "../index.js": 89,
        "../interaction/interaction.js": 96,
        "../interaction/pointer.js": 102,
        "../rotationconstraint.js": 207,
        "../viewhint.js": 246
    } ],
    95: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _easing = require("../easing.js");
        var _easing2 = _interopRequireDefault(_easing);
        var _condition = require("../events/condition.js");
        var _condition2 = _interopRequireDefault(_condition);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _dragbox = require("../interaction/dragbox.js");
        var _dragbox2 = _interopRequireDefault(_dragbox);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_DragZoom_ = function(opt_options) {
            var options = opt_options ? opt_options : {};
            var condition = options.condition ? options.condition : _condition2.default.shiftKeyOnly;
            this.duration_ = options.duration !== undefined ? options.duration : 200;
            this.out_ = options.out !== undefined ? options.out : false;
            _dragbox2.default.call(this, {
                condition: condition,
                className: options.className || "ol-dragzoom"
            });
        };
        _index2.default.inherits(_ol_interaction_DragZoom_, _dragbox2.default);
        _ol_interaction_DragZoom_.prototype.onBoxEnd = function() {
            var map = this.getMap();
            var view = map.getView();
            var size = map.getSize();
            var extent = this.getGeometry().getExtent();
            if (this.out_) {
                var mapExtent = view.calculateExtent(size);
                var boxPixelExtent = _extent2.default.createOrUpdateFromCoordinates([ map.getPixelFromCoordinate(_extent2.default.getBottomLeft(extent)), map.getPixelFromCoordinate(_extent2.default.getTopRight(extent)) ]);
                var factor = view.getResolutionForExtent(boxPixelExtent, size);
                _extent2.default.scaleFromCenter(mapExtent, 1 / factor);
                extent = mapExtent;
            }
            var resolution = view.constrainResolution(view.getResolutionForExtent(extent, size));
            var center = _extent2.default.getCenter(extent);
            center = view.constrainCenter(center);
            view.animate({
                resolution: resolution,
                center: center,
                duration: this.duration_,
                easing: _easing2.default.easeOut
            });
        };
        exports.default = _ol_interaction_DragZoom_;
    }, {
        "../easing.js": 47,
        "../events/condition.js": 49,
        "../extent.js": 54,
        "../index.js": 89,
        "../interaction/dragbox.js": 92
    } ],
    96: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _object = require("../object.js");
        var _object2 = _interopRequireDefault(_object);
        var _easing = require("../easing.js");
        var _easing2 = _interopRequireDefault(_easing);
        var _property = require("../interaction/property.js");
        var _property2 = _interopRequireDefault(_property);
        var _math = require("../math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_Interaction_ = function(options) {
            _object2.default.call(this);
            this.map_ = null;
            this.setActive(true);
            this.handleEvent = options.handleEvent;
        };
        _index2.default.inherits(_ol_interaction_Interaction_, _object2.default);
        _ol_interaction_Interaction_.prototype.getActive = function() {
            return this.get(_property2.default.ACTIVE);
        };
        _ol_interaction_Interaction_.prototype.getMap = function() {
            return this.map_;
        };
        _ol_interaction_Interaction_.prototype.setActive = function(active) {
            this.set(_property2.default.ACTIVE, active);
        };
        _ol_interaction_Interaction_.prototype.setMap = function(map) {
            this.map_ = map;
        };
        _ol_interaction_Interaction_.pan = function(view, delta, opt_duration) {
            var currentCenter = view.getCenter();
            if (currentCenter) {
                var center = view.constrainCenter([ currentCenter[0] + delta[0], currentCenter[1] + delta[1] ]);
                if (opt_duration) {
                    view.animate({
                        duration: opt_duration,
                        easing: _easing2.default.linear,
                        center: center
                    });
                } else {
                    view.setCenter(center);
                }
            }
        };
        _ol_interaction_Interaction_.rotate = function(view, rotation, opt_anchor, opt_duration) {
            rotation = view.constrainRotation(rotation, 0);
            _ol_interaction_Interaction_.rotateWithoutConstraints(view, rotation, opt_anchor, opt_duration);
        };
        _ol_interaction_Interaction_.rotateWithoutConstraints = function(view, rotation, opt_anchor, opt_duration) {
            if (rotation !== undefined) {
                var currentRotation = view.getRotation();
                var currentCenter = view.getCenter();
                if (currentRotation !== undefined && currentCenter && opt_duration > 0) {
                    view.animate({
                        rotation: rotation,
                        anchor: opt_anchor,
                        duration: opt_duration,
                        easing: _easing2.default.easeOut
                    });
                } else {
                    view.rotate(rotation, opt_anchor);
                }
            }
        };
        _ol_interaction_Interaction_.zoom = function(view, resolution, opt_anchor, opt_duration, opt_direction) {
            resolution = view.constrainResolution(resolution, 0, opt_direction);
            _ol_interaction_Interaction_.zoomWithoutConstraints(view, resolution, opt_anchor, opt_duration);
        };
        _ol_interaction_Interaction_.zoomByDelta = function(view, delta, opt_anchor, opt_duration) {
            var currentResolution = view.getResolution();
            var resolution = view.constrainResolution(currentResolution, delta, 0);
            if (resolution !== undefined) {
                var resolutions = view.getResolutions();
                resolution = _math2.default.clamp(resolution, view.getMinResolution() || resolutions[resolutions.length - 1], view.getMaxResolution() || resolutions[0]);
            }
            if (opt_anchor && resolution !== undefined && resolution !== currentResolution) {
                var currentCenter = view.getCenter();
                var center = view.calculateCenterZoom(resolution, opt_anchor);
                center = view.constrainCenter(center);
                opt_anchor = [ (resolution * currentCenter[0] - currentResolution * center[0]) / (resolution - currentResolution), (resolution * currentCenter[1] - currentResolution * center[1]) / (resolution - currentResolution) ];
            }
            _ol_interaction_Interaction_.zoomWithoutConstraints(view, resolution, opt_anchor, opt_duration);
        };
        _ol_interaction_Interaction_.zoomWithoutConstraints = function(view, resolution, opt_anchor, opt_duration) {
            if (resolution) {
                var currentResolution = view.getResolution();
                var currentCenter = view.getCenter();
                if (currentResolution !== undefined && currentCenter && resolution !== currentResolution && opt_duration) {
                    view.animate({
                        resolution: resolution,
                        anchor: opt_anchor,
                        duration: opt_duration,
                        easing: _easing2.default.easeOut
                    });
                } else {
                    if (opt_anchor) {
                        var center = view.calculateCenterZoom(resolution, opt_anchor);
                        view.setCenter(center);
                    }
                    view.setResolution(resolution);
                }
            }
        };
        exports.default = _ol_interaction_Interaction_;
    }, {
        "../easing.js": 47,
        "../index.js": 89,
        "../interaction/property.js": 103,
        "../math.js": 123,
        "../object.js": 125
    } ],
    97: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _coordinate = require("../coordinate.js");
        var _coordinate2 = _interopRequireDefault(_coordinate);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _keycode = require("../events/keycode.js");
        var _keycode2 = _interopRequireDefault(_keycode);
        var _condition = require("../events/condition.js");
        var _condition2 = _interopRequireDefault(_condition);
        var _interaction = require("../interaction/interaction.js");
        var _interaction2 = _interopRequireDefault(_interaction);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_KeyboardPan_ = function(opt_options) {
            _interaction2.default.call(this, {
                handleEvent: _ol_interaction_KeyboardPan_.handleEvent
            });
            var options = opt_options || {};
            this.defaultCondition_ = function(mapBrowserEvent) {
                return _condition2.default.noModifierKeys(mapBrowserEvent) && _condition2.default.targetNotEditable(mapBrowserEvent);
            };
            this.condition_ = options.condition !== undefined ? options.condition : this.defaultCondition_;
            this.duration_ = options.duration !== undefined ? options.duration : 100;
            this.pixelDelta_ = options.pixelDelta !== undefined ? options.pixelDelta : 128;
        };
        _index2.default.inherits(_ol_interaction_KeyboardPan_, _interaction2.default);
        _ol_interaction_KeyboardPan_.handleEvent = function(mapBrowserEvent) {
            var stopEvent = false;
            if (mapBrowserEvent.type == _eventtype2.default.KEYDOWN) {
                var keyEvent = mapBrowserEvent.originalEvent;
                var keyCode = keyEvent.keyCode;
                if (this.condition_(mapBrowserEvent) && (keyCode == _keycode2.default.DOWN || keyCode == _keycode2.default.LEFT || keyCode == _keycode2.default.RIGHT || keyCode == _keycode2.default.UP)) {
                    var map = mapBrowserEvent.map;
                    var view = map.getView();
                    var mapUnitsDelta = view.getResolution() * this.pixelDelta_;
                    var deltaX = 0, deltaY = 0;
                    if (keyCode == _keycode2.default.DOWN) {
                        deltaY = -mapUnitsDelta;
                    } else if (keyCode == _keycode2.default.LEFT) {
                        deltaX = -mapUnitsDelta;
                    } else if (keyCode == _keycode2.default.RIGHT) {
                        deltaX = mapUnitsDelta;
                    } else {
                        deltaY = mapUnitsDelta;
                    }
                    var delta = [ deltaX, deltaY ];
                    _coordinate2.default.rotate(delta, view.getRotation());
                    _interaction2.default.pan(view, delta, this.duration_);
                    mapBrowserEvent.preventDefault();
                    stopEvent = true;
                }
            }
            return !stopEvent;
        };
        exports.default = _ol_interaction_KeyboardPan_;
    }, {
        "../coordinate.js": 43,
        "../events/condition.js": 49,
        "../events/eventtype.js": 52,
        "../events/keycode.js": 53,
        "../index.js": 89,
        "../interaction/interaction.js": 96
    } ],
    98: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _condition = require("../events/condition.js");
        var _condition2 = _interopRequireDefault(_condition);
        var _interaction = require("../interaction/interaction.js");
        var _interaction2 = _interopRequireDefault(_interaction);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_KeyboardZoom_ = function(opt_options) {
            _interaction2.default.call(this, {
                handleEvent: _ol_interaction_KeyboardZoom_.handleEvent
            });
            var options = opt_options ? opt_options : {};
            this.condition_ = options.condition ? options.condition : _condition2.default.targetNotEditable;
            this.delta_ = options.delta ? options.delta : 1;
            this.duration_ = options.duration !== undefined ? options.duration : 100;
        };
        _index2.default.inherits(_ol_interaction_KeyboardZoom_, _interaction2.default);
        _ol_interaction_KeyboardZoom_.handleEvent = function(mapBrowserEvent) {
            var stopEvent = false;
            if (mapBrowserEvent.type == _eventtype2.default.KEYDOWN || mapBrowserEvent.type == _eventtype2.default.KEYPRESS) {
                var keyEvent = mapBrowserEvent.originalEvent;
                var charCode = keyEvent.charCode;
                if (this.condition_(mapBrowserEvent) && (charCode == "+".charCodeAt(0) || charCode == "-".charCodeAt(0))) {
                    var map = mapBrowserEvent.map;
                    var delta = charCode == "+".charCodeAt(0) ? this.delta_ : -this.delta_;
                    var view = map.getView();
                    _interaction2.default.zoomByDelta(view, delta, undefined, this.duration_);
                    mapBrowserEvent.preventDefault();
                    stopEvent = true;
                }
            }
            return !stopEvent;
        };
        exports.default = _ol_interaction_KeyboardZoom_;
    }, {
        "../events/condition.js": 49,
        "../events/eventtype.js": 52,
        "../index.js": 89,
        "../interaction/interaction.js": 96
    } ],
    99: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _viewhint = require("../viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _easing = require("../easing.js");
        var _easing2 = _interopRequireDefault(_easing);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _has = require("../has.js");
        var _has2 = _interopRequireDefault(_has);
        var _interaction = require("../interaction/interaction.js");
        var _interaction2 = _interopRequireDefault(_interaction);
        var _math = require("../math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_MouseWheelZoom_ = function(opt_options) {
            _interaction2.default.call(this, {
                handleEvent: _ol_interaction_MouseWheelZoom_.handleEvent
            });
            var options = opt_options || {};
            this.delta_ = 0;
            this.duration_ = options.duration !== undefined ? options.duration : 250;
            this.timeout_ = options.timeout !== undefined ? options.timeout : 80;
            this.useAnchor_ = options.useAnchor !== undefined ? options.useAnchor : true;
            this.constrainResolution_ = options.constrainResolution || false;
            this.lastAnchor_ = null;
            this.startTime_ = undefined;
            this.timeoutId_ = undefined;
            this.mode_ = undefined;
            this.trackpadEventGap_ = 400;
            this.trackpadTimeoutId_ = undefined;
            this.trackpadDeltaPerZoom_ = 300;
            this.trackpadZoomBuffer_ = 1.5;
        };
        _index2.default.inherits(_ol_interaction_MouseWheelZoom_, _interaction2.default);
        _ol_interaction_MouseWheelZoom_.handleEvent = function(mapBrowserEvent) {
            var type = mapBrowserEvent.type;
            if (type !== _eventtype2.default.WHEEL && type !== _eventtype2.default.MOUSEWHEEL) {
                return true;
            }
            mapBrowserEvent.preventDefault();
            var map = mapBrowserEvent.map;
            var wheelEvent = mapBrowserEvent.originalEvent;
            if (this.useAnchor_) {
                this.lastAnchor_ = mapBrowserEvent.coordinate;
            }
            var delta;
            if (mapBrowserEvent.type == _eventtype2.default.WHEEL) {
                delta = wheelEvent.deltaY;
                if (_has2.default.FIREFOX && wheelEvent.deltaMode === WheelEvent.DOM_DELTA_PIXEL) {
                    delta /= _has2.default.DEVICE_PIXEL_RATIO;
                }
                if (wheelEvent.deltaMode === WheelEvent.DOM_DELTA_LINE) {
                    delta *= 40;
                }
            } else if (mapBrowserEvent.type == _eventtype2.default.MOUSEWHEEL) {
                delta = -wheelEvent.wheelDeltaY;
                if (_has2.default.SAFARI) {
                    delta /= 3;
                }
            }
            if (delta === 0) {
                return false;
            }
            var now = Date.now();
            if (this.startTime_ === undefined) {
                this.startTime_ = now;
            }
            if (!this.mode_ || now - this.startTime_ > this.trackpadEventGap_) {
                this.mode_ = Math.abs(delta) < 4 ? _ol_interaction_MouseWheelZoom_.Mode_.TRACKPAD : _ol_interaction_MouseWheelZoom_.Mode_.WHEEL;
            }
            if (this.mode_ === _ol_interaction_MouseWheelZoom_.Mode_.TRACKPAD) {
                var view = map.getView();
                if (this.trackpadTimeoutId_) {
                    clearTimeout(this.trackpadTimeoutId_);
                } else {
                    view.setHint(_viewhint2.default.INTERACTING, 1);
                }
                this.trackpadTimeoutId_ = setTimeout(this.decrementInteractingHint_.bind(this), this.trackpadEventGap_);
                var resolution = view.getResolution() * Math.pow(2, delta / this.trackpadDeltaPerZoom_);
                var minResolution = view.getMinResolution();
                var maxResolution = view.getMaxResolution();
                var rebound = 0;
                if (resolution < minResolution) {
                    resolution = Math.max(resolution, minResolution / this.trackpadZoomBuffer_);
                    rebound = 1;
                } else if (resolution > maxResolution) {
                    resolution = Math.min(resolution, maxResolution * this.trackpadZoomBuffer_);
                    rebound = -1;
                }
                if (this.lastAnchor_) {
                    var center = view.calculateCenterZoom(resolution, this.lastAnchor_);
                    view.setCenter(view.constrainCenter(center));
                }
                view.setResolution(resolution);
                if (rebound === 0 && this.constrainResolution_) {
                    view.animate({
                        resolution: view.constrainResolution(resolution, delta > 0 ? -1 : 1),
                        easing: _easing2.default.easeOut,
                        anchor: this.lastAnchor_,
                        duration: this.duration_
                    });
                }
                if (rebound > 0) {
                    view.animate({
                        resolution: minResolution,
                        easing: _easing2.default.easeOut,
                        anchor: this.lastAnchor_,
                        duration: 500
                    });
                } else if (rebound < 0) {
                    view.animate({
                        resolution: maxResolution,
                        easing: _easing2.default.easeOut,
                        anchor: this.lastAnchor_,
                        duration: 500
                    });
                }
                this.startTime_ = now;
                return false;
            }
            this.delta_ += delta;
            var timeLeft = Math.max(this.timeout_ - (now - this.startTime_), 0);
            clearTimeout(this.timeoutId_);
            this.timeoutId_ = setTimeout(this.handleWheelZoom_.bind(this, map), timeLeft);
            return false;
        };
        _ol_interaction_MouseWheelZoom_.prototype.decrementInteractingHint_ = function() {
            this.trackpadTimeoutId_ = undefined;
            var view = this.getMap().getView();
            view.setHint(_viewhint2.default.INTERACTING, -1);
        };
        _ol_interaction_MouseWheelZoom_.prototype.handleWheelZoom_ = function(map) {
            var view = map.getView();
            if (view.getAnimating()) {
                view.cancelAnimations();
            }
            var maxDelta = _index2.default.MOUSEWHEELZOOM_MAXDELTA;
            var delta = _math2.default.clamp(this.delta_, -maxDelta, maxDelta);
            _interaction2.default.zoomByDelta(view, -delta, this.lastAnchor_, this.duration_);
            this.mode_ = undefined;
            this.delta_ = 0;
            this.lastAnchor_ = null;
            this.startTime_ = undefined;
            this.timeoutId_ = undefined;
        };
        _ol_interaction_MouseWheelZoom_.prototype.setMouseAnchor = function(useAnchor) {
            this.useAnchor_ = useAnchor;
            if (!useAnchor) {
                this.lastAnchor_ = null;
            }
        };
        _ol_interaction_MouseWheelZoom_.Mode_ = {
            TRACKPAD: "trackpad",
            WHEEL: "wheel"
        };
        exports.default = _ol_interaction_MouseWheelZoom_;
    }, {
        "../easing.js": 47,
        "../events/eventtype.js": 52,
        "../has.js": 84,
        "../index.js": 89,
        "../interaction/interaction.js": 96,
        "../math.js": 123,
        "../viewhint.js": 246
    } ],
    100: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _viewhint = require("../viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _interaction = require("../interaction/interaction.js");
        var _interaction2 = _interopRequireDefault(_interaction);
        var _pointer = require("../interaction/pointer.js");
        var _pointer2 = _interopRequireDefault(_pointer);
        var _rotationconstraint = require("../rotationconstraint.js");
        var _rotationconstraint2 = _interopRequireDefault(_rotationconstraint);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_PinchRotate_ = function(opt_options) {
            _pointer2.default.call(this, {
                handleDownEvent: _ol_interaction_PinchRotate_.handleDownEvent_,
                handleDragEvent: _ol_interaction_PinchRotate_.handleDragEvent_,
                handleUpEvent: _ol_interaction_PinchRotate_.handleUpEvent_
            });
            var options = opt_options || {};
            this.anchor_ = null;
            this.lastAngle_ = undefined;
            this.rotating_ = false;
            this.rotationDelta_ = 0;
            this.threshold_ = options.threshold !== undefined ? options.threshold : .3;
            this.duration_ = options.duration !== undefined ? options.duration : 250;
        };
        _index2.default.inherits(_ol_interaction_PinchRotate_, _pointer2.default);
        _ol_interaction_PinchRotate_.handleDragEvent_ = function(mapBrowserEvent) {
            var rotationDelta = 0;
            var touch0 = this.targetPointers[0];
            var touch1 = this.targetPointers[1];
            var angle = Math.atan2(touch1.clientY - touch0.clientY, touch1.clientX - touch0.clientX);
            if (this.lastAngle_ !== undefined) {
                var delta = angle - this.lastAngle_;
                this.rotationDelta_ += delta;
                if (!this.rotating_ && Math.abs(this.rotationDelta_) > this.threshold_) {
                    this.rotating_ = true;
                }
                rotationDelta = delta;
            }
            this.lastAngle_ = angle;
            var map = mapBrowserEvent.map;
            var view = map.getView();
            if (view.getConstraints().rotation === _rotationconstraint2.default.disable) {
                return;
            }
            var viewportPosition = map.getViewport().getBoundingClientRect();
            var centroid = _pointer2.default.centroid(this.targetPointers);
            centroid[0] -= viewportPosition.left;
            centroid[1] -= viewportPosition.top;
            this.anchor_ = map.getCoordinateFromPixel(centroid);
            if (this.rotating_) {
                var rotation = view.getRotation();
                map.render();
                _interaction2.default.rotateWithoutConstraints(view, rotation + rotationDelta, this.anchor_);
            }
        };
        _ol_interaction_PinchRotate_.handleUpEvent_ = function(mapBrowserEvent) {
            if (this.targetPointers.length < 2) {
                var map = mapBrowserEvent.map;
                var view = map.getView();
                view.setHint(_viewhint2.default.INTERACTING, -1);
                if (this.rotating_) {
                    var rotation = view.getRotation();
                    _interaction2.default.rotate(view, rotation, this.anchor_, this.duration_);
                }
                return false;
            } else {
                return true;
            }
        };
        _ol_interaction_PinchRotate_.handleDownEvent_ = function(mapBrowserEvent) {
            if (this.targetPointers.length >= 2) {
                var map = mapBrowserEvent.map;
                this.anchor_ = null;
                this.lastAngle_ = undefined;
                this.rotating_ = false;
                this.rotationDelta_ = 0;
                if (!this.handlingDownUpSequence) {
                    map.getView().setHint(_viewhint2.default.INTERACTING, 1);
                }
                return true;
            } else {
                return false;
            }
        };
        _ol_interaction_PinchRotate_.prototype.shouldStopEvent = _functions2.default.FALSE;
        exports.default = _ol_interaction_PinchRotate_;
    }, {
        "../functions.js": 60,
        "../index.js": 89,
        "../interaction/interaction.js": 96,
        "../interaction/pointer.js": 102,
        "../rotationconstraint.js": 207,
        "../viewhint.js": 246
    } ],
    101: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _viewhint = require("../viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _interaction = require("../interaction/interaction.js");
        var _interaction2 = _interopRequireDefault(_interaction);
        var _pointer = require("../interaction/pointer.js");
        var _pointer2 = _interopRequireDefault(_pointer);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_PinchZoom_ = function(opt_options) {
            _pointer2.default.call(this, {
                handleDownEvent: _ol_interaction_PinchZoom_.handleDownEvent_,
                handleDragEvent: _ol_interaction_PinchZoom_.handleDragEvent_,
                handleUpEvent: _ol_interaction_PinchZoom_.handleUpEvent_
            });
            var options = opt_options ? opt_options : {};
            this.constrainResolution_ = options.constrainResolution || false;
            this.anchor_ = null;
            this.duration_ = options.duration !== undefined ? options.duration : 400;
            this.lastDistance_ = undefined;
            this.lastScaleDelta_ = 1;
        };
        _index2.default.inherits(_ol_interaction_PinchZoom_, _pointer2.default);
        _ol_interaction_PinchZoom_.handleDragEvent_ = function(mapBrowserEvent) {
            var scaleDelta = 1;
            var touch0 = this.targetPointers[0];
            var touch1 = this.targetPointers[1];
            var dx = touch0.clientX - touch1.clientX;
            var dy = touch0.clientY - touch1.clientY;
            var distance = Math.sqrt(dx * dx + dy * dy);
            if (this.lastDistance_ !== undefined) {
                scaleDelta = this.lastDistance_ / distance;
            }
            this.lastDistance_ = distance;
            var map = mapBrowserEvent.map;
            var view = map.getView();
            var resolution = view.getResolution();
            var maxResolution = view.getMaxResolution();
            var minResolution = view.getMinResolution();
            var newResolution = resolution * scaleDelta;
            if (newResolution > maxResolution) {
                scaleDelta = maxResolution / resolution;
                newResolution = maxResolution;
            } else if (newResolution < minResolution) {
                scaleDelta = minResolution / resolution;
                newResolution = minResolution;
            }
            if (scaleDelta != 1) {
                this.lastScaleDelta_ = scaleDelta;
            }
            var viewportPosition = map.getViewport().getBoundingClientRect();
            var centroid = _pointer2.default.centroid(this.targetPointers);
            centroid[0] -= viewportPosition.left;
            centroid[1] -= viewportPosition.top;
            this.anchor_ = map.getCoordinateFromPixel(centroid);
            map.render();
            _interaction2.default.zoomWithoutConstraints(view, newResolution, this.anchor_);
        };
        _ol_interaction_PinchZoom_.handleUpEvent_ = function(mapBrowserEvent) {
            if (this.targetPointers.length < 2) {
                var map = mapBrowserEvent.map;
                var view = map.getView();
                view.setHint(_viewhint2.default.INTERACTING, -1);
                var resolution = view.getResolution();
                if (this.constrainResolution_ || resolution < view.getMinResolution() || resolution > view.getMaxResolution()) {
                    var direction = this.lastScaleDelta_ - 1;
                    _interaction2.default.zoom(view, resolution, this.anchor_, this.duration_, direction);
                }
                return false;
            } else {
                return true;
            }
        };
        _ol_interaction_PinchZoom_.handleDownEvent_ = function(mapBrowserEvent) {
            if (this.targetPointers.length >= 2) {
                var map = mapBrowserEvent.map;
                this.anchor_ = null;
                this.lastDistance_ = undefined;
                this.lastScaleDelta_ = 1;
                if (!this.handlingDownUpSequence) {
                    map.getView().setHint(_viewhint2.default.INTERACTING, 1);
                }
                return true;
            } else {
                return false;
            }
        };
        _ol_interaction_PinchZoom_.prototype.shouldStopEvent = _functions2.default.FALSE;
        exports.default = _ol_interaction_PinchZoom_;
    }, {
        "../functions.js": 60,
        "../index.js": 89,
        "../interaction/interaction.js": 96,
        "../interaction/pointer.js": 102,
        "../viewhint.js": 246
    } ],
    102: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _mapbrowsereventtype = require("../mapbrowsereventtype.js");
        var _mapbrowsereventtype2 = _interopRequireDefault(_mapbrowsereventtype);
        var _mapbrowserpointerevent = require("../mapbrowserpointerevent.js");
        var _mapbrowserpointerevent2 = _interopRequireDefault(_mapbrowserpointerevent);
        var _interaction = require("../interaction/interaction.js");
        var _interaction2 = _interopRequireDefault(_interaction);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_interaction_Pointer_ = function(opt_options) {
            var options = opt_options ? opt_options : {};
            var handleEvent = options.handleEvent ? options.handleEvent : _ol_interaction_Pointer_.handleEvent;
            _interaction2.default.call(this, {
                handleEvent: handleEvent
            });
            this.handleDownEvent_ = options.handleDownEvent ? options.handleDownEvent : _ol_interaction_Pointer_.handleDownEvent;
            this.handleDragEvent_ = options.handleDragEvent ? options.handleDragEvent : _ol_interaction_Pointer_.handleDragEvent;
            this.handleMoveEvent_ = options.handleMoveEvent ? options.handleMoveEvent : _ol_interaction_Pointer_.handleMoveEvent;
            this.handleUpEvent_ = options.handleUpEvent ? options.handleUpEvent : _ol_interaction_Pointer_.handleUpEvent;
            this.handlingDownUpSequence = false;
            this.trackedPointers_ = {};
            this.targetPointers = [];
        };
        _index2.default.inherits(_ol_interaction_Pointer_, _interaction2.default);
        _ol_interaction_Pointer_.centroid = function(pointerEvents) {
            var length = pointerEvents.length;
            var clientX = 0;
            var clientY = 0;
            for (var i = 0; i < length; i++) {
                clientX += pointerEvents[i].clientX;
                clientY += pointerEvents[i].clientY;
            }
            return [ clientX / length, clientY / length ];
        };
        _ol_interaction_Pointer_.prototype.isPointerDraggingEvent_ = function(mapBrowserEvent) {
            var type = mapBrowserEvent.type;
            return type === _mapbrowsereventtype2.default.POINTERDOWN || type === _mapbrowsereventtype2.default.POINTERDRAG || type === _mapbrowsereventtype2.default.POINTERUP;
        };
        _ol_interaction_Pointer_.prototype.updateTrackedPointers_ = function(mapBrowserEvent) {
            if (this.isPointerDraggingEvent_(mapBrowserEvent)) {
                var event = mapBrowserEvent.pointerEvent;
                var id = event.pointerId.toString();
                if (mapBrowserEvent.type == _mapbrowsereventtype2.default.POINTERUP) {
                    delete this.trackedPointers_[id];
                } else if (mapBrowserEvent.type == _mapbrowsereventtype2.default.POINTERDOWN) {
                    this.trackedPointers_[id] = event;
                } else if (id in this.trackedPointers_) {
                    this.trackedPointers_[id] = event;
                }
                this.targetPointers = _obj2.default.getValues(this.trackedPointers_);
            }
        };
        _ol_interaction_Pointer_.handleDragEvent = _index2.default.nullFunction;
        _ol_interaction_Pointer_.handleUpEvent = _functions2.default.FALSE;
        _ol_interaction_Pointer_.handleDownEvent = _functions2.default.FALSE;
        _ol_interaction_Pointer_.handleMoveEvent = _index2.default.nullFunction;
        _ol_interaction_Pointer_.handleEvent = function(mapBrowserEvent) {
            if (!(mapBrowserEvent instanceof _mapbrowserpointerevent2.default)) {
                return true;
            }
            var stopEvent = false;
            this.updateTrackedPointers_(mapBrowserEvent);
            if (this.handlingDownUpSequence) {
                if (mapBrowserEvent.type == _mapbrowsereventtype2.default.POINTERDRAG) {
                    this.handleDragEvent_(mapBrowserEvent);
                } else if (mapBrowserEvent.type == _mapbrowsereventtype2.default.POINTERUP) {
                    var handledUp = this.handleUpEvent_(mapBrowserEvent);
                    this.handlingDownUpSequence = handledUp && this.targetPointers.length > 0;
                }
            } else {
                if (mapBrowserEvent.type == _mapbrowsereventtype2.default.POINTERDOWN) {
                    var handled = this.handleDownEvent_(mapBrowserEvent);
                    this.handlingDownUpSequence = handled;
                    stopEvent = this.shouldStopEvent(handled);
                } else if (mapBrowserEvent.type == _mapbrowsereventtype2.default.POINTERMOVE) {
                    this.handleMoveEvent_(mapBrowserEvent);
                }
            }
            return !stopEvent;
        };
        _ol_interaction_Pointer_.prototype.shouldStopEvent = function(handled) {
            return handled;
        };
        exports.default = _ol_interaction_Pointer_;
    }, {
        "../functions.js": 60,
        "../index.js": 89,
        "../interaction/interaction.js": 96,
        "../mapbrowsereventtype.js": 118,
        "../mapbrowserpointerevent.js": 119,
        "../obj.js": 124
    } ],
    103: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_interaction_Property_ = {
            ACTIVE: "active"
        };
        exports.default = _ol_interaction_Property_;
    }, {} ],
    104: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_Kinetic_ = function(decay, minVelocity, delay) {
            this.decay_ = decay;
            this.minVelocity_ = minVelocity;
            this.delay_ = delay;
            this.points_ = [];
            this.angle_ = 0;
            this.initialVelocity_ = 0;
        };
        _ol_Kinetic_.prototype.begin = function() {
            this.points_.length = 0;
            this.angle_ = 0;
            this.initialVelocity_ = 0;
        };
        _ol_Kinetic_.prototype.update = function(x, y) {
            this.points_.push(x, y, Date.now());
        };
        _ol_Kinetic_.prototype.end = function() {
            if (this.points_.length < 6) {
                return false;
            }
            var delay = Date.now() - this.delay_;
            var lastIndex = this.points_.length - 3;
            if (this.points_[lastIndex + 2] < delay) {
                return false;
            }
            var firstIndex = lastIndex - 3;
            while (firstIndex > 0 && this.points_[firstIndex + 2] > delay) {
                firstIndex -= 3;
            }
            var duration = this.points_[lastIndex + 2] - this.points_[firstIndex + 2];
            if (duration < 1e3 / 60) {
                return false;
            }
            var dx = this.points_[lastIndex] - this.points_[firstIndex];
            var dy = this.points_[lastIndex + 1] - this.points_[firstIndex + 1];
            this.angle_ = Math.atan2(dy, dx);
            this.initialVelocity_ = Math.sqrt(dx * dx + dy * dy) / duration;
            return this.initialVelocity_ > this.minVelocity_;
        };
        _ol_Kinetic_.prototype.getDistance = function() {
            return (this.minVelocity_ - this.initialVelocity_) / this.decay_;
        };
        _ol_Kinetic_.prototype.getAngle = function() {
            return this.angle_;
        };
        exports.default = _ol_Kinetic_;
    }, {} ],
    105: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _object = require("../object.js");
        var _object2 = _interopRequireDefault(_object);
        var _property = require("../layer/property.js");
        var _property2 = _interopRequireDefault(_property);
        var _math = require("../math.js");
        var _math2 = _interopRequireDefault(_math);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_layer_Base_ = function(options) {
            _object2.default.call(this);
            var properties = _obj2.default.assign({}, options);
            properties[_property2.default.OPACITY] = options.opacity !== undefined ? options.opacity : 1;
            properties[_property2.default.VISIBLE] = options.visible !== undefined ? options.visible : true;
            properties[_property2.default.Z_INDEX] = options.zIndex !== undefined ? options.zIndex : 0;
            properties[_property2.default.MAX_RESOLUTION] = options.maxResolution !== undefined ? options.maxResolution : Infinity;
            properties[_property2.default.MIN_RESOLUTION] = options.minResolution !== undefined ? options.minResolution : 0;
            this.setProperties(properties);
            this.state_ = {
                layer: this,
                managed: true
            };
            this.type;
        };
        _index2.default.inherits(_ol_layer_Base_, _object2.default);
        _ol_layer_Base_.prototype.getType = function() {
            return this.type;
        };
        _ol_layer_Base_.prototype.getLayerState = function() {
            this.state_.opacity = _math2.default.clamp(this.getOpacity(), 0, 1);
            this.state_.sourceState = this.getSourceState();
            this.state_.visible = this.getVisible();
            this.state_.extent = this.getExtent();
            this.state_.zIndex = this.getZIndex();
            this.state_.maxResolution = this.getMaxResolution();
            this.state_.minResolution = Math.max(this.getMinResolution(), 0);
            return this.state_;
        };
        _ol_layer_Base_.prototype.getLayersArray = function(opt_array) {};
        _ol_layer_Base_.prototype.getLayerStatesArray = function(opt_states) {};
        _ol_layer_Base_.prototype.getExtent = function() {
            return this.get(_property2.default.EXTENT);
        };
        _ol_layer_Base_.prototype.getMaxResolution = function() {
            return this.get(_property2.default.MAX_RESOLUTION);
        };
        _ol_layer_Base_.prototype.getMinResolution = function() {
            return this.get(_property2.default.MIN_RESOLUTION);
        };
        _ol_layer_Base_.prototype.getOpacity = function() {
            return this.get(_property2.default.OPACITY);
        };
        _ol_layer_Base_.prototype.getSourceState = function() {};
        _ol_layer_Base_.prototype.getVisible = function() {
            return this.get(_property2.default.VISIBLE);
        };
        _ol_layer_Base_.prototype.getZIndex = function() {
            return this.get(_property2.default.Z_INDEX);
        };
        _ol_layer_Base_.prototype.setExtent = function(extent) {
            this.set(_property2.default.EXTENT, extent);
        };
        _ol_layer_Base_.prototype.setMaxResolution = function(maxResolution) {
            this.set(_property2.default.MAX_RESOLUTION, maxResolution);
        };
        _ol_layer_Base_.prototype.setMinResolution = function(minResolution) {
            this.set(_property2.default.MIN_RESOLUTION, minResolution);
        };
        _ol_layer_Base_.prototype.setOpacity = function(opacity) {
            this.set(_property2.default.OPACITY, opacity);
        };
        _ol_layer_Base_.prototype.setVisible = function(visible) {
            this.set(_property2.default.VISIBLE, visible);
        };
        _ol_layer_Base_.prototype.setZIndex = function(zindex) {
            this.set(_property2.default.Z_INDEX, zindex);
        };
        exports.default = _ol_layer_Base_;
    }, {
        "../index.js": 89,
        "../layer/property.js": 109,
        "../math.js": 123,
        "../obj.js": 124,
        "../object.js": 125
    } ],
    106: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _collection = require("../collection.js");
        var _collection2 = _interopRequireDefault(_collection);
        var _collectioneventtype = require("../collectioneventtype.js");
        var _collectioneventtype2 = _interopRequireDefault(_collectioneventtype);
        var _object = require("../object.js");
        var _object2 = _interopRequireDefault(_object);
        var _objecteventtype = require("../objecteventtype.js");
        var _objecteventtype2 = _interopRequireDefault(_objecteventtype);
        var _asserts = require("../asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _base = require("../layer/base.js");
        var _base2 = _interopRequireDefault(_base);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _state = require("../source/state.js");
        var _state2 = _interopRequireDefault(_state);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_layer_Group_ = function(opt_options) {
            var options = opt_options || {};
            var baseOptions = _obj2.default.assign({}, options);
            delete baseOptions.layers;
            var layers = options.layers;
            _base2.default.call(this, baseOptions);
            this.layersListenerKeys_ = [];
            this.listenerKeys_ = {};
            _events2.default.listen(this, _object2.default.getChangeEventType(_ol_layer_Group_.Property_.LAYERS), this.handleLayersChanged_, this);
            if (layers) {
                if (Array.isArray(layers)) {
                    layers = new _collection2.default(layers.slice(), {
                        unique: true
                    });
                } else {
                    _asserts2.default.assert(layers instanceof _collection2.default, 43);
                    layers = layers;
                }
            } else {
                layers = new _collection2.default(undefined, {
                    unique: true
                });
            }
            this.setLayers(layers);
        };
        _index2.default.inherits(_ol_layer_Group_, _base2.default);
        _ol_layer_Group_.prototype.handleLayerChange_ = function() {
            this.changed();
        };
        _ol_layer_Group_.prototype.handleLayersChanged_ = function(event) {
            this.layersListenerKeys_.forEach(_events2.default.unlistenByKey);
            this.layersListenerKeys_.length = 0;
            var layers = this.getLayers();
            this.layersListenerKeys_.push(_events2.default.listen(layers, _collectioneventtype2.default.ADD, this.handleLayersAdd_, this), _events2.default.listen(layers, _collectioneventtype2.default.REMOVE, this.handleLayersRemove_, this));
            for (var id in this.listenerKeys_) {
                this.listenerKeys_[id].forEach(_events2.default.unlistenByKey);
            }
            _obj2.default.clear(this.listenerKeys_);
            var layersArray = layers.getArray();
            var i, ii, layer;
            for (i = 0, ii = layersArray.length; i < ii; i++) {
                layer = layersArray[i];
                this.listenerKeys_[_index2.default.getUid(layer).toString()] = [ _events2.default.listen(layer, _objecteventtype2.default.PROPERTYCHANGE, this.handleLayerChange_, this), _events2.default.listen(layer, _eventtype2.default.CHANGE, this.handleLayerChange_, this) ];
            }
            this.changed();
        };
        _ol_layer_Group_.prototype.handleLayersAdd_ = function(collectionEvent) {
            var layer = collectionEvent.element;
            var key = _index2.default.getUid(layer).toString();
            this.listenerKeys_[key] = [ _events2.default.listen(layer, _objecteventtype2.default.PROPERTYCHANGE, this.handleLayerChange_, this), _events2.default.listen(layer, _eventtype2.default.CHANGE, this.handleLayerChange_, this) ];
            this.changed();
        };
        _ol_layer_Group_.prototype.handleLayersRemove_ = function(collectionEvent) {
            var layer = collectionEvent.element;
            var key = _index2.default.getUid(layer).toString();
            this.listenerKeys_[key].forEach(_events2.default.unlistenByKey);
            delete this.listenerKeys_[key];
            this.changed();
        };
        _ol_layer_Group_.prototype.getLayers = function() {
            return this.get(_ol_layer_Group_.Property_.LAYERS);
        };
        _ol_layer_Group_.prototype.setLayers = function(layers) {
            this.set(_ol_layer_Group_.Property_.LAYERS, layers);
        };
        _ol_layer_Group_.prototype.getLayersArray = function(opt_array) {
            var array = opt_array !== undefined ? opt_array : [];
            this.getLayers().forEach(function(layer) {
                layer.getLayersArray(array);
            });
            return array;
        };
        _ol_layer_Group_.prototype.getLayerStatesArray = function(opt_states) {
            var states = opt_states !== undefined ? opt_states : [];
            var pos = states.length;
            this.getLayers().forEach(function(layer) {
                layer.getLayerStatesArray(states);
            });
            var ownLayerState = this.getLayerState();
            var i, ii, layerState;
            for (i = pos, ii = states.length; i < ii; i++) {
                layerState = states[i];
                layerState.opacity *= ownLayerState.opacity;
                layerState.visible = layerState.visible && ownLayerState.visible;
                layerState.maxResolution = Math.min(layerState.maxResolution, ownLayerState.maxResolution);
                layerState.minResolution = Math.max(layerState.minResolution, ownLayerState.minResolution);
                if (ownLayerState.extent !== undefined) {
                    if (layerState.extent !== undefined) {
                        layerState.extent = _extent2.default.getIntersection(layerState.extent, ownLayerState.extent);
                    } else {
                        layerState.extent = ownLayerState.extent;
                    }
                }
            }
            return states;
        };
        _ol_layer_Group_.prototype.getSourceState = function() {
            return _state2.default.READY;
        };
        _ol_layer_Group_.Property_ = {
            LAYERS: "layers"
        };
        exports.default = _ol_layer_Group_;
    }, {
        "../asserts.js": 31,
        "../collection.js": 34,
        "../collectioneventtype.js": 35,
        "../events.js": 48,
        "../events/eventtype.js": 52,
        "../extent.js": 54,
        "../index.js": 89,
        "../layer/base.js": 105,
        "../obj.js": 124,
        "../object.js": 125,
        "../objecteventtype.js": 126,
        "../source/state.js": 212
    } ],
    107: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _layertype = require("../layertype.js");
        var _layertype2 = _interopRequireDefault(_layertype);
        var _layer = require("../layer/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_layer_Image_ = function(opt_options) {
            var options = opt_options ? opt_options : {};
            _layer2.default.call(this, options);
            this.type = _layertype2.default.IMAGE;
        };
        _index2.default.inherits(_ol_layer_Image_, _layer2.default);
        _ol_layer_Image_.prototype.getSource;
        exports.default = _ol_layer_Image_;
    }, {
        "../index.js": 89,
        "../layer/layer.js": 108,
        "../layertype.js": 113
    } ],
    108: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _object = require("../object.js");
        var _object2 = _interopRequireDefault(_object);
        var _base = require("../layer/base.js");
        var _base2 = _interopRequireDefault(_base);
        var _property = require("../layer/property.js");
        var _property2 = _interopRequireDefault(_property);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _eventtype3 = require("../render/eventtype.js");
        var _eventtype4 = _interopRequireDefault(_eventtype3);
        var _state = require("../source/state.js");
        var _state2 = _interopRequireDefault(_state);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_layer_Layer_ = function(options) {
            var baseOptions = _obj2.default.assign({}, options);
            delete baseOptions.source;
            _base2.default.call(this, baseOptions);
            this.mapPrecomposeKey_ = null;
            this.mapRenderKey_ = null;
            this.sourceChangeKey_ = null;
            if (options.map) {
                this.setMap(options.map);
            }
            _events2.default.listen(this, _object2.default.getChangeEventType(_property2.default.SOURCE), this.handleSourcePropertyChange_, this);
            var source = options.source ? options.source : null;
            this.setSource(source);
        };
        _index2.default.inherits(_ol_layer_Layer_, _base2.default);
        _ol_layer_Layer_.visibleAtResolution = function(layerState, resolution) {
            return layerState.visible && resolution >= layerState.minResolution && resolution < layerState.maxResolution;
        };
        _ol_layer_Layer_.prototype.getLayersArray = function(opt_array) {
            var array = opt_array ? opt_array : [];
            array.push(this);
            return array;
        };
        _ol_layer_Layer_.prototype.getLayerStatesArray = function(opt_states) {
            var states = opt_states ? opt_states : [];
            states.push(this.getLayerState());
            return states;
        };
        _ol_layer_Layer_.prototype.getSource = function() {
            var source = this.get(_property2.default.SOURCE);
            return source || null;
        };
        _ol_layer_Layer_.prototype.getSourceState = function() {
            var source = this.getSource();
            return !source ? _state2.default.UNDEFINED : source.getState();
        };
        _ol_layer_Layer_.prototype.handleSourceChange_ = function() {
            this.changed();
        };
        _ol_layer_Layer_.prototype.handleSourcePropertyChange_ = function() {
            if (this.sourceChangeKey_) {
                _events2.default.unlistenByKey(this.sourceChangeKey_);
                this.sourceChangeKey_ = null;
            }
            var source = this.getSource();
            if (source) {
                this.sourceChangeKey_ = _events2.default.listen(source, _eventtype2.default.CHANGE, this.handleSourceChange_, this);
            }
            this.changed();
        };
        _ol_layer_Layer_.prototype.setMap = function(map) {
            if (this.mapPrecomposeKey_) {
                _events2.default.unlistenByKey(this.mapPrecomposeKey_);
                this.mapPrecomposeKey_ = null;
            }
            if (!map) {
                this.changed();
            }
            if (this.mapRenderKey_) {
                _events2.default.unlistenByKey(this.mapRenderKey_);
                this.mapRenderKey_ = null;
            }
            if (map) {
                this.mapPrecomposeKey_ = _events2.default.listen(map, _eventtype4.default.PRECOMPOSE, function(evt) {
                    var layerState = this.getLayerState();
                    layerState.managed = false;
                    layerState.zIndex = Infinity;
                    evt.frameState.layerStatesArray.push(layerState);
                    evt.frameState.layerStates[_index2.default.getUid(this)] = layerState;
                }, this);
                this.mapRenderKey_ = _events2.default.listen(this, _eventtype2.default.CHANGE, map.render, map);
                this.changed();
            }
        };
        _ol_layer_Layer_.prototype.setSource = function(source) {
            this.set(_property2.default.SOURCE, source);
        };
        exports.default = _ol_layer_Layer_;
    }, {
        "../events.js": 48,
        "../events/eventtype.js": 52,
        "../index.js": 89,
        "../layer/base.js": 105,
        "../layer/property.js": 109,
        "../obj.js": 124,
        "../object.js": 125,
        "../render/eventtype.js": 160,
        "../source/state.js": 212
    } ],
    109: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_layer_Property_ = {
            OPACITY: "opacity",
            VISIBLE: "visible",
            EXTENT: "extent",
            Z_INDEX: "zIndex",
            MAX_RESOLUTION: "maxResolution",
            MIN_RESOLUTION: "minResolution",
            SOURCE: "source"
        };
        exports.default = _ol_layer_Property_;
    }, {} ],
    110: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _layertype = require("../layertype.js");
        var _layertype2 = _interopRequireDefault(_layertype);
        var _layer = require("../layer/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _vectorrendertype = require("../layer/vectorrendertype.js");
        var _vectorrendertype2 = _interopRequireDefault(_vectorrendertype);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _style = require("../style/style.js");
        var _style2 = _interopRequireDefault(_style);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_layer_Vector_ = function(opt_options) {
            var options = opt_options ? opt_options : {};
            var baseOptions = _obj2.default.assign({}, options);
            delete baseOptions.style;
            delete baseOptions.renderBuffer;
            delete baseOptions.updateWhileAnimating;
            delete baseOptions.updateWhileInteracting;
            _layer2.default.call(this, baseOptions);
            this.declutter_ = options.declutter !== undefined ? options.declutter : false;
            this.renderBuffer_ = options.renderBuffer !== undefined ? options.renderBuffer : 100;
            this.style_ = null;
            this.styleFunction_ = undefined;
            this.setStyle(options.style);
            this.updateWhileAnimating_ = options.updateWhileAnimating !== undefined ? options.updateWhileAnimating : false;
            this.updateWhileInteracting_ = options.updateWhileInteracting !== undefined ? options.updateWhileInteracting : false;
            this.renderMode_ = options.renderMode || _vectorrendertype2.default.VECTOR;
            this.type = _layertype2.default.VECTOR;
        };
        _index2.default.inherits(_ol_layer_Vector_, _layer2.default);
        _ol_layer_Vector_.prototype.getDeclutter = function() {
            return this.declutter_;
        };
        _ol_layer_Vector_.prototype.setDeclutter = function(declutter) {
            this.declutter_ = declutter;
        };
        _ol_layer_Vector_.prototype.getRenderBuffer = function() {
            return this.renderBuffer_;
        };
        _ol_layer_Vector_.prototype.getRenderOrder = function() {
            return this.get(_ol_layer_Vector_.Property_.RENDER_ORDER);
        };
        _ol_layer_Vector_.prototype.getSource;
        _ol_layer_Vector_.prototype.getStyle = function() {
            return this.style_;
        };
        _ol_layer_Vector_.prototype.getStyleFunction = function() {
            return this.styleFunction_;
        };
        _ol_layer_Vector_.prototype.getUpdateWhileAnimating = function() {
            return this.updateWhileAnimating_;
        };
        _ol_layer_Vector_.prototype.getUpdateWhileInteracting = function() {
            return this.updateWhileInteracting_;
        };
        _ol_layer_Vector_.prototype.setRenderOrder = function(renderOrder) {
            this.set(_ol_layer_Vector_.Property_.RENDER_ORDER, renderOrder);
        };
        _ol_layer_Vector_.prototype.setStyle = function(style) {
            this.style_ = style !== undefined ? style : _style2.default.defaultFunction;
            this.styleFunction_ = style === null ? undefined : _style2.default.createFunction(this.style_);
            this.changed();
        };
        _ol_layer_Vector_.prototype.getRenderMode = function() {
            return this.renderMode_;
        };
        _ol_layer_Vector_.Property_ = {
            RENDER_ORDER: "renderOrder"
        };
        exports.default = _ol_layer_Vector_;
    }, {
        "../index.js": 89,
        "../layer/layer.js": 108,
        "../layer/vectorrendertype.js": 111,
        "../layertype.js": 113,
        "../obj.js": 124,
        "../style/style.js": 234
    } ],
    111: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_layer_VectorRenderType_ = {
            IMAGE: "image",
            VECTOR: "vector"
        };
        exports.default = _ol_layer_VectorRenderType_;
    }, {} ],
    112: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_layer_VectorTileRenderType_ = {
            IMAGE: "image",
            HYBRID: "hybrid",
            VECTOR: "vector"
        };
        exports.default = _ol_layer_VectorTileRenderType_;
    }, {} ],
    113: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_LayerType_ = {
            IMAGE: "IMAGE",
            TILE: "TILE",
            VECTOR_TILE: "VECTOR_TILE",
            VECTOR: "VECTOR"
        };
        exports.default = _ol_LayerType_;
    }, {} ],
    114: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_loadingstrategy_ = {};
        _ol_loadingstrategy_.all = function(extent, resolution) {
            return [ [ -Infinity, -Infinity, Infinity, Infinity ] ];
        };
        _ol_loadingstrategy_.bbox = function(extent, resolution) {
            return [ extent ];
        };
        _ol_loadingstrategy_.tile = function(tileGrid) {
            return function(extent, resolution) {
                var z = tileGrid.getZForResolution(resolution);
                var tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);
                var extents = [];
                var tileCoord = [ z, 0, 0 ];
                for (tileCoord[1] = tileRange.minX; tileCoord[1] <= tileRange.maxX; ++tileCoord[1]) {
                    for (tileCoord[2] = tileRange.minY; tileCoord[2] <= tileRange.maxY; ++tileCoord[2]) {
                        extents.push(tileGrid.getTileCoordExtent(tileCoord));
                    }
                }
                return extents;
            };
        };
        exports.default = _ol_loadingstrategy_;
    }, {} ],
    115: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _pluggablemap = require("./pluggablemap.js");
        var _pluggablemap2 = _interopRequireDefault(_pluggablemap);
        var _plugintype = require("./plugintype.js");
        var _plugintype2 = _interopRequireDefault(_plugintype);
        var _control = require("./control.js");
        var _control2 = _interopRequireDefault(_control);
        var _interaction = require("./interaction.js");
        var _interaction2 = _interopRequireDefault(_interaction);
        var _obj = require("./obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _plugins = require("./plugins.js");
        var _plugins2 = _interopRequireDefault(_plugins);
        var _imagelayer = require("./renderer/canvas/imagelayer.js");
        var _imagelayer2 = _interopRequireDefault(_imagelayer);
        var _map = require("./renderer/canvas/map.js");
        var _map2 = _interopRequireDefault(_map);
        var _tilelayer = require("./renderer/canvas/tilelayer.js");
        var _tilelayer2 = _interopRequireDefault(_tilelayer);
        var _vectorlayer = require("./renderer/canvas/vectorlayer.js");
        var _vectorlayer2 = _interopRequireDefault(_vectorlayer);
        var _vectortilelayer = require("./renderer/canvas/vectortilelayer.js");
        var _vectortilelayer2 = _interopRequireDefault(_vectortilelayer);
        var _imagelayer3 = require("./renderer/webgl/imagelayer.js");
        var _imagelayer4 = _interopRequireDefault(_imagelayer3);
        var _map3 = require("./renderer/webgl/map.js");
        var _map4 = _interopRequireDefault(_map3);
        var _tilelayer3 = require("./renderer/webgl/tilelayer.js");
        var _tilelayer4 = _interopRequireDefault(_tilelayer3);
        var _vectorlayer3 = require("./renderer/webgl/vectorlayer.js");
        var _vectorlayer4 = _interopRequireDefault(_vectorlayer3);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        if (_index2.default.ENABLE_CANVAS) {
            _plugins2.default.register(_plugintype2.default.MAP_RENDERER, _map2.default);
            _plugins2.default.registerMultiple(_plugintype2.default.LAYER_RENDERER, [ _imagelayer2.default, _tilelayer2.default, _vectorlayer2.default, _vectortilelayer2.default ]);
        }
        if (_index2.default.ENABLE_WEBGL) {
            _plugins2.default.register(_plugintype2.default.MAP_RENDERER, _map4.default);
            _plugins2.default.registerMultiple(_plugintype2.default.LAYER_RENDERER, [ _imagelayer4.default, _tilelayer4.default, _vectorlayer4.default ]);
        }
        var _ol_Map_ = function(options) {
            options = _obj2.default.assign({}, options);
            if (!options.controls) {
                options.controls = _control2.default.defaults();
            }
            if (!options.interactions) {
                options.interactions = _interaction2.default.defaults();
            }
            _pluggablemap2.default.call(this, options);
        };
        _index2.default.inherits(_ol_Map_, _pluggablemap2.default);
        exports.default = _ol_Map_;
    }, {
        "./control.js": 38,
        "./index.js": 89,
        "./interaction.js": 90,
        "./obj.js": 124,
        "./pluggablemap.js": 130,
        "./plugins.js": 131,
        "./plugintype.js": 132,
        "./renderer/canvas/imagelayer.js": 183,
        "./renderer/canvas/map.js": 186,
        "./renderer/canvas/tilelayer.js": 187,
        "./renderer/canvas/vectorlayer.js": 188,
        "./renderer/canvas/vectortilelayer.js": 189,
        "./renderer/webgl/imagelayer.js": 196,
        "./renderer/webgl/map.js": 198,
        "./renderer/webgl/tilelayer.js": 199,
        "./renderer/webgl/vectorlayer.js": 202
    } ],
    116: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _mapevent = require("./mapevent.js");
        var _mapevent2 = _interopRequireDefault(_mapevent);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_MapBrowserEvent_ = function(type, map, browserEvent, opt_dragging, opt_frameState) {
            _mapevent2.default.call(this, type, map, opt_frameState);
            this.originalEvent = browserEvent;
            this.pixel = map.getEventPixel(browserEvent);
            this.coordinate = map.getCoordinateFromPixel(this.pixel);
            this.dragging = opt_dragging !== undefined ? opt_dragging : false;
        };
        _index2.default.inherits(_ol_MapBrowserEvent_, _mapevent2.default);
        _ol_MapBrowserEvent_.prototype.preventDefault = function() {
            _mapevent2.default.prototype.preventDefault.call(this);
            this.originalEvent.preventDefault();
        };
        _ol_MapBrowserEvent_.prototype.stopPropagation = function() {
            _mapevent2.default.prototype.stopPropagation.call(this);
            this.originalEvent.stopPropagation();
        };
        exports.default = _ol_MapBrowserEvent_;
    }, {
        "./index.js": 89,
        "./mapevent.js": 120
    } ],
    117: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _has = require("./has.js");
        var _has2 = _interopRequireDefault(_has);
        var _mapbrowsereventtype = require("./mapbrowsereventtype.js");
        var _mapbrowsereventtype2 = _interopRequireDefault(_mapbrowsereventtype);
        var _mapbrowserpointerevent = require("./mapbrowserpointerevent.js");
        var _mapbrowserpointerevent2 = _interopRequireDefault(_mapbrowserpointerevent);
        var _events = require("./events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtarget = require("./events/eventtarget.js");
        var _eventtarget2 = _interopRequireDefault(_eventtarget);
        var _eventtype = require("./pointer/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _pointereventhandler = require("./pointer/pointereventhandler.js");
        var _pointereventhandler2 = _interopRequireDefault(_pointereventhandler);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_MapBrowserEventHandler_ = function(map, moveTolerance) {
            _eventtarget2.default.call(this);
            this.map_ = map;
            this.clickTimeoutId_ = 0;
            this.dragging_ = false;
            this.dragListenerKeys_ = [];
            this.moveTolerance_ = moveTolerance ? moveTolerance * _has2.default.DEVICE_PIXEL_RATIO : _has2.default.DEVICE_PIXEL_RATIO;
            this.down_ = null;
            var element = this.map_.getViewport();
            this.activePointers_ = 0;
            this.trackedTouches_ = {};
            this.pointerEventHandler_ = new _pointereventhandler2.default(element);
            this.documentPointerEventHandler_ = null;
            this.pointerdownListenerKey_ = _events2.default.listen(this.pointerEventHandler_, _eventtype2.default.POINTERDOWN, this.handlePointerDown_, this);
            this.relayedListenerKey_ = _events2.default.listen(this.pointerEventHandler_, _eventtype2.default.POINTERMOVE, this.relayEvent_, this);
        };
        _index2.default.inherits(_ol_MapBrowserEventHandler_, _eventtarget2.default);
        _ol_MapBrowserEventHandler_.prototype.emulateClick_ = function(pointerEvent) {
            var newEvent = new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.CLICK, this.map_, pointerEvent);
            this.dispatchEvent(newEvent);
            if (this.clickTimeoutId_ !== 0) {
                clearTimeout(this.clickTimeoutId_);
                this.clickTimeoutId_ = 0;
                newEvent = new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.DBLCLICK, this.map_, pointerEvent);
                this.dispatchEvent(newEvent);
            } else {
                this.clickTimeoutId_ = setTimeout(function() {
                    this.clickTimeoutId_ = 0;
                    var newEvent = new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.SINGLECLICK, this.map_, pointerEvent);
                    this.dispatchEvent(newEvent);
                }.bind(this), 250);
            }
        };
        _ol_MapBrowserEventHandler_.prototype.updateActivePointers_ = function(pointerEvent) {
            var event = pointerEvent;
            if (event.type == _mapbrowsereventtype2.default.POINTERUP || event.type == _mapbrowsereventtype2.default.POINTERCANCEL) {
                delete this.trackedTouches_[event.pointerId];
            } else if (event.type == _mapbrowsereventtype2.default.POINTERDOWN) {
                this.trackedTouches_[event.pointerId] = true;
            }
            this.activePointers_ = Object.keys(this.trackedTouches_).length;
        };
        _ol_MapBrowserEventHandler_.prototype.handlePointerUp_ = function(pointerEvent) {
            this.updateActivePointers_(pointerEvent);
            var newEvent = new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.POINTERUP, this.map_, pointerEvent);
            this.dispatchEvent(newEvent);
            if (!newEvent.propagationStopped && !this.dragging_ && this.isMouseActionButton_(pointerEvent)) {
                this.emulateClick_(this.down_);
            }
            if (this.activePointers_ === 0) {
                this.dragListenerKeys_.forEach(_events2.default.unlistenByKey);
                this.dragListenerKeys_.length = 0;
                this.dragging_ = false;
                this.down_ = null;
                this.documentPointerEventHandler_.dispose();
                this.documentPointerEventHandler_ = null;
            }
        };
        _ol_MapBrowserEventHandler_.prototype.isMouseActionButton_ = function(pointerEvent) {
            return pointerEvent.button === 0;
        };
        _ol_MapBrowserEventHandler_.prototype.handlePointerDown_ = function(pointerEvent) {
            this.updateActivePointers_(pointerEvent);
            var newEvent = new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.POINTERDOWN, this.map_, pointerEvent);
            this.dispatchEvent(newEvent);
            this.down_ = pointerEvent;
            if (this.dragListenerKeys_.length === 0) {
                this.documentPointerEventHandler_ = new _pointereventhandler2.default(document);
                this.dragListenerKeys_.push(_events2.default.listen(this.documentPointerEventHandler_, _mapbrowsereventtype2.default.POINTERMOVE, this.handlePointerMove_, this), _events2.default.listen(this.documentPointerEventHandler_, _mapbrowsereventtype2.default.POINTERUP, this.handlePointerUp_, this), _events2.default.listen(this.pointerEventHandler_, _mapbrowsereventtype2.default.POINTERCANCEL, this.handlePointerUp_, this));
            }
        };
        _ol_MapBrowserEventHandler_.prototype.handlePointerMove_ = function(pointerEvent) {
            if (this.isMoving_(pointerEvent)) {
                this.dragging_ = true;
                var newEvent = new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.POINTERDRAG, this.map_, pointerEvent, this.dragging_);
                this.dispatchEvent(newEvent);
            }
            pointerEvent.preventDefault();
        };
        _ol_MapBrowserEventHandler_.prototype.relayEvent_ = function(pointerEvent) {
            var dragging = !!(this.down_ && this.isMoving_(pointerEvent));
            this.dispatchEvent(new _mapbrowserpointerevent2.default(pointerEvent.type, this.map_, pointerEvent, dragging));
        };
        _ol_MapBrowserEventHandler_.prototype.isMoving_ = function(pointerEvent) {
            return Math.abs(pointerEvent.clientX - this.down_.clientX) > this.moveTolerance_ || Math.abs(pointerEvent.clientY - this.down_.clientY) > this.moveTolerance_;
        };
        _ol_MapBrowserEventHandler_.prototype.disposeInternal = function() {
            if (this.relayedListenerKey_) {
                _events2.default.unlistenByKey(this.relayedListenerKey_);
                this.relayedListenerKey_ = null;
            }
            if (this.pointerdownListenerKey_) {
                _events2.default.unlistenByKey(this.pointerdownListenerKey_);
                this.pointerdownListenerKey_ = null;
            }
            this.dragListenerKeys_.forEach(_events2.default.unlistenByKey);
            this.dragListenerKeys_.length = 0;
            if (this.documentPointerEventHandler_) {
                this.documentPointerEventHandler_.dispose();
                this.documentPointerEventHandler_ = null;
            }
            if (this.pointerEventHandler_) {
                this.pointerEventHandler_.dispose();
                this.pointerEventHandler_ = null;
            }
            _eventtarget2.default.prototype.disposeInternal.call(this);
        };
        exports.default = _ol_MapBrowserEventHandler_;
    }, {
        "./events.js": 48,
        "./events/eventtarget.js": 51,
        "./has.js": 84,
        "./index.js": 89,
        "./mapbrowsereventtype.js": 118,
        "./mapbrowserpointerevent.js": 119,
        "./pointer/eventtype.js": 134,
        "./pointer/pointereventhandler.js": 139
    } ],
    118: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _eventtype = require("./events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_MapBrowserEventType_ = {
            SINGLECLICK: "singleclick",
            CLICK: _eventtype2.default.CLICK,
            DBLCLICK: _eventtype2.default.DBLCLICK,
            POINTERDRAG: "pointerdrag",
            POINTERMOVE: "pointermove",
            POINTERDOWN: "pointerdown",
            POINTERUP: "pointerup",
            POINTEROVER: "pointerover",
            POINTEROUT: "pointerout",
            POINTERENTER: "pointerenter",
            POINTERLEAVE: "pointerleave",
            POINTERCANCEL: "pointercancel"
        };
        exports.default = _ol_MapBrowserEventType_;
    }, {
        "./events/eventtype.js": 52
    } ],
    119: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _mapbrowserevent = require("./mapbrowserevent.js");
        var _mapbrowserevent2 = _interopRequireDefault(_mapbrowserevent);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_MapBrowserPointerEvent_ = function(type, map, pointerEvent, opt_dragging, opt_frameState) {
            _mapbrowserevent2.default.call(this, type, map, pointerEvent.originalEvent, opt_dragging, opt_frameState);
            this.pointerEvent = pointerEvent;
        };
        _index2.default.inherits(_ol_MapBrowserPointerEvent_, _mapbrowserevent2.default);
        exports.default = _ol_MapBrowserPointerEvent_;
    }, {
        "./index.js": 89,
        "./mapbrowserevent.js": 116
    } ],
    120: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _event = require("./events/event.js");
        var _event2 = _interopRequireDefault(_event);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_MapEvent_ = function(type, map, opt_frameState) {
            _event2.default.call(this, type);
            this.map = map;
            this.frameState = opt_frameState !== undefined ? opt_frameState : null;
        };
        _index2.default.inherits(_ol_MapEvent_, _event2.default);
        exports.default = _ol_MapEvent_;
    }, {
        "./events/event.js": 50,
        "./index.js": 89
    } ],
    121: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_MapEventType_ = {
            POSTRENDER: "postrender",
            MOVESTART: "movestart",
            MOVEEND: "moveend"
        };
        exports.default = _ol_MapEventType_;
    }, {} ],
    122: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_MapProperty_ = {
            LAYERGROUP: "layergroup",
            SIZE: "size",
            TARGET: "target",
            VIEW: "view"
        };
        exports.default = _ol_MapProperty_;
    }, {} ],
    123: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _asserts = require("./asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_math_ = {};
        _ol_math_.clamp = function(value, min, max) {
            return Math.min(Math.max(value, min), max);
        };
        _ol_math_.cosh = function() {
            var cosh;
            if ("cosh" in Math) {
                cosh = Math.cosh;
            } else {
                cosh = function(x) {
                    var y = Math.exp(x);
                    return (y + 1 / y) / 2;
                };
            }
            return cosh;
        }();
        _ol_math_.roundUpToPowerOfTwo = function(x) {
            _asserts2.default.assert(0 < x, 29);
            return Math.pow(2, Math.ceil(Math.log(x) / Math.LN2));
        };
        _ol_math_.squaredSegmentDistance = function(x, y, x1, y1, x2, y2) {
            var dx = x2 - x1;
            var dy = y2 - y1;
            if (dx !== 0 || dy !== 0) {
                var t = ((x - x1) * dx + (y - y1) * dy) / (dx * dx + dy * dy);
                if (t > 1) {
                    x1 = x2;
                    y1 = y2;
                } else if (t > 0) {
                    x1 += dx * t;
                    y1 += dy * t;
                }
            }
            return _ol_math_.squaredDistance(x, y, x1, y1);
        };
        _ol_math_.squaredDistance = function(x1, y1, x2, y2) {
            var dx = x2 - x1;
            var dy = y2 - y1;
            return dx * dx + dy * dy;
        };
        _ol_math_.solveLinearSystem = function(mat) {
            var n = mat.length;
            for (var i = 0; i < n; i++) {
                var maxRow = i;
                var maxEl = Math.abs(mat[i][i]);
                for (var r = i + 1; r < n; r++) {
                    var absValue = Math.abs(mat[r][i]);
                    if (absValue > maxEl) {
                        maxEl = absValue;
                        maxRow = r;
                    }
                }
                if (maxEl === 0) {
                    return null;
                }
                var tmp = mat[maxRow];
                mat[maxRow] = mat[i];
                mat[i] = tmp;
                for (var j = i + 1; j < n; j++) {
                    var coef = -mat[j][i] / mat[i][i];
                    for (var k = i; k < n + 1; k++) {
                        if (i == k) {
                            mat[j][k] = 0;
                        } else {
                            mat[j][k] += coef * mat[i][k];
                        }
                    }
                }
            }
            var x = new Array(n);
            for (var l = n - 1; l >= 0; l--) {
                x[l] = mat[l][n] / mat[l][l];
                for (var m = l - 1; m >= 0; m--) {
                    mat[m][n] -= mat[m][l] * x[l];
                }
            }
            return x;
        };
        _ol_math_.toDegrees = function(angleInRadians) {
            return angleInRadians * 180 / Math.PI;
        };
        _ol_math_.toRadians = function(angleInDegrees) {
            return angleInDegrees * Math.PI / 180;
        };
        _ol_math_.modulo = function(a, b) {
            var r = a % b;
            return r * b < 0 ? r + b : r;
        };
        _ol_math_.lerp = function(a, b, x) {
            return a + x * (b - a);
        };
        exports.default = _ol_math_;
    }, {
        "./asserts.js": 31
    } ],
    124: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_obj_ = {};
        _ol_obj_.assign = typeof Object.assign === "function" ? Object.assign : function(target, var_sources) {
            if (target === undefined || target === null) {
                throw new TypeError("Cannot convert undefined or null to object");
            }
            var output = Object(target);
            for (var i = 1, ii = arguments.length; i < ii; ++i) {
                var source = arguments[i];
                if (source !== undefined && source !== null) {
                    for (var key in source) {
                        if (source.hasOwnProperty(key)) {
                            output[key] = source[key];
                        }
                    }
                }
            }
            return output;
        };
        _ol_obj_.clear = function(object) {
            for (var property in object) {
                delete object[property];
            }
        };
        _ol_obj_.getValues = function(object) {
            var values = [];
            for (var property in object) {
                values.push(object[property]);
            }
            return values;
        };
        _ol_obj_.isEmpty = function(object) {
            var property;
            for (property in object) {
                return false;
            }
            return !property;
        };
        exports.default = _ol_obj_;
    }, {} ],
    125: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _objecteventtype = require("./objecteventtype.js");
        var _objecteventtype2 = _interopRequireDefault(_objecteventtype);
        var _observable = require("./observable.js");
        var _observable2 = _interopRequireDefault(_observable);
        var _event = require("./events/event.js");
        var _event2 = _interopRequireDefault(_event);
        var _obj = require("./obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_Object_ = function(opt_values) {
            _observable2.default.call(this);
            _index2.default.getUid(this);
            this.values_ = {};
            if (opt_values !== undefined) {
                this.setProperties(opt_values);
            }
        };
        _index2.default.inherits(_ol_Object_, _observable2.default);
        _ol_Object_.changeEventTypeCache_ = {};
        _ol_Object_.getChangeEventType = function(key) {
            return _ol_Object_.changeEventTypeCache_.hasOwnProperty(key) ? _ol_Object_.changeEventTypeCache_[key] : _ol_Object_.changeEventTypeCache_[key] = "change:" + key;
        };
        _ol_Object_.prototype.get = function(key) {
            var value;
            if (this.values_.hasOwnProperty(key)) {
                value = this.values_[key];
            }
            return value;
        };
        _ol_Object_.prototype.getKeys = function() {
            return Object.keys(this.values_);
        };
        _ol_Object_.prototype.getProperties = function() {
            return _obj2.default.assign({}, this.values_);
        };
        _ol_Object_.prototype.notify = function(key, oldValue) {
            var eventType;
            eventType = _ol_Object_.getChangeEventType(key);
            this.dispatchEvent(new _ol_Object_.Event(eventType, key, oldValue));
            eventType = _objecteventtype2.default.PROPERTYCHANGE;
            this.dispatchEvent(new _ol_Object_.Event(eventType, key, oldValue));
        };
        _ol_Object_.prototype.set = function(key, value, opt_silent) {
            if (opt_silent) {
                this.values_[key] = value;
            } else {
                var oldValue = this.values_[key];
                this.values_[key] = value;
                if (oldValue !== value) {
                    this.notify(key, oldValue);
                }
            }
        };
        _ol_Object_.prototype.setProperties = function(values, opt_silent) {
            var key;
            for (key in values) {
                this.set(key, values[key], opt_silent);
            }
        };
        _ol_Object_.prototype.unset = function(key, opt_silent) {
            if (key in this.values_) {
                var oldValue = this.values_[key];
                delete this.values_[key];
                if (!opt_silent) {
                    this.notify(key, oldValue);
                }
            }
        };
        _ol_Object_.Event = function(type, key, oldValue) {
            _event2.default.call(this, type);
            this.key = key;
            this.oldValue = oldValue;
        };
        _index2.default.inherits(_ol_Object_.Event, _event2.default);
        exports.default = _ol_Object_;
    }, {
        "./events/event.js": 50,
        "./index.js": 89,
        "./obj.js": 124,
        "./objecteventtype.js": 126,
        "./observable.js": 127
    } ],
    126: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_ObjectEventType_ = {
            PROPERTYCHANGE: "propertychange"
        };
        exports.default = _ol_ObjectEventType_;
    }, {} ],
    127: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _events = require("./events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtarget = require("./events/eventtarget.js");
        var _eventtarget2 = _interopRequireDefault(_eventtarget);
        var _eventtype = require("./events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_Observable_ = function() {
            _eventtarget2.default.call(this);
            this.revision_ = 0;
        };
        _index2.default.inherits(_ol_Observable_, _eventtarget2.default);
        _ol_Observable_.unByKey = function(key) {
            if (Array.isArray(key)) {
                for (var i = 0, ii = key.length; i < ii; ++i) {
                    _events2.default.unlistenByKey(key[i]);
                }
            } else {
                _events2.default.unlistenByKey(key);
            }
        };
        _ol_Observable_.prototype.changed = function() {
            ++this.revision_;
            this.dispatchEvent(_eventtype2.default.CHANGE);
        };
        _ol_Observable_.prototype.dispatchEvent;
        _ol_Observable_.prototype.getRevision = function() {
            return this.revision_;
        };
        _ol_Observable_.prototype.on = function(type, listener, opt_this) {
            if (Array.isArray(type)) {
                var len = type.length;
                var keys = new Array(len);
                for (var i = 0; i < len; ++i) {
                    keys[i] = _events2.default.listen(this, type[i], listener, opt_this);
                }
                return keys;
            } else {
                return _events2.default.listen(this, type, listener, opt_this);
            }
        };
        _ol_Observable_.prototype.once = function(type, listener, opt_this) {
            if (Array.isArray(type)) {
                var len = type.length;
                var keys = new Array(len);
                for (var i = 0; i < len; ++i) {
                    keys[i] = _events2.default.listenOnce(this, type[i], listener, opt_this);
                }
                return keys;
            } else {
                return _events2.default.listenOnce(this, type, listener, opt_this);
            }
        };
        _ol_Observable_.prototype.un = function(type, listener, opt_this) {
            if (Array.isArray(type)) {
                for (var i = 0, ii = type.length; i < ii; ++i) {
                    _events2.default.unlisten(this, type[i], listener, opt_this);
                }
                return;
            } else {
                _events2.default.unlisten(this, type, listener, opt_this);
            }
        };
        exports.default = _ol_Observable_;
    }, {
        "./events.js": 48,
        "./events/eventtarget.js": 51,
        "./events/eventtype.js": 52,
        "./index.js": 89
    } ],
    128: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _mapeventtype = require("./mapeventtype.js");
        var _mapeventtype2 = _interopRequireDefault(_mapeventtype);
        var _object = require("./object.js");
        var _object2 = _interopRequireDefault(_object);
        var _overlaypositioning = require("./overlaypositioning.js");
        var _overlaypositioning2 = _interopRequireDefault(_overlaypositioning);
        var _css = require("./css.js");
        var _css2 = _interopRequireDefault(_css);
        var _dom = require("./dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _events = require("./events.js");
        var _events2 = _interopRequireDefault(_events);
        var _extent = require("./extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_Overlay_ = function(options) {
            _object2.default.call(this);
            this.options = options;
            this.id = options.id;
            this.insertFirst = options.insertFirst !== undefined ? options.insertFirst : true;
            this.stopEvent = options.stopEvent !== undefined ? options.stopEvent : true;
            this.element = document.createElement("DIV");
            this.element.className = options.className !== undefined ? options.className : "ol-overlay-container " + _css2.default.CLASS_SELECTABLE;
            this.element.style.position = "absolute";
            this.autoPan = options.autoPan !== undefined ? options.autoPan : false;
            this.autoPanAnimation = options.autoPanAnimation || {};
            this.autoPanMargin = options.autoPanMargin !== undefined ? options.autoPanMargin : 20;
            this.rendered = {
                bottom_: "",
                left_: "",
                right_: "",
                top_: "",
                visible: true
            };
            this.mapPostrenderListenerKey = null;
            _events2.default.listen(this, _object2.default.getChangeEventType(_ol_Overlay_.Property.ELEMENT), this.handleElementChanged, this);
            _events2.default.listen(this, _object2.default.getChangeEventType(_ol_Overlay_.Property.MAP), this.handleMapChanged, this);
            _events2.default.listen(this, _object2.default.getChangeEventType(_ol_Overlay_.Property.OFFSET), this.handleOffsetChanged, this);
            _events2.default.listen(this, _object2.default.getChangeEventType(_ol_Overlay_.Property.POSITION), this.handlePositionChanged, this);
            _events2.default.listen(this, _object2.default.getChangeEventType(_ol_Overlay_.Property.POSITIONING), this.handlePositioningChanged, this);
            if (options.element !== undefined) {
                this.setElement(options.element);
            }
            this.setOffset(options.offset !== undefined ? options.offset : [ 0, 0 ]);
            this.setPositioning(options.positioning !== undefined ? options.positioning : _overlaypositioning2.default.TOP_LEFT);
            if (options.position !== undefined) {
                this.setPosition(options.position);
            }
        };
        _index2.default.inherits(_ol_Overlay_, _object2.default);
        _ol_Overlay_.prototype.getElement = function() {
            return this.get(_ol_Overlay_.Property.ELEMENT);
        };
        _ol_Overlay_.prototype.getId = function() {
            return this.id;
        };
        _ol_Overlay_.prototype.getMap = function() {
            return this.get(_ol_Overlay_.Property.MAP);
        };
        _ol_Overlay_.prototype.getOffset = function() {
            return this.get(_ol_Overlay_.Property.OFFSET);
        };
        _ol_Overlay_.prototype.getPosition = function() {
            return this.get(_ol_Overlay_.Property.POSITION);
        };
        _ol_Overlay_.prototype.getPositioning = function() {
            return this.get(_ol_Overlay_.Property.POSITIONING);
        };
        _ol_Overlay_.prototype.handleElementChanged = function() {
            _dom2.default.removeChildren(this.element);
            var element = this.getElement();
            if (element) {
                this.element.appendChild(element);
            }
        };
        _ol_Overlay_.prototype.handleMapChanged = function() {
            if (this.mapPostrenderListenerKey) {
                _dom2.default.removeNode(this.element);
                _events2.default.unlistenByKey(this.mapPostrenderListenerKey);
                this.mapPostrenderListenerKey = null;
            }
            var map = this.getMap();
            if (map) {
                this.mapPostrenderListenerKey = _events2.default.listen(map, _mapeventtype2.default.POSTRENDER, this.render, this);
                this.updatePixelPosition();
                var container = this.stopEvent ? map.getOverlayContainerStopEvent() : map.getOverlayContainer();
                if (this.insertFirst) {
                    container.insertBefore(this.element, container.childNodes[0] || null);
                } else {
                    container.appendChild(this.element);
                }
            }
        };
        _ol_Overlay_.prototype.render = function() {
            this.updatePixelPosition();
        };
        _ol_Overlay_.prototype.handleOffsetChanged = function() {
            this.updatePixelPosition();
        };
        _ol_Overlay_.prototype.handlePositionChanged = function() {
            this.updatePixelPosition();
            if (this.get(_ol_Overlay_.Property.POSITION) && this.autoPan) {
                this.panIntoView();
            }
        };
        _ol_Overlay_.prototype.handlePositioningChanged = function() {
            this.updatePixelPosition();
        };
        _ol_Overlay_.prototype.setElement = function(element) {
            this.set(_ol_Overlay_.Property.ELEMENT, element);
        };
        _ol_Overlay_.prototype.setMap = function(map) {
            this.set(_ol_Overlay_.Property.MAP, map);
        };
        _ol_Overlay_.prototype.setOffset = function(offset) {
            this.set(_ol_Overlay_.Property.OFFSET, offset);
        };
        _ol_Overlay_.prototype.setPosition = function(position) {
            this.set(_ol_Overlay_.Property.POSITION, position);
        };
        _ol_Overlay_.prototype.panIntoView = function() {
            var map = this.getMap();
            if (!map || !map.getTargetElement()) {
                return;
            }
            var mapRect = this.getRect(map.getTargetElement(), map.getSize());
            var element = this.getElement();
            var overlayRect = this.getRect(element, [ _dom2.default.outerWidth(element), _dom2.default.outerHeight(element) ]);
            var margin = this.autoPanMargin;
            if (!_extent2.default.containsExtent(mapRect, overlayRect)) {
                var offsetLeft = overlayRect[0] - mapRect[0];
                var offsetRight = mapRect[2] - overlayRect[2];
                var offsetTop = overlayRect[1] - mapRect[1];
                var offsetBottom = mapRect[3] - overlayRect[3];
                var delta = [ 0, 0 ];
                if (offsetLeft < 0) {
                    delta[0] = offsetLeft - margin;
                } else if (offsetRight < 0) {
                    delta[0] = Math.abs(offsetRight) + margin;
                }
                if (offsetTop < 0) {
                    delta[1] = offsetTop - margin;
                } else if (offsetBottom < 0) {
                    delta[1] = Math.abs(offsetBottom) + margin;
                }
                if (delta[0] !== 0 || delta[1] !== 0) {
                    var center = map.getView().getCenter();
                    var centerPx = map.getPixelFromCoordinate(center);
                    var newCenterPx = [ centerPx[0] + delta[0], centerPx[1] + delta[1] ];
                    map.getView().animate({
                        center: map.getCoordinateFromPixel(newCenterPx),
                        duration: this.autoPanAnimation.duration,
                        easing: this.autoPanAnimation.easing
                    });
                }
            }
        };
        _ol_Overlay_.prototype.getRect = function(element, size) {
            var box = element.getBoundingClientRect();
            var offsetX = box.left + window.pageXOffset;
            var offsetY = box.top + window.pageYOffset;
            return [ offsetX, offsetY, offsetX + size[0], offsetY + size[1] ];
        };
        _ol_Overlay_.prototype.setPositioning = function(positioning) {
            this.set(_ol_Overlay_.Property.POSITIONING, positioning);
        };
        _ol_Overlay_.prototype.setVisible = function(visible) {
            if (this.rendered.visible !== visible) {
                this.element.style.display = visible ? "" : "none";
                this.rendered.visible = visible;
            }
        };
        _ol_Overlay_.prototype.updatePixelPosition = function() {
            var map = this.getMap();
            var position = this.getPosition();
            if (!map || !map.isRendered() || !position) {
                this.setVisible(false);
                return;
            }
            var pixel = map.getPixelFromCoordinate(position);
            var mapSize = map.getSize();
            this.updateRenderedPosition(pixel, mapSize);
        };
        _ol_Overlay_.prototype.updateRenderedPosition = function(pixel, mapSize) {
            var style = this.element.style;
            var offset = this.getOffset();
            var positioning = this.getPositioning();
            this.setVisible(true);
            var offsetX = offset[0];
            var offsetY = offset[1];
            if (positioning == _overlaypositioning2.default.BOTTOM_RIGHT || positioning == _overlaypositioning2.default.CENTER_RIGHT || positioning == _overlaypositioning2.default.TOP_RIGHT) {
                if (this.rendered.left_ !== "") {
                    this.rendered.left_ = style.left = "";
                }
                var right = Math.round(mapSize[0] - pixel[0] - offsetX) + "px";
                if (this.rendered.right_ != right) {
                    this.rendered.right_ = style.right = right;
                }
            } else {
                if (this.rendered.right_ !== "") {
                    this.rendered.right_ = style.right = "";
                }
                if (positioning == _overlaypositioning2.default.BOTTOM_CENTER || positioning == _overlaypositioning2.default.CENTER_CENTER || positioning == _overlaypositioning2.default.TOP_CENTER) {
                    offsetX -= this.element.offsetWidth / 2;
                }
                var left = Math.round(pixel[0] + offsetX) + "px";
                if (this.rendered.left_ != left) {
                    this.rendered.left_ = style.left = left;
                }
            }
            if (positioning == _overlaypositioning2.default.BOTTOM_LEFT || positioning == _overlaypositioning2.default.BOTTOM_CENTER || positioning == _overlaypositioning2.default.BOTTOM_RIGHT) {
                if (this.rendered.top_ !== "") {
                    this.rendered.top_ = style.top = "";
                }
                var bottom = Math.round(mapSize[1] - pixel[1] - offsetY) + "px";
                if (this.rendered.bottom_ != bottom) {
                    this.rendered.bottom_ = style.bottom = bottom;
                }
            } else {
                if (this.rendered.bottom_ !== "") {
                    this.rendered.bottom_ = style.bottom = "";
                }
                if (positioning == _overlaypositioning2.default.CENTER_LEFT || positioning == _overlaypositioning2.default.CENTER_CENTER || positioning == _overlaypositioning2.default.CENTER_RIGHT) {
                    offsetY -= this.element.offsetHeight / 2;
                }
                var top = Math.round(pixel[1] + offsetY) + "px";
                if (this.rendered.top_ != top) {
                    this.rendered.top_ = style.top = top;
                }
            }
        };
        _ol_Overlay_.prototype.getOptions = function() {
            return this.options;
        };
        _ol_Overlay_.Property = {
            ELEMENT: "element",
            MAP: "map",
            OFFSET: "offset",
            POSITION: "position",
            POSITIONING: "positioning"
        };
        exports.default = _ol_Overlay_;
    }, {
        "./css.js": 44,
        "./dom.js": 46,
        "./events.js": 48,
        "./extent.js": 54,
        "./index.js": 89,
        "./mapeventtype.js": 121,
        "./object.js": 125,
        "./overlaypositioning.js": 129
    } ],
    129: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_OverlayPositioning_ = {
            BOTTOM_LEFT: "bottom-left",
            BOTTOM_CENTER: "bottom-center",
            BOTTOM_RIGHT: "bottom-right",
            CENTER_LEFT: "center-left",
            CENTER_CENTER: "center-center",
            CENTER_RIGHT: "center-right",
            TOP_LEFT: "top-left",
            TOP_CENTER: "top-center",
            TOP_RIGHT: "top-right"
        };
        exports.default = _ol_OverlayPositioning_;
    }, {} ],
    130: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _collection = require("./collection.js");
        var _collection2 = _interopRequireDefault(_collection);
        var _collectioneventtype = require("./collectioneventtype.js");
        var _collectioneventtype2 = _interopRequireDefault(_collectioneventtype);
        var _mapbrowserevent = require("./mapbrowserevent.js");
        var _mapbrowserevent2 = _interopRequireDefault(_mapbrowserevent);
        var _mapbrowsereventhandler = require("./mapbrowsereventhandler.js");
        var _mapbrowsereventhandler2 = _interopRequireDefault(_mapbrowsereventhandler);
        var _mapbrowsereventtype = require("./mapbrowsereventtype.js");
        var _mapbrowsereventtype2 = _interopRequireDefault(_mapbrowsereventtype);
        var _mapevent = require("./mapevent.js");
        var _mapevent2 = _interopRequireDefault(_mapevent);
        var _mapeventtype = require("./mapeventtype.js");
        var _mapeventtype2 = _interopRequireDefault(_mapeventtype);
        var _mapproperty = require("./mapproperty.js");
        var _mapproperty2 = _interopRequireDefault(_mapproperty);
        var _object = require("./object.js");
        var _object2 = _interopRequireDefault(_object);
        var _objecteventtype = require("./objecteventtype.js");
        var _objecteventtype2 = _interopRequireDefault(_objecteventtype);
        var _tilequeue = require("./tilequeue.js");
        var _tilequeue2 = _interopRequireDefault(_tilequeue);
        var _view = require("./view.js");
        var _view2 = _interopRequireDefault(_view);
        var _viewhint = require("./viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _asserts = require("./asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _dom = require("./dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _events = require("./events.js");
        var _events2 = _interopRequireDefault(_events);
        var _event = require("./events/event.js");
        var _event2 = _interopRequireDefault(_event);
        var _eventtype = require("./events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _extent = require("./extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _functions = require("./functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _has = require("./has.js");
        var _has2 = _interopRequireDefault(_has);
        var _group = require("./layer/group.js");
        var _group2 = _interopRequireDefault(_group);
        var _obj = require("./obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _plugins = require("./plugins.js");
        var _plugins2 = _interopRequireDefault(_plugins);
        var _type = require("./renderer/type.js");
        var _type2 = _interopRequireDefault(_type);
        var _size = require("./size.js");
        var _size2 = _interopRequireDefault(_size);
        var _priorityqueue = require("./structs/priorityqueue.js");
        var _priorityqueue2 = _interopRequireDefault(_priorityqueue);
        var _transform = require("./transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_PluggableMap_ = function(options) {
            _object2.default.call(this);
            var optionsInternal = _ol_PluggableMap_.createOptionsInternal(options);
            this.loadTilesWhileAnimating_ = options.loadTilesWhileAnimating !== undefined ? options.loadTilesWhileAnimating : false;
            this.loadTilesWhileInteracting_ = options.loadTilesWhileInteracting !== undefined ? options.loadTilesWhileInteracting : false;
            this.pixelRatio_ = options.pixelRatio !== undefined ? options.pixelRatio : _has2.default.DEVICE_PIXEL_RATIO;
            this.logos_ = optionsInternal.logos;
            this.animationDelayKey_;
            this.animationDelay_ = function() {
                this.animationDelayKey_ = undefined;
                this.renderFrame_.call(this, Date.now());
            }.bind(this);
            this.coordinateToPixelTransform_ = _transform2.default.create();
            this.pixelToCoordinateTransform_ = _transform2.default.create();
            this.frameIndex_ = 0;
            this.frameState_ = null;
            this.previousExtent_ = null;
            this.viewPropertyListenerKey_ = null;
            this.viewChangeListenerKey_ = null;
            this.layerGroupPropertyListenerKeys_ = null;
            this.viewport_ = document.createElement("DIV");
            this.viewport_.className = "ol-viewport" + (_has2.default.TOUCH ? " ol-touch" : "");
            this.viewport_.style.position = "relative";
            this.viewport_.style.overflow = "hidden";
            this.viewport_.style.width = "100%";
            this.viewport_.style.height = "100%";
            this.viewport_.style.msTouchAction = "none";
            this.viewport_.style.touchAction = "none";
            this.overlayContainer_ = document.createElement("DIV");
            this.overlayContainer_.className = "ol-overlaycontainer";
            this.viewport_.appendChild(this.overlayContainer_);
            this.overlayContainerStopEvent_ = document.createElement("DIV");
            this.overlayContainerStopEvent_.className = "ol-overlaycontainer-stopevent";
            var overlayEvents = [ _eventtype2.default.CLICK, _eventtype2.default.DBLCLICK, _eventtype2.default.MOUSEDOWN, _eventtype2.default.TOUCHSTART, _eventtype2.default.MSPOINTERDOWN, _mapbrowsereventtype2.default.POINTERDOWN, _eventtype2.default.MOUSEWHEEL, _eventtype2.default.WHEEL ];
            for (var i = 0, ii = overlayEvents.length; i < ii; ++i) {
                _events2.default.listen(this.overlayContainerStopEvent_, overlayEvents[i], _event2.default.stopPropagation);
            }
            this.viewport_.appendChild(this.overlayContainerStopEvent_);
            this.mapBrowserEventHandler_ = new _mapbrowsereventhandler2.default(this, options.moveTolerance);
            for (var key in _mapbrowsereventtype2.default) {
                _events2.default.listen(this.mapBrowserEventHandler_, _mapbrowsereventtype2.default[key], this.handleMapBrowserEvent, this);
            }
            this.keyboardEventTarget_ = optionsInternal.keyboardEventTarget;
            this.keyHandlerKeys_ = null;
            _events2.default.listen(this.viewport_, _eventtype2.default.WHEEL, this.handleBrowserEvent, this);
            _events2.default.listen(this.viewport_, _eventtype2.default.MOUSEWHEEL, this.handleBrowserEvent, this);
            this.controls = optionsInternal.controls || new _collection2.default();
            this.interactions = optionsInternal.interactions || new _collection2.default();
            this.overlays_ = optionsInternal.overlays;
            this.overlayIdIndex_ = {};
            this.renderer_ = optionsInternal.mapRendererPlugin["create"](this.viewport_, this);
            this.handleResize_;
            this.focus_ = null;
            this.postRenderFunctions_ = [];
            this.tileQueue_ = new _tilequeue2.default(this.getTilePriority.bind(this), this.handleTileChange_.bind(this));
            this.skippedFeatureUids_ = {};
            _events2.default.listen(this, _object2.default.getChangeEventType(_mapproperty2.default.LAYERGROUP), this.handleLayerGroupChanged_, this);
            _events2.default.listen(this, _object2.default.getChangeEventType(_mapproperty2.default.VIEW), this.handleViewChanged_, this);
            _events2.default.listen(this, _object2.default.getChangeEventType(_mapproperty2.default.SIZE), this.handleSizeChanged_, this);
            _events2.default.listen(this, _object2.default.getChangeEventType(_mapproperty2.default.TARGET), this.handleTargetChanged_, this);
            this.setProperties(optionsInternal.values);
            this.controls.forEach(function(control) {
                control.setMap(this);
            }, this);
            _events2.default.listen(this.controls, _collectioneventtype2.default.ADD, function(event) {
                event.element.setMap(this);
            }, this);
            _events2.default.listen(this.controls, _collectioneventtype2.default.REMOVE, function(event) {
                event.element.setMap(null);
            }, this);
            this.interactions.forEach(function(interaction) {
                interaction.setMap(this);
            }, this);
            _events2.default.listen(this.interactions, _collectioneventtype2.default.ADD, function(event) {
                event.element.setMap(this);
            }, this);
            _events2.default.listen(this.interactions, _collectioneventtype2.default.REMOVE, function(event) {
                event.element.setMap(null);
            }, this);
            this.overlays_.forEach(this.addOverlayInternal_, this);
            _events2.default.listen(this.overlays_, _collectioneventtype2.default.ADD, function(event) {
                this.addOverlayInternal_(event.element);
            }, this);
            _events2.default.listen(this.overlays_, _collectioneventtype2.default.REMOVE, function(event) {
                var overlay = event.element;
                var id = overlay.getId();
                if (id !== undefined) {
                    delete this.overlayIdIndex_[id.toString()];
                }
                event.element.setMap(null);
            }, this);
        };
        _index2.default.inherits(_ol_PluggableMap_, _object2.default);
        _ol_PluggableMap_.prototype.addControl = function(control) {
            this.getControls().push(control);
        };
        _ol_PluggableMap_.prototype.addInteraction = function(interaction) {
            this.getInteractions().push(interaction);
        };
        _ol_PluggableMap_.prototype.addLayer = function(layer) {
            var layers = this.getLayerGroup().getLayers();
            layers.push(layer);
        };
        _ol_PluggableMap_.prototype.addOverlay = function(overlay) {
            this.getOverlays().push(overlay);
        };
        _ol_PluggableMap_.prototype.addOverlayInternal_ = function(overlay) {
            var id = overlay.getId();
            if (id !== undefined) {
                this.overlayIdIndex_[id.toString()] = overlay;
            }
            overlay.setMap(this);
        };
        _ol_PluggableMap_.prototype.disposeInternal = function() {
            this.mapBrowserEventHandler_.dispose();
            _events2.default.unlisten(this.viewport_, _eventtype2.default.WHEEL, this.handleBrowserEvent, this);
            _events2.default.unlisten(this.viewport_, _eventtype2.default.MOUSEWHEEL, this.handleBrowserEvent, this);
            if (this.handleResize_ !== undefined) {
                window.removeEventListener(_eventtype2.default.RESIZE, this.handleResize_, false);
                this.handleResize_ = undefined;
            }
            if (this.animationDelayKey_) {
                cancelAnimationFrame(this.animationDelayKey_);
                this.animationDelayKey_ = undefined;
            }
            this.setTarget(null);
            _object2.default.prototype.disposeInternal.call(this);
        };
        _ol_PluggableMap_.prototype.forEachFeatureAtPixel = function(pixel, callback, opt_options) {
            if (!this.frameState_) {
                return;
            }
            var coordinate = this.getCoordinateFromPixel(pixel);
            opt_options = opt_options !== undefined ? opt_options : {};
            var hitTolerance = opt_options.hitTolerance !== undefined ? opt_options.hitTolerance * this.frameState_.pixelRatio : 0;
            var layerFilter = opt_options.layerFilter !== undefined ? opt_options.layerFilter : _functions2.default.TRUE;
            return this.renderer_.forEachFeatureAtCoordinate(coordinate, this.frameState_, hitTolerance, callback, null, layerFilter, null);
        };
        _ol_PluggableMap_.prototype.getFeaturesAtPixel = function(pixel, opt_options) {
            var features = null;
            this.forEachFeatureAtPixel(pixel, function(feature) {
                if (!features) {
                    features = [];
                }
                features.push(feature);
            }, opt_options);
            return features;
        };
        _ol_PluggableMap_.prototype.forEachLayerAtPixel = function(pixel, callback, opt_this, opt_layerFilter, opt_this2) {
            if (!this.frameState_) {
                return;
            }
            var thisArg = opt_this !== undefined ? opt_this : null;
            var layerFilter = opt_layerFilter !== undefined ? opt_layerFilter : _functions2.default.TRUE;
            var thisArg2 = opt_this2 !== undefined ? opt_this2 : null;
            return this.renderer_.forEachLayerAtPixel(pixel, this.frameState_, callback, thisArg, layerFilter, thisArg2);
        };
        _ol_PluggableMap_.prototype.hasFeatureAtPixel = function(pixel, opt_options) {
            if (!this.frameState_) {
                return false;
            }
            var coordinate = this.getCoordinateFromPixel(pixel);
            opt_options = opt_options !== undefined ? opt_options : {};
            var layerFilter = opt_options.layerFilter !== undefined ? opt_options.layerFilter : _functions2.default.TRUE;
            var hitTolerance = opt_options.hitTolerance !== undefined ? opt_options.hitTolerance * this.frameState_.pixelRatio : 0;
            return this.renderer_.hasFeatureAtCoordinate(coordinate, this.frameState_, hitTolerance, layerFilter, null);
        };
        _ol_PluggableMap_.prototype.getEventCoordinate = function(event) {
            return this.getCoordinateFromPixel(this.getEventPixel(event));
        };
        _ol_PluggableMap_.prototype.getEventPixel = function(event) {
            var viewportPosition = this.viewport_.getBoundingClientRect();
            var eventPosition = event.changedTouches ? event.changedTouches[0] : event;
            return [ eventPosition.clientX - viewportPosition.left, eventPosition.clientY - viewportPosition.top ];
        };
        _ol_PluggableMap_.prototype.getTarget = function() {
            return this.get(_mapproperty2.default.TARGET);
        };
        _ol_PluggableMap_.prototype.getTargetElement = function() {
            var target = this.getTarget();
            if (target !== undefined) {
                return typeof target === "string" ? document.getElementById(target) : target;
            } else {
                return null;
            }
        };
        _ol_PluggableMap_.prototype.getCoordinateFromPixel = function(pixel) {
            var frameState = this.frameState_;
            if (!frameState) {
                return null;
            } else {
                return _transform2.default.apply(frameState.pixelToCoordinateTransform, pixel.slice());
            }
        };
        _ol_PluggableMap_.prototype.getControls = function() {
            return this.controls;
        };
        _ol_PluggableMap_.prototype.getOverlays = function() {
            return this.overlays_;
        };
        _ol_PluggableMap_.prototype.getOverlayById = function(id) {
            var overlay = this.overlayIdIndex_[id.toString()];
            return overlay !== undefined ? overlay : null;
        };
        _ol_PluggableMap_.prototype.getInteractions = function() {
            return this.interactions;
        };
        _ol_PluggableMap_.prototype.getLayerGroup = function() {
            return this.get(_mapproperty2.default.LAYERGROUP);
        };
        _ol_PluggableMap_.prototype.getLayers = function() {
            var layers = this.getLayerGroup().getLayers();
            return layers;
        };
        _ol_PluggableMap_.prototype.getPixelFromCoordinate = function(coordinate) {
            var frameState = this.frameState_;
            if (!frameState) {
                return null;
            } else {
                return _transform2.default.apply(frameState.coordinateToPixelTransform, coordinate.slice(0, 2));
            }
        };
        _ol_PluggableMap_.prototype.getRenderer = function() {
            return this.renderer_;
        };
        _ol_PluggableMap_.prototype.getSize = function() {
            return this.get(_mapproperty2.default.SIZE);
        };
        _ol_PluggableMap_.prototype.getView = function() {
            return this.get(_mapproperty2.default.VIEW);
        };
        _ol_PluggableMap_.prototype.getViewport = function() {
            return this.viewport_;
        };
        _ol_PluggableMap_.prototype.getOverlayContainer = function() {
            return this.overlayContainer_;
        };
        _ol_PluggableMap_.prototype.getOverlayContainerStopEvent = function() {
            return this.overlayContainerStopEvent_;
        };
        _ol_PluggableMap_.prototype.getTilePriority = function(tile, tileSourceKey, tileCenter, tileResolution) {
            var frameState = this.frameState_;
            if (!frameState || !(tileSourceKey in frameState.wantedTiles)) {
                return _priorityqueue2.default.DROP;
            }
            if (!frameState.wantedTiles[tileSourceKey][tile.getKey()]) {
                return _priorityqueue2.default.DROP;
            }
            var deltaX = tileCenter[0] - frameState.focus[0];
            var deltaY = tileCenter[1] - frameState.focus[1];
            return 65536 * Math.log(tileResolution) + Math.sqrt(deltaX * deltaX + deltaY * deltaY) / tileResolution;
        };
        _ol_PluggableMap_.prototype.handleBrowserEvent = function(browserEvent, opt_type) {
            var type = opt_type || browserEvent.type;
            var mapBrowserEvent = new _mapbrowserevent2.default(type, this, browserEvent);
            this.handleMapBrowserEvent(mapBrowserEvent);
        };
        _ol_PluggableMap_.prototype.handleMapBrowserEvent = function(mapBrowserEvent) {
            if (!this.frameState_) {
                return;
            }
            this.focus_ = mapBrowserEvent.coordinate;
            mapBrowserEvent.frameState = this.frameState_;
            var interactionsArray = this.getInteractions().getArray();
            var i;
            if (this.dispatchEvent(mapBrowserEvent) !== false) {
                for (i = interactionsArray.length - 1; i >= 0; i--) {
                    var interaction = interactionsArray[i];
                    if (!interaction.getActive()) {
                        continue;
                    }
                    var cont = interaction.handleEvent(mapBrowserEvent);
                    if (!cont) {
                        break;
                    }
                }
            }
        };
        _ol_PluggableMap_.prototype.handlePostRender = function() {
            var frameState = this.frameState_;
            var tileQueue = this.tileQueue_;
            if (!tileQueue.isEmpty()) {
                var maxTotalLoading = 16;
                var maxNewLoads = maxTotalLoading;
                if (frameState) {
                    var hints = frameState.viewHints;
                    if (hints[_viewhint2.default.ANIMATING]) {
                        maxTotalLoading = this.loadTilesWhileAnimating_ ? 8 : 0;
                        maxNewLoads = 2;
                    }
                    if (hints[_viewhint2.default.INTERACTING]) {
                        maxTotalLoading = this.loadTilesWhileInteracting_ ? 8 : 0;
                        maxNewLoads = 2;
                    }
                }
                if (tileQueue.getTilesLoading() < maxTotalLoading) {
                    tileQueue.reprioritize();
                    tileQueue.loadMoreTiles(maxTotalLoading, maxNewLoads);
                }
            }
            var postRenderFunctions = this.postRenderFunctions_;
            var i, ii;
            for (i = 0, ii = postRenderFunctions.length; i < ii; ++i) {
                postRenderFunctions[i](this, frameState);
            }
            postRenderFunctions.length = 0;
        };
        _ol_PluggableMap_.prototype.handleSizeChanged_ = function() {
            this.render();
        };
        _ol_PluggableMap_.prototype.handleTargetChanged_ = function() {
            var targetElement;
            if (this.getTarget()) {
                targetElement = this.getTargetElement();
            }
            if (this.keyHandlerKeys_) {
                for (var i = 0, ii = this.keyHandlerKeys_.length; i < ii; ++i) {
                    _events2.default.unlistenByKey(this.keyHandlerKeys_[i]);
                }
                this.keyHandlerKeys_ = null;
            }
            if (!targetElement) {
                this.renderer_.removeLayerRenderers();
                _dom2.default.removeNode(this.viewport_);
                if (this.handleResize_ !== undefined) {
                    window.removeEventListener(_eventtype2.default.RESIZE, this.handleResize_, false);
                    this.handleResize_ = undefined;
                }
            } else {
                targetElement.appendChild(this.viewport_);
                var keyboardEventTarget = !this.keyboardEventTarget_ ? targetElement : this.keyboardEventTarget_;
                this.keyHandlerKeys_ = [ _events2.default.listen(keyboardEventTarget, _eventtype2.default.KEYDOWN, this.handleBrowserEvent, this), _events2.default.listen(keyboardEventTarget, _eventtype2.default.KEYPRESS, this.handleBrowserEvent, this) ];
                if (!this.handleResize_) {
                    this.handleResize_ = this.updateSize.bind(this);
                    window.addEventListener(_eventtype2.default.RESIZE, this.handleResize_, false);
                }
            }
            this.updateSize();
        };
        _ol_PluggableMap_.prototype.handleTileChange_ = function() {
            this.render();
        };
        _ol_PluggableMap_.prototype.handleViewPropertyChanged_ = function() {
            this.render();
        };
        _ol_PluggableMap_.prototype.handleViewChanged_ = function() {
            if (this.viewPropertyListenerKey_) {
                _events2.default.unlistenByKey(this.viewPropertyListenerKey_);
                this.viewPropertyListenerKey_ = null;
            }
            if (this.viewChangeListenerKey_) {
                _events2.default.unlistenByKey(this.viewChangeListenerKey_);
                this.viewChangeListenerKey_ = null;
            }
            var view = this.getView();
            if (view) {
                this.viewport_.setAttribute("data-view", _index2.default.getUid(view));
                this.viewPropertyListenerKey_ = _events2.default.listen(view, _objecteventtype2.default.PROPERTYCHANGE, this.handleViewPropertyChanged_, this);
                this.viewChangeListenerKey_ = _events2.default.listen(view, _eventtype2.default.CHANGE, this.handleViewPropertyChanged_, this);
            }
            this.render();
        };
        _ol_PluggableMap_.prototype.handleLayerGroupChanged_ = function() {
            if (this.layerGroupPropertyListenerKeys_) {
                this.layerGroupPropertyListenerKeys_.forEach(_events2.default.unlistenByKey);
                this.layerGroupPropertyListenerKeys_ = null;
            }
            var layerGroup = this.getLayerGroup();
            if (layerGroup) {
                this.layerGroupPropertyListenerKeys_ = [ _events2.default.listen(layerGroup, _objecteventtype2.default.PROPERTYCHANGE, this.render, this), _events2.default.listen(layerGroup, _eventtype2.default.CHANGE, this.render, this) ];
            }
            this.render();
        };
        _ol_PluggableMap_.prototype.isRendered = function() {
            return !!this.frameState_;
        };
        _ol_PluggableMap_.prototype.renderSync = function() {
            if (this.animationDelayKey_) {
                cancelAnimationFrame(this.animationDelayKey_);
            }
            this.animationDelay_();
        };
        _ol_PluggableMap_.prototype.render = function() {
            if (this.animationDelayKey_ === undefined) {
                this.animationDelayKey_ = requestAnimationFrame(this.animationDelay_);
            }
        };
        _ol_PluggableMap_.prototype.removeControl = function(control) {
            return this.getControls().remove(control);
        };
        _ol_PluggableMap_.prototype.removeInteraction = function(interaction) {
            return this.getInteractions().remove(interaction);
        };
        _ol_PluggableMap_.prototype.removeLayer = function(layer) {
            var layers = this.getLayerGroup().getLayers();
            return layers.remove(layer);
        };
        _ol_PluggableMap_.prototype.removeOverlay = function(overlay) {
            return this.getOverlays().remove(overlay);
        };
        _ol_PluggableMap_.prototype.renderFrame_ = function(time) {
            var i, ii, viewState;
            var size = this.getSize();
            var view = this.getView();
            var extent = _extent2.default.createEmpty();
            var previousFrameState = this.frameState_;
            var frameState = null;
            if (size !== undefined && _size2.default.hasArea(size) && view && view.isDef()) {
                var viewHints = view.getHints(this.frameState_ ? this.frameState_.viewHints : undefined);
                var layerStatesArray = this.getLayerGroup().getLayerStatesArray();
                var layerStates = {};
                for (i = 0, ii = layerStatesArray.length; i < ii; ++i) {
                    layerStates[_index2.default.getUid(layerStatesArray[i].layer)] = layerStatesArray[i];
                }
                viewState = view.getState();
                var center = viewState.center;
                var pixelResolution = viewState.resolution / this.pixelRatio_;
                center[0] = Math.round(center[0] / pixelResolution) * pixelResolution;
                center[1] = Math.round(center[1] / pixelResolution) * pixelResolution;
                frameState = {
                    animate: false,
                    coordinateToPixelTransform: this.coordinateToPixelTransform_,
                    extent: extent,
                    focus: !this.focus_ ? center : this.focus_,
                    index: this.frameIndex_++,
                    layerStates: layerStates,
                    layerStatesArray: layerStatesArray,
                    logos: _obj2.default.assign({}, this.logos_),
                    pixelRatio: this.pixelRatio_,
                    pixelToCoordinateTransform: this.pixelToCoordinateTransform_,
                    postRenderFunctions: [],
                    size: size,
                    skippedFeatureUids: this.skippedFeatureUids_,
                    tileQueue: this.tileQueue_,
                    time: time,
                    usedTiles: {},
                    viewState: viewState,
                    viewHints: viewHints,
                    wantedTiles: {}
                };
            }
            if (frameState) {
                frameState.extent = _extent2.default.getForViewAndSize(viewState.center, viewState.resolution, viewState.rotation, frameState.size, extent);
            }
            this.frameState_ = frameState;
            this.renderer_.renderFrame(frameState);
            if (frameState) {
                if (frameState.animate) {
                    this.render();
                }
                Array.prototype.push.apply(this.postRenderFunctions_, frameState.postRenderFunctions);
                if (previousFrameState) {
                    var moveStart = !this.previousExtent_ || !_extent2.default.isEmpty(this.previousExtent_) && !_extent2.default.equals(frameState.extent, this.previousExtent_);
                    if (moveStart) {
                        this.dispatchEvent(new _mapevent2.default(_mapeventtype2.default.MOVESTART, this, previousFrameState));
                        this.previousExtent_ = _extent2.default.createOrUpdateEmpty(this.previousExtent_);
                    }
                }
                var idle = this.previousExtent_ && !frameState.viewHints[_viewhint2.default.ANIMATING] && !frameState.viewHints[_viewhint2.default.INTERACTING] && !_extent2.default.equals(frameState.extent, this.previousExtent_);
                if (idle) {
                    this.dispatchEvent(new _mapevent2.default(_mapeventtype2.default.MOVEEND, this, frameState));
                    _extent2.default.clone(frameState.extent, this.previousExtent_);
                }
            }
            this.dispatchEvent(new _mapevent2.default(_mapeventtype2.default.POSTRENDER, this, frameState));
            setTimeout(this.handlePostRender.bind(this), 0);
        };
        _ol_PluggableMap_.prototype.setLayerGroup = function(layerGroup) {
            this.set(_mapproperty2.default.LAYERGROUP, layerGroup);
        };
        _ol_PluggableMap_.prototype.setSize = function(size) {
            this.set(_mapproperty2.default.SIZE, size);
        };
        _ol_PluggableMap_.prototype.setTarget = function(target) {
            this.set(_mapproperty2.default.TARGET, target);
        };
        _ol_PluggableMap_.prototype.setView = function(view) {
            this.set(_mapproperty2.default.VIEW, view);
        };
        _ol_PluggableMap_.prototype.skipFeature = function(feature) {
            var featureUid = _index2.default.getUid(feature).toString();
            this.skippedFeatureUids_[featureUid] = true;
            this.render();
        };
        _ol_PluggableMap_.prototype.updateSize = function() {
            var targetElement = this.getTargetElement();
            if (!targetElement) {
                this.setSize(undefined);
            } else {
                var computedStyle = getComputedStyle(targetElement);
                this.setSize([ targetElement.offsetWidth - parseFloat(computedStyle["borderLeftWidth"]) - parseFloat(computedStyle["paddingLeft"]) - parseFloat(computedStyle["paddingRight"]) - parseFloat(computedStyle["borderRightWidth"]), targetElement.offsetHeight - parseFloat(computedStyle["borderTopWidth"]) - parseFloat(computedStyle["paddingTop"]) - parseFloat(computedStyle["paddingBottom"]) - parseFloat(computedStyle["borderBottomWidth"]) ]);
            }
        };
        _ol_PluggableMap_.prototype.unskipFeature = function(feature) {
            var featureUid = _index2.default.getUid(feature).toString();
            delete this.skippedFeatureUids_[featureUid];
            this.render();
        };
        _ol_PluggableMap_.DEFAULT_RENDERER_TYPES = [ _type2.default.CANVAS, _type2.default.WEBGL ];
        _ol_PluggableMap_.LOGO_URL = "data:image/png;base64," + "iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBI" + "WXMAAAHGAAABxgEXwfpGAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAA" + "AhNQTFRF////AP//AICAgP//AFVVQECA////K1VVSbbbYL/fJ05idsTYJFtbbcjbJllmZszW" + "WMTOIFhoHlNiZszTa9DdUcHNHlNlV8XRIVdiasrUHlZjIVZjaMnVH1RlIFRkH1RkH1ZlasvY" + "asvXVsPQH1VkacnVa8vWIVZjIFRjVMPQa8rXIVVkXsXRsNveIFVkIFZlIVVj3eDeh6GmbMvX" + "H1ZkIFRka8rWbMvXIFVkIFVjIFVkbMvWH1VjbMvWIFVlbcvWIFVla8vVIFVkbMvWbMvVH1Vk" + "bMvWIFVlbcvWIFVkbcvVbMvWjNPbIFVkU8LPwMzNIFVkbczWIFVkbsvWbMvXIFVkRnB8bcvW" + "2+TkW8XRIFVkIlZlJVloJlpoKlxrLl9tMmJwOWd0Omh1RXF8TneCT3iDUHiDU8LPVMLPVcLP" + "VcPQVsPPVsPQV8PQWMTQWsTQW8TQXMXSXsXRX4SNX8bSYMfTYcfTYsfTY8jUZcfSZsnUaIqT" + "acrVasrVa8jTa8rWbI2VbMvWbcvWdJObdcvUdszUd8vVeJaee87Yfc3WgJyjhqGnitDYjaar" + "ldPZnrK2oNbborW5o9bbo9fbpLa6q9ndrL3ArtndscDDutzfu8fJwN7gwt7gxc/QyuHhy+Hi" + "zeHi0NfX0+Pj19zb1+Tj2uXk29/e3uLg3+Lh3+bl4uXj4ufl4+fl5Ofl5ufl5ujm5+jmySDn" + "BAAAAFp0Uk5TAAECAgMEBAYHCA0NDg4UGRogIiMmKSssLzU7PkJJT1JTVFliY2hrdHZ3foSF" + "hYeJjY2QkpugqbG1tre5w8zQ09XY3uXn6+zx8vT09vf4+Pj5+fr6/P39/f3+gz7SsAAAAVVJ" + "REFUOMtjYKA7EBDnwCPLrObS1BRiLoJLnte6CQy8FLHLCzs2QUG4FjZ5GbcmBDDjxJBXDWxC" + "Brb8aM4zbkIDzpLYnAcE9VXlJSWlZRU13koIeW57mGx5XjoMZEUqwxWYQaQbSzLSkYGfKFSe" + "0QMsX5WbjgY0YS4MBplemI4BdGBW+DQ11eZiymfqQuXZIjqwyadPNoSZ4L+0FVM6e+oGI6g8" + "a9iKNT3o8kVzNkzRg5lgl7p4wyRUL9Yt2jAxVh6mQCogae6GmflI8p0r13VFWTHBQ0rWPW7a" + "hgWVcPm+9cuLoyy4kCJDzCm6d8PSFoh0zvQNC5OjDJhQopPPJqph1doJBUD5tnkbZiUEqaCn" + "B3bTqLTFG1bPn71kw4b+GFdpLElKIzRxxgYgWNYc5SCENVHKeUaltHdXx0dZ8uBI1hJ2UUDg" + "q82CM2MwKeibqAvSO7MCABq0wXEPiqWEAAAAAElFTkSuQmCC";
        _ol_PluggableMap_.createOptionsInternal = function(options) {
            var keyboardEventTarget = null;
            if (options.keyboardEventTarget !== undefined) {
                keyboardEventTarget = typeof options.keyboardEventTarget === "string" ? document.getElementById(options.keyboardEventTarget) : options.keyboardEventTarget;
            }
            var values = {};
            var logos = {};
            if (options.logo === undefined || typeof options.logo === "boolean" && options.logo) {
                logos[_ol_PluggableMap_.LOGO_URL] = "https://openlayers.org/";
            } else {
                var logo = options.logo;
                if (typeof logo === "string") {
                    logos[logo] = "";
                } else if (logo instanceof HTMLElement) {
                    logos[_index2.default.getUid(logo).toString()] = logo;
                } else if (logo) {
                    _asserts2.default.assert(typeof logo.href == "string", 44);
                    _asserts2.default.assert(typeof logo.src == "string", 45);
                    logos[logo.src] = logo.href;
                }
            }
            var layerGroup = options.layers instanceof _group2.default ? options.layers : new _group2.default({
                layers: options.layers
            });
            values[_mapproperty2.default.LAYERGROUP] = layerGroup;
            values[_mapproperty2.default.TARGET] = options.target;
            values[_mapproperty2.default.VIEW] = options.view !== undefined ? options.view : new _view2.default();
            var rendererTypes;
            if (options.renderer !== undefined) {
                if (Array.isArray(options.renderer)) {
                    rendererTypes = options.renderer;
                } else if (typeof options.renderer === "string") {
                    rendererTypes = [ options.renderer ];
                } else {
                    _asserts2.default.assert(false, 46);
                }
                if (rendererTypes.indexOf("dom") >= 0) {
                    rendererTypes = rendererTypes.concat(_ol_PluggableMap_.DEFAULT_RENDERER_TYPES);
                }
            } else {
                rendererTypes = _ol_PluggableMap_.DEFAULT_RENDERER_TYPES;
            }
            var mapRendererPlugin;
            var mapRendererPlugins = _plugins2.default.getMapRendererPlugins();
            outer: for (var i = 0, ii = rendererTypes.length; i < ii; ++i) {
                var rendererType = rendererTypes[i];
                for (var j = 0, jj = mapRendererPlugins.length; j < jj; ++j) {
                    var candidate = mapRendererPlugins[j];
                    if (candidate["handles"](rendererType)) {
                        mapRendererPlugin = candidate;
                        break outer;
                    }
                }
            }
            if (!mapRendererPlugin) {
                throw new Error("Unable to create a map renderer for types: " + rendererTypes.join(", "));
            }
            var controls;
            if (options.controls !== undefined) {
                if (Array.isArray(options.controls)) {
                    controls = new _collection2.default(options.controls.slice());
                } else {
                    _asserts2.default.assert(options.controls instanceof _collection2.default, 47);
                    controls = options.controls;
                }
            }
            var interactions;
            if (options.interactions !== undefined) {
                if (Array.isArray(options.interactions)) {
                    interactions = new _collection2.default(options.interactions.slice());
                } else {
                    _asserts2.default.assert(options.interactions instanceof _collection2.default, 48);
                    interactions = options.interactions;
                }
            }
            var overlays;
            if (options.overlays !== undefined) {
                if (Array.isArray(options.overlays)) {
                    overlays = new _collection2.default(options.overlays.slice());
                } else {
                    _asserts2.default.assert(options.overlays instanceof _collection2.default, 49);
                    overlays = options.overlays;
                }
            } else {
                overlays = new _collection2.default();
            }
            return {
                controls: controls,
                interactions: interactions,
                keyboardEventTarget: keyboardEventTarget,
                logos: logos,
                overlays: overlays,
                mapRendererPlugin: mapRendererPlugin,
                values: values
            };
        };
        exports.default = _ol_PluggableMap_;
    }, {
        "./asserts.js": 31,
        "./collection.js": 34,
        "./collectioneventtype.js": 35,
        "./dom.js": 46,
        "./events.js": 48,
        "./events/event.js": 50,
        "./events/eventtype.js": 52,
        "./extent.js": 54,
        "./functions.js": 60,
        "./has.js": 84,
        "./index.js": 89,
        "./layer/group.js": 106,
        "./mapbrowserevent.js": 116,
        "./mapbrowsereventhandler.js": 117,
        "./mapbrowsereventtype.js": 118,
        "./mapevent.js": 120,
        "./mapeventtype.js": 121,
        "./mapproperty.js": 122,
        "./obj.js": 124,
        "./object.js": 125,
        "./objecteventtype.js": 126,
        "./plugins.js": 131,
        "./renderer/type.js": 192,
        "./size.js": 208,
        "./structs/priorityqueue.js": 219,
        "./tilequeue.js": 240,
        "./transform.js": 243,
        "./view.js": 245,
        "./viewhint.js": 246
    } ],
    131: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _plugintype = require("./plugintype.js");
        var _plugintype2 = _interopRequireDefault(_plugintype);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_plugins_ = {};
        _ol_plugins_.mapRendererPlugins_ = [];
        _ol_plugins_.getMapRendererPlugins = function() {
            return _ol_plugins_.mapRendererPlugins_;
        };
        _ol_plugins_.layerRendererPlugins_ = [];
        _ol_plugins_.getLayerRendererPlugins = function() {
            return _ol_plugins_.layerRendererPlugins_;
        };
        _ol_plugins_.register = function(type, plugin) {
            var plugins;
            switch (type) {
              case _plugintype2.default.MAP_RENDERER:
                {
                    plugins = _ol_plugins_.mapRendererPlugins_;
                    plugins.push(plugin);
                    break;
                }

              case _plugintype2.default.LAYER_RENDERER:
                {
                    plugins = _ol_plugins_.layerRendererPlugins_;
                    plugins.push(plugin);
                    break;
                }

              default:
                {
                    throw new Error("Unsupported plugin type: " + type);
                }
            }
        };
        _ol_plugins_.registerMultiple = function(type, plugins) {
            for (var i = 0, ii = plugins.length; i < ii; ++i) {
                _ol_plugins_.register(type, plugins[i]);
            }
        };
        exports.default = _ol_plugins_;
    }, {
        "./plugintype.js": 132
    } ],
    132: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_PluginType_ = {
            MAP_RENDERER: "MAP_RENDERER",
            LAYER_RENDERER: "LAYER_RENDERER"
        };
        exports.default = _ol_PluginType_;
    }, {} ],
    133: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_pointer_EventSource_ = function(dispatcher, mapping) {
            this.dispatcher = dispatcher;
            this.mapping_ = mapping;
        };
        _ol_pointer_EventSource_.prototype.getEvents = function() {
            return Object.keys(this.mapping_);
        };
        _ol_pointer_EventSource_.prototype.getHandlerForEvent = function(eventType) {
            return this.mapping_[eventType];
        };
        exports.default = _ol_pointer_EventSource_;
    }, {} ],
    134: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_pointer_EventType_ = {
            POINTERMOVE: "pointermove",
            POINTERDOWN: "pointerdown",
            POINTERUP: "pointerup",
            POINTEROVER: "pointerover",
            POINTEROUT: "pointerout",
            POINTERENTER: "pointerenter",
            POINTERLEAVE: "pointerleave",
            POINTERCANCEL: "pointercancel"
        };
        exports.default = _ol_pointer_EventType_;
    }, {} ],
    135: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _eventsource = require("../pointer/eventsource.js");
        var _eventsource2 = _interopRequireDefault(_eventsource);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_pointer_MouseSource_ = function(dispatcher) {
            var mapping = {
                mousedown: this.mousedown,
                mousemove: this.mousemove,
                mouseup: this.mouseup,
                mouseover: this.mouseover,
                mouseout: this.mouseout
            };
            _eventsource2.default.call(this, dispatcher, mapping);
            this.pointerMap = dispatcher.pointerMap;
            this.lastTouches = [];
        };
        _index2.default.inherits(_ol_pointer_MouseSource_, _eventsource2.default);
        _ol_pointer_MouseSource_.POINTER_ID = 1;
        _ol_pointer_MouseSource_.POINTER_TYPE = "mouse";
        _ol_pointer_MouseSource_.DEDUP_DIST = 25;
        _ol_pointer_MouseSource_.prototype.isEventSimulatedFromTouch_ = function(inEvent) {
            var lts = this.lastTouches;
            var x = inEvent.clientX, y = inEvent.clientY;
            for (var i = 0, l = lts.length, t; i < l && (t = lts[i]); i++) {
                var dx = Math.abs(x - t[0]), dy = Math.abs(y - t[1]);
                if (dx <= _ol_pointer_MouseSource_.DEDUP_DIST && dy <= _ol_pointer_MouseSource_.DEDUP_DIST) {
                    return true;
                }
            }
            return false;
        };
        _ol_pointer_MouseSource_.prepareEvent = function(inEvent, dispatcher) {
            var e = dispatcher.cloneEvent(inEvent, inEvent);
            var pd = e.preventDefault;
            e.preventDefault = function() {
                inEvent.preventDefault();
                pd();
            };
            e.pointerId = _ol_pointer_MouseSource_.POINTER_ID;
            e.isPrimary = true;
            e.pointerType = _ol_pointer_MouseSource_.POINTER_TYPE;
            return e;
        };
        _ol_pointer_MouseSource_.prototype.mousedown = function(inEvent) {
            if (!this.isEventSimulatedFromTouch_(inEvent)) {
                if (_ol_pointer_MouseSource_.POINTER_ID.toString() in this.pointerMap) {
                    this.cancel(inEvent);
                }
                var e = _ol_pointer_MouseSource_.prepareEvent(inEvent, this.dispatcher);
                this.pointerMap[_ol_pointer_MouseSource_.POINTER_ID.toString()] = inEvent;
                this.dispatcher.down(e, inEvent);
            }
        };
        _ol_pointer_MouseSource_.prototype.mousemove = function(inEvent) {
            if (!this.isEventSimulatedFromTouch_(inEvent)) {
                var e = _ol_pointer_MouseSource_.prepareEvent(inEvent, this.dispatcher);
                this.dispatcher.move(e, inEvent);
            }
        };
        _ol_pointer_MouseSource_.prototype.mouseup = function(inEvent) {
            if (!this.isEventSimulatedFromTouch_(inEvent)) {
                var p = this.pointerMap[_ol_pointer_MouseSource_.POINTER_ID.toString()];
                if (p && p.button === inEvent.button) {
                    var e = _ol_pointer_MouseSource_.prepareEvent(inEvent, this.dispatcher);
                    this.dispatcher.up(e, inEvent);
                    this.cleanupMouse();
                }
            }
        };
        _ol_pointer_MouseSource_.prototype.mouseover = function(inEvent) {
            if (!this.isEventSimulatedFromTouch_(inEvent)) {
                var e = _ol_pointer_MouseSource_.prepareEvent(inEvent, this.dispatcher);
                this.dispatcher.enterOver(e, inEvent);
            }
        };
        _ol_pointer_MouseSource_.prototype.mouseout = function(inEvent) {
            if (!this.isEventSimulatedFromTouch_(inEvent)) {
                var e = _ol_pointer_MouseSource_.prepareEvent(inEvent, this.dispatcher);
                this.dispatcher.leaveOut(e, inEvent);
            }
        };
        _ol_pointer_MouseSource_.prototype.cancel = function(inEvent) {
            var e = _ol_pointer_MouseSource_.prepareEvent(inEvent, this.dispatcher);
            this.dispatcher.cancel(e, inEvent);
            this.cleanupMouse();
        };
        _ol_pointer_MouseSource_.prototype.cleanupMouse = function() {
            delete this.pointerMap[_ol_pointer_MouseSource_.POINTER_ID.toString()];
        };
        exports.default = _ol_pointer_MouseSource_;
    }, {
        "../index.js": 89,
        "../pointer/eventsource.js": 133
    } ],
    136: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _eventsource = require("../pointer/eventsource.js");
        var _eventsource2 = _interopRequireDefault(_eventsource);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_pointer_MsSource_ = function(dispatcher) {
            var mapping = {
                MSPointerDown: this.msPointerDown,
                MSPointerMove: this.msPointerMove,
                MSPointerUp: this.msPointerUp,
                MSPointerOut: this.msPointerOut,
                MSPointerOver: this.msPointerOver,
                MSPointerCancel: this.msPointerCancel,
                MSGotPointerCapture: this.msGotPointerCapture,
                MSLostPointerCapture: this.msLostPointerCapture
            };
            _eventsource2.default.call(this, dispatcher, mapping);
            this.pointerMap = dispatcher.pointerMap;
            this.POINTER_TYPES = [ "", "unavailable", "touch", "pen", "mouse" ];
        };
        _index2.default.inherits(_ol_pointer_MsSource_, _eventsource2.default);
        _ol_pointer_MsSource_.prototype.prepareEvent_ = function(inEvent) {
            var e = inEvent;
            if (typeof inEvent.pointerType === "number") {
                e = this.dispatcher.cloneEvent(inEvent, inEvent);
                e.pointerType = this.POINTER_TYPES[inEvent.pointerType];
            }
            return e;
        };
        _ol_pointer_MsSource_.prototype.cleanup = function(pointerId) {
            delete this.pointerMap[pointerId.toString()];
        };
        _ol_pointer_MsSource_.prototype.msPointerDown = function(inEvent) {
            this.pointerMap[inEvent.pointerId.toString()] = inEvent;
            var e = this.prepareEvent_(inEvent);
            this.dispatcher.down(e, inEvent);
        };
        _ol_pointer_MsSource_.prototype.msPointerMove = function(inEvent) {
            var e = this.prepareEvent_(inEvent);
            this.dispatcher.move(e, inEvent);
        };
        _ol_pointer_MsSource_.prototype.msPointerUp = function(inEvent) {
            var e = this.prepareEvent_(inEvent);
            this.dispatcher.up(e, inEvent);
            this.cleanup(inEvent.pointerId);
        };
        _ol_pointer_MsSource_.prototype.msPointerOut = function(inEvent) {
            var e = this.prepareEvent_(inEvent);
            this.dispatcher.leaveOut(e, inEvent);
        };
        _ol_pointer_MsSource_.prototype.msPointerOver = function(inEvent) {
            var e = this.prepareEvent_(inEvent);
            this.dispatcher.enterOver(e, inEvent);
        };
        _ol_pointer_MsSource_.prototype.msPointerCancel = function(inEvent) {
            var e = this.prepareEvent_(inEvent);
            this.dispatcher.cancel(e, inEvent);
            this.cleanup(inEvent.pointerId);
        };
        _ol_pointer_MsSource_.prototype.msLostPointerCapture = function(inEvent) {
            var e = this.dispatcher.makeEvent("lostpointercapture", inEvent, inEvent);
            this.dispatcher.dispatchEvent(e);
        };
        _ol_pointer_MsSource_.prototype.msGotPointerCapture = function(inEvent) {
            var e = this.dispatcher.makeEvent("gotpointercapture", inEvent, inEvent);
            this.dispatcher.dispatchEvent(e);
        };
        exports.default = _ol_pointer_MsSource_;
    }, {
        "../index.js": 89,
        "../pointer/eventsource.js": 133
    } ],
    137: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _eventsource = require("../pointer/eventsource.js");
        var _eventsource2 = _interopRequireDefault(_eventsource);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_pointer_NativeSource_ = function(dispatcher) {
            var mapping = {
                pointerdown: this.pointerDown,
                pointermove: this.pointerMove,
                pointerup: this.pointerUp,
                pointerout: this.pointerOut,
                pointerover: this.pointerOver,
                pointercancel: this.pointerCancel,
                gotpointercapture: this.gotPointerCapture,
                lostpointercapture: this.lostPointerCapture
            };
            _eventsource2.default.call(this, dispatcher, mapping);
        };
        _index2.default.inherits(_ol_pointer_NativeSource_, _eventsource2.default);
        _ol_pointer_NativeSource_.prototype.pointerDown = function(inEvent) {
            this.dispatcher.fireNativeEvent(inEvent);
        };
        _ol_pointer_NativeSource_.prototype.pointerMove = function(inEvent) {
            this.dispatcher.fireNativeEvent(inEvent);
        };
        _ol_pointer_NativeSource_.prototype.pointerUp = function(inEvent) {
            this.dispatcher.fireNativeEvent(inEvent);
        };
        _ol_pointer_NativeSource_.prototype.pointerOut = function(inEvent) {
            this.dispatcher.fireNativeEvent(inEvent);
        };
        _ol_pointer_NativeSource_.prototype.pointerOver = function(inEvent) {
            this.dispatcher.fireNativeEvent(inEvent);
        };
        _ol_pointer_NativeSource_.prototype.pointerCancel = function(inEvent) {
            this.dispatcher.fireNativeEvent(inEvent);
        };
        _ol_pointer_NativeSource_.prototype.lostPointerCapture = function(inEvent) {
            this.dispatcher.fireNativeEvent(inEvent);
        };
        _ol_pointer_NativeSource_.prototype.gotPointerCapture = function(inEvent) {
            this.dispatcher.fireNativeEvent(inEvent);
        };
        exports.default = _ol_pointer_NativeSource_;
    }, {
        "../index.js": 89,
        "../pointer/eventsource.js": 133
    } ],
    138: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _event = require("../events/event.js");
        var _event2 = _interopRequireDefault(_event);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_pointer_PointerEvent_ = function(type, originalEvent, opt_eventDict) {
            _event2.default.call(this, type);
            this.originalEvent = originalEvent;
            var eventDict = opt_eventDict ? opt_eventDict : {};
            this.buttons = this.getButtons_(eventDict);
            this.pressure = this.getPressure_(eventDict, this.buttons);
            this.bubbles = "bubbles" in eventDict ? eventDict["bubbles"] : false;
            this.cancelable = "cancelable" in eventDict ? eventDict["cancelable"] : false;
            this.view = "view" in eventDict ? eventDict["view"] : null;
            this.detail = "detail" in eventDict ? eventDict["detail"] : null;
            this.screenX = "screenX" in eventDict ? eventDict["screenX"] : 0;
            this.screenY = "screenY" in eventDict ? eventDict["screenY"] : 0;
            this.clientX = "clientX" in eventDict ? eventDict["clientX"] : 0;
            this.clientY = "clientY" in eventDict ? eventDict["clientY"] : 0;
            this.ctrlKey = "ctrlKey" in eventDict ? eventDict["ctrlKey"] : false;
            this.altKey = "altKey" in eventDict ? eventDict["altKey"] : false;
            this.shiftKey = "shiftKey" in eventDict ? eventDict["shiftKey"] : false;
            this.metaKey = "metaKey" in eventDict ? eventDict["metaKey"] : false;
            this.button = "button" in eventDict ? eventDict["button"] : 0;
            this.relatedTarget = "relatedTarget" in eventDict ? eventDict["relatedTarget"] : null;
            this.pointerId = "pointerId" in eventDict ? eventDict["pointerId"] : 0;
            this.width = "width" in eventDict ? eventDict["width"] : 0;
            this.height = "height" in eventDict ? eventDict["height"] : 0;
            this.tiltX = "tiltX" in eventDict ? eventDict["tiltX"] : 0;
            this.tiltY = "tiltY" in eventDict ? eventDict["tiltY"] : 0;
            this.pointerType = "pointerType" in eventDict ? eventDict["pointerType"] : "";
            this.hwTimestamp = "hwTimestamp" in eventDict ? eventDict["hwTimestamp"] : 0;
            this.isPrimary = "isPrimary" in eventDict ? eventDict["isPrimary"] : false;
            if (originalEvent.preventDefault) {
                this.preventDefault = function() {
                    originalEvent.preventDefault();
                };
            }
        };
        _index2.default.inherits(_ol_pointer_PointerEvent_, _event2.default);
        _ol_pointer_PointerEvent_.prototype.getButtons_ = function(eventDict) {
            var buttons;
            if (eventDict.buttons || _ol_pointer_PointerEvent_.HAS_BUTTONS) {
                buttons = eventDict.buttons;
            } else {
                switch (eventDict.which) {
                  case 1:
                    buttons = 1;
                    break;

                  case 2:
                    buttons = 4;
                    break;

                  case 3:
                    buttons = 2;
                    break;

                  default:
                    buttons = 0;
                }
            }
            return buttons;
        };
        _ol_pointer_PointerEvent_.prototype.getPressure_ = function(eventDict, buttons) {
            var pressure = 0;
            if (eventDict.pressure) {
                pressure = eventDict.pressure;
            } else {
                pressure = buttons ? .5 : 0;
            }
            return pressure;
        };
        _ol_pointer_PointerEvent_.HAS_BUTTONS = false;
        (function() {
            try {
                var ev = new MouseEvent("click", {
                    buttons: 1
                });
                _ol_pointer_PointerEvent_.HAS_BUTTONS = ev.buttons === 1;
            } catch (e) {}
        })();
        exports.default = _ol_pointer_PointerEvent_;
    }, {
        "../events/event.js": 50,
        "../index.js": 89
    } ],
    139: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtarget = require("../events/eventtarget.js");
        var _eventtarget2 = _interopRequireDefault(_eventtarget);
        var _has = require("../has.js");
        var _has2 = _interopRequireDefault(_has);
        var _eventtype = require("../pointer/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _mousesource = require("../pointer/mousesource.js");
        var _mousesource2 = _interopRequireDefault(_mousesource);
        var _mssource = require("../pointer/mssource.js");
        var _mssource2 = _interopRequireDefault(_mssource);
        var _nativesource = require("../pointer/nativesource.js");
        var _nativesource2 = _interopRequireDefault(_nativesource);
        var _pointerevent = require("../pointer/pointerevent.js");
        var _pointerevent2 = _interopRequireDefault(_pointerevent);
        var _touchsource = require("../pointer/touchsource.js");
        var _touchsource2 = _interopRequireDefault(_touchsource);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_pointer_PointerEventHandler_ = function(element) {
            _eventtarget2.default.call(this);
            this.element_ = element;
            this.pointerMap = {};
            this.eventMap_ = {};
            this.eventSourceList_ = [];
            this.registerSources();
        };
        _index2.default.inherits(_ol_pointer_PointerEventHandler_, _eventtarget2.default);
        _ol_pointer_PointerEventHandler_.prototype.registerSources = function() {
            if (_has2.default.POINTER) {
                this.registerSource("native", new _nativesource2.default(this));
            } else if (_has2.default.MSPOINTER) {
                this.registerSource("ms", new _mssource2.default(this));
            } else {
                var mouseSource = new _mousesource2.default(this);
                this.registerSource("mouse", mouseSource);
                if (_has2.default.TOUCH) {
                    this.registerSource("touch", new _touchsource2.default(this, mouseSource));
                }
            }
            this.register_();
        };
        _ol_pointer_PointerEventHandler_.prototype.registerSource = function(name, source) {
            var s = source;
            var newEvents = s.getEvents();
            if (newEvents) {
                newEvents.forEach(function(e) {
                    var handler = s.getHandlerForEvent(e);
                    if (handler) {
                        this.eventMap_[e] = handler.bind(s);
                    }
                }, this);
                this.eventSourceList_.push(s);
            }
        };
        _ol_pointer_PointerEventHandler_.prototype.register_ = function() {
            var l = this.eventSourceList_.length;
            var eventSource;
            for (var i = 0; i < l; i++) {
                eventSource = this.eventSourceList_[i];
                this.addEvents_(eventSource.getEvents());
            }
        };
        _ol_pointer_PointerEventHandler_.prototype.unregister_ = function() {
            var l = this.eventSourceList_.length;
            var eventSource;
            for (var i = 0; i < l; i++) {
                eventSource = this.eventSourceList_[i];
                this.removeEvents_(eventSource.getEvents());
            }
        };
        _ol_pointer_PointerEventHandler_.prototype.eventHandler_ = function(inEvent) {
            var type = inEvent.type;
            var handler = this.eventMap_[type];
            if (handler) {
                handler(inEvent);
            }
        };
        _ol_pointer_PointerEventHandler_.prototype.addEvents_ = function(events) {
            events.forEach(function(eventName) {
                _events2.default.listen(this.element_, eventName, this.eventHandler_, this);
            }, this);
        };
        _ol_pointer_PointerEventHandler_.prototype.removeEvents_ = function(events) {
            events.forEach(function(e) {
                _events2.default.unlisten(this.element_, e, this.eventHandler_, this);
            }, this);
        };
        _ol_pointer_PointerEventHandler_.prototype.cloneEvent = function(event, inEvent) {
            var eventCopy = {}, p;
            for (var i = 0, ii = _ol_pointer_PointerEventHandler_.CLONE_PROPS.length; i < ii; i++) {
                p = _ol_pointer_PointerEventHandler_.CLONE_PROPS[i][0];
                eventCopy[p] = event[p] || inEvent[p] || _ol_pointer_PointerEventHandler_.CLONE_PROPS[i][1];
            }
            return eventCopy;
        };
        _ol_pointer_PointerEventHandler_.prototype.down = function(data, event) {
            this.fireEvent(_eventtype2.default.POINTERDOWN, data, event);
        };
        _ol_pointer_PointerEventHandler_.prototype.move = function(data, event) {
            this.fireEvent(_eventtype2.default.POINTERMOVE, data, event);
        };
        _ol_pointer_PointerEventHandler_.prototype.up = function(data, event) {
            this.fireEvent(_eventtype2.default.POINTERUP, data, event);
        };
        _ol_pointer_PointerEventHandler_.prototype.enter = function(data, event) {
            data.bubbles = false;
            this.fireEvent(_eventtype2.default.POINTERENTER, data, event);
        };
        _ol_pointer_PointerEventHandler_.prototype.leave = function(data, event) {
            data.bubbles = false;
            this.fireEvent(_eventtype2.default.POINTERLEAVE, data, event);
        };
        _ol_pointer_PointerEventHandler_.prototype.over = function(data, event) {
            data.bubbles = true;
            this.fireEvent(_eventtype2.default.POINTEROVER, data, event);
        };
        _ol_pointer_PointerEventHandler_.prototype.out = function(data, event) {
            data.bubbles = true;
            this.fireEvent(_eventtype2.default.POINTEROUT, data, event);
        };
        _ol_pointer_PointerEventHandler_.prototype.cancel = function(data, event) {
            this.fireEvent(_eventtype2.default.POINTERCANCEL, data, event);
        };
        _ol_pointer_PointerEventHandler_.prototype.leaveOut = function(data, event) {
            this.out(data, event);
            if (!this.contains_(data.target, data.relatedTarget)) {
                this.leave(data, event);
            }
        };
        _ol_pointer_PointerEventHandler_.prototype.enterOver = function(data, event) {
            this.over(data, event);
            if (!this.contains_(data.target, data.relatedTarget)) {
                this.enter(data, event);
            }
        };
        _ol_pointer_PointerEventHandler_.prototype.contains_ = function(container, contained) {
            if (!container || !contained) {
                return false;
            }
            return container.contains(contained);
        };
        _ol_pointer_PointerEventHandler_.prototype.makeEvent = function(inType, data, event) {
            return new _pointerevent2.default(inType, event, data);
        };
        _ol_pointer_PointerEventHandler_.prototype.fireEvent = function(inType, data, event) {
            var e = this.makeEvent(inType, data, event);
            this.dispatchEvent(e);
        };
        _ol_pointer_PointerEventHandler_.prototype.fireNativeEvent = function(event) {
            var e = this.makeEvent(event.type, event, event);
            this.dispatchEvent(e);
        };
        _ol_pointer_PointerEventHandler_.prototype.wrapMouseEvent = function(eventType, event) {
            var pointerEvent = this.makeEvent(eventType, _mousesource2.default.prepareEvent(event, this), event);
            return pointerEvent;
        };
        _ol_pointer_PointerEventHandler_.prototype.disposeInternal = function() {
            this.unregister_();
            _eventtarget2.default.prototype.disposeInternal.call(this);
        };
        _ol_pointer_PointerEventHandler_.CLONE_PROPS = [ [ "bubbles", false ], [ "cancelable", false ], [ "view", null ], [ "detail", null ], [ "screenX", 0 ], [ "screenY", 0 ], [ "clientX", 0 ], [ "clientY", 0 ], [ "ctrlKey", false ], [ "altKey", false ], [ "shiftKey", false ], [ "metaKey", false ], [ "button", 0 ], [ "relatedTarget", null ], [ "buttons", 0 ], [ "pointerId", 0 ], [ "width", 0 ], [ "height", 0 ], [ "pressure", 0 ], [ "tiltX", 0 ], [ "tiltY", 0 ], [ "pointerType", "" ], [ "hwTimestamp", 0 ], [ "isPrimary", false ], [ "type", "" ], [ "target", null ], [ "currentTarget", null ], [ "which", 0 ] ];
        exports.default = _ol_pointer_PointerEventHandler_;
    }, {
        "../events.js": 48,
        "../events/eventtarget.js": 51,
        "../has.js": 84,
        "../index.js": 89,
        "../pointer/eventtype.js": 134,
        "../pointer/mousesource.js": 135,
        "../pointer/mssource.js": 136,
        "../pointer/nativesource.js": 137,
        "../pointer/pointerevent.js": 138,
        "../pointer/touchsource.js": 140
    } ],
    140: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _eventsource = require("../pointer/eventsource.js");
        var _eventsource2 = _interopRequireDefault(_eventsource);
        var _mousesource = require("../pointer/mousesource.js");
        var _mousesource2 = _interopRequireDefault(_mousesource);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_pointer_TouchSource_ = function(dispatcher, mouseSource) {
            var mapping = {
                touchstart: this.touchstart,
                touchmove: this.touchmove,
                touchend: this.touchend,
                touchcancel: this.touchcancel
            };
            _eventsource2.default.call(this, dispatcher, mapping);
            this.pointerMap = dispatcher.pointerMap;
            this.mouseSource = mouseSource;
            this.firstTouchId_ = undefined;
            this.clickCount_ = 0;
            this.resetId_ = undefined;
        };
        _index2.default.inherits(_ol_pointer_TouchSource_, _eventsource2.default);
        _ol_pointer_TouchSource_.DEDUP_TIMEOUT = 2500;
        _ol_pointer_TouchSource_.CLICK_COUNT_TIMEOUT = 200;
        _ol_pointer_TouchSource_.POINTER_TYPE = "touch";
        _ol_pointer_TouchSource_.prototype.isPrimaryTouch_ = function(inTouch) {
            return this.firstTouchId_ === inTouch.identifier;
        };
        _ol_pointer_TouchSource_.prototype.setPrimaryTouch_ = function(inTouch) {
            var count = Object.keys(this.pointerMap).length;
            if (count === 0 || count === 1 && _mousesource2.default.POINTER_ID.toString() in this.pointerMap) {
                this.firstTouchId_ = inTouch.identifier;
                this.cancelResetClickCount_();
            }
        };
        _ol_pointer_TouchSource_.prototype.removePrimaryPointer_ = function(inPointer) {
            if (inPointer.isPrimary) {
                this.firstTouchId_ = undefined;
                this.resetClickCount_();
            }
        };
        _ol_pointer_TouchSource_.prototype.resetClickCount_ = function() {
            this.resetId_ = setTimeout(this.resetClickCountHandler_.bind(this), _ol_pointer_TouchSource_.CLICK_COUNT_TIMEOUT);
        };
        _ol_pointer_TouchSource_.prototype.resetClickCountHandler_ = function() {
            this.clickCount_ = 0;
            this.resetId_ = undefined;
        };
        _ol_pointer_TouchSource_.prototype.cancelResetClickCount_ = function() {
            if (this.resetId_ !== undefined) {
                clearTimeout(this.resetId_);
            }
        };
        _ol_pointer_TouchSource_.prototype.touchToPointer_ = function(browserEvent, inTouch) {
            var e = this.dispatcher.cloneEvent(browserEvent, inTouch);
            e.pointerId = inTouch.identifier + 2;
            e.bubbles = true;
            e.cancelable = true;
            e.detail = this.clickCount_;
            e.button = 0;
            e.buttons = 1;
            e.width = inTouch.webkitRadiusX || inTouch.radiusX || 0;
            e.height = inTouch.webkitRadiusY || inTouch.radiusY || 0;
            e.pressure = inTouch.webkitForce || inTouch.force || .5;
            e.isPrimary = this.isPrimaryTouch_(inTouch);
            e.pointerType = _ol_pointer_TouchSource_.POINTER_TYPE;
            e.clientX = inTouch.clientX;
            e.clientY = inTouch.clientY;
            e.screenX = inTouch.screenX;
            e.screenY = inTouch.screenY;
            return e;
        };
        _ol_pointer_TouchSource_.prototype.processTouches_ = function(inEvent, inFunction) {
            var touches = Array.prototype.slice.call(inEvent.changedTouches);
            var count = touches.length;
            function preventDefault() {
                inEvent.preventDefault();
            }
            var i, pointer;
            for (i = 0; i < count; ++i) {
                pointer = this.touchToPointer_(inEvent, touches[i]);
                pointer.preventDefault = preventDefault;
                inFunction.call(this, inEvent, pointer);
            }
        };
        _ol_pointer_TouchSource_.prototype.findTouch_ = function(touchList, searchId) {
            var l = touchList.length;
            var touch;
            for (var i = 0; i < l; i++) {
                touch = touchList[i];
                if (touch.identifier === searchId) {
                    return true;
                }
            }
            return false;
        };
        _ol_pointer_TouchSource_.prototype.vacuumTouches_ = function(inEvent) {
            var touchList = inEvent.touches;
            var keys = Object.keys(this.pointerMap);
            var count = keys.length;
            if (count >= touchList.length) {
                var d = [];
                var i, key, value;
                for (i = 0; i < count; ++i) {
                    key = keys[i];
                    value = this.pointerMap[key];
                    if (key != _mousesource2.default.POINTER_ID && !this.findTouch_(touchList, key - 2)) {
                        d.push(value.out);
                    }
                }
                for (i = 0; i < d.length; ++i) {
                    this.cancelOut_(inEvent, d[i]);
                }
            }
        };
        _ol_pointer_TouchSource_.prototype.touchstart = function(inEvent) {
            this.vacuumTouches_(inEvent);
            this.setPrimaryTouch_(inEvent.changedTouches[0]);
            this.dedupSynthMouse_(inEvent);
            this.clickCount_++;
            this.processTouches_(inEvent, this.overDown_);
        };
        _ol_pointer_TouchSource_.prototype.overDown_ = function(browserEvent, inPointer) {
            this.pointerMap[inPointer.pointerId] = {
                target: inPointer.target,
                out: inPointer,
                outTarget: inPointer.target
            };
            this.dispatcher.over(inPointer, browserEvent);
            this.dispatcher.enter(inPointer, browserEvent);
            this.dispatcher.down(inPointer, browserEvent);
        };
        _ol_pointer_TouchSource_.prototype.touchmove = function(inEvent) {
            inEvent.preventDefault();
            this.processTouches_(inEvent, this.moveOverOut_);
        };
        _ol_pointer_TouchSource_.prototype.moveOverOut_ = function(browserEvent, inPointer) {
            var event = inPointer;
            var pointer = this.pointerMap[event.pointerId];
            if (!pointer) {
                return;
            }
            var outEvent = pointer.out;
            var outTarget = pointer.outTarget;
            this.dispatcher.move(event, browserEvent);
            if (outEvent && outTarget !== event.target) {
                outEvent.relatedTarget = event.target;
                event.relatedTarget = outTarget;
                outEvent.target = outTarget;
                if (event.target) {
                    this.dispatcher.leaveOut(outEvent, browserEvent);
                    this.dispatcher.enterOver(event, browserEvent);
                } else {
                    event.target = outTarget;
                    event.relatedTarget = null;
                    this.cancelOut_(browserEvent, event);
                }
            }
            pointer.out = event;
            pointer.outTarget = event.target;
        };
        _ol_pointer_TouchSource_.prototype.touchend = function(inEvent) {
            this.dedupSynthMouse_(inEvent);
            this.processTouches_(inEvent, this.upOut_);
        };
        _ol_pointer_TouchSource_.prototype.upOut_ = function(browserEvent, inPointer) {
            this.dispatcher.up(inPointer, browserEvent);
            this.dispatcher.out(inPointer, browserEvent);
            this.dispatcher.leave(inPointer, browserEvent);
            this.cleanUpPointer_(inPointer);
        };
        _ol_pointer_TouchSource_.prototype.touchcancel = function(inEvent) {
            this.processTouches_(inEvent, this.cancelOut_);
        };
        _ol_pointer_TouchSource_.prototype.cancelOut_ = function(browserEvent, inPointer) {
            this.dispatcher.cancel(inPointer, browserEvent);
            this.dispatcher.out(inPointer, browserEvent);
            this.dispatcher.leave(inPointer, browserEvent);
            this.cleanUpPointer_(inPointer);
        };
        _ol_pointer_TouchSource_.prototype.cleanUpPointer_ = function(inPointer) {
            delete this.pointerMap[inPointer.pointerId];
            this.removePrimaryPointer_(inPointer);
        };
        _ol_pointer_TouchSource_.prototype.dedupSynthMouse_ = function(inEvent) {
            var lts = this.mouseSource.lastTouches;
            var t = inEvent.changedTouches[0];
            if (this.isPrimaryTouch_(t)) {
                var lt = [ t.clientX, t.clientY ];
                lts.push(lt);
                setTimeout(function() {
                    _array2.default.remove(lts, lt);
                }, _ol_pointer_TouchSource_.DEDUP_TIMEOUT);
            }
        };
        exports.default = _ol_pointer_TouchSource_;
    }, {
        "../array.js": 29,
        "../index.js": 89,
        "../pointer/eventsource.js": 133,
        "../pointer/mousesource.js": 135
    } ],
    141: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _sphere = require("./sphere.js");
        var _sphere2 = _interopRequireDefault(_sphere);
        var _extent = require("./extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _math = require("./math.js");
        var _math2 = _interopRequireDefault(_math);
        var _epsg = require("./proj/epsg3857.js");
        var _epsg2 = _interopRequireDefault(_epsg);
        var _epsg3 = require("./proj/epsg4326.js");
        var _epsg4 = _interopRequireDefault(_epsg3);
        var _projection = require("./proj/projection.js");
        var _projection2 = _interopRequireDefault(_projection);
        var _units = require("./proj/units.js");
        var _units2 = _interopRequireDefault(_units);
        var _proj = require("./proj/proj4.js");
        var _proj2 = _interopRequireDefault(_proj);
        var _projections = require("./proj/projections.js");
        var _projections2 = _interopRequireDefault(_projections);
        var _transforms = require("./proj/transforms.js");
        var _transforms2 = _interopRequireDefault(_transforms);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_proj_ = {};
        _ol_proj_.METERS_PER_UNIT = _units2.default.METERS_PER_UNIT;
        _ol_proj_.SPHERE_ = new _sphere2.default(_sphere2.default.DEFAULT_RADIUS);
        if (_index2.default.ENABLE_PROJ4JS) {
            _ol_proj_.setProj4 = function(proj4) {
                _proj2.default.set(proj4);
            };
        }
        _ol_proj_.getPointResolution = function(projection, resolution, point, opt_units) {
            projection = _ol_proj_.get(projection);
            var pointResolution;
            var getter = projection.getPointResolutionFunc();
            if (getter) {
                pointResolution = getter(resolution, point);
            } else {
                var units = projection.getUnits();
                if (units == _units2.default.DEGREES && !opt_units || opt_units == _units2.default.DEGREES) {
                    pointResolution = resolution;
                } else {
                    var toEPSG4326 = _ol_proj_.getTransformFromProjections(projection, _ol_proj_.get("EPSG:4326"));
                    var vertices = [ point[0] - resolution / 2, point[1], point[0] + resolution / 2, point[1], point[0], point[1] - resolution / 2, point[0], point[1] + resolution / 2 ];
                    vertices = toEPSG4326(vertices, vertices, 2);
                    var width = _ol_proj_.SPHERE_.haversineDistance(vertices.slice(0, 2), vertices.slice(2, 4));
                    var height = _ol_proj_.SPHERE_.haversineDistance(vertices.slice(4, 6), vertices.slice(6, 8));
                    pointResolution = (width + height) / 2;
                    var metersPerUnit = opt_units ? _units2.default.METERS_PER_UNIT[opt_units] : projection.getMetersPerUnit();
                    if (metersPerUnit !== undefined) {
                        pointResolution /= metersPerUnit;
                    }
                }
            }
            return pointResolution;
        };
        _ol_proj_.addEquivalentProjections = function(projections) {
            _ol_proj_.addProjections(projections);
            projections.forEach(function(source) {
                projections.forEach(function(destination) {
                    if (source !== destination) {
                        _transforms2.default.add(source, destination, _ol_proj_.cloneTransform);
                    }
                });
            });
        };
        _ol_proj_.addEquivalentTransforms = function(projections1, projections2, forwardTransform, inverseTransform) {
            projections1.forEach(function(projection1) {
                projections2.forEach(function(projection2) {
                    _transforms2.default.add(projection1, projection2, forwardTransform);
                    _transforms2.default.add(projection2, projection1, inverseTransform);
                });
            });
        };
        _ol_proj_.addProjection = function(projection) {
            _projections2.default.add(projection.getCode(), projection);
            _transforms2.default.add(projection, projection, _ol_proj_.cloneTransform);
        };
        _ol_proj_.addProjections = function(projections) {
            projections.forEach(_ol_proj_.addProjection);
        };
        _ol_proj_.clearAllProjections = function() {
            _projections2.default.clear();
            _transforms2.default.clear();
        };
        _ol_proj_.createProjection = function(projection, defaultCode) {
            if (!projection) {
                return _ol_proj_.get(defaultCode);
            } else if (typeof projection === "string") {
                return _ol_proj_.get(projection);
            } else {
                return projection;
            }
        };
        _ol_proj_.addCoordinateTransforms = function(source, destination, forward, inverse) {
            var sourceProj = _ol_proj_.get(source);
            var destProj = _ol_proj_.get(destination);
            _transforms2.default.add(sourceProj, destProj, _ol_proj_.createTransformFromCoordinateTransform(forward));
            _transforms2.default.add(destProj, sourceProj, _ol_proj_.createTransformFromCoordinateTransform(inverse));
        };
        _ol_proj_.createTransformFromCoordinateTransform = function(transform) {
            return function(input, opt_output, opt_dimension) {
                var length = input.length;
                var dimension = opt_dimension !== undefined ? opt_dimension : 2;
                var output = opt_output !== undefined ? opt_output : new Array(length);
                var point, i, j;
                for (i = 0; i < length; i += dimension) {
                    point = transform([ input[i], input[i + 1] ]);
                    output[i] = point[0];
                    output[i + 1] = point[1];
                    for (j = dimension - 1; j >= 2; --j) {
                        output[i + j] = input[i + j];
                    }
                }
                return output;
            };
        };
        _ol_proj_.fromLonLat = function(coordinate, opt_projection) {
            return _ol_proj_.transform(coordinate, "EPSG:4326", opt_projection !== undefined ? opt_projection : "EPSG:3857");
        };
        _ol_proj_.toLonLat = function(coordinate, opt_projection) {
            var lonLat = _ol_proj_.transform(coordinate, opt_projection !== undefined ? opt_projection : "EPSG:3857", "EPSG:4326");
            var lon = lonLat[0];
            if (lon < -180 || lon > 180) {
                lonLat[0] = _math2.default.modulo(lon + 180, 360) - 180;
            }
            return lonLat;
        };
        _ol_proj_.get = function(projectionLike) {
            var projection = null;
            if (projectionLike instanceof _projection2.default) {
                projection = projectionLike;
            } else if (typeof projectionLike === "string") {
                var code = projectionLike;
                projection = _projections2.default.get(code);
                if (_index2.default.ENABLE_PROJ4JS && !projection) {
                    var proj4js = _proj2.default.get();
                    if (typeof proj4js == "function" && proj4js.defs(code) !== undefined) {
                        projection = new _projection2.default({
                            code: code
                        });
                        _ol_proj_.addProjection(projection);
                    }
                }
            }
            return projection;
        };
        _ol_proj_.equivalent = function(projection1, projection2) {
            if (projection1 === projection2) {
                return true;
            }
            var equalUnits = projection1.getUnits() === projection2.getUnits();
            if (projection1.getCode() === projection2.getCode()) {
                return equalUnits;
            } else {
                var transformFn = _ol_proj_.getTransformFromProjections(projection1, projection2);
                return transformFn === _ol_proj_.cloneTransform && equalUnits;
            }
        };
        _ol_proj_.getTransform = function(source, destination) {
            var sourceProjection = _ol_proj_.get(source);
            var destinationProjection = _ol_proj_.get(destination);
            return _ol_proj_.getTransformFromProjections(sourceProjection, destinationProjection);
        };
        _ol_proj_.getTransformFromProjections = function(sourceProjection, destinationProjection) {
            var sourceCode = sourceProjection.getCode();
            var destinationCode = destinationProjection.getCode();
            var transform = _transforms2.default.get(sourceCode, destinationCode);
            if (_index2.default.ENABLE_PROJ4JS && !transform) {
                var proj4js = _proj2.default.get();
                if (typeof proj4js == "function") {
                    var sourceDef = proj4js.defs(sourceCode);
                    var destinationDef = proj4js.defs(destinationCode);
                    if (sourceDef !== undefined && destinationDef !== undefined) {
                        if (sourceDef === destinationDef) {
                            _ol_proj_.addEquivalentProjections([ destinationProjection, sourceProjection ]);
                        } else {
                            var proj4Transform = proj4js(destinationCode, sourceCode);
                            _ol_proj_.addCoordinateTransforms(destinationProjection, sourceProjection, proj4Transform.forward, proj4Transform.inverse);
                        }
                        transform = _transforms2.default.get(sourceCode, destinationCode);
                    }
                }
            }
            if (!transform) {
                transform = _ol_proj_.identityTransform;
            }
            return transform;
        };
        _ol_proj_.identityTransform = function(input, opt_output, opt_dimension) {
            if (opt_output !== undefined && input !== opt_output) {
                for (var i = 0, ii = input.length; i < ii; ++i) {
                    opt_output[i] = input[i];
                }
                input = opt_output;
            }
            return input;
        };
        _ol_proj_.cloneTransform = function(input, opt_output, opt_dimension) {
            var output;
            if (opt_output !== undefined) {
                for (var i = 0, ii = input.length; i < ii; ++i) {
                    opt_output[i] = input[i];
                }
                output = opt_output;
            } else {
                output = input.slice();
            }
            return output;
        };
        _ol_proj_.transform = function(coordinate, source, destination) {
            var transformFn = _ol_proj_.getTransform(source, destination);
            return transformFn(coordinate, undefined, coordinate.length);
        };
        _ol_proj_.transformExtent = function(extent, source, destination) {
            var transformFn = _ol_proj_.getTransform(source, destination);
            return _extent2.default.applyTransform(extent, transformFn);
        };
        _ol_proj_.transformWithProjections = function(point, sourceProjection, destinationProjection) {
            var transformFn = _ol_proj_.getTransformFromProjections(sourceProjection, destinationProjection);
            return transformFn(point);
        };
        _ol_proj_.addCommon = function() {
            _ol_proj_.addEquivalentProjections(_epsg2.default.PROJECTIONS);
            _ol_proj_.addEquivalentProjections(_epsg4.default.PROJECTIONS);
            _ol_proj_.addEquivalentTransforms(_epsg4.default.PROJECTIONS, _epsg2.default.PROJECTIONS, _epsg2.default.fromEPSG4326, _epsg2.default.toEPSG4326);
        };
        _ol_proj_.addCommon();
        exports.default = _ol_proj_;
    }, {
        "./extent.js": 54,
        "./index.js": 89,
        "./math.js": 123,
        "./proj/epsg3857.js": 142,
        "./proj/epsg4326.js": 143,
        "./proj/proj4.js": 144,
        "./proj/projection.js": 145,
        "./proj/projections.js": 146,
        "./proj/transforms.js": 147,
        "./proj/units.js": 148,
        "./sphere.js": 215
    } ],
    142: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _math = require("../math.js");
        var _math2 = _interopRequireDefault(_math);
        var _projection = require("../proj/projection.js");
        var _projection2 = _interopRequireDefault(_projection);
        var _units = require("../proj/units.js");
        var _units2 = _interopRequireDefault(_units);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_proj_EPSG3857_ = {};
        _ol_proj_EPSG3857_.Projection_ = function(code) {
            _projection2.default.call(this, {
                code: code,
                units: _units2.default.METERS,
                extent: _ol_proj_EPSG3857_.EXTENT,
                global: true,
                worldExtent: _ol_proj_EPSG3857_.WORLD_EXTENT,
                getPointResolution: function(resolution, point) {
                    return resolution / _math2.default.cosh(point[1] / _ol_proj_EPSG3857_.RADIUS);
                }
            });
        };
        _index2.default.inherits(_ol_proj_EPSG3857_.Projection_, _projection2.default);
        _ol_proj_EPSG3857_.RADIUS = 6378137;
        _ol_proj_EPSG3857_.HALF_SIZE = Math.PI * _ol_proj_EPSG3857_.RADIUS;
        _ol_proj_EPSG3857_.EXTENT = [ -_ol_proj_EPSG3857_.HALF_SIZE, -_ol_proj_EPSG3857_.HALF_SIZE, _ol_proj_EPSG3857_.HALF_SIZE, _ol_proj_EPSG3857_.HALF_SIZE ];
        _ol_proj_EPSG3857_.WORLD_EXTENT = [ -180, -85, 180, 85 ];
        _ol_proj_EPSG3857_.PROJECTIONS = [ new _ol_proj_EPSG3857_.Projection_("EPSG:3857"), new _ol_proj_EPSG3857_.Projection_("EPSG:102100"), new _ol_proj_EPSG3857_.Projection_("EPSG:102113"), new _ol_proj_EPSG3857_.Projection_("EPSG:900913"), new _ol_proj_EPSG3857_.Projection_("urn:ogc:def:crs:EPSG:6.18:3:3857"), new _ol_proj_EPSG3857_.Projection_("urn:ogc:def:crs:EPSG::3857"), new _ol_proj_EPSG3857_.Projection_("http://www.opengis.net/gml/srs/epsg.xml#3857") ];
        _ol_proj_EPSG3857_.fromEPSG4326 = function(input, opt_output, opt_dimension) {
            var length = input.length, dimension = opt_dimension > 1 ? opt_dimension : 2, output = opt_output;
            if (output === undefined) {
                if (dimension > 2) {
                    output = input.slice();
                } else {
                    output = new Array(length);
                }
            }
            var halfSize = _ol_proj_EPSG3857_.HALF_SIZE;
            for (var i = 0; i < length; i += dimension) {
                output[i] = halfSize * input[i] / 180;
                var y = _ol_proj_EPSG3857_.RADIUS * Math.log(Math.tan(Math.PI * (input[i + 1] + 90) / 360));
                if (y > halfSize) {
                    y = halfSize;
                } else if (y < -halfSize) {
                    y = -halfSize;
                }
                output[i + 1] = y;
            }
            return output;
        };
        _ol_proj_EPSG3857_.toEPSG4326 = function(input, opt_output, opt_dimension) {
            var length = input.length, dimension = opt_dimension > 1 ? opt_dimension : 2, output = opt_output;
            if (output === undefined) {
                if (dimension > 2) {
                    output = input.slice();
                } else {
                    output = new Array(length);
                }
            }
            for (var i = 0; i < length; i += dimension) {
                output[i] = 180 * input[i] / _ol_proj_EPSG3857_.HALF_SIZE;
                output[i + 1] = 360 * Math.atan(Math.exp(input[i + 1] / _ol_proj_EPSG3857_.RADIUS)) / Math.PI - 90;
            }
            return output;
        };
        exports.default = _ol_proj_EPSG3857_;
    }, {
        "../index.js": 89,
        "../math.js": 123,
        "../proj/projection.js": 145,
        "../proj/units.js": 148
    } ],
    143: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _projection = require("../proj/projection.js");
        var _projection2 = _interopRequireDefault(_projection);
        var _units = require("../proj/units.js");
        var _units2 = _interopRequireDefault(_units);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_proj_EPSG4326_ = {};
        _ol_proj_EPSG4326_.Projection_ = function(code, opt_axisOrientation) {
            _projection2.default.call(this, {
                code: code,
                units: _units2.default.DEGREES,
                extent: _ol_proj_EPSG4326_.EXTENT,
                axisOrientation: opt_axisOrientation,
                global: true,
                metersPerUnit: _ol_proj_EPSG4326_.METERS_PER_UNIT,
                worldExtent: _ol_proj_EPSG4326_.EXTENT
            });
        };
        _index2.default.inherits(_ol_proj_EPSG4326_.Projection_, _projection2.default);
        _ol_proj_EPSG4326_.RADIUS = 6378137;
        _ol_proj_EPSG4326_.EXTENT = [ -180, -90, 180, 90 ];
        _ol_proj_EPSG4326_.METERS_PER_UNIT = Math.PI * _ol_proj_EPSG4326_.RADIUS / 180;
        _ol_proj_EPSG4326_.PROJECTIONS = [ new _ol_proj_EPSG4326_.Projection_("CRS:84"), new _ol_proj_EPSG4326_.Projection_("EPSG:4326", "neu"), new _ol_proj_EPSG4326_.Projection_("urn:ogc:def:crs:EPSG::4326", "neu"), new _ol_proj_EPSG4326_.Projection_("urn:ogc:def:crs:EPSG:6.6:4326", "neu"), new _ol_proj_EPSG4326_.Projection_("urn:ogc:def:crs:OGC:1.3:CRS84"), new _ol_proj_EPSG4326_.Projection_("urn:ogc:def:crs:OGC:2:84"), new _ol_proj_EPSG4326_.Projection_("http://www.opengis.net/gml/srs/epsg.xml#4326", "neu"), new _ol_proj_EPSG4326_.Projection_("urn:x-ogc:def:crs:EPSG:4326", "neu") ];
        exports.default = _ol_proj_EPSG4326_;
    }, {
        "../index.js": 89,
        "../proj/projection.js": 145,
        "../proj/units.js": 148
    } ],
    144: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_proj_proj4_ = {};
        _ol_proj_proj4_.cache_ = null;
        _ol_proj_proj4_.set = function(proj4) {
            _ol_proj_proj4_.cache_ = proj4;
        };
        _ol_proj_proj4_.get = function() {
            return _ol_proj_proj4_.cache_ || window["proj4"];
        };
        exports.default = _ol_proj_proj4_;
    }, {} ],
    145: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _units = require("../proj/units.js");
        var _units2 = _interopRequireDefault(_units);
        var _proj = require("../proj/proj4.js");
        var _proj2 = _interopRequireDefault(_proj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_proj_Projection_ = function(options) {
            this.code_ = options.code;
            this.units_ = options.units;
            this.extent_ = options.extent !== undefined ? options.extent : null;
            this.worldExtent_ = options.worldExtent !== undefined ? options.worldExtent : null;
            this.axisOrientation_ = options.axisOrientation !== undefined ? options.axisOrientation : "enu";
            this.global_ = options.global !== undefined ? options.global : false;
            this.canWrapX_ = !!(this.global_ && this.extent_);
            this.getPointResolutionFunc_ = options.getPointResolution;
            this.defaultTileGrid_ = null;
            this.metersPerUnit_ = options.metersPerUnit;
            var code = options.code;
            if (_index2.default.ENABLE_PROJ4JS) {
                var proj4js = _proj2.default.get();
                if (typeof proj4js == "function") {
                    var def = proj4js.defs(code);
                    if (def !== undefined) {
                        if (def.axis !== undefined && options.axisOrientation === undefined) {
                            this.axisOrientation_ = def.axis;
                        }
                        if (options.metersPerUnit === undefined) {
                            this.metersPerUnit_ = def.to_meter;
                        }
                        if (options.units === undefined) {
                            this.units_ = def.units;
                        }
                    }
                }
            }
        };
        _ol_proj_Projection_.prototype.canWrapX = function() {
            return this.canWrapX_;
        };
        _ol_proj_Projection_.prototype.getCode = function() {
            return this.code_;
        };
        _ol_proj_Projection_.prototype.getExtent = function() {
            return this.extent_;
        };
        _ol_proj_Projection_.prototype.getUnits = function() {
            return this.units_;
        };
        _ol_proj_Projection_.prototype.getMetersPerUnit = function() {
            return this.metersPerUnit_ || _units2.default.METERS_PER_UNIT[this.units_];
        };
        _ol_proj_Projection_.prototype.getWorldExtent = function() {
            return this.worldExtent_;
        };
        _ol_proj_Projection_.prototype.getAxisOrientation = function() {
            return this.axisOrientation_;
        };
        _ol_proj_Projection_.prototype.isGlobal = function() {
            return this.global_;
        };
        _ol_proj_Projection_.prototype.setGlobal = function(global) {
            this.global_ = global;
            this.canWrapX_ = !!(global && this.extent_);
        };
        _ol_proj_Projection_.prototype.getDefaultTileGrid = function() {
            return this.defaultTileGrid_;
        };
        _ol_proj_Projection_.prototype.setDefaultTileGrid = function(tileGrid) {
            this.defaultTileGrid_ = tileGrid;
        };
        _ol_proj_Projection_.prototype.setExtent = function(extent) {
            this.extent_ = extent;
            this.canWrapX_ = !!(this.global_ && extent);
        };
        _ol_proj_Projection_.prototype.setWorldExtent = function(worldExtent) {
            this.worldExtent_ = worldExtent;
        };
        _ol_proj_Projection_.prototype.setGetPointResolution = function(func) {
            this.getPointResolutionFunc_ = func;
        };
        _ol_proj_Projection_.prototype.getPointResolutionFunc = function() {
            return this.getPointResolutionFunc_;
        };
        exports.default = _ol_proj_Projection_;
    }, {
        "../index.js": 89,
        "../proj/proj4.js": 144,
        "../proj/units.js": 148
    } ],
    146: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_proj_projections_ = {};
        _ol_proj_projections_.cache_ = {};
        _ol_proj_projections_.clear = function() {
            _ol_proj_projections_.cache_ = {};
        };
        _ol_proj_projections_.get = function(code) {
            var projections = _ol_proj_projections_.cache_;
            return projections[code] || null;
        };
        _ol_proj_projections_.add = function(code, projection) {
            var projections = _ol_proj_projections_.cache_;
            projections[code] = projection;
        };
        exports.default = _ol_proj_projections_;
    }, {} ],
    147: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_proj_transforms_ = {};
        _ol_proj_transforms_.cache_ = {};
        _ol_proj_transforms_.clear = function() {
            _ol_proj_transforms_.cache_ = {};
        };
        _ol_proj_transforms_.add = function(source, destination, transformFn) {
            var sourceCode = source.getCode();
            var destinationCode = destination.getCode();
            var transforms = _ol_proj_transforms_.cache_;
            if (!(sourceCode in transforms)) {
                transforms[sourceCode] = {};
            }
            transforms[sourceCode][destinationCode] = transformFn;
        };
        _ol_proj_transforms_.remove = function(source, destination) {
            var sourceCode = source.getCode();
            var destinationCode = destination.getCode();
            var transforms = _ol_proj_transforms_.cache_;
            var transform = transforms[sourceCode][destinationCode];
            delete transforms[sourceCode][destinationCode];
            if (_obj2.default.isEmpty(transforms[sourceCode])) {
                delete transforms[sourceCode];
            }
            return transform;
        };
        _ol_proj_transforms_.get = function(sourceCode, destinationCode) {
            var transform;
            var transforms = _ol_proj_transforms_.cache_;
            if (sourceCode in transforms && destinationCode in transforms[sourceCode]) {
                transform = transforms[sourceCode][destinationCode];
            }
            return transform;
        };
        exports.default = _ol_proj_transforms_;
    }, {
        "../obj.js": 124
    } ],
    148: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_proj_Units_ = {
            DEGREES: "degrees",
            FEET: "ft",
            METERS: "m",
            PIXELS: "pixels",
            TILE_PIXELS: "tile-pixels",
            USFEET: "us-ft"
        };
        _ol_proj_Units_.METERS_PER_UNIT = {};
        _ol_proj_Units_.METERS_PER_UNIT[_ol_proj_Units_.DEGREES] = 2 * Math.PI * 6370997 / 360;
        _ol_proj_Units_.METERS_PER_UNIT[_ol_proj_Units_.FEET] = .3048;
        _ol_proj_Units_.METERS_PER_UNIT[_ol_proj_Units_.METERS] = 1;
        _ol_proj_Units_.METERS_PER_UNIT[_ol_proj_Units_.USFEET] = 1200 / 3937;
        exports.default = _ol_proj_Units_;
    }, {} ],
    149: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _disposable = require("../disposable.js");
        var _disposable2 = _interopRequireDefault(_disposable);
        var _polygon = require("../geom/polygon.js");
        var _polygon2 = _interopRequireDefault(_polygon);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_Box_ = function(className) {
            this.geometry_ = null;
            this.element_ = document.createElement("div");
            this.element_.style.position = "absolute";
            this.element_.className = "ol-box " + className;
            this.map_ = null;
            this.startPixel_ = null;
            this.endPixel_ = null;
        };
        _index2.default.inherits(_ol_render_Box_, _disposable2.default);
        _ol_render_Box_.prototype.disposeInternal = function() {
            this.setMap(null);
        };
        _ol_render_Box_.prototype.render_ = function() {
            var startPixel = this.startPixel_;
            var endPixel = this.endPixel_;
            var px = "px";
            var style = this.element_.style;
            style.left = Math.min(startPixel[0], endPixel[0]) + px;
            style.top = Math.min(startPixel[1], endPixel[1]) + px;
            style.width = Math.abs(endPixel[0] - startPixel[0]) + px;
            style.height = Math.abs(endPixel[1] - startPixel[1]) + px;
        };
        _ol_render_Box_.prototype.setMap = function(map) {
            if (this.map_) {
                this.map_.getOverlayContainer().removeChild(this.element_);
                var style = this.element_.style;
                style.left = style.top = style.width = style.height = "inherit";
            }
            this.map_ = map;
            if (this.map_) {
                this.map_.getOverlayContainer().appendChild(this.element_);
            }
        };
        _ol_render_Box_.prototype.setPixels = function(startPixel, endPixel) {
            this.startPixel_ = startPixel;
            this.endPixel_ = endPixel;
            this.createOrUpdateGeometry();
            this.render_();
        };
        _ol_render_Box_.prototype.createOrUpdateGeometry = function() {
            var startPixel = this.startPixel_;
            var endPixel = this.endPixel_;
            var pixels = [ startPixel, [ startPixel[0], endPixel[1] ], endPixel, [ endPixel[0], startPixel[1] ] ];
            var coordinates = pixels.map(this.map_.getCoordinateFromPixel, this.map_);
            coordinates[4] = coordinates[0].slice();
            if (!this.geometry_) {
                this.geometry_ = new _polygon2.default([ coordinates ]);
            } else {
                this.geometry_.setCoordinates([ coordinates ]);
            }
        };
        _ol_render_Box_.prototype.getGeometry = function() {
            return this.geometry_;
        };
        exports.default = _ol_render_Box_;
    }, {
        "../disposable.js": 45,
        "../geom/polygon.js": 82,
        "../index.js": 89
    } ],
    150: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _css = require("../css.js");
        var _css2 = _interopRequireDefault(_css);
        var _dom = require("../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _lrucache = require("../structs/lrucache.js");
        var _lrucache2 = _interopRequireDefault(_lrucache);
        var _transform = require("../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_canvas_ = {};
        _ol_render_canvas_.defaultFont = "10px sans-serif";
        _ol_render_canvas_.defaultFillStyle = [ 0, 0, 0, 1 ];
        _ol_render_canvas_.defaultLineCap = "round";
        _ol_render_canvas_.defaultLineDash = [];
        _ol_render_canvas_.defaultLineDashOffset = 0;
        _ol_render_canvas_.defaultLineJoin = "round";
        _ol_render_canvas_.defaultMiterLimit = 10;
        _ol_render_canvas_.defaultStrokeStyle = [ 0, 0, 0, 1 ];
        _ol_render_canvas_.defaultTextAlign = "center";
        _ol_render_canvas_.defaultTextBaseline = "middle";
        _ol_render_canvas_.defaultPadding = [ 0, 0, 0, 0 ];
        _ol_render_canvas_.defaultLineWidth = 1;
        _ol_render_canvas_.labelCache = new _lrucache2.default();
        _ol_render_canvas_.checkedFonts_ = {};
        _ol_render_canvas_.measureContext_ = null;
        _ol_render_canvas_.textHeights_ = {};
        _ol_render_canvas_.checkFont = function() {
            var retries = 60;
            var checked = _ol_render_canvas_.checkedFonts_;
            var labelCache = _ol_render_canvas_.labelCache;
            var font = "32px monospace";
            var text = "wmytzilWMYTZIL@#/&?$%10";
            var interval, referenceWidth;
            function isAvailable(fontFamily) {
                var context = _ol_render_canvas_.getMeasureContext();
                context.font = font;
                referenceWidth = context.measureText(text).width;
                var available = true;
                if (fontFamily != "monospace") {
                    context.font = "32px " + fontFamily + ",monospace";
                    var width = context.measureText(text).width;
                    available = width != referenceWidth;
                }
                return available;
            }
            function check() {
                var done = true;
                for (var font in checked) {
                    if (checked[font] < retries) {
                        if (isAvailable(font)) {
                            checked[font] = retries;
                            _obj2.default.clear(_ol_render_canvas_.textHeights_);
                            _ol_render_canvas_.measureContext_ = null;
                            labelCache.clear();
                        } else {
                            ++checked[font];
                            done = false;
                        }
                    }
                }
                if (done) {
                    window.clearInterval(interval);
                    interval = undefined;
                }
            }
            return function(fontSpec) {
                var fontFamilies = _css2.default.getFontFamilies(fontSpec);
                if (!fontFamilies) {
                    return;
                }
                for (var i = 0, ii = fontFamilies.length; i < ii; ++i) {
                    var fontFamily = fontFamilies[i];
                    if (!(fontFamily in checked)) {
                        checked[fontFamily] = retries;
                        if (!isAvailable(fontFamily)) {
                            checked[fontFamily] = 0;
                            if (interval === undefined) {
                                interval = window.setInterval(check, 32);
                            }
                        }
                    }
                }
            };
        }();
        _ol_render_canvas_.getMeasureContext = function() {
            var context = _ol_render_canvas_.measureContext_;
            if (!context) {
                context = _ol_render_canvas_.measureContext_ = _dom2.default.createCanvasContext2D(1, 1);
            }
            return context;
        };
        _ol_render_canvas_.measureTextHeight = function() {
            var span;
            var heights = _ol_render_canvas_.textHeights_;
            return function(font) {
                var height = heights[font];
                if (height == undefined) {
                    if (!span) {
                        span = document.createElement("span");
                        span.textContent = "M";
                        span.style.margin = span.style.padding = "0 !important";
                        span.style.position = "absolute !important";
                        span.style.left = "-99999px !important";
                    }
                    span.style.font = font;
                    document.body.appendChild(span);
                    height = heights[font] = span.offsetHeight;
                    document.body.removeChild(span);
                }
                return height;
            };
        }();
        _ol_render_canvas_.measureTextWidth = function(font, text) {
            var measureContext = _ol_render_canvas_.getMeasureContext();
            if (font != measureContext.font) {
                measureContext.font = font;
            }
            return measureContext.measureText(text).width;
        };
        _ol_render_canvas_.rotateAtOffset = function(context, rotation, offsetX, offsetY) {
            if (rotation !== 0) {
                context.translate(offsetX, offsetY);
                context.rotate(rotation);
                context.translate(-offsetX, -offsetY);
            }
        };
        _ol_render_canvas_.resetTransform_ = _transform2.default.create();
        _ol_render_canvas_.drawImage = function(context, transform, opacity, image, originX, originY, w, h, x, y, scale) {
            var alpha;
            if (opacity != 1) {
                alpha = context.globalAlpha;
                context.globalAlpha = alpha * opacity;
            }
            if (transform) {
                context.setTransform.apply(context, transform);
            }
            context.drawImage(image, originX, originY, w, h, x, y, w * scale, h * scale);
            if (alpha) {
                context.globalAlpha = alpha;
            }
            if (transform) {
                context.setTransform.apply(context, _ol_render_canvas_.resetTransform_);
            }
        };
        exports.default = _ol_render_canvas_;
    }, {
        "../css.js": 44,
        "../dom.js": 46,
        "../obj.js": 124,
        "../structs/lrucache.js": 218,
        "../transform.js": 243
    } ],
    151: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _instruction = require("../canvas/instruction.js");
        var _instruction2 = _interopRequireDefault(_instruction);
        var _replay = require("../canvas/replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_canvas_ImageReplay_ = function(tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {
            _replay2.default.call(this, tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree);
            this.declutterGroup_ = null;
            this.hitDetectionImage_ = null;
            this.image_ = null;
            this.anchorX_ = undefined;
            this.anchorY_ = undefined;
            this.height_ = undefined;
            this.opacity_ = undefined;
            this.originX_ = undefined;
            this.originY_ = undefined;
            this.rotateWithView_ = undefined;
            this.rotation_ = undefined;
            this.scale_ = undefined;
            this.snapToPixel_ = undefined;
            this.width_ = undefined;
        };
        _index2.default.inherits(_ol_render_canvas_ImageReplay_, _replay2.default);
        _ol_render_canvas_ImageReplay_.prototype.drawCoordinates_ = function(flatCoordinates, offset, end, stride) {
            return this.appendFlatCoordinates(flatCoordinates, offset, end, stride, false, false);
        };
        _ol_render_canvas_ImageReplay_.prototype.drawPoint = function(pointGeometry, feature) {
            if (!this.image_) {
                return;
            }
            this.beginGeometry(pointGeometry, feature);
            var flatCoordinates = pointGeometry.getFlatCoordinates();
            var stride = pointGeometry.getStride();
            var myBegin = this.coordinates.length;
            var myEnd = this.drawCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);
            this.instructions.push([ _instruction2.default.DRAW_IMAGE, myBegin, myEnd, this.image_, this.anchorX_, this.anchorY_, this.declutterGroup_, this.height_, this.opacity_, this.originX_, this.originY_, this.rotateWithView_, this.rotation_, this.scale_ * this.pixelRatio, this.snapToPixel_, this.width_ ]);
            this.hitDetectionInstructions.push([ _instruction2.default.DRAW_IMAGE, myBegin, myEnd, this.hitDetectionImage_, this.anchorX_, this.anchorY_, this.declutterGroup_, this.height_, this.opacity_, this.originX_, this.originY_, this.rotateWithView_, this.rotation_, this.scale_, this.snapToPixel_, this.width_ ]);
            this.endGeometry(pointGeometry, feature);
        };
        _ol_render_canvas_ImageReplay_.prototype.drawMultiPoint = function(multiPointGeometry, feature) {
            if (!this.image_) {
                return;
            }
            this.beginGeometry(multiPointGeometry, feature);
            var flatCoordinates = multiPointGeometry.getFlatCoordinates();
            var stride = multiPointGeometry.getStride();
            var myBegin = this.coordinates.length;
            var myEnd = this.drawCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);
            this.instructions.push([ _instruction2.default.DRAW_IMAGE, myBegin, myEnd, this.image_, this.anchorX_, this.anchorY_, this.declutterGroup_, this.height_, this.opacity_, this.originX_, this.originY_, this.rotateWithView_, this.rotation_, this.scale_ * this.pixelRatio, this.snapToPixel_, this.width_ ]);
            this.hitDetectionInstructions.push([ _instruction2.default.DRAW_IMAGE, myBegin, myEnd, this.hitDetectionImage_, this.anchorX_, this.anchorY_, this.declutterGroup_, this.height_, this.opacity_, this.originX_, this.originY_, this.rotateWithView_, this.rotation_, this.scale_, this.snapToPixel_, this.width_ ]);
            this.endGeometry(multiPointGeometry, feature);
        };
        _ol_render_canvas_ImageReplay_.prototype.finish = function() {
            this.reverseHitDetectionInstructions();
            this.anchorX_ = undefined;
            this.anchorY_ = undefined;
            this.hitDetectionImage_ = null;
            this.image_ = null;
            this.height_ = undefined;
            this.scale_ = undefined;
            this.opacity_ = undefined;
            this.originX_ = undefined;
            this.originY_ = undefined;
            this.rotateWithView_ = undefined;
            this.rotation_ = undefined;
            this.snapToPixel_ = undefined;
            this.width_ = undefined;
        };
        _ol_render_canvas_ImageReplay_.prototype.setImageStyle = function(imageStyle, declutterGroup) {
            var anchor = imageStyle.getAnchor();
            var size = imageStyle.getSize();
            var hitDetectionImage = imageStyle.getHitDetectionImage(1);
            var image = imageStyle.getImage(1);
            var origin = imageStyle.getOrigin();
            this.anchorX_ = anchor[0];
            this.anchorY_ = anchor[1];
            this.declutterGroup_ = declutterGroup;
            this.hitDetectionImage_ = hitDetectionImage;
            this.image_ = image;
            this.height_ = size[1];
            this.opacity_ = imageStyle.getOpacity();
            this.originX_ = origin[0];
            this.originY_ = origin[1];
            this.rotateWithView_ = imageStyle.getRotateWithView();
            this.rotation_ = imageStyle.getRotation();
            this.scale_ = imageStyle.getScale();
            this.snapToPixel_ = imageStyle.getSnapToPixel();
            this.width_ = size[0];
        };
        exports.default = _ol_render_canvas_ImageReplay_;
    }, {
        "../../index.js": 89,
        "../canvas/instruction.js": 153,
        "../canvas/replay.js": 156
    } ],
    152: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _colorlike = require("../../colorlike.js");
        var _colorlike2 = _interopRequireDefault(_colorlike);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _geometrytype = require("../../geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _simplegeometry = require("../../geom/simplegeometry.js");
        var _simplegeometry2 = _interopRequireDefault(_simplegeometry);
        var _transform = require("../../geom/flat/transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _has = require("../../has.js");
        var _has2 = _interopRequireDefault(_has);
        var _vectorcontext = require("../vectorcontext.js");
        var _vectorcontext2 = _interopRequireDefault(_vectorcontext);
        var _canvas = require("../canvas.js");
        var _canvas2 = _interopRequireDefault(_canvas);
        var _transform3 = require("../../transform.js");
        var _transform4 = _interopRequireDefault(_transform3);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_canvas_Immediate_ = function(context, pixelRatio, extent, transform, viewRotation) {
            _vectorcontext2.default.call(this);
            this.context_ = context;
            this.pixelRatio_ = pixelRatio;
            this.extent_ = extent;
            this.transform_ = transform;
            this.viewRotation_ = viewRotation;
            this.contextFillState_ = null;
            this.contextStrokeState_ = null;
            this.contextTextState_ = null;
            this.fillState_ = null;
            this.strokeState_ = null;
            this.image_ = null;
            this.imageAnchorX_ = 0;
            this.imageAnchorY_ = 0;
            this.imageHeight_ = 0;
            this.imageOpacity_ = 0;
            this.imageOriginX_ = 0;
            this.imageOriginY_ = 0;
            this.imageRotateWithView_ = false;
            this.imageRotation_ = 0;
            this.imageScale_ = 0;
            this.imageSnapToPixel_ = false;
            this.imageWidth_ = 0;
            this.text_ = "";
            this.textOffsetX_ = 0;
            this.textOffsetY_ = 0;
            this.textRotateWithView_ = false;
            this.textRotation_ = 0;
            this.textScale_ = 0;
            this.textFillState_ = null;
            this.textStrokeState_ = null;
            this.textState_ = null;
            this.pixelCoordinates_ = [];
            this.tmpLocalTransform_ = _transform4.default.create();
        };
        _index2.default.inherits(_ol_render_canvas_Immediate_, _vectorcontext2.default);
        _ol_render_canvas_Immediate_.prototype.drawImages_ = function(flatCoordinates, offset, end, stride) {
            if (!this.image_) {
                return;
            }
            var pixelCoordinates = _transform2.default.transform2D(flatCoordinates, offset, end, 2, this.transform_, this.pixelCoordinates_);
            var context = this.context_;
            var localTransform = this.tmpLocalTransform_;
            var alpha = context.globalAlpha;
            if (this.imageOpacity_ != 1) {
                context.globalAlpha = alpha * this.imageOpacity_;
            }
            var rotation = this.imageRotation_;
            if (this.imageRotateWithView_) {
                rotation += this.viewRotation_;
            }
            var i, ii;
            for (i = 0, ii = pixelCoordinates.length; i < ii; i += 2) {
                var x = pixelCoordinates[i] - this.imageAnchorX_;
                var y = pixelCoordinates[i + 1] - this.imageAnchorY_;
                if (this.imageSnapToPixel_) {
                    x = Math.round(x);
                    y = Math.round(y);
                }
                if (rotation !== 0 || this.imageScale_ != 1) {
                    var centerX = x + this.imageAnchorX_;
                    var centerY = y + this.imageAnchorY_;
                    _transform4.default.compose(localTransform, centerX, centerY, this.imageScale_, this.imageScale_, rotation, -centerX, -centerY);
                    context.setTransform.apply(context, localTransform);
                }
                context.drawImage(this.image_, this.imageOriginX_, this.imageOriginY_, this.imageWidth_, this.imageHeight_, x, y, this.imageWidth_, this.imageHeight_);
            }
            if (rotation !== 0 || this.imageScale_ != 1) {
                context.setTransform(1, 0, 0, 1, 0, 0);
            }
            if (this.imageOpacity_ != 1) {
                context.globalAlpha = alpha;
            }
        };
        _ol_render_canvas_Immediate_.prototype.drawText_ = function(flatCoordinates, offset, end, stride) {
            if (!this.textState_ || this.text_ === "") {
                return;
            }
            if (this.textFillState_) {
                this.setContextFillState_(this.textFillState_);
            }
            if (this.textStrokeState_) {
                this.setContextStrokeState_(this.textStrokeState_);
            }
            this.setContextTextState_(this.textState_);
            var pixelCoordinates = _transform2.default.transform2D(flatCoordinates, offset, end, stride, this.transform_, this.pixelCoordinates_);
            var context = this.context_;
            var rotation = this.textRotation_;
            if (this.textRotateWithView_) {
                rotation += this.viewRotation_;
            }
            for (;offset < end; offset += stride) {
                var x = pixelCoordinates[offset] + this.textOffsetX_;
                var y = pixelCoordinates[offset + 1] + this.textOffsetY_;
                if (rotation !== 0 || this.textScale_ != 1) {
                    var localTransform = _transform4.default.compose(this.tmpLocalTransform_, x, y, this.textScale_, this.textScale_, rotation, -x, -y);
                    context.setTransform.apply(context, localTransform);
                }
                if (this.textStrokeState_) {
                    context.strokeText(this.text_, x, y);
                }
                if (this.textFillState_) {
                    context.fillText(this.text_, x, y);
                }
            }
            if (rotation !== 0 || this.textScale_ != 1) {
                context.setTransform(1, 0, 0, 1, 0, 0);
            }
        };
        _ol_render_canvas_Immediate_.prototype.moveToLineTo_ = function(flatCoordinates, offset, end, stride, close) {
            var context = this.context_;
            var pixelCoordinates = _transform2.default.transform2D(flatCoordinates, offset, end, stride, this.transform_, this.pixelCoordinates_);
            context.moveTo(pixelCoordinates[0], pixelCoordinates[1]);
            var length = pixelCoordinates.length;
            if (close) {
                length -= 2;
            }
            for (var i = 2; i < length; i += 2) {
                context.lineTo(pixelCoordinates[i], pixelCoordinates[i + 1]);
            }
            if (close) {
                context.closePath();
            }
            return end;
        };
        _ol_render_canvas_Immediate_.prototype.drawRings_ = function(flatCoordinates, offset, ends, stride) {
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                offset = this.moveToLineTo_(flatCoordinates, offset, ends[i], stride, true);
            }
            return offset;
        };
        _ol_render_canvas_Immediate_.prototype.drawCircle = function(geometry) {
            if (!_extent2.default.intersects(this.extent_, geometry.getExtent())) {
                return;
            }
            if (this.fillState_ || this.strokeState_) {
                if (this.fillState_) {
                    this.setContextFillState_(this.fillState_);
                }
                if (this.strokeState_) {
                    this.setContextStrokeState_(this.strokeState_);
                }
                var pixelCoordinates = _simplegeometry2.default.transform2D(geometry, this.transform_, this.pixelCoordinates_);
                var dx = pixelCoordinates[2] - pixelCoordinates[0];
                var dy = pixelCoordinates[3] - pixelCoordinates[1];
                var radius = Math.sqrt(dx * dx + dy * dy);
                var context = this.context_;
                context.beginPath();
                context.arc(pixelCoordinates[0], pixelCoordinates[1], radius, 0, 2 * Math.PI);
                if (this.fillState_) {
                    context.fill();
                }
                if (this.strokeState_) {
                    context.stroke();
                }
            }
            if (this.text_ !== "") {
                this.drawText_(geometry.getCenter(), 0, 2, 2);
            }
        };
        _ol_render_canvas_Immediate_.prototype.setStyle = function(style) {
            this.setFillStrokeStyle(style.getFill(), style.getStroke());
            this.setImageStyle(style.getImage());
            this.setTextStyle(style.getText());
        };
        _ol_render_canvas_Immediate_.prototype.drawGeometry = function(geometry) {
            var type = geometry.getType();
            switch (type) {
              case _geometrytype2.default.POINT:
                this.drawPoint(geometry);
                break;

              case _geometrytype2.default.LINE_STRING:
                this.drawLineString(geometry);
                break;

              case _geometrytype2.default.POLYGON:
                this.drawPolygon(geometry);
                break;

              case _geometrytype2.default.MULTI_POINT:
                this.drawMultiPoint(geometry);
                break;

              case _geometrytype2.default.MULTI_LINE_STRING:
                this.drawMultiLineString(geometry);
                break;

              case _geometrytype2.default.MULTI_POLYGON:
                this.drawMultiPolygon(geometry);
                break;

              case _geometrytype2.default.GEOMETRY_COLLECTION:
                this.drawGeometryCollection(geometry);
                break;

              case _geometrytype2.default.CIRCLE:
                this.drawCircle(geometry);
                break;

              default:
            }
        };
        _ol_render_canvas_Immediate_.prototype.drawFeature = function(feature, style) {
            var geometry = style.getGeometryFunction()(feature);
            if (!geometry || !_extent2.default.intersects(this.extent_, geometry.getExtent())) {
                return;
            }
            this.setStyle(style);
            this.drawGeometry(geometry);
        };
        _ol_render_canvas_Immediate_.prototype.drawGeometryCollection = function(geometry) {
            var geometries = geometry.getGeometriesArray();
            var i, ii;
            for (i = 0, ii = geometries.length; i < ii; ++i) {
                this.drawGeometry(geometries[i]);
            }
        };
        _ol_render_canvas_Immediate_.prototype.drawPoint = function(geometry) {
            var flatCoordinates = geometry.getFlatCoordinates();
            var stride = geometry.getStride();
            if (this.image_) {
                this.drawImages_(flatCoordinates, 0, flatCoordinates.length, stride);
            }
            if (this.text_ !== "") {
                this.drawText_(flatCoordinates, 0, flatCoordinates.length, stride);
            }
        };
        _ol_render_canvas_Immediate_.prototype.drawMultiPoint = function(geometry) {
            var flatCoordinates = geometry.getFlatCoordinates();
            var stride = geometry.getStride();
            if (this.image_) {
                this.drawImages_(flatCoordinates, 0, flatCoordinates.length, stride);
            }
            if (this.text_ !== "") {
                this.drawText_(flatCoordinates, 0, flatCoordinates.length, stride);
            }
        };
        _ol_render_canvas_Immediate_.prototype.drawLineString = function(geometry) {
            if (!_extent2.default.intersects(this.extent_, geometry.getExtent())) {
                return;
            }
            if (this.strokeState_) {
                this.setContextStrokeState_(this.strokeState_);
                var context = this.context_;
                var flatCoordinates = geometry.getFlatCoordinates();
                context.beginPath();
                this.moveToLineTo_(flatCoordinates, 0, flatCoordinates.length, geometry.getStride(), false);
                context.stroke();
            }
            if (this.text_ !== "") {
                var flatMidpoint = geometry.getFlatMidpoint();
                this.drawText_(flatMidpoint, 0, 2, 2);
            }
        };
        _ol_render_canvas_Immediate_.prototype.drawMultiLineString = function(geometry) {
            var geometryExtent = geometry.getExtent();
            if (!_extent2.default.intersects(this.extent_, geometryExtent)) {
                return;
            }
            if (this.strokeState_) {
                this.setContextStrokeState_(this.strokeState_);
                var context = this.context_;
                var flatCoordinates = geometry.getFlatCoordinates();
                var offset = 0;
                var ends = geometry.getEnds();
                var stride = geometry.getStride();
                context.beginPath();
                var i, ii;
                for (i = 0, ii = ends.length; i < ii; ++i) {
                    offset = this.moveToLineTo_(flatCoordinates, offset, ends[i], stride, false);
                }
                context.stroke();
            }
            if (this.text_ !== "") {
                var flatMidpoints = geometry.getFlatMidpoints();
                this.drawText_(flatMidpoints, 0, flatMidpoints.length, 2);
            }
        };
        _ol_render_canvas_Immediate_.prototype.drawPolygon = function(geometry) {
            if (!_extent2.default.intersects(this.extent_, geometry.getExtent())) {
                return;
            }
            if (this.strokeState_ || this.fillState_) {
                if (this.fillState_) {
                    this.setContextFillState_(this.fillState_);
                }
                if (this.strokeState_) {
                    this.setContextStrokeState_(this.strokeState_);
                }
                var context = this.context_;
                context.beginPath();
                this.drawRings_(geometry.getOrientedFlatCoordinates(), 0, geometry.getEnds(), geometry.getStride());
                if (this.fillState_) {
                    context.fill();
                }
                if (this.strokeState_) {
                    context.stroke();
                }
            }
            if (this.text_ !== "") {
                var flatInteriorPoint = geometry.getFlatInteriorPoint();
                this.drawText_(flatInteriorPoint, 0, 2, 2);
            }
        };
        _ol_render_canvas_Immediate_.prototype.drawMultiPolygon = function(geometry) {
            if (!_extent2.default.intersects(this.extent_, geometry.getExtent())) {
                return;
            }
            if (this.strokeState_ || this.fillState_) {
                if (this.fillState_) {
                    this.setContextFillState_(this.fillState_);
                }
                if (this.strokeState_) {
                    this.setContextStrokeState_(this.strokeState_);
                }
                var context = this.context_;
                var flatCoordinates = geometry.getOrientedFlatCoordinates();
                var offset = 0;
                var endss = geometry.getEndss();
                var stride = geometry.getStride();
                var i, ii;
                context.beginPath();
                for (i = 0, ii = endss.length; i < ii; ++i) {
                    var ends = endss[i];
                    offset = this.drawRings_(flatCoordinates, offset, ends, stride);
                }
                if (this.fillState_) {
                    context.fill();
                }
                if (this.strokeState_) {
                    context.stroke();
                }
            }
            if (this.text_ !== "") {
                var flatInteriorPoints = geometry.getFlatInteriorPoints();
                this.drawText_(flatInteriorPoints, 0, flatInteriorPoints.length, 2);
            }
        };
        _ol_render_canvas_Immediate_.prototype.setContextFillState_ = function(fillState) {
            var context = this.context_;
            var contextFillState = this.contextFillState_;
            if (!contextFillState) {
                context.fillStyle = fillState.fillStyle;
                this.contextFillState_ = {
                    fillStyle: fillState.fillStyle
                };
            } else {
                if (contextFillState.fillStyle != fillState.fillStyle) {
                    contextFillState.fillStyle = context.fillStyle = fillState.fillStyle;
                }
            }
        };
        _ol_render_canvas_Immediate_.prototype.setContextStrokeState_ = function(strokeState) {
            var context = this.context_;
            var contextStrokeState = this.contextStrokeState_;
            if (!contextStrokeState) {
                context.lineCap = strokeState.lineCap;
                if (_has2.default.CANVAS_LINE_DASH) {
                    context.setLineDash(strokeState.lineDash);
                    context.lineDashOffset = strokeState.lineDashOffset;
                }
                context.lineJoin = strokeState.lineJoin;
                context.lineWidth = strokeState.lineWidth;
                context.miterLimit = strokeState.miterLimit;
                context.strokeStyle = strokeState.strokeStyle;
                this.contextStrokeState_ = {
                    lineCap: strokeState.lineCap,
                    lineDash: strokeState.lineDash,
                    lineDashOffset: strokeState.lineDashOffset,
                    lineJoin: strokeState.lineJoin,
                    lineWidth: strokeState.lineWidth,
                    miterLimit: strokeState.miterLimit,
                    strokeStyle: strokeState.strokeStyle
                };
            } else {
                if (contextStrokeState.lineCap != strokeState.lineCap) {
                    contextStrokeState.lineCap = context.lineCap = strokeState.lineCap;
                }
                if (_has2.default.CANVAS_LINE_DASH) {
                    if (!_array2.default.equals(contextStrokeState.lineDash, strokeState.lineDash)) {
                        context.setLineDash(contextStrokeState.lineDash = strokeState.lineDash);
                    }
                    if (contextStrokeState.lineDashOffset != strokeState.lineDashOffset) {
                        contextStrokeState.lineDashOffset = context.lineDashOffset = strokeState.lineDashOffset;
                    }
                }
                if (contextStrokeState.lineJoin != strokeState.lineJoin) {
                    contextStrokeState.lineJoin = context.lineJoin = strokeState.lineJoin;
                }
                if (contextStrokeState.lineWidth != strokeState.lineWidth) {
                    contextStrokeState.lineWidth = context.lineWidth = strokeState.lineWidth;
                }
                if (contextStrokeState.miterLimit != strokeState.miterLimit) {
                    contextStrokeState.miterLimit = context.miterLimit = strokeState.miterLimit;
                }
                if (contextStrokeState.strokeStyle != strokeState.strokeStyle) {
                    contextStrokeState.strokeStyle = context.strokeStyle = strokeState.strokeStyle;
                }
            }
        };
        _ol_render_canvas_Immediate_.prototype.setContextTextState_ = function(textState) {
            var context = this.context_;
            var contextTextState = this.contextTextState_;
            var textAlign = textState.textAlign ? textState.textAlign : _canvas2.default.defaultTextAlign;
            if (!contextTextState) {
                context.font = textState.font;
                context.textAlign = textAlign;
                context.textBaseline = textState.textBaseline;
                this.contextTextState_ = {
                    font: textState.font,
                    textAlign: textAlign,
                    textBaseline: textState.textBaseline
                };
            } else {
                if (contextTextState.font != textState.font) {
                    contextTextState.font = context.font = textState.font;
                }
                if (contextTextState.textAlign != textAlign) {
                    contextTextState.textAlign = textAlign;
                }
                if (contextTextState.textBaseline != textState.textBaseline) {
                    contextTextState.textBaseline = context.textBaseline = textState.textBaseline;
                }
            }
        };
        _ol_render_canvas_Immediate_.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {
            if (!fillStyle) {
                this.fillState_ = null;
            } else {
                var fillStyleColor = fillStyle.getColor();
                this.fillState_ = {
                    fillStyle: _colorlike2.default.asColorLike(fillStyleColor ? fillStyleColor : _canvas2.default.defaultFillStyle)
                };
            }
            if (!strokeStyle) {
                this.strokeState_ = null;
            } else {
                var strokeStyleColor = strokeStyle.getColor();
                var strokeStyleLineCap = strokeStyle.getLineCap();
                var strokeStyleLineDash = strokeStyle.getLineDash();
                var strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();
                var strokeStyleLineJoin = strokeStyle.getLineJoin();
                var strokeStyleWidth = strokeStyle.getWidth();
                var strokeStyleMiterLimit = strokeStyle.getMiterLimit();
                this.strokeState_ = {
                    lineCap: strokeStyleLineCap !== undefined ? strokeStyleLineCap : _canvas2.default.defaultLineCap,
                    lineDash: strokeStyleLineDash ? strokeStyleLineDash : _canvas2.default.defaultLineDash,
                    lineDashOffset: strokeStyleLineDashOffset ? strokeStyleLineDashOffset : _canvas2.default.defaultLineDashOffset,
                    lineJoin: strokeStyleLineJoin !== undefined ? strokeStyleLineJoin : _canvas2.default.defaultLineJoin,
                    lineWidth: this.pixelRatio_ * (strokeStyleWidth !== undefined ? strokeStyleWidth : _canvas2.default.defaultLineWidth),
                    miterLimit: strokeStyleMiterLimit !== undefined ? strokeStyleMiterLimit : _canvas2.default.defaultMiterLimit,
                    strokeStyle: _colorlike2.default.asColorLike(strokeStyleColor ? strokeStyleColor : _canvas2.default.defaultStrokeStyle)
                };
            }
        };
        _ol_render_canvas_Immediate_.prototype.setImageStyle = function(imageStyle) {
            if (!imageStyle) {
                this.image_ = null;
            } else {
                var imageAnchor = imageStyle.getAnchor();
                var imageImage = imageStyle.getImage(1);
                var imageOrigin = imageStyle.getOrigin();
                var imageSize = imageStyle.getSize();
                this.imageAnchorX_ = imageAnchor[0];
                this.imageAnchorY_ = imageAnchor[1];
                this.imageHeight_ = imageSize[1];
                this.image_ = imageImage;
                this.imageOpacity_ = imageStyle.getOpacity();
                this.imageOriginX_ = imageOrigin[0];
                this.imageOriginY_ = imageOrigin[1];
                this.imageRotateWithView_ = imageStyle.getRotateWithView();
                this.imageRotation_ = imageStyle.getRotation();
                this.imageScale_ = imageStyle.getScale() * this.pixelRatio_;
                this.imageSnapToPixel_ = imageStyle.getSnapToPixel();
                this.imageWidth_ = imageSize[0];
            }
        };
        _ol_render_canvas_Immediate_.prototype.setTextStyle = function(textStyle) {
            if (!textStyle) {
                this.text_ = "";
            } else {
                var textFillStyle = textStyle.getFill();
                if (!textFillStyle) {
                    this.textFillState_ = null;
                } else {
                    var textFillStyleColor = textFillStyle.getColor();
                    this.textFillState_ = {
                        fillStyle: _colorlike2.default.asColorLike(textFillStyleColor ? textFillStyleColor : _canvas2.default.defaultFillStyle)
                    };
                }
                var textStrokeStyle = textStyle.getStroke();
                if (!textStrokeStyle) {
                    this.textStrokeState_ = null;
                } else {
                    var textStrokeStyleColor = textStrokeStyle.getColor();
                    var textStrokeStyleLineCap = textStrokeStyle.getLineCap();
                    var textStrokeStyleLineDash = textStrokeStyle.getLineDash();
                    var textStrokeStyleLineDashOffset = textStrokeStyle.getLineDashOffset();
                    var textStrokeStyleLineJoin = textStrokeStyle.getLineJoin();
                    var textStrokeStyleWidth = textStrokeStyle.getWidth();
                    var textStrokeStyleMiterLimit = textStrokeStyle.getMiterLimit();
                    this.textStrokeState_ = {
                        lineCap: textStrokeStyleLineCap !== undefined ? textStrokeStyleLineCap : _canvas2.default.defaultLineCap,
                        lineDash: textStrokeStyleLineDash ? textStrokeStyleLineDash : _canvas2.default.defaultLineDash,
                        lineDashOffset: textStrokeStyleLineDashOffset ? textStrokeStyleLineDashOffset : _canvas2.default.defaultLineDashOffset,
                        lineJoin: textStrokeStyleLineJoin !== undefined ? textStrokeStyleLineJoin : _canvas2.default.defaultLineJoin,
                        lineWidth: textStrokeStyleWidth !== undefined ? textStrokeStyleWidth : _canvas2.default.defaultLineWidth,
                        miterLimit: textStrokeStyleMiterLimit !== undefined ? textStrokeStyleMiterLimit : _canvas2.default.defaultMiterLimit,
                        strokeStyle: _colorlike2.default.asColorLike(textStrokeStyleColor ? textStrokeStyleColor : _canvas2.default.defaultStrokeStyle)
                    };
                }
                var textFont = textStyle.getFont();
                var textOffsetX = textStyle.getOffsetX();
                var textOffsetY = textStyle.getOffsetY();
                var textRotateWithView = textStyle.getRotateWithView();
                var textRotation = textStyle.getRotation();
                var textScale = textStyle.getScale();
                var textText = textStyle.getText();
                var textTextAlign = textStyle.getTextAlign();
                var textTextBaseline = textStyle.getTextBaseline();
                this.textState_ = {
                    font: textFont !== undefined ? textFont : _canvas2.default.defaultFont,
                    textAlign: textTextAlign !== undefined ? textTextAlign : _canvas2.default.defaultTextAlign,
                    textBaseline: textTextBaseline !== undefined ? textTextBaseline : _canvas2.default.defaultTextBaseline
                };
                this.text_ = textText !== undefined ? textText : "";
                this.textOffsetX_ = textOffsetX !== undefined ? this.pixelRatio_ * textOffsetX : 0;
                this.textOffsetY_ = textOffsetY !== undefined ? this.pixelRatio_ * textOffsetY : 0;
                this.textRotateWithView_ = textRotateWithView !== undefined ? textRotateWithView : false;
                this.textRotation_ = textRotation !== undefined ? textRotation : 0;
                this.textScale_ = this.pixelRatio_ * (textScale !== undefined ? textScale : 1);
            }
        };
        exports.default = _ol_render_canvas_Immediate_;
    }, {
        "../../array.js": 29,
        "../../colorlike.js": 37,
        "../../extent.js": 54,
        "../../geom/flat/transform.js": 76,
        "../../geom/geometrytype.js": 79,
        "../../geom/simplegeometry.js": 83,
        "../../has.js": 84,
        "../../index.js": 89,
        "../../transform.js": 243,
        "../canvas.js": 150,
        "../vectorcontext.js": 164
    } ],
    153: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_render_canvas_Instruction_ = {
            BEGIN_GEOMETRY: 0,
            BEGIN_PATH: 1,
            CIRCLE: 2,
            CLOSE_PATH: 3,
            CUSTOM: 4,
            DRAW_CHARS: 5,
            DRAW_IMAGE: 6,
            END_GEOMETRY: 7,
            FILL: 8,
            MOVE_TO_LINE_TO: 9,
            SET_FILL_STYLE: 10,
            SET_STROKE_STYLE: 11,
            STROKE: 12
        };
        exports.default = _ol_render_canvas_Instruction_;
    }, {} ],
    154: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _instruction = require("../canvas/instruction.js");
        var _instruction2 = _interopRequireDefault(_instruction);
        var _replay = require("../canvas/replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_canvas_LineStringReplay_ = function(tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {
            _replay2.default.call(this, tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree);
        };
        _index2.default.inherits(_ol_render_canvas_LineStringReplay_, _replay2.default);
        _ol_render_canvas_LineStringReplay_.prototype.drawFlatCoordinates_ = function(flatCoordinates, offset, end, stride) {
            var myBegin = this.coordinates.length;
            var myEnd = this.appendFlatCoordinates(flatCoordinates, offset, end, stride, false, false);
            var moveToLineToInstruction = [ _instruction2.default.MOVE_TO_LINE_TO, myBegin, myEnd ];
            this.instructions.push(moveToLineToInstruction);
            this.hitDetectionInstructions.push(moveToLineToInstruction);
            return end;
        };
        _ol_render_canvas_LineStringReplay_.prototype.drawLineString = function(lineStringGeometry, feature) {
            var state = this.state;
            var strokeStyle = state.strokeStyle;
            var lineWidth = state.lineWidth;
            if (strokeStyle === undefined || lineWidth === undefined) {
                return;
            }
            this.updateStrokeStyle(state, this.applyStroke);
            this.beginGeometry(lineStringGeometry, feature);
            this.hitDetectionInstructions.push([ _instruction2.default.SET_STROKE_STYLE, state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin, state.miterLimit, state.lineDash, state.lineDashOffset ], [ _instruction2.default.BEGIN_PATH ]);
            var flatCoordinates = lineStringGeometry.getFlatCoordinates();
            var stride = lineStringGeometry.getStride();
            this.drawFlatCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);
            this.hitDetectionInstructions.push([ _instruction2.default.STROKE ]);
            this.endGeometry(lineStringGeometry, feature);
        };
        _ol_render_canvas_LineStringReplay_.prototype.drawMultiLineString = function(multiLineStringGeometry, feature) {
            var state = this.state;
            var strokeStyle = state.strokeStyle;
            var lineWidth = state.lineWidth;
            if (strokeStyle === undefined || lineWidth === undefined) {
                return;
            }
            this.updateStrokeStyle(state, this.applyStroke);
            this.beginGeometry(multiLineStringGeometry, feature);
            this.hitDetectionInstructions.push([ _instruction2.default.SET_STROKE_STYLE, state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin, state.miterLimit, state.lineDash, state.lineDashOffset ], [ _instruction2.default.BEGIN_PATH ]);
            var ends = multiLineStringGeometry.getEnds();
            var flatCoordinates = multiLineStringGeometry.getFlatCoordinates();
            var stride = multiLineStringGeometry.getStride();
            var offset = 0;
            var i, ii;
            for (i = 0, ii = ends.length; i < ii; ++i) {
                offset = this.drawFlatCoordinates_(flatCoordinates, offset, ends[i], stride);
            }
            this.hitDetectionInstructions.push([ _instruction2.default.STROKE ]);
            this.endGeometry(multiLineStringGeometry, feature);
        };
        _ol_render_canvas_LineStringReplay_.prototype.finish = function() {
            var state = this.state;
            if (state.lastStroke != undefined && state.lastStroke != this.coordinates.length) {
                this.instructions.push([ _instruction2.default.STROKE ]);
            }
            this.reverseHitDetectionInstructions();
            this.state = null;
        };
        _ol_render_canvas_LineStringReplay_.prototype.applyStroke = function(state) {
            if (state.lastStroke != undefined && state.lastStroke != this.coordinates.length) {
                this.instructions.push([ _instruction2.default.STROKE ]);
                state.lastStroke = this.coordinates.length;
            }
            state.lastStroke = 0;
            _replay2.default.prototype.applyStroke.call(this, state);
            this.instructions.push([ _instruction2.default.BEGIN_PATH ]);
        };
        exports.default = _ol_render_canvas_LineStringReplay_;
    }, {
        "../../index.js": 89,
        "../canvas/instruction.js": 153,
        "../canvas/replay.js": 156
    } ],
    155: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _color = require("../../color.js");
        var _color2 = _interopRequireDefault(_color);
        var _simplify = require("../../geom/flat/simplify.js");
        var _simplify2 = _interopRequireDefault(_simplify);
        var _canvas = require("../canvas.js");
        var _canvas2 = _interopRequireDefault(_canvas);
        var _instruction = require("../canvas/instruction.js");
        var _instruction2 = _interopRequireDefault(_instruction);
        var _replay = require("../canvas/replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_canvas_PolygonReplay_ = function(tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {
            _replay2.default.call(this, tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree);
        };
        _index2.default.inherits(_ol_render_canvas_PolygonReplay_, _replay2.default);
        _ol_render_canvas_PolygonReplay_.prototype.drawFlatCoordinatess_ = function(flatCoordinates, offset, ends, stride) {
            var state = this.state;
            var fill = state.fillStyle !== undefined;
            var stroke = state.strokeStyle != undefined;
            var numEnds = ends.length;
            var beginPathInstruction = [ _instruction2.default.BEGIN_PATH ];
            this.instructions.push(beginPathInstruction);
            this.hitDetectionInstructions.push(beginPathInstruction);
            for (var i = 0; i < numEnds; ++i) {
                var end = ends[i];
                var myBegin = this.coordinates.length;
                var myEnd = this.appendFlatCoordinates(flatCoordinates, offset, end, stride, true, !stroke);
                var moveToLineToInstruction = [ _instruction2.default.MOVE_TO_LINE_TO, myBegin, myEnd ];
                this.instructions.push(moveToLineToInstruction);
                this.hitDetectionInstructions.push(moveToLineToInstruction);
                if (stroke) {
                    var closePathInstruction = [ _instruction2.default.CLOSE_PATH ];
                    this.instructions.push(closePathInstruction);
                    this.hitDetectionInstructions.push(closePathInstruction);
                }
                offset = end;
            }
            var fillInstruction = [ _instruction2.default.FILL ];
            this.hitDetectionInstructions.push(fillInstruction);
            if (fill) {
                this.instructions.push(fillInstruction);
            }
            if (stroke) {
                var strokeInstruction = [ _instruction2.default.STROKE ];
                this.instructions.push(strokeInstruction);
                this.hitDetectionInstructions.push(strokeInstruction);
            }
            return offset;
        };
        _ol_render_canvas_PolygonReplay_.prototype.drawCircle = function(circleGeometry, feature) {
            var state = this.state;
            var fillStyle = state.fillStyle;
            var strokeStyle = state.strokeStyle;
            if (fillStyle === undefined && strokeStyle === undefined) {
                return;
            }
            this.setFillStrokeStyles_(circleGeometry);
            this.beginGeometry(circleGeometry, feature);
            this.hitDetectionInstructions.push([ _instruction2.default.SET_FILL_STYLE, _color2.default.asString(_canvas2.default.defaultFillStyle) ]);
            if (state.strokeStyle !== undefined) {
                this.hitDetectionInstructions.push([ _instruction2.default.SET_STROKE_STYLE, state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin, state.miterLimit, state.lineDash, state.lineDashOffset ]);
            }
            var flatCoordinates = circleGeometry.getFlatCoordinates();
            var stride = circleGeometry.getStride();
            var myBegin = this.coordinates.length;
            this.appendFlatCoordinates(flatCoordinates, 0, flatCoordinates.length, stride, false, false);
            var beginPathInstruction = [ _instruction2.default.BEGIN_PATH ];
            var circleInstruction = [ _instruction2.default.CIRCLE, myBegin ];
            this.instructions.push(beginPathInstruction, circleInstruction);
            this.hitDetectionInstructions.push(beginPathInstruction, circleInstruction);
            var fillInstruction = [ _instruction2.default.FILL ];
            this.hitDetectionInstructions.push(fillInstruction);
            if (state.fillStyle !== undefined) {
                this.instructions.push(fillInstruction);
            }
            if (state.strokeStyle !== undefined) {
                var strokeInstruction = [ _instruction2.default.STROKE ];
                this.instructions.push(strokeInstruction);
                this.hitDetectionInstructions.push(strokeInstruction);
            }
            this.endGeometry(circleGeometry, feature);
        };
        _ol_render_canvas_PolygonReplay_.prototype.drawPolygon = function(polygonGeometry, feature) {
            var state = this.state;
            this.setFillStrokeStyles_(polygonGeometry);
            this.beginGeometry(polygonGeometry, feature);
            this.hitDetectionInstructions.push([ _instruction2.default.SET_FILL_STYLE, _color2.default.asString(_canvas2.default.defaultFillStyle) ]);
            if (state.strokeStyle !== undefined) {
                this.hitDetectionInstructions.push([ _instruction2.default.SET_STROKE_STYLE, state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin, state.miterLimit, state.lineDash, state.lineDashOffset ]);
            }
            var ends = polygonGeometry.getEnds();
            var flatCoordinates = polygonGeometry.getOrientedFlatCoordinates();
            var stride = polygonGeometry.getStride();
            this.drawFlatCoordinatess_(flatCoordinates, 0, ends, stride);
            this.endGeometry(polygonGeometry, feature);
        };
        _ol_render_canvas_PolygonReplay_.prototype.drawMultiPolygon = function(multiPolygonGeometry, feature) {
            var state = this.state;
            var fillStyle = state.fillStyle;
            var strokeStyle = state.strokeStyle;
            if (fillStyle === undefined && strokeStyle === undefined) {
                return;
            }
            this.setFillStrokeStyles_(multiPolygonGeometry);
            this.beginGeometry(multiPolygonGeometry, feature);
            this.hitDetectionInstructions.push([ _instruction2.default.SET_FILL_STYLE, _color2.default.asString(_canvas2.default.defaultFillStyle) ]);
            if (state.strokeStyle !== undefined) {
                this.hitDetectionInstructions.push([ _instruction2.default.SET_STROKE_STYLE, state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin, state.miterLimit, state.lineDash, state.lineDashOffset ]);
            }
            var endss = multiPolygonGeometry.getEndss();
            var flatCoordinates = multiPolygonGeometry.getOrientedFlatCoordinates();
            var stride = multiPolygonGeometry.getStride();
            var offset = 0;
            var i, ii;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                offset = this.drawFlatCoordinatess_(flatCoordinates, offset, endss[i], stride);
            }
            this.endGeometry(multiPolygonGeometry, feature);
        };
        _ol_render_canvas_PolygonReplay_.prototype.finish = function() {
            this.reverseHitDetectionInstructions();
            this.state = null;
            var tolerance = this.tolerance;
            if (tolerance !== 0) {
                var coordinates = this.coordinates;
                var i, ii;
                for (i = 0, ii = coordinates.length; i < ii; ++i) {
                    coordinates[i] = _simplify2.default.snap(coordinates[i], tolerance);
                }
            }
        };
        _ol_render_canvas_PolygonReplay_.prototype.setFillStrokeStyles_ = function(geometry) {
            var state = this.state;
            var fillStyle = state.fillStyle;
            if (fillStyle !== undefined) {
                this.updateFillStyle(state, this.applyFill, geometry);
            }
            if (state.strokeStyle !== undefined) {
                this.updateStrokeStyle(state, this.applyStroke);
            }
        };
        exports.default = _ol_render_canvas_PolygonReplay_;
    }, {
        "../../color.js": 36,
        "../../geom/flat/simplify.js": 72,
        "../../index.js": 89,
        "../canvas.js": 150,
        "../canvas/instruction.js": 153,
        "../canvas/replay.js": 156
    } ],
    156: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _colorlike = require("../../colorlike.js");
        var _colorlike2 = _interopRequireDefault(_colorlike);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _relationship = require("../../extent/relationship.js");
        var _relationship2 = _interopRequireDefault(_relationship);
        var _geometrytype = require("../../geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _inflate = require("../../geom/flat/inflate.js");
        var _inflate2 = _interopRequireDefault(_inflate);
        var _length = require("../../geom/flat/length.js");
        var _length2 = _interopRequireDefault(_length);
        var _textpath = require("../../geom/flat/textpath.js");
        var _textpath2 = _interopRequireDefault(_textpath);
        var _transform = require("../../geom/flat/transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _has = require("../../has.js");
        var _has2 = _interopRequireDefault(_has);
        var _obj = require("../../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _vectorcontext = require("../vectorcontext.js");
        var _vectorcontext2 = _interopRequireDefault(_vectorcontext);
        var _canvas = require("../canvas.js");
        var _canvas2 = _interopRequireDefault(_canvas);
        var _instruction = require("../canvas/instruction.js");
        var _instruction2 = _interopRequireDefault(_instruction);
        var _replay = require("../replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        var _transform3 = require("../../transform.js");
        var _transform4 = _interopRequireDefault(_transform3);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_canvas_Replay_ = function(tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {
            _vectorcontext2.default.call(this);
            this.declutterTree = declutterTree;
            this.tmpExtent_ = _extent2.default.createEmpty();
            this.tolerance = tolerance;
            this.maxExtent = maxExtent;
            this.overlaps = overlaps;
            this.pixelRatio = pixelRatio;
            this.maxLineWidth = 0;
            this.resolution = resolution;
            this.fillOrigin_;
            this.beginGeometryInstruction1_ = null;
            this.beginGeometryInstruction2_ = null;
            this.bufferedMaxExtent_ = null;
            this.instructions = [];
            this.coordinates = [];
            this.coordinateCache_ = {};
            this.renderedTransform_ = _transform4.default.create();
            this.hitDetectionInstructions = [];
            this.pixelCoordinates_ = null;
            this.state = {};
            this.viewRotation_ = 0;
            this.tmpLocalTransform_ = _transform4.default.create();
            this.resetTransform_ = _transform4.default.create();
        };
        _index2.default.inherits(_ol_render_canvas_Replay_, _vectorcontext2.default);
        _ol_render_canvas_Replay_.prototype.replayTextBackground_ = function(context, p1, p2, p3, p4, fillInstruction, strokeInstruction) {
            context.beginPath();
            context.moveTo.apply(context, p1);
            context.lineTo.apply(context, p2);
            context.lineTo.apply(context, p3);
            context.lineTo.apply(context, p4);
            context.lineTo.apply(context, p1);
            if (fillInstruction) {
                this.fillOrigin_ = fillInstruction[2];
                this.fill_(context);
            }
            if (strokeInstruction) {
                this.setStrokeStyle_(context, strokeInstruction);
                context.stroke();
            }
        };
        _ol_render_canvas_Replay_.prototype.replayImage_ = function(context, x, y, image, anchorX, anchorY, declutterGroup, height, opacity, originX, originY, rotation, scale, snapToPixel, width, padding, fillInstruction, strokeInstruction) {
            var fillStroke = fillInstruction || strokeInstruction;
            var localTransform = this.tmpLocalTransform_;
            anchorX *= scale;
            anchorY *= scale;
            x -= anchorX;
            y -= anchorY;
            if (snapToPixel) {
                x = Math.round(x);
                y = Math.round(y);
            }
            var w = width + originX > image.width ? image.width - originX : width;
            var h = height + originY > image.height ? image.height - originY : height;
            var box = this.tmpExtent_;
            var boxW = padding[3] + w * scale + padding[1];
            var boxH = padding[0] + h * scale + padding[2];
            var boxX = x - padding[3];
            var boxY = y - padding[0];
            var p1;
            var p2;
            var p3;
            var p4;
            if (fillStroke || rotation !== 0) {
                p1 = [ boxX, boxY ];
                p2 = [ boxX + boxW, boxY ];
                p3 = [ boxX + boxW, boxY + boxH ];
                p4 = [ boxX, boxY + boxH ];
            }
            var transform = null;
            if (rotation !== 0) {
                var centerX = x + anchorX;
                var centerY = y + anchorY;
                transform = _transform4.default.compose(localTransform, centerX, centerY, 1, 1, rotation, -centerX, -centerY);
                _extent2.default.createOrUpdateEmpty(box);
                _extent2.default.extendCoordinate(box, _transform4.default.apply(localTransform, p1));
                _extent2.default.extendCoordinate(box, _transform4.default.apply(localTransform, p2));
                _extent2.default.extendCoordinate(box, _transform4.default.apply(localTransform, p3));
                _extent2.default.extendCoordinate(box, _transform4.default.apply(localTransform, p4));
            } else {
                _extent2.default.createOrUpdate(boxX, boxY, boxX + boxW, boxY + boxH, box);
            }
            var canvas = context.canvas;
            var intersects = box[0] <= canvas.width && box[2] >= 0 && box[1] <= canvas.height && box[3] >= 0;
            if (declutterGroup) {
                if (!intersects && declutterGroup[4] == 1) {
                    return;
                }
                _extent2.default.extend(declutterGroup, box);
                var declutterArgs = intersects ? [ context, transform ? transform.slice(0) : null, opacity, image, originX, originY, w, h, x, y, scale ] : null;
                if (declutterArgs && fillStroke) {
                    declutterArgs.push(fillInstruction, strokeInstruction, p1, p2, p3, p4);
                }
                declutterGroup.push(declutterArgs);
            } else if (intersects) {
                if (fillStroke) {
                    this.replayTextBackground_(context, p1, p2, p3, p4, fillInstruction, strokeInstruction);
                }
                _canvas2.default.drawImage(context, transform, opacity, image, originX, originY, w, h, x, y, scale);
            }
        };
        _ol_render_canvas_Replay_.prototype.applyPixelRatio = function(dashArray) {
            var pixelRatio = this.pixelRatio;
            return pixelRatio == 1 ? dashArray : dashArray.map(function(dash) {
                return dash * pixelRatio;
            });
        };
        _ol_render_canvas_Replay_.prototype.appendFlatCoordinates = function(flatCoordinates, offset, end, stride, closed, skipFirst) {
            var myEnd = this.coordinates.length;
            var extent = this.getBufferedMaxExtent();
            if (skipFirst) {
                offset += stride;
            }
            var lastCoord = [ flatCoordinates[offset], flatCoordinates[offset + 1] ];
            var nextCoord = [ NaN, NaN ];
            var skipped = true;
            var i, lastRel, nextRel;
            for (i = offset + stride; i < end; i += stride) {
                nextCoord[0] = flatCoordinates[i];
                nextCoord[1] = flatCoordinates[i + 1];
                nextRel = _extent2.default.coordinateRelationship(extent, nextCoord);
                if (nextRel !== lastRel) {
                    if (skipped) {
                        this.coordinates[myEnd++] = lastCoord[0];
                        this.coordinates[myEnd++] = lastCoord[1];
                    }
                    this.coordinates[myEnd++] = nextCoord[0];
                    this.coordinates[myEnd++] = nextCoord[1];
                    skipped = false;
                } else if (nextRel === _relationship2.default.INTERSECTING) {
                    this.coordinates[myEnd++] = nextCoord[0];
                    this.coordinates[myEnd++] = nextCoord[1];
                    skipped = false;
                } else {
                    skipped = true;
                }
                lastCoord[0] = nextCoord[0];
                lastCoord[1] = nextCoord[1];
                lastRel = nextRel;
            }
            if (closed && skipped || i === offset + stride) {
                this.coordinates[myEnd++] = lastCoord[0];
                this.coordinates[myEnd++] = lastCoord[1];
            }
            return myEnd;
        };
        _ol_render_canvas_Replay_.prototype.drawCustomCoordinates_ = function(flatCoordinates, offset, ends, stride, replayEnds) {
            for (var i = 0, ii = ends.length; i < ii; ++i) {
                var end = ends[i];
                var replayEnd = this.appendFlatCoordinates(flatCoordinates, offset, end, stride, false, false);
                replayEnds.push(replayEnd);
                offset = end;
            }
            return offset;
        };
        _ol_render_canvas_Replay_.prototype.drawCustom = function(geometry, feature, renderer) {
            this.beginGeometry(geometry, feature);
            var type = geometry.getType();
            var stride = geometry.getStride();
            var replayBegin = this.coordinates.length;
            var flatCoordinates, replayEnd, replayEnds, replayEndss;
            var offset;
            if (type == _geometrytype2.default.MULTI_POLYGON) {
                geometry = geometry;
                flatCoordinates = geometry.getOrientedFlatCoordinates();
                replayEndss = [];
                var endss = geometry.getEndss();
                offset = 0;
                for (var i = 0, ii = endss.length; i < ii; ++i) {
                    var myEnds = [];
                    offset = this.drawCustomCoordinates_(flatCoordinates, offset, endss[i], stride, myEnds);
                    replayEndss.push(myEnds);
                }
                this.instructions.push([ _instruction2.default.CUSTOM, replayBegin, replayEndss, geometry, renderer, _inflate2.default.coordinatesss ]);
            } else if (type == _geometrytype2.default.POLYGON || type == _geometrytype2.default.MULTI_LINE_STRING) {
                replayEnds = [];
                flatCoordinates = type == _geometrytype2.default.POLYGON ? geometry.getOrientedFlatCoordinates() : geometry.getFlatCoordinates();
                offset = this.drawCustomCoordinates_(flatCoordinates, 0, geometry.getEnds(), stride, replayEnds);
                this.instructions.push([ _instruction2.default.CUSTOM, replayBegin, replayEnds, geometry, renderer, _inflate2.default.coordinatess ]);
            } else if (type == _geometrytype2.default.LINE_STRING || type == _geometrytype2.default.MULTI_POINT) {
                flatCoordinates = geometry.getFlatCoordinates();
                replayEnd = this.appendFlatCoordinates(flatCoordinates, 0, flatCoordinates.length, stride, false, false);
                this.instructions.push([ _instruction2.default.CUSTOM, replayBegin, replayEnd, geometry, renderer, _inflate2.default.coordinates ]);
            } else if (type == _geometrytype2.default.POINT) {
                flatCoordinates = geometry.getFlatCoordinates();
                this.coordinates.push(flatCoordinates[0], flatCoordinates[1]);
                replayEnd = this.coordinates.length;
                this.instructions.push([ _instruction2.default.CUSTOM, replayBegin, replayEnd, geometry, renderer ]);
            }
            this.endGeometry(geometry, feature);
        };
        _ol_render_canvas_Replay_.prototype.beginGeometry = function(geometry, feature) {
            this.beginGeometryInstruction1_ = [ _instruction2.default.BEGIN_GEOMETRY, feature, 0 ];
            this.instructions.push(this.beginGeometryInstruction1_);
            this.beginGeometryInstruction2_ = [ _instruction2.default.BEGIN_GEOMETRY, feature, 0 ];
            this.hitDetectionInstructions.push(this.beginGeometryInstruction2_);
        };
        _ol_render_canvas_Replay_.prototype.fill_ = function(context) {
            if (this.fillOrigin_) {
                var origin = _transform4.default.apply(this.renderedTransform_, this.fillOrigin_.slice());
                context.translate(origin[0], origin[1]);
                context.rotate(this.viewRotation_);
            }
            context.fill();
            if (this.fillOrigin_) {
                context.setTransform.apply(context, _canvas2.default.resetTransform_);
            }
        };
        _ol_render_canvas_Replay_.prototype.setStrokeStyle_ = function(context, instruction) {
            context.strokeStyle = instruction[1];
            context.lineWidth = instruction[2];
            context.lineCap = instruction[3];
            context.lineJoin = instruction[4];
            context.miterLimit = instruction[5];
            if (_has2.default.CANVAS_LINE_DASH) {
                context.lineDashOffset = instruction[7];
                context.setLineDash(instruction[6]);
            }
        };
        _ol_render_canvas_Replay_.prototype.renderDeclutter_ = function(declutterGroup, feature) {
            if (declutterGroup && declutterGroup.length > 5) {
                var groupCount = declutterGroup[4];
                if (groupCount == 1 || groupCount == declutterGroup.length - 5) {
                    var box = {
                        minX: declutterGroup[0],
                        minY: declutterGroup[1],
                        maxX: declutterGroup[2],
                        maxY: declutterGroup[3],
                        value: feature
                    };
                    if (!this.declutterTree.collides(box)) {
                        this.declutterTree.insert(box);
                        var drawImage = _canvas2.default.drawImage;
                        for (var j = 5, jj = declutterGroup.length; j < jj; ++j) {
                            var declutterData = declutterGroup[j];
                            if (declutterData) {
                                if (declutterData.length > 11) {
                                    this.replayTextBackground_(declutterData[0], declutterData[13], declutterData[14], declutterData[15], declutterData[16], declutterData[11], declutterData[12]);
                                }
                                drawImage.apply(undefined, declutterData);
                            }
                        }
                    }
                    declutterGroup.length = 5;
                    _extent2.default.createOrUpdateEmpty(declutterGroup);
                }
            }
        };
        _ol_render_canvas_Replay_.prototype.replay_ = function(context, transform, skippedFeaturesHash, instructions, featureCallback, opt_hitExtent) {
            var pixelCoordinates;
            if (this.pixelCoordinates_ && _array2.default.equals(transform, this.renderedTransform_)) {
                pixelCoordinates = this.pixelCoordinates_;
            } else {
                if (!this.pixelCoordinates_) {
                    this.pixelCoordinates_ = [];
                }
                pixelCoordinates = _transform2.default.transform2D(this.coordinates, 0, this.coordinates.length, 2, transform, this.pixelCoordinates_);
                _transform4.default.setFromArray(this.renderedTransform_, transform);
            }
            var skipFeatures = !_obj2.default.isEmpty(skippedFeaturesHash);
            var i = 0;
            var ii = instructions.length;
            var d = 0;
            var dd;
            var anchorX, anchorY, prevX, prevY, roundX, roundY, declutterGroup, image;
            var pendingFill = 0;
            var pendingStroke = 0;
            var lastFillInstruction = null;
            var lastStrokeInstruction = null;
            var coordinateCache = this.coordinateCache_;
            var viewRotation = this.viewRotation_;
            var state = {
                context: context,
                pixelRatio: this.pixelRatio,
                resolution: this.resolution,
                rotation: viewRotation
            };
            var batchSize = this.instructions != instructions || this.overlaps ? 0 : 200;
            while (i < ii) {
                var instruction = instructions[i];
                var type = instruction[0];
                var feature, x, y;
                switch (type) {
                  case _instruction2.default.BEGIN_GEOMETRY:
                    feature = instruction[1];
                    if (skipFeatures && skippedFeaturesHash[_index2.default.getUid(feature).toString()] || !feature.getGeometry()) {
                        i = instruction[2];
                    } else if (opt_hitExtent !== undefined && !_extent2.default.intersects(opt_hitExtent, feature.getGeometry().getExtent())) {
                        i = instruction[2] + 1;
                    } else {
                        ++i;
                    }
                    break;

                  case _instruction2.default.BEGIN_PATH:
                    if (pendingFill > batchSize) {
                        this.fill_(context);
                        pendingFill = 0;
                    }
                    if (pendingStroke > batchSize) {
                        context.stroke();
                        pendingStroke = 0;
                    }
                    if (!pendingFill && !pendingStroke) {
                        context.beginPath();
                        prevX = prevY = NaN;
                    }
                    ++i;
                    break;

                  case _instruction2.default.CIRCLE:
                    d = instruction[1];
                    var x1 = pixelCoordinates[d];
                    var y1 = pixelCoordinates[d + 1];
                    var x2 = pixelCoordinates[d + 2];
                    var y2 = pixelCoordinates[d + 3];
                    var dx = x2 - x1;
                    var dy = y2 - y1;
                    var r = Math.sqrt(dx * dx + dy * dy);
                    context.moveTo(x1 + r, y1);
                    context.arc(x1, y1, r, 0, 2 * Math.PI, true);
                    ++i;
                    break;

                  case _instruction2.default.CLOSE_PATH:
                    context.closePath();
                    ++i;
                    break;

                  case _instruction2.default.CUSTOM:
                    d = instruction[1];
                    dd = instruction[2];
                    var geometry = instruction[3];
                    var renderer = instruction[4];
                    var fn = instruction.length == 6 ? instruction[5] : undefined;
                    state.geometry = geometry;
                    state.feature = feature;
                    if (!(i in coordinateCache)) {
                        coordinateCache[i] = [];
                    }
                    var coords = coordinateCache[i];
                    if (fn) {
                        fn(pixelCoordinates, d, dd, 2, coords);
                    } else {
                        coords[0] = pixelCoordinates[d];
                        coords[1] = pixelCoordinates[d + 1];
                        coords.length = 2;
                    }
                    renderer(coords, state);
                    ++i;
                    break;

                  case _instruction2.default.DRAW_IMAGE:
                    d = instruction[1];
                    dd = instruction[2];
                    image = instruction[3];
                    anchorX = instruction[4];
                    anchorY = instruction[5];
                    declutterGroup = featureCallback ? null : instruction[6];
                    var height = instruction[7];
                    var opacity = instruction[8];
                    var originX = instruction[9];
                    var originY = instruction[10];
                    var rotateWithView = instruction[11];
                    var rotation = instruction[12];
                    var scale = instruction[13];
                    var snapToPixel = instruction[14];
                    var width = instruction[15];
                    var padding, backgroundFill, backgroundStroke;
                    if (instruction.length > 16) {
                        padding = instruction[16];
                        backgroundFill = instruction[17];
                        backgroundStroke = instruction[18];
                    } else {
                        padding = _canvas2.default.defaultPadding;
                        backgroundFill = backgroundStroke = false;
                    }
                    if (rotateWithView) {
                        rotation += viewRotation;
                    }
                    for (;d < dd; d += 2) {
                        this.replayImage_(context, pixelCoordinates[d], pixelCoordinates[d + 1], image, anchorX, anchorY, declutterGroup, height, opacity, originX, originY, rotation, scale, snapToPixel, width, padding, backgroundFill ? lastFillInstruction : null, backgroundStroke ? lastStrokeInstruction : null);
                    }
                    this.renderDeclutter_(declutterGroup, feature);
                    ++i;
                    break;

                  case _instruction2.default.DRAW_CHARS:
                    var begin = instruction[1];
                    var end = instruction[2];
                    var baseline = instruction[3];
                    declutterGroup = featureCallback ? null : instruction[4];
                    var overflow = instruction[5];
                    var fillKey = instruction[6];
                    var maxAngle = instruction[7];
                    var measure = instruction[8];
                    var offsetY = instruction[9];
                    var strokeKey = instruction[10];
                    var strokeWidth = instruction[11];
                    var text = instruction[12];
                    var textKey = instruction[13];
                    var textScale = instruction[14];
                    var pathLength = _length2.default.lineString(pixelCoordinates, begin, end, 2);
                    var textLength = measure(text);
                    if (overflow || textLength <= pathLength) {
                        var textAlign = this.textStates[textKey].textAlign;
                        var startM = (pathLength - textLength) * _replay2.default.TEXT_ALIGN[textAlign];
                        var parts = _textpath2.default.lineString(pixelCoordinates, begin, end, 2, text, measure, startM, maxAngle);
                        if (parts) {
                            var c, cc, chars, label, part;
                            if (strokeKey) {
                                for (c = 0, cc = parts.length; c < cc; ++c) {
                                    part = parts[c];
                                    chars = part[4];
                                    label = this.getImage(chars, textKey, "", strokeKey);
                                    anchorX = part[2] + strokeWidth;
                                    anchorY = baseline * label.height + (.5 - baseline) * 2 * strokeWidth - offsetY;
                                    this.replayImage_(context, part[0], part[1], label, anchorX, anchorY, declutterGroup, label.height, 1, 0, 0, part[3], textScale, false, label.width, _canvas2.default.defaultPadding, null, null);
                                }
                            }
                            if (fillKey) {
                                for (c = 0, cc = parts.length; c < cc; ++c) {
                                    part = parts[c];
                                    chars = part[4];
                                    label = this.getImage(chars, textKey, fillKey, "");
                                    anchorX = part[2];
                                    anchorY = baseline * label.height - offsetY;
                                    this.replayImage_(context, part[0], part[1], label, anchorX, anchorY, declutterGroup, label.height, 1, 0, 0, part[3], textScale, false, label.width, _canvas2.default.defaultPadding, null, null);
                                }
                            }
                        }
                    }
                    this.renderDeclutter_(declutterGroup, feature);
                    ++i;
                    break;

                  case _instruction2.default.END_GEOMETRY:
                    if (featureCallback !== undefined) {
                        feature = instruction[1];
                        var result = featureCallback(feature);
                        if (result) {
                            return result;
                        }
                    }
                    ++i;
                    break;

                  case _instruction2.default.FILL:
                    if (batchSize) {
                        pendingFill++;
                    } else {
                        this.fill_(context);
                    }
                    ++i;
                    break;

                  case _instruction2.default.MOVE_TO_LINE_TO:
                    d = instruction[1];
                    dd = instruction[2];
                    x = pixelCoordinates[d];
                    y = pixelCoordinates[d + 1];
                    roundX = x + .5 | 0;
                    roundY = y + .5 | 0;
                    if (roundX !== prevX || roundY !== prevY) {
                        context.moveTo(x, y);
                        prevX = roundX;
                        prevY = roundY;
                    }
                    for (d += 2; d < dd; d += 2) {
                        x = pixelCoordinates[d];
                        y = pixelCoordinates[d + 1];
                        roundX = x + .5 | 0;
                        roundY = y + .5 | 0;
                        if (d == dd - 2 || roundX !== prevX || roundY !== prevY) {
                            context.lineTo(x, y);
                            prevX = roundX;
                            prevY = roundY;
                        }
                    }
                    ++i;
                    break;

                  case _instruction2.default.SET_FILL_STYLE:
                    lastFillInstruction = instruction;
                    this.fillOrigin_ = instruction[2];
                    if (pendingFill) {
                        this.fill_(context);
                        pendingFill = 0;
                        if (pendingStroke) {
                            context.stroke();
                            pendingStroke = 0;
                        }
                    }
                    context.fillStyle = instruction[1];
                    ++i;
                    break;

                  case _instruction2.default.SET_STROKE_STYLE:
                    lastStrokeInstruction = instruction;
                    if (pendingStroke) {
                        context.stroke();
                        pendingStroke = 0;
                    }
                    this.setStrokeStyle_(context, instruction);
                    ++i;
                    break;

                  case _instruction2.default.STROKE:
                    if (batchSize) {
                        pendingStroke++;
                    } else {
                        context.stroke();
                    }
                    ++i;
                    break;

                  default:
                    ++i;
                    break;
                }
            }
            if (pendingFill) {
                this.fill_(context);
            }
            if (pendingStroke) {
                context.stroke();
            }
            return undefined;
        };
        _ol_render_canvas_Replay_.prototype.replay = function(context, transform, viewRotation, skippedFeaturesHash) {
            this.viewRotation_ = viewRotation;
            this.replay_(context, transform, skippedFeaturesHash, this.instructions, undefined, undefined);
        };
        _ol_render_canvas_Replay_.prototype.replayHitDetection = function(context, transform, viewRotation, skippedFeaturesHash, opt_featureCallback, opt_hitExtent) {
            this.viewRotation_ = viewRotation;
            return this.replay_(context, transform, skippedFeaturesHash, this.hitDetectionInstructions, opt_featureCallback, opt_hitExtent);
        };
        _ol_render_canvas_Replay_.prototype.reverseHitDetectionInstructions = function() {
            var hitDetectionInstructions = this.hitDetectionInstructions;
            hitDetectionInstructions.reverse();
            var i;
            var n = hitDetectionInstructions.length;
            var instruction;
            var type;
            var begin = -1;
            for (i = 0; i < n; ++i) {
                instruction = hitDetectionInstructions[i];
                type = instruction[0];
                if (type == _instruction2.default.END_GEOMETRY) {
                    begin = i;
                } else if (type == _instruction2.default.BEGIN_GEOMETRY) {
                    instruction[2] = i;
                    _array2.default.reverseSubArray(this.hitDetectionInstructions, begin, i);
                    begin = -1;
                }
            }
        };
        _ol_render_canvas_Replay_.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {
            var state = this.state;
            if (fillStyle) {
                var fillStyleColor = fillStyle.getColor();
                state.fillStyle = _colorlike2.default.asColorLike(fillStyleColor ? fillStyleColor : _canvas2.default.defaultFillStyle);
            } else {
                state.fillStyle = undefined;
            }
            if (strokeStyle) {
                var strokeStyleColor = strokeStyle.getColor();
                state.strokeStyle = _colorlike2.default.asColorLike(strokeStyleColor ? strokeStyleColor : _canvas2.default.defaultStrokeStyle);
                var strokeStyleLineCap = strokeStyle.getLineCap();
                state.lineCap = strokeStyleLineCap !== undefined ? strokeStyleLineCap : _canvas2.default.defaultLineCap;
                var strokeStyleLineDash = strokeStyle.getLineDash();
                state.lineDash = strokeStyleLineDash ? strokeStyleLineDash.slice() : _canvas2.default.defaultLineDash;
                var strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();
                state.lineDashOffset = strokeStyleLineDashOffset ? strokeStyleLineDashOffset : _canvas2.default.defaultLineDashOffset;
                var strokeStyleLineJoin = strokeStyle.getLineJoin();
                state.lineJoin = strokeStyleLineJoin !== undefined ? strokeStyleLineJoin : _canvas2.default.defaultLineJoin;
                var strokeStyleWidth = strokeStyle.getWidth();
                state.lineWidth = strokeStyleWidth !== undefined ? strokeStyleWidth : _canvas2.default.defaultLineWidth;
                var strokeStyleMiterLimit = strokeStyle.getMiterLimit();
                state.miterLimit = strokeStyleMiterLimit !== undefined ? strokeStyleMiterLimit : _canvas2.default.defaultMiterLimit;
                if (state.lineWidth > this.maxLineWidth) {
                    this.maxLineWidth = state.lineWidth;
                    this.bufferedMaxExtent_ = null;
                }
            } else {
                state.strokeStyle = undefined;
                state.lineCap = undefined;
                state.lineDash = null;
                state.lineDashOffset = undefined;
                state.lineJoin = undefined;
                state.lineWidth = undefined;
                state.miterLimit = undefined;
            }
        };
        _ol_render_canvas_Replay_.prototype.applyFill = function(state, geometry) {
            var fillStyle = state.fillStyle;
            var fillInstruction = [ _instruction2.default.SET_FILL_STYLE, fillStyle ];
            if (typeof fillStyle !== "string") {
                var fillExtent = geometry.getExtent();
                fillInstruction.push([ fillExtent[0], fillExtent[3] ]);
            }
            this.instructions.push(fillInstruction);
        };
        _ol_render_canvas_Replay_.prototype.applyStroke = function(state) {
            this.instructions.push([ _instruction2.default.SET_STROKE_STYLE, state.strokeStyle, state.lineWidth * this.pixelRatio, state.lineCap, state.lineJoin, state.miterLimit, this.applyPixelRatio(state.lineDash), state.lineDashOffset * this.pixelRatio ]);
        };
        _ol_render_canvas_Replay_.prototype.updateFillStyle = function(state, applyFill, geometry) {
            var fillStyle = state.fillStyle;
            if (typeof fillStyle !== "string" || state.currentFillStyle != fillStyle) {
                applyFill.call(this, state, geometry);
                state.currentFillStyle = fillStyle;
            }
        };
        _ol_render_canvas_Replay_.prototype.updateStrokeStyle = function(state, applyStroke) {
            var strokeStyle = state.strokeStyle;
            var lineCap = state.lineCap;
            var lineDash = state.lineDash;
            var lineDashOffset = state.lineDashOffset;
            var lineJoin = state.lineJoin;
            var lineWidth = state.lineWidth;
            var miterLimit = state.miterLimit;
            if (state.currentStrokeStyle != strokeStyle || state.currentLineCap != lineCap || lineDash != state.currentLineDash && !_array2.default.equals(state.currentLineDash, lineDash) || state.currentLineDashOffset != lineDashOffset || state.currentLineJoin != lineJoin || state.currentLineWidth != lineWidth || state.currentMiterLimit != miterLimit) {
                applyStroke.call(this, state);
                state.currentStrokeStyle = strokeStyle;
                state.currentLineCap = lineCap;
                state.currentLineDash = lineDash;
                state.currentLineDashOffset = lineDashOffset;
                state.currentLineJoin = lineJoin;
                state.currentLineWidth = lineWidth;
                state.currentMiterLimit = miterLimit;
            }
        };
        _ol_render_canvas_Replay_.prototype.endGeometry = function(geometry, feature) {
            this.beginGeometryInstruction1_[2] = this.instructions.length;
            this.beginGeometryInstruction1_ = null;
            this.beginGeometryInstruction2_[2] = this.hitDetectionInstructions.length;
            this.beginGeometryInstruction2_ = null;
            var endGeometryInstruction = [ _instruction2.default.END_GEOMETRY, feature ];
            this.instructions.push(endGeometryInstruction);
            this.hitDetectionInstructions.push(endGeometryInstruction);
        };
        _ol_render_canvas_Replay_.prototype.finish = _index2.default.nullFunction;
        _ol_render_canvas_Replay_.prototype.getBufferedMaxExtent = function() {
            if (!this.bufferedMaxExtent_) {
                this.bufferedMaxExtent_ = _extent2.default.clone(this.maxExtent);
                if (this.maxLineWidth > 0) {
                    var width = this.resolution * (this.maxLineWidth + 1) / 2;
                    _extent2.default.buffer(this.bufferedMaxExtent_, width, this.bufferedMaxExtent_);
                }
            }
            return this.bufferedMaxExtent_;
        };
        exports.default = _ol_render_canvas_Replay_;
    }, {
        "../../array.js": 29,
        "../../colorlike.js": 37,
        "../../extent.js": 54,
        "../../extent/relationship.js": 56,
        "../../geom/flat/inflate.js": 65,
        "../../geom/flat/length.js": 68,
        "../../geom/flat/textpath.js": 74,
        "../../geom/flat/transform.js": 76,
        "../../geom/geometrytype.js": 79,
        "../../has.js": 84,
        "../../index.js": 89,
        "../../obj.js": 124,
        "../../transform.js": 243,
        "../canvas.js": 150,
        "../canvas/instruction.js": 153,
        "../replay.js": 161,
        "../vectorcontext.js": 164
    } ],
    157: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _dom = require("../../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _transform = require("../../geom/flat/transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _obj = require("../../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _replaygroup = require("../replaygroup.js");
        var _replaygroup2 = _interopRequireDefault(_replaygroup);
        var _replaytype = require("../replaytype.js");
        var _replaytype2 = _interopRequireDefault(_replaytype);
        var _replay = require("../canvas/replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        var _imagereplay = require("../canvas/imagereplay.js");
        var _imagereplay2 = _interopRequireDefault(_imagereplay);
        var _linestringreplay = require("../canvas/linestringreplay.js");
        var _linestringreplay2 = _interopRequireDefault(_linestringreplay);
        var _polygonreplay = require("../canvas/polygonreplay.js");
        var _polygonreplay2 = _interopRequireDefault(_polygonreplay);
        var _textreplay = require("../canvas/textreplay.js");
        var _textreplay2 = _interopRequireDefault(_textreplay);
        var _replay3 = require("../replay.js");
        var _replay4 = _interopRequireDefault(_replay3);
        var _transform3 = require("../../transform.js");
        var _transform4 = _interopRequireDefault(_transform3);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_canvas_ReplayGroup_ = function(tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree, opt_renderBuffer) {
            _replaygroup2.default.call(this);
            this.declutterTree_ = declutterTree;
            this.declutterGroup_ = null;
            this.tolerance_ = tolerance;
            this.maxExtent_ = maxExtent;
            this.overlaps_ = overlaps;
            this.pixelRatio_ = pixelRatio;
            this.resolution_ = resolution;
            this.renderBuffer_ = opt_renderBuffer;
            this.replaysByZIndex_ = {};
            this.hitDetectionContext_ = _dom2.default.createCanvasContext2D(1, 1);
            this.hitDetectionTransform_ = _transform4.default.create();
        };
        _index2.default.inherits(_ol_render_canvas_ReplayGroup_, _replaygroup2.default);
        _ol_render_canvas_ReplayGroup_.circleArrayCache_ = {
            0: [ [ true ] ]
        };
        _ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_ = function(array, x, y) {
            var i;
            var radius = Math.floor(array.length / 2);
            if (x >= radius) {
                for (i = radius; i < x; i++) {
                    array[i][y] = true;
                }
            } else if (x < radius) {
                for (i = x + 1; i < radius; i++) {
                    array[i][y] = true;
                }
            }
        };
        _ol_render_canvas_ReplayGroup_.getCircleArray_ = function(radius) {
            if (_ol_render_canvas_ReplayGroup_.circleArrayCache_[radius] !== undefined) {
                return _ol_render_canvas_ReplayGroup_.circleArrayCache_[radius];
            }
            var arraySize = radius * 2 + 1;
            var arr = new Array(arraySize);
            for (var i = 0; i < arraySize; i++) {
                arr[i] = new Array(arraySize);
            }
            var x = radius;
            var y = 0;
            var error = 0;
            while (x >= y) {
                _ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr, radius + x, radius + y);
                _ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr, radius + y, radius + x);
                _ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr, radius - y, radius + x);
                _ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr, radius - x, radius + y);
                _ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr, radius - x, radius - y);
                _ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr, radius - y, radius - x);
                _ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr, radius + y, radius - x);
                _ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr, radius + x, radius - y);
                y++;
                error += 1 + 2 * y;
                if (2 * (error - x) + 1 > 0) {
                    x -= 1;
                    error += 1 - 2 * x;
                }
            }
            _ol_render_canvas_ReplayGroup_.circleArrayCache_[radius] = arr;
            return arr;
        };
        _ol_render_canvas_ReplayGroup_.replayDeclutter = function(declutterReplays, context, rotation) {
            var zs = Object.keys(declutterReplays).map(Number).sort(_array2.default.numberSafeCompareFunction);
            var skippedFeatureUids = {};
            for (var z = 0, zz = zs.length; z < zz; ++z) {
                var replayData = declutterReplays[zs[z].toString()];
                for (var i = 0, ii = replayData.length; i < ii; ) {
                    var replay = replayData[i++];
                    var transform = replayData[i++];
                    replay.replay(context, transform, rotation, skippedFeatureUids);
                }
            }
        };
        _ol_render_canvas_ReplayGroup_.prototype.addDeclutter = function(group) {
            var declutter = null;
            if (this.declutterTree_) {
                if (group) {
                    declutter = this.declutterGroup_;
                    declutter[4]++;
                } else {
                    declutter = this.declutterGroup_ = _extent2.default.createEmpty();
                    declutter.push(1);
                }
            }
            return declutter;
        };
        _ol_render_canvas_ReplayGroup_.prototype.clip = function(context, transform) {
            var flatClipCoords = this.getClipCoords(transform);
            context.beginPath();
            context.moveTo(flatClipCoords[0], flatClipCoords[1]);
            context.lineTo(flatClipCoords[2], flatClipCoords[3]);
            context.lineTo(flatClipCoords[4], flatClipCoords[5]);
            context.lineTo(flatClipCoords[6], flatClipCoords[7]);
            context.clip();
        };
        _ol_render_canvas_ReplayGroup_.prototype.hasReplays = function(replays) {
            for (var zIndex in this.replaysByZIndex_) {
                var candidates = this.replaysByZIndex_[zIndex];
                for (var i = 0, ii = replays.length; i < ii; ++i) {
                    if (replays[i] in candidates) {
                        return true;
                    }
                }
            }
            return false;
        };
        _ol_render_canvas_ReplayGroup_.prototype.finish = function() {
            var zKey;
            for (zKey in this.replaysByZIndex_) {
                var replays = this.replaysByZIndex_[zKey];
                var replayKey;
                for (replayKey in replays) {
                    replays[replayKey].finish();
                }
            }
        };
        _ol_render_canvas_ReplayGroup_.prototype.forEachFeatureAtCoordinate = function(coordinate, resolution, rotation, hitTolerance, skippedFeaturesHash, callback, declutterReplays) {
            hitTolerance = Math.round(hitTolerance);
            var contextSize = hitTolerance * 2 + 1;
            var transform = _transform4.default.compose(this.hitDetectionTransform_, hitTolerance + .5, hitTolerance + .5, 1 / resolution, -1 / resolution, -rotation, -coordinate[0], -coordinate[1]);
            var context = this.hitDetectionContext_;
            if (context.canvas.width !== contextSize || context.canvas.height !== contextSize) {
                context.canvas.width = contextSize;
                context.canvas.height = contextSize;
            } else {
                context.clearRect(0, 0, contextSize, contextSize);
            }
            var hitExtent;
            if (this.renderBuffer_ !== undefined) {
                hitExtent = _extent2.default.createEmpty();
                _extent2.default.extendCoordinate(hitExtent, coordinate);
                _extent2.default.buffer(hitExtent, resolution * (this.renderBuffer_ + hitTolerance), hitExtent);
            }
            var mask = _ol_render_canvas_ReplayGroup_.getCircleArray_(hitTolerance);
            var declutteredFeatures;
            if (this.declutterTree_) {
                declutteredFeatures = this.declutterTree_.all().map(function(entry) {
                    return entry.value;
                });
            }
            function hitDetectionCallback(feature) {
                var imageData = context.getImageData(0, 0, contextSize, contextSize).data;
                for (var i = 0; i < contextSize; i++) {
                    for (var j = 0; j < contextSize; j++) {
                        if (mask[i][j]) {
                            if (imageData[(j * contextSize + i) * 4 + 3] > 0) {
                                var result;
                                if (!declutteredFeatures || declutteredFeatures.indexOf(feature) !== -1) {
                                    result = callback(feature);
                                }
                                if (result) {
                                    return result;
                                } else {
                                    context.clearRect(0, 0, contextSize, contextSize);
                                    return undefined;
                                }
                            }
                        }
                    }
                }
            }
            return this.replayHitDetection_(context, transform, rotation, skippedFeaturesHash, hitDetectionCallback, hitExtent, declutterReplays);
        };
        _ol_render_canvas_ReplayGroup_.prototype.getClipCoords = function(transform) {
            var maxExtent = this.maxExtent_;
            var minX = maxExtent[0];
            var minY = maxExtent[1];
            var maxX = maxExtent[2];
            var maxY = maxExtent[3];
            var flatClipCoords = [ minX, minY, minX, maxY, maxX, maxY, maxX, minY ];
            _transform2.default.transform2D(flatClipCoords, 0, 8, 2, transform, flatClipCoords);
            return flatClipCoords;
        };
        _ol_render_canvas_ReplayGroup_.prototype.getReplay = function(zIndex, replayType) {
            var zIndexKey = zIndex !== undefined ? zIndex.toString() : "0";
            var replays = this.replaysByZIndex_[zIndexKey];
            if (replays === undefined) {
                replays = {};
                this.replaysByZIndex_[zIndexKey] = replays;
            }
            var replay = replays[replayType];
            if (replay === undefined) {
                var Constructor = _ol_render_canvas_ReplayGroup_.BATCH_CONSTRUCTORS_[replayType];
                replay = new Constructor(this.tolerance_, this.maxExtent_, this.resolution_, this.pixelRatio_, this.overlaps_, this.declutterTree_);
                replays[replayType] = replay;
            }
            return replay;
        };
        _ol_render_canvas_ReplayGroup_.prototype.getReplays = function() {
            return this.replaysByZIndex_;
        };
        _ol_render_canvas_ReplayGroup_.prototype.isEmpty = function() {
            return _obj2.default.isEmpty(this.replaysByZIndex_);
        };
        _ol_render_canvas_ReplayGroup_.prototype.replay = function(context, transform, viewRotation, skippedFeaturesHash, opt_replayTypes, opt_declutterReplays) {
            var zs = Object.keys(this.replaysByZIndex_).map(Number);
            zs.sort(_array2.default.numberSafeCompareFunction);
            context.save();
            this.clip(context, transform);
            var replayTypes = opt_replayTypes ? opt_replayTypes : _replay4.default.ORDER;
            var i, ii, j, jj, replays, replay;
            for (i = 0, ii = zs.length; i < ii; ++i) {
                var zIndexKey = zs[i].toString();
                replays = this.replaysByZIndex_[zIndexKey];
                for (j = 0, jj = replayTypes.length; j < jj; ++j) {
                    var replayType = replayTypes[j];
                    replay = replays[replayType];
                    if (replay !== undefined) {
                        if (opt_declutterReplays && (replayType == _replaytype2.default.IMAGE || replayType == _replaytype2.default.TEXT)) {
                            var declutter = opt_declutterReplays[zIndexKey];
                            if (!declutter) {
                                opt_declutterReplays[zIndexKey] = [ replay, transform.slice(0) ];
                            } else {
                                declutter.push(replay, transform.slice(0));
                            }
                        } else {
                            replay.replay(context, transform, viewRotation, skippedFeaturesHash);
                        }
                    }
                }
            }
            context.restore();
        };
        _ol_render_canvas_ReplayGroup_.prototype.replayHitDetection_ = function(context, transform, viewRotation, skippedFeaturesHash, featureCallback, opt_hitExtent, opt_declutterReplays) {
            var zs = Object.keys(this.replaysByZIndex_).map(Number);
            zs.sort(_array2.default.numberSafeCompareFunction);
            var i, j, replays, replay, result;
            for (i = zs.length - 1; i >= 0; --i) {
                var zIndexKey = zs[i].toString();
                replays = this.replaysByZIndex_[zIndexKey];
                for (j = _replay4.default.ORDER.length - 1; j >= 0; --j) {
                    var replayType = _replay4.default.ORDER[j];
                    replay = replays[replayType];
                    if (replay !== undefined) {
                        if (opt_declutterReplays && (replayType == _replaytype2.default.IMAGE || replayType == _replaytype2.default.TEXT)) {
                            var declutter = opt_declutterReplays[zIndexKey];
                            if (!declutter) {
                                opt_declutterReplays[zIndexKey] = [ replay, transform.slice(0) ];
                            } else {
                                declutter.push(replay, transform.slice(0));
                            }
                        } else {
                            result = replay.replayHitDetection(context, transform, viewRotation, skippedFeaturesHash, featureCallback, opt_hitExtent);
                            if (result) {
                                return result;
                            }
                        }
                    }
                }
            }
            return undefined;
        };
        _ol_render_canvas_ReplayGroup_.BATCH_CONSTRUCTORS_ = {
            Circle: _polygonreplay2.default,
            Default: _replay2.default,
            Image: _imagereplay2.default,
            LineString: _linestringreplay2.default,
            Polygon: _polygonreplay2.default,
            Text: _textreplay2.default
        };
        exports.default = _ol_render_canvas_ReplayGroup_;
    }, {
        "../../array.js": 29,
        "../../dom.js": 46,
        "../../extent.js": 54,
        "../../geom/flat/transform.js": 76,
        "../../index.js": 89,
        "../../obj.js": 124,
        "../../transform.js": 243,
        "../canvas/imagereplay.js": 151,
        "../canvas/linestringreplay.js": 154,
        "../canvas/polygonreplay.js": 155,
        "../canvas/replay.js": 156,
        "../canvas/textreplay.js": 158,
        "../replay.js": 161,
        "../replaygroup.js": 162,
        "../replaytype.js": 163
    } ],
    158: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _colorlike = require("../../colorlike.js");
        var _colorlike2 = _interopRequireDefault(_colorlike);
        var _dom = require("../../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _straightchunk = require("../../geom/flat/straightchunk.js");
        var _straightchunk2 = _interopRequireDefault(_straightchunk);
        var _geometrytype = require("../../geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _has = require("../../has.js");
        var _has2 = _interopRequireDefault(_has);
        var _canvas = require("../canvas.js");
        var _canvas2 = _interopRequireDefault(_canvas);
        var _instruction = require("../canvas/instruction.js");
        var _instruction2 = _interopRequireDefault(_instruction);
        var _replay = require("../canvas/replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        var _replay3 = require("../replay.js");
        var _replay4 = _interopRequireDefault(_replay3);
        var _textplacement = require("../../style/textplacement.js");
        var _textplacement2 = _interopRequireDefault(_textplacement);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_canvas_TextReplay_ = function(tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {
            _replay2.default.call(this, tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree);
            this.declutterGroup_;
            this.labels_ = null;
            this.text_ = "";
            this.textOffsetX_ = 0;
            this.textOffsetY_ = 0;
            this.textRotateWithView_ = undefined;
            this.textRotation_ = 0;
            this.textFillState_ = null;
            this.fillStates = {};
            this.textStrokeState_ = null;
            this.strokeStates = {};
            this.textState_ = {};
            this.textStates = {};
            this.textKey_ = "";
            this.fillKey_ = "";
            this.strokeKey_ = "";
            this.widths_ = {};
            var labelCache = _canvas2.default.labelCache;
            labelCache.prune();
        };
        _index2.default.inherits(_ol_render_canvas_TextReplay_, _replay2.default);
        _ol_render_canvas_TextReplay_.measureTextWidths = function(font, lines, widths) {
            var numLines = lines.length;
            var width = 0;
            var currentWidth, i;
            for (i = 0; i < numLines; ++i) {
                currentWidth = _canvas2.default.measureTextWidth(font, lines[i]);
                width = Math.max(width, currentWidth);
                widths.push(currentWidth);
            }
            return width;
        };
        _ol_render_canvas_TextReplay_.prototype.drawText = function(geometry, feature) {
            var fillState = this.textFillState_;
            var strokeState = this.textStrokeState_;
            var textState = this.textState_;
            if (this.text_ === "" || !textState || !fillState && !strokeState) {
                return;
            }
            var begin = this.coordinates.length;
            var geometryType = geometry.getType();
            var flatCoordinates = null;
            var end = 2;
            var stride = 2;
            var i, ii;
            if (textState.placement === _textplacement2.default.LINE) {
                if (!_extent2.default.intersects(this.getBufferedMaxExtent(), geometry.getExtent())) {
                    return;
                }
                var ends;
                flatCoordinates = geometry.getFlatCoordinates();
                stride = geometry.getStride();
                if (geometryType == _geometrytype2.default.LINE_STRING) {
                    ends = [ flatCoordinates.length ];
                } else if (geometryType == _geometrytype2.default.MULTI_LINE_STRING) {
                    ends = geometry.getEnds();
                } else if (geometryType == _geometrytype2.default.POLYGON) {
                    ends = geometry.getEnds().slice(0, 1);
                } else if (geometryType == _geometrytype2.default.MULTI_POLYGON) {
                    var endss = geometry.getEndss();
                    ends = [];
                    for (i = 0, ii = endss.length; i < ii; ++i) {
                        ends.push(endss[i][0]);
                    }
                }
                this.beginGeometry(geometry, feature);
                var textAlign = textState.textAlign;
                var flatOffset = 0;
                var flatEnd;
                for (var o = 0, oo = ends.length; o < oo; ++o) {
                    if (textAlign == undefined) {
                        var range = _straightchunk2.default.lineString(textState.maxAngle, flatCoordinates, flatOffset, ends[o], stride);
                        flatOffset = range[0];
                        flatEnd = range[1];
                    } else {
                        flatEnd = ends[o];
                    }
                    for (i = flatOffset; i < flatEnd; i += stride) {
                        this.coordinates.push(flatCoordinates[i], flatCoordinates[i + 1]);
                    }
                    end = this.coordinates.length;
                    flatOffset = ends[o];
                    this.drawChars_(begin, end, this.declutterGroup_);
                    begin = end;
                }
                this.endGeometry(geometry, feature);
            } else {
                var label = this.getImage(this.text_, this.textKey_, this.fillKey_, this.strokeKey_);
                var width = label.width / this.pixelRatio;
                switch (geometryType) {
                  case _geometrytype2.default.POINT:
                  case _geometrytype2.default.MULTI_POINT:
                    flatCoordinates = geometry.getFlatCoordinates();
                    end = flatCoordinates.length;
                    break;

                  case _geometrytype2.default.LINE_STRING:
                    flatCoordinates = geometry.getFlatMidpoint();
                    break;

                  case _geometrytype2.default.CIRCLE:
                    flatCoordinates = geometry.getCenter();
                    break;

                  case _geometrytype2.default.MULTI_LINE_STRING:
                    flatCoordinates = geometry.getFlatMidpoints();
                    end = flatCoordinates.length;
                    break;

                  case _geometrytype2.default.POLYGON:
                    flatCoordinates = geometry.getFlatInteriorPoint();
                    if (!textState.overflow && flatCoordinates[2] / this.resolution < width) {
                        return;
                    }
                    stride = 3;
                    break;

                  case _geometrytype2.default.MULTI_POLYGON:
                    var interiorPoints = geometry.getFlatInteriorPoints();
                    flatCoordinates = [];
                    for (i = 0, ii = interiorPoints.length; i < ii; i += 3) {
                        if (textState.overflow || interiorPoints[i + 2] / this.resolution >= width) {
                            flatCoordinates.push(interiorPoints[i], interiorPoints[i + 1]);
                        }
                    }
                    end = flatCoordinates.length;
                    if (end == 0) {
                        return;
                    }
                    break;

                  default:
                }
                end = this.appendFlatCoordinates(flatCoordinates, 0, end, stride, false, false);
                this.beginGeometry(geometry, feature);
                if (textState.backgroundFill || textState.backgroundStroke) {
                    this.setFillStrokeStyle(textState.backgroundFill, textState.backgroundStroke);
                    this.updateFillStyle(this.state, this.applyFill, geometry);
                    this.updateStrokeStyle(this.state, this.applyStroke);
                }
                this.drawTextImage_(label, begin, end);
                this.endGeometry(geometry, feature);
            }
        };
        _ol_render_canvas_TextReplay_.prototype.getImage = function(text, textKey, fillKey, strokeKey) {
            var label;
            var key = strokeKey + textKey + text + fillKey + this.pixelRatio;
            var labelCache = _canvas2.default.labelCache;
            if (!labelCache.containsKey(key)) {
                var strokeState = strokeKey ? this.strokeStates[strokeKey] || this.textStrokeState_ : null;
                var fillState = fillKey ? this.fillStates[fillKey] || this.textFillState_ : null;
                var textState = this.textStates[textKey] || this.textState_;
                var pixelRatio = this.pixelRatio;
                var scale = textState.scale * pixelRatio;
                var align = _replay4.default.TEXT_ALIGN[textState.textAlign || _canvas2.default.defaultTextAlign];
                var strokeWidth = strokeKey && strokeState.lineWidth ? strokeState.lineWidth : 0;
                var lines = text.split("\n");
                var numLines = lines.length;
                var widths = [];
                var width = _ol_render_canvas_TextReplay_.measureTextWidths(textState.font, lines, widths);
                var lineHeight = _canvas2.default.measureTextHeight(textState.font);
                var height = lineHeight * numLines;
                var renderWidth = width + strokeWidth;
                var context = _dom2.default.createCanvasContext2D(Math.ceil(renderWidth * scale), Math.ceil((height + strokeWidth) * scale));
                label = context.canvas;
                labelCache.set(key, label);
                if (scale != 1) {
                    context.scale(scale, scale);
                }
                context.font = textState.font;
                if (strokeKey) {
                    context.strokeStyle = strokeState.strokeStyle;
                    context.lineWidth = strokeWidth * (_has2.default.SAFARI ? scale : 1);
                    context.lineCap = strokeState.lineCap;
                    context.lineJoin = strokeState.lineJoin;
                    context.miterLimit = strokeState.miterLimit;
                    if (_has2.default.CANVAS_LINE_DASH && strokeState.lineDash.length) {
                        context.setLineDash(strokeState.lineDash);
                        context.lineDashOffset = strokeState.lineDashOffset;
                    }
                }
                if (fillKey) {
                    context.fillStyle = fillState.fillStyle;
                }
                context.textBaseline = "middle";
                context.textAlign = "center";
                var leftRight = .5 - align;
                var x = align * label.width / scale + leftRight * strokeWidth;
                var i;
                if (strokeKey) {
                    for (i = 0; i < numLines; ++i) {
                        context.strokeText(lines[i], x + leftRight * widths[i], .5 * (strokeWidth + lineHeight) + i * lineHeight);
                    }
                }
                if (fillKey) {
                    for (i = 0; i < numLines; ++i) {
                        context.fillText(lines[i], x + leftRight * widths[i], .5 * (strokeWidth + lineHeight) + i * lineHeight);
                    }
                }
            }
            return labelCache.get(key);
        };
        _ol_render_canvas_TextReplay_.prototype.drawTextImage_ = function(label, begin, end) {
            var textState = this.textState_;
            var strokeState = this.textStrokeState_;
            var pixelRatio = this.pixelRatio;
            var align = _replay4.default.TEXT_ALIGN[textState.textAlign || _canvas2.default.defaultTextAlign];
            var baseline = _replay4.default.TEXT_ALIGN[textState.textBaseline];
            var strokeWidth = strokeState && strokeState.lineWidth ? strokeState.lineWidth : 0;
            var anchorX = align * label.width / pixelRatio + 2 * (.5 - align) * strokeWidth;
            var anchorY = baseline * label.height / pixelRatio + 2 * (.5 - baseline) * strokeWidth;
            this.instructions.push([ _instruction2.default.DRAW_IMAGE, begin, end, label, (anchorX - this.textOffsetX_) * pixelRatio, (anchorY - this.textOffsetY_) * pixelRatio, this.declutterGroup_, label.height, 1, 0, 0, this.textRotateWithView_, this.textRotation_, 1, true, label.width, textState.padding == _canvas2.default.defaultPadding ? _canvas2.default.defaultPadding : textState.padding.map(function(p) {
                return p * pixelRatio;
            }), !!textState.backgroundFill, !!textState.backgroundStroke ]);
            this.hitDetectionInstructions.push([ _instruction2.default.DRAW_IMAGE, begin, end, label, (anchorX - this.textOffsetX_) * pixelRatio, (anchorY - this.textOffsetY_) * pixelRatio, this.declutterGroup_, label.height, 1, 0, 0, this.textRotateWithView_, this.textRotation_, 1 / pixelRatio, true, label.width, textState.padding, !!textState.backgroundFill, !!textState.backgroundStroke ]);
        };
        _ol_render_canvas_TextReplay_.prototype.drawChars_ = function(begin, end, declutterGroup) {
            var strokeState = this.textStrokeState_;
            var textState = this.textState_;
            var fillState = this.textFillState_;
            var strokeKey = this.strokeKey_;
            if (strokeState) {
                if (!(strokeKey in this.strokeStates)) {
                    this.strokeStates[strokeKey] = {
                        strokeStyle: strokeState.strokeStyle,
                        lineCap: strokeState.lineCap,
                        lineDashOffset: strokeState.lineDashOffset,
                        lineWidth: strokeState.lineWidth,
                        lineJoin: strokeState.lineJoin,
                        miterLimit: strokeState.miterLimit,
                        lineDash: strokeState.lineDash
                    };
                }
            }
            var textKey = this.textKey_;
            if (!(this.textKey_ in this.textStates)) {
                this.textStates[this.textKey_] = {
                    font: textState.font,
                    textAlign: textState.textAlign || _canvas2.default.defaultTextAlign,
                    scale: textState.scale
                };
            }
            var fillKey = this.fillKey_;
            if (fillState) {
                if (!(fillKey in this.fillStates)) {
                    this.fillStates[fillKey] = {
                        fillStyle: fillState.fillStyle
                    };
                }
            }
            var pixelRatio = this.pixelRatio;
            var baseline = _replay4.default.TEXT_ALIGN[textState.textBaseline];
            var offsetY = this.textOffsetY_ * pixelRatio;
            var text = this.text_;
            var font = textState.font;
            var textScale = textState.scale;
            var strokeWidth = strokeState ? strokeState.lineWidth * textScale / 2 : 0;
            var widths = this.widths_[font];
            if (!widths) {
                this.widths_[font] = widths = {};
            }
            this.instructions.push([ _instruction2.default.DRAW_CHARS, begin, end, baseline, declutterGroup, textState.overflow, fillKey, textState.maxAngle, function(text) {
                var width = widths[text];
                if (!width) {
                    width = widths[text] = _canvas2.default.measureTextWidth(font, text);
                }
                return width * textScale * pixelRatio;
            }, offsetY, strokeKey, strokeWidth * pixelRatio, text, textKey, 1 ]);
            this.hitDetectionInstructions.push([ _instruction2.default.DRAW_CHARS, begin, end, baseline, declutterGroup, textState.overflow, fillKey, textState.maxAngle, function(text) {
                var width = widths[text];
                if (!width) {
                    width = widths[text] = _canvas2.default.measureTextWidth(font, text);
                }
                return width * textScale;
            }, offsetY, strokeKey, strokeWidth, text, textKey, 1 / pixelRatio ]);
        };
        _ol_render_canvas_TextReplay_.prototype.setTextStyle = function(textStyle, declutterGroup) {
            var textState, fillState, strokeState;
            if (!textStyle) {
                this.text_ = "";
            } else {
                this.declutterGroup_ = declutterGroup;
                var textFillStyle = textStyle.getFill();
                if (!textFillStyle) {
                    fillState = this.textFillState_ = null;
                } else {
                    fillState = this.textFillState_;
                    if (!fillState) {
                        fillState = this.textFillState_ = {};
                    }
                    fillState.fillStyle = _colorlike2.default.asColorLike(textFillStyle.getColor() || _canvas2.default.defaultFillStyle);
                }
                var textStrokeStyle = textStyle.getStroke();
                if (!textStrokeStyle) {
                    strokeState = this.textStrokeState_ = null;
                } else {
                    strokeState = this.textStrokeState_;
                    if (!strokeState) {
                        strokeState = this.textStrokeState_ = {};
                    }
                    var lineDash = textStrokeStyle.getLineDash();
                    var lineDashOffset = textStrokeStyle.getLineDashOffset();
                    var lineWidth = textStrokeStyle.getWidth();
                    var miterLimit = textStrokeStyle.getMiterLimit();
                    strokeState.lineCap = textStrokeStyle.getLineCap() || _canvas2.default.defaultLineCap;
                    strokeState.lineDash = lineDash ? lineDash.slice() : _canvas2.default.defaultLineDash;
                    strokeState.lineDashOffset = lineDashOffset === undefined ? _canvas2.default.defaultLineDashOffset : lineDashOffset;
                    strokeState.lineJoin = textStrokeStyle.getLineJoin() || _canvas2.default.defaultLineJoin;
                    strokeState.lineWidth = lineWidth === undefined ? _canvas2.default.defaultLineWidth : lineWidth;
                    strokeState.miterLimit = miterLimit === undefined ? _canvas2.default.defaultMiterLimit : miterLimit;
                    strokeState.strokeStyle = _colorlike2.default.asColorLike(textStrokeStyle.getColor() || _canvas2.default.defaultStrokeStyle);
                }
                textState = this.textState_;
                var font = textStyle.getFont() || _canvas2.default.defaultFont;
                _canvas2.default.checkFont(font);
                var textScale = textStyle.getScale();
                textState.overflow = textStyle.getOverflow();
                textState.font = font;
                textState.maxAngle = textStyle.getMaxAngle();
                textState.placement = textStyle.getPlacement();
                textState.textAlign = textStyle.getTextAlign();
                textState.textBaseline = textStyle.getTextBaseline() || _canvas2.default.defaultTextBaseline;
                textState.backgroundFill = textStyle.getBackgroundFill();
                textState.backgroundStroke = textStyle.getBackgroundStroke();
                textState.padding = textStyle.getPadding() || _canvas2.default.defaultPadding;
                textState.scale = textScale === undefined ? 1 : textScale;
                var textOffsetX = textStyle.getOffsetX();
                var textOffsetY = textStyle.getOffsetY();
                var textRotateWithView = textStyle.getRotateWithView();
                var textRotation = textStyle.getRotation();
                this.text_ = textStyle.getText() || "";
                this.textOffsetX_ = textOffsetX === undefined ? 0 : textOffsetX;
                this.textOffsetY_ = textOffsetY === undefined ? 0 : textOffsetY;
                this.textRotateWithView_ = textRotateWithView === undefined ? false : textRotateWithView;
                this.textRotation_ = textRotation === undefined ? 0 : textRotation;
                this.strokeKey_ = strokeState ? (typeof strokeState.strokeStyle == "string" ? strokeState.strokeStyle : _index2.default.getUid(strokeState.strokeStyle)) + strokeState.lineCap + strokeState.lineDashOffset + "|" + strokeState.lineWidth + strokeState.lineJoin + strokeState.miterLimit + "[" + strokeState.lineDash.join() + "]" : "";
                this.textKey_ = textState.font + textState.scale + (textState.textAlign || "?");
                this.fillKey_ = fillState ? typeof fillState.fillStyle == "string" ? fillState.fillStyle : "|" + _index2.default.getUid(fillState.fillStyle) : "";
            }
        };
        exports.default = _ol_render_canvas_TextReplay_;
    }, {
        "../../colorlike.js": 37,
        "../../dom.js": 46,
        "../../extent.js": 54,
        "../../geom/flat/straightchunk.js": 73,
        "../../geom/geometrytype.js": 79,
        "../../has.js": 84,
        "../../index.js": 89,
        "../../style/textplacement.js": 236,
        "../canvas.js": 150,
        "../canvas/instruction.js": 153,
        "../canvas/replay.js": 156,
        "../replay.js": 161
    } ],
    159: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _event = require("../events/event.js");
        var _event2 = _interopRequireDefault(_event);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_Event_ = function(type, opt_vectorContext, opt_frameState, opt_context, opt_glContext) {
            _event2.default.call(this, type);
            this.vectorContext = opt_vectorContext;
            this.frameState = opt_frameState;
            this.context = opt_context;
            this.glContext = opt_glContext;
        };
        _index2.default.inherits(_ol_render_Event_, _event2.default);
        exports.default = _ol_render_Event_;
    }, {
        "../events/event.js": 50,
        "../index.js": 89
    } ],
    160: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_render_EventType_ = {
            POSTCOMPOSE: "postcompose",
            PRECOMPOSE: "precompose",
            RENDER: "render"
        };
        exports.default = _ol_render_EventType_;
    }, {} ],
    161: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _replaytype = require("../render/replaytype.js");
        var _replaytype2 = _interopRequireDefault(_replaytype);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_replay_ = {};
        _ol_render_replay_.ORDER = [ _replaytype2.default.POLYGON, _replaytype2.default.CIRCLE, _replaytype2.default.LINE_STRING, _replaytype2.default.IMAGE, _replaytype2.default.TEXT, _replaytype2.default.DEFAULT ];
        _ol_render_replay_.TEXT_ALIGN = {};
        _ol_render_replay_.TEXT_ALIGN["left"] = 0;
        _ol_render_replay_.TEXT_ALIGN["end"] = 0;
        _ol_render_replay_.TEXT_ALIGN["center"] = .5;
        _ol_render_replay_.TEXT_ALIGN["right"] = 1;
        _ol_render_replay_.TEXT_ALIGN["start"] = 1;
        _ol_render_replay_.TEXT_ALIGN["top"] = 0;
        _ol_render_replay_.TEXT_ALIGN["middle"] = .5;
        _ol_render_replay_.TEXT_ALIGN["hanging"] = .2;
        _ol_render_replay_.TEXT_ALIGN["alphabetic"] = .8;
        _ol_render_replay_.TEXT_ALIGN["ideographic"] = .8;
        _ol_render_replay_.TEXT_ALIGN["bottom"] = 1;
        exports.default = _ol_render_replay_;
    }, {
        "../render/replaytype.js": 163
    } ],
    162: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_render_ReplayGroup_ = function() {};
        _ol_render_ReplayGroup_.prototype.getReplay = function(zIndex, replayType) {};
        _ol_render_ReplayGroup_.prototype.isEmpty = function() {};
        exports.default = _ol_render_ReplayGroup_;
    }, {} ],
    163: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_render_ReplayType_ = {
            CIRCLE: "Circle",
            DEFAULT: "Default",
            IMAGE: "Image",
            LINE_STRING: "LineString",
            POLYGON: "Polygon",
            TEXT: "Text"
        };
        exports.default = _ol_render_ReplayType_;
    }, {} ],
    164: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_render_VectorContext_ = function() {};
        _ol_render_VectorContext_.prototype.drawCustom = function(geometry, feature, renderer) {};
        _ol_render_VectorContext_.prototype.drawGeometry = function(geometry) {};
        _ol_render_VectorContext_.prototype.setStyle = function(style) {};
        _ol_render_VectorContext_.prototype.drawCircle = function(circleGeometry, feature) {};
        _ol_render_VectorContext_.prototype.drawFeature = function(feature, style) {};
        _ol_render_VectorContext_.prototype.drawGeometryCollection = function(geometryCollectionGeometry, feature) {};
        _ol_render_VectorContext_.prototype.drawLineString = function(lineStringGeometry, feature) {};
        _ol_render_VectorContext_.prototype.drawMultiLineString = function(multiLineStringGeometry, feature) {};
        _ol_render_VectorContext_.prototype.drawMultiPoint = function(multiPointGeometry, feature) {};
        _ol_render_VectorContext_.prototype.drawMultiPolygon = function(multiPolygonGeometry, feature) {};
        _ol_render_VectorContext_.prototype.drawPoint = function(pointGeometry, feature) {};
        _ol_render_VectorContext_.prototype.drawPolygon = function(polygonGeometry, feature) {};
        _ol_render_VectorContext_.prototype.drawText = function(geometry, feature) {};
        _ol_render_VectorContext_.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {};
        _ol_render_VectorContext_.prototype.setImageStyle = function(imageStyle, opt_declutterGroup) {};
        _ol_render_VectorContext_.prototype.setTextStyle = function(textStyle, opt_declutterGroup) {};
        exports.default = _ol_render_VectorContext_;
    }, {} ],
    165: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_render_webgl_ = {};
        _ol_render_webgl_.defaultFont = "10px sans-serif";
        _ol_render_webgl_.defaultFillStyle = [ 0, 0, 0, 1 ];
        _ol_render_webgl_.defaultLineCap = "round";
        _ol_render_webgl_.defaultLineDash = [];
        _ol_render_webgl_.defaultLineDashOffset = 0;
        _ol_render_webgl_.defaultLineJoin = "round";
        _ol_render_webgl_.defaultMiterLimit = 10;
        _ol_render_webgl_.defaultStrokeStyle = [ 0, 0, 0, 1 ];
        _ol_render_webgl_.defaultTextAlign = .5;
        _ol_render_webgl_.defaultTextBaseline = .5;
        _ol_render_webgl_.defaultLineWidth = 1;
        _ol_render_webgl_.triangleIsCounterClockwise = function(x1, y1, x2, y2, x3, y3) {
            var area = (x2 - x1) * (y3 - y1) - (x3 - x1) * (y2 - y1);
            return area <= _ol_render_webgl_.EPSILON && area >= -_ol_render_webgl_.EPSILON ? undefined : area > 0;
        };
        _ol_render_webgl_.EPSILON = Number.EPSILON || 2220446049250313e-31;
        exports.default = _ol_render_webgl_;
    }, {} ],
    166: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _color = require("../../color.js");
        var _color2 = _interopRequireDefault(_color);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _obj = require("../../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _transform = require("../../geom/flat/transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _defaultshader = require("../webgl/circlereplay/defaultshader.js");
        var _defaultshader2 = _interopRequireDefault(_defaultshader);
        var _locations = require("../webgl/circlereplay/defaultshader/locations.js");
        var _locations2 = _interopRequireDefault(_locations);
        var _replay = require("../webgl/replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        var _webgl = require("../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _webgl3 = require("../../webgl.js");
        var _webgl4 = _interopRequireDefault(_webgl3);
        var _buffer = require("../../webgl/buffer.js");
        var _buffer2 = _interopRequireDefault(_buffer);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_CircleReplay_ = function(tolerance, maxExtent) {
            _replay2.default.call(this, tolerance, maxExtent);
            this.defaultLocations_ = null;
            this.styles_ = [];
            this.styleIndices_ = [];
            this.radius_ = 0;
            this.state_ = {
                fillColor: null,
                strokeColor: null,
                lineDash: null,
                lineDashOffset: undefined,
                lineWidth: undefined,
                changed: false
            };
        };
        _index2.default.inherits(_ol_render_webgl_CircleReplay_, _replay2.default);
        _ol_render_webgl_CircleReplay_.prototype.drawCoordinates_ = function(flatCoordinates, offset, end, stride) {
            var numVertices = this.vertices.length;
            var numIndices = this.indices.length;
            var n = numVertices / 4;
            var i, ii;
            for (i = offset, ii = end; i < ii; i += stride) {
                this.vertices[numVertices++] = flatCoordinates[i];
                this.vertices[numVertices++] = flatCoordinates[i + 1];
                this.vertices[numVertices++] = 0;
                this.vertices[numVertices++] = this.radius_;
                this.vertices[numVertices++] = flatCoordinates[i];
                this.vertices[numVertices++] = flatCoordinates[i + 1];
                this.vertices[numVertices++] = 1;
                this.vertices[numVertices++] = this.radius_;
                this.vertices[numVertices++] = flatCoordinates[i];
                this.vertices[numVertices++] = flatCoordinates[i + 1];
                this.vertices[numVertices++] = 2;
                this.vertices[numVertices++] = this.radius_;
                this.vertices[numVertices++] = flatCoordinates[i];
                this.vertices[numVertices++] = flatCoordinates[i + 1];
                this.vertices[numVertices++] = 3;
                this.vertices[numVertices++] = this.radius_;
                this.indices[numIndices++] = n;
                this.indices[numIndices++] = n + 1;
                this.indices[numIndices++] = n + 2;
                this.indices[numIndices++] = n + 2;
                this.indices[numIndices++] = n + 3;
                this.indices[numIndices++] = n;
                n += 4;
            }
        };
        _ol_render_webgl_CircleReplay_.prototype.drawCircle = function(circleGeometry, feature) {
            var radius = circleGeometry.getRadius();
            var stride = circleGeometry.getStride();
            if (radius) {
                this.startIndices.push(this.indices.length);
                this.startIndicesFeature.push(feature);
                if (this.state_.changed) {
                    this.styleIndices_.push(this.indices.length);
                    this.state_.changed = false;
                }
                this.radius_ = radius;
                var flatCoordinates = circleGeometry.getFlatCoordinates();
                flatCoordinates = _transform2.default.translate(flatCoordinates, 0, 2, stride, -this.origin[0], -this.origin[1]);
                this.drawCoordinates_(flatCoordinates, 0, 2, stride);
            } else {
                if (this.state_.changed) {
                    this.styles_.pop();
                    if (this.styles_.length) {
                        var lastState = this.styles_[this.styles_.length - 1];
                        this.state_.fillColor = lastState[0];
                        this.state_.strokeColor = lastState[1];
                        this.state_.lineWidth = lastState[2];
                        this.state_.changed = false;
                    }
                }
            }
        };
        _ol_render_webgl_CircleReplay_.prototype.finish = function(context) {
            this.verticesBuffer = new _buffer2.default(this.vertices);
            this.indicesBuffer = new _buffer2.default(this.indices);
            this.startIndices.push(this.indices.length);
            if (this.styleIndices_.length === 0 && this.styles_.length > 0) {
                this.styles_ = [];
            }
            this.vertices = null;
            this.indices = null;
        };
        _ol_render_webgl_CircleReplay_.prototype.getDeleteResourcesFunction = function(context) {
            var verticesBuffer = this.verticesBuffer;
            var indicesBuffer = this.indicesBuffer;
            return function() {
                context.deleteBuffer(verticesBuffer);
                context.deleteBuffer(indicesBuffer);
            };
        };
        _ol_render_webgl_CircleReplay_.prototype.setUpProgram = function(gl, context, size, pixelRatio) {
            var fragmentShader, vertexShader;
            fragmentShader = _defaultshader2.default.fragment;
            vertexShader = _defaultshader2.default.vertex;
            var program = context.getProgram(fragmentShader, vertexShader);
            var locations;
            if (!this.defaultLocations_) {
                locations = new _locations2.default(gl, program);
                this.defaultLocations_ = locations;
            } else {
                locations = this.defaultLocations_;
            }
            context.useProgram(program);
            gl.enableVertexAttribArray(locations.a_position);
            gl.vertexAttribPointer(locations.a_position, 2, _webgl4.default.FLOAT, false, 16, 0);
            gl.enableVertexAttribArray(locations.a_instruction);
            gl.vertexAttribPointer(locations.a_instruction, 1, _webgl4.default.FLOAT, false, 16, 8);
            gl.enableVertexAttribArray(locations.a_radius);
            gl.vertexAttribPointer(locations.a_radius, 1, _webgl4.default.FLOAT, false, 16, 12);
            gl.uniform2fv(locations.u_size, size);
            gl.uniform1f(locations.u_pixelRatio, pixelRatio);
            return locations;
        };
        _ol_render_webgl_CircleReplay_.prototype.shutDownProgram = function(gl, locations) {
            gl.disableVertexAttribArray(locations.a_position);
            gl.disableVertexAttribArray(locations.a_instruction);
            gl.disableVertexAttribArray(locations.a_radius);
        };
        _ol_render_webgl_CircleReplay_.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {
            if (!_obj2.default.isEmpty(skippedFeaturesHash)) {
                this.drawReplaySkipping_(gl, context, skippedFeaturesHash);
            } else {
                var i, start, end, nextStyle;
                end = this.startIndices[this.startIndices.length - 1];
                for (i = this.styleIndices_.length - 1; i >= 0; --i) {
                    start = this.styleIndices_[i];
                    nextStyle = this.styles_[i];
                    this.setFillStyle_(gl, nextStyle[0]);
                    this.setStrokeStyle_(gl, nextStyle[1], nextStyle[2]);
                    this.drawElements(gl, context, start, end);
                    end = start;
                }
            }
        };
        _ol_render_webgl_CircleReplay_.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {
            var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;
            featureIndex = this.startIndices.length - 2;
            end = this.startIndices[featureIndex + 1];
            for (i = this.styleIndices_.length - 1; i >= 0; --i) {
                nextStyle = this.styles_[i];
                this.setFillStyle_(gl, nextStyle[0]);
                this.setStrokeStyle_(gl, nextStyle[1], nextStyle[2]);
                groupStart = this.styleIndices_[i];
                while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {
                    start = this.startIndices[featureIndex];
                    feature = this.startIndicesFeature[featureIndex];
                    featureUid = _index2.default.getUid(feature).toString();
                    if (skippedFeaturesHash[featureUid] === undefined && feature.getGeometry() && (opt_hitExtent === undefined || _extent2.default.intersects(opt_hitExtent, feature.getGeometry().getExtent()))) {
                        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
                        this.drawElements(gl, context, start, end);
                        var result = featureCallback(feature);
                        if (result) {
                            return result;
                        }
                    }
                    featureIndex--;
                    end = start;
                }
            }
            return undefined;
        };
        _ol_render_webgl_CircleReplay_.prototype.drawReplaySkipping_ = function(gl, context, skippedFeaturesHash) {
            var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;
            featureIndex = this.startIndices.length - 2;
            end = start = this.startIndices[featureIndex + 1];
            for (i = this.styleIndices_.length - 1; i >= 0; --i) {
                nextStyle = this.styles_[i];
                this.setFillStyle_(gl, nextStyle[0]);
                this.setStrokeStyle_(gl, nextStyle[1], nextStyle[2]);
                groupStart = this.styleIndices_[i];
                while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {
                    featureStart = this.startIndices[featureIndex];
                    feature = this.startIndicesFeature[featureIndex];
                    featureUid = _index2.default.getUid(feature).toString();
                    if (skippedFeaturesHash[featureUid]) {
                        if (start !== end) {
                            this.drawElements(gl, context, start, end);
                        }
                        end = featureStart;
                    }
                    featureIndex--;
                    start = featureStart;
                }
                if (start !== end) {
                    this.drawElements(gl, context, start, end);
                }
                start = end = groupStart;
            }
        };
        _ol_render_webgl_CircleReplay_.prototype.setFillStyle_ = function(gl, color) {
            gl.uniform4fv(this.defaultLocations_.u_fillColor, color);
        };
        _ol_render_webgl_CircleReplay_.prototype.setStrokeStyle_ = function(gl, color, lineWidth) {
            gl.uniform4fv(this.defaultLocations_.u_strokeColor, color);
            gl.uniform1f(this.defaultLocations_.u_lineWidth, lineWidth);
        };
        _ol_render_webgl_CircleReplay_.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {
            var strokeStyleColor, strokeStyleWidth;
            if (strokeStyle) {
                var strokeStyleLineDash = strokeStyle.getLineDash();
                this.state_.lineDash = strokeStyleLineDash ? strokeStyleLineDash : _webgl2.default.defaultLineDash;
                var strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();
                this.state_.lineDashOffset = strokeStyleLineDashOffset ? strokeStyleLineDashOffset : _webgl2.default.defaultLineDashOffset;
                strokeStyleColor = strokeStyle.getColor();
                if (!(strokeStyleColor instanceof CanvasGradient) && !(strokeStyleColor instanceof CanvasPattern)) {
                    strokeStyleColor = _color2.default.asArray(strokeStyleColor).map(function(c, i) {
                        return i != 3 ? c / 255 : c;
                    }) || _webgl2.default.defaultStrokeStyle;
                } else {
                    strokeStyleColor = _webgl2.default.defaultStrokeStyle;
                }
                strokeStyleWidth = strokeStyle.getWidth();
                strokeStyleWidth = strokeStyleWidth !== undefined ? strokeStyleWidth : _webgl2.default.defaultLineWidth;
            } else {
                strokeStyleColor = [ 0, 0, 0, 0 ];
                strokeStyleWidth = 0;
            }
            var fillStyleColor = fillStyle ? fillStyle.getColor() : [ 0, 0, 0, 0 ];
            if (!(fillStyleColor instanceof CanvasGradient) && !(fillStyleColor instanceof CanvasPattern)) {
                fillStyleColor = _color2.default.asArray(fillStyleColor).map(function(c, i) {
                    return i != 3 ? c / 255 : c;
                }) || _webgl2.default.defaultFillStyle;
            } else {
                fillStyleColor = _webgl2.default.defaultFillStyle;
            }
            if (!this.state_.strokeColor || !_array2.default.equals(this.state_.strokeColor, strokeStyleColor) || !this.state_.fillColor || !_array2.default.equals(this.state_.fillColor, fillStyleColor) || this.state_.lineWidth !== strokeStyleWidth) {
                this.state_.changed = true;
                this.state_.fillColor = fillStyleColor;
                this.state_.strokeColor = strokeStyleColor;
                this.state_.lineWidth = strokeStyleWidth;
                this.styles_.push([ fillStyleColor, strokeStyleColor, strokeStyleWidth ]);
            }
        };
        exports.default = _ol_render_webgl_CircleReplay_;
    }, {
        "../../array.js": 29,
        "../../color.js": 36,
        "../../extent.js": 54,
        "../../geom/flat/transform.js": 76,
        "../../index.js": 89,
        "../../obj.js": 124,
        "../../webgl.js": 248,
        "../../webgl/buffer.js": 249,
        "../webgl.js": 165,
        "../webgl/circlereplay/defaultshader.js": 167,
        "../webgl/circlereplay/defaultshader/locations.js": 168,
        "../webgl/replay.js": 177
    } ],
    167: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _fragment = require("../../../webgl/fragment.js");
        var _fragment2 = _interopRequireDefault(_fragment);
        var _vertex = require("../../../webgl/vertex.js");
        var _vertex2 = _interopRequireDefault(_vertex);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_circlereplay_defaultshader_ = {};
        _ol_render_webgl_circlereplay_defaultshader_.fragment = new _fragment2.default(_index2.default.DEBUG_WEBGL ? "precision mediump float;\nvarying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_fillColor;\nuniform vec4 u_strokeColor;\nuniform vec2 u_size;\n\nvoid main(void) {\n  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  float radius = length(windowCenter - windowOffset);\n  float dist = length(windowCenter - gl_FragCoord.xy);\n  if (dist > radius + v_halfWidth) {\n    if (u_strokeColor.a == 0.0) {\n      gl_FragColor = u_fillColor;\n    } else {\n      gl_FragColor = u_strokeColor;\n    }\n    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));\n  } else if (u_fillColor.a == 0.0) {\n    // Hooray, no fill, just stroke. We can use real antialiasing.\n    gl_FragColor = u_strokeColor;\n    if (dist < radius - v_halfWidth) {\n      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);\n    }\n  } else {\n    gl_FragColor = u_fillColor;\n    float strokeDist = radius - v_halfWidth;\n    float antialias = 2.0 * v_pixelRatio;\n    if (dist > strokeDist) {\n      gl_FragColor = u_strokeColor;\n    } else if (dist >= strokeDist - antialias) {\n      float step = smoothstep(strokeDist - antialias, strokeDist, dist);\n      gl_FragColor = mix(u_fillColor, u_strokeColor, step);\n    }\n  }\n  gl_FragColor.a = gl_FragColor.a * u_opacity;\n  if (gl_FragColor.a <= 0.0) {\n    discard;\n  }\n}\n" : "precision mediump float;varying vec2 a;varying vec2 b;varying float c;varying float d;uniform float m;uniform vec4 n;uniform vec4 o;uniform vec2 p;void main(void){vec2 windowCenter=vec2((a.x+1.0)/2.0*p.x*d,(a.y+1.0)/2.0*p.y*d);vec2 windowOffset=vec2((b.x+1.0)/2.0*p.x*d,(b.y+1.0)/2.0*p.y*d);float radius=length(windowCenter-windowOffset);float dist=length(windowCenter-gl_FragCoord.xy);if(dist>radius+c){if(o.a==0.0){gl_FragColor=n;}else{gl_FragColor=o;}gl_FragColor.a=gl_FragColor.a-(dist-(radius+c));}else if(n.a==0.0){gl_FragColor=o;if(dist<radius-c){gl_FragColor.a=gl_FragColor.a-(radius-c-dist);}} else{gl_FragColor=n;float strokeDist=radius-c;float antialias=2.0*d;if(dist>strokeDist){gl_FragColor=o;}else if(dist>=strokeDist-antialias){float step=smoothstep(strokeDist-antialias,strokeDist,dist);gl_FragColor=mix(n,o,step);}} gl_FragColor.a=gl_FragColor.a*m;if(gl_FragColor.a<=0.0){discard;}}");
        _ol_render_webgl_circlereplay_defaultshader_.vertex = new _vertex2.default(_index2.default.DEBUG_WEBGL ? "varying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\nattribute vec2 a_position;\nattribute float a_instruction;\nattribute float a_radius;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;\n  v_pixelRatio = u_pixelRatio;\n  float lineWidth = u_lineWidth * u_pixelRatio;\n  v_halfWidth = lineWidth / 2.0;\n  if (lineWidth == 0.0) {\n    lineWidth = 2.0 * u_pixelRatio;\n  }\n  vec2 offset;\n  // Radius with anitaliasing (roughly).\n  float radius = a_radius + 3.0 * u_pixelRatio;\n  // Until we get gl_VertexID in WebGL, we store an instruction.\n  if (a_instruction == 0.0) {\n    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however\n    // we should also leave some space for the antialiasing, thus we offset by lineWidth.\n    offset = vec2(-1.0, 1.0);\n  } else if (a_instruction == 1.0) {\n    offset = vec2(-1.0, -1.0);\n  } else if (a_instruction == 2.0) {\n    offset = vec2(1.0, -1.0);\n  } else {\n    offset = vec2(1.0, 1.0);\n  }\n\n  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +\n      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);\n  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,\n      0.0, 1.0)).xy;\n\n  if (distance(v_center, v_offset) > 20000.0) {\n    gl_Position = vec4(v_center, 0.0, 1.0);\n  }\n}\n\n\n" : "varying vec2 a;varying vec2 b;varying float c;varying float d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;void main(void){mat4 offsetMatrix=i*j;a=vec4(h*vec4(e,0.0,1.0)).xy;d=l;float lineWidth=k*l;c=lineWidth/2.0;if(lineWidth==0.0){lineWidth=2.0*l;}vec2 offset;float radius=g+3.0*l;//Until we get gl_VertexID in WebGL,we store an instruction.if(f==0.0){//Offsetting the edges of the triangle by lineWidth/2 is necessary,however//we should also leave some space for the antialiasing,thus we offset by lineWidth.offset=vec2(-1.0,1.0);}else if(f==1.0){offset=vec2(-1.0,-1.0);}else if(f==2.0){offset=vec2(1.0,-1.0);}else{offset=vec2(1.0,1.0);}gl_Position=h*vec4(e+offset*radius,0.0,1.0)+offsetMatrix*vec4(offset*lineWidth,0.0,0.0);b=vec4(h*vec4(e.x+g,e.y,0.0,1.0)).xy;if(distance(a,b)>20000.0){gl_Position=vec4(a,0.0,1.0);}}");
        exports.default = _ol_render_webgl_circlereplay_defaultshader_;
    }, {
        "../../../index.js": 89,
        "../../../webgl/fragment.js": 252,
        "../../../webgl/vertex.js": 254
    } ],
    168: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../../../index.js");
        var _index2 = _interopRequireDefault(_index);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_circlereplay_defaultshader_Locations_ = function(gl, program) {
            this.u_projectionMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_projectionMatrix" : "h");
            this.u_offsetScaleMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_offsetScaleMatrix" : "i");
            this.u_offsetRotateMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_offsetRotateMatrix" : "j");
            this.u_lineWidth = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_lineWidth" : "k");
            this.u_pixelRatio = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_pixelRatio" : "l");
            this.u_opacity = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_opacity" : "m");
            this.u_fillColor = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_fillColor" : "n");
            this.u_strokeColor = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_strokeColor" : "o");
            this.u_size = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_size" : "p");
            this.a_position = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_position" : "e");
            this.a_instruction = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_instruction" : "f");
            this.a_radius = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_radius" : "g");
        };
        exports.default = _ol_render_webgl_circlereplay_defaultshader_Locations_;
    }, {
        "../../../../index.js": 89
    } ],
    169: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _texturereplay = require("../webgl/texturereplay.js");
        var _texturereplay2 = _interopRequireDefault(_texturereplay);
        var _buffer = require("../../webgl/buffer.js");
        var _buffer2 = _interopRequireDefault(_buffer);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_ImageReplay_ = function(tolerance, maxExtent) {
            _texturereplay2.default.call(this, tolerance, maxExtent);
            this.images_ = [];
            this.hitDetectionImages_ = [];
            this.textures_ = [];
            this.hitDetectionTextures_ = [];
        };
        _index2.default.inherits(_ol_render_webgl_ImageReplay_, _texturereplay2.default);
        _ol_render_webgl_ImageReplay_.prototype.drawMultiPoint = function(multiPointGeometry, feature) {
            this.startIndices.push(this.indices.length);
            this.startIndicesFeature.push(feature);
            var flatCoordinates = multiPointGeometry.getFlatCoordinates();
            var stride = multiPointGeometry.getStride();
            this.drawCoordinates(flatCoordinates, 0, flatCoordinates.length, stride);
        };
        _ol_render_webgl_ImageReplay_.prototype.drawPoint = function(pointGeometry, feature) {
            this.startIndices.push(this.indices.length);
            this.startIndicesFeature.push(feature);
            var flatCoordinates = pointGeometry.getFlatCoordinates();
            var stride = pointGeometry.getStride();
            this.drawCoordinates(flatCoordinates, 0, flatCoordinates.length, stride);
        };
        _ol_render_webgl_ImageReplay_.prototype.finish = function(context) {
            var gl = context.getGL();
            this.groupIndices.push(this.indices.length);
            this.hitDetectionGroupIndices.push(this.indices.length);
            this.verticesBuffer = new _buffer2.default(this.vertices);
            var indices = this.indices;
            this.indicesBuffer = new _buffer2.default(indices);
            var texturePerImage = {};
            this.createTextures(this.textures_, this.images_, texturePerImage, gl);
            this.createTextures(this.hitDetectionTextures_, this.hitDetectionImages_, texturePerImage, gl);
            this.images_ = null;
            this.hitDetectionImages_ = null;
            _texturereplay2.default.prototype.finish.call(this, context);
        };
        _ol_render_webgl_ImageReplay_.prototype.setImageStyle = function(imageStyle) {
            var anchor = imageStyle.getAnchor();
            var image = imageStyle.getImage(1);
            var imageSize = imageStyle.getImageSize();
            var hitDetectionImage = imageStyle.getHitDetectionImage(1);
            var opacity = imageStyle.getOpacity();
            var origin = imageStyle.getOrigin();
            var rotateWithView = imageStyle.getRotateWithView();
            var rotation = imageStyle.getRotation();
            var size = imageStyle.getSize();
            var scale = imageStyle.getScale();
            var currentImage;
            if (this.images_.length === 0) {
                this.images_.push(image);
            } else {
                currentImage = this.images_[this.images_.length - 1];
                if (_index2.default.getUid(currentImage) != _index2.default.getUid(image)) {
                    this.groupIndices.push(this.indices.length);
                    this.images_.push(image);
                }
            }
            if (this.hitDetectionImages_.length === 0) {
                this.hitDetectionImages_.push(hitDetectionImage);
            } else {
                currentImage = this.hitDetectionImages_[this.hitDetectionImages_.length - 1];
                if (_index2.default.getUid(currentImage) != _index2.default.getUid(hitDetectionImage)) {
                    this.hitDetectionGroupIndices.push(this.indices.length);
                    this.hitDetectionImages_.push(hitDetectionImage);
                }
            }
            this.anchorX = anchor[0];
            this.anchorY = anchor[1];
            this.height = size[1];
            this.imageHeight = imageSize[1];
            this.imageWidth = imageSize[0];
            this.opacity = opacity;
            this.originX = origin[0];
            this.originY = origin[1];
            this.rotation = rotation;
            this.rotateWithView = rotateWithView;
            this.scale = scale;
            this.width = size[0];
        };
        _ol_render_webgl_ImageReplay_.prototype.getTextures = function(opt_all) {
            return opt_all ? this.textures_.concat(this.hitDetectionTextures_) : this.textures_;
        };
        _ol_render_webgl_ImageReplay_.prototype.getHitDetectionTextures = function() {
            return this.hitDetectionTextures_;
        };
        exports.default = _ol_render_webgl_ImageReplay_;
    }, {
        "../../index.js": 89,
        "../../webgl/buffer.js": 249,
        "../webgl/texturereplay.js": 180
    } ],
    170: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _geometrytype = require("../../geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _replaytype = require("../replaytype.js");
        var _replaytype2 = _interopRequireDefault(_replaytype);
        var _vectorcontext = require("../vectorcontext.js");
        var _vectorcontext2 = _interopRequireDefault(_vectorcontext);
        var _replaygroup = require("../webgl/replaygroup.js");
        var _replaygroup2 = _interopRequireDefault(_replaygroup);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_Immediate_ = function(context, center, resolution, rotation, size, extent, pixelRatio) {
            _vectorcontext2.default.call(this);
            this.context_ = context;
            this.center_ = center;
            this.extent_ = extent;
            this.pixelRatio_ = pixelRatio;
            this.size_ = size;
            this.rotation_ = rotation;
            this.resolution_ = resolution;
            this.imageStyle_ = null;
            this.fillStyle_ = null;
            this.strokeStyle_ = null;
            this.textStyle_ = null;
        };
        _index2.default.inherits(_ol_render_webgl_Immediate_, _vectorcontext2.default);
        _ol_render_webgl_Immediate_.prototype.drawText_ = function(replayGroup, geometry) {
            var context = this.context_;
            var replay = replayGroup.getReplay(0, _replaytype2.default.TEXT);
            replay.setTextStyle(this.textStyle_);
            replay.drawText(geometry, null);
            replay.finish(context);
            var opacity = 1;
            var skippedFeatures = {};
            var featureCallback;
            var oneByOne = false;
            replay.replay(this.context_, this.center_, this.resolution_, this.rotation_, this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback, oneByOne);
            replay.getDeleteResourcesFunction(context)();
        };
        _ol_render_webgl_Immediate_.prototype.setStyle = function(style) {
            this.setFillStrokeStyle(style.getFill(), style.getStroke());
            this.setImageStyle(style.getImage());
            this.setTextStyle(style.getText());
        };
        _ol_render_webgl_Immediate_.prototype.drawGeometry = function(geometry) {
            var type = geometry.getType();
            switch (type) {
              case _geometrytype2.default.POINT:
                this.drawPoint(geometry, null);
                break;

              case _geometrytype2.default.LINE_STRING:
                this.drawLineString(geometry, null);
                break;

              case _geometrytype2.default.POLYGON:
                this.drawPolygon(geometry, null);
                break;

              case _geometrytype2.default.MULTI_POINT:
                this.drawMultiPoint(geometry, null);
                break;

              case _geometrytype2.default.MULTI_LINE_STRING:
                this.drawMultiLineString(geometry, null);
                break;

              case _geometrytype2.default.MULTI_POLYGON:
                this.drawMultiPolygon(geometry, null);
                break;

              case _geometrytype2.default.GEOMETRY_COLLECTION:
                this.drawGeometryCollection(geometry, null);
                break;

              case _geometrytype2.default.CIRCLE:
                this.drawCircle(geometry, null);
                break;

              default:
            }
        };
        _ol_render_webgl_Immediate_.prototype.drawFeature = function(feature, style) {
            var geometry = style.getGeometryFunction()(feature);
            if (!geometry || !_extent2.default.intersects(this.extent_, geometry.getExtent())) {
                return;
            }
            this.setStyle(style);
            this.drawGeometry(geometry);
        };
        _ol_render_webgl_Immediate_.prototype.drawGeometryCollection = function(geometry, data) {
            var geometries = geometry.getGeometriesArray();
            var i, ii;
            for (i = 0, ii = geometries.length; i < ii; ++i) {
                this.drawGeometry(geometries[i]);
            }
        };
        _ol_render_webgl_Immediate_.prototype.drawPoint = function(geometry, data) {
            var context = this.context_;
            var replayGroup = new _replaygroup2.default(1, this.extent_);
            var replay = replayGroup.getReplay(0, _replaytype2.default.IMAGE);
            replay.setImageStyle(this.imageStyle_);
            replay.drawPoint(geometry, data);
            replay.finish(context);
            var opacity = 1;
            var skippedFeatures = {};
            var featureCallback;
            var oneByOne = false;
            replay.replay(this.context_, this.center_, this.resolution_, this.rotation_, this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback, oneByOne);
            replay.getDeleteResourcesFunction(context)();
            if (this.textStyle_) {
                this.drawText_(replayGroup, geometry);
            }
        };
        _ol_render_webgl_Immediate_.prototype.drawMultiPoint = function(geometry, data) {
            var context = this.context_;
            var replayGroup = new _replaygroup2.default(1, this.extent_);
            var replay = replayGroup.getReplay(0, _replaytype2.default.IMAGE);
            replay.setImageStyle(this.imageStyle_);
            replay.drawMultiPoint(geometry, data);
            replay.finish(context);
            var opacity = 1;
            var skippedFeatures = {};
            var featureCallback;
            var oneByOne = false;
            replay.replay(this.context_, this.center_, this.resolution_, this.rotation_, this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback, oneByOne);
            replay.getDeleteResourcesFunction(context)();
            if (this.textStyle_) {
                this.drawText_(replayGroup, geometry);
            }
        };
        _ol_render_webgl_Immediate_.prototype.drawLineString = function(geometry, data) {
            var context = this.context_;
            var replayGroup = new _replaygroup2.default(1, this.extent_);
            var replay = replayGroup.getReplay(0, _replaytype2.default.LINE_STRING);
            replay.setFillStrokeStyle(null, this.strokeStyle_);
            replay.drawLineString(geometry, data);
            replay.finish(context);
            var opacity = 1;
            var skippedFeatures = {};
            var featureCallback;
            var oneByOne = false;
            replay.replay(this.context_, this.center_, this.resolution_, this.rotation_, this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback, oneByOne);
            replay.getDeleteResourcesFunction(context)();
            if (this.textStyle_) {
                this.drawText_(replayGroup, geometry);
            }
        };
        _ol_render_webgl_Immediate_.prototype.drawMultiLineString = function(geometry, data) {
            var context = this.context_;
            var replayGroup = new _replaygroup2.default(1, this.extent_);
            var replay = replayGroup.getReplay(0, _replaytype2.default.LINE_STRING);
            replay.setFillStrokeStyle(null, this.strokeStyle_);
            replay.drawMultiLineString(geometry, data);
            replay.finish(context);
            var opacity = 1;
            var skippedFeatures = {};
            var featureCallback;
            var oneByOne = false;
            replay.replay(this.context_, this.center_, this.resolution_, this.rotation_, this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback, oneByOne);
            replay.getDeleteResourcesFunction(context)();
            if (this.textStyle_) {
                this.drawText_(replayGroup, geometry);
            }
        };
        _ol_render_webgl_Immediate_.prototype.drawPolygon = function(geometry, data) {
            var context = this.context_;
            var replayGroup = new _replaygroup2.default(1, this.extent_);
            var replay = replayGroup.getReplay(0, _replaytype2.default.POLYGON);
            replay.setFillStrokeStyle(this.fillStyle_, this.strokeStyle_);
            replay.drawPolygon(geometry, data);
            replay.finish(context);
            var opacity = 1;
            var skippedFeatures = {};
            var featureCallback;
            var oneByOne = false;
            replay.replay(this.context_, this.center_, this.resolution_, this.rotation_, this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback, oneByOne);
            replay.getDeleteResourcesFunction(context)();
            if (this.textStyle_) {
                this.drawText_(replayGroup, geometry);
            }
        };
        _ol_render_webgl_Immediate_.prototype.drawMultiPolygon = function(geometry, data) {
            var context = this.context_;
            var replayGroup = new _replaygroup2.default(1, this.extent_);
            var replay = replayGroup.getReplay(0, _replaytype2.default.POLYGON);
            replay.setFillStrokeStyle(this.fillStyle_, this.strokeStyle_);
            replay.drawMultiPolygon(geometry, data);
            replay.finish(context);
            var opacity = 1;
            var skippedFeatures = {};
            var featureCallback;
            var oneByOne = false;
            replay.replay(this.context_, this.center_, this.resolution_, this.rotation_, this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback, oneByOne);
            replay.getDeleteResourcesFunction(context)();
            if (this.textStyle_) {
                this.drawText_(replayGroup, geometry);
            }
        };
        _ol_render_webgl_Immediate_.prototype.drawCircle = function(geometry, data) {
            var context = this.context_;
            var replayGroup = new _replaygroup2.default(1, this.extent_);
            var replay = replayGroup.getReplay(0, _replaytype2.default.CIRCLE);
            replay.setFillStrokeStyle(this.fillStyle_, this.strokeStyle_);
            replay.drawCircle(geometry, data);
            replay.finish(context);
            var opacity = 1;
            var skippedFeatures = {};
            var featureCallback;
            var oneByOne = false;
            replay.replay(this.context_, this.center_, this.resolution_, this.rotation_, this.size_, this.pixelRatio_, opacity, skippedFeatures, featureCallback, oneByOne);
            replay.getDeleteResourcesFunction(context)();
            if (this.textStyle_) {
                this.drawText_(replayGroup, geometry);
            }
        };
        _ol_render_webgl_Immediate_.prototype.setImageStyle = function(imageStyle) {
            this.imageStyle_ = imageStyle;
        };
        _ol_render_webgl_Immediate_.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {
            this.fillStyle_ = fillStyle;
            this.strokeStyle_ = strokeStyle;
        };
        _ol_render_webgl_Immediate_.prototype.setTextStyle = function(textStyle) {
            this.textStyle_ = textStyle;
        };
        exports.default = _ol_render_webgl_Immediate_;
    }, {
        "../../extent.js": 54,
        "../../geom/geometrytype.js": 79,
        "../../index.js": 89,
        "../replaytype.js": 163,
        "../vectorcontext.js": 164,
        "../webgl/replaygroup.js": 178
    } ],
    171: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _color = require("../../color.js");
        var _color2 = _interopRequireDefault(_color);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _orient = require("../../geom/flat/orient.js");
        var _orient2 = _interopRequireDefault(_orient);
        var _transform = require("../../geom/flat/transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _topology = require("../../geom/flat/topology.js");
        var _topology2 = _interopRequireDefault(_topology);
        var _obj = require("../../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _webgl = require("../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _replay = require("../webgl/replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        var _defaultshader = require("../webgl/linestringreplay/defaultshader.js");
        var _defaultshader2 = _interopRequireDefault(_defaultshader);
        var _locations = require("../webgl/linestringreplay/defaultshader/locations.js");
        var _locations2 = _interopRequireDefault(_locations);
        var _webgl3 = require("../../webgl.js");
        var _webgl4 = _interopRequireDefault(_webgl3);
        var _buffer = require("../../webgl/buffer.js");
        var _buffer2 = _interopRequireDefault(_buffer);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_LineStringReplay_ = function(tolerance, maxExtent) {
            _replay2.default.call(this, tolerance, maxExtent);
            this.defaultLocations_ = null;
            this.styles_ = [];
            this.styleIndices_ = [];
            this.state_ = {
                strokeColor: null,
                lineCap: undefined,
                lineDash: null,
                lineDashOffset: undefined,
                lineJoin: undefined,
                lineWidth: undefined,
                miterLimit: undefined,
                changed: false
            };
        };
        _index2.default.inherits(_ol_render_webgl_LineStringReplay_, _replay2.default);
        _ol_render_webgl_LineStringReplay_.prototype.drawCoordinates_ = function(flatCoordinates, offset, end, stride) {
            var i, ii;
            var numVertices = this.vertices.length;
            var numIndices = this.indices.length;
            var lineJoin = this.state_.lineJoin === "bevel" ? 0 : this.state_.lineJoin === "miter" ? 1 : 2;
            var lineCap = this.state_.lineCap === "butt" ? 0 : this.state_.lineCap === "square" ? 1 : 2;
            var closed = _topology2.default.lineStringIsClosed(flatCoordinates, offset, end, stride);
            var startCoords, sign, n;
            var lastIndex = numIndices;
            var lastSign = 1;
            var p0, p1, p2;
            for (i = offset, ii = end; i < ii; i += stride) {
                n = numVertices / 7;
                p0 = p1;
                p1 = p2 || [ flatCoordinates[i], flatCoordinates[i + 1] ];
                if (i === offset) {
                    p2 = [ flatCoordinates[i + stride], flatCoordinates[i + stride + 1] ];
                    if (end - offset === stride * 2 && _array2.default.equals(p1, p2)) {
                        break;
                    }
                    if (closed) {
                        p0 = [ flatCoordinates[end - stride * 2], flatCoordinates[end - stride * 2 + 1] ];
                        startCoords = p2;
                    } else {
                        if (lineCap) {
                            numVertices = this.addVertices_([ 0, 0 ], p1, p2, lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE_CAP * lineCap, numVertices);
                            numVertices = this.addVertices_([ 0, 0 ], p1, p2, -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE_CAP * lineCap, numVertices);
                            this.indices[numIndices++] = n + 2;
                            this.indices[numIndices++] = n;
                            this.indices[numIndices++] = n + 1;
                            this.indices[numIndices++] = n + 1;
                            this.indices[numIndices++] = n + 3;
                            this.indices[numIndices++] = n + 2;
                        }
                        numVertices = this.addVertices_([ 0, 0 ], p1, p2, lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE * (lineCap || 1), numVertices);
                        numVertices = this.addVertices_([ 0, 0 ], p1, p2, -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE * (lineCap || 1), numVertices);
                        lastIndex = numVertices / 7 - 1;
                        continue;
                    }
                } else if (i === end - stride) {
                    if (closed) {
                        p2 = startCoords;
                        break;
                    } else {
                        p0 = p0 || [ 0, 0 ];
                        numVertices = this.addVertices_(p0, p1, [ 0, 0 ], lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE * (lineCap || 1), numVertices);
                        numVertices = this.addVertices_(p0, p1, [ 0, 0 ], -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE * (lineCap || 1), numVertices);
                        this.indices[numIndices++] = n;
                        this.indices[numIndices++] = lastIndex - 1;
                        this.indices[numIndices++] = lastIndex;
                        this.indices[numIndices++] = lastIndex;
                        this.indices[numIndices++] = n + 1;
                        this.indices[numIndices++] = n;
                        if (lineCap) {
                            numVertices = this.addVertices_(p0, p1, [ 0, 0 ], lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE_CAP * lineCap, numVertices);
                            numVertices = this.addVertices_(p0, p1, [ 0, 0 ], -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE_CAP * lineCap, numVertices);
                            this.indices[numIndices++] = n + 2;
                            this.indices[numIndices++] = n;
                            this.indices[numIndices++] = n + 1;
                            this.indices[numIndices++] = n + 1;
                            this.indices[numIndices++] = n + 3;
                            this.indices[numIndices++] = n + 2;
                        }
                        break;
                    }
                } else {
                    p2 = [ flatCoordinates[i + stride], flatCoordinates[i + stride + 1] ];
                }
                sign = _webgl2.default.triangleIsCounterClockwise(p0[0], p0[1], p1[0], p1[1], p2[0], p2[1]) ? -1 : 1;
                numVertices = this.addVertices_(p0, p1, p2, sign * _ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_FIRST * (lineJoin || 1), numVertices);
                numVertices = this.addVertices_(p0, p1, p2, sign * _ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_SECOND * (lineJoin || 1), numVertices);
                numVertices = this.addVertices_(p0, p1, p2, -sign * _ol_render_webgl_LineStringReplay_.Instruction_.MITER_BOTTOM * (lineJoin || 1), numVertices);
                if (i > offset) {
                    this.indices[numIndices++] = n;
                    this.indices[numIndices++] = lastIndex - 1;
                    this.indices[numIndices++] = lastIndex;
                    this.indices[numIndices++] = n + 2;
                    this.indices[numIndices++] = n;
                    this.indices[numIndices++] = lastSign * sign > 0 ? lastIndex : lastIndex - 1;
                }
                this.indices[numIndices++] = n;
                this.indices[numIndices++] = n + 2;
                this.indices[numIndices++] = n + 1;
                lastIndex = n + 2;
                lastSign = sign;
                if (lineJoin) {
                    numVertices = this.addVertices_(p0, p1, p2, sign * _ol_render_webgl_LineStringReplay_.Instruction_.MITER_TOP * lineJoin, numVertices);
                    this.indices[numIndices++] = n + 1;
                    this.indices[numIndices++] = n + 3;
                    this.indices[numIndices++] = n;
                }
            }
            if (closed) {
                n = n || numVertices / 7;
                sign = _orient2.default.linearRingIsClockwise([ p0[0], p0[1], p1[0], p1[1], p2[0], p2[1] ], 0, 6, 2) ? 1 : -1;
                numVertices = this.addVertices_(p0, p1, p2, sign * _ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_FIRST * (lineJoin || 1), numVertices);
                numVertices = this.addVertices_(p0, p1, p2, -sign * _ol_render_webgl_LineStringReplay_.Instruction_.MITER_BOTTOM * (lineJoin || 1), numVertices);
                this.indices[numIndices++] = n;
                this.indices[numIndices++] = lastIndex - 1;
                this.indices[numIndices++] = lastIndex;
                this.indices[numIndices++] = n + 1;
                this.indices[numIndices++] = n;
                this.indices[numIndices++] = lastSign * sign > 0 ? lastIndex : lastIndex - 1;
            }
        };
        _ol_render_webgl_LineStringReplay_.prototype.addVertices_ = function(p0, p1, p2, product, numVertices) {
            this.vertices[numVertices++] = p0[0];
            this.vertices[numVertices++] = p0[1];
            this.vertices[numVertices++] = p1[0];
            this.vertices[numVertices++] = p1[1];
            this.vertices[numVertices++] = p2[0];
            this.vertices[numVertices++] = p2[1];
            this.vertices[numVertices++] = product;
            return numVertices;
        };
        _ol_render_webgl_LineStringReplay_.prototype.isValid_ = function(flatCoordinates, offset, end, stride) {
            var range = end - offset;
            if (range < stride * 2) {
                return false;
            } else if (range === stride * 2) {
                var firstP = [ flatCoordinates[offset], flatCoordinates[offset + 1] ];
                var lastP = [ flatCoordinates[offset + stride], flatCoordinates[offset + stride + 1] ];
                return !_array2.default.equals(firstP, lastP);
            }
            return true;
        };
        _ol_render_webgl_LineStringReplay_.prototype.drawLineString = function(lineStringGeometry, feature) {
            var flatCoordinates = lineStringGeometry.getFlatCoordinates();
            var stride = lineStringGeometry.getStride();
            if (this.isValid_(flatCoordinates, 0, flatCoordinates.length, stride)) {
                flatCoordinates = _transform2.default.translate(flatCoordinates, 0, flatCoordinates.length, stride, -this.origin[0], -this.origin[1]);
                if (this.state_.changed) {
                    this.styleIndices_.push(this.indices.length);
                    this.state_.changed = false;
                }
                this.startIndices.push(this.indices.length);
                this.startIndicesFeature.push(feature);
                this.drawCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);
            }
        };
        _ol_render_webgl_LineStringReplay_.prototype.drawMultiLineString = function(multiLineStringGeometry, feature) {
            var indexCount = this.indices.length;
            var ends = multiLineStringGeometry.getEnds();
            ends.unshift(0);
            var flatCoordinates = multiLineStringGeometry.getFlatCoordinates();
            var stride = multiLineStringGeometry.getStride();
            var i, ii;
            if (ends.length > 1) {
                for (i = 1, ii = ends.length; i < ii; ++i) {
                    if (this.isValid_(flatCoordinates, ends[i - 1], ends[i], stride)) {
                        var lineString = _transform2.default.translate(flatCoordinates, ends[i - 1], ends[i], stride, -this.origin[0], -this.origin[1]);
                        this.drawCoordinates_(lineString, 0, lineString.length, stride);
                    }
                }
            }
            if (this.indices.length > indexCount) {
                this.startIndices.push(indexCount);
                this.startIndicesFeature.push(feature);
                if (this.state_.changed) {
                    this.styleIndices_.push(indexCount);
                    this.state_.changed = false;
                }
            }
        };
        _ol_render_webgl_LineStringReplay_.prototype.drawPolygonCoordinates = function(flatCoordinates, holeFlatCoordinates, stride) {
            if (!_topology2.default.lineStringIsClosed(flatCoordinates, 0, flatCoordinates.length, stride)) {
                flatCoordinates.push(flatCoordinates[0]);
                flatCoordinates.push(flatCoordinates[1]);
            }
            this.drawCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);
            if (holeFlatCoordinates.length) {
                var i, ii;
                for (i = 0, ii = holeFlatCoordinates.length; i < ii; ++i) {
                    if (!_topology2.default.lineStringIsClosed(holeFlatCoordinates[i], 0, holeFlatCoordinates[i].length, stride)) {
                        holeFlatCoordinates[i].push(holeFlatCoordinates[i][0]);
                        holeFlatCoordinates[i].push(holeFlatCoordinates[i][1]);
                    }
                    this.drawCoordinates_(holeFlatCoordinates[i], 0, holeFlatCoordinates[i].length, stride);
                }
            }
        };
        _ol_render_webgl_LineStringReplay_.prototype.setPolygonStyle = function(feature, opt_index) {
            var index = opt_index === undefined ? this.indices.length : opt_index;
            this.startIndices.push(index);
            this.startIndicesFeature.push(feature);
            if (this.state_.changed) {
                this.styleIndices_.push(index);
                this.state_.changed = false;
            }
        };
        _ol_render_webgl_LineStringReplay_.prototype.getCurrentIndex = function() {
            return this.indices.length;
        };
        _ol_render_webgl_LineStringReplay_.prototype.finish = function(context) {
            this.verticesBuffer = new _buffer2.default(this.vertices);
            this.indicesBuffer = new _buffer2.default(this.indices);
            this.startIndices.push(this.indices.length);
            if (this.styleIndices_.length === 0 && this.styles_.length > 0) {
                this.styles_ = [];
            }
            this.vertices = null;
            this.indices = null;
        };
        _ol_render_webgl_LineStringReplay_.prototype.getDeleteResourcesFunction = function(context) {
            var verticesBuffer = this.verticesBuffer;
            var indicesBuffer = this.indicesBuffer;
            return function() {
                context.deleteBuffer(verticesBuffer);
                context.deleteBuffer(indicesBuffer);
            };
        };
        _ol_render_webgl_LineStringReplay_.prototype.setUpProgram = function(gl, context, size, pixelRatio) {
            var fragmentShader, vertexShader;
            fragmentShader = _defaultshader2.default.fragment;
            vertexShader = _defaultshader2.default.vertex;
            var program = context.getProgram(fragmentShader, vertexShader);
            var locations;
            if (!this.defaultLocations_) {
                locations = new _locations2.default(gl, program);
                this.defaultLocations_ = locations;
            } else {
                locations = this.defaultLocations_;
            }
            context.useProgram(program);
            gl.enableVertexAttribArray(locations.a_lastPos);
            gl.vertexAttribPointer(locations.a_lastPos, 2, _webgl4.default.FLOAT, false, 28, 0);
            gl.enableVertexAttribArray(locations.a_position);
            gl.vertexAttribPointer(locations.a_position, 2, _webgl4.default.FLOAT, false, 28, 8);
            gl.enableVertexAttribArray(locations.a_nextPos);
            gl.vertexAttribPointer(locations.a_nextPos, 2, _webgl4.default.FLOAT, false, 28, 16);
            gl.enableVertexAttribArray(locations.a_direction);
            gl.vertexAttribPointer(locations.a_direction, 1, _webgl4.default.FLOAT, false, 28, 24);
            gl.uniform2fv(locations.u_size, size);
            gl.uniform1f(locations.u_pixelRatio, pixelRatio);
            return locations;
        };
        _ol_render_webgl_LineStringReplay_.prototype.shutDownProgram = function(gl, locations) {
            gl.disableVertexAttribArray(locations.a_lastPos);
            gl.disableVertexAttribArray(locations.a_position);
            gl.disableVertexAttribArray(locations.a_nextPos);
            gl.disableVertexAttribArray(locations.a_direction);
        };
        _ol_render_webgl_LineStringReplay_.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {
            var tmpDepthFunc = gl.getParameter(gl.DEPTH_FUNC);
            var tmpDepthMask = gl.getParameter(gl.DEPTH_WRITEMASK);
            if (!hitDetection) {
                gl.enable(gl.DEPTH_TEST);
                gl.depthMask(true);
                gl.depthFunc(gl.NOTEQUAL);
            }
            if (!_obj2.default.isEmpty(skippedFeaturesHash)) {
                this.drawReplaySkipping_(gl, context, skippedFeaturesHash);
            } else {
                var i, start, end, nextStyle;
                end = this.startIndices[this.startIndices.length - 1];
                for (i = this.styleIndices_.length - 1; i >= 0; --i) {
                    start = this.styleIndices_[i];
                    nextStyle = this.styles_[i];
                    this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);
                    this.drawElements(gl, context, start, end);
                    gl.clear(gl.DEPTH_BUFFER_BIT);
                    end = start;
                }
            }
            if (!hitDetection) {
                gl.disable(gl.DEPTH_TEST);
                gl.clear(gl.DEPTH_BUFFER_BIT);
                gl.depthMask(tmpDepthMask);
                gl.depthFunc(tmpDepthFunc);
            }
        };
        _ol_render_webgl_LineStringReplay_.prototype.drawReplaySkipping_ = function(gl, context, skippedFeaturesHash) {
            var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;
            featureIndex = this.startIndices.length - 2;
            end = start = this.startIndices[featureIndex + 1];
            for (i = this.styleIndices_.length - 1; i >= 0; --i) {
                nextStyle = this.styles_[i];
                this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);
                groupStart = this.styleIndices_[i];
                while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {
                    featureStart = this.startIndices[featureIndex];
                    feature = this.startIndicesFeature[featureIndex];
                    featureUid = _index2.default.getUid(feature).toString();
                    if (skippedFeaturesHash[featureUid]) {
                        if (start !== end) {
                            this.drawElements(gl, context, start, end);
                            gl.clear(gl.DEPTH_BUFFER_BIT);
                        }
                        end = featureStart;
                    }
                    featureIndex--;
                    start = featureStart;
                }
                if (start !== end) {
                    this.drawElements(gl, context, start, end);
                    gl.clear(gl.DEPTH_BUFFER_BIT);
                }
                start = end = groupStart;
            }
        };
        _ol_render_webgl_LineStringReplay_.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {
            var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;
            featureIndex = this.startIndices.length - 2;
            end = this.startIndices[featureIndex + 1];
            for (i = this.styleIndices_.length - 1; i >= 0; --i) {
                nextStyle = this.styles_[i];
                this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);
                groupStart = this.styleIndices_[i];
                while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {
                    start = this.startIndices[featureIndex];
                    feature = this.startIndicesFeature[featureIndex];
                    featureUid = _index2.default.getUid(feature).toString();
                    if (skippedFeaturesHash[featureUid] === undefined && feature.getGeometry() && (opt_hitExtent === undefined || _extent2.default.intersects(opt_hitExtent, feature.getGeometry().getExtent()))) {
                        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
                        this.drawElements(gl, context, start, end);
                        var result = featureCallback(feature);
                        if (result) {
                            return result;
                        }
                    }
                    featureIndex--;
                    end = start;
                }
            }
            return undefined;
        };
        _ol_render_webgl_LineStringReplay_.prototype.setStrokeStyle_ = function(gl, color, lineWidth, miterLimit) {
            gl.uniform4fv(this.defaultLocations_.u_color, color);
            gl.uniform1f(this.defaultLocations_.u_lineWidth, lineWidth);
            gl.uniform1f(this.defaultLocations_.u_miterLimit, miterLimit);
        };
        _ol_render_webgl_LineStringReplay_.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {
            var strokeStyleLineCap = strokeStyle.getLineCap();
            this.state_.lineCap = strokeStyleLineCap !== undefined ? strokeStyleLineCap : _webgl2.default.defaultLineCap;
            var strokeStyleLineDash = strokeStyle.getLineDash();
            this.state_.lineDash = strokeStyleLineDash ? strokeStyleLineDash : _webgl2.default.defaultLineDash;
            var strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();
            this.state_.lineDashOffset = strokeStyleLineDashOffset ? strokeStyleLineDashOffset : _webgl2.default.defaultLineDashOffset;
            var strokeStyleLineJoin = strokeStyle.getLineJoin();
            this.state_.lineJoin = strokeStyleLineJoin !== undefined ? strokeStyleLineJoin : _webgl2.default.defaultLineJoin;
            var strokeStyleColor = strokeStyle.getColor();
            if (!(strokeStyleColor instanceof CanvasGradient) && !(strokeStyleColor instanceof CanvasPattern)) {
                strokeStyleColor = _color2.default.asArray(strokeStyleColor).map(function(c, i) {
                    return i != 3 ? c / 255 : c;
                }) || _webgl2.default.defaultStrokeStyle;
            } else {
                strokeStyleColor = _webgl2.default.defaultStrokeStyle;
            }
            var strokeStyleWidth = strokeStyle.getWidth();
            strokeStyleWidth = strokeStyleWidth !== undefined ? strokeStyleWidth : _webgl2.default.defaultLineWidth;
            var strokeStyleMiterLimit = strokeStyle.getMiterLimit();
            strokeStyleMiterLimit = strokeStyleMiterLimit !== undefined ? strokeStyleMiterLimit : _webgl2.default.defaultMiterLimit;
            if (!this.state_.strokeColor || !_array2.default.equals(this.state_.strokeColor, strokeStyleColor) || this.state_.lineWidth !== strokeStyleWidth || this.state_.miterLimit !== strokeStyleMiterLimit) {
                this.state_.changed = true;
                this.state_.strokeColor = strokeStyleColor;
                this.state_.lineWidth = strokeStyleWidth;
                this.state_.miterLimit = strokeStyleMiterLimit;
                this.styles_.push([ strokeStyleColor, strokeStyleWidth, strokeStyleMiterLimit ]);
            }
        };
        _ol_render_webgl_LineStringReplay_.Instruction_ = {
            ROUND: 2,
            BEGIN_LINE: 3,
            END_LINE: 5,
            BEGIN_LINE_CAP: 7,
            END_LINE_CAP: 11,
            BEVEL_FIRST: 13,
            BEVEL_SECOND: 17,
            MITER_BOTTOM: 19,
            MITER_TOP: 23
        };
        exports.default = _ol_render_webgl_LineStringReplay_;
    }, {
        "../../array.js": 29,
        "../../color.js": 36,
        "../../extent.js": 54,
        "../../geom/flat/orient.js": 69,
        "../../geom/flat/topology.js": 75,
        "../../geom/flat/transform.js": 76,
        "../../index.js": 89,
        "../../obj.js": 124,
        "../../webgl.js": 248,
        "../../webgl/buffer.js": 249,
        "../webgl.js": 165,
        "../webgl/linestringreplay/defaultshader.js": 172,
        "../webgl/linestringreplay/defaultshader/locations.js": 173,
        "../webgl/replay.js": 177
    } ],
    172: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _fragment = require("../../../webgl/fragment.js");
        var _fragment2 = _interopRequireDefault(_fragment);
        var _vertex = require("../../../webgl/vertex.js");
        var _vertex2 = _interopRequireDefault(_vertex);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_linestringreplay_defaultshader_ = {};
        _ol_render_webgl_linestringreplay_defaultshader_.fragment = new _fragment2.default(_index2.default.DEBUG_WEBGL ? "precision mediump float;\nvarying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_color;\nuniform vec2 u_size;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  if (v_round > 0.0) {\n    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,\n        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);\n    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {\n      discard;\n    }\n  }\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n" : "precision mediump float;varying float a;varying vec2 aVertex;varying float c;uniform float m;uniform vec4 n;uniform vec2 o;uniform float p;void main(void){if(a>0.0){vec2 windowCoords=vec2((aVertex.x+1.0)/2.0*o.x*p,(aVertex.y+1.0)/2.0*o.y*p);if(length(windowCoords-gl_FragCoord.xy)>c*p){discard;}} gl_FragColor=n;float alpha=n.a*m;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}");
        _ol_render_webgl_linestringreplay_defaultshader_.vertex = new _vertex2.default(_index2.default.DEBUG_WEBGL ? "varying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\nattribute vec2 a_lastPos;\nattribute vec2 a_position;\nattribute vec2 a_nextPos;\nattribute float a_direction;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_miterLimit;\n\nbool nearlyEquals(in float value, in float ref) {\n  float epsilon = 0.000000000001;\n  return value >= ref - epsilon && value <= ref + epsilon;\n}\n\nvoid alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {\n  vec2 dirVect = nextP - a_position;\n  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));\n  offset = u_lineWidth / 2.0 * normal * direction;\n}\n\nvoid miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {\n  float halfWidth = u_lineWidth / 2.0;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_nextPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n  offset = normal * direction * miterLength;\n  round = 0.0;\n  if (isRound) {\n    round = 1.0;\n  } else if (miterLength > u_miterLimit + u_lineWidth) {\n    offset = halfWidth * tmpNormal * direction;\n  }\n}\n\nbool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {\n  bool degenerate = false;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_lastPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  vec2 longOffset, shortOffset, longVertex;\n  vec4 shortProjVertex;\n  float halfWidth = u_lineWidth / 2.0;\n  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {\n    longOffset = tmpNormal * direction * halfWidth;\n    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_nextPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);\n  } else {\n    shortOffset = tmpNormal * direction * halfWidth;\n    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_lastPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);\n  }\n  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).\n  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);\n  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);\n  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);\n  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;\n  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;\n  float epsilon = 0.000000000001;\n  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {\n    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);\n    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);\n    offset = shortProjVertex.xy;\n    degenerate = true;\n  } else {\n    float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n    offset = normal * direction * miterLength;\n  }\n  return degenerate;\n}\n\nvoid squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,\n    in float turnDir, in float direction) {\n  round = 0.0;\n  vec2 dirVect = a_position - nextP;\n  vec2 firstNormal = normalize(dirVect);\n  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);\n  vec2 hypotenuse = normalize(firstNormal - secondNormal);\n  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);\n  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);\n  offset = normal * length;\n  if (isRound) {\n    round = 1.0;\n  }\n}\n\nvoid main(void) {\n  bool degenerate = false;\n  float direction = float(sign(a_direction));\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  vec2 offset;\n  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);\n\n  v_round = 0.0;\n  v_halfWidth = u_lineWidth / 2.0;\n  v_roundVertex = projPos.xy;\n\n  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {\n    alongNormal(offset, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {\n    alongNormal(offset, a_lastPos, -1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {\n    miterUp(offset, v_round, round, direction);\n  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {\n    degenerate = miterDown(offset, projPos, offsetMatrix, direction);\n  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {\n    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {\n    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);\n  }\n  if (!degenerate) {\n    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);\n    gl_Position = projPos + offsets;\n  } else {\n    gl_Position = vec4(offset, 0.0, 1.0);\n  }\n}\n\n\n" : "varying float a;varying vec2 aVertex;varying float c;attribute vec2 d;attribute vec2 e;attribute vec2 f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;bool nearlyEquals(in float value,in float ref){float epsilon=0.000000000001;return value>=ref-epsilon&&value<=ref+epsilon;}void alongNormal(out vec2 offset,in vec2 nextP,in float turnDir,in float direction){vec2 dirVect=nextP-e;vec2 normal=normalize(vec2(-turnDir*dirVect.y,turnDir*dirVect.x));offset=k/2.0*normal*direction;}void miterUp(out vec2 offset,out float round,in bool isRound,in float direction){float halfWidth=k/2.0;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=f-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;round=0.0;if(isRound){round=1.0;}else if(miterLength>l+k){offset=halfWidth*tmpNormal*direction;}} bool miterDown(out vec2 offset,in vec4 projPos,in mat4 offsetMatrix,in float direction){bool degenerate=false;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=d-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));vec2 longOffset,shortOffset,longVertex;vec4 shortProjVertex;float halfWidth=k/2.0;if(length(f-e)>length(d-e)){longOffset=tmpNormal*direction*halfWidth;shortOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=f;shortProjVertex=h*vec4(d,0.0,1.0);}else{shortOffset=tmpNormal*direction*halfWidth;longOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=d;shortProjVertex=h*vec4(f,0.0,1.0);}vec4 p1=h*vec4(longVertex,0.0,1.0)+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p2=projPos+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p3=shortProjVertex+offsetMatrix*vec4(-shortOffset,0.0,0.0);vec4 p4=shortProjVertex+offsetMatrix*vec4(shortOffset,0.0,0.0);float denom=(p4.y-p3.y)*(p2.x-p1.x)-(p4.x-p3.x)*(p2.y-p1.y);float firstU=((p4.x-p3.x)*(p1.y-p3.y)-(p4.y-p3.y)*(p1.x-p3.x))/denom;float secondU=((p2.x-p1.x)*(p1.y-p3.y)-(p2.y-p1.y)*(p1.x-p3.x))/denom;float epsilon=0.000000000001;if(firstU>epsilon&&firstU<1.0-epsilon&&secondU>epsilon&&secondU<1.0-epsilon){shortProjVertex.x=p1.x+firstU*(p2.x-p1.x);shortProjVertex.y=p1.y+firstU*(p2.y-p1.y);offset=shortProjVertex.xy;degenerate=true;}else{float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;}return degenerate;}void squareCap(out vec2 offset,out float round,in bool isRound,in vec2 nextP,in float turnDir,in float direction){round=0.0;vec2 dirVect=e-nextP;vec2 firstNormal=normalize(dirVect);vec2 secondNormal=vec2(turnDir*firstNormal.y*direction,-turnDir*firstNormal.x*direction);vec2 hypotenuse=normalize(firstNormal-secondNormal);vec2 normal=vec2(turnDir*hypotenuse.y*direction,-turnDir*hypotenuse.x*direction);float length=sqrt(c*c*2.0);offset=normal*length;if(isRound){round=1.0;}} void main(void){bool degenerate=false;float direction=float(sign(g));mat4 offsetMatrix=i*j;vec2 offset;vec4 projPos=h*vec4(e,0.0,1.0);bool round=nearlyEquals(mod(g,2.0),0.0);a=0.0;c=k/2.0;aVertex=projPos.xy;if(nearlyEquals(mod(g,3.0),0.0)||nearlyEquals(mod(g,17.0),0.0)){alongNormal(offset,f,1.0,direction);}else if(nearlyEquals(mod(g,5.0),0.0)||nearlyEquals(mod(g,13.0),0.0)){alongNormal(offset,d,-1.0,direction);}else if(nearlyEquals(mod(g,23.0),0.0)){miterUp(offset,a,round,direction);}else if(nearlyEquals(mod(g,19.0),0.0)){degenerate=miterDown(offset,projPos,offsetMatrix,direction);}else if(nearlyEquals(mod(g,7.0),0.0)){squareCap(offset,a,round,f,1.0,direction);}else if(nearlyEquals(mod(g,11.0),0.0)){squareCap(offset,a,round,d,-1.0,direction);}if(!degenerate){vec4 offsets=offsetMatrix*vec4(offset,0.0,0.0);gl_Position=projPos+offsets;}else{gl_Position=vec4(offset,0.0,1.0);}}");
        exports.default = _ol_render_webgl_linestringreplay_defaultshader_;
    }, {
        "../../../index.js": 89,
        "../../../webgl/fragment.js": 252,
        "../../../webgl/vertex.js": 254
    } ],
    173: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../../../index.js");
        var _index2 = _interopRequireDefault(_index);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_linestringreplay_defaultshader_Locations_ = function(gl, program) {
            this.u_projectionMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_projectionMatrix" : "h");
            this.u_offsetScaleMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_offsetScaleMatrix" : "i");
            this.u_offsetRotateMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_offsetRotateMatrix" : "j");
            this.u_lineWidth = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_lineWidth" : "k");
            this.u_miterLimit = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_miterLimit" : "l");
            this.u_opacity = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_opacity" : "m");
            this.u_color = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_color" : "n");
            this.u_size = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_size" : "o");
            this.u_pixelRatio = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_pixelRatio" : "p");
            this.a_lastPos = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_lastPos" : "d");
            this.a_position = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_position" : "e");
            this.a_nextPos = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_nextPos" : "f");
            this.a_direction = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_direction" : "g");
        };
        exports.default = _ol_render_webgl_linestringreplay_defaultshader_Locations_;
    }, {
        "../../../../index.js": 89
    } ],
    174: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _color = require("../../color.js");
        var _color2 = _interopRequireDefault(_color);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _obj = require("../../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _contains = require("../../geom/flat/contains.js");
        var _contains2 = _interopRequireDefault(_contains);
        var _orient = require("../../geom/flat/orient.js");
        var _orient2 = _interopRequireDefault(_orient);
        var _transform = require("../../geom/flat/transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _defaultshader = require("../webgl/polygonreplay/defaultshader.js");
        var _defaultshader2 = _interopRequireDefault(_defaultshader);
        var _locations = require("../webgl/polygonreplay/defaultshader/locations.js");
        var _locations2 = _interopRequireDefault(_locations);
        var _linestringreplay = require("../webgl/linestringreplay.js");
        var _linestringreplay2 = _interopRequireDefault(_linestringreplay);
        var _replay = require("../webgl/replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        var _webgl = require("../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _stroke = require("../../style/stroke.js");
        var _stroke2 = _interopRequireDefault(_stroke);
        var _linkedlist = require("../../structs/linkedlist.js");
        var _linkedlist2 = _interopRequireDefault(_linkedlist);
        var _rbush = require("../../structs/rbush.js");
        var _rbush2 = _interopRequireDefault(_rbush);
        var _webgl3 = require("../../webgl.js");
        var _webgl4 = _interopRequireDefault(_webgl3);
        var _buffer = require("../../webgl/buffer.js");
        var _buffer2 = _interopRequireDefault(_buffer);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_PolygonReplay_ = function(tolerance, maxExtent) {
            _replay2.default.call(this, tolerance, maxExtent);
            this.lineStringReplay = new _linestringreplay2.default(tolerance, maxExtent);
            this.defaultLocations_ = null;
            this.styles_ = [];
            this.styleIndices_ = [];
            this.state_ = {
                fillColor: null,
                changed: false
            };
        };
        _index2.default.inherits(_ol_render_webgl_PolygonReplay_, _replay2.default);
        _ol_render_webgl_PolygonReplay_.prototype.drawCoordinates_ = function(flatCoordinates, holeFlatCoordinates, stride) {
            var outerRing = new _linkedlist2.default();
            var rtree = new _rbush2.default();
            this.processFlatCoordinates_(flatCoordinates, stride, outerRing, rtree, true);
            var maxCoords = this.getMaxCoords_(outerRing);
            if (holeFlatCoordinates.length) {
                var i, ii;
                var holeLists = [];
                for (i = 0, ii = holeFlatCoordinates.length; i < ii; ++i) {
                    var holeList = {
                        list: new _linkedlist2.default(),
                        maxCoords: undefined,
                        rtree: new _rbush2.default()
                    };
                    holeLists.push(holeList);
                    this.processFlatCoordinates_(holeFlatCoordinates[i], stride, holeList.list, holeList.rtree, false);
                    this.classifyPoints_(holeList.list, holeList.rtree, true);
                    holeList.maxCoords = this.getMaxCoords_(holeList.list);
                }
                holeLists.sort(function(a, b) {
                    return b.maxCoords[0] === a.maxCoords[0] ? a.maxCoords[1] - b.maxCoords[1] : b.maxCoords[0] - a.maxCoords[0];
                });
                for (i = 0; i < holeLists.length; ++i) {
                    var currList = holeLists[i].list;
                    var start = currList.firstItem();
                    var currItem = start;
                    var intersection;
                    do {
                        if (this.getIntersections_(currItem, rtree).length) {
                            intersection = true;
                            break;
                        }
                        currItem = currList.nextItem();
                    } while (start !== currItem);
                    if (!intersection) {
                        if (this.bridgeHole_(currList, holeLists[i].maxCoords[0], outerRing, maxCoords[0], rtree)) {
                            rtree.concat(holeLists[i].rtree);
                            this.classifyPoints_(outerRing, rtree, false);
                        }
                    }
                }
            } else {
                this.classifyPoints_(outerRing, rtree, false);
            }
            this.triangulate_(outerRing, rtree);
        };
        _ol_render_webgl_PolygonReplay_.prototype.processFlatCoordinates_ = function(flatCoordinates, stride, list, rtree, clockwise) {
            var isClockwise = _orient2.default.linearRingIsClockwise(flatCoordinates, 0, flatCoordinates.length, stride);
            var i, ii;
            var n = this.vertices.length / 2;
            var start;
            var p0;
            var p1;
            var extents = [];
            var segments = [];
            if (clockwise === isClockwise) {
                start = this.createPoint_(flatCoordinates[0], flatCoordinates[1], n++);
                p0 = start;
                for (i = stride, ii = flatCoordinates.length; i < ii; i += stride) {
                    p1 = this.createPoint_(flatCoordinates[i], flatCoordinates[i + 1], n++);
                    segments.push(this.insertItem_(p0, p1, list));
                    extents.push([ Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y) ]);
                    p0 = p1;
                }
                segments.push(this.insertItem_(p1, start, list));
                extents.push([ Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y) ]);
            } else {
                var end = flatCoordinates.length - stride;
                start = this.createPoint_(flatCoordinates[end], flatCoordinates[end + 1], n++);
                p0 = start;
                for (i = end - stride, ii = 0; i >= ii; i -= stride) {
                    p1 = this.createPoint_(flatCoordinates[i], flatCoordinates[i + 1], n++);
                    segments.push(this.insertItem_(p0, p1, list));
                    extents.push([ Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y) ]);
                    p0 = p1;
                }
                segments.push(this.insertItem_(p1, start, list));
                extents.push([ Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y) ]);
            }
            rtree.load(extents, segments);
        };
        _ol_render_webgl_PolygonReplay_.prototype.getMaxCoords_ = function(list) {
            var start = list.firstItem();
            var seg = start;
            var maxCoords = [ seg.p0.x, seg.p0.y ];
            do {
                seg = list.nextItem();
                if (seg.p0.x > maxCoords[0]) {
                    maxCoords = [ seg.p0.x, seg.p0.y ];
                }
            } while (seg !== start);
            return maxCoords;
        };
        _ol_render_webgl_PolygonReplay_.prototype.classifyPoints_ = function(list, rtree, ccw) {
            var start = list.firstItem();
            var s0 = start;
            var s1 = list.nextItem();
            var pointsReclassified = false;
            do {
                var reflex = ccw ? _webgl2.default.triangleIsCounterClockwise(s1.p1.x, s1.p1.y, s0.p1.x, s0.p1.y, s0.p0.x, s0.p0.y) : _webgl2.default.triangleIsCounterClockwise(s0.p0.x, s0.p0.y, s0.p1.x, s0.p1.y, s1.p1.x, s1.p1.y);
                if (reflex === undefined) {
                    this.removeItem_(s0, s1, list, rtree);
                    pointsReclassified = true;
                    if (s1 === start) {
                        start = list.getNextItem();
                    }
                    s1 = s0;
                    list.prevItem();
                } else if (s0.p1.reflex !== reflex) {
                    s0.p1.reflex = reflex;
                    pointsReclassified = true;
                }
                s0 = s1;
                s1 = list.nextItem();
            } while (s0 !== start);
            return pointsReclassified;
        };
        _ol_render_webgl_PolygonReplay_.prototype.bridgeHole_ = function(hole, holeMaxX, list, listMaxX, rtree) {
            var seg = hole.firstItem();
            while (seg.p1.x !== holeMaxX) {
                seg = hole.nextItem();
            }
            var p1 = seg.p1;
            var p2 = {
                x: listMaxX,
                y: p1.y,
                i: -1
            };
            var minDist = Infinity;
            var i, ii, bestPoint;
            var p5;
            var intersectingSegments = this.getIntersections_({
                p0: p1,
                p1: p2
            }, rtree, true);
            for (i = 0, ii = intersectingSegments.length; i < ii; ++i) {
                var currSeg = intersectingSegments[i];
                var intersection = this.calculateIntersection_(p1, p2, currSeg.p0, currSeg.p1, true);
                var dist = Math.abs(p1.x - intersection[0]);
                if (dist < minDist && _webgl2.default.triangleIsCounterClockwise(p1.x, p1.y, currSeg.p0.x, currSeg.p0.y, currSeg.p1.x, currSeg.p1.y) !== undefined) {
                    minDist = dist;
                    p5 = {
                        x: intersection[0],
                        y: intersection[1],
                        i: -1
                    };
                    seg = currSeg;
                }
            }
            if (minDist === Infinity) {
                return false;
            }
            bestPoint = seg.p1;
            if (minDist > 0) {
                var pointsInTriangle = this.getPointsInTriangle_(p1, p5, seg.p1, rtree);
                if (pointsInTriangle.length) {
                    var theta = Infinity;
                    for (i = 0, ii = pointsInTriangle.length; i < ii; ++i) {
                        var currPoint = pointsInTriangle[i];
                        var currTheta = Math.atan2(p1.y - currPoint.y, p2.x - currPoint.x);
                        if (currTheta < theta || currTheta === theta && currPoint.x < bestPoint.x) {
                            theta = currTheta;
                            bestPoint = currPoint;
                        }
                    }
                }
            }
            seg = list.firstItem();
            while (seg.p1.x !== bestPoint.x || seg.p1.y !== bestPoint.y) {
                seg = list.nextItem();
            }
            var p0Bridge = {
                x: p1.x,
                y: p1.y,
                i: p1.i,
                reflex: undefined
            };
            var p1Bridge = {
                x: seg.p1.x,
                y: seg.p1.y,
                i: seg.p1.i,
                reflex: undefined
            };
            hole.getNextItem().p0 = p0Bridge;
            this.insertItem_(p1, seg.p1, hole, rtree);
            this.insertItem_(p1Bridge, p0Bridge, hole, rtree);
            seg.p1 = p1Bridge;
            hole.setFirstItem();
            list.concat(hole);
            return true;
        };
        _ol_render_webgl_PolygonReplay_.prototype.triangulate_ = function(list, rtree) {
            var ccw = false;
            var simple = this.isSimple_(list, rtree);
            while (list.getLength() > 3) {
                if (simple) {
                    if (!this.clipEars_(list, rtree, simple, ccw)) {
                        if (!this.classifyPoints_(list, rtree, ccw)) {
                            if (!this.resolveSelfIntersections_(list, rtree, true)) {
                                break;
                            }
                        }
                    }
                } else {
                    if (!this.clipEars_(list, rtree, simple, ccw)) {
                        if (!this.classifyPoints_(list, rtree, ccw)) {
                            if (!this.resolveSelfIntersections_(list, rtree)) {
                                simple = this.isSimple_(list, rtree);
                                if (!simple) {
                                    this.splitPolygon_(list, rtree);
                                    break;
                                } else {
                                    ccw = !this.isClockwise_(list);
                                    this.classifyPoints_(list, rtree, ccw);
                                }
                            }
                        }
                    }
                }
            }
            if (list.getLength() === 3) {
                var numIndices = this.indices.length;
                this.indices[numIndices++] = list.getPrevItem().p0.i;
                this.indices[numIndices++] = list.getCurrItem().p0.i;
                this.indices[numIndices++] = list.getNextItem().p0.i;
            }
        };
        _ol_render_webgl_PolygonReplay_.prototype.clipEars_ = function(list, rtree, simple, ccw) {
            var numIndices = this.indices.length;
            var start = list.firstItem();
            var s0 = list.getPrevItem();
            var s1 = start;
            var s2 = list.nextItem();
            var s3 = list.getNextItem();
            var p0, p1, p2;
            var processedEars = false;
            do {
                p0 = s1.p0;
                p1 = s1.p1;
                p2 = s2.p1;
                if (p1.reflex === false) {
                    var variableCriterion;
                    if (simple) {
                        variableCriterion = this.getPointsInTriangle_(p0, p1, p2, rtree, true).length === 0;
                    } else {
                        variableCriterion = ccw ? this.diagonalIsInside_(s3.p1, p2, p1, p0, s0.p0) : this.diagonalIsInside_(s0.p0, p0, p1, p2, s3.p1);
                    }
                    if ((simple || this.getIntersections_({
                        p0: p0,
                        p1: p2
                    }, rtree).length === 0) && variableCriterion) {
                        if (simple || p0.reflex === false || p2.reflex === false || _orient2.default.linearRingIsClockwise([ s0.p0.x, s0.p0.y, p0.x, p0.y, p1.x, p1.y, p2.x, p2.y, s3.p1.x, s3.p1.y ], 0, 10, 2) === !ccw) {
                            this.indices[numIndices++] = p0.i;
                            this.indices[numIndices++] = p1.i;
                            this.indices[numIndices++] = p2.i;
                            this.removeItem_(s1, s2, list, rtree);
                            if (s2 === start) {
                                start = s3;
                            }
                            processedEars = true;
                        }
                    }
                }
                s0 = list.getPrevItem();
                s1 = list.getCurrItem();
                s2 = list.nextItem();
                s3 = list.getNextItem();
            } while (s1 !== start && list.getLength() > 3);
            return processedEars;
        };
        _ol_render_webgl_PolygonReplay_.prototype.resolveSelfIntersections_ = function(list, rtree, opt_touch) {
            var start = list.firstItem();
            list.nextItem();
            var s0 = start;
            var s1 = list.nextItem();
            var resolvedIntersections = false;
            do {
                var intersection = this.calculateIntersection_(s0.p0, s0.p1, s1.p0, s1.p1, opt_touch);
                if (intersection) {
                    var breakCond = false;
                    var numVertices = this.vertices.length;
                    var numIndices = this.indices.length;
                    var n = numVertices / 2;
                    var seg = list.prevItem();
                    list.removeItem();
                    rtree.remove(seg);
                    breakCond = seg === start;
                    var p;
                    if (opt_touch) {
                        if (intersection[0] === s0.p0.x && intersection[1] === s0.p0.y) {
                            list.prevItem();
                            p = s0.p0;
                            s1.p0 = p;
                            rtree.remove(s0);
                            breakCond = breakCond || s0 === start;
                        } else {
                            p = s1.p1;
                            s0.p1 = p;
                            rtree.remove(s1);
                            breakCond = breakCond || s1 === start;
                        }
                        list.removeItem();
                    } else {
                        p = this.createPoint_(intersection[0], intersection[1], n);
                        s0.p1 = p;
                        s1.p0 = p;
                        rtree.update([ Math.min(s0.p0.x, s0.p1.x), Math.min(s0.p0.y, s0.p1.y), Math.max(s0.p0.x, s0.p1.x), Math.max(s0.p0.y, s0.p1.y) ], s0);
                        rtree.update([ Math.min(s1.p0.x, s1.p1.x), Math.min(s1.p0.y, s1.p1.y), Math.max(s1.p0.x, s1.p1.x), Math.max(s1.p0.y, s1.p1.y) ], s1);
                    }
                    this.indices[numIndices++] = seg.p0.i;
                    this.indices[numIndices++] = seg.p1.i;
                    this.indices[numIndices++] = p.i;
                    resolvedIntersections = true;
                    if (breakCond) {
                        break;
                    }
                }
                s0 = list.getPrevItem();
                s1 = list.nextItem();
            } while (s0 !== start);
            return resolvedIntersections;
        };
        _ol_render_webgl_PolygonReplay_.prototype.isSimple_ = function(list, rtree) {
            var start = list.firstItem();
            var seg = start;
            do {
                if (this.getIntersections_(seg, rtree).length) {
                    return false;
                }
                seg = list.nextItem();
            } while (seg !== start);
            return true;
        };
        _ol_render_webgl_PolygonReplay_.prototype.isClockwise_ = function(list) {
            var length = list.getLength() * 2;
            var flatCoordinates = new Array(length);
            var start = list.firstItem();
            var seg = start;
            var i = 0;
            do {
                flatCoordinates[i++] = seg.p0.x;
                flatCoordinates[i++] = seg.p0.y;
                seg = list.nextItem();
            } while (seg !== start);
            return _orient2.default.linearRingIsClockwise(flatCoordinates, 0, length, 2);
        };
        _ol_render_webgl_PolygonReplay_.prototype.splitPolygon_ = function(list, rtree) {
            var start = list.firstItem();
            var s0 = start;
            do {
                var intersections = this.getIntersections_(s0, rtree);
                if (intersections.length) {
                    var s1 = intersections[0];
                    var n = this.vertices.length / 2;
                    var intersection = this.calculateIntersection_(s0.p0, s0.p1, s1.p0, s1.p1);
                    var p = this.createPoint_(intersection[0], intersection[1], n);
                    var newPolygon = new _linkedlist2.default();
                    var newRtree = new _rbush2.default();
                    this.insertItem_(p, s0.p1, newPolygon, newRtree);
                    s0.p1 = p;
                    rtree.update([ Math.min(s0.p0.x, p.x), Math.min(s0.p0.y, p.y), Math.max(s0.p0.x, p.x), Math.max(s0.p0.y, p.y) ], s0);
                    var currItem = list.nextItem();
                    while (currItem !== s1) {
                        this.insertItem_(currItem.p0, currItem.p1, newPolygon, newRtree);
                        rtree.remove(currItem);
                        list.removeItem();
                        currItem = list.getCurrItem();
                    }
                    this.insertItem_(s1.p0, p, newPolygon, newRtree);
                    s1.p0 = p;
                    rtree.update([ Math.min(s1.p1.x, p.x), Math.min(s1.p1.y, p.y), Math.max(s1.p1.x, p.x), Math.max(s1.p1.y, p.y) ], s1);
                    this.classifyPoints_(list, rtree, false);
                    this.triangulate_(list, rtree);
                    this.classifyPoints_(newPolygon, newRtree, false);
                    this.triangulate_(newPolygon, newRtree);
                    break;
                }
                s0 = list.nextItem();
            } while (s0 !== start);
        };
        _ol_render_webgl_PolygonReplay_.prototype.createPoint_ = function(x, y, i) {
            var numVertices = this.vertices.length;
            this.vertices[numVertices++] = x;
            this.vertices[numVertices++] = y;
            var p = {
                x: x,
                y: y,
                i: i,
                reflex: undefined
            };
            return p;
        };
        _ol_render_webgl_PolygonReplay_.prototype.insertItem_ = function(p0, p1, list, opt_rtree) {
            var seg = {
                p0: p0,
                p1: p1
            };
            list.insertItem(seg);
            if (opt_rtree) {
                opt_rtree.insert([ Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y) ], seg);
            }
            return seg;
        };
        _ol_render_webgl_PolygonReplay_.prototype.removeItem_ = function(s0, s1, list, rtree) {
            if (list.getCurrItem() === s1) {
                list.removeItem();
                s0.p1 = s1.p1;
                rtree.remove(s1);
                rtree.update([ Math.min(s0.p0.x, s0.p1.x), Math.min(s0.p0.y, s0.p1.y), Math.max(s0.p0.x, s0.p1.x), Math.max(s0.p0.y, s0.p1.y) ], s0);
            }
        };
        _ol_render_webgl_PolygonReplay_.prototype.getPointsInTriangle_ = function(p0, p1, p2, rtree, opt_reflex) {
            var i, ii, j, p;
            var result = [];
            var segmentsInExtent = rtree.getInExtent([ Math.min(p0.x, p1.x, p2.x), Math.min(p0.y, p1.y, p2.y), Math.max(p0.x, p1.x, p2.x), Math.max(p0.y, p1.y, p2.y) ]);
            for (i = 0, ii = segmentsInExtent.length; i < ii; ++i) {
                for (j in segmentsInExtent[i]) {
                    p = segmentsInExtent[i][j];
                    if (typeof p === "object" && (!opt_reflex || p.reflex)) {
                        if ((p.x !== p0.x || p.y !== p0.y) && (p.x !== p1.x || p.y !== p1.y) && (p.x !== p2.x || p.y !== p2.y) && result.indexOf(p) === -1 && _contains2.default.linearRingContainsXY([ p0.x, p0.y, p1.x, p1.y, p2.x, p2.y ], 0, 6, 2, p.x, p.y)) {
                            result.push(p);
                        }
                    }
                }
            }
            return result;
        };
        _ol_render_webgl_PolygonReplay_.prototype.getIntersections_ = function(segment, rtree, opt_touch) {
            var p0 = segment.p0;
            var p1 = segment.p1;
            var segmentsInExtent = rtree.getInExtent([ Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y) ]);
            var result = [];
            var i, ii;
            for (i = 0, ii = segmentsInExtent.length; i < ii; ++i) {
                var currSeg = segmentsInExtent[i];
                if (segment !== currSeg && (opt_touch || currSeg.p0 !== p1 || currSeg.p1 !== p0) && this.calculateIntersection_(p0, p1, currSeg.p0, currSeg.p1, opt_touch)) {
                    result.push(currSeg);
                }
            }
            return result;
        };
        _ol_render_webgl_PolygonReplay_.prototype.calculateIntersection_ = function(p0, p1, p2, p3, opt_touch) {
            var denom = (p3.y - p2.y) * (p1.x - p0.x) - (p3.x - p2.x) * (p1.y - p0.y);
            if (denom !== 0) {
                var ua = ((p3.x - p2.x) * (p0.y - p2.y) - (p3.y - p2.y) * (p0.x - p2.x)) / denom;
                var ub = ((p1.x - p0.x) * (p0.y - p2.y) - (p1.y - p0.y) * (p0.x - p2.x)) / denom;
                if (!opt_touch && ua > _webgl2.default.EPSILON && ua < 1 - _webgl2.default.EPSILON && ub > _webgl2.default.EPSILON && ub < 1 - _webgl2.default.EPSILON || opt_touch && ua >= 0 && ua <= 1 && ub >= 0 && ub <= 1) {
                    return [ p0.x + ua * (p1.x - p0.x), p0.y + ua * (p1.y - p0.y) ];
                }
            }
            return undefined;
        };
        _ol_render_webgl_PolygonReplay_.prototype.diagonalIsInside_ = function(p0, p1, p2, p3, p4) {
            if (p1.reflex === undefined || p3.reflex === undefined) {
                return false;
            }
            var p1IsLeftOf = (p2.x - p3.x) * (p1.y - p3.y) > (p2.y - p3.y) * (p1.x - p3.x);
            var p1IsRightOf = (p4.x - p3.x) * (p1.y - p3.y) < (p4.y - p3.y) * (p1.x - p3.x);
            var p3IsLeftOf = (p0.x - p1.x) * (p3.y - p1.y) > (p0.y - p1.y) * (p3.x - p1.x);
            var p3IsRightOf = (p2.x - p1.x) * (p3.y - p1.y) < (p2.y - p1.y) * (p3.x - p1.x);
            var p1InCone = p3.reflex ? p1IsRightOf || p1IsLeftOf : p1IsRightOf && p1IsLeftOf;
            var p3InCone = p1.reflex ? p3IsRightOf || p3IsLeftOf : p3IsRightOf && p3IsLeftOf;
            return p1InCone && p3InCone;
        };
        _ol_render_webgl_PolygonReplay_.prototype.drawMultiPolygon = function(multiPolygonGeometry, feature) {
            var endss = multiPolygonGeometry.getEndss();
            var stride = multiPolygonGeometry.getStride();
            var currIndex = this.indices.length;
            var currLineIndex = this.lineStringReplay.getCurrentIndex();
            var flatCoordinates = multiPolygonGeometry.getFlatCoordinates();
            var i, ii, j, jj;
            var start = 0;
            for (i = 0, ii = endss.length; i < ii; ++i) {
                var ends = endss[i];
                if (ends.length > 0) {
                    var outerRing = _transform2.default.translate(flatCoordinates, start, ends[0], stride, -this.origin[0], -this.origin[1]);
                    if (outerRing.length) {
                        var holes = [];
                        var holeFlatCoords;
                        for (j = 1, jj = ends.length; j < jj; ++j) {
                            if (ends[j] !== ends[j - 1]) {
                                holeFlatCoords = _transform2.default.translate(flatCoordinates, ends[j - 1], ends[j], stride, -this.origin[0], -this.origin[1]);
                                holes.push(holeFlatCoords);
                            }
                        }
                        this.lineStringReplay.drawPolygonCoordinates(outerRing, holes, stride);
                        this.drawCoordinates_(outerRing, holes, stride);
                    }
                }
                start = ends[ends.length - 1];
            }
            if (this.indices.length > currIndex) {
                this.startIndices.push(currIndex);
                this.startIndicesFeature.push(feature);
                if (this.state_.changed) {
                    this.styleIndices_.push(currIndex);
                    this.state_.changed = false;
                }
            }
            if (this.lineStringReplay.getCurrentIndex() > currLineIndex) {
                this.lineStringReplay.setPolygonStyle(feature, currLineIndex);
            }
        };
        _ol_render_webgl_PolygonReplay_.prototype.drawPolygon = function(polygonGeometry, feature) {
            var ends = polygonGeometry.getEnds();
            var stride = polygonGeometry.getStride();
            if (ends.length > 0) {
                var flatCoordinates = polygonGeometry.getFlatCoordinates().map(Number);
                var outerRing = _transform2.default.translate(flatCoordinates, 0, ends[0], stride, -this.origin[0], -this.origin[1]);
                if (outerRing.length) {
                    var holes = [];
                    var i, ii, holeFlatCoords;
                    for (i = 1, ii = ends.length; i < ii; ++i) {
                        if (ends[i] !== ends[i - 1]) {
                            holeFlatCoords = _transform2.default.translate(flatCoordinates, ends[i - 1], ends[i], stride, -this.origin[0], -this.origin[1]);
                            holes.push(holeFlatCoords);
                        }
                    }
                    this.startIndices.push(this.indices.length);
                    this.startIndicesFeature.push(feature);
                    if (this.state_.changed) {
                        this.styleIndices_.push(this.indices.length);
                        this.state_.changed = false;
                    }
                    this.lineStringReplay.setPolygonStyle(feature);
                    this.lineStringReplay.drawPolygonCoordinates(outerRing, holes, stride);
                    this.drawCoordinates_(outerRing, holes, stride);
                }
            }
        };
        _ol_render_webgl_PolygonReplay_.prototype.finish = function(context) {
            this.verticesBuffer = new _buffer2.default(this.vertices);
            this.indicesBuffer = new _buffer2.default(this.indices);
            this.startIndices.push(this.indices.length);
            this.lineStringReplay.finish(context);
            if (this.styleIndices_.length === 0 && this.styles_.length > 0) {
                this.styles_ = [];
            }
            this.vertices = null;
            this.indices = null;
        };
        _ol_render_webgl_PolygonReplay_.prototype.getDeleteResourcesFunction = function(context) {
            var verticesBuffer = this.verticesBuffer;
            var indicesBuffer = this.indicesBuffer;
            var lineDeleter = this.lineStringReplay.getDeleteResourcesFunction(context);
            return function() {
                context.deleteBuffer(verticesBuffer);
                context.deleteBuffer(indicesBuffer);
                lineDeleter();
            };
        };
        _ol_render_webgl_PolygonReplay_.prototype.setUpProgram = function(gl, context, size, pixelRatio) {
            var fragmentShader, vertexShader;
            fragmentShader = _defaultshader2.default.fragment;
            vertexShader = _defaultshader2.default.vertex;
            var program = context.getProgram(fragmentShader, vertexShader);
            var locations;
            if (!this.defaultLocations_) {
                locations = new _locations2.default(gl, program);
                this.defaultLocations_ = locations;
            } else {
                locations = this.defaultLocations_;
            }
            context.useProgram(program);
            gl.enableVertexAttribArray(locations.a_position);
            gl.vertexAttribPointer(locations.a_position, 2, _webgl4.default.FLOAT, false, 8, 0);
            return locations;
        };
        _ol_render_webgl_PolygonReplay_.prototype.shutDownProgram = function(gl, locations) {
            gl.disableVertexAttribArray(locations.a_position);
        };
        _ol_render_webgl_PolygonReplay_.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {
            var tmpDepthFunc = gl.getParameter(gl.DEPTH_FUNC);
            var tmpDepthMask = gl.getParameter(gl.DEPTH_WRITEMASK);
            if (!hitDetection) {
                gl.enable(gl.DEPTH_TEST);
                gl.depthMask(true);
                gl.depthFunc(gl.NOTEQUAL);
            }
            if (!_obj2.default.isEmpty(skippedFeaturesHash)) {
                this.drawReplaySkipping_(gl, context, skippedFeaturesHash);
            } else {
                var i, start, end, nextStyle;
                end = this.startIndices[this.startIndices.length - 1];
                for (i = this.styleIndices_.length - 1; i >= 0; --i) {
                    start = this.styleIndices_[i];
                    nextStyle = this.styles_[i];
                    this.setFillStyle_(gl, nextStyle);
                    this.drawElements(gl, context, start, end);
                    end = start;
                }
            }
            if (!hitDetection) {
                gl.disable(gl.DEPTH_TEST);
                gl.clear(gl.DEPTH_BUFFER_BIT);
                gl.depthMask(tmpDepthMask);
                gl.depthFunc(tmpDepthFunc);
            }
        };
        _ol_render_webgl_PolygonReplay_.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {
            var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;
            featureIndex = this.startIndices.length - 2;
            end = this.startIndices[featureIndex + 1];
            for (i = this.styleIndices_.length - 1; i >= 0; --i) {
                nextStyle = this.styles_[i];
                this.setFillStyle_(gl, nextStyle);
                groupStart = this.styleIndices_[i];
                while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {
                    start = this.startIndices[featureIndex];
                    feature = this.startIndicesFeature[featureIndex];
                    featureUid = _index2.default.getUid(feature).toString();
                    if (skippedFeaturesHash[featureUid] === undefined && feature.getGeometry() && (opt_hitExtent === undefined || _extent2.default.intersects(opt_hitExtent, feature.getGeometry().getExtent()))) {
                        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
                        this.drawElements(gl, context, start, end);
                        var result = featureCallback(feature);
                        if (result) {
                            return result;
                        }
                    }
                    featureIndex--;
                    end = start;
                }
            }
            return undefined;
        };
        _ol_render_webgl_PolygonReplay_.prototype.drawReplaySkipping_ = function(gl, context, skippedFeaturesHash) {
            var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;
            featureIndex = this.startIndices.length - 2;
            end = start = this.startIndices[featureIndex + 1];
            for (i = this.styleIndices_.length - 1; i >= 0; --i) {
                nextStyle = this.styles_[i];
                this.setFillStyle_(gl, nextStyle);
                groupStart = this.styleIndices_[i];
                while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {
                    featureStart = this.startIndices[featureIndex];
                    feature = this.startIndicesFeature[featureIndex];
                    featureUid = _index2.default.getUid(feature).toString();
                    if (skippedFeaturesHash[featureUid]) {
                        if (start !== end) {
                            this.drawElements(gl, context, start, end);
                            gl.clear(gl.DEPTH_BUFFER_BIT);
                        }
                        end = featureStart;
                    }
                    featureIndex--;
                    start = featureStart;
                }
                if (start !== end) {
                    this.drawElements(gl, context, start, end);
                    gl.clear(gl.DEPTH_BUFFER_BIT);
                }
                start = end = groupStart;
            }
        };
        _ol_render_webgl_PolygonReplay_.prototype.setFillStyle_ = function(gl, color) {
            gl.uniform4fv(this.defaultLocations_.u_color, color);
        };
        _ol_render_webgl_PolygonReplay_.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {
            var fillStyleColor = fillStyle ? fillStyle.getColor() : [ 0, 0, 0, 0 ];
            if (!(fillStyleColor instanceof CanvasGradient) && !(fillStyleColor instanceof CanvasPattern)) {
                fillStyleColor = _color2.default.asArray(fillStyleColor).map(function(c, i) {
                    return i != 3 ? c / 255 : c;
                }) || _webgl2.default.defaultFillStyle;
            } else {
                fillStyleColor = _webgl2.default.defaultFillStyle;
            }
            if (!this.state_.fillColor || !_array2.default.equals(fillStyleColor, this.state_.fillColor)) {
                this.state_.fillColor = fillStyleColor;
                this.state_.changed = true;
                this.styles_.push(fillStyleColor);
            }
            if (strokeStyle) {
                this.lineStringReplay.setFillStrokeStyle(null, strokeStyle);
            } else {
                var nullStrokeStyle = new _stroke2.default({
                    color: [ 0, 0, 0, 0 ],
                    lineWidth: 0
                });
                this.lineStringReplay.setFillStrokeStyle(null, nullStrokeStyle);
            }
        };
        exports.default = _ol_render_webgl_PolygonReplay_;
    }, {
        "../../array.js": 29,
        "../../color.js": 36,
        "../../extent.js": 54,
        "../../geom/flat/contains.js": 63,
        "../../geom/flat/orient.js": 69,
        "../../geom/flat/transform.js": 76,
        "../../index.js": 89,
        "../../obj.js": 124,
        "../../structs/linkedlist.js": 217,
        "../../structs/rbush.js": 220,
        "../../style/stroke.js": 233,
        "../../webgl.js": 248,
        "../../webgl/buffer.js": 249,
        "../webgl.js": 165,
        "../webgl/linestringreplay.js": 171,
        "../webgl/polygonreplay/defaultshader.js": 175,
        "../webgl/polygonreplay/defaultshader/locations.js": 176,
        "../webgl/replay.js": 177
    } ],
    175: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _fragment = require("../../../webgl/fragment.js");
        var _fragment2 = _interopRequireDefault(_fragment);
        var _vertex = require("../../../webgl/vertex.js");
        var _vertex2 = _interopRequireDefault(_vertex);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_polygonreplay_defaultshader_ = {};
        _ol_render_webgl_polygonreplay_defaultshader_.fragment = new _fragment2.default(_index2.default.DEBUG_WEBGL ? "precision mediump float;\n\n\n\nuniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main(void) {\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n" : "precision mediump float;uniform vec4 e;uniform float f;void main(void){gl_FragColor=e;float alpha=e.a*f;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}");
        _ol_render_webgl_polygonreplay_defaultshader_.vertex = new _vertex2.default(_index2.default.DEBUG_WEBGL ? "\n\nattribute vec2 a_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n}\n\n\n" : "attribute vec2 a;uniform mat4 b;uniform mat4 c;uniform mat4 d;void main(void){gl_Position=b*vec4(a,0.0,1.0);}");
        exports.default = _ol_render_webgl_polygonreplay_defaultshader_;
    }, {
        "../../../index.js": 89,
        "../../../webgl/fragment.js": 252,
        "../../../webgl/vertex.js": 254
    } ],
    176: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../../../index.js");
        var _index2 = _interopRequireDefault(_index);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_polygonreplay_defaultshader_Locations_ = function(gl, program) {
            this.u_projectionMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_projectionMatrix" : "b");
            this.u_offsetScaleMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_offsetScaleMatrix" : "c");
            this.u_offsetRotateMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_offsetRotateMatrix" : "d");
            this.u_color = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_color" : "e");
            this.u_opacity = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_opacity" : "f");
            this.a_position = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_position" : "a");
        };
        exports.default = _ol_render_webgl_polygonreplay_defaultshader_Locations_;
    }, {
        "../../../../index.js": 89
    } ],
    177: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _vectorcontext = require("../vectorcontext.js");
        var _vectorcontext2 = _interopRequireDefault(_vectorcontext);
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _mat = require("../../vec/mat4.js");
        var _mat2 = _interopRequireDefault(_mat);
        var _webgl = require("../../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_Replay_ = function(tolerance, maxExtent) {
            _vectorcontext2.default.call(this);
            this.tolerance = tolerance;
            this.maxExtent = maxExtent;
            this.origin = _extent2.default.getCenter(maxExtent);
            this.projectionMatrix_ = _transform2.default.create();
            this.offsetRotateMatrix_ = _transform2.default.create();
            this.offsetScaleMatrix_ = _transform2.default.create();
            this.tmpMat4_ = _mat2.default.create();
            this.indices = [];
            this.indicesBuffer = null;
            this.startIndices = [];
            this.startIndicesFeature = [];
            this.vertices = [];
            this.verticesBuffer = null;
            this.lineStringReplay = undefined;
        };
        _index2.default.inherits(_ol_render_webgl_Replay_, _vectorcontext2.default);
        _ol_render_webgl_Replay_.prototype.getDeleteResourcesFunction = function(context) {};
        _ol_render_webgl_Replay_.prototype.finish = function(context) {};
        _ol_render_webgl_Replay_.prototype.setUpProgram = function(gl, context, size, pixelRatio) {};
        _ol_render_webgl_Replay_.prototype.shutDownProgram = function(gl, locations) {};
        _ol_render_webgl_Replay_.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {};
        _ol_render_webgl_Replay_.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {};
        _ol_render_webgl_Replay_.prototype.drawHitDetectionReplay = function(gl, context, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent) {
            if (!oneByOne) {
                return this.drawHitDetectionReplayAll(gl, context, skippedFeaturesHash, featureCallback);
            } else {
                return this.drawHitDetectionReplayOneByOne(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent);
            }
        };
        _ol_render_webgl_Replay_.prototype.drawHitDetectionReplayAll = function(gl, context, skippedFeaturesHash, featureCallback) {
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
            this.drawReplay(gl, context, skippedFeaturesHash, true);
            var result = featureCallback(null);
            if (result) {
                return result;
            } else {
                return undefined;
            }
        };
        _ol_render_webgl_Replay_.prototype.replay = function(context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent) {
            var gl = context.getGL();
            var tmpStencil, tmpStencilFunc, tmpStencilMaskVal, tmpStencilRef, tmpStencilMask, tmpStencilOpFail, tmpStencilOpPass, tmpStencilOpZFail;
            if (this.lineStringReplay) {
                tmpStencil = gl.isEnabled(gl.STENCIL_TEST);
                tmpStencilFunc = gl.getParameter(gl.STENCIL_FUNC);
                tmpStencilMaskVal = gl.getParameter(gl.STENCIL_VALUE_MASK);
                tmpStencilRef = gl.getParameter(gl.STENCIL_REF);
                tmpStencilMask = gl.getParameter(gl.STENCIL_WRITEMASK);
                tmpStencilOpFail = gl.getParameter(gl.STENCIL_FAIL);
                tmpStencilOpPass = gl.getParameter(gl.STENCIL_PASS_DEPTH_PASS);
                tmpStencilOpZFail = gl.getParameter(gl.STENCIL_PASS_DEPTH_FAIL);
                gl.enable(gl.STENCIL_TEST);
                gl.clear(gl.STENCIL_BUFFER_BIT);
                gl.stencilMask(255);
                gl.stencilFunc(gl.ALWAYS, 1, 255);
                gl.stencilOp(gl.KEEP, gl.KEEP, gl.REPLACE);
                this.lineStringReplay.replay(context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent);
                gl.stencilMask(0);
                gl.stencilFunc(gl.NOTEQUAL, 1, 255);
            }
            context.bindBuffer(_webgl2.default.ARRAY_BUFFER, this.verticesBuffer);
            context.bindBuffer(_webgl2.default.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);
            var locations = this.setUpProgram(gl, context, size, pixelRatio);
            var projectionMatrix = _transform2.default.reset(this.projectionMatrix_);
            _transform2.default.scale(projectionMatrix, 2 / (resolution * size[0]), 2 / (resolution * size[1]));
            _transform2.default.rotate(projectionMatrix, -rotation);
            _transform2.default.translate(projectionMatrix, -(center[0] - this.origin[0]), -(center[1] - this.origin[1]));
            var offsetScaleMatrix = _transform2.default.reset(this.offsetScaleMatrix_);
            _transform2.default.scale(offsetScaleMatrix, 2 / size[0], 2 / size[1]);
            var offsetRotateMatrix = _transform2.default.reset(this.offsetRotateMatrix_);
            if (rotation !== 0) {
                _transform2.default.rotate(offsetRotateMatrix, -rotation);
            }
            gl.uniformMatrix4fv(locations.u_projectionMatrix, false, _mat2.default.fromTransform(this.tmpMat4_, projectionMatrix));
            gl.uniformMatrix4fv(locations.u_offsetScaleMatrix, false, _mat2.default.fromTransform(this.tmpMat4_, offsetScaleMatrix));
            gl.uniformMatrix4fv(locations.u_offsetRotateMatrix, false, _mat2.default.fromTransform(this.tmpMat4_, offsetRotateMatrix));
            gl.uniform1f(locations.u_opacity, opacity);
            var result;
            if (featureCallback === undefined) {
                this.drawReplay(gl, context, skippedFeaturesHash, false);
            } else {
                result = this.drawHitDetectionReplay(gl, context, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent);
            }
            this.shutDownProgram(gl, locations);
            if (this.lineStringReplay) {
                if (!tmpStencil) {
                    gl.disable(gl.STENCIL_TEST);
                }
                gl.clear(gl.STENCIL_BUFFER_BIT);
                gl.stencilFunc(tmpStencilFunc, tmpStencilRef, tmpStencilMaskVal);
                gl.stencilMask(tmpStencilMask);
                gl.stencilOp(tmpStencilOpFail, tmpStencilOpZFail, tmpStencilOpPass);
            }
            return result;
        };
        _ol_render_webgl_Replay_.prototype.drawElements = function(gl, context, start, end) {
            var elementType = context.hasOESElementIndexUint ? _webgl2.default.UNSIGNED_INT : _webgl2.default.UNSIGNED_SHORT;
            var elementSize = context.hasOESElementIndexUint ? 4 : 2;
            var numItems = end - start;
            var offsetInBytes = start * elementSize;
            gl.drawElements(_webgl2.default.TRIANGLES, numItems, elementType, offsetInBytes);
        };
        exports.default = _ol_render_webgl_Replay_;
    }, {
        "../../extent.js": 54,
        "../../index.js": 89,
        "../../transform.js": 243,
        "../../vec/mat4.js": 244,
        "../../webgl.js": 248,
        "../vectorcontext.js": 164
    } ],
    178: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _obj = require("../../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _replay = require("../replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        var _replaygroup = require("../replaygroup.js");
        var _replaygroup2 = _interopRequireDefault(_replaygroup);
        var _circlereplay = require("../webgl/circlereplay.js");
        var _circlereplay2 = _interopRequireDefault(_circlereplay);
        var _imagereplay = require("../webgl/imagereplay.js");
        var _imagereplay2 = _interopRequireDefault(_imagereplay);
        var _linestringreplay = require("../webgl/linestringreplay.js");
        var _linestringreplay2 = _interopRequireDefault(_linestringreplay);
        var _polygonreplay = require("../webgl/polygonreplay.js");
        var _polygonreplay2 = _interopRequireDefault(_polygonreplay);
        var _textreplay = require("../webgl/textreplay.js");
        var _textreplay2 = _interopRequireDefault(_textreplay);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_ReplayGroup_ = function(tolerance, maxExtent, opt_renderBuffer) {
            _replaygroup2.default.call(this);
            this.maxExtent_ = maxExtent;
            this.tolerance_ = tolerance;
            this.renderBuffer_ = opt_renderBuffer;
            this.replaysByZIndex_ = {};
        };
        _index2.default.inherits(_ol_render_webgl_ReplayGroup_, _replaygroup2.default);
        _ol_render_webgl_ReplayGroup_.prototype.addDeclutter = function(style, group) {};
        _ol_render_webgl_ReplayGroup_.prototype.getDeleteResourcesFunction = function(context) {
            var functions = [];
            var zKey;
            for (zKey in this.replaysByZIndex_) {
                var replays = this.replaysByZIndex_[zKey];
                var replayKey;
                for (replayKey in replays) {
                    functions.push(replays[replayKey].getDeleteResourcesFunction(context));
                }
            }
            return function() {
                var length = functions.length;
                var result;
                for (var i = 0; i < length; i++) {
                    result = functions[i].apply(this, arguments);
                }
                return result;
            };
        };
        _ol_render_webgl_ReplayGroup_.prototype.finish = function(context) {
            var zKey;
            for (zKey in this.replaysByZIndex_) {
                var replays = this.replaysByZIndex_[zKey];
                var replayKey;
                for (replayKey in replays) {
                    replays[replayKey].finish(context);
                }
            }
        };
        _ol_render_webgl_ReplayGroup_.prototype.getReplay = function(zIndex, replayType) {
            var zIndexKey = zIndex !== undefined ? zIndex.toString() : "0";
            var replays = this.replaysByZIndex_[zIndexKey];
            if (replays === undefined) {
                replays = {};
                this.replaysByZIndex_[zIndexKey] = replays;
            }
            var replay = replays[replayType];
            if (replay === undefined) {
                var Constructor = _ol_render_webgl_ReplayGroup_.BATCH_CONSTRUCTORS_[replayType];
                replay = new Constructor(this.tolerance_, this.maxExtent_);
                replays[replayType] = replay;
            }
            return replay;
        };
        _ol_render_webgl_ReplayGroup_.prototype.isEmpty = function() {
            return _obj2.default.isEmpty(this.replaysByZIndex_);
        };
        _ol_render_webgl_ReplayGroup_.prototype.replay = function(context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash) {
            var zs = Object.keys(this.replaysByZIndex_).map(Number);
            zs.sort(_array2.default.numberSafeCompareFunction);
            var i, ii, j, jj, replays, replay;
            for (i = 0, ii = zs.length; i < ii; ++i) {
                replays = this.replaysByZIndex_[zs[i].toString()];
                for (j = 0, jj = _replay2.default.ORDER.length; j < jj; ++j) {
                    replay = replays[_replay2.default.ORDER[j]];
                    if (replay !== undefined) {
                        replay.replay(context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, undefined, false);
                    }
                }
            }
        };
        _ol_render_webgl_ReplayGroup_.prototype.replayHitDetection_ = function(context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent) {
            var zs = Object.keys(this.replaysByZIndex_).map(Number);
            zs.sort(function(a, b) {
                return b - a;
            });
            var i, ii, j, replays, replay, result;
            for (i = 0, ii = zs.length; i < ii; ++i) {
                replays = this.replaysByZIndex_[zs[i].toString()];
                for (j = _replay2.default.ORDER.length - 1; j >= 0; --j) {
                    replay = replays[_replay2.default.ORDER[j]];
                    if (replay !== undefined) {
                        result = replay.replay(context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent);
                        if (result) {
                            return result;
                        }
                    }
                }
            }
            return undefined;
        };
        _ol_render_webgl_ReplayGroup_.prototype.forEachFeatureAtCoordinate = function(coordinate, context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, callback) {
            var gl = context.getGL();
            gl.bindFramebuffer(gl.FRAMEBUFFER, context.getHitDetectionFramebuffer());
            var hitExtent;
            if (this.renderBuffer_ !== undefined) {
                hitExtent = _extent2.default.buffer(_extent2.default.createOrUpdateFromCoordinate(coordinate), resolution * this.renderBuffer_);
            }
            return this.replayHitDetection_(context, coordinate, resolution, rotation, _ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_, pixelRatio, opacity, skippedFeaturesHash, function(feature) {
                var imageData = new Uint8Array(4);
                gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, imageData);
                if (imageData[3] > 0) {
                    var result = callback(feature);
                    if (result) {
                        return result;
                    }
                }
            }, true, hitExtent);
        };
        _ol_render_webgl_ReplayGroup_.prototype.hasFeatureAtCoordinate = function(coordinate, context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash) {
            var gl = context.getGL();
            gl.bindFramebuffer(gl.FRAMEBUFFER, context.getHitDetectionFramebuffer());
            var hasFeature = this.replayHitDetection_(context, coordinate, resolution, rotation, _ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_, pixelRatio, opacity, skippedFeaturesHash, function(feature) {
                var imageData = new Uint8Array(4);
                gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, imageData);
                return imageData[3] > 0;
            }, false);
            return hasFeature !== undefined;
        };
        _ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_ = [ 1, 1 ];
        _ol_render_webgl_ReplayGroup_.BATCH_CONSTRUCTORS_ = {
            Circle: _circlereplay2.default,
            Image: _imagereplay2.default,
            LineString: _linestringreplay2.default,
            Polygon: _polygonreplay2.default,
            Text: _textreplay2.default
        };
        exports.default = _ol_render_webgl_ReplayGroup_;
    }, {
        "../../array.js": 29,
        "../../extent.js": 54,
        "../../index.js": 89,
        "../../obj.js": 124,
        "../replay.js": 161,
        "../replaygroup.js": 162,
        "../webgl/circlereplay.js": 166,
        "../webgl/imagereplay.js": 169,
        "../webgl/linestringreplay.js": 171,
        "../webgl/polygonreplay.js": 174,
        "../webgl/textreplay.js": 179
    } ],
    179: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _colorlike = require("../../colorlike.js");
        var _colorlike2 = _interopRequireDefault(_colorlike);
        var _dom = require("../../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _geometrytype = require("../../geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _has = require("../../has.js");
        var _has2 = _interopRequireDefault(_has);
        var _replay = require("../replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        var _webgl = require("../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _texturereplay = require("../webgl/texturereplay.js");
        var _texturereplay2 = _interopRequireDefault(_texturereplay);
        var _atlasmanager = require("../../style/atlasmanager.js");
        var _atlasmanager2 = _interopRequireDefault(_atlasmanager);
        var _buffer = require("../../webgl/buffer.js");
        var _buffer2 = _interopRequireDefault(_buffer);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_TextReplay_ = function(tolerance, maxExtent) {
            _texturereplay2.default.call(this, tolerance, maxExtent);
            this.images_ = [];
            this.textures_ = [];
            this.measureCanvas_ = _dom2.default.createCanvasContext2D(0, 0).canvas;
            this.state_ = {
                strokeColor: null,
                lineCap: undefined,
                lineDash: null,
                lineDashOffset: undefined,
                lineJoin: undefined,
                lineWidth: 0,
                miterLimit: undefined,
                fillColor: null,
                font: undefined,
                scale: undefined
            };
            this.text_ = "";
            this.textAlign_ = undefined;
            this.textBaseline_ = undefined;
            this.offsetX_ = undefined;
            this.offsetY_ = undefined;
            this.atlases_ = {};
            this.currAtlas_ = undefined;
            this.scale = 1;
            this.opacity = 1;
        };
        _index2.default.inherits(_ol_render_webgl_TextReplay_, _texturereplay2.default);
        _ol_render_webgl_TextReplay_.prototype.drawText = function(geometry, feature) {
            if (this.text_) {
                var flatCoordinates = null;
                var offset = 0;
                var end = 2;
                var stride = 2;
                switch (geometry.getType()) {
                  case _geometrytype2.default.POINT:
                  case _geometrytype2.default.MULTI_POINT:
                    flatCoordinates = geometry.getFlatCoordinates();
                    end = flatCoordinates.length;
                    stride = geometry.getStride();
                    break;

                  case _geometrytype2.default.CIRCLE:
                    flatCoordinates = geometry.getCenter();
                    break;

                  case _geometrytype2.default.LINE_STRING:
                    flatCoordinates = geometry.getFlatMidpoint();
                    break;

                  case _geometrytype2.default.MULTI_LINE_STRING:
                    flatCoordinates = geometry.getFlatMidpoints();
                    end = flatCoordinates.length;
                    break;

                  case _geometrytype2.default.POLYGON:
                    flatCoordinates = geometry.getFlatInteriorPoint();
                    break;

                  case _geometrytype2.default.MULTI_POLYGON:
                    flatCoordinates = geometry.getFlatInteriorPoints();
                    end = flatCoordinates.length;
                    break;

                  default:
                }
                this.startIndices.push(this.indices.length);
                this.startIndicesFeature.push(feature);
                var glyphAtlas = this.currAtlas_;
                var lines = this.text_.split("\n");
                var textSize = this.getTextSize_(lines);
                var i, ii, j, jj, currX, currY, charArr, charInfo;
                var anchorX = Math.round(textSize[0] * this.textAlign_ - this.offsetX_);
                var anchorY = Math.round(textSize[1] * this.textBaseline_ - this.offsetY_);
                var lineWidth = this.state_.lineWidth / 2 * this.state_.scale;
                for (i = 0, ii = lines.length; i < ii; ++i) {
                    currX = 0;
                    currY = glyphAtlas.height * i;
                    charArr = lines[i].split("");
                    for (j = 0, jj = charArr.length; j < jj; ++j) {
                        charInfo = glyphAtlas.atlas.getInfo(charArr[j]);
                        if (charInfo) {
                            var image = charInfo.image;
                            this.anchorX = anchorX - currX;
                            this.anchorY = anchorY - currY;
                            this.originX = j === 0 ? charInfo.offsetX - lineWidth : charInfo.offsetX;
                            this.originY = charInfo.offsetY;
                            this.height = glyphAtlas.height;
                            this.width = j === 0 || j === charArr.length - 1 ? glyphAtlas.width[charArr[j]] + lineWidth : glyphAtlas.width[charArr[j]];
                            this.imageHeight = image.height;
                            this.imageWidth = image.width;
                            var currentImage;
                            if (this.images_.length === 0) {
                                this.images_.push(image);
                            } else {
                                currentImage = this.images_[this.images_.length - 1];
                                if (_index2.default.getUid(currentImage) != _index2.default.getUid(image)) {
                                    this.groupIndices.push(this.indices.length);
                                    this.images_.push(image);
                                }
                            }
                            this.drawText_(flatCoordinates, offset, end, stride);
                        }
                        currX += this.width;
                    }
                }
            }
        };
        _ol_render_webgl_TextReplay_.prototype.getTextSize_ = function(lines) {
            var self = this;
            var glyphAtlas = this.currAtlas_;
            var textHeight = lines.length * glyphAtlas.height;
            var textWidth = lines.map(function(str) {
                var sum = 0;
                var i, ii;
                for (i = 0, ii = str.length; i < ii; ++i) {
                    var curr = str[i];
                    if (!glyphAtlas.width[curr]) {
                        self.addCharToAtlas_(curr);
                    }
                    sum += glyphAtlas.width[curr] ? glyphAtlas.width[curr] : 0;
                }
                return sum;
            }).reduce(function(max, curr) {
                return Math.max(max, curr);
            });
            return [ textWidth, textHeight ];
        };
        _ol_render_webgl_TextReplay_.prototype.drawText_ = function(flatCoordinates, offset, end, stride) {
            var i, ii;
            for (i = offset, ii = end; i < ii; i += stride) {
                this.drawCoordinates(flatCoordinates, offset, end, stride);
            }
        };
        _ol_render_webgl_TextReplay_.prototype.addCharToAtlas_ = function(char) {
            if (char.length === 1) {
                var glyphAtlas = this.currAtlas_;
                var state = this.state_;
                var mCtx = this.measureCanvas_.getContext("2d");
                mCtx.font = state.font;
                var width = Math.ceil(mCtx.measureText(char).width * state.scale);
                var info = glyphAtlas.atlas.add(char, width, glyphAtlas.height, function(ctx, x, y) {
                    ctx.font = state.font;
                    ctx.fillStyle = state.fillColor;
                    ctx.strokeStyle = state.strokeColor;
                    ctx.lineWidth = state.lineWidth;
                    ctx.lineCap = state.lineCap;
                    ctx.lineJoin = state.lineJoin;
                    ctx.miterLimit = state.miterLimit;
                    ctx.textAlign = "left";
                    ctx.textBaseline = "top";
                    if (_has2.default.CANVAS_LINE_DASH && state.lineDash) {
                        ctx.setLineDash(state.lineDash);
                        ctx.lineDashOffset = state.lineDashOffset;
                    }
                    if (state.scale !== 1) {
                        ctx.setTransform(state.scale, 0, 0, state.scale, 0, 0);
                    }
                    if (state.strokeColor) {
                        ctx.strokeText(char, x, y);
                    }
                    if (state.fillColor) {
                        ctx.fillText(char, x, y);
                    }
                });
                if (info) {
                    glyphAtlas.width[char] = width;
                }
            }
        };
        _ol_render_webgl_TextReplay_.prototype.finish = function(context) {
            var gl = context.getGL();
            this.groupIndices.push(this.indices.length);
            this.hitDetectionGroupIndices = this.groupIndices;
            this.verticesBuffer = new _buffer2.default(this.vertices);
            this.indicesBuffer = new _buffer2.default(this.indices);
            var texturePerImage = {};
            this.createTextures(this.textures_, this.images_, texturePerImage, gl);
            this.state_ = {
                strokeColor: null,
                lineCap: undefined,
                lineDash: null,
                lineDashOffset: undefined,
                lineJoin: undefined,
                lineWidth: 0,
                miterLimit: undefined,
                fillColor: null,
                font: undefined,
                scale: undefined
            };
            this.text_ = "";
            this.textAlign_ = undefined;
            this.textBaseline_ = undefined;
            this.offsetX_ = undefined;
            this.offsetY_ = undefined;
            this.images_ = null;
            this.atlases_ = {};
            this.currAtlas_ = undefined;
            _texturereplay2.default.prototype.finish.call(this, context);
        };
        _ol_render_webgl_TextReplay_.prototype.setTextStyle = function(textStyle) {
            var state = this.state_;
            var textFillStyle = textStyle.getFill();
            var textStrokeStyle = textStyle.getStroke();
            if (!textStyle || !textStyle.getText() || !textFillStyle && !textStrokeStyle) {
                this.text_ = "";
            } else {
                if (!textFillStyle) {
                    state.fillColor = null;
                } else {
                    var textFillStyleColor = textFillStyle.getColor();
                    state.fillColor = _colorlike2.default.asColorLike(textFillStyleColor ? textFillStyleColor : _webgl2.default.defaultFillStyle);
                }
                if (!textStrokeStyle) {
                    state.strokeColor = null;
                    state.lineWidth = 0;
                } else {
                    var textStrokeStyleColor = textStrokeStyle.getColor();
                    state.strokeColor = _colorlike2.default.asColorLike(textStrokeStyleColor ? textStrokeStyleColor : _webgl2.default.defaultStrokeStyle);
                    state.lineWidth = textStrokeStyle.getWidth() || _webgl2.default.defaultLineWidth;
                    state.lineCap = textStrokeStyle.getLineCap() || _webgl2.default.defaultLineCap;
                    state.lineDashOffset = textStrokeStyle.getLineDashOffset() || _webgl2.default.defaultLineDashOffset;
                    state.lineJoin = textStrokeStyle.getLineJoin() || _webgl2.default.defaultLineJoin;
                    state.miterLimit = textStrokeStyle.getMiterLimit() || _webgl2.default.defaultMiterLimit;
                    var lineDash = textStrokeStyle.getLineDash();
                    state.lineDash = lineDash ? lineDash.slice() : _webgl2.default.defaultLineDash;
                }
                state.font = textStyle.getFont() || _webgl2.default.defaultFont;
                state.scale = textStyle.getScale() || 1;
                this.text_ = textStyle.getText();
                var textAlign = _replay2.default.TEXT_ALIGN[textStyle.getTextAlign()];
                var textBaseline = _replay2.default.TEXT_ALIGN[textStyle.getTextBaseline()];
                this.textAlign_ = textAlign === undefined ? _webgl2.default.defaultTextAlign : textAlign;
                this.textBaseline_ = textBaseline === undefined ? _webgl2.default.defaultTextBaseline : textBaseline;
                this.offsetX_ = textStyle.getOffsetX() || 0;
                this.offsetY_ = textStyle.getOffsetY() || 0;
                this.rotateWithView = !!textStyle.getRotateWithView();
                this.rotation = textStyle.getRotation() || 0;
                this.currAtlas_ = this.getAtlas_(state);
            }
        };
        _ol_render_webgl_TextReplay_.prototype.getAtlas_ = function(state) {
            var params = [];
            var i;
            for (i in state) {
                if (state[i] || state[i] === 0) {
                    if (Array.isArray(state[i])) {
                        params = params.concat(state[i]);
                    } else {
                        params.push(state[i]);
                    }
                }
            }
            var hash = this.calculateHash_(params);
            if (!this.atlases_[hash]) {
                var mCtx = this.measureCanvas_.getContext("2d");
                mCtx.font = state.font;
                var height = Math.ceil((mCtx.measureText("M").width * 1.5 + state.lineWidth / 2) * state.scale);
                this.atlases_[hash] = {
                    atlas: new _atlasmanager2.default({
                        space: state.lineWidth + 1
                    }),
                    width: {},
                    height: height
                };
            }
            return this.atlases_[hash];
        };
        _ol_render_webgl_TextReplay_.prototype.calculateHash_ = function(params) {
            var i, ii;
            var hash = "";
            for (i = 0, ii = params.length; i < ii; ++i) {
                hash += params[i];
            }
            return hash;
        };
        _ol_render_webgl_TextReplay_.prototype.getTextures = function(opt_all) {
            return this.textures_;
        };
        _ol_render_webgl_TextReplay_.prototype.getHitDetectionTextures = function() {
            return this.textures_;
        };
        exports.default = _ol_render_webgl_TextReplay_;
    }, {
        "../../colorlike.js": 37,
        "../../dom.js": 46,
        "../../geom/geometrytype.js": 79,
        "../../has.js": 84,
        "../../index.js": 89,
        "../../style/atlasmanager.js": 223,
        "../../webgl/buffer.js": 249,
        "../replay.js": 161,
        "../webgl.js": 165,
        "../webgl/texturereplay.js": 180
    } ],
    180: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _obj = require("../../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _defaultshader = require("../webgl/texturereplay/defaultshader.js");
        var _defaultshader2 = _interopRequireDefault(_defaultshader);
        var _locations = require("../webgl/texturereplay/defaultshader/locations.js");
        var _locations2 = _interopRequireDefault(_locations);
        var _replay = require("../webgl/replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        var _webgl = require("../../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _context = require("../../webgl/context.js");
        var _context2 = _interopRequireDefault(_context);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_TextureReplay_ = function(tolerance, maxExtent) {
            _replay2.default.call(this, tolerance, maxExtent);
            this.anchorX = undefined;
            this.anchorY = undefined;
            this.groupIndices = [];
            this.hitDetectionGroupIndices = [];
            this.height = undefined;
            this.imageHeight = undefined;
            this.imageWidth = undefined;
            this.defaultLocations = null;
            this.opacity = undefined;
            this.originX = undefined;
            this.originY = undefined;
            this.rotateWithView = undefined;
            this.rotation = undefined;
            this.scale = undefined;
            this.width = undefined;
        };
        _index2.default.inherits(_ol_render_webgl_TextureReplay_, _replay2.default);
        _ol_render_webgl_TextureReplay_.prototype.getDeleteResourcesFunction = function(context) {
            var verticesBuffer = this.verticesBuffer;
            var indicesBuffer = this.indicesBuffer;
            var textures = this.getTextures(true);
            var gl = context.getGL();
            return function() {
                if (!gl.isContextLost()) {
                    var i, ii;
                    for (i = 0, ii = textures.length; i < ii; ++i) {
                        gl.deleteTexture(textures[i]);
                    }
                }
                context.deleteBuffer(verticesBuffer);
                context.deleteBuffer(indicesBuffer);
            };
        };
        _ol_render_webgl_TextureReplay_.prototype.drawCoordinates = function(flatCoordinates, offset, end, stride) {
            var anchorX = this.anchorX;
            var anchorY = this.anchorY;
            var height = this.height;
            var imageHeight = this.imageHeight;
            var imageWidth = this.imageWidth;
            var opacity = this.opacity;
            var originX = this.originX;
            var originY = this.originY;
            var rotateWithView = this.rotateWithView ? 1 : 0;
            var rotation = -this.rotation;
            var scale = this.scale;
            var width = this.width;
            var cos = Math.cos(rotation);
            var sin = Math.sin(rotation);
            var numIndices = this.indices.length;
            var numVertices = this.vertices.length;
            var i, n, offsetX, offsetY, x, y;
            for (i = offset; i < end; i += stride) {
                x = flatCoordinates[i] - this.origin[0];
                y = flatCoordinates[i + 1] - this.origin[1];
                n = numVertices / 8;
                offsetX = -scale * anchorX;
                offsetY = -scale * (height - anchorY);
                this.vertices[numVertices++] = x;
                this.vertices[numVertices++] = y;
                this.vertices[numVertices++] = offsetX * cos - offsetY * sin;
                this.vertices[numVertices++] = offsetX * sin + offsetY * cos;
                this.vertices[numVertices++] = originX / imageWidth;
                this.vertices[numVertices++] = (originY + height) / imageHeight;
                this.vertices[numVertices++] = opacity;
                this.vertices[numVertices++] = rotateWithView;
                offsetX = scale * (width - anchorX);
                offsetY = -scale * (height - anchorY);
                this.vertices[numVertices++] = x;
                this.vertices[numVertices++] = y;
                this.vertices[numVertices++] = offsetX * cos - offsetY * sin;
                this.vertices[numVertices++] = offsetX * sin + offsetY * cos;
                this.vertices[numVertices++] = (originX + width) / imageWidth;
                this.vertices[numVertices++] = (originY + height) / imageHeight;
                this.vertices[numVertices++] = opacity;
                this.vertices[numVertices++] = rotateWithView;
                offsetX = scale * (width - anchorX);
                offsetY = scale * anchorY;
                this.vertices[numVertices++] = x;
                this.vertices[numVertices++] = y;
                this.vertices[numVertices++] = offsetX * cos - offsetY * sin;
                this.vertices[numVertices++] = offsetX * sin + offsetY * cos;
                this.vertices[numVertices++] = (originX + width) / imageWidth;
                this.vertices[numVertices++] = originY / imageHeight;
                this.vertices[numVertices++] = opacity;
                this.vertices[numVertices++] = rotateWithView;
                offsetX = -scale * anchorX;
                offsetY = scale * anchorY;
                this.vertices[numVertices++] = x;
                this.vertices[numVertices++] = y;
                this.vertices[numVertices++] = offsetX * cos - offsetY * sin;
                this.vertices[numVertices++] = offsetX * sin + offsetY * cos;
                this.vertices[numVertices++] = originX / imageWidth;
                this.vertices[numVertices++] = originY / imageHeight;
                this.vertices[numVertices++] = opacity;
                this.vertices[numVertices++] = rotateWithView;
                this.indices[numIndices++] = n;
                this.indices[numIndices++] = n + 1;
                this.indices[numIndices++] = n + 2;
                this.indices[numIndices++] = n;
                this.indices[numIndices++] = n + 2;
                this.indices[numIndices++] = n + 3;
            }
            return numVertices;
        };
        _ol_render_webgl_TextureReplay_.prototype.createTextures = function(textures, images, texturePerImage, gl) {
            var texture, image, uid, i;
            var ii = images.length;
            for (i = 0; i < ii; ++i) {
                image = images[i];
                uid = _index2.default.getUid(image).toString();
                if (uid in texturePerImage) {
                    texture = texturePerImage[uid];
                } else {
                    texture = _context2.default.createTexture(gl, image, _webgl2.default.CLAMP_TO_EDGE, _webgl2.default.CLAMP_TO_EDGE);
                    texturePerImage[uid] = texture;
                }
                textures[i] = texture;
            }
        };
        _ol_render_webgl_TextureReplay_.prototype.setUpProgram = function(gl, context, size, pixelRatio) {
            var fragmentShader = _defaultshader2.default.fragment;
            var vertexShader = _defaultshader2.default.vertex;
            var program = context.getProgram(fragmentShader, vertexShader);
            var locations;
            if (!this.defaultLocations) {
                locations = new _locations2.default(gl, program);
                this.defaultLocations = locations;
            } else {
                locations = this.defaultLocations;
            }
            context.useProgram(program);
            gl.enableVertexAttribArray(locations.a_position);
            gl.vertexAttribPointer(locations.a_position, 2, _webgl2.default.FLOAT, false, 32, 0);
            gl.enableVertexAttribArray(locations.a_offsets);
            gl.vertexAttribPointer(locations.a_offsets, 2, _webgl2.default.FLOAT, false, 32, 8);
            gl.enableVertexAttribArray(locations.a_texCoord);
            gl.vertexAttribPointer(locations.a_texCoord, 2, _webgl2.default.FLOAT, false, 32, 16);
            gl.enableVertexAttribArray(locations.a_opacity);
            gl.vertexAttribPointer(locations.a_opacity, 1, _webgl2.default.FLOAT, false, 32, 24);
            gl.enableVertexAttribArray(locations.a_rotateWithView);
            gl.vertexAttribPointer(locations.a_rotateWithView, 1, _webgl2.default.FLOAT, false, 32, 28);
            return locations;
        };
        _ol_render_webgl_TextureReplay_.prototype.shutDownProgram = function(gl, locations) {
            gl.disableVertexAttribArray(locations.a_position);
            gl.disableVertexAttribArray(locations.a_offsets);
            gl.disableVertexAttribArray(locations.a_texCoord);
            gl.disableVertexAttribArray(locations.a_opacity);
            gl.disableVertexAttribArray(locations.a_rotateWithView);
        };
        _ol_render_webgl_TextureReplay_.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {
            var textures = hitDetection ? this.getHitDetectionTextures() : this.getTextures();
            var groupIndices = hitDetection ? this.hitDetectionGroupIndices : this.groupIndices;
            if (!_obj2.default.isEmpty(skippedFeaturesHash)) {
                this.drawReplaySkipping(gl, context, skippedFeaturesHash, textures, groupIndices);
            } else {
                var i, ii, start;
                for (i = 0, ii = textures.length, start = 0; i < ii; ++i) {
                    gl.bindTexture(_webgl2.default.TEXTURE_2D, textures[i]);
                    var end = groupIndices[i];
                    this.drawElements(gl, context, start, end);
                    start = end;
                }
            }
        };
        _ol_render_webgl_TextureReplay_.prototype.drawReplaySkipping = function(gl, context, skippedFeaturesHash, textures, groupIndices) {
            var featureIndex = 0;
            var i, ii;
            for (i = 0, ii = textures.length; i < ii; ++i) {
                gl.bindTexture(_webgl2.default.TEXTURE_2D, textures[i]);
                var groupStart = i > 0 ? groupIndices[i - 1] : 0;
                var groupEnd = groupIndices[i];
                var start = groupStart;
                var end = groupStart;
                while (featureIndex < this.startIndices.length && this.startIndices[featureIndex] <= groupEnd) {
                    var feature = this.startIndicesFeature[featureIndex];
                    var featureUid = _index2.default.getUid(feature).toString();
                    if (skippedFeaturesHash[featureUid] !== undefined) {
                        if (start !== end) {
                            this.drawElements(gl, context, start, end);
                        }
                        start = featureIndex === this.startIndices.length - 1 ? groupEnd : this.startIndices[featureIndex + 1];
                        end = start;
                    } else {
                        end = featureIndex === this.startIndices.length - 1 ? groupEnd : this.startIndices[featureIndex + 1];
                    }
                    featureIndex++;
                }
                if (start !== end) {
                    this.drawElements(gl, context, start, end);
                }
            }
        };
        _ol_render_webgl_TextureReplay_.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {
            var i, groupStart, start, end, feature, featureUid;
            var featureIndex = this.startIndices.length - 1;
            var hitDetectionTextures = this.getHitDetectionTextures();
            for (i = hitDetectionTextures.length - 1; i >= 0; --i) {
                gl.bindTexture(_webgl2.default.TEXTURE_2D, hitDetectionTextures[i]);
                groupStart = i > 0 ? this.hitDetectionGroupIndices[i - 1] : 0;
                end = this.hitDetectionGroupIndices[i];
                while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {
                    start = this.startIndices[featureIndex];
                    feature = this.startIndicesFeature[featureIndex];
                    featureUid = _index2.default.getUid(feature).toString();
                    if (skippedFeaturesHash[featureUid] === undefined && feature.getGeometry() && (opt_hitExtent === undefined || _extent2.default.intersects(opt_hitExtent, feature.getGeometry().getExtent()))) {
                        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
                        this.drawElements(gl, context, start, end);
                        var result = featureCallback(feature);
                        if (result) {
                            return result;
                        }
                    }
                    end = start;
                    featureIndex--;
                }
            }
            return undefined;
        };
        _ol_render_webgl_TextureReplay_.prototype.finish = function(context) {
            this.anchorX = undefined;
            this.anchorY = undefined;
            this.height = undefined;
            this.imageHeight = undefined;
            this.imageWidth = undefined;
            this.indices = null;
            this.opacity = undefined;
            this.originX = undefined;
            this.originY = undefined;
            this.rotateWithView = undefined;
            this.rotation = undefined;
            this.scale = undefined;
            this.vertices = null;
            this.width = undefined;
        };
        _ol_render_webgl_TextureReplay_.prototype.getTextures = function(opt_all) {};
        _ol_render_webgl_TextureReplay_.prototype.getHitDetectionTextures = function() {};
        exports.default = _ol_render_webgl_TextureReplay_;
    }, {
        "../../extent.js": 54,
        "../../index.js": 89,
        "../../obj.js": 124,
        "../../webgl.js": 248,
        "../../webgl/context.js": 250,
        "../webgl/replay.js": 177,
        "../webgl/texturereplay/defaultshader.js": 181,
        "../webgl/texturereplay/defaultshader/locations.js": 182
    } ],
    181: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _fragment = require("../../../webgl/fragment.js");
        var _fragment2 = _interopRequireDefault(_fragment);
        var _vertex = require("../../../webgl/vertex.js");
        var _vertex2 = _interopRequireDefault(_vertex);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_texturereplay_defaultshader_ = {};
        _ol_render_webgl_texturereplay_defaultshader_.fragment = new _fragment2.default(_index2.default.DEBUG_WEBGL ? "precision mediump float;\nvarying vec2 v_texCoord;\nvarying float v_opacity;\n\nuniform float u_opacity;\nuniform sampler2D u_image;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  float alpha = texColor.a * v_opacity * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n" : "precision mediump float;varying vec2 a;varying float b;uniform float k;uniform sampler2D l;void main(void){vec4 texColor=texture2D(l,a);gl_FragColor.rgb=texColor.rgb;float alpha=texColor.a*b*k;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}");
        _ol_render_webgl_texturereplay_defaultshader_.vertex = new _vertex2.default(_index2.default.DEBUG_WEBGL ? "varying vec2 v_texCoord;\nvarying float v_opacity;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nattribute vec2 a_offsets;\nattribute float a_opacity;\nattribute float a_rotateWithView;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix;\n  if (a_rotateWithView == 1.0) {\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  }\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n  v_texCoord = a_texCoord;\n  v_opacity = a_opacity;\n}\n\n\n" : "varying vec2 a;varying float b;attribute vec2 c;attribute vec2 d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;void main(void){mat4 offsetMatrix=i;if(g==1.0){offsetMatrix=i*j;}vec4 offsets=offsetMatrix*vec4(e,0.0,0.0);gl_Position=h*vec4(c,0.0,1.0)+offsets;a=d;b=f;}");
        exports.default = _ol_render_webgl_texturereplay_defaultshader_;
    }, {
        "../../../index.js": 89,
        "../../../webgl/fragment.js": 252,
        "../../../webgl/vertex.js": 254
    } ],
    182: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../../../index.js");
        var _index2 = _interopRequireDefault(_index);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_render_webgl_texturereplay_defaultshader_Locations_ = function(gl, program) {
            this.u_projectionMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_projectionMatrix" : "h");
            this.u_offsetScaleMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_offsetScaleMatrix" : "i");
            this.u_offsetRotateMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_offsetRotateMatrix" : "j");
            this.u_opacity = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_opacity" : "k");
            this.u_image = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_image" : "l");
            this.a_position = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_position" : "c");
            this.a_texCoord = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_texCoord" : "d");
            this.a_offsets = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_offsets" : "e");
            this.a_opacity = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_opacity" : "f");
            this.a_rotateWithView = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_rotateWithView" : "g");
        };
        exports.default = _ol_render_webgl_texturereplay_defaultshader_Locations_;
    }, {
        "../../../../index.js": 89
    } ],
    183: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _imagecanvas = require("../../imagecanvas.js");
        var _imagecanvas2 = _interopRequireDefault(_imagecanvas);
        var _layertype = require("../../layertype.js");
        var _layertype2 = _interopRequireDefault(_layertype);
        var _viewhint = require("../../viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _vectorrendertype = require("../../layer/vectorrendertype.js");
        var _vectorrendertype2 = _interopRequireDefault(_vectorrendertype);
        var _obj = require("../../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _plugins = require("../../plugins.js");
        var _plugins2 = _interopRequireDefault(_plugins);
        var _type = require("../type.js");
        var _type2 = _interopRequireDefault(_type);
        var _intermediatecanvas = require("../canvas/intermediatecanvas.js");
        var _intermediatecanvas2 = _interopRequireDefault(_intermediatecanvas);
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_canvas_ImageLayer_ = function(imageLayer) {
            _intermediatecanvas2.default.call(this, imageLayer);
            this.image_ = null;
            this.imageTransform_ = _transform2.default.create();
            this.skippedFeatures_ = [];
            this.vectorRenderer_ = null;
        };
        _index2.default.inherits(_ol_renderer_canvas_ImageLayer_, _intermediatecanvas2.default);
        _ol_renderer_canvas_ImageLayer_["handles"] = function(type, layer) {
            return type === _type2.default.CANVAS && (layer.getType() === _layertype2.default.IMAGE || layer.getType() === _layertype2.default.VECTOR && layer.getRenderMode() === _vectorrendertype2.default.IMAGE);
        };
        _ol_renderer_canvas_ImageLayer_["create"] = function(mapRenderer, layer) {
            var renderer = new _ol_renderer_canvas_ImageLayer_(layer);
            if (layer.getType() === _layertype2.default.VECTOR) {
                var candidates = _plugins2.default.getLayerRendererPlugins();
                for (var i = 0, ii = candidates.length; i < ii; ++i) {
                    var candidate = candidates[i];
                    if (candidate !== _ol_renderer_canvas_ImageLayer_ && candidate["handles"](_type2.default.CANVAS, layer)) {
                        renderer.setVectorRenderer(candidate["create"](mapRenderer, layer));
                    }
                }
            }
            return renderer;
        };
        _ol_renderer_canvas_ImageLayer_.prototype.getImage = function() {
            return !this.image_ ? null : this.image_.getImage();
        };
        _ol_renderer_canvas_ImageLayer_.prototype.getImageTransform = function() {
            return this.imageTransform_;
        };
        _ol_renderer_canvas_ImageLayer_.prototype.prepareFrame = function(frameState, layerState) {
            var pixelRatio = frameState.pixelRatio;
            var size = frameState.size;
            var viewState = frameState.viewState;
            var viewCenter = viewState.center;
            var viewResolution = viewState.resolution;
            var image;
            var imageLayer = this.getLayer();
            var imageSource = imageLayer.getSource();
            var hints = frameState.viewHints;
            var renderedExtent = frameState.extent;
            if (layerState.extent !== undefined) {
                renderedExtent = _extent2.default.getIntersection(renderedExtent, layerState.extent);
            }
            if (!hints[_viewhint2.default.ANIMATING] && !hints[_viewhint2.default.INTERACTING] && !_extent2.default.isEmpty(renderedExtent)) {
                var projection = viewState.projection;
                if (!_index2.default.ENABLE_RASTER_REPROJECTION) {
                    var sourceProjection = imageSource.getProjection();
                    if (sourceProjection) {
                        projection = sourceProjection;
                    }
                }
                var vectorRenderer = this.vectorRenderer_;
                if (vectorRenderer) {
                    var context = vectorRenderer.context;
                    var imageFrameState = _obj2.default.assign({}, frameState, {
                        size: [ _extent2.default.getWidth(renderedExtent) / viewResolution, _extent2.default.getHeight(renderedExtent) / viewResolution ],
                        viewState: _obj2.default.assign({}, frameState.viewState, {
                            rotation: 0
                        })
                    });
                    var skippedFeatures = Object.keys(imageFrameState.skippedFeatureUids).sort();
                    if (vectorRenderer.prepareFrame(imageFrameState, layerState) && (vectorRenderer.replayGroupChanged || !_array2.default.equals(skippedFeatures, this.skippedFeatures_))) {
                        context.canvas.width = imageFrameState.size[0] * pixelRatio;
                        context.canvas.height = imageFrameState.size[1] * pixelRatio;
                        vectorRenderer.composeFrame(imageFrameState, layerState, context);
                        this.image_ = new _imagecanvas2.default(renderedExtent, viewResolution, pixelRatio, context.canvas);
                        this.skippedFeatures_ = skippedFeatures;
                    }
                } else {
                    image = imageSource.getImage(renderedExtent, viewResolution, pixelRatio, projection);
                    if (image) {
                        var loaded = this.loadImage(image);
                        if (loaded) {
                            this.image_ = image;
                        }
                    }
                }
            }
            if (this.image_) {
                image = this.image_;
                var imageExtent = image.getExtent();
                var imageResolution = image.getResolution();
                var imagePixelRatio = image.getPixelRatio();
                var scale = pixelRatio * imageResolution / (viewResolution * imagePixelRatio);
                var transform = _transform2.default.compose(this.imageTransform_, pixelRatio * size[0] / 2, pixelRatio * size[1] / 2, scale, scale, 0, imagePixelRatio * (imageExtent[0] - viewCenter[0]) / imageResolution, imagePixelRatio * (viewCenter[1] - imageExtent[3]) / imageResolution);
                _transform2.default.compose(this.coordinateToCanvasPixelTransform, pixelRatio * size[0] / 2 - transform[4], pixelRatio * size[1] / 2 - transform[5], pixelRatio / viewResolution, -pixelRatio / viewResolution, 0, -viewCenter[0], -viewCenter[1]);
                this.updateLogos(frameState, imageSource);
                this.renderedResolution = imageResolution * pixelRatio / imagePixelRatio;
            }
            return !!this.image_;
        };
        _ol_renderer_canvas_ImageLayer_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {
            if (this.vectorRenderer_) {
                return this.vectorRenderer_.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, callback, thisArg);
            } else {
                return _intermediatecanvas2.default.prototype.forEachFeatureAtCoordinate.call(this, coordinate, frameState, hitTolerance, callback, thisArg);
            }
        };
        _ol_renderer_canvas_ImageLayer_.prototype.setVectorRenderer = function(renderer) {
            this.vectorRenderer_ = renderer;
        };
        exports.default = _ol_renderer_canvas_ImageLayer_;
    }, {
        "../../array.js": 29,
        "../../extent.js": 54,
        "../../imagecanvas.js": 87,
        "../../index.js": 89,
        "../../layer/vectorrendertype.js": 111,
        "../../layertype.js": 113,
        "../../obj.js": 124,
        "../../plugins.js": 131,
        "../../transform.js": 243,
        "../../viewhint.js": 246,
        "../canvas/intermediatecanvas.js": 184,
        "../type.js": 192
    } ],
    184: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _coordinate = require("../../coordinate.js");
        var _coordinate2 = _interopRequireDefault(_coordinate);
        var _dom = require("../../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _layer = require("../canvas/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_canvas_IntermediateCanvas_ = function(layer) {
            _layer2.default.call(this, layer);
            this.coordinateToCanvasPixelTransform = _transform2.default.create();
            this.hitCanvasContext_ = null;
        };
        _index2.default.inherits(_ol_renderer_canvas_IntermediateCanvas_, _layer2.default);
        _ol_renderer_canvas_IntermediateCanvas_.prototype.composeFrame = function(frameState, layerState, context) {
            this.preCompose(context, frameState);
            var image = this.getImage();
            if (image) {
                var extent = layerState.extent;
                var clipped = extent !== undefined && !_extent2.default.containsExtent(extent, frameState.extent) && _extent2.default.intersects(extent, frameState.extent);
                if (clipped) {
                    this.clip(context, frameState, extent);
                }
                var imageTransform = this.getImageTransform();
                var alpha = context.globalAlpha;
                context.globalAlpha = layerState.opacity;
                var dx = imageTransform[4];
                var dy = imageTransform[5];
                var dw = image.width * imageTransform[0];
                var dh = image.height * imageTransform[3];
                context.drawImage(image, 0, 0, +image.width, +image.height, Math.round(dx), Math.round(dy), Math.round(dw), Math.round(dh));
                context.globalAlpha = alpha;
                if (clipped) {
                    context.restore();
                }
            }
            this.postCompose(context, frameState, layerState);
        };
        _ol_renderer_canvas_IntermediateCanvas_.prototype.getImage = function() {};
        _ol_renderer_canvas_IntermediateCanvas_.prototype.getImageTransform = function() {};
        _ol_renderer_canvas_IntermediateCanvas_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {
            var layer = this.getLayer();
            var source = layer.getSource();
            var resolution = frameState.viewState.resolution;
            var rotation = frameState.viewState.rotation;
            var skippedFeatureUids = frameState.skippedFeatureUids;
            return source.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, skippedFeatureUids, function(feature) {
                return callback.call(thisArg, feature, layer);
            });
        };
        _ol_renderer_canvas_IntermediateCanvas_.prototype.forEachLayerAtCoordinate = function(coordinate, frameState, callback, thisArg) {
            if (!this.getImage()) {
                return undefined;
            }
            if (this.getLayer().getSource().forEachFeatureAtCoordinate !== _index2.default.nullFunction) {
                return _layer2.default.prototype.forEachLayerAtCoordinate.apply(this, arguments);
            } else {
                var pixel = _transform2.default.apply(this.coordinateToCanvasPixelTransform, coordinate.slice());
                _coordinate2.default.scale(pixel, frameState.viewState.resolution / this.renderedResolution);
                if (!this.hitCanvasContext_) {
                    this.hitCanvasContext_ = _dom2.default.createCanvasContext2D(1, 1);
                }
                this.hitCanvasContext_.clearRect(0, 0, 1, 1);
                this.hitCanvasContext_.drawImage(this.getImage(), pixel[0], pixel[1], 1, 1, 0, 0, 1, 1);
                var imageData = this.hitCanvasContext_.getImageData(0, 0, 1, 1).data;
                if (imageData[3] > 0) {
                    return callback.call(thisArg, this.getLayer(), imageData);
                } else {
                    return undefined;
                }
            }
        };
        exports.default = _ol_renderer_canvas_IntermediateCanvas_;
    }, {
        "../../coordinate.js": 43,
        "../../dom.js": 46,
        "../../extent.js": 54,
        "../../index.js": 89,
        "../../transform.js": 243,
        "../canvas/layer.js": 185
    } ],
    185: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _functions = require("../../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _event = require("../../render/event.js");
        var _event2 = _interopRequireDefault(_event);
        var _eventtype = require("../../render/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _canvas = require("../../render/canvas.js");
        var _canvas2 = _interopRequireDefault(_canvas);
        var _immediate = require("../../render/canvas/immediate.js");
        var _immediate2 = _interopRequireDefault(_immediate);
        var _layer = require("../layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_canvas_Layer_ = function(layer) {
            _layer2.default.call(this, layer);
            this.renderedResolution;
            this.transform_ = _transform2.default.create();
        };
        _index2.default.inherits(_ol_renderer_canvas_Layer_, _layer2.default);
        _ol_renderer_canvas_Layer_.prototype.clip = function(context, frameState, extent) {
            var pixelRatio = frameState.pixelRatio;
            var width = frameState.size[0] * pixelRatio;
            var height = frameState.size[1] * pixelRatio;
            var rotation = frameState.viewState.rotation;
            var topLeft = _extent2.default.getTopLeft(extent);
            var topRight = _extent2.default.getTopRight(extent);
            var bottomRight = _extent2.default.getBottomRight(extent);
            var bottomLeft = _extent2.default.getBottomLeft(extent);
            _transform2.default.apply(frameState.coordinateToPixelTransform, topLeft);
            _transform2.default.apply(frameState.coordinateToPixelTransform, topRight);
            _transform2.default.apply(frameState.coordinateToPixelTransform, bottomRight);
            _transform2.default.apply(frameState.coordinateToPixelTransform, bottomLeft);
            context.save();
            _canvas2.default.rotateAtOffset(context, -rotation, width / 2, height / 2);
            context.beginPath();
            context.moveTo(topLeft[0] * pixelRatio, topLeft[1] * pixelRatio);
            context.lineTo(topRight[0] * pixelRatio, topRight[1] * pixelRatio);
            context.lineTo(bottomRight[0] * pixelRatio, bottomRight[1] * pixelRatio);
            context.lineTo(bottomLeft[0] * pixelRatio, bottomLeft[1] * pixelRatio);
            context.clip();
            _canvas2.default.rotateAtOffset(context, rotation, width / 2, height / 2);
        };
        _ol_renderer_canvas_Layer_.prototype.dispatchComposeEvent_ = function(type, context, frameState, opt_transform) {
            var layer = this.getLayer();
            if (layer.hasListener(type)) {
                var width = frameState.size[0] * frameState.pixelRatio;
                var height = frameState.size[1] * frameState.pixelRatio;
                var rotation = frameState.viewState.rotation;
                _canvas2.default.rotateAtOffset(context, -rotation, width / 2, height / 2);
                var transform = opt_transform !== undefined ? opt_transform : this.getTransform(frameState, 0);
                var render = new _immediate2.default(context, frameState.pixelRatio, frameState.extent, transform, frameState.viewState.rotation);
                var composeEvent = new _event2.default(type, render, frameState, context, null);
                layer.dispatchEvent(composeEvent);
                _canvas2.default.rotateAtOffset(context, rotation, width / 2, height / 2);
            }
        };
        _ol_renderer_canvas_Layer_.prototype.forEachLayerAtCoordinate = function(coordinate, frameState, callback, thisArg) {
            var hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, 0, _functions2.default.TRUE, this);
            if (hasFeature) {
                return callback.call(thisArg, this.getLayer(), null);
            } else {
                return undefined;
            }
        };
        _ol_renderer_canvas_Layer_.prototype.postCompose = function(context, frameState, layerState, opt_transform) {
            this.dispatchComposeEvent_(_eventtype2.default.POSTCOMPOSE, context, frameState, opt_transform);
        };
        _ol_renderer_canvas_Layer_.prototype.preCompose = function(context, frameState, opt_transform) {
            this.dispatchComposeEvent_(_eventtype2.default.PRECOMPOSE, context, frameState, opt_transform);
        };
        _ol_renderer_canvas_Layer_.prototype.dispatchRenderEvent = function(context, frameState, opt_transform) {
            this.dispatchComposeEvent_(_eventtype2.default.RENDER, context, frameState, opt_transform);
        };
        _ol_renderer_canvas_Layer_.prototype.getTransform = function(frameState, offsetX) {
            var viewState = frameState.viewState;
            var pixelRatio = frameState.pixelRatio;
            var dx1 = pixelRatio * frameState.size[0] / 2;
            var dy1 = pixelRatio * frameState.size[1] / 2;
            var sx = pixelRatio / viewState.resolution;
            var sy = -sx;
            var angle = -viewState.rotation;
            var dx2 = -viewState.center[0] + offsetX;
            var dy2 = -viewState.center[1];
            return _transform2.default.compose(this.transform_, dx1, dy1, sx, sy, angle, dx2, dy2);
        };
        _ol_renderer_canvas_Layer_.prototype.composeFrame = function(frameState, layerState, context) {};
        _ol_renderer_canvas_Layer_.prototype.prepareFrame = function(frameState, layerState) {};
        exports.default = _ol_renderer_canvas_Layer_;
    }, {
        "../../extent.js": 54,
        "../../functions.js": 60,
        "../../index.js": 89,
        "../../render/canvas.js": 150,
        "../../render/canvas/immediate.js": 152,
        "../../render/event.js": 159,
        "../../render/eventtype.js": 160,
        "../../transform.js": 243,
        "../layer.js": 190
    } ],
    186: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _css = require("../../css.js");
        var _css2 = _interopRequireDefault(_css);
        var _dom = require("../../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _layer = require("../../layer/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _event = require("../../render/event.js");
        var _event2 = _interopRequireDefault(_event);
        var _eventtype = require("../../render/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _canvas = require("../../render/canvas.js");
        var _canvas2 = _interopRequireDefault(_canvas);
        var _immediate = require("../../render/canvas/immediate.js");
        var _immediate2 = _interopRequireDefault(_immediate);
        var _map = require("../map.js");
        var _map2 = _interopRequireDefault(_map);
        var _type = require("../type.js");
        var _type2 = _interopRequireDefault(_type);
        var _state = require("../../source/state.js");
        var _state2 = _interopRequireDefault(_state);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_canvas_Map_ = function(container, map) {
            _map2.default.call(this, container, map);
            this.context_ = _dom2.default.createCanvasContext2D();
            this.canvas_ = this.context_.canvas;
            this.canvas_.style.width = "100%";
            this.canvas_.style.height = "100%";
            this.canvas_.style.display = "block";
            this.canvas_.className = _css2.default.CLASS_UNSELECTABLE;
            container.insertBefore(this.canvas_, container.childNodes[0] || null);
            this.renderedVisible_ = true;
            this.transform_ = _transform2.default.create();
        };
        _index2.default.inherits(_ol_renderer_canvas_Map_, _map2.default);
        _ol_renderer_canvas_Map_["handles"] = function(type) {
            return type === _type2.default.CANVAS;
        };
        _ol_renderer_canvas_Map_["create"] = function(container, map) {
            return new _ol_renderer_canvas_Map_(container, map);
        };
        _ol_renderer_canvas_Map_.prototype.dispatchComposeEvent_ = function(type, frameState) {
            var map = this.getMap();
            var context = this.context_;
            if (map.hasListener(type)) {
                var extent = frameState.extent;
                var pixelRatio = frameState.pixelRatio;
                var viewState = frameState.viewState;
                var rotation = viewState.rotation;
                var transform = this.getTransform(frameState);
                var vectorContext = new _immediate2.default(context, pixelRatio, extent, transform, rotation);
                var composeEvent = new _event2.default(type, vectorContext, frameState, context, null);
                map.dispatchEvent(composeEvent);
            }
        };
        _ol_renderer_canvas_Map_.prototype.getTransform = function(frameState) {
            var viewState = frameState.viewState;
            var dx1 = this.canvas_.width / 2;
            var dy1 = this.canvas_.height / 2;
            var sx = frameState.pixelRatio / viewState.resolution;
            var sy = -sx;
            var angle = -viewState.rotation;
            var dx2 = -viewState.center[0];
            var dy2 = -viewState.center[1];
            return _transform2.default.compose(this.transform_, dx1, dy1, sx, sy, angle, dx2, dy2);
        };
        _ol_renderer_canvas_Map_.prototype.getType = function() {
            return _type2.default.CANVAS;
        };
        _ol_renderer_canvas_Map_.prototype.renderFrame = function(frameState) {
            if (!frameState) {
                if (this.renderedVisible_) {
                    this.canvas_.style.display = "none";
                    this.renderedVisible_ = false;
                }
                return;
            }
            var context = this.context_;
            var pixelRatio = frameState.pixelRatio;
            var width = Math.round(frameState.size[0] * pixelRatio);
            var height = Math.round(frameState.size[1] * pixelRatio);
            if (this.canvas_.width != width || this.canvas_.height != height) {
                this.canvas_.width = width;
                this.canvas_.height = height;
            } else {
                context.clearRect(0, 0, width, height);
            }
            var rotation = frameState.viewState.rotation;
            this.calculateMatrices2D(frameState);
            this.dispatchComposeEvent_(_eventtype2.default.PRECOMPOSE, frameState);
            var layerStatesArray = frameState.layerStatesArray;
            _array2.default.stableSort(layerStatesArray, _map2.default.sortByZIndex);
            if (rotation) {
                context.save();
                _canvas2.default.rotateAtOffset(context, rotation, width / 2, height / 2);
            }
            var viewResolution = frameState.viewState.resolution;
            var i, ii, layer, layerRenderer, layerState;
            for (i = 0, ii = layerStatesArray.length; i < ii; ++i) {
                layerState = layerStatesArray[i];
                layer = layerState.layer;
                layerRenderer = this.getLayerRenderer(layer);
                if (!_layer2.default.visibleAtResolution(layerState, viewResolution) || layerState.sourceState != _state2.default.READY) {
                    continue;
                }
                if (layerRenderer.prepareFrame(frameState, layerState)) {
                    layerRenderer.composeFrame(frameState, layerState, context);
                }
            }
            if (rotation) {
                context.restore();
            }
            this.dispatchComposeEvent_(_eventtype2.default.POSTCOMPOSE, frameState);
            if (!this.renderedVisible_) {
                this.canvas_.style.display = "";
                this.renderedVisible_ = true;
            }
            this.scheduleRemoveUnusedLayerRenderers(frameState);
            this.scheduleExpireIconCache(frameState);
        };
        _ol_renderer_canvas_Map_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg, layerFilter, thisArg2) {
            var result;
            var viewState = frameState.viewState;
            var viewResolution = viewState.resolution;
            var layerStates = frameState.layerStatesArray;
            var numLayers = layerStates.length;
            var coordinate = _transform2.default.apply(frameState.pixelToCoordinateTransform, pixel.slice());
            var i;
            for (i = numLayers - 1; i >= 0; --i) {
                var layerState = layerStates[i];
                var layer = layerState.layer;
                if (_layer2.default.visibleAtResolution(layerState, viewResolution) && layerFilter.call(thisArg2, layer)) {
                    var layerRenderer = this.getLayerRenderer(layer);
                    result = layerRenderer.forEachLayerAtCoordinate(coordinate, frameState, callback, thisArg);
                    if (result) {
                        return result;
                    }
                }
            }
            return undefined;
        };
        exports.default = _ol_renderer_canvas_Map_;
    }, {
        "../../array.js": 29,
        "../../css.js": 44,
        "../../dom.js": 46,
        "../../index.js": 89,
        "../../layer/layer.js": 108,
        "../../render/canvas.js": 150,
        "../../render/canvas/immediate.js": 152,
        "../../render/event.js": 159,
        "../../render/eventtype.js": 160,
        "../../source/state.js": 212,
        "../../transform.js": 243,
        "../map.js": 191,
        "../type.js": 192
    } ],
    187: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _layertype = require("../../layertype.js");
        var _layertype2 = _interopRequireDefault(_layertype);
        var _tilerange = require("../../tilerange.js");
        var _tilerange2 = _interopRequireDefault(_tilerange);
        var _tilestate = require("../../tilestate.js");
        var _tilestate2 = _interopRequireDefault(_tilestate);
        var _viewhint = require("../../viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _dom = require("../../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _type = require("../type.js");
        var _type2 = _interopRequireDefault(_type);
        var _intermediatecanvas = require("../canvas/intermediatecanvas.js");
        var _intermediatecanvas2 = _interopRequireDefault(_intermediatecanvas);
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_canvas_TileLayer_ = function(tileLayer) {
            _intermediatecanvas2.default.call(this, tileLayer);
            this.context = this.context === null ? null : _dom2.default.createCanvasContext2D();
            this.oversampling_;
            this.renderedExtent_ = null;
            this.renderedRevision;
            this.renderedTiles = [];
            this.tmpExtent = _extent2.default.createEmpty();
            this.tmpTileRange_ = new _tilerange2.default(0, 0, 0, 0);
            this.imageTransform_ = _transform2.default.create();
            this.zDirection = 0;
        };
        _index2.default.inherits(_ol_renderer_canvas_TileLayer_, _intermediatecanvas2.default);
        _ol_renderer_canvas_TileLayer_["handles"] = function(type, layer) {
            return type === _type2.default.CANVAS && layer.getType() === _layertype2.default.TILE;
        };
        _ol_renderer_canvas_TileLayer_["create"] = function(mapRenderer, layer) {
            return new _ol_renderer_canvas_TileLayer_(layer);
        };
        _ol_renderer_canvas_TileLayer_.prototype.isDrawableTile_ = function(tile) {
            var tileState = tile.getState();
            var useInterimTilesOnError = this.getLayer().getUseInterimTilesOnError();
            return tileState == _tilestate2.default.LOADED || tileState == _tilestate2.default.EMPTY || tileState == _tilestate2.default.ERROR && !useInterimTilesOnError;
        };
        _ol_renderer_canvas_TileLayer_.prototype.prepareFrame = function(frameState, layerState) {
            var pixelRatio = frameState.pixelRatio;
            var size = frameState.size;
            var viewState = frameState.viewState;
            var projection = viewState.projection;
            var viewResolution = viewState.resolution;
            var viewCenter = viewState.center;
            var tileLayer = this.getLayer();
            var tileSource = tileLayer.getSource();
            var sourceRevision = tileSource.getRevision();
            var tileGrid = tileSource.getTileGridForProjection(projection);
            var z = tileGrid.getZForResolution(viewResolution, this.zDirection);
            var tileResolution = tileGrid.getResolution(z);
            var oversampling = Math.round(viewResolution / tileResolution) || 1;
            var extent = frameState.extent;
            if (layerState.extent !== undefined) {
                extent = _extent2.default.getIntersection(extent, layerState.extent);
            }
            if (_extent2.default.isEmpty(extent)) {
                return false;
            }
            var tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);
            var imageExtent = tileGrid.getTileRangeExtent(z, tileRange);
            var tilePixelRatio = tileSource.getTilePixelRatio(pixelRatio);
            var tilesToDrawByZ = {};
            tilesToDrawByZ[z] = {};
            var findLoadedTiles = this.createLoadedTileFinder(tileSource, projection, tilesToDrawByZ);
            var tmpExtent = this.tmpExtent;
            var tmpTileRange = this.tmpTileRange_;
            var newTiles = false;
            var tile, x, y;
            for (x = tileRange.minX; x <= tileRange.maxX; ++x) {
                for (y = tileRange.minY; y <= tileRange.maxY; ++y) {
                    tile = tileSource.getTile(z, x, y, pixelRatio, projection);
                    if (tile.getState() == _tilestate2.default.ERROR) {
                        if (!tileLayer.getUseInterimTilesOnError()) {
                            tile.setState(_tilestate2.default.LOADED);
                        } else if (tileLayer.getPreload() > 0) {
                            newTiles = true;
                        }
                    }
                    if (!this.isDrawableTile_(tile)) {
                        tile = tile.getInterimTile();
                    }
                    if (this.isDrawableTile_(tile)) {
                        var uid = _index2.default.getUid(this);
                        if (tile.getState() == _tilestate2.default.LOADED) {
                            tilesToDrawByZ[z][tile.tileCoord.toString()] = tile;
                            var inTransition = tile.inTransition(uid);
                            if (!newTiles && (inTransition || this.renderedTiles.indexOf(tile) === -1)) {
                                newTiles = true;
                            }
                        }
                        if (tile.getAlpha(uid, frameState.time) === 1) {
                            continue;
                        }
                    }
                    var childTileRange = tileGrid.getTileCoordChildTileRange(tile.tileCoord, tmpTileRange, tmpExtent);
                    var covered = false;
                    if (childTileRange) {
                        covered = findLoadedTiles(z + 1, childTileRange);
                    }
                    if (!covered) {
                        tileGrid.forEachTileCoordParentTileRange(tile.tileCoord, findLoadedTiles, null, tmpTileRange, tmpExtent);
                    }
                }
            }
            var renderedResolution = tileResolution * pixelRatio / tilePixelRatio * oversampling;
            var hints = frameState.viewHints;
            var animatingOrInteracting = hints[_viewhint2.default.ANIMATING] || hints[_viewhint2.default.INTERACTING];
            if (!(this.renderedResolution && Date.now() - frameState.time > 16 && animatingOrInteracting) && (newTiles || !(this.renderedExtent_ && _extent2.default.containsExtent(this.renderedExtent_, extent)) || this.renderedRevision != sourceRevision || oversampling != this.oversampling_ || !animatingOrInteracting && renderedResolution != this.renderedResolution)) {
                var context = this.context;
                if (context) {
                    var tilePixelSize = tileSource.getTilePixelSize(z, pixelRatio, projection);
                    var width = Math.round(tileRange.getWidth() * tilePixelSize[0] / oversampling);
                    var height = Math.round(tileRange.getHeight() * tilePixelSize[1] / oversampling);
                    var canvas = context.canvas;
                    if (canvas.width != width || canvas.height != height) {
                        this.oversampling_ = oversampling;
                        canvas.width = width;
                        canvas.height = height;
                    } else {
                        if (this.renderedExtent_ && !_extent2.default.equals(imageExtent, this.renderedExtent_)) {
                            context.clearRect(0, 0, width, height);
                        }
                        oversampling = this.oversampling_;
                    }
                }
                this.renderedTiles.length = 0;
                var zs = Object.keys(tilesToDrawByZ).map(Number);
                zs.sort(function(a, b) {
                    if (a === z) {
                        return 1;
                    } else if (b === z) {
                        return -1;
                    } else {
                        return a > b ? 1 : a < b ? -1 : 0;
                    }
                });
                var currentResolution, currentScale, currentTilePixelSize, currentZ, i, ii;
                var tileExtent, tileGutter, tilesToDraw, w, h;
                for (i = 0, ii = zs.length; i < ii; ++i) {
                    currentZ = zs[i];
                    currentTilePixelSize = tileSource.getTilePixelSize(currentZ, pixelRatio, projection);
                    currentResolution = tileGrid.getResolution(currentZ);
                    currentScale = currentResolution / tileResolution;
                    tileGutter = tilePixelRatio * tileSource.getGutter(projection);
                    tilesToDraw = tilesToDrawByZ[currentZ];
                    for (var tileCoordKey in tilesToDraw) {
                        tile = tilesToDraw[tileCoordKey];
                        tileExtent = tileGrid.getTileCoordExtent(tile.getTileCoord(), tmpExtent);
                        x = (tileExtent[0] - imageExtent[0]) / tileResolution * tilePixelRatio / oversampling;
                        y = (imageExtent[3] - tileExtent[3]) / tileResolution * tilePixelRatio / oversampling;
                        w = currentTilePixelSize[0] * currentScale / oversampling;
                        h = currentTilePixelSize[1] * currentScale / oversampling;
                        this.drawTileImage(tile, frameState, layerState, x, y, w, h, tileGutter, z === currentZ);
                        this.renderedTiles.push(tile);
                    }
                }
                this.renderedRevision = sourceRevision;
                this.renderedResolution = tileResolution * pixelRatio / tilePixelRatio * oversampling;
                this.renderedExtent_ = imageExtent;
            }
            var scale = this.renderedResolution / viewResolution;
            var transform = _transform2.default.compose(this.imageTransform_, pixelRatio * size[0] / 2, pixelRatio * size[1] / 2, scale, scale, 0, (this.renderedExtent_[0] - viewCenter[0]) / this.renderedResolution * pixelRatio, (viewCenter[1] - this.renderedExtent_[3]) / this.renderedResolution * pixelRatio);
            _transform2.default.compose(this.coordinateToCanvasPixelTransform, pixelRatio * size[0] / 2 - transform[4], pixelRatio * size[1] / 2 - transform[5], pixelRatio / viewResolution, -pixelRatio / viewResolution, 0, -viewCenter[0], -viewCenter[1]);
            this.updateUsedTiles(frameState.usedTiles, tileSource, z, tileRange);
            this.manageTilePyramid(frameState, tileSource, tileGrid, pixelRatio, projection, extent, z, tileLayer.getPreload());
            this.scheduleExpireCache(frameState, tileSource);
            this.updateLogos(frameState, tileSource);
            return this.renderedTiles.length > 0;
        };
        _ol_renderer_canvas_TileLayer_.prototype.drawTileImage = function(tile, frameState, layerState, x, y, w, h, gutter, transition) {
            var image = tile.getImage(this.getLayer());
            if (!image) {
                return;
            }
            var uid = _index2.default.getUid(this);
            var alpha = transition ? tile.getAlpha(uid, frameState.time) : 1;
            if (alpha === 1 && !this.getLayer().getSource().getOpaque(frameState.viewState.projection)) {
                this.context.clearRect(x, y, w, h);
            }
            var alphaChanged = alpha !== this.context.globalAlpha;
            if (alphaChanged) {
                this.context.save();
                this.context.globalAlpha = alpha;
            }
            this.context.drawImage(image, gutter, gutter, image.width - 2 * gutter, image.height - 2 * gutter, x, y, w, h);
            if (alphaChanged) {
                this.context.restore();
            }
            if (alpha !== 1) {
                frameState.animate = true;
            } else if (transition) {
                tile.endTransition(uid);
            }
        };
        _ol_renderer_canvas_TileLayer_.prototype.getImage = function() {
            var context = this.context;
            return context ? context.canvas : null;
        };
        _ol_renderer_canvas_TileLayer_.prototype.getLayer;
        _ol_renderer_canvas_TileLayer_.prototype.getImageTransform = function() {
            return this.imageTransform_;
        };
        exports.default = _ol_renderer_canvas_TileLayer_;
    }, {
        "../../dom.js": 46,
        "../../extent.js": 54,
        "../../index.js": 89,
        "../../layertype.js": 113,
        "../../tilerange.js": 241,
        "../../tilestate.js": 242,
        "../../transform.js": 243,
        "../../viewhint.js": 246,
        "../canvas/intermediatecanvas.js": 184,
        "../type.js": 192
    } ],
    188: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _layertype = require("../../layertype.js");
        var _layertype2 = _interopRequireDefault(_layertype);
        var _viewhint = require("../../viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _dom = require("../../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _events = require("../../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _rbush = require("rbush");
        var _rbush2 = _interopRequireDefault(_rbush);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _eventtype3 = require("../../render/eventtype.js");
        var _eventtype4 = _interopRequireDefault(_eventtype3);
        var _canvas = require("../../render/canvas.js");
        var _canvas2 = _interopRequireDefault(_canvas);
        var _replaygroup = require("../../render/canvas/replaygroup.js");
        var _replaygroup2 = _interopRequireDefault(_replaygroup);
        var _type = require("../type.js");
        var _type2 = _interopRequireDefault(_type);
        var _layer = require("../canvas/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _vector = require("../vector.js");
        var _vector2 = _interopRequireDefault(_vector);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_canvas_VectorLayer_ = function(vectorLayer) {
            _layer2.default.call(this, vectorLayer);
            this.declutterTree_ = vectorLayer.getDeclutter() ? (0, _rbush2.default)(9) : null;
            this.dirty_ = false;
            this.renderedRevision_ = -1;
            this.renderedResolution_ = NaN;
            this.renderedExtent_ = _extent2.default.createEmpty();
            this.renderedRenderOrder_ = null;
            this.replayGroup_ = null;
            this.replayGroupChanged = true;
            this.context = _dom2.default.createCanvasContext2D();
            _events2.default.listen(_canvas2.default.labelCache, _eventtype2.default.CLEAR, this.handleFontsChanged_, this);
        };
        _index2.default.inherits(_ol_renderer_canvas_VectorLayer_, _layer2.default);
        _ol_renderer_canvas_VectorLayer_["handles"] = function(type, layer) {
            return type === _type2.default.CANVAS && layer.getType() === _layertype2.default.VECTOR;
        };
        _ol_renderer_canvas_VectorLayer_["create"] = function(mapRenderer, layer) {
            return new _ol_renderer_canvas_VectorLayer_(layer);
        };
        _ol_renderer_canvas_VectorLayer_.prototype.disposeInternal = function() {
            _events2.default.unlisten(_canvas2.default.labelCache, _eventtype2.default.CLEAR, this.handleFontsChanged_, this);
            _layer2.default.prototype.disposeInternal.call(this);
        };
        _ol_renderer_canvas_VectorLayer_.prototype.composeFrame = function(frameState, layerState, context) {
            var extent = frameState.extent;
            var pixelRatio = frameState.pixelRatio;
            var skippedFeatureUids = layerState.managed ? frameState.skippedFeatureUids : {};
            var viewState = frameState.viewState;
            var projection = viewState.projection;
            var rotation = viewState.rotation;
            var projectionExtent = projection.getExtent();
            var vectorSource = this.getLayer().getSource();
            var transform = this.getTransform(frameState, 0);
            this.preCompose(context, frameState, transform);
            var clipExtent = layerState.extent;
            var clipped = clipExtent !== undefined;
            if (clipped) {
                this.clip(context, frameState, clipExtent);
            }
            var replayGroup = this.replayGroup_;
            if (replayGroup && !replayGroup.isEmpty()) {
                if (this.declutterTree_) {
                    this.declutterTree_.clear();
                }
                var layer = this.getLayer();
                var drawOffsetX = 0;
                var drawOffsetY = 0;
                var replayContext;
                var transparentLayer = layerState.opacity !== 1;
                var hasRenderListeners = layer.hasListener(_eventtype4.default.RENDER);
                if (transparentLayer || hasRenderListeners) {
                    var drawWidth = context.canvas.width;
                    var drawHeight = context.canvas.height;
                    if (rotation) {
                        var drawSize = Math.round(Math.sqrt(drawWidth * drawWidth + drawHeight * drawHeight));
                        drawOffsetX = (drawSize - drawWidth) / 2;
                        drawOffsetY = (drawSize - drawHeight) / 2;
                        drawWidth = drawHeight = drawSize;
                    }
                    this.context.canvas.width = drawWidth;
                    this.context.canvas.height = drawHeight;
                    replayContext = this.context;
                } else {
                    replayContext = context;
                }
                var alpha = replayContext.globalAlpha;
                if (!transparentLayer) {
                    replayContext.globalAlpha = layerState.opacity;
                }
                if (replayContext != context) {
                    replayContext.translate(drawOffsetX, drawOffsetY);
                }
                var width = frameState.size[0] * pixelRatio;
                var height = frameState.size[1] * pixelRatio;
                _canvas2.default.rotateAtOffset(replayContext, -rotation, width / 2, height / 2);
                replayGroup.replay(replayContext, transform, rotation, skippedFeatureUids);
                if (vectorSource.getWrapX() && projection.canWrapX() && !_extent2.default.containsExtent(projectionExtent, extent)) {
                    var startX = extent[0];
                    var worldWidth = _extent2.default.getWidth(projectionExtent);
                    var world = 0;
                    var offsetX;
                    while (startX < projectionExtent[0]) {
                        --world;
                        offsetX = worldWidth * world;
                        transform = this.getTransform(frameState, offsetX);
                        replayGroup.replay(replayContext, transform, rotation, skippedFeatureUids);
                        startX += worldWidth;
                    }
                    world = 0;
                    startX = extent[2];
                    while (startX > projectionExtent[2]) {
                        ++world;
                        offsetX = worldWidth * world;
                        transform = this.getTransform(frameState, offsetX);
                        replayGroup.replay(replayContext, transform, rotation, skippedFeatureUids);
                        startX -= worldWidth;
                    }
                    transform = this.getTransform(frameState, 0);
                }
                _canvas2.default.rotateAtOffset(replayContext, rotation, width / 2, height / 2);
                if (replayContext != context) {
                    if (hasRenderListeners) {
                        this.dispatchRenderEvent(replayContext, frameState, transform);
                    }
                    if (transparentLayer) {
                        var mainContextAlpha = context.globalAlpha;
                        context.globalAlpha = layerState.opacity;
                        context.drawImage(replayContext.canvas, -drawOffsetX, -drawOffsetY);
                        context.globalAlpha = mainContextAlpha;
                    } else {
                        context.drawImage(replayContext.canvas, -drawOffsetX, -drawOffsetY);
                    }
                    replayContext.translate(-drawOffsetX, -drawOffsetY);
                }
                if (!transparentLayer) {
                    replayContext.globalAlpha = alpha;
                }
            }
            if (clipped) {
                context.restore();
            }
            this.postCompose(context, frameState, layerState, transform);
        };
        _ol_renderer_canvas_VectorLayer_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {
            if (!this.replayGroup_) {
                return undefined;
            } else {
                var resolution = frameState.viewState.resolution;
                var rotation = frameState.viewState.rotation;
                var layer = this.getLayer();
                var features = {};
                var result = this.replayGroup_.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, {}, function(feature) {
                    var key = _index2.default.getUid(feature).toString();
                    if (!(key in features)) {
                        features[key] = true;
                        return callback.call(thisArg, feature, layer);
                    }
                }, null);
                return result;
            }
        };
        _ol_renderer_canvas_VectorLayer_.prototype.handleFontsChanged_ = function(event) {
            var layer = this.getLayer();
            if (layer.getVisible() && this.replayGroup_) {
                layer.changed();
            }
        };
        _ol_renderer_canvas_VectorLayer_.prototype.handleStyleImageChange_ = function(event) {
            this.renderIfReadyAndVisible();
        };
        _ol_renderer_canvas_VectorLayer_.prototype.prepareFrame = function(frameState, layerState) {
            var vectorLayer = this.getLayer();
            var vectorSource = vectorLayer.getSource();
            this.updateLogos(frameState, vectorSource);
            var animating = frameState.viewHints[_viewhint2.default.ANIMATING];
            var interacting = frameState.viewHints[_viewhint2.default.INTERACTING];
            var updateWhileAnimating = vectorLayer.getUpdateWhileAnimating();
            var updateWhileInteracting = vectorLayer.getUpdateWhileInteracting();
            if (!this.dirty_ && !updateWhileAnimating && animating || !updateWhileInteracting && interacting) {
                return true;
            }
            var frameStateExtent = frameState.extent;
            var viewState = frameState.viewState;
            var projection = viewState.projection;
            var resolution = viewState.resolution;
            var pixelRatio = frameState.pixelRatio;
            var vectorLayerRevision = vectorLayer.getRevision();
            var vectorLayerRenderBuffer = vectorLayer.getRenderBuffer();
            var vectorLayerRenderOrder = vectorLayer.getRenderOrder();
            if (vectorLayerRenderOrder === undefined) {
                vectorLayerRenderOrder = _vector2.default.defaultOrder;
            }
            var extent = _extent2.default.buffer(frameStateExtent, vectorLayerRenderBuffer * resolution);
            var projectionExtent = viewState.projection.getExtent();
            if (vectorSource.getWrapX() && viewState.projection.canWrapX() && !_extent2.default.containsExtent(projectionExtent, frameState.extent)) {
                var worldWidth = _extent2.default.getWidth(projectionExtent);
                var buffer = Math.max(_extent2.default.getWidth(extent) / 2, worldWidth);
                extent[0] = projectionExtent[0] - buffer;
                extent[2] = projectionExtent[2] + buffer;
            }
            if (!this.dirty_ && this.renderedResolution_ == resolution && this.renderedRevision_ == vectorLayerRevision && this.renderedRenderOrder_ == vectorLayerRenderOrder && _extent2.default.containsExtent(this.renderedExtent_, extent)) {
                this.replayGroupChanged = false;
                return true;
            }
            this.replayGroup_ = null;
            this.dirty_ = false;
            var replayGroup = new _replaygroup2.default(_vector2.default.getTolerance(resolution, pixelRatio), extent, resolution, pixelRatio, vectorSource.getOverlaps(), this.declutterTree_, vectorLayer.getRenderBuffer());
            vectorSource.loadFeatures(extent, resolution, projection);
            var renderFeature = function(feature) {
                var styles;
                var styleFunction = feature.getStyleFunction();
                if (styleFunction) {
                    styles = styleFunction.call(feature, resolution);
                } else {
                    styleFunction = vectorLayer.getStyleFunction();
                    if (styleFunction) {
                        styles = styleFunction(feature, resolution);
                    }
                }
                if (styles) {
                    var dirty = this.renderFeature(feature, resolution, pixelRatio, styles, replayGroup);
                    this.dirty_ = this.dirty_ || dirty;
                }
            }.bind(this);
            if (vectorLayerRenderOrder) {
                var features = [];
                vectorSource.forEachFeatureInExtent(extent, function(feature) {
                    features.push(feature);
                }, this);
                features.sort(vectorLayerRenderOrder);
                for (var i = 0, ii = features.length; i < ii; ++i) {
                    renderFeature(features[i]);
                }
            } else {
                vectorSource.forEachFeatureInExtent(extent, renderFeature, this);
            }
            replayGroup.finish();
            this.renderedResolution_ = resolution;
            this.renderedRevision_ = vectorLayerRevision;
            this.renderedRenderOrder_ = vectorLayerRenderOrder;
            this.renderedExtent_ = extent;
            this.replayGroup_ = replayGroup;
            this.replayGroupChanged = true;
            return true;
        };
        _ol_renderer_canvas_VectorLayer_.prototype.renderFeature = function(feature, resolution, pixelRatio, styles, replayGroup) {
            if (!styles) {
                return false;
            }
            var loading = false;
            if (Array.isArray(styles)) {
                for (var i = 0, ii = styles.length; i < ii; ++i) {
                    loading = _vector2.default.renderFeature(replayGroup, feature, styles[i], _vector2.default.getSquaredTolerance(resolution, pixelRatio), this.handleStyleImageChange_, this) || loading;
                }
            } else {
                loading = _vector2.default.renderFeature(replayGroup, feature, styles, _vector2.default.getSquaredTolerance(resolution, pixelRatio), this.handleStyleImageChange_, this);
            }
            return loading;
        };
        exports.default = _ol_renderer_canvas_VectorLayer_;
    }, {
        "../../dom.js": 46,
        "../../events.js": 48,
        "../../events/eventtype.js": 52,
        "../../extent.js": 54,
        "../../index.js": 89,
        "../../layertype.js": 113,
        "../../render/canvas.js": 150,
        "../../render/canvas/replaygroup.js": 157,
        "../../render/eventtype.js": 160,
        "../../viewhint.js": 246,
        "../canvas/layer.js": 185,
        "../type.js": 192,
        "../vector.js": 193,
        rbush: 258
    } ],
    189: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _layertype = require("../../layertype.js");
        var _layertype2 = _interopRequireDefault(_layertype);
        var _tilestate = require("../../tilestate.js");
        var _tilestate2 = _interopRequireDefault(_tilestate);
        var _dom = require("../../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _events = require("../../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _rbush = require("rbush");
        var _rbush2 = _interopRequireDefault(_rbush);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _vectortilerendertype = require("../../layer/vectortilerendertype.js");
        var _vectortilerendertype2 = _interopRequireDefault(_vectortilerendertype);
        var _proj = require("../../proj.js");
        var _proj2 = _interopRequireDefault(_proj);
        var _units = require("../../proj/units.js");
        var _units2 = _interopRequireDefault(_units);
        var _replaytype = require("../../render/replaytype.js");
        var _replaytype2 = _interopRequireDefault(_replaytype);
        var _canvas = require("../../render/canvas.js");
        var _canvas2 = _interopRequireDefault(_canvas);
        var _replaygroup = require("../../render/canvas/replaygroup.js");
        var _replaygroup2 = _interopRequireDefault(_replaygroup);
        var _replay = require("../../render/replay.js");
        var _replay2 = _interopRequireDefault(_replay);
        var _type = require("../type.js");
        var _type2 = _interopRequireDefault(_type);
        var _tilelayer = require("../canvas/tilelayer.js");
        var _tilelayer2 = _interopRequireDefault(_tilelayer);
        var _vector = require("../vector.js");
        var _vector2 = _interopRequireDefault(_vector);
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_canvas_VectorTileLayer_ = function(layer) {
            this.context = null;
            _tilelayer2.default.call(this, layer);
            this.declutterTree_ = layer.getDeclutter() ? (0, _rbush2.default)(9) : null;
            this.dirty_ = false;
            this.renderedLayerRevision_;
            this.tmpTransform_ = _transform2.default.create();
            this.zDirection = layer.getRenderMode() == _vectortilerendertype2.default.VECTOR ? 1 : 0;
            _events2.default.listen(_canvas2.default.labelCache, _eventtype2.default.CLEAR, this.handleFontsChanged_, this);
        };
        _index2.default.inherits(_ol_renderer_canvas_VectorTileLayer_, _tilelayer2.default);
        _ol_renderer_canvas_VectorTileLayer_["handles"] = function(type, layer) {
            return type === _type2.default.CANVAS && layer.getType() === _layertype2.default.VECTOR_TILE;
        };
        _ol_renderer_canvas_VectorTileLayer_["create"] = function(mapRenderer, layer) {
            return new _ol_renderer_canvas_VectorTileLayer_(layer);
        };
        _ol_renderer_canvas_VectorTileLayer_.IMAGE_REPLAYS = {
            image: [ _replaytype2.default.POLYGON, _replaytype2.default.CIRCLE, _replaytype2.default.LINE_STRING, _replaytype2.default.IMAGE, _replaytype2.default.TEXT ],
            hybrid: [ _replaytype2.default.POLYGON, _replaytype2.default.LINE_STRING ]
        };
        _ol_renderer_canvas_VectorTileLayer_.VECTOR_REPLAYS = {
            image: [ _replaytype2.default.DEFAULT ],
            hybrid: [ _replaytype2.default.IMAGE, _replaytype2.default.TEXT, _replaytype2.default.DEFAULT ],
            vector: _replay2.default.ORDER
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.disposeInternal = function() {
            _events2.default.unlisten(_canvas2.default.labelCache, _eventtype2.default.CLEAR, this.handleFontsChanged_, this);
            _tilelayer2.default.prototype.disposeInternal.call(this);
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.prepareFrame = function(frameState, layerState) {
            var layer = this.getLayer();
            var layerRevision = layer.getRevision();
            if (this.renderedLayerRevision_ != layerRevision) {
                this.renderedTiles.length = 0;
                var renderMode = layer.getRenderMode();
                if (!this.context && renderMode != _vectortilerendertype2.default.VECTOR) {
                    this.context = _dom2.default.createCanvasContext2D();
                }
                if (this.context && renderMode == _vectortilerendertype2.default.VECTOR) {
                    this.context = null;
                }
            }
            this.renderedLayerRevision_ = layerRevision;
            return _tilelayer2.default.prototype.prepareFrame.apply(this, arguments);
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.createReplayGroup_ = function(tile, frameState) {
            var layer = this.getLayer();
            var pixelRatio = frameState.pixelRatio;
            var projection = frameState.viewState.projection;
            var revision = layer.getRevision();
            var renderOrder = layer.getRenderOrder() || null;
            var replayState = tile.getReplayState(layer);
            if (!replayState.dirty && replayState.renderedRevision == revision && replayState.renderedRenderOrder == renderOrder) {
                return;
            }
            var source = layer.getSource();
            var sourceTileGrid = source.getTileGrid();
            var tileGrid = source.getTileGridForProjection(projection);
            var resolution = tileGrid.getResolution(tile.tileCoord[0]);
            var tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);
            var zIndexKeys = {};
            for (var t = 0, tt = tile.tileKeys.length; t < tt; ++t) {
                var sourceTile = tile.getTile(tile.tileKeys[t]);
                if (sourceTile.getState() == _tilestate2.default.ERROR) {
                    continue;
                }
                var sourceTileCoord = sourceTile.tileCoord;
                var sourceTileExtent = sourceTileGrid.getTileCoordExtent(sourceTileCoord);
                var sharedExtent = _extent2.default.getIntersection(tileExtent, sourceTileExtent);
                var bufferedExtent = _extent2.default.equals(sourceTileExtent, sharedExtent) ? null : _extent2.default.buffer(sharedExtent, layer.getRenderBuffer() * resolution);
                var tileProjection = sourceTile.getProjection();
                var reproject = false;
                if (!_proj2.default.equivalent(projection, tileProjection)) {
                    reproject = true;
                    sourceTile.setProjection(projection);
                }
                replayState.dirty = false;
                var replayGroup = new _replaygroup2.default(0, sharedExtent, resolution, pixelRatio, source.getOverlaps(), this.declutterTree_, layer.getRenderBuffer());
                var squaredTolerance = _vector2.default.getSquaredTolerance(resolution, pixelRatio);
                var renderFeature = function(feature) {
                    var styles;
                    var styleFunction = feature.getStyleFunction();
                    if (styleFunction) {
                        styles = styleFunction.call(feature, resolution);
                    } else {
                        styleFunction = layer.getStyleFunction();
                        if (styleFunction) {
                            styles = styleFunction(feature, resolution);
                        }
                    }
                    if (styles) {
                        var dirty = this.renderFeature(feature, squaredTolerance, styles, replayGroup);
                        this.dirty_ = this.dirty_ || dirty;
                        replayState.dirty = replayState.dirty || dirty;
                    }
                };
                var features = sourceTile.getFeatures();
                if (renderOrder && renderOrder !== replayState.renderedRenderOrder) {
                    features.sort(renderOrder);
                }
                var feature;
                for (var i = 0, ii = features.length; i < ii; ++i) {
                    feature = features[i];
                    if (reproject) {
                        if (tileProjection.getUnits() == _units2.default.TILE_PIXELS) {
                            tileProjection.setWorldExtent(sourceTileExtent);
                            tileProjection.setExtent(sourceTile.getExtent());
                        }
                        feature.getGeometry().transform(tileProjection, projection);
                    }
                    if (!bufferedExtent || _extent2.default.intersects(bufferedExtent, feature.getGeometry().getExtent())) {
                        renderFeature.call(this, feature);
                    }
                }
                replayGroup.finish();
                for (var r in replayGroup.getReplays()) {
                    zIndexKeys[r] = true;
                }
                sourceTile.setReplayGroup(layer, tile.tileCoord.toString(), replayGroup);
            }
            replayState.renderedRevision = revision;
            replayState.renderedRenderOrder = renderOrder;
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.drawTileImage = function(tile, frameState, layerState, x, y, w, h, gutter, transition) {
            var vectorImageTile = tile;
            this.createReplayGroup_(vectorImageTile, frameState);
            if (this.context) {
                this.renderTileImage_(vectorImageTile, frameState, layerState);
                _tilelayer2.default.prototype.drawTileImage.apply(this, arguments);
            }
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {
            var resolution = frameState.viewState.resolution;
            var rotation = frameState.viewState.rotation;
            hitTolerance = hitTolerance == undefined ? 0 : hitTolerance;
            var layer = this.getLayer();
            var features = {};
            var renderedTiles = this.renderedTiles;
            var source = layer.getSource();
            var tileGrid = source.getTileGridForProjection(frameState.viewState.projection);
            var bufferedExtent, found;
            var i, ii, replayGroup;
            var tile, tileCoord, tileExtent;
            for (i = 0, ii = renderedTiles.length; i < ii; ++i) {
                tile = renderedTiles[i];
                tileCoord = tile.wrappedTileCoord;
                tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent);
                bufferedExtent = _extent2.default.buffer(tileExtent, hitTolerance * resolution, bufferedExtent);
                if (!_extent2.default.containsCoordinate(bufferedExtent, coordinate)) {
                    continue;
                }
                for (var t = 0, tt = tile.tileKeys.length; t < tt; ++t) {
                    var sourceTile = tile.getTile(tile.tileKeys[t]);
                    if (sourceTile.getState() == _tilestate2.default.ERROR) {
                        continue;
                    }
                    replayGroup = sourceTile.getReplayGroup(layer, tile.tileCoord.toString());
                    found = found || replayGroup.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, {}, function(feature) {
                        var key = _index2.default.getUid(feature).toString();
                        if (!(key in features)) {
                            features[key] = true;
                            return callback.call(thisArg, feature, layer);
                        }
                    }, null);
                }
            }
            return found;
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.getReplayTransform_ = function(tile, frameState) {
            var layer = this.getLayer();
            var source = layer.getSource();
            var tileGrid = source.getTileGrid();
            var tileCoord = tile.tileCoord;
            var tileResolution = tileGrid.getResolution(tileCoord[0]);
            var viewState = frameState.viewState;
            var pixelRatio = frameState.pixelRatio;
            var renderResolution = viewState.resolution / pixelRatio;
            var tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent);
            var center = viewState.center;
            var origin = _extent2.default.getTopLeft(tileExtent);
            var size = frameState.size;
            var offsetX = Math.round(pixelRatio * size[0] / 2);
            var offsetY = Math.round(pixelRatio * size[1] / 2);
            return _transform2.default.compose(this.tmpTransform_, offsetX, offsetY, tileResolution / renderResolution, tileResolution / renderResolution, viewState.rotation, (origin[0] - center[0]) / tileResolution, (center[1] - origin[1]) / tileResolution);
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.handleFontsChanged_ = function(event) {
            var layer = this.getLayer();
            if (layer.getVisible() && this.renderedLayerRevision_ !== undefined) {
                layer.changed();
            }
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.handleStyleImageChange_ = function(event) {
            this.renderIfReadyAndVisible();
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.postCompose = function(context, frameState, layerState) {
            var layer = this.getLayer();
            var declutterReplays = layer.getDeclutter() ? {} : null;
            var source = layer.getSource();
            var renderMode = layer.getRenderMode();
            var replayTypes = _ol_renderer_canvas_VectorTileLayer_.VECTOR_REPLAYS[renderMode];
            var pixelRatio = frameState.pixelRatio;
            var rotation = frameState.viewState.rotation;
            var size = frameState.size;
            var offsetX, offsetY;
            if (rotation) {
                offsetX = Math.round(pixelRatio * size[0] / 2);
                offsetY = Math.round(pixelRatio * size[1] / 2);
                _canvas2.default.rotateAtOffset(context, -rotation, offsetX, offsetY);
            }
            if (declutterReplays) {
                this.declutterTree_.clear();
            }
            var tiles = this.renderedTiles;
            var tileGrid = source.getTileGridForProjection(frameState.viewState.projection);
            var clips = [];
            var zs = [];
            for (var i = tiles.length - 1; i >= 0; --i) {
                var tile = tiles[i];
                if (tile.getState() == _tilestate2.default.ABORT) {
                    continue;
                }
                var tileCoord = tile.tileCoord;
                var worldOffset = tileGrid.getTileCoordExtent(tileCoord)[0] - tileGrid.getTileCoordExtent(tile.wrappedTileCoord)[0];
                var transform = undefined;
                for (var t = 0, tt = tile.tileKeys.length; t < tt; ++t) {
                    var sourceTile = tile.getTile(tile.tileKeys[t]);
                    if (sourceTile.getState() == _tilestate2.default.ERROR) {
                        continue;
                    }
                    var replayGroup = sourceTile.getReplayGroup(layer, tileCoord.toString());
                    if (renderMode != _vectortilerendertype2.default.VECTOR && !replayGroup.hasReplays(replayTypes)) {
                        continue;
                    }
                    if (!transform) {
                        transform = this.getTransform(frameState, worldOffset);
                    }
                    var currentZ = sourceTile.tileCoord[0];
                    var currentClip = replayGroup.getClipCoords(transform);
                    context.save();
                    context.globalAlpha = layerState.opacity;
                    for (var j = 0, jj = clips.length; j < jj; ++j) {
                        var clip = clips[j];
                        if (currentZ < zs[j]) {
                            context.beginPath();
                            context.moveTo(currentClip[0], currentClip[1]);
                            context.lineTo(currentClip[2], currentClip[3]);
                            context.lineTo(currentClip[4], currentClip[5]);
                            context.lineTo(currentClip[6], currentClip[7]);
                            context.moveTo(clip[6], clip[7]);
                            context.lineTo(clip[4], clip[5]);
                            context.lineTo(clip[2], clip[3]);
                            context.lineTo(clip[0], clip[1]);
                            context.clip();
                        }
                    }
                    replayGroup.replay(context, transform, rotation, {}, replayTypes, declutterReplays);
                    context.restore();
                    clips.push(currentClip);
                    zs.push(currentZ);
                }
            }
            if (declutterReplays) {
                _replaygroup2.default.replayDeclutter(declutterReplays, context, rotation);
            }
            if (rotation) {
                _canvas2.default.rotateAtOffset(context, rotation, offsetX, offsetY);
            }
            _tilelayer2.default.prototype.postCompose.apply(this, arguments);
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.renderFeature = function(feature, squaredTolerance, styles, replayGroup) {
            if (!styles) {
                return false;
            }
            var loading = false;
            if (Array.isArray(styles)) {
                for (var i = 0, ii = styles.length; i < ii; ++i) {
                    loading = _vector2.default.renderFeature(replayGroup, feature, styles[i], squaredTolerance, this.handleStyleImageChange_, this) || loading;
                }
            } else {
                loading = _vector2.default.renderFeature(replayGroup, feature, styles, squaredTolerance, this.handleStyleImageChange_, this);
            }
            return loading;
        };
        _ol_renderer_canvas_VectorTileLayer_.prototype.renderTileImage_ = function(tile, frameState, layerState) {
            var layer = this.getLayer();
            var replayState = tile.getReplayState(layer);
            var revision = layer.getRevision();
            var replays = _ol_renderer_canvas_VectorTileLayer_.IMAGE_REPLAYS[layer.getRenderMode()];
            if (replays && replayState.renderedTileRevision !== revision) {
                replayState.renderedTileRevision = revision;
                var tileCoord = tile.wrappedTileCoord;
                var z = tileCoord[0];
                var pixelRatio = frameState.pixelRatio;
                var source = layer.getSource();
                var tileGrid = source.getTileGridForProjection(frameState.viewState.projection);
                var resolution = tileGrid.getResolution(z);
                var context = tile.getContext(layer);
                var size = source.getTilePixelSize(z, pixelRatio, frameState.viewState.projection);
                context.canvas.width = size[0];
                context.canvas.height = size[1];
                var tileExtent = tileGrid.getTileCoordExtent(tileCoord);
                for (var i = 0, ii = tile.tileKeys.length; i < ii; ++i) {
                    var sourceTile = tile.getTile(tile.tileKeys[i]);
                    if (sourceTile.getState() == _tilestate2.default.ERROR) {
                        continue;
                    }
                    var pixelScale = pixelRatio / resolution;
                    var transform = _transform2.default.reset(this.tmpTransform_);
                    _transform2.default.scale(transform, pixelScale, -pixelScale);
                    _transform2.default.translate(transform, -tileExtent[0], -tileExtent[3]);
                    var replayGroup = sourceTile.getReplayGroup(layer, tile.tileCoord.toString());
                    replayGroup.replay(context, transform, 0, {}, replays);
                }
            }
        };
        exports.default = _ol_renderer_canvas_VectorTileLayer_;
    }, {
        "../../dom.js": 46,
        "../../events.js": 48,
        "../../events/eventtype.js": 52,
        "../../extent.js": 54,
        "../../index.js": 89,
        "../../layer/vectortilerendertype.js": 112,
        "../../layertype.js": 113,
        "../../proj.js": 141,
        "../../proj/units.js": 148,
        "../../render/canvas.js": 150,
        "../../render/canvas/replaygroup.js": 157,
        "../../render/replay.js": 161,
        "../../render/replaytype.js": 163,
        "../../tilestate.js": 242,
        "../../transform.js": 243,
        "../canvas/tilelayer.js": 187,
        "../type.js": 192,
        "../vector.js": 193,
        rbush: 258
    } ],
    190: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _imagestate = require("../imagestate.js");
        var _imagestate2 = _interopRequireDefault(_imagestate);
        var _observable = require("../observable.js");
        var _observable2 = _interopRequireDefault(_observable);
        var _tilestate = require("../tilestate.js");
        var _tilestate2 = _interopRequireDefault(_tilestate);
        var _asserts = require("../asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _state = require("../source/state.js");
        var _state2 = _interopRequireDefault(_state);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_Layer_ = function(layer) {
            _observable2.default.call(this);
            this.layer_ = layer;
        };
        _index2.default.inherits(_ol_renderer_Layer_, _observable2.default);
        _ol_renderer_Layer_.prototype.forEachFeatureAtCoordinate = _index2.default.nullFunction;
        _ol_renderer_Layer_.prototype.hasFeatureAtCoordinate = _functions2.default.FALSE;
        _ol_renderer_Layer_.prototype.createLoadedTileFinder = function(source, projection, tiles) {
            return function(zoom, tileRange) {
                function callback(tile) {
                    if (!tiles[zoom]) {
                        tiles[zoom] = {};
                    }
                    tiles[zoom][tile.tileCoord.toString()] = tile;
                }
                return source.forEachLoadedTile(projection, zoom, tileRange, callback);
            };
        };
        _ol_renderer_Layer_.prototype.getLayer = function() {
            return this.layer_;
        };
        _ol_renderer_Layer_.prototype.handleImageChange_ = function(event) {
            var image = event.target;
            if (image.getState() === _imagestate2.default.LOADED) {
                this.renderIfReadyAndVisible();
            }
        };
        _ol_renderer_Layer_.prototype.loadImage = function(image) {
            var imageState = image.getState();
            if (imageState != _imagestate2.default.LOADED && imageState != _imagestate2.default.ERROR) {
                _events2.default.listen(image, _eventtype2.default.CHANGE, this.handleImageChange_, this);
            }
            if (imageState == _imagestate2.default.IDLE) {
                image.load();
                imageState = image.getState();
            }
            return imageState == _imagestate2.default.LOADED;
        };
        _ol_renderer_Layer_.prototype.renderIfReadyAndVisible = function() {
            var layer = this.getLayer();
            if (layer.getVisible() && layer.getSourceState() == _state2.default.READY) {
                this.changed();
            }
        };
        _ol_renderer_Layer_.prototype.scheduleExpireCache = function(frameState, tileSource) {
            if (tileSource.canExpireCache()) {
                var postRenderFunction = function(tileSource, map, frameState) {
                    var tileSourceKey = _index2.default.getUid(tileSource).toString();
                    if (tileSourceKey in frameState.usedTiles) {
                        tileSource.expireCache(frameState.viewState.projection, frameState.usedTiles[tileSourceKey]);
                    }
                }.bind(null, tileSource);
                frameState.postRenderFunctions.push(postRenderFunction);
            }
        };
        _ol_renderer_Layer_.prototype.updateLogos = function(frameState, source) {
            var logo = source.getLogo();
            if (logo !== undefined) {
                if (typeof logo === "string") {
                    frameState.logos[logo] = "";
                } else if (logo) {
                    _asserts2.default.assert(typeof logo.href == "string", 44);
                    _asserts2.default.assert(typeof logo.src == "string", 45);
                    frameState.logos[logo.src] = logo.href;
                }
            }
        };
        _ol_renderer_Layer_.prototype.updateUsedTiles = function(usedTiles, tileSource, z, tileRange) {
            var tileSourceKey = _index2.default.getUid(tileSource).toString();
            var zKey = z.toString();
            if (tileSourceKey in usedTiles) {
                if (zKey in usedTiles[tileSourceKey]) {
                    usedTiles[tileSourceKey][zKey].extend(tileRange);
                } else {
                    usedTiles[tileSourceKey][zKey] = tileRange;
                }
            } else {
                usedTiles[tileSourceKey] = {};
                usedTiles[tileSourceKey][zKey] = tileRange;
            }
        };
        _ol_renderer_Layer_.prototype.manageTilePyramid = function(frameState, tileSource, tileGrid, pixelRatio, projection, extent, currentZ, preload, opt_tileCallback, opt_this) {
            var tileSourceKey = _index2.default.getUid(tileSource).toString();
            if (!(tileSourceKey in frameState.wantedTiles)) {
                frameState.wantedTiles[tileSourceKey] = {};
            }
            var wantedTiles = frameState.wantedTiles[tileSourceKey];
            var tileQueue = frameState.tileQueue;
            var minZoom = tileGrid.getMinZoom();
            var tile, tileRange, tileResolution, x, y, z;
            for (z = minZoom; z <= currentZ; ++z) {
                tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z, tileRange);
                tileResolution = tileGrid.getResolution(z);
                for (x = tileRange.minX; x <= tileRange.maxX; ++x) {
                    for (y = tileRange.minY; y <= tileRange.maxY; ++y) {
                        if (currentZ - z <= preload) {
                            tile = tileSource.getTile(z, x, y, pixelRatio, projection);
                            if (tile.getState() == _tilestate2.default.IDLE) {
                                wantedTiles[tile.getKey()] = true;
                                if (!tileQueue.isKeyQueued(tile.getKey())) {
                                    tileQueue.enqueue([ tile, tileSourceKey, tileGrid.getTileCoordCenter(tile.tileCoord), tileResolution ]);
                                }
                            }
                            if (opt_tileCallback !== undefined) {
                                opt_tileCallback.call(opt_this, tile);
                            }
                        } else {
                            tileSource.useTile(z, x, y, projection);
                        }
                    }
                }
            }
        };
        exports.default = _ol_renderer_Layer_;
    }, {
        "../asserts.js": 31,
        "../events.js": 48,
        "../events/eventtype.js": 52,
        "../functions.js": 60,
        "../imagestate.js": 88,
        "../index.js": 89,
        "../observable.js": 127,
        "../source/state.js": 212,
        "../tilestate.js": 242
    } ],
    191: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _disposable = require("../disposable.js");
        var _disposable2 = _interopRequireDefault(_disposable);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _layer = require("../layer/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _plugins = require("../plugins.js");
        var _plugins2 = _interopRequireDefault(_plugins);
        var _style = require("../style.js");
        var _style2 = _interopRequireDefault(_style);
        var _transform = require("../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_Map_ = function(container, map) {
            _disposable2.default.call(this);
            this.map_ = map;
            this.layerRenderers_ = {};
            this.layerRendererListeners_ = {};
        };
        _index2.default.inherits(_ol_renderer_Map_, _disposable2.default);
        _ol_renderer_Map_.prototype.calculateMatrices2D = function(frameState) {
            var viewState = frameState.viewState;
            var coordinateToPixelTransform = frameState.coordinateToPixelTransform;
            var pixelToCoordinateTransform = frameState.pixelToCoordinateTransform;
            _transform2.default.compose(coordinateToPixelTransform, frameState.size[0] / 2, frameState.size[1] / 2, 1 / viewState.resolution, -1 / viewState.resolution, -viewState.rotation, -viewState.center[0], -viewState.center[1]);
            _transform2.default.invert(_transform2.default.setFromArray(pixelToCoordinateTransform, coordinateToPixelTransform));
        };
        _ol_renderer_Map_.prototype.removeLayerRenderers = function() {
            for (var key in this.layerRenderers_) {
                this.removeLayerRendererByKey_(key).dispose();
            }
        };
        _ol_renderer_Map_.expireIconCache_ = function(map, frameState) {
            var cache = _style2.default.iconImageCache;
            cache.expire();
        };
        _ol_renderer_Map_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg, layerFilter, thisArg2) {
            var result;
            var viewState = frameState.viewState;
            var viewResolution = viewState.resolution;
            function forEachFeatureAtCoordinate(feature, layer) {
                var key = _index2.default.getUid(feature).toString();
                var managed = frameState.layerStates[_index2.default.getUid(layer)].managed;
                if (!(key in frameState.skippedFeatureUids && !managed)) {
                    return callback.call(thisArg, feature, managed ? layer : null);
                }
            }
            var projection = viewState.projection;
            var translatedCoordinate = coordinate;
            if (projection.canWrapX()) {
                var projectionExtent = projection.getExtent();
                var worldWidth = _extent2.default.getWidth(projectionExtent);
                var x = coordinate[0];
                if (x < projectionExtent[0] || x > projectionExtent[2]) {
                    var worldsAway = Math.ceil((projectionExtent[0] - x) / worldWidth);
                    translatedCoordinate = [ x + worldWidth * worldsAway, coordinate[1] ];
                }
            }
            var layerStates = frameState.layerStatesArray;
            var numLayers = layerStates.length;
            var i;
            for (i = numLayers - 1; i >= 0; --i) {
                var layerState = layerStates[i];
                var layer = layerState.layer;
                if (_layer2.default.visibleAtResolution(layerState, viewResolution) && layerFilter.call(thisArg2, layer)) {
                    var layerRenderer = this.getLayerRenderer(layer);
                    if (layer.getSource()) {
                        result = layerRenderer.forEachFeatureAtCoordinate(layer.getSource().getWrapX() ? translatedCoordinate : coordinate, frameState, hitTolerance, forEachFeatureAtCoordinate, thisArg);
                    }
                    if (result) {
                        return result;
                    }
                }
            }
            return undefined;
        };
        _ol_renderer_Map_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg, layerFilter, thisArg2) {};
        _ol_renderer_Map_.prototype.hasFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, layerFilter, thisArg) {
            var hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, _functions2.default.TRUE, this, layerFilter, thisArg);
            return hasFeature !== undefined;
        };
        _ol_renderer_Map_.prototype.getLayerRenderer = function(layer) {
            var layerKey = _index2.default.getUid(layer).toString();
            if (layerKey in this.layerRenderers_) {
                return this.layerRenderers_[layerKey];
            } else {
                var layerRendererPlugins = _plugins2.default.getLayerRendererPlugins();
                var renderer;
                var type = this.getType();
                for (var i = 0, ii = layerRendererPlugins.length; i < ii; ++i) {
                    var plugin = layerRendererPlugins[i];
                    if (plugin["handles"](type, layer)) {
                        renderer = plugin["create"](this, layer);
                        break;
                    }
                }
                if (renderer) {
                    this.layerRenderers_[layerKey] = renderer;
                    this.layerRendererListeners_[layerKey] = _events2.default.listen(renderer, _eventtype2.default.CHANGE, this.handleLayerRendererChange_, this);
                } else {
                    throw new Error("Unable to create renderer for layer: " + layer.getType());
                }
                return renderer;
            }
        };
        _ol_renderer_Map_.prototype.getLayerRendererByKey = function(layerKey) {
            return this.layerRenderers_[layerKey];
        };
        _ol_renderer_Map_.prototype.getLayerRenderers = function() {
            return this.layerRenderers_;
        };
        _ol_renderer_Map_.prototype.getMap = function() {
            return this.map_;
        };
        _ol_renderer_Map_.prototype.getType = function() {};
        _ol_renderer_Map_.prototype.handleLayerRendererChange_ = function() {
            this.map_.render();
        };
        _ol_renderer_Map_.prototype.removeLayerRendererByKey_ = function(layerKey) {
            var layerRenderer = this.layerRenderers_[layerKey];
            delete this.layerRenderers_[layerKey];
            _events2.default.unlistenByKey(this.layerRendererListeners_[layerKey]);
            delete this.layerRendererListeners_[layerKey];
            return layerRenderer;
        };
        _ol_renderer_Map_.prototype.renderFrame = _index2.default.nullFunction;
        _ol_renderer_Map_.prototype.removeUnusedLayerRenderers_ = function(map, frameState) {
            var layerKey;
            for (layerKey in this.layerRenderers_) {
                if (!frameState || !(layerKey in frameState.layerStates)) {
                    this.removeLayerRendererByKey_(layerKey).dispose();
                }
            }
        };
        _ol_renderer_Map_.prototype.scheduleExpireIconCache = function(frameState) {
            frameState.postRenderFunctions.push(_ol_renderer_Map_.expireIconCache_);
        };
        _ol_renderer_Map_.prototype.scheduleRemoveUnusedLayerRenderers = function(frameState) {
            var layerKey;
            for (layerKey in this.layerRenderers_) {
                if (!(layerKey in frameState.layerStates)) {
                    frameState.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this));
                    return;
                }
            }
        };
        _ol_renderer_Map_.sortByZIndex = function(state1, state2) {
            return state1.zIndex - state2.zIndex;
        };
        exports.default = _ol_renderer_Map_;
    }, {
        "../disposable.js": 45,
        "../events.js": 48,
        "../events/eventtype.js": 52,
        "../extent.js": 54,
        "../functions.js": 60,
        "../index.js": 89,
        "../layer/layer.js": 108,
        "../plugins.js": 131,
        "../style.js": 221,
        "../transform.js": 243
    } ],
    192: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_renderer_Type_ = {
            CANVAS: "canvas",
            WEBGL: "webgl"
        };
        exports.default = _ol_renderer_Type_;
    }, {} ],
    193: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _imagestate = require("../imagestate.js");
        var _imagestate2 = _interopRequireDefault(_imagestate);
        var _geometrytype = require("../geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _replaytype = require("../render/replaytype.js");
        var _replaytype2 = _interopRequireDefault(_replaytype);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_vector_ = {};
        _ol_renderer_vector_.defaultOrder = function(feature1, feature2) {
            return _index2.default.getUid(feature1) - _index2.default.getUid(feature2);
        };
        _ol_renderer_vector_.getSquaredTolerance = function(resolution, pixelRatio) {
            var tolerance = _ol_renderer_vector_.getTolerance(resolution, pixelRatio);
            return tolerance * tolerance;
        };
        _ol_renderer_vector_.getTolerance = function(resolution, pixelRatio) {
            return _index2.default.SIMPLIFY_TOLERANCE * resolution / pixelRatio;
        };
        _ol_renderer_vector_.renderCircleGeometry_ = function(replayGroup, geometry, style, feature) {
            var fillStyle = style.getFill();
            var strokeStyle = style.getStroke();
            if (fillStyle || strokeStyle) {
                var circleReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.CIRCLE);
                circleReplay.setFillStrokeStyle(fillStyle, strokeStyle);
                circleReplay.drawCircle(geometry, feature);
            }
            var textStyle = style.getText();
            if (textStyle) {
                var textReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.TEXT);
                textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(false));
                textReplay.drawText(geometry, feature);
            }
        };
        _ol_renderer_vector_.renderFeature = function(replayGroup, feature, style, squaredTolerance, listener, thisArg) {
            var loading = false;
            var imageStyle, imageState;
            imageStyle = style.getImage();
            if (imageStyle) {
                imageState = imageStyle.getImageState();
                if (imageState == _imagestate2.default.LOADED || imageState == _imagestate2.default.ERROR) {
                    imageStyle.unlistenImageChange(listener, thisArg);
                } else {
                    if (imageState == _imagestate2.default.IDLE) {
                        imageStyle.load();
                    }
                    imageState = imageStyle.getImageState();
                    imageStyle.listenImageChange(listener, thisArg);
                    loading = true;
                }
            }
            _ol_renderer_vector_.renderFeature_(replayGroup, feature, style, squaredTolerance);
            return loading;
        };
        _ol_renderer_vector_.renderFeature_ = function(replayGroup, feature, style, squaredTolerance) {
            var geometry = style.getGeometryFunction()(feature);
            if (!geometry) {
                return;
            }
            var simplifiedGeometry = geometry.getSimplifiedGeometry(squaredTolerance);
            var renderer = style.getRenderer();
            if (renderer) {
                _ol_renderer_vector_.renderGeometry_(replayGroup, simplifiedGeometry, style, feature);
            } else {
                var geometryRenderer = _ol_renderer_vector_.GEOMETRY_RENDERERS_[simplifiedGeometry.getType()];
                geometryRenderer(replayGroup, simplifiedGeometry, style, feature);
            }
        };
        _ol_renderer_vector_.renderGeometry_ = function(replayGroup, geometry, style, feature) {
            if (geometry.getType() == _geometrytype2.default.GEOMETRY_COLLECTION) {
                var geometries = geometry.getGeometries();
                for (var i = 0, ii = geometries.length; i < ii; ++i) {
                    _ol_renderer_vector_.renderGeometry_(replayGroup, geometries[i], style, feature);
                }
                return;
            }
            var replay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.DEFAULT);
            replay.drawCustom(geometry, feature, style.getRenderer());
        };
        _ol_renderer_vector_.renderGeometryCollectionGeometry_ = function(replayGroup, geometry, style, feature) {
            var geometries = geometry.getGeometriesArray();
            var i, ii;
            for (i = 0, ii = geometries.length; i < ii; ++i) {
                var geometryRenderer = _ol_renderer_vector_.GEOMETRY_RENDERERS_[geometries[i].getType()];
                geometryRenderer(replayGroup, geometries[i], style, feature);
            }
        };
        _ol_renderer_vector_.renderLineStringGeometry_ = function(replayGroup, geometry, style, feature) {
            var strokeStyle = style.getStroke();
            if (strokeStyle) {
                var lineStringReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.LINE_STRING);
                lineStringReplay.setFillStrokeStyle(null, strokeStyle);
                lineStringReplay.drawLineString(geometry, feature);
            }
            var textStyle = style.getText();
            if (textStyle) {
                var textReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.TEXT);
                textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(false));
                textReplay.drawText(geometry, feature);
            }
        };
        _ol_renderer_vector_.renderMultiLineStringGeometry_ = function(replayGroup, geometry, style, feature) {
            var strokeStyle = style.getStroke();
            if (strokeStyle) {
                var lineStringReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.LINE_STRING);
                lineStringReplay.setFillStrokeStyle(null, strokeStyle);
                lineStringReplay.drawMultiLineString(geometry, feature);
            }
            var textStyle = style.getText();
            if (textStyle) {
                var textReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.TEXT);
                textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(false));
                textReplay.drawText(geometry, feature);
            }
        };
        _ol_renderer_vector_.renderMultiPolygonGeometry_ = function(replayGroup, geometry, style, feature) {
            var fillStyle = style.getFill();
            var strokeStyle = style.getStroke();
            if (strokeStyle || fillStyle) {
                var polygonReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.POLYGON);
                polygonReplay.setFillStrokeStyle(fillStyle, strokeStyle);
                polygonReplay.drawMultiPolygon(geometry, feature);
            }
            var textStyle = style.getText();
            if (textStyle) {
                var textReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.TEXT);
                textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(false));
                textReplay.drawText(geometry, feature);
            }
        };
        _ol_renderer_vector_.renderPointGeometry_ = function(replayGroup, geometry, style, feature) {
            var imageStyle = style.getImage();
            if (imageStyle) {
                if (imageStyle.getImageState() != _imagestate2.default.LOADED) {
                    return;
                }
                var imageReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.IMAGE);
                imageReplay.setImageStyle(imageStyle, replayGroup.addDeclutter(false));
                imageReplay.drawPoint(geometry, feature);
            }
            var textStyle = style.getText();
            if (textStyle) {
                var textReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.TEXT);
                textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(!!imageStyle));
                textReplay.drawText(geometry, feature);
            }
        };
        _ol_renderer_vector_.renderMultiPointGeometry_ = function(replayGroup, geometry, style, feature) {
            var imageStyle = style.getImage();
            if (imageStyle) {
                if (imageStyle.getImageState() != _imagestate2.default.LOADED) {
                    return;
                }
                var imageReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.IMAGE);
                imageReplay.setImageStyle(imageStyle, replayGroup.addDeclutter(false));
                imageReplay.drawMultiPoint(geometry, feature);
            }
            var textStyle = style.getText();
            if (textStyle) {
                var textReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.TEXT);
                textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(!!imageStyle));
                textReplay.drawText(geometry, feature);
            }
        };
        _ol_renderer_vector_.renderPolygonGeometry_ = function(replayGroup, geometry, style, feature) {
            var fillStyle = style.getFill();
            var strokeStyle = style.getStroke();
            if (fillStyle || strokeStyle) {
                var polygonReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.POLYGON);
                polygonReplay.setFillStrokeStyle(fillStyle, strokeStyle);
                polygonReplay.drawPolygon(geometry, feature);
            }
            var textStyle = style.getText();
            if (textStyle) {
                var textReplay = replayGroup.getReplay(style.getZIndex(), _replaytype2.default.TEXT);
                textReplay.setTextStyle(textStyle, replayGroup.addDeclutter(false));
                textReplay.drawText(geometry, feature);
            }
        };
        _ol_renderer_vector_.GEOMETRY_RENDERERS_ = {
            Point: _ol_renderer_vector_.renderPointGeometry_,
            LineString: _ol_renderer_vector_.renderLineStringGeometry_,
            Polygon: _ol_renderer_vector_.renderPolygonGeometry_,
            MultiPoint: _ol_renderer_vector_.renderMultiPointGeometry_,
            MultiLineString: _ol_renderer_vector_.renderMultiLineStringGeometry_,
            MultiPolygon: _ol_renderer_vector_.renderMultiPolygonGeometry_,
            GeometryCollection: _ol_renderer_vector_.renderGeometryCollectionGeometry_,
            Circle: _ol_renderer_vector_.renderCircleGeometry_
        };
        exports.default = _ol_renderer_vector_;
    }, {
        "../geom/geometrytype.js": 79,
        "../imagestate.js": 88,
        "../index.js": 89,
        "../render/replaytype.js": 163
    } ],
    194: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _fragment = require("../../webgl/fragment.js");
        var _fragment2 = _interopRequireDefault(_fragment);
        var _vertex = require("../../webgl/vertex.js");
        var _vertex2 = _interopRequireDefault(_vertex);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_webgl_defaultmapshader_ = {};
        _ol_renderer_webgl_defaultmapshader_.fragment = new _fragment2.default(_index2.default.DEBUG_WEBGL ? "precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform float u_opacity;\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_texture, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  gl_FragColor.a = texColor.a * u_opacity;\n}\n" : "precision mediump float;varying vec2 a;uniform float f;uniform sampler2D g;void main(void){vec4 texColor=texture2D(g,a);gl_FragColor.rgb=texColor.rgb;gl_FragColor.a=texColor.a*f;}");
        _ol_renderer_webgl_defaultmapshader_.vertex = new _vertex2.default(_index2.default.DEBUG_WEBGL ? "varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat4 u_texCoordMatrix;\nuniform mat4 u_projectionMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\n}\n\n\n" : "varying vec2 a;attribute vec2 b;attribute vec2 c;uniform mat4 d;uniform mat4 e;void main(void){gl_Position=e*vec4(b,0.,1.);a=(d*vec4(c,0.,1.)).st;}");
        exports.default = _ol_renderer_webgl_defaultmapshader_;
    }, {
        "../../index.js": 89,
        "../../webgl/fragment.js": 252,
        "../../webgl/vertex.js": 254
    } ],
    195: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../../index.js");
        var _index2 = _interopRequireDefault(_index);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_webgl_defaultmapshader_Locations_ = function(gl, program) {
            this.u_texCoordMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_texCoordMatrix" : "d");
            this.u_projectionMatrix = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_projectionMatrix" : "e");
            this.u_opacity = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_opacity" : "f");
            this.u_texture = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_texture" : "g");
            this.a_position = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_position" : "b");
            this.a_texCoord = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_texCoord" : "c");
        };
        exports.default = _ol_renderer_webgl_defaultmapshader_Locations_;
    }, {
        "../../../index.js": 89
    } ],
    196: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _layertype = require("../../layertype.js");
        var _layertype2 = _interopRequireDefault(_layertype);
        var _viewhint = require("../../viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _dom = require("../../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _functions = require("../../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _type = require("../type.js");
        var _type2 = _interopRequireDefault(_type);
        var _layer = require("../webgl/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _webgl = require("../../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _context = require("../../webgl/context.js");
        var _context2 = _interopRequireDefault(_context);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_webgl_ImageLayer_ = function(mapRenderer, imageLayer) {
            _layer2.default.call(this, mapRenderer, imageLayer);
            this.image_ = null;
            this.hitCanvasContext_ = null;
            this.hitTransformationMatrix_ = null;
        };
        _index2.default.inherits(_ol_renderer_webgl_ImageLayer_, _layer2.default);
        _ol_renderer_webgl_ImageLayer_["handles"] = function(type, layer) {
            return type === _type2.default.WEBGL && layer.getType() === _layertype2.default.IMAGE;
        };
        _ol_renderer_webgl_ImageLayer_["create"] = function(mapRenderer, layer) {
            return new _ol_renderer_webgl_ImageLayer_(mapRenderer, layer);
        };
        _ol_renderer_webgl_ImageLayer_.prototype.createTexture_ = function(image) {
            var imageElement = image.getImage();
            var gl = this.mapRenderer.getGL();
            return _context2.default.createTexture(gl, imageElement, _webgl2.default.CLAMP_TO_EDGE, _webgl2.default.CLAMP_TO_EDGE);
        };
        _ol_renderer_webgl_ImageLayer_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {
            var layer = this.getLayer();
            var source = layer.getSource();
            var resolution = frameState.viewState.resolution;
            var rotation = frameState.viewState.rotation;
            var skippedFeatureUids = frameState.skippedFeatureUids;
            return source.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, skippedFeatureUids, function(feature) {
                return callback.call(thisArg, feature, layer);
            });
        };
        _ol_renderer_webgl_ImageLayer_.prototype.prepareFrame = function(frameState, layerState, context) {
            var gl = this.mapRenderer.getGL();
            var pixelRatio = frameState.pixelRatio;
            var viewState = frameState.viewState;
            var viewCenter = viewState.center;
            var viewResolution = viewState.resolution;
            var viewRotation = viewState.rotation;
            var image = this.image_;
            var texture = this.texture;
            var imageLayer = this.getLayer();
            var imageSource = imageLayer.getSource();
            var hints = frameState.viewHints;
            var renderedExtent = frameState.extent;
            if (layerState.extent !== undefined) {
                renderedExtent = _extent2.default.getIntersection(renderedExtent, layerState.extent);
            }
            if (!hints[_viewhint2.default.ANIMATING] && !hints[_viewhint2.default.INTERACTING] && !_extent2.default.isEmpty(renderedExtent)) {
                var projection = viewState.projection;
                if (!_index2.default.ENABLE_RASTER_REPROJECTION) {
                    var sourceProjection = imageSource.getProjection();
                    if (sourceProjection) {
                        projection = sourceProjection;
                    }
                }
                var image_ = imageSource.getImage(renderedExtent, viewResolution, pixelRatio, projection);
                if (image_) {
                    var loaded = this.loadImage(image_);
                    if (loaded) {
                        image = image_;
                        texture = this.createTexture_(image_);
                        if (this.texture) {
                            var postRenderFunction = function(gl, texture) {
                                if (!gl.isContextLost()) {
                                    gl.deleteTexture(texture);
                                }
                            }.bind(null, gl, this.texture);
                            frameState.postRenderFunctions.push(postRenderFunction);
                        }
                    }
                }
            }
            if (image) {
                var canvas = this.mapRenderer.getContext().getCanvas();
                this.updateProjectionMatrix_(canvas.width, canvas.height, pixelRatio, viewCenter, viewResolution, viewRotation, image.getExtent());
                this.hitTransformationMatrix_ = null;
                var texCoordMatrix = this.texCoordMatrix;
                _transform2.default.reset(texCoordMatrix);
                _transform2.default.scale(texCoordMatrix, 1, -1);
                _transform2.default.translate(texCoordMatrix, 0, -1);
                this.image_ = image;
                this.texture = texture;
                this.updateLogos(frameState, imageSource);
            }
            return !!image;
        };
        _ol_renderer_webgl_ImageLayer_.prototype.updateProjectionMatrix_ = function(canvasWidth, canvasHeight, pixelRatio, viewCenter, viewResolution, viewRotation, imageExtent) {
            var canvasExtentWidth = canvasWidth * viewResolution;
            var canvasExtentHeight = canvasHeight * viewResolution;
            var projectionMatrix = this.projectionMatrix;
            _transform2.default.reset(projectionMatrix);
            _transform2.default.scale(projectionMatrix, pixelRatio * 2 / canvasExtentWidth, pixelRatio * 2 / canvasExtentHeight);
            _transform2.default.rotate(projectionMatrix, -viewRotation);
            _transform2.default.translate(projectionMatrix, imageExtent[0] - viewCenter[0], imageExtent[1] - viewCenter[1]);
            _transform2.default.scale(projectionMatrix, (imageExtent[2] - imageExtent[0]) / 2, (imageExtent[3] - imageExtent[1]) / 2);
            _transform2.default.translate(projectionMatrix, 1, 1);
        };
        _ol_renderer_webgl_ImageLayer_.prototype.hasFeatureAtCoordinate = function(coordinate, frameState) {
            var hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, 0, _functions2.default.TRUE, this);
            return hasFeature !== undefined;
        };
        _ol_renderer_webgl_ImageLayer_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg) {
            if (!this.image_ || !this.image_.getImage()) {
                return undefined;
            }
            if (this.getLayer().getSource().forEachFeatureAtCoordinate !== _index2.default.nullFunction) {
                var coordinate = _transform2.default.apply(frameState.pixelToCoordinateTransform, pixel.slice());
                var hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, 0, _functions2.default.TRUE, this);
                if (hasFeature) {
                    return callback.call(thisArg, this.getLayer(), null);
                } else {
                    return undefined;
                }
            } else {
                var imageSize = [ this.image_.getImage().width, this.image_.getImage().height ];
                if (!this.hitTransformationMatrix_) {
                    this.hitTransformationMatrix_ = this.getHitTransformationMatrix_(frameState.size, imageSize);
                }
                var pixelOnFrameBuffer = _transform2.default.apply(this.hitTransformationMatrix_, pixel.slice());
                if (pixelOnFrameBuffer[0] < 0 || pixelOnFrameBuffer[0] > imageSize[0] || pixelOnFrameBuffer[1] < 0 || pixelOnFrameBuffer[1] > imageSize[1]) {
                    return undefined;
                }
                if (!this.hitCanvasContext_) {
                    this.hitCanvasContext_ = _dom2.default.createCanvasContext2D(1, 1);
                }
                this.hitCanvasContext_.clearRect(0, 0, 1, 1);
                this.hitCanvasContext_.drawImage(this.image_.getImage(), pixelOnFrameBuffer[0], pixelOnFrameBuffer[1], 1, 1, 0, 0, 1, 1);
                var imageData = this.hitCanvasContext_.getImageData(0, 0, 1, 1).data;
                if (imageData[3] > 0) {
                    return callback.call(thisArg, this.getLayer(), imageData);
                } else {
                    return undefined;
                }
            }
        };
        _ol_renderer_webgl_ImageLayer_.prototype.getHitTransformationMatrix_ = function(mapSize, imageSize) {
            var mapCoordTransform = _transform2.default.create();
            _transform2.default.translate(mapCoordTransform, -1, -1);
            _transform2.default.scale(mapCoordTransform, 2 / mapSize[0], 2 / mapSize[1]);
            _transform2.default.translate(mapCoordTransform, 0, mapSize[1]);
            _transform2.default.scale(mapCoordTransform, 1, -1);
            var projectionMatrixInv = _transform2.default.invert(this.projectionMatrix.slice());
            var transform = _transform2.default.create();
            _transform2.default.translate(transform, 0, imageSize[1]);
            _transform2.default.scale(transform, 1, -1);
            _transform2.default.scale(transform, imageSize[0] / 2, imageSize[1] / 2);
            _transform2.default.translate(transform, 1, 1);
            _transform2.default.multiply(transform, projectionMatrixInv);
            _transform2.default.multiply(transform, mapCoordTransform);
            return transform;
        };
        exports.default = _ol_renderer_webgl_ImageLayer_;
    }, {
        "../../dom.js": 46,
        "../../extent.js": 54,
        "../../functions.js": 60,
        "../../index.js": 89,
        "../../layertype.js": 113,
        "../../transform.js": 243,
        "../../viewhint.js": 246,
        "../../webgl.js": 248,
        "../../webgl/context.js": 250,
        "../type.js": 192,
        "../webgl/layer.js": 197
    } ],
    197: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _event = require("../../render/event.js");
        var _event2 = _interopRequireDefault(_event);
        var _eventtype = require("../../render/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _immediate = require("../../render/webgl/immediate.js");
        var _immediate2 = _interopRequireDefault(_immediate);
        var _layer = require("../layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _defaultmapshader = require("../webgl/defaultmapshader.js");
        var _defaultmapshader2 = _interopRequireDefault(_defaultmapshader);
        var _locations = require("../webgl/defaultmapshader/locations.js");
        var _locations2 = _interopRequireDefault(_locations);
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _mat = require("../../vec/mat4.js");
        var _mat2 = _interopRequireDefault(_mat);
        var _webgl = require("../../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _buffer = require("../../webgl/buffer.js");
        var _buffer2 = _interopRequireDefault(_buffer);
        var _context = require("../../webgl/context.js");
        var _context2 = _interopRequireDefault(_context);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_webgl_Layer_ = function(mapRenderer, layer) {
            _layer2.default.call(this, layer);
            this.mapRenderer = mapRenderer;
            this.arrayBuffer_ = new _buffer2.default([ -1, -1, 0, 0, 1, -1, 1, 0, -1, 1, 0, 1, 1, 1, 1, 1 ]);
            this.texture = null;
            this.framebuffer = null;
            this.framebufferDimension = undefined;
            this.texCoordMatrix = _transform2.default.create();
            this.projectionMatrix = _transform2.default.create();
            this.tmpMat4_ = _mat2.default.create();
            this.defaultLocations_ = null;
        };
        _index2.default.inherits(_ol_renderer_webgl_Layer_, _layer2.default);
        _ol_renderer_webgl_Layer_.prototype.bindFramebuffer = function(frameState, framebufferDimension) {
            var gl = this.mapRenderer.getGL();
            if (this.framebufferDimension === undefined || this.framebufferDimension != framebufferDimension) {
                var postRenderFunction = function(gl, framebuffer, texture) {
                    if (!gl.isContextLost()) {
                        gl.deleteFramebuffer(framebuffer);
                        gl.deleteTexture(texture);
                    }
                }.bind(null, gl, this.framebuffer, this.texture);
                frameState.postRenderFunctions.push(postRenderFunction);
                var texture = _context2.default.createEmptyTexture(gl, framebufferDimension, framebufferDimension);
                var framebuffer = gl.createFramebuffer();
                gl.bindFramebuffer(_webgl2.default.FRAMEBUFFER, framebuffer);
                gl.framebufferTexture2D(_webgl2.default.FRAMEBUFFER, _webgl2.default.COLOR_ATTACHMENT0, _webgl2.default.TEXTURE_2D, texture, 0);
                this.texture = texture;
                this.framebuffer = framebuffer;
                this.framebufferDimension = framebufferDimension;
            } else {
                gl.bindFramebuffer(_webgl2.default.FRAMEBUFFER, this.framebuffer);
            }
        };
        _ol_renderer_webgl_Layer_.prototype.composeFrame = function(frameState, layerState, context) {
            this.dispatchComposeEvent_(_eventtype2.default.PRECOMPOSE, context, frameState);
            context.bindBuffer(_webgl2.default.ARRAY_BUFFER, this.arrayBuffer_);
            var gl = context.getGL();
            var fragmentShader = _defaultmapshader2.default.fragment;
            var vertexShader = _defaultmapshader2.default.vertex;
            var program = context.getProgram(fragmentShader, vertexShader);
            var locations;
            if (!this.defaultLocations_) {
                locations = new _locations2.default(gl, program);
                this.defaultLocations_ = locations;
            } else {
                locations = this.defaultLocations_;
            }
            if (context.useProgram(program)) {
                gl.enableVertexAttribArray(locations.a_position);
                gl.vertexAttribPointer(locations.a_position, 2, _webgl2.default.FLOAT, false, 16, 0);
                gl.enableVertexAttribArray(locations.a_texCoord);
                gl.vertexAttribPointer(locations.a_texCoord, 2, _webgl2.default.FLOAT, false, 16, 8);
                gl.uniform1i(locations.u_texture, 0);
            }
            gl.uniformMatrix4fv(locations.u_texCoordMatrix, false, _mat2.default.fromTransform(this.tmpMat4_, this.getTexCoordMatrix()));
            gl.uniformMatrix4fv(locations.u_projectionMatrix, false, _mat2.default.fromTransform(this.tmpMat4_, this.getProjectionMatrix()));
            gl.uniform1f(locations.u_opacity, layerState.opacity);
            gl.bindTexture(_webgl2.default.TEXTURE_2D, this.getTexture());
            gl.drawArrays(_webgl2.default.TRIANGLE_STRIP, 0, 4);
            this.dispatchComposeEvent_(_eventtype2.default.POSTCOMPOSE, context, frameState);
        };
        _ol_renderer_webgl_Layer_.prototype.dispatchComposeEvent_ = function(type, context, frameState) {
            var layer = this.getLayer();
            if (layer.hasListener(type)) {
                var viewState = frameState.viewState;
                var resolution = viewState.resolution;
                var pixelRatio = frameState.pixelRatio;
                var extent = frameState.extent;
                var center = viewState.center;
                var rotation = viewState.rotation;
                var size = frameState.size;
                var render = new _immediate2.default(context, center, resolution, rotation, size, extent, pixelRatio);
                var composeEvent = new _event2.default(type, render, frameState, null, context);
                layer.dispatchEvent(composeEvent);
            }
        };
        _ol_renderer_webgl_Layer_.prototype.getTexCoordMatrix = function() {
            return this.texCoordMatrix;
        };
        _ol_renderer_webgl_Layer_.prototype.getTexture = function() {
            return this.texture;
        };
        _ol_renderer_webgl_Layer_.prototype.getProjectionMatrix = function() {
            return this.projectionMatrix;
        };
        _ol_renderer_webgl_Layer_.prototype.handleWebGLContextLost = function() {
            this.texture = null;
            this.framebuffer = null;
            this.framebufferDimension = undefined;
        };
        _ol_renderer_webgl_Layer_.prototype.prepareFrame = function(frameState, layerState, context) {};
        _ol_renderer_webgl_Layer_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg) {};
        exports.default = _ol_renderer_webgl_Layer_;
    }, {
        "../../index.js": 89,
        "../../render/event.js": 159,
        "../../render/eventtype.js": 160,
        "../../render/webgl/immediate.js": 170,
        "../../transform.js": 243,
        "../../vec/mat4.js": 244,
        "../../webgl.js": 248,
        "../../webgl/buffer.js": 249,
        "../../webgl/context.js": 250,
        "../layer.js": 190,
        "../webgl/defaultmapshader.js": 194,
        "../webgl/defaultmapshader/locations.js": 195
    } ],
    198: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _css = require("../../css.js");
        var _css2 = _interopRequireDefault(_css);
        var _dom = require("../../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _events = require("../../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _has = require("../../has.js");
        var _has2 = _interopRequireDefault(_has);
        var _layer = require("../../layer/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _event = require("../../render/event.js");
        var _event2 = _interopRequireDefault(_event);
        var _eventtype = require("../../render/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _immediate = require("../../render/webgl/immediate.js");
        var _immediate2 = _interopRequireDefault(_immediate);
        var _map = require("../map.js");
        var _map2 = _interopRequireDefault(_map);
        var _type = require("../type.js");
        var _type2 = _interopRequireDefault(_type);
        var _state = require("../../source/state.js");
        var _state2 = _interopRequireDefault(_state);
        var _lrucache = require("../../structs/lrucache.js");
        var _lrucache2 = _interopRequireDefault(_lrucache);
        var _priorityqueue = require("../../structs/priorityqueue.js");
        var _priorityqueue2 = _interopRequireDefault(_priorityqueue);
        var _webgl = require("../../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _context = require("../../webgl/context.js");
        var _context2 = _interopRequireDefault(_context);
        var _contexteventtype = require("../../webgl/contexteventtype.js");
        var _contexteventtype2 = _interopRequireDefault(_contexteventtype);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_webgl_Map_ = function(container, map) {
            _map2.default.call(this, container, map);
            this.canvas_ = document.createElement("CANVAS");
            this.canvas_.style.width = "100%";
            this.canvas_.style.height = "100%";
            this.canvas_.style.display = "block";
            this.canvas_.className = _css2.default.CLASS_UNSELECTABLE;
            container.insertBefore(this.canvas_, container.childNodes[0] || null);
            this.clipTileCanvasWidth_ = 0;
            this.clipTileCanvasHeight_ = 0;
            this.clipTileContext_ = _dom2.default.createCanvasContext2D();
            this.renderedVisible_ = true;
            this.gl_ = _webgl2.default.getContext(this.canvas_, {
                antialias: true,
                depth: true,
                failIfMajorPerformanceCaveat: true,
                preserveDrawingBuffer: false,
                stencil: true
            });
            this.context_ = new _context2.default(this.canvas_, this.gl_);
            _events2.default.listen(this.canvas_, _contexteventtype2.default.LOST, this.handleWebGLContextLost, this);
            _events2.default.listen(this.canvas_, _contexteventtype2.default.RESTORED, this.handleWebGLContextRestored, this);
            this.textureCache_ = new _lrucache2.default();
            this.focus_ = null;
            this.tileTextureQueue_ = new _priorityqueue2.default(function(element) {
                var tileCenter = element[1];
                var tileResolution = element[2];
                var deltaX = tileCenter[0] - this.focus_[0];
                var deltaY = tileCenter[1] - this.focus_[1];
                return 65536 * Math.log(tileResolution) + Math.sqrt(deltaX * deltaX + deltaY * deltaY) / tileResolution;
            }.bind(this), function(element) {
                return element[0].getKey();
            });
            this.loadNextTileTexture_ = function(map, frameState) {
                if (!this.tileTextureQueue_.isEmpty()) {
                    this.tileTextureQueue_.reprioritize();
                    var element = this.tileTextureQueue_.dequeue();
                    var tile = element[0];
                    var tileSize = element[3];
                    var tileGutter = element[4];
                    this.bindTileTexture(tile, tileSize, tileGutter, _webgl2.default.LINEAR, _webgl2.default.LINEAR);
                }
                return false;
            }.bind(this);
            this.textureCacheFrameMarkerCount_ = 0;
            this.initializeGL_();
        };
        _index2.default.inherits(_ol_renderer_webgl_Map_, _map2.default);
        _ol_renderer_webgl_Map_["handles"] = function(type) {
            return _has2.default.WEBGL && type === _type2.default.WEBGL;
        };
        _ol_renderer_webgl_Map_["create"] = function(container, map) {
            return new _ol_renderer_webgl_Map_(container, map);
        };
        _ol_renderer_webgl_Map_.prototype.bindTileTexture = function(tile, tileSize, tileGutter, magFilter, minFilter) {
            var gl = this.getGL();
            var tileKey = tile.getKey();
            if (this.textureCache_.containsKey(tileKey)) {
                var textureCacheEntry = this.textureCache_.get(tileKey);
                gl.bindTexture(_webgl2.default.TEXTURE_2D, textureCacheEntry.texture);
                if (textureCacheEntry.magFilter != magFilter) {
                    gl.texParameteri(_webgl2.default.TEXTURE_2D, _webgl2.default.TEXTURE_MAG_FILTER, magFilter);
                    textureCacheEntry.magFilter = magFilter;
                }
                if (textureCacheEntry.minFilter != minFilter) {
                    gl.texParameteri(_webgl2.default.TEXTURE_2D, _webgl2.default.TEXTURE_MIN_FILTER, minFilter);
                    textureCacheEntry.minFilter = minFilter;
                }
            } else {
                var texture = gl.createTexture();
                gl.bindTexture(_webgl2.default.TEXTURE_2D, texture);
                if (tileGutter > 0) {
                    var clipTileCanvas = this.clipTileContext_.canvas;
                    var clipTileContext = this.clipTileContext_;
                    if (this.clipTileCanvasWidth_ !== tileSize[0] || this.clipTileCanvasHeight_ !== tileSize[1]) {
                        clipTileCanvas.width = tileSize[0];
                        clipTileCanvas.height = tileSize[1];
                        this.clipTileCanvasWidth_ = tileSize[0];
                        this.clipTileCanvasHeight_ = tileSize[1];
                    } else {
                        clipTileContext.clearRect(0, 0, tileSize[0], tileSize[1]);
                    }
                    clipTileContext.drawImage(tile.getImage(), tileGutter, tileGutter, tileSize[0], tileSize[1], 0, 0, tileSize[0], tileSize[1]);
                    gl.texImage2D(_webgl2.default.TEXTURE_2D, 0, _webgl2.default.RGBA, _webgl2.default.RGBA, _webgl2.default.UNSIGNED_BYTE, clipTileCanvas);
                } else {
                    gl.texImage2D(_webgl2.default.TEXTURE_2D, 0, _webgl2.default.RGBA, _webgl2.default.RGBA, _webgl2.default.UNSIGNED_BYTE, tile.getImage());
                }
                gl.texParameteri(_webgl2.default.TEXTURE_2D, _webgl2.default.TEXTURE_MAG_FILTER, magFilter);
                gl.texParameteri(_webgl2.default.TEXTURE_2D, _webgl2.default.TEXTURE_MIN_FILTER, minFilter);
                gl.texParameteri(_webgl2.default.TEXTURE_2D, _webgl2.default.TEXTURE_WRAP_S, _webgl2.default.CLAMP_TO_EDGE);
                gl.texParameteri(_webgl2.default.TEXTURE_2D, _webgl2.default.TEXTURE_WRAP_T, _webgl2.default.CLAMP_TO_EDGE);
                this.textureCache_.set(tileKey, {
                    texture: texture,
                    magFilter: magFilter,
                    minFilter: minFilter
                });
            }
        };
        _ol_renderer_webgl_Map_.prototype.dispatchComposeEvent_ = function(type, frameState) {
            var map = this.getMap();
            if (map.hasListener(type)) {
                var context = this.context_;
                var extent = frameState.extent;
                var size = frameState.size;
                var viewState = frameState.viewState;
                var pixelRatio = frameState.pixelRatio;
                var resolution = viewState.resolution;
                var center = viewState.center;
                var rotation = viewState.rotation;
                var vectorContext = new _immediate2.default(context, center, resolution, rotation, size, extent, pixelRatio);
                var composeEvent = new _event2.default(type, vectorContext, frameState, null, context);
                map.dispatchEvent(composeEvent);
            }
        };
        _ol_renderer_webgl_Map_.prototype.disposeInternal = function() {
            var gl = this.getGL();
            if (!gl.isContextLost()) {
                this.textureCache_.forEach(function(textureCacheEntry) {
                    if (textureCacheEntry) {
                        gl.deleteTexture(textureCacheEntry.texture);
                    }
                });
            }
            this.context_.dispose();
            _map2.default.prototype.disposeInternal.call(this);
        };
        _ol_renderer_webgl_Map_.prototype.expireCache_ = function(map, frameState) {
            var gl = this.getGL();
            var textureCacheEntry;
            while (this.textureCache_.getCount() - this.textureCacheFrameMarkerCount_ > _index2.default.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK) {
                textureCacheEntry = this.textureCache_.peekLast();
                if (!textureCacheEntry) {
                    if (+this.textureCache_.peekLastKey() == frameState.index) {
                        break;
                    } else {
                        --this.textureCacheFrameMarkerCount_;
                    }
                } else {
                    gl.deleteTexture(textureCacheEntry.texture);
                }
                this.textureCache_.pop();
            }
        };
        _ol_renderer_webgl_Map_.prototype.getContext = function() {
            return this.context_;
        };
        _ol_renderer_webgl_Map_.prototype.getGL = function() {
            return this.gl_;
        };
        _ol_renderer_webgl_Map_.prototype.getTileTextureQueue = function() {
            return this.tileTextureQueue_;
        };
        _ol_renderer_webgl_Map_.prototype.getType = function() {
            return _type2.default.WEBGL;
        };
        _ol_renderer_webgl_Map_.prototype.handleWebGLContextLost = function(event) {
            event.preventDefault();
            this.textureCache_.clear();
            this.textureCacheFrameMarkerCount_ = 0;
            var renderers = this.getLayerRenderers();
            for (var id in renderers) {
                var renderer = renderers[id];
                renderer.handleWebGLContextLost();
            }
        };
        _ol_renderer_webgl_Map_.prototype.handleWebGLContextRestored = function() {
            this.initializeGL_();
            this.getMap().render();
        };
        _ol_renderer_webgl_Map_.prototype.initializeGL_ = function() {
            var gl = this.gl_;
            gl.activeTexture(_webgl2.default.TEXTURE0);
            gl.blendFuncSeparate(_webgl2.default.SRC_ALPHA, _webgl2.default.ONE_MINUS_SRC_ALPHA, _webgl2.default.ONE, _webgl2.default.ONE_MINUS_SRC_ALPHA);
            gl.disable(_webgl2.default.CULL_FACE);
            gl.disable(_webgl2.default.DEPTH_TEST);
            gl.disable(_webgl2.default.SCISSOR_TEST);
            gl.disable(_webgl2.default.STENCIL_TEST);
        };
        _ol_renderer_webgl_Map_.prototype.isTileTextureLoaded = function(tile) {
            return this.textureCache_.containsKey(tile.getKey());
        };
        _ol_renderer_webgl_Map_.prototype.renderFrame = function(frameState) {
            var context = this.getContext();
            var gl = this.getGL();
            if (gl.isContextLost()) {
                return false;
            }
            if (!frameState) {
                if (this.renderedVisible_) {
                    this.canvas_.style.display = "none";
                    this.renderedVisible_ = false;
                }
                return false;
            }
            this.focus_ = frameState.focus;
            this.textureCache_.set((-frameState.index).toString(), null);
            ++this.textureCacheFrameMarkerCount_;
            this.dispatchComposeEvent_(_eventtype2.default.PRECOMPOSE, frameState);
            var layerStatesToDraw = [];
            var layerStatesArray = frameState.layerStatesArray;
            _array2.default.stableSort(layerStatesArray, _map2.default.sortByZIndex);
            var viewResolution = frameState.viewState.resolution;
            var i, ii, layerRenderer, layerState;
            for (i = 0, ii = layerStatesArray.length; i < ii; ++i) {
                layerState = layerStatesArray[i];
                if (_layer2.default.visibleAtResolution(layerState, viewResolution) && layerState.sourceState == _state2.default.READY) {
                    layerRenderer = this.getLayerRenderer(layerState.layer);
                    if (layerRenderer.prepareFrame(frameState, layerState, context)) {
                        layerStatesToDraw.push(layerState);
                    }
                }
            }
            var width = frameState.size[0] * frameState.pixelRatio;
            var height = frameState.size[1] * frameState.pixelRatio;
            if (this.canvas_.width != width || this.canvas_.height != height) {
                this.canvas_.width = width;
                this.canvas_.height = height;
            }
            gl.bindFramebuffer(_webgl2.default.FRAMEBUFFER, null);
            gl.clearColor(0, 0, 0, 0);
            gl.clear(_webgl2.default.COLOR_BUFFER_BIT);
            gl.enable(_webgl2.default.BLEND);
            gl.viewport(0, 0, this.canvas_.width, this.canvas_.height);
            for (i = 0, ii = layerStatesToDraw.length; i < ii; ++i) {
                layerState = layerStatesToDraw[i];
                layerRenderer = this.getLayerRenderer(layerState.layer);
                layerRenderer.composeFrame(frameState, layerState, context);
            }
            if (!this.renderedVisible_) {
                this.canvas_.style.display = "";
                this.renderedVisible_ = true;
            }
            this.calculateMatrices2D(frameState);
            if (this.textureCache_.getCount() - this.textureCacheFrameMarkerCount_ > _index2.default.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK) {
                frameState.postRenderFunctions.push(this.expireCache_.bind(this));
            }
            if (!this.tileTextureQueue_.isEmpty()) {
                frameState.postRenderFunctions.push(this.loadNextTileTexture_);
                frameState.animate = true;
            }
            this.dispatchComposeEvent_(_eventtype2.default.POSTCOMPOSE, frameState);
            this.scheduleRemoveUnusedLayerRenderers(frameState);
            this.scheduleExpireIconCache(frameState);
        };
        _ol_renderer_webgl_Map_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg, layerFilter, thisArg2) {
            var result;
            if (this.getGL().isContextLost()) {
                return false;
            }
            var viewState = frameState.viewState;
            var layerStates = frameState.layerStatesArray;
            var numLayers = layerStates.length;
            var i;
            for (i = numLayers - 1; i >= 0; --i) {
                var layerState = layerStates[i];
                var layer = layerState.layer;
                if (_layer2.default.visibleAtResolution(layerState, viewState.resolution) && layerFilter.call(thisArg2, layer)) {
                    var layerRenderer = this.getLayerRenderer(layer);
                    result = layerRenderer.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, callback, thisArg);
                    if (result) {
                        return result;
                    }
                }
            }
            return undefined;
        };
        _ol_renderer_webgl_Map_.prototype.hasFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, layerFilter, thisArg) {
            var hasFeature = false;
            if (this.getGL().isContextLost()) {
                return false;
            }
            var viewState = frameState.viewState;
            var layerStates = frameState.layerStatesArray;
            var numLayers = layerStates.length;
            var i;
            for (i = numLayers - 1; i >= 0; --i) {
                var layerState = layerStates[i];
                var layer = layerState.layer;
                if (_layer2.default.visibleAtResolution(layerState, viewState.resolution) && layerFilter.call(thisArg, layer)) {
                    var layerRenderer = this.getLayerRenderer(layer);
                    hasFeature = layerRenderer.hasFeatureAtCoordinate(coordinate, frameState);
                    if (hasFeature) {
                        return true;
                    }
                }
            }
            return hasFeature;
        };
        _ol_renderer_webgl_Map_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg, layerFilter, thisArg2) {
            if (this.getGL().isContextLost()) {
                return false;
            }
            var viewState = frameState.viewState;
            var result;
            var layerStates = frameState.layerStatesArray;
            var numLayers = layerStates.length;
            var i;
            for (i = numLayers - 1; i >= 0; --i) {
                var layerState = layerStates[i];
                var layer = layerState.layer;
                if (_layer2.default.visibleAtResolution(layerState, viewState.resolution) && layerFilter.call(thisArg, layer)) {
                    var layerRenderer = this.getLayerRenderer(layer);
                    result = layerRenderer.forEachLayerAtPixel(pixel, frameState, callback, thisArg);
                    if (result) {
                        return result;
                    }
                }
            }
            return undefined;
        };
        exports.default = _ol_renderer_webgl_Map_;
    }, {
        "../../array.js": 29,
        "../../css.js": 44,
        "../../dom.js": 46,
        "../../events.js": 48,
        "../../has.js": 84,
        "../../index.js": 89,
        "../../layer/layer.js": 108,
        "../../render/event.js": 159,
        "../../render/eventtype.js": 160,
        "../../render/webgl/immediate.js": 170,
        "../../source/state.js": 212,
        "../../structs/lrucache.js": 218,
        "../../structs/priorityqueue.js": 219,
        "../../webgl.js": 248,
        "../../webgl/context.js": 250,
        "../../webgl/contexteventtype.js": 251,
        "../map.js": 191,
        "../type.js": 192
    } ],
    199: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _layertype = require("../../layertype.js");
        var _layertype2 = _interopRequireDefault(_layertype);
        var _tilerange = require("../../tilerange.js");
        var _tilerange2 = _interopRequireDefault(_tilerange);
        var _tilestate = require("../../tilestate.js");
        var _tilestate2 = _interopRequireDefault(_tilestate);
        var _array = require("../../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _math = require("../../math.js");
        var _math2 = _interopRequireDefault(_math);
        var _type = require("../type.js");
        var _type2 = _interopRequireDefault(_type);
        var _layer = require("../webgl/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _tilelayershader = require("../webgl/tilelayershader.js");
        var _tilelayershader2 = _interopRequireDefault(_tilelayershader);
        var _locations = require("../webgl/tilelayershader/locations.js");
        var _locations2 = _interopRequireDefault(_locations);
        var _size = require("../../size.js");
        var _size2 = _interopRequireDefault(_size);
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        var _webgl = require("../../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _buffer = require("../../webgl/buffer.js");
        var _buffer2 = _interopRequireDefault(_buffer);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_webgl_TileLayer_ = function(mapRenderer, tileLayer) {
            _layer2.default.call(this, mapRenderer, tileLayer);
            this.fragmentShader_ = _tilelayershader2.default.fragment;
            this.vertexShader_ = _tilelayershader2.default.vertex;
            this.locations_ = null;
            this.renderArrayBuffer_ = new _buffer2.default([ 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0 ]);
            this.renderedTileRange_ = null;
            this.renderedFramebufferExtent_ = null;
            this.renderedRevision_ = -1;
            this.tmpSize_ = [ 0, 0 ];
        };
        _index2.default.inherits(_ol_renderer_webgl_TileLayer_, _layer2.default);
        _ol_renderer_webgl_TileLayer_["handles"] = function(type, layer) {
            return type === _type2.default.WEBGL && layer.getType() === _layertype2.default.TILE;
        };
        _ol_renderer_webgl_TileLayer_["create"] = function(mapRenderer, layer) {
            return new _ol_renderer_webgl_TileLayer_(mapRenderer, layer);
        };
        _ol_renderer_webgl_TileLayer_.prototype.disposeInternal = function() {
            var context = this.mapRenderer.getContext();
            context.deleteBuffer(this.renderArrayBuffer_);
            _layer2.default.prototype.disposeInternal.call(this);
        };
        _ol_renderer_webgl_TileLayer_.prototype.createLoadedTileFinder = function(source, projection, tiles) {
            var mapRenderer = this.mapRenderer;
            return function(zoom, tileRange) {
                function callback(tile) {
                    var loaded = mapRenderer.isTileTextureLoaded(tile);
                    if (loaded) {
                        if (!tiles[zoom]) {
                            tiles[zoom] = {};
                        }
                        tiles[zoom][tile.tileCoord.toString()] = tile;
                    }
                    return loaded;
                }
                return source.forEachLoadedTile(projection, zoom, tileRange, callback);
            };
        };
        _ol_renderer_webgl_TileLayer_.prototype.handleWebGLContextLost = function() {
            _layer2.default.prototype.handleWebGLContextLost.call(this);
            this.locations_ = null;
        };
        _ol_renderer_webgl_TileLayer_.prototype.prepareFrame = function(frameState, layerState, context) {
            var mapRenderer = this.mapRenderer;
            var gl = context.getGL();
            var viewState = frameState.viewState;
            var projection = viewState.projection;
            var tileLayer = this.getLayer();
            var tileSource = tileLayer.getSource();
            var tileGrid = tileSource.getTileGridForProjection(projection);
            var z = tileGrid.getZForResolution(viewState.resolution);
            var tileResolution = tileGrid.getResolution(z);
            var tilePixelSize = tileSource.getTilePixelSize(z, frameState.pixelRatio, projection);
            var pixelRatio = tilePixelSize[0] / _size2.default.toSize(tileGrid.getTileSize(z), this.tmpSize_)[0];
            var tilePixelResolution = tileResolution / pixelRatio;
            var tileGutter = tileSource.getTilePixelRatio(pixelRatio) * tileSource.getGutter(projection);
            var center = viewState.center;
            var extent = frameState.extent;
            var tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);
            var framebufferExtent;
            if (this.renderedTileRange_ && this.renderedTileRange_.equals(tileRange) && this.renderedRevision_ == tileSource.getRevision()) {
                framebufferExtent = this.renderedFramebufferExtent_;
            } else {
                var tileRangeSize = tileRange.getSize();
                var maxDimension = Math.max(tileRangeSize[0] * tilePixelSize[0], tileRangeSize[1] * tilePixelSize[1]);
                var framebufferDimension = _math2.default.roundUpToPowerOfTwo(maxDimension);
                var framebufferExtentDimension = tilePixelResolution * framebufferDimension;
                var origin = tileGrid.getOrigin(z);
                var minX = origin[0] + tileRange.minX * tilePixelSize[0] * tilePixelResolution;
                var minY = origin[1] + tileRange.minY * tilePixelSize[1] * tilePixelResolution;
                framebufferExtent = [ minX, minY, minX + framebufferExtentDimension, minY + framebufferExtentDimension ];
                this.bindFramebuffer(frameState, framebufferDimension);
                gl.viewport(0, 0, framebufferDimension, framebufferDimension);
                gl.clearColor(0, 0, 0, 0);
                gl.clear(_webgl2.default.COLOR_BUFFER_BIT);
                gl.disable(_webgl2.default.BLEND);
                var program = context.getProgram(this.fragmentShader_, this.vertexShader_);
                context.useProgram(program);
                if (!this.locations_) {
                    this.locations_ = new _locations2.default(gl, program);
                }
                context.bindBuffer(_webgl2.default.ARRAY_BUFFER, this.renderArrayBuffer_);
                gl.enableVertexAttribArray(this.locations_.a_position);
                gl.vertexAttribPointer(this.locations_.a_position, 2, _webgl2.default.FLOAT, false, 16, 0);
                gl.enableVertexAttribArray(this.locations_.a_texCoord);
                gl.vertexAttribPointer(this.locations_.a_texCoord, 2, _webgl2.default.FLOAT, false, 16, 8);
                gl.uniform1i(this.locations_.u_texture, 0);
                var tilesToDrawByZ = {};
                tilesToDrawByZ[z] = {};
                var findLoadedTiles = this.createLoadedTileFinder(tileSource, projection, tilesToDrawByZ);
                var useInterimTilesOnError = tileLayer.getUseInterimTilesOnError();
                var allTilesLoaded = true;
                var tmpExtent = _extent2.default.createEmpty();
                var tmpTileRange = new _tilerange2.default(0, 0, 0, 0);
                var childTileRange, drawable, fullyLoaded, tile, tileState;
                var x, y, tileExtent;
                for (x = tileRange.minX; x <= tileRange.maxX; ++x) {
                    for (y = tileRange.minY; y <= tileRange.maxY; ++y) {
                        tile = tileSource.getTile(z, x, y, pixelRatio, projection);
                        if (layerState.extent !== undefined) {
                            tileExtent = tileGrid.getTileCoordExtent(tile.tileCoord, tmpExtent);
                            if (!_extent2.default.intersects(tileExtent, layerState.extent)) {
                                continue;
                            }
                        }
                        tileState = tile.getState();
                        drawable = tileState == _tilestate2.default.LOADED || tileState == _tilestate2.default.EMPTY || tileState == _tilestate2.default.ERROR && !useInterimTilesOnError;
                        if (!drawable) {
                            tile = tile.getInterimTile();
                        }
                        tileState = tile.getState();
                        if (tileState == _tilestate2.default.LOADED) {
                            if (mapRenderer.isTileTextureLoaded(tile)) {
                                tilesToDrawByZ[z][tile.tileCoord.toString()] = tile;
                                continue;
                            }
                        } else if (tileState == _tilestate2.default.EMPTY || tileState == _tilestate2.default.ERROR && !useInterimTilesOnError) {
                            continue;
                        }
                        allTilesLoaded = false;
                        fullyLoaded = tileGrid.forEachTileCoordParentTileRange(tile.tileCoord, findLoadedTiles, null, tmpTileRange, tmpExtent);
                        if (!fullyLoaded) {
                            childTileRange = tileGrid.getTileCoordChildTileRange(tile.tileCoord, tmpTileRange, tmpExtent);
                            if (childTileRange) {
                                findLoadedTiles(z + 1, childTileRange);
                            }
                        }
                    }
                }
                var zs = Object.keys(tilesToDrawByZ).map(Number);
                zs.sort(_array2.default.numberSafeCompareFunction);
                var u_tileOffset = new Float32Array(4);
                var i, ii, tileKey, tilesToDraw;
                for (i = 0, ii = zs.length; i < ii; ++i) {
                    tilesToDraw = tilesToDrawByZ[zs[i]];
                    for (tileKey in tilesToDraw) {
                        tile = tilesToDraw[tileKey];
                        tileExtent = tileGrid.getTileCoordExtent(tile.tileCoord, tmpExtent);
                        u_tileOffset[0] = 2 * (tileExtent[2] - tileExtent[0]) / framebufferExtentDimension;
                        u_tileOffset[1] = 2 * (tileExtent[3] - tileExtent[1]) / framebufferExtentDimension;
                        u_tileOffset[2] = 2 * (tileExtent[0] - framebufferExtent[0]) / framebufferExtentDimension - 1;
                        u_tileOffset[3] = 2 * (tileExtent[1] - framebufferExtent[1]) / framebufferExtentDimension - 1;
                        gl.uniform4fv(this.locations_.u_tileOffset, u_tileOffset);
                        mapRenderer.bindTileTexture(tile, tilePixelSize, tileGutter * pixelRatio, _webgl2.default.LINEAR, _webgl2.default.LINEAR);
                        gl.drawArrays(_webgl2.default.TRIANGLE_STRIP, 0, 4);
                    }
                }
                if (allTilesLoaded) {
                    this.renderedTileRange_ = tileRange;
                    this.renderedFramebufferExtent_ = framebufferExtent;
                    this.renderedRevision_ = tileSource.getRevision();
                } else {
                    this.renderedTileRange_ = null;
                    this.renderedFramebufferExtent_ = null;
                    this.renderedRevision_ = -1;
                    frameState.animate = true;
                }
            }
            this.updateUsedTiles(frameState.usedTiles, tileSource, z, tileRange);
            var tileTextureQueue = mapRenderer.getTileTextureQueue();
            this.manageTilePyramid(frameState, tileSource, tileGrid, pixelRatio, projection, extent, z, tileLayer.getPreload(), function(tile) {
                if (tile.getState() == _tilestate2.default.LOADED && !mapRenderer.isTileTextureLoaded(tile) && !tileTextureQueue.isKeyQueued(tile.getKey())) {
                    tileTextureQueue.enqueue([ tile, tileGrid.getTileCoordCenter(tile.tileCoord), tileGrid.getResolution(tile.tileCoord[0]), tilePixelSize, tileGutter * pixelRatio ]);
                }
            }, this);
            this.scheduleExpireCache(frameState, tileSource);
            this.updateLogos(frameState, tileSource);
            var texCoordMatrix = this.texCoordMatrix;
            _transform2.default.reset(texCoordMatrix);
            _transform2.default.translate(texCoordMatrix, (Math.round(center[0] / tileResolution) * tileResolution - framebufferExtent[0]) / (framebufferExtent[2] - framebufferExtent[0]), (Math.round(center[1] / tileResolution) * tileResolution - framebufferExtent[1]) / (framebufferExtent[3] - framebufferExtent[1]));
            if (viewState.rotation !== 0) {
                _transform2.default.rotate(texCoordMatrix, viewState.rotation);
            }
            _transform2.default.scale(texCoordMatrix, frameState.size[0] * viewState.resolution / (framebufferExtent[2] - framebufferExtent[0]), frameState.size[1] * viewState.resolution / (framebufferExtent[3] - framebufferExtent[1]));
            _transform2.default.translate(texCoordMatrix, -.5, -.5);
            return true;
        };
        _ol_renderer_webgl_TileLayer_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg) {
            if (!this.framebuffer) {
                return undefined;
            }
            var pixelOnMapScaled = [ pixel[0] / frameState.size[0], (frameState.size[1] - pixel[1]) / frameState.size[1] ];
            var pixelOnFrameBufferScaled = _transform2.default.apply(this.texCoordMatrix, pixelOnMapScaled.slice());
            var pixelOnFrameBuffer = [ pixelOnFrameBufferScaled[0] * this.framebufferDimension, pixelOnFrameBufferScaled[1] * this.framebufferDimension ];
            var gl = this.mapRenderer.getContext().getGL();
            gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);
            var imageData = new Uint8Array(4);
            gl.readPixels(pixelOnFrameBuffer[0], pixelOnFrameBuffer[1], 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, imageData);
            if (imageData[3] > 0) {
                return callback.call(thisArg, this.getLayer(), imageData);
            } else {
                return undefined;
            }
        };
        exports.default = _ol_renderer_webgl_TileLayer_;
    }, {
        "../../array.js": 29,
        "../../extent.js": 54,
        "../../index.js": 89,
        "../../layertype.js": 113,
        "../../math.js": 123,
        "../../size.js": 208,
        "../../tilerange.js": 241,
        "../../tilestate.js": 242,
        "../../transform.js": 243,
        "../../webgl.js": 248,
        "../../webgl/buffer.js": 249,
        "../type.js": 192,
        "../webgl/layer.js": 197,
        "../webgl/tilelayershader.js": 200,
        "../webgl/tilelayershader/locations.js": 201
    } ],
    200: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _fragment = require("../../webgl/fragment.js");
        var _fragment2 = _interopRequireDefault(_fragment);
        var _vertex = require("../../webgl/vertex.js");
        var _vertex2 = _interopRequireDefault(_vertex);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_webgl_tilelayershader_ = {};
        _ol_renderer_webgl_tilelayershader_.fragment = new _fragment2.default(_index2.default.DEBUG_WEBGL ? "precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n" : "precision mediump float;varying vec2 a;uniform sampler2D e;void main(void){gl_FragColor=texture2D(e,a);}");
        _ol_renderer_webgl_tilelayershader_.vertex = new _vertex2.default(_index2.default.DEBUG_WEBGL ? "varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 u_tileOffset;\n\nvoid main(void) {\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\n  v_texCoord = a_texCoord;\n}\n\n\n" : "varying vec2 a;attribute vec2 b;attribute vec2 c;uniform vec4 d;void main(void){gl_Position=vec4(b*d.xy+d.zw,0.,1.);a=c;}");
        exports.default = _ol_renderer_webgl_tilelayershader_;
    }, {
        "../../index.js": 89,
        "../../webgl/fragment.js": 252,
        "../../webgl/vertex.js": 254
    } ],
    201: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../../index.js");
        var _index2 = _interopRequireDefault(_index);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_webgl_tilelayershader_Locations_ = function(gl, program) {
            this.u_tileOffset = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_tileOffset" : "d");
            this.u_texture = gl.getUniformLocation(program, _index2.default.DEBUG_WEBGL ? "u_texture" : "e");
            this.a_position = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_position" : "b");
            this.a_texCoord = gl.getAttribLocation(program, _index2.default.DEBUG_WEBGL ? "a_texCoord" : "c");
        };
        exports.default = _ol_renderer_webgl_tilelayershader_Locations_;
    }, {
        "../../../index.js": 89
    } ],
    202: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _layertype = require("../../layertype.js");
        var _layertype2 = _interopRequireDefault(_layertype);
        var _viewhint = require("../../viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _extent = require("../../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _replaygroup = require("../../render/webgl/replaygroup.js");
        var _replaygroup2 = _interopRequireDefault(_replaygroup);
        var _type = require("../type.js");
        var _type2 = _interopRequireDefault(_type);
        var _vector = require("../vector.js");
        var _vector2 = _interopRequireDefault(_vector);
        var _layer = require("../webgl/layer.js");
        var _layer2 = _interopRequireDefault(_layer);
        var _transform = require("../../transform.js");
        var _transform2 = _interopRequireDefault(_transform);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_renderer_webgl_VectorLayer_ = function(mapRenderer, vectorLayer) {
            _layer2.default.call(this, mapRenderer, vectorLayer);
            this.dirty_ = false;
            this.renderedRevision_ = -1;
            this.renderedResolution_ = NaN;
            this.renderedExtent_ = _extent2.default.createEmpty();
            this.renderedRenderOrder_ = null;
            this.replayGroup_ = null;
            this.layerState_ = null;
        };
        _index2.default.inherits(_ol_renderer_webgl_VectorLayer_, _layer2.default);
        _ol_renderer_webgl_VectorLayer_["handles"] = function(type, layer) {
            return type === _type2.default.WEBGL && layer.getType() === _layertype2.default.VECTOR;
        };
        _ol_renderer_webgl_VectorLayer_["create"] = function(mapRenderer, layer) {
            return new _ol_renderer_webgl_VectorLayer_(mapRenderer, layer);
        };
        _ol_renderer_webgl_VectorLayer_.prototype.composeFrame = function(frameState, layerState, context) {
            this.layerState_ = layerState;
            var viewState = frameState.viewState;
            var replayGroup = this.replayGroup_;
            var size = frameState.size;
            var pixelRatio = frameState.pixelRatio;
            var gl = this.mapRenderer.getGL();
            if (replayGroup && !replayGroup.isEmpty()) {
                gl.enable(gl.SCISSOR_TEST);
                gl.scissor(0, 0, size[0] * pixelRatio, size[1] * pixelRatio);
                replayGroup.replay(context, viewState.center, viewState.resolution, viewState.rotation, size, pixelRatio, layerState.opacity, layerState.managed ? frameState.skippedFeatureUids : {});
                gl.disable(gl.SCISSOR_TEST);
            }
        };
        _ol_renderer_webgl_VectorLayer_.prototype.disposeInternal = function() {
            var replayGroup = this.replayGroup_;
            if (replayGroup) {
                var context = this.mapRenderer.getContext();
                replayGroup.getDeleteResourcesFunction(context)();
                this.replayGroup_ = null;
            }
            _layer2.default.prototype.disposeInternal.call(this);
        };
        _ol_renderer_webgl_VectorLayer_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {
            if (!this.replayGroup_ || !this.layerState_) {
                return undefined;
            } else {
                var context = this.mapRenderer.getContext();
                var viewState = frameState.viewState;
                var layer = this.getLayer();
                var layerState = this.layerState_;
                var features = {};
                return this.replayGroup_.forEachFeatureAtCoordinate(coordinate, context, viewState.center, viewState.resolution, viewState.rotation, frameState.size, frameState.pixelRatio, layerState.opacity, {}, function(feature) {
                    var key = _index2.default.getUid(feature).toString();
                    if (!(key in features)) {
                        features[key] = true;
                        return callback.call(thisArg, feature, layer);
                    }
                });
            }
        };
        _ol_renderer_webgl_VectorLayer_.prototype.hasFeatureAtCoordinate = function(coordinate, frameState) {
            if (!this.replayGroup_ || !this.layerState_) {
                return false;
            } else {
                var context = this.mapRenderer.getContext();
                var viewState = frameState.viewState;
                var layerState = this.layerState_;
                return this.replayGroup_.hasFeatureAtCoordinate(coordinate, context, viewState.center, viewState.resolution, viewState.rotation, frameState.size, frameState.pixelRatio, layerState.opacity, frameState.skippedFeatureUids);
            }
        };
        _ol_renderer_webgl_VectorLayer_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg) {
            var coordinate = _transform2.default.apply(frameState.pixelToCoordinateTransform, pixel.slice());
            var hasFeature = this.hasFeatureAtCoordinate(coordinate, frameState);
            if (hasFeature) {
                return callback.call(thisArg, this.getLayer(), null);
            } else {
                return undefined;
            }
        };
        _ol_renderer_webgl_VectorLayer_.prototype.handleStyleImageChange_ = function(event) {
            this.renderIfReadyAndVisible();
        };
        _ol_renderer_webgl_VectorLayer_.prototype.prepareFrame = function(frameState, layerState, context) {
            var vectorLayer = this.getLayer();
            var vectorSource = vectorLayer.getSource();
            this.updateLogos(frameState, vectorSource);
            var animating = frameState.viewHints[_viewhint2.default.ANIMATING];
            var interacting = frameState.viewHints[_viewhint2.default.INTERACTING];
            var updateWhileAnimating = vectorLayer.getUpdateWhileAnimating();
            var updateWhileInteracting = vectorLayer.getUpdateWhileInteracting();
            if (!this.dirty_ && !updateWhileAnimating && animating || !updateWhileInteracting && interacting) {
                return true;
            }
            var frameStateExtent = frameState.extent;
            var viewState = frameState.viewState;
            var projection = viewState.projection;
            var resolution = viewState.resolution;
            var pixelRatio = frameState.pixelRatio;
            var vectorLayerRevision = vectorLayer.getRevision();
            var vectorLayerRenderBuffer = vectorLayer.getRenderBuffer();
            var vectorLayerRenderOrder = vectorLayer.getRenderOrder();
            if (vectorLayerRenderOrder === undefined) {
                vectorLayerRenderOrder = _vector2.default.defaultOrder;
            }
            var extent = _extent2.default.buffer(frameStateExtent, vectorLayerRenderBuffer * resolution);
            if (!this.dirty_ && this.renderedResolution_ == resolution && this.renderedRevision_ == vectorLayerRevision && this.renderedRenderOrder_ == vectorLayerRenderOrder && _extent2.default.containsExtent(this.renderedExtent_, extent)) {
                return true;
            }
            if (this.replayGroup_) {
                frameState.postRenderFunctions.push(this.replayGroup_.getDeleteResourcesFunction(context));
            }
            this.dirty_ = false;
            var replayGroup = new _replaygroup2.default(_vector2.default.getTolerance(resolution, pixelRatio), extent, vectorLayer.getRenderBuffer());
            vectorSource.loadFeatures(extent, resolution, projection);
            var renderFeature = function(feature) {
                var styles;
                var styleFunction = feature.getStyleFunction();
                if (styleFunction) {
                    styles = styleFunction.call(feature, resolution);
                } else {
                    styleFunction = vectorLayer.getStyleFunction();
                    if (styleFunction) {
                        styles = styleFunction(feature, resolution);
                    }
                }
                if (styles) {
                    var dirty = this.renderFeature(feature, resolution, pixelRatio, styles, replayGroup);
                    this.dirty_ = this.dirty_ || dirty;
                }
            };
            if (vectorLayerRenderOrder) {
                var features = [];
                vectorSource.forEachFeatureInExtent(extent, function(feature) {
                    features.push(feature);
                }, this);
                features.sort(vectorLayerRenderOrder);
                features.forEach(renderFeature, this);
            } else {
                vectorSource.forEachFeatureInExtent(extent, renderFeature, this);
            }
            replayGroup.finish(context);
            this.renderedResolution_ = resolution;
            this.renderedRevision_ = vectorLayerRevision;
            this.renderedRenderOrder_ = vectorLayerRenderOrder;
            this.renderedExtent_ = extent;
            this.replayGroup_ = replayGroup;
            return true;
        };
        _ol_renderer_webgl_VectorLayer_.prototype.renderFeature = function(feature, resolution, pixelRatio, styles, replayGroup) {
            if (!styles) {
                return false;
            }
            var loading = false;
            if (Array.isArray(styles)) {
                for (var i = styles.length - 1, ii = 0; i >= ii; --i) {
                    loading = _vector2.default.renderFeature(replayGroup, feature, styles[i], _vector2.default.getSquaredTolerance(resolution, pixelRatio), this.handleStyleImageChange_, this) || loading;
                }
            } else {
                loading = _vector2.default.renderFeature(replayGroup, feature, styles, _vector2.default.getSquaredTolerance(resolution, pixelRatio), this.handleStyleImageChange_, this) || loading;
            }
            return loading;
        };
        exports.default = _ol_renderer_webgl_VectorLayer_;
    }, {
        "../../extent.js": 54,
        "../../index.js": 89,
        "../../layertype.js": 113,
        "../../render/webgl/replaygroup.js": 178,
        "../../transform.js": 243,
        "../../viewhint.js": 246,
        "../type.js": 192,
        "../vector.js": 193,
        "../webgl/layer.js": 197
    } ],
    203: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _dom = require("./dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _extent = require("./extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _math = require("./math.js");
        var _math2 = _interopRequireDefault(_math);
        var _proj = require("./proj.js");
        var _proj2 = _interopRequireDefault(_proj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_reproj_ = {};
        _ol_reproj_.calculateSourceResolution = function(sourceProj, targetProj, targetCenter, targetResolution) {
            var sourceCenter = _proj2.default.transform(targetCenter, targetProj, sourceProj);
            var sourceResolution = _proj2.default.getPointResolution(targetProj, targetResolution, targetCenter);
            var targetMetersPerUnit = targetProj.getMetersPerUnit();
            if (targetMetersPerUnit !== undefined) {
                sourceResolution *= targetMetersPerUnit;
            }
            var sourceMetersPerUnit = sourceProj.getMetersPerUnit();
            if (sourceMetersPerUnit !== undefined) {
                sourceResolution /= sourceMetersPerUnit;
            }
            var sourceExtent = sourceProj.getExtent();
            if (!sourceExtent || _extent2.default.containsCoordinate(sourceExtent, sourceCenter)) {
                var compensationFactor = _proj2.default.getPointResolution(sourceProj, sourceResolution, sourceCenter) / sourceResolution;
                if (isFinite(compensationFactor) && compensationFactor > 0) {
                    sourceResolution /= compensationFactor;
                }
            }
            return sourceResolution;
        };
        _ol_reproj_.enlargeClipPoint_ = function(centroidX, centroidY, x, y) {
            var dX = x - centroidX, dY = y - centroidY;
            var distance = Math.sqrt(dX * dX + dY * dY);
            return [ Math.round(x + dX / distance), Math.round(y + dY / distance) ];
        };
        _ol_reproj_.render = function(width, height, pixelRatio, sourceResolution, sourceExtent, targetResolution, targetExtent, triangulation, sources, gutter, opt_renderEdges) {
            var context = _dom2.default.createCanvasContext2D(Math.round(pixelRatio * width), Math.round(pixelRatio * height));
            if (sources.length === 0) {
                return context.canvas;
            }
            context.scale(pixelRatio, pixelRatio);
            var sourceDataExtent = _extent2.default.createEmpty();
            sources.forEach(function(src, i, arr) {
                _extent2.default.extend(sourceDataExtent, src.extent);
            });
            var canvasWidthInUnits = _extent2.default.getWidth(sourceDataExtent);
            var canvasHeightInUnits = _extent2.default.getHeight(sourceDataExtent);
            var stitchContext = _dom2.default.createCanvasContext2D(Math.round(pixelRatio * canvasWidthInUnits / sourceResolution), Math.round(pixelRatio * canvasHeightInUnits / sourceResolution));
            var stitchScale = pixelRatio / sourceResolution;
            sources.forEach(function(src, i, arr) {
                var xPos = src.extent[0] - sourceDataExtent[0];
                var yPos = -(src.extent[3] - sourceDataExtent[3]);
                var srcWidth = _extent2.default.getWidth(src.extent);
                var srcHeight = _extent2.default.getHeight(src.extent);
                stitchContext.drawImage(src.image, gutter, gutter, src.image.width - 2 * gutter, src.image.height - 2 * gutter, xPos * stitchScale, yPos * stitchScale, srcWidth * stitchScale, srcHeight * stitchScale);
            });
            var targetTopLeft = _extent2.default.getTopLeft(targetExtent);
            triangulation.getTriangles().forEach(function(triangle, i, arr) {
                var source = triangle.source, target = triangle.target;
                var x0 = source[0][0], y0 = source[0][1], x1 = source[1][0], y1 = source[1][1], x2 = source[2][0], y2 = source[2][1];
                var u0 = (target[0][0] - targetTopLeft[0]) / targetResolution, v0 = -(target[0][1] - targetTopLeft[1]) / targetResolution;
                var u1 = (target[1][0] - targetTopLeft[0]) / targetResolution, v1 = -(target[1][1] - targetTopLeft[1]) / targetResolution;
                var u2 = (target[2][0] - targetTopLeft[0]) / targetResolution, v2 = -(target[2][1] - targetTopLeft[1]) / targetResolution;
                var sourceNumericalShiftX = x0, sourceNumericalShiftY = y0;
                x0 = 0;
                y0 = 0;
                x1 -= sourceNumericalShiftX;
                y1 -= sourceNumericalShiftY;
                x2 -= sourceNumericalShiftX;
                y2 -= sourceNumericalShiftY;
                var augmentedMatrix = [ [ x1, y1, 0, 0, u1 - u0 ], [ x2, y2, 0, 0, u2 - u0 ], [ 0, 0, x1, y1, v1 - v0 ], [ 0, 0, x2, y2, v2 - v0 ] ];
                var affineCoefs = _math2.default.solveLinearSystem(augmentedMatrix);
                if (!affineCoefs) {
                    return;
                }
                context.save();
                context.beginPath();
                var centroidX = (u0 + u1 + u2) / 3, centroidY = (v0 + v1 + v2) / 3;
                var p0 = _ol_reproj_.enlargeClipPoint_(centroidX, centroidY, u0, v0);
                var p1 = _ol_reproj_.enlargeClipPoint_(centroidX, centroidY, u1, v1);
                var p2 = _ol_reproj_.enlargeClipPoint_(centroidX, centroidY, u2, v2);
                context.moveTo(p1[0], p1[1]);
                context.lineTo(p0[0], p0[1]);
                context.lineTo(p2[0], p2[1]);
                context.clip();
                context.transform(affineCoefs[0], affineCoefs[2], affineCoefs[1], affineCoefs[3], u0, v0);
                context.translate(sourceDataExtent[0] - sourceNumericalShiftX, sourceDataExtent[3] - sourceNumericalShiftY);
                context.scale(sourceResolution / pixelRatio, -sourceResolution / pixelRatio);
                context.drawImage(stitchContext.canvas, 0, 0);
                context.restore();
            });
            if (opt_renderEdges) {
                context.save();
                context.strokeStyle = "black";
                context.lineWidth = 1;
                triangulation.getTriangles().forEach(function(triangle, i, arr) {
                    var target = triangle.target;
                    var u0 = (target[0][0] - targetTopLeft[0]) / targetResolution, v0 = -(target[0][1] - targetTopLeft[1]) / targetResolution;
                    var u1 = (target[1][0] - targetTopLeft[0]) / targetResolution, v1 = -(target[1][1] - targetTopLeft[1]) / targetResolution;
                    var u2 = (target[2][0] - targetTopLeft[0]) / targetResolution, v2 = -(target[2][1] - targetTopLeft[1]) / targetResolution;
                    context.beginPath();
                    context.moveTo(u1, v1);
                    context.lineTo(u0, v0);
                    context.lineTo(u2, v2);
                    context.closePath();
                    context.stroke();
                });
                context.restore();
            }
            return context.canvas;
        };
        exports.default = _ol_reproj_;
    }, {
        "./dom.js": 46,
        "./extent.js": 54,
        "./math.js": 123,
        "./proj.js": 141
    } ],
    204: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _imagebase = require("../imagebase.js");
        var _imagebase2 = _interopRequireDefault(_imagebase);
        var _imagestate = require("../imagestate.js");
        var _imagestate2 = _interopRequireDefault(_imagestate);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _reproj = require("../reproj.js");
        var _reproj2 = _interopRequireDefault(_reproj);
        var _triangulation = require("../reproj/triangulation.js");
        var _triangulation2 = _interopRequireDefault(_triangulation);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_reproj_Image_ = function(sourceProj, targetProj, targetExtent, targetResolution, pixelRatio, getImageFunction) {
            this.targetProj_ = targetProj;
            this.maxSourceExtent_ = sourceProj.getExtent();
            var maxTargetExtent = targetProj.getExtent();
            var limitedTargetExtent = maxTargetExtent ? _extent2.default.getIntersection(targetExtent, maxTargetExtent) : targetExtent;
            var targetCenter = _extent2.default.getCenter(limitedTargetExtent);
            var sourceResolution = _reproj2.default.calculateSourceResolution(sourceProj, targetProj, targetCenter, targetResolution);
            var errorThresholdInPixels = _index2.default.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD;
            this.triangulation_ = new _triangulation2.default(sourceProj, targetProj, limitedTargetExtent, this.maxSourceExtent_, sourceResolution * errorThresholdInPixels);
            this.targetResolution_ = targetResolution;
            this.targetExtent_ = targetExtent;
            var sourceExtent = this.triangulation_.calculateSourceExtent();
            this.sourceImage_ = getImageFunction(sourceExtent, sourceResolution, pixelRatio);
            this.sourcePixelRatio_ = this.sourceImage_ ? this.sourceImage_.getPixelRatio() : 1;
            this.canvas_ = null;
            this.sourceListenerKey_ = null;
            var state = _imagestate2.default.LOADED;
            if (this.sourceImage_) {
                state = _imagestate2.default.IDLE;
            }
            _imagebase2.default.call(this, targetExtent, targetResolution, this.sourcePixelRatio_, state);
        };
        _index2.default.inherits(_ol_reproj_Image_, _imagebase2.default);
        _ol_reproj_Image_.prototype.disposeInternal = function() {
            if (this.state == _imagestate2.default.LOADING) {
                this.unlistenSource_();
            }
            _imagebase2.default.prototype.disposeInternal.call(this);
        };
        _ol_reproj_Image_.prototype.getImage = function() {
            return this.canvas_;
        };
        _ol_reproj_Image_.prototype.getProjection = function() {
            return this.targetProj_;
        };
        _ol_reproj_Image_.prototype.reproject_ = function() {
            var sourceState = this.sourceImage_.getState();
            if (sourceState == _imagestate2.default.LOADED) {
                var width = _extent2.default.getWidth(this.targetExtent_) / this.targetResolution_;
                var height = _extent2.default.getHeight(this.targetExtent_) / this.targetResolution_;
                this.canvas_ = _reproj2.default.render(width, height, this.sourcePixelRatio_, this.sourceImage_.getResolution(), this.maxSourceExtent_, this.targetResolution_, this.targetExtent_, this.triangulation_, [ {
                    extent: this.sourceImage_.getExtent(),
                    image: this.sourceImage_.getImage()
                } ], 0);
            }
            this.state = sourceState;
            this.changed();
        };
        _ol_reproj_Image_.prototype.load = function() {
            if (this.state == _imagestate2.default.IDLE) {
                this.state = _imagestate2.default.LOADING;
                this.changed();
                var sourceState = this.sourceImage_.getState();
                if (sourceState == _imagestate2.default.LOADED || sourceState == _imagestate2.default.ERROR) {
                    this.reproject_();
                } else {
                    this.sourceListenerKey_ = _events2.default.listen(this.sourceImage_, _eventtype2.default.CHANGE, function(e) {
                        var sourceState = this.sourceImage_.getState();
                        if (sourceState == _imagestate2.default.LOADED || sourceState == _imagestate2.default.ERROR) {
                            this.unlistenSource_();
                            this.reproject_();
                        }
                    }, this);
                    this.sourceImage_.load();
                }
            }
        };
        _ol_reproj_Image_.prototype.unlistenSource_ = function() {
            _events2.default.unlistenByKey(this.sourceListenerKey_);
            this.sourceListenerKey_ = null;
        };
        exports.default = _ol_reproj_Image_;
    }, {
        "../events.js": 48,
        "../events/eventtype.js": 52,
        "../extent.js": 54,
        "../imagebase.js": 86,
        "../imagestate.js": 88,
        "../index.js": 89,
        "../reproj.js": 203,
        "../reproj/triangulation.js": 205
    } ],
    205: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _math = require("../math.js");
        var _math2 = _interopRequireDefault(_math);
        var _proj = require("../proj.js");
        var _proj2 = _interopRequireDefault(_proj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_reproj_Triangulation_ = function(sourceProj, targetProj, targetExtent, maxSourceExtent, errorThreshold) {
            this.sourceProj_ = sourceProj;
            this.targetProj_ = targetProj;
            var transformInvCache = {};
            var transformInv = _proj2.default.getTransform(this.targetProj_, this.sourceProj_);
            this.transformInv_ = function(c) {
                var key = c[0] + "/" + c[1];
                if (!transformInvCache[key]) {
                    transformInvCache[key] = transformInv(c);
                }
                return transformInvCache[key];
            };
            this.maxSourceExtent_ = maxSourceExtent;
            this.errorThresholdSquared_ = errorThreshold * errorThreshold;
            this.triangles_ = [];
            this.wrapsXInSource_ = false;
            this.canWrapXInSource_ = this.sourceProj_.canWrapX() && !!maxSourceExtent && !!this.sourceProj_.getExtent() && _extent2.default.getWidth(maxSourceExtent) == _extent2.default.getWidth(this.sourceProj_.getExtent());
            this.sourceWorldWidth_ = this.sourceProj_.getExtent() ? _extent2.default.getWidth(this.sourceProj_.getExtent()) : null;
            this.targetWorldWidth_ = this.targetProj_.getExtent() ? _extent2.default.getWidth(this.targetProj_.getExtent()) : null;
            var destinationTopLeft = _extent2.default.getTopLeft(targetExtent);
            var destinationTopRight = _extent2.default.getTopRight(targetExtent);
            var destinationBottomRight = _extent2.default.getBottomRight(targetExtent);
            var destinationBottomLeft = _extent2.default.getBottomLeft(targetExtent);
            var sourceTopLeft = this.transformInv_(destinationTopLeft);
            var sourceTopRight = this.transformInv_(destinationTopRight);
            var sourceBottomRight = this.transformInv_(destinationBottomRight);
            var sourceBottomLeft = this.transformInv_(destinationBottomLeft);
            this.addQuad_(destinationTopLeft, destinationTopRight, destinationBottomRight, destinationBottomLeft, sourceTopLeft, sourceTopRight, sourceBottomRight, sourceBottomLeft, _index2.default.RASTER_REPROJECTION_MAX_SUBDIVISION);
            if (this.wrapsXInSource_) {
                var leftBound = Infinity;
                this.triangles_.forEach(function(triangle, i, arr) {
                    leftBound = Math.min(leftBound, triangle.source[0][0], triangle.source[1][0], triangle.source[2][0]);
                });
                this.triangles_.forEach(function(triangle) {
                    if (Math.max(triangle.source[0][0], triangle.source[1][0], triangle.source[2][0]) - leftBound > this.sourceWorldWidth_ / 2) {
                        var newTriangle = [ [ triangle.source[0][0], triangle.source[0][1] ], [ triangle.source[1][0], triangle.source[1][1] ], [ triangle.source[2][0], triangle.source[2][1] ] ];
                        if (newTriangle[0][0] - leftBound > this.sourceWorldWidth_ / 2) {
                            newTriangle[0][0] -= this.sourceWorldWidth_;
                        }
                        if (newTriangle[1][0] - leftBound > this.sourceWorldWidth_ / 2) {
                            newTriangle[1][0] -= this.sourceWorldWidth_;
                        }
                        if (newTriangle[2][0] - leftBound > this.sourceWorldWidth_ / 2) {
                            newTriangle[2][0] -= this.sourceWorldWidth_;
                        }
                        var minX = Math.min(newTriangle[0][0], newTriangle[1][0], newTriangle[2][0]);
                        var maxX = Math.max(newTriangle[0][0], newTriangle[1][0], newTriangle[2][0]);
                        if (maxX - minX < this.sourceWorldWidth_ / 2) {
                            triangle.source = newTriangle;
                        }
                    }
                }, this);
            }
            transformInvCache = {};
        };
        _ol_reproj_Triangulation_.prototype.addTriangle_ = function(a, b, c, aSrc, bSrc, cSrc) {
            this.triangles_.push({
                source: [ aSrc, bSrc, cSrc ],
                target: [ a, b, c ]
            });
        };
        _ol_reproj_Triangulation_.prototype.addQuad_ = function(a, b, c, d, aSrc, bSrc, cSrc, dSrc, maxSubdivision) {
            var sourceQuadExtent = _extent2.default.boundingExtent([ aSrc, bSrc, cSrc, dSrc ]);
            var sourceCoverageX = this.sourceWorldWidth_ ? _extent2.default.getWidth(sourceQuadExtent) / this.sourceWorldWidth_ : null;
            var sourceWorldWidth = this.sourceWorldWidth_;
            var wrapsX = this.sourceProj_.canWrapX() && sourceCoverageX > .5 && sourceCoverageX < 1;
            var needsSubdivision = false;
            if (maxSubdivision > 0) {
                if (this.targetProj_.isGlobal() && this.targetWorldWidth_) {
                    var targetQuadExtent = _extent2.default.boundingExtent([ a, b, c, d ]);
                    var targetCoverageX = _extent2.default.getWidth(targetQuadExtent) / this.targetWorldWidth_;
                    needsSubdivision |= targetCoverageX > _index2.default.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH;
                }
                if (!wrapsX && this.sourceProj_.isGlobal() && sourceCoverageX) {
                    needsSubdivision |= sourceCoverageX > _index2.default.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH;
                }
            }
            if (!needsSubdivision && this.maxSourceExtent_) {
                if (!_extent2.default.intersects(sourceQuadExtent, this.maxSourceExtent_)) {
                    return;
                }
            }
            if (!needsSubdivision) {
                if (!isFinite(aSrc[0]) || !isFinite(aSrc[1]) || !isFinite(bSrc[0]) || !isFinite(bSrc[1]) || !isFinite(cSrc[0]) || !isFinite(cSrc[1]) || !isFinite(dSrc[0]) || !isFinite(dSrc[1])) {
                    if (maxSubdivision > 0) {
                        needsSubdivision = true;
                    } else {
                        return;
                    }
                }
            }
            if (maxSubdivision > 0) {
                if (!needsSubdivision) {
                    var center = [ (a[0] + c[0]) / 2, (a[1] + c[1]) / 2 ];
                    var centerSrc = this.transformInv_(center);
                    var dx;
                    if (wrapsX) {
                        var centerSrcEstimX = (_math2.default.modulo(aSrc[0], sourceWorldWidth) + _math2.default.modulo(cSrc[0], sourceWorldWidth)) / 2;
                        dx = centerSrcEstimX - _math2.default.modulo(centerSrc[0], sourceWorldWidth);
                    } else {
                        dx = (aSrc[0] + cSrc[0]) / 2 - centerSrc[0];
                    }
                    var dy = (aSrc[1] + cSrc[1]) / 2 - centerSrc[1];
                    var centerSrcErrorSquared = dx * dx + dy * dy;
                    needsSubdivision = centerSrcErrorSquared > this.errorThresholdSquared_;
                }
                if (needsSubdivision) {
                    if (Math.abs(a[0] - c[0]) <= Math.abs(a[1] - c[1])) {
                        var bc = [ (b[0] + c[0]) / 2, (b[1] + c[1]) / 2 ];
                        var bcSrc = this.transformInv_(bc);
                        var da = [ (d[0] + a[0]) / 2, (d[1] + a[1]) / 2 ];
                        var daSrc = this.transformInv_(da);
                        this.addQuad_(a, b, bc, da, aSrc, bSrc, bcSrc, daSrc, maxSubdivision - 1);
                        this.addQuad_(da, bc, c, d, daSrc, bcSrc, cSrc, dSrc, maxSubdivision - 1);
                    } else {
                        var ab = [ (a[0] + b[0]) / 2, (a[1] + b[1]) / 2 ];
                        var abSrc = this.transformInv_(ab);
                        var cd = [ (c[0] + d[0]) / 2, (c[1] + d[1]) / 2 ];
                        var cdSrc = this.transformInv_(cd);
                        this.addQuad_(a, ab, cd, d, aSrc, abSrc, cdSrc, dSrc, maxSubdivision - 1);
                        this.addQuad_(ab, b, c, cd, abSrc, bSrc, cSrc, cdSrc, maxSubdivision - 1);
                    }
                    return;
                }
            }
            if (wrapsX) {
                if (!this.canWrapXInSource_) {
                    return;
                }
                this.wrapsXInSource_ = true;
            }
            this.addTriangle_(a, c, d, aSrc, cSrc, dSrc);
            this.addTriangle_(a, b, c, aSrc, bSrc, cSrc);
        };
        _ol_reproj_Triangulation_.prototype.calculateSourceExtent = function() {
            var extent = _extent2.default.createEmpty();
            this.triangles_.forEach(function(triangle, i, arr) {
                var src = triangle.source;
                _extent2.default.extendCoordinate(extent, src[0]);
                _extent2.default.extendCoordinate(extent, src[1]);
                _extent2.default.extendCoordinate(extent, src[2]);
            });
            return extent;
        };
        _ol_reproj_Triangulation_.prototype.getTriangles = function() {
            return this.triangles_;
        };
        exports.default = _ol_reproj_Triangulation_;
    }, {
        "../extent.js": 54,
        "../index.js": 89,
        "../math.js": 123,
        "../proj.js": 141
    } ],
    206: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _array = require("./array.js");
        var _array2 = _interopRequireDefault(_array);
        var _math = require("./math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_ResolutionConstraint_ = {};
        _ol_ResolutionConstraint_.createSnapToResolutions = function(resolutions) {
            return function(resolution, delta, direction) {
                if (resolution !== undefined) {
                    var z = _array2.default.linearFindNearest(resolutions, resolution, direction);
                    z = _math2.default.clamp(z + delta, 0, resolutions.length - 1);
                    var index = Math.floor(z);
                    if (z != index && index < resolutions.length - 1) {
                        var power = resolutions[index] / resolutions[index + 1];
                        return resolutions[index] / Math.pow(power, z - index);
                    } else {
                        return resolutions[index];
                    }
                } else {
                    return undefined;
                }
            };
        };
        _ol_ResolutionConstraint_.createSnapToPower = function(power, maxResolution, opt_maxLevel) {
            return function(resolution, delta, direction) {
                if (resolution !== undefined) {
                    var offset = -direction / 2 + .5;
                    var oldLevel = Math.floor(Math.log(maxResolution / resolution) / Math.log(power) + offset);
                    var newLevel = Math.max(oldLevel + delta, 0);
                    if (opt_maxLevel !== undefined) {
                        newLevel = Math.min(newLevel, opt_maxLevel);
                    }
                    return maxResolution / Math.pow(power, newLevel);
                } else {
                    return undefined;
                }
            };
        };
        exports.default = _ol_ResolutionConstraint_;
    }, {
        "./array.js": 29,
        "./math.js": 123
    } ],
    207: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _math = require("./math.js");
        var _math2 = _interopRequireDefault(_math);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_RotationConstraint_ = {};
        _ol_RotationConstraint_.disable = function(rotation, delta) {
            if (rotation !== undefined) {
                return 0;
            } else {
                return undefined;
            }
        };
        _ol_RotationConstraint_.none = function(rotation, delta) {
            if (rotation !== undefined) {
                return rotation + delta;
            } else {
                return undefined;
            }
        };
        _ol_RotationConstraint_.createSnapToN = function(n) {
            var theta = 2 * Math.PI / n;
            return function(rotation, delta) {
                if (rotation !== undefined) {
                    rotation = Math.floor((rotation + delta) / theta + .5) * theta;
                    return rotation;
                } else {
                    return undefined;
                }
            };
        };
        _ol_RotationConstraint_.createSnapToZero = function(opt_tolerance) {
            var tolerance = opt_tolerance || _math2.default.toRadians(5);
            return function(rotation, delta) {
                if (rotation !== undefined) {
                    if (Math.abs(rotation + delta) <= tolerance) {
                        return 0;
                    } else {
                        return rotation + delta;
                    }
                } else {
                    return undefined;
                }
            };
        };
        exports.default = _ol_RotationConstraint_;
    }, {
        "./math.js": 123
    } ],
    208: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_size_ = {};
        _ol_size_.buffer = function(size, buffer, opt_size) {
            if (opt_size === undefined) {
                opt_size = [ 0, 0 ];
            }
            opt_size[0] = size[0] + 2 * buffer;
            opt_size[1] = size[1] + 2 * buffer;
            return opt_size;
        };
        _ol_size_.hasArea = function(size) {
            return size[0] > 0 && size[1] > 0;
        };
        _ol_size_.scale = function(size, ratio, opt_size) {
            if (opt_size === undefined) {
                opt_size = [ 0, 0 ];
            }
            opt_size[0] = size[0] * ratio + .5 | 0;
            opt_size[1] = size[1] * ratio + .5 | 0;
            return opt_size;
        };
        _ol_size_.toSize = function(size, opt_size) {
            if (Array.isArray(size)) {
                return size;
            } else {
                if (opt_size === undefined) {
                    opt_size = [ size, size ];
                } else {
                    opt_size[0] = opt_size[1] = size;
                }
                return opt_size;
            }
        };
        exports.default = _ol_size_;
    }, {} ],
    209: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _imagestate = require("../imagestate.js");
        var _imagestate2 = _interopRequireDefault(_imagestate);
        var _array = require("../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _event = require("../events/event.js");
        var _event2 = _interopRequireDefault(_event);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _proj = require("../proj.js");
        var _proj2 = _interopRequireDefault(_proj);
        var _image = require("../reproj/image.js");
        var _image2 = _interopRequireDefault(_image);
        var _source = require("../source/source.js");
        var _source2 = _interopRequireDefault(_source);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_source_Image_ = function(options) {
            _source2.default.call(this, {
                attributions: options.attributions,
                extent: options.extent,
                logo: options.logo,
                projection: options.projection,
                state: options.state
            });
            this.resolutions_ = options.resolutions !== undefined ? options.resolutions : null;
            this.reprojectedImage_ = null;
            this.reprojectedRevision_ = 0;
        };
        _index2.default.inherits(_ol_source_Image_, _source2.default);
        _ol_source_Image_.prototype.getResolutions = function() {
            return this.resolutions_;
        };
        _ol_source_Image_.prototype.findNearestResolution = function(resolution) {
            if (this.resolutions_) {
                var idx = _array2.default.linearFindNearest(this.resolutions_, resolution, 0);
                resolution = this.resolutions_[idx];
            }
            return resolution;
        };
        _ol_source_Image_.prototype.getImage = function(extent, resolution, pixelRatio, projection) {
            var sourceProjection = this.getProjection();
            if (!_index2.default.ENABLE_RASTER_REPROJECTION || !sourceProjection || !projection || _proj2.default.equivalent(sourceProjection, projection)) {
                if (sourceProjection) {
                    projection = sourceProjection;
                }
                return this.getImageInternal(extent, resolution, pixelRatio, projection);
            } else {
                if (this.reprojectedImage_) {
                    if (this.reprojectedRevision_ == this.getRevision() && _proj2.default.equivalent(this.reprojectedImage_.getProjection(), projection) && this.reprojectedImage_.getResolution() == resolution && _extent2.default.equals(this.reprojectedImage_.getExtent(), extent)) {
                        return this.reprojectedImage_;
                    }
                    this.reprojectedImage_.dispose();
                    this.reprojectedImage_ = null;
                }
                this.reprojectedImage_ = new _image2.default(sourceProjection, projection, extent, resolution, pixelRatio, function(extent, resolution, pixelRatio) {
                    return this.getImageInternal(extent, resolution, pixelRatio, sourceProjection);
                }.bind(this));
                this.reprojectedRevision_ = this.getRevision();
                return this.reprojectedImage_;
            }
        };
        _ol_source_Image_.prototype.getImageInternal = function(extent, resolution, pixelRatio, projection) {};
        _ol_source_Image_.prototype.handleImageChange = function(event) {
            var image = event.target;
            switch (image.getState()) {
              case _imagestate2.default.LOADING:
                this.dispatchEvent(new _ol_source_Image_.Event(_ol_source_Image_.EventType_.IMAGELOADSTART, image));
                break;

              case _imagestate2.default.LOADED:
                this.dispatchEvent(new _ol_source_Image_.Event(_ol_source_Image_.EventType_.IMAGELOADEND, image));
                break;

              case _imagestate2.default.ERROR:
                this.dispatchEvent(new _ol_source_Image_.Event(_ol_source_Image_.EventType_.IMAGELOADERROR, image));
                break;

              default:
            }
        };
        _ol_source_Image_.defaultImageLoadFunction = function(image, src) {
            image.getImage().src = src;
        };
        _ol_source_Image_.Event = function(type, image) {
            _event2.default.call(this, type);
            this.image = image;
        };
        _index2.default.inherits(_ol_source_Image_.Event, _event2.default);
        _ol_source_Image_.EventType_ = {
            IMAGELOADSTART: "imageloadstart",
            IMAGELOADEND: "imageloadend",
            IMAGELOADERROR: "imageloaderror"
        };
        exports.default = _ol_source_Image_;
    }, {
        "../array.js": 29,
        "../events/event.js": 50,
        "../extent.js": 54,
        "../imagestate.js": 88,
        "../index.js": 89,
        "../proj.js": 141,
        "../reproj/image.js": 204,
        "../source/source.js": 211
    } ],
    210: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _image = require("../image.js");
        var _image2 = _interopRequireDefault(_image);
        var _imagestate = require("../imagestate.js");
        var _imagestate2 = _interopRequireDefault(_imagestate);
        var _dom = require("../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _proj = require("../proj.js");
        var _proj2 = _interopRequireDefault(_proj);
        var _image3 = require("../source/image.js");
        var _image4 = _interopRequireDefault(_image3);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_source_ImageStatic_ = function(options) {
            var imageExtent = options.imageExtent;
            var crossOrigin = options.crossOrigin !== undefined ? options.crossOrigin : null;
            var imageLoadFunction = options.imageLoadFunction !== undefined ? options.imageLoadFunction : _image4.default.defaultImageLoadFunction;
            _image4.default.call(this, {
                attributions: options.attributions,
                logo: options.logo,
                projection: _proj2.default.get(options.projection)
            });
            this.image_ = new _image2.default(imageExtent, undefined, 1, options.url, crossOrigin, imageLoadFunction);
            this.imageSize_ = options.imageSize ? options.imageSize : null;
            _events2.default.listen(this.image_, _eventtype2.default.CHANGE, this.handleImageChange, this);
        };
        _index2.default.inherits(_ol_source_ImageStatic_, _image4.default);
        _ol_source_ImageStatic_.prototype.getImageInternal = function(extent, resolution, pixelRatio, projection) {
            if (_extent2.default.intersects(extent, this.image_.getExtent())) {
                return this.image_;
            }
            return null;
        };
        _ol_source_ImageStatic_.prototype.handleImageChange = function(evt) {
            if (this.image_.getState() == _imagestate2.default.LOADED) {
                var imageExtent = this.image_.getExtent();
                var image = this.image_.getImage();
                var imageWidth, imageHeight;
                if (this.imageSize_) {
                    imageWidth = this.imageSize_[0];
                    imageHeight = this.imageSize_[1];
                } else {
                    imageWidth = image.width;
                    imageHeight = image.height;
                }
                var resolution = _extent2.default.getHeight(imageExtent) / imageHeight;
                var targetWidth = Math.ceil(_extent2.default.getWidth(imageExtent) / resolution);
                if (targetWidth != imageWidth) {
                    var context = _dom2.default.createCanvasContext2D(targetWidth, imageHeight);
                    var canvas = context.canvas;
                    context.drawImage(image, 0, 0, imageWidth, imageHeight, 0, 0, canvas.width, canvas.height);
                    this.image_.setImage(canvas);
                }
            }
            _image4.default.prototype.handleImageChange.call(this, evt);
        };
        exports.default = _ol_source_ImageStatic_;
    }, {
        "../dom.js": 46,
        "../events.js": 48,
        "../events/eventtype.js": 52,
        "../extent.js": 54,
        "../image.js": 85,
        "../imagestate.js": 88,
        "../index.js": 89,
        "../proj.js": 141,
        "../source/image.js": 209
    } ],
    211: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _attribution = require("../attribution.js");
        var _attribution2 = _interopRequireDefault(_attribution);
        var _object = require("../object.js");
        var _object2 = _interopRequireDefault(_object);
        var _proj = require("../proj.js");
        var _proj2 = _interopRequireDefault(_proj);
        var _state = require("../source/state.js");
        var _state2 = _interopRequireDefault(_state);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_source_Source_ = function(options) {
            _object2.default.call(this);
            this.projection_ = _proj2.default.get(options.projection);
            this.attributions_ = null;
            this.attributions2_ = this.adaptAttributions_(options.attributions);
            this.logo_ = options.logo;
            this.state_ = options.state !== undefined ? options.state : _state2.default.READY;
            this.wrapX_ = options.wrapX !== undefined ? options.wrapX : false;
        };
        _index2.default.inherits(_ol_source_Source_, _object2.default);
        _ol_source_Source_.prototype.adaptAttributions_ = function(attributionLike) {
            if (!attributionLike) {
                return null;
            }
            if (attributionLike instanceof _attribution2.default) {
                this.attributions_ = [ attributionLike ];
                return function(frameState) {
                    return [ attributionLike.getHTML() ];
                };
            }
            if (Array.isArray(attributionLike)) {
                if (attributionLike[0] instanceof _attribution2.default) {
                    this.attributions_ = attributionLike;
                    var attributions = attributionLike.map(function(attribution) {
                        return attribution.getHTML();
                    });
                    return function(frameState) {
                        return attributions;
                    };
                }
                this.attributions_ = attributionLike.map(function(attribution) {
                    return new _attribution2.default({
                        html: attribution
                    });
                });
                return function(frameState) {
                    return attributionLike;
                };
            }
            if (typeof attributionLike === "function") {
                return attributionLike;
            }
            this.attributions_ = [ new _attribution2.default({
                html: attributionLike
            }) ];
            return function(frameState) {
                return [ attributionLike ];
            };
        };
        _ol_source_Source_.prototype.forEachFeatureAtCoordinate = _index2.default.nullFunction;
        _ol_source_Source_.prototype.getAttributions = function() {
            return this.attributions_;
        };
        _ol_source_Source_.prototype.getAttributions2 = function() {
            return this.attributions2_;
        };
        _ol_source_Source_.prototype.getLogo = function() {
            return this.logo_;
        };
        _ol_source_Source_.prototype.getProjection = function() {
            return this.projection_;
        };
        _ol_source_Source_.prototype.getResolutions = function() {};
        _ol_source_Source_.prototype.getState = function() {
            return this.state_;
        };
        _ol_source_Source_.prototype.getWrapX = function() {
            return this.wrapX_;
        };
        _ol_source_Source_.prototype.refresh = function() {
            this.changed();
        };
        _ol_source_Source_.prototype.setAttributions = function(attributions) {
            this.attributions2_ = this.adaptAttributions_(attributions);
            this.changed();
        };
        _ol_source_Source_.prototype.setLogo = function(logo) {
            this.logo_ = logo;
        };
        _ol_source_Source_.prototype.setState = function(state) {
            this.state_ = state;
            this.changed();
        };
        exports.default = _ol_source_Source_;
    }, {
        "../attribution.js": 32,
        "../index.js": 89,
        "../object.js": 125,
        "../proj.js": 141,
        "../source/state.js": 212
    } ],
    212: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_source_State_ = {
            UNDEFINED: "undefined",
            LOADING: "loading",
            READY: "ready",
            ERROR: "error"
        };
        exports.default = _ol_source_State_;
    }, {} ],
    213: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _collection = require("../collection.js");
        var _collection2 = _interopRequireDefault(_collection);
        var _collectioneventtype = require("../collectioneventtype.js");
        var _collectioneventtype2 = _interopRequireDefault(_collectioneventtype);
        var _objecteventtype = require("../objecteventtype.js");
        var _objecteventtype2 = _interopRequireDefault(_objecteventtype);
        var _array = require("../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _asserts = require("../asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _event = require("../events/event.js");
        var _event2 = _interopRequireDefault(_event);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _featureloader = require("../featureloader.js");
        var _featureloader2 = _interopRequireDefault(_featureloader);
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        var _loadingstrategy = require("../loadingstrategy.js");
        var _loadingstrategy2 = _interopRequireDefault(_loadingstrategy);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _source = require("../source/source.js");
        var _source2 = _interopRequireDefault(_source);
        var _state = require("../source/state.js");
        var _state2 = _interopRequireDefault(_state);
        var _vectoreventtype = require("../source/vectoreventtype.js");
        var _vectoreventtype2 = _interopRequireDefault(_vectoreventtype);
        var _rbush = require("../structs/rbush.js");
        var _rbush2 = _interopRequireDefault(_rbush);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_source_Vector_ = function(opt_options) {
            var options = opt_options || {};
            _source2.default.call(this, {
                attributions: options.attributions,
                logo: options.logo,
                projection: undefined,
                state: _state2.default.READY,
                wrapX: options.wrapX !== undefined ? options.wrapX : true
            });
            this.loader_ = _index2.default.nullFunction;
            this.format_ = options.format;
            this.overlaps_ = options.overlaps == undefined ? true : options.overlaps;
            this.url_ = options.url;
            if (options.loader !== undefined) {
                this.loader_ = options.loader;
            } else if (this.url_ !== undefined) {
                _asserts2.default.assert(this.format_, 7);
                this.loader_ = _featureloader2.default.xhr(this.url_, this.format_);
            }
            this.strategy_ = options.strategy !== undefined ? options.strategy : _loadingstrategy2.default.all;
            var useSpatialIndex = options.useSpatialIndex !== undefined ? options.useSpatialIndex : true;
            this.featuresRtree_ = useSpatialIndex ? new _rbush2.default() : null;
            this.loadedExtentsRtree_ = new _rbush2.default();
            this.nullGeometryFeatures_ = {};
            this.idIndex_ = {};
            this.undefIdIndex_ = {};
            this.featureChangeKeys_ = {};
            this.featuresCollection_ = null;
            var collection, features;
            if (options.features instanceof _collection2.default) {
                collection = options.features;
                features = collection.getArray();
            } else if (Array.isArray(options.features)) {
                features = options.features;
            }
            if (!useSpatialIndex && collection === undefined) {
                collection = new _collection2.default(features);
            }
            if (features !== undefined) {
                this.addFeaturesInternal(features);
            }
            if (collection !== undefined) {
                this.bindFeaturesCollection_(collection);
            }
        };
        _index2.default.inherits(_ol_source_Vector_, _source2.default);
        _ol_source_Vector_.prototype.addFeature = function(feature) {
            this.addFeatureInternal(feature);
            this.changed();
        };
        _ol_source_Vector_.prototype.addFeatureInternal = function(feature) {
            var featureKey = _index2.default.getUid(feature).toString();
            if (!this.addToIndex_(featureKey, feature)) {
                return;
            }
            this.setupChangeEvents_(featureKey, feature);
            var geometry = feature.getGeometry();
            if (geometry) {
                var extent = geometry.getExtent();
                if (this.featuresRtree_) {
                    this.featuresRtree_.insert(extent, feature);
                }
            } else {
                this.nullGeometryFeatures_[featureKey] = feature;
            }
            this.dispatchEvent(new _ol_source_Vector_.Event(_vectoreventtype2.default.ADDFEATURE, feature));
        };
        _ol_source_Vector_.prototype.setupChangeEvents_ = function(featureKey, feature) {
            this.featureChangeKeys_[featureKey] = [ _events2.default.listen(feature, _eventtype2.default.CHANGE, this.handleFeatureChange_, this), _events2.default.listen(feature, _objecteventtype2.default.PROPERTYCHANGE, this.handleFeatureChange_, this) ];
        };
        _ol_source_Vector_.prototype.addToIndex_ = function(featureKey, feature) {
            var valid = true;
            var id = feature.getId();
            if (id !== undefined) {
                if (!(id.toString() in this.idIndex_)) {
                    this.idIndex_[id.toString()] = feature;
                } else {
                    valid = false;
                }
            } else {
                _asserts2.default.assert(!(featureKey in this.undefIdIndex_), 30);
                this.undefIdIndex_[featureKey] = feature;
            }
            return valid;
        };
        _ol_source_Vector_.prototype.addFeatures = function(features) {
            this.addFeaturesInternal(features);
            this.changed();
        };
        _ol_source_Vector_.prototype.addFeaturesInternal = function(features) {
            var featureKey, i, length, feature;
            var extents = [];
            var newFeatures = [];
            var geometryFeatures = [];
            for (i = 0, length = features.length; i < length; i++) {
                feature = features[i];
                featureKey = _index2.default.getUid(feature).toString();
                if (this.addToIndex_(featureKey, feature)) {
                    newFeatures.push(feature);
                }
            }
            for (i = 0, length = newFeatures.length; i < length; i++) {
                feature = newFeatures[i];
                featureKey = _index2.default.getUid(feature).toString();
                this.setupChangeEvents_(featureKey, feature);
                var geometry = feature.getGeometry();
                if (geometry) {
                    var extent = geometry.getExtent();
                    extents.push(extent);
                    geometryFeatures.push(feature);
                } else {
                    this.nullGeometryFeatures_[featureKey] = feature;
                }
            }
            if (this.featuresRtree_) {
                this.featuresRtree_.load(extents, geometryFeatures);
            }
            for (i = 0, length = newFeatures.length; i < length; i++) {
                this.dispatchEvent(new _ol_source_Vector_.Event(_vectoreventtype2.default.ADDFEATURE, newFeatures[i]));
            }
        };
        _ol_source_Vector_.prototype.bindFeaturesCollection_ = function(collection) {
            var modifyingCollection = false;
            _events2.default.listen(this, _vectoreventtype2.default.ADDFEATURE, function(evt) {
                if (!modifyingCollection) {
                    modifyingCollection = true;
                    collection.push(evt.feature);
                    modifyingCollection = false;
                }
            });
            _events2.default.listen(this, _vectoreventtype2.default.REMOVEFEATURE, function(evt) {
                if (!modifyingCollection) {
                    modifyingCollection = true;
                    collection.remove(evt.feature);
                    modifyingCollection = false;
                }
            });
            _events2.default.listen(collection, _collectioneventtype2.default.ADD, function(evt) {
                if (!modifyingCollection) {
                    modifyingCollection = true;
                    this.addFeature(evt.element);
                    modifyingCollection = false;
                }
            }, this);
            _events2.default.listen(collection, _collectioneventtype2.default.REMOVE, function(evt) {
                if (!modifyingCollection) {
                    modifyingCollection = true;
                    this.removeFeature(evt.element);
                    modifyingCollection = false;
                }
            }, this);
            this.featuresCollection_ = collection;
        };
        _ol_source_Vector_.prototype.clear = function(opt_fast) {
            if (opt_fast) {
                for (var featureId in this.featureChangeKeys_) {
                    var keys = this.featureChangeKeys_[featureId];
                    keys.forEach(_events2.default.unlistenByKey);
                }
                if (!this.featuresCollection_) {
                    this.featureChangeKeys_ = {};
                    this.idIndex_ = {};
                    this.undefIdIndex_ = {};
                }
            } else {
                if (this.featuresRtree_) {
                    this.featuresRtree_.forEach(this.removeFeatureInternal, this);
                    for (var id in this.nullGeometryFeatures_) {
                        this.removeFeatureInternal(this.nullGeometryFeatures_[id]);
                    }
                }
            }
            if (this.featuresCollection_) {
                this.featuresCollection_.clear();
            }
            if (this.featuresRtree_) {
                this.featuresRtree_.clear();
            }
            this.loadedExtentsRtree_.clear();
            this.nullGeometryFeatures_ = {};
            var clearEvent = new _ol_source_Vector_.Event(_vectoreventtype2.default.CLEAR);
            this.dispatchEvent(clearEvent);
            this.changed();
        };
        _ol_source_Vector_.prototype.forEachFeature = function(callback, opt_this) {
            if (this.featuresRtree_) {
                return this.featuresRtree_.forEach(callback, opt_this);
            } else if (this.featuresCollection_) {
                return this.featuresCollection_.forEach(callback, opt_this);
            }
        };
        _ol_source_Vector_.prototype.forEachFeatureAtCoordinateDirect = function(coordinate, callback, opt_this) {
            var extent = [ coordinate[0], coordinate[1], coordinate[0], coordinate[1] ];
            return this.forEachFeatureInExtent(extent, function(feature) {
                var geometry = feature.getGeometry();
                if (geometry.intersectsCoordinate(coordinate)) {
                    return callback.call(opt_this, feature);
                } else {
                    return undefined;
                }
            });
        };
        _ol_source_Vector_.prototype.forEachFeatureInExtent = function(extent, callback, opt_this) {
            if (this.featuresRtree_) {
                return this.featuresRtree_.forEachInExtent(extent, callback, opt_this);
            } else if (this.featuresCollection_) {
                return this.featuresCollection_.forEach(callback, opt_this);
            }
        };
        _ol_source_Vector_.prototype.forEachFeatureIntersectingExtent = function(extent, callback, opt_this) {
            return this.forEachFeatureInExtent(extent, function(feature) {
                var geometry = feature.getGeometry();
                if (geometry.intersectsExtent(extent)) {
                    var result = callback.call(opt_this, feature);
                    if (result) {
                        return result;
                    }
                }
            });
        };
        _ol_source_Vector_.prototype.getFeaturesCollection = function() {
            return this.featuresCollection_;
        };
        _ol_source_Vector_.prototype.getFeatures = function() {
            var features;
            if (this.featuresCollection_) {
                features = this.featuresCollection_.getArray();
            } else if (this.featuresRtree_) {
                features = this.featuresRtree_.getAll();
                if (!_obj2.default.isEmpty(this.nullGeometryFeatures_)) {
                    _array2.default.extend(features, _obj2.default.getValues(this.nullGeometryFeatures_));
                }
            }
            return features;
        };
        _ol_source_Vector_.prototype.getFeaturesAtCoordinate = function(coordinate) {
            var features = [];
            this.forEachFeatureAtCoordinateDirect(coordinate, function(feature) {
                features.push(feature);
            });
            return features;
        };
        _ol_source_Vector_.prototype.getFeaturesInExtent = function(extent) {
            return this.featuresRtree_.getInExtent(extent);
        };
        _ol_source_Vector_.prototype.getClosestFeatureToCoordinate = function(coordinate, opt_filter) {
            var x = coordinate[0];
            var y = coordinate[1];
            var closestFeature = null;
            var closestPoint = [ NaN, NaN ];
            var minSquaredDistance = Infinity;
            var extent = [ -Infinity, -Infinity, Infinity, Infinity ];
            var filter = opt_filter ? opt_filter : _functions2.default.TRUE;
            this.featuresRtree_.forEachInExtent(extent, function(feature) {
                if (filter(feature)) {
                    var geometry = feature.getGeometry();
                    var previousMinSquaredDistance = minSquaredDistance;
                    minSquaredDistance = geometry.closestPointXY(x, y, closestPoint, minSquaredDistance);
                    if (minSquaredDistance < previousMinSquaredDistance) {
                        closestFeature = feature;
                        var minDistance = Math.sqrt(minSquaredDistance);
                        extent[0] = x - minDistance;
                        extent[1] = y - minDistance;
                        extent[2] = x + minDistance;
                        extent[3] = y + minDistance;
                    }
                }
            });
            return closestFeature;
        };
        _ol_source_Vector_.prototype.getExtent = function(opt_extent) {
            return this.featuresRtree_.getExtent(opt_extent);
        };
        _ol_source_Vector_.prototype.getFeatureById = function(id) {
            var feature = this.idIndex_[id.toString()];
            return feature !== undefined ? feature : null;
        };
        _ol_source_Vector_.prototype.getFormat = function() {
            return this.format_;
        };
        _ol_source_Vector_.prototype.getOverlaps = function() {
            return this.overlaps_;
        };
        _ol_source_Vector_.prototype.getResolutions = function() {};
        _ol_source_Vector_.prototype.getUrl = function() {
            return this.url_;
        };
        _ol_source_Vector_.prototype.handleFeatureChange_ = function(event) {
            var feature = event.target;
            var featureKey = _index2.default.getUid(feature).toString();
            var geometry = feature.getGeometry();
            if (!geometry) {
                if (!(featureKey in this.nullGeometryFeatures_)) {
                    if (this.featuresRtree_) {
                        this.featuresRtree_.remove(feature);
                    }
                    this.nullGeometryFeatures_[featureKey] = feature;
                }
            } else {
                var extent = geometry.getExtent();
                if (featureKey in this.nullGeometryFeatures_) {
                    delete this.nullGeometryFeatures_[featureKey];
                    if (this.featuresRtree_) {
                        this.featuresRtree_.insert(extent, feature);
                    }
                } else {
                    if (this.featuresRtree_) {
                        this.featuresRtree_.update(extent, feature);
                    }
                }
            }
            var id = feature.getId();
            if (id !== undefined) {
                var sid = id.toString();
                if (featureKey in this.undefIdIndex_) {
                    delete this.undefIdIndex_[featureKey];
                    this.idIndex_[sid] = feature;
                } else {
                    if (this.idIndex_[sid] !== feature) {
                        this.removeFromIdIndex_(feature);
                        this.idIndex_[sid] = feature;
                    }
                }
            } else {
                if (!(featureKey in this.undefIdIndex_)) {
                    this.removeFromIdIndex_(feature);
                    this.undefIdIndex_[featureKey] = feature;
                }
            }
            this.changed();
            this.dispatchEvent(new _ol_source_Vector_.Event(_vectoreventtype2.default.CHANGEFEATURE, feature));
        };
        _ol_source_Vector_.prototype.isEmpty = function() {
            return this.featuresRtree_.isEmpty() && _obj2.default.isEmpty(this.nullGeometryFeatures_);
        };
        _ol_source_Vector_.prototype.loadFeatures = function(extent, resolution, projection) {
            var loadedExtentsRtree = this.loadedExtentsRtree_;
            var extentsToLoad = this.strategy_(extent, resolution);
            var i, ii;
            for (i = 0, ii = extentsToLoad.length; i < ii; ++i) {
                var extentToLoad = extentsToLoad[i];
                var alreadyLoaded = loadedExtentsRtree.forEachInExtent(extentToLoad, function(object) {
                    return _extent2.default.containsExtent(object.extent, extentToLoad);
                });
                if (!alreadyLoaded) {
                    this.loader_.call(this, extentToLoad, resolution, projection);
                    loadedExtentsRtree.insert(extentToLoad, {
                        extent: extentToLoad.slice()
                    });
                }
            }
        };
        _ol_source_Vector_.prototype.removeLoadedExtent = function(extent) {
            var loadedExtentsRtree = this.loadedExtentsRtree_;
            var obj;
            loadedExtentsRtree.forEachInExtent(extent, function(object) {
                if (_extent2.default.equals(object.extent, extent)) {
                    obj = object;
                    return true;
                }
            });
            if (obj) {
                loadedExtentsRtree.remove(obj);
            }
        };
        _ol_source_Vector_.prototype.removeFeature = function(feature) {
            var featureKey = _index2.default.getUid(feature).toString();
            if (featureKey in this.nullGeometryFeatures_) {
                delete this.nullGeometryFeatures_[featureKey];
            } else {
                if (this.featuresRtree_) {
                    this.featuresRtree_.remove(feature);
                }
            }
            this.removeFeatureInternal(feature);
            this.changed();
        };
        _ol_source_Vector_.prototype.removeFeatureInternal = function(feature) {
            var featureKey = _index2.default.getUid(feature).toString();
            this.featureChangeKeys_[featureKey].forEach(_events2.default.unlistenByKey);
            delete this.featureChangeKeys_[featureKey];
            var id = feature.getId();
            if (id !== undefined) {
                delete this.idIndex_[id.toString()];
            } else {
                delete this.undefIdIndex_[featureKey];
            }
            this.dispatchEvent(new _ol_source_Vector_.Event(_vectoreventtype2.default.REMOVEFEATURE, feature));
        };
        _ol_source_Vector_.prototype.removeFromIdIndex_ = function(feature) {
            var removed = false;
            for (var id in this.idIndex_) {
                if (this.idIndex_[id] === feature) {
                    delete this.idIndex_[id];
                    removed = true;
                    break;
                }
            }
            return removed;
        };
        _ol_source_Vector_.prototype.setLoader = function(loader) {
            this.loader_ = loader;
        };
        _ol_source_Vector_.Event = function(type, opt_feature) {
            _event2.default.call(this, type);
            this.feature = opt_feature;
        };
        _index2.default.inherits(_ol_source_Vector_.Event, _event2.default);
        exports.default = _ol_source_Vector_;
    }, {
        "../array.js": 29,
        "../asserts.js": 31,
        "../collection.js": 34,
        "../collectioneventtype.js": 35,
        "../events.js": 48,
        "../events/event.js": 50,
        "../events/eventtype.js": 52,
        "../extent.js": 54,
        "../featureloader.js": 58,
        "../functions.js": 60,
        "../index.js": 89,
        "../loadingstrategy.js": 114,
        "../obj.js": 124,
        "../objecteventtype.js": 126,
        "../source/source.js": 211,
        "../source/state.js": 212,
        "../source/vectoreventtype.js": 214,
        "../structs/rbush.js": 220
    } ],
    214: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_source_VectorEventType_ = {
            ADDFEATURE: "addfeature",
            CHANGEFEATURE: "changefeature",
            CLEAR: "clear",
            REMOVEFEATURE: "removefeature"
        };
        exports.default = _ol_source_VectorEventType_;
    }, {} ],
    215: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _math = require("./math.js");
        var _math2 = _interopRequireDefault(_math);
        var _geometrytype = require("./geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_Sphere_ = function(radius) {
            this.radius = radius;
        };
        _ol_Sphere_.prototype.geodesicArea = function(coordinates) {
            return _ol_Sphere_.getArea_(coordinates, this.radius);
        };
        _ol_Sphere_.prototype.haversineDistance = function(c1, c2) {
            return _ol_Sphere_.getDistance_(c1, c2, this.radius);
        };
        _ol_Sphere_.prototype.offset = function(c1, distance, bearing) {
            var lat1 = _math2.default.toRadians(c1[1]);
            var lon1 = _math2.default.toRadians(c1[0]);
            var dByR = distance / this.radius;
            var lat = Math.asin(Math.sin(lat1) * Math.cos(dByR) + Math.cos(lat1) * Math.sin(dByR) * Math.cos(bearing));
            var lon = lon1 + Math.atan2(Math.sin(bearing) * Math.sin(dByR) * Math.cos(lat1), Math.cos(dByR) - Math.sin(lat1) * Math.sin(lat));
            return [ _math2.default.toDegrees(lon), _math2.default.toDegrees(lat) ];
        };
        _ol_Sphere_.DEFAULT_RADIUS = 6371008.8;
        _ol_Sphere_.getLength = function(geometry, opt_options) {
            var options = opt_options || {};
            var radius = options.radius || _ol_Sphere_.DEFAULT_RADIUS;
            var projection = options.projection || "EPSG:3857";
            geometry = geometry.clone().transform(projection, "EPSG:4326");
            var type = geometry.getType();
            var length = 0;
            var coordinates, coords, i, ii, j, jj;
            switch (type) {
              case _geometrytype2.default.POINT:
              case _geometrytype2.default.MULTI_POINT:
                {
                    break;
                }

              case _geometrytype2.default.LINE_STRING:
              case _geometrytype2.default.LINEAR_RING:
                {
                    coordinates = geometry.getCoordinates();
                    length = _ol_Sphere_.getLength_(coordinates, radius);
                    break;
                }

              case _geometrytype2.default.MULTI_LINE_STRING:
              case _geometrytype2.default.POLYGON:
                {
                    coordinates = geometry.getCoordinates();
                    for (i = 0, ii = coordinates.length; i < ii; ++i) {
                        length += _ol_Sphere_.getLength_(coordinates[i], radius);
                    }
                    break;
                }

              case _geometrytype2.default.MULTI_POLYGON:
                {
                    coordinates = geometry.getCoordinates();
                    for (i = 0, ii = coordinates.length; i < ii; ++i) {
                        coords = coordinates[i];
                        for (j = 0, jj = coords.length; j < jj; ++j) {
                            length += _ol_Sphere_.getLength_(coords[j], radius);
                        }
                    }
                    break;
                }

              case _geometrytype2.default.GEOMETRY_COLLECTION:
                {
                    var geometries = geometry.getGeometries();
                    for (i = 0, ii = geometries.length; i < ii; ++i) {
                        length += _ol_Sphere_.getLength(geometries[i], opt_options);
                    }
                    break;
                }

              default:
                {
                    throw new Error("Unsupported geometry type: " + type);
                }
            }
            return length;
        };
        _ol_Sphere_.getLength_ = function(coordinates, radius) {
            var length = 0;
            for (var i = 0, ii = coordinates.length; i < ii - 1; ++i) {
                length += _ol_Sphere_.getDistance_(coordinates[i], coordinates[i + 1], radius);
            }
            return length;
        };
        _ol_Sphere_.getDistance_ = function(c1, c2, radius) {
            var lat1 = _math2.default.toRadians(c1[1]);
            var lat2 = _math2.default.toRadians(c2[1]);
            var deltaLatBy2 = (lat2 - lat1) / 2;
            var deltaLonBy2 = _math2.default.toRadians(c2[0] - c1[0]) / 2;
            var a = Math.sin(deltaLatBy2) * Math.sin(deltaLatBy2) + Math.sin(deltaLonBy2) * Math.sin(deltaLonBy2) * Math.cos(lat1) * Math.cos(lat2);
            return 2 * radius * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        };
        _ol_Sphere_.getArea = function(geometry, opt_options) {
            var options = opt_options || {};
            var radius = options.radius || _ol_Sphere_.DEFAULT_RADIUS;
            var projection = options.projection || "EPSG:3857";
            geometry = geometry.clone().transform(projection, "EPSG:4326");
            var type = geometry.getType();
            var area = 0;
            var coordinates, coords, i, ii, j, jj;
            switch (type) {
              case _geometrytype2.default.POINT:
              case _geometrytype2.default.MULTI_POINT:
              case _geometrytype2.default.LINE_STRING:
              case _geometrytype2.default.MULTI_LINE_STRING:
              case _geometrytype2.default.LINEAR_RING:
                {
                    break;
                }

              case _geometrytype2.default.POLYGON:
                {
                    coordinates = geometry.getCoordinates();
                    area = Math.abs(_ol_Sphere_.getArea_(coordinates[0], radius));
                    for (i = 1, ii = coordinates.length; i < ii; ++i) {
                        area -= Math.abs(_ol_Sphere_.getArea_(coordinates[i], radius));
                    }
                    break;
                }

              case _geometrytype2.default.MULTI_POLYGON:
                {
                    coordinates = geometry.getCoordinates();
                    for (i = 0, ii = coordinates.length; i < ii; ++i) {
                        coords = coordinates[i];
                        area += Math.abs(_ol_Sphere_.getArea_(coords[0], radius));
                        for (j = 1, jj = coords.length; j < jj; ++j) {
                            area -= Math.abs(_ol_Sphere_.getArea_(coords[j], radius));
                        }
                    }
                    break;
                }

              case _geometrytype2.default.GEOMETRY_COLLECTION:
                {
                    var geometries = geometry.getGeometries();
                    for (i = 0, ii = geometries.length; i < ii; ++i) {
                        area += _ol_Sphere_.getArea(geometries[i], opt_options);
                    }
                    break;
                }

              default:
                {
                    throw new Error("Unsupported geometry type: " + type);
                }
            }
            return area;
        };
        _ol_Sphere_.getArea_ = function(coordinates, radius) {
            var area = 0, len = coordinates.length;
            var x1 = coordinates[len - 1][0];
            var y1 = coordinates[len - 1][1];
            for (var i = 0; i < len; i++) {
                var x2 = coordinates[i][0], y2 = coordinates[i][1];
                area += _math2.default.toRadians(x2 - x1) * (2 + Math.sin(_math2.default.toRadians(y1)) + Math.sin(_math2.default.toRadians(y2)));
                x1 = x2;
                y1 = y2;
            }
            return area * radius * radius / 2;
        };
        exports.default = _ol_Sphere_;
    }, {
        "./geom/geometrytype.js": 79,
        "./math.js": 123
    } ],
    216: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_string_ = {};
        _ol_string_.padNumber = function(number, width, opt_precision) {
            var numberString = opt_precision !== undefined ? number.toFixed(opt_precision) : "" + number;
            var decimal = numberString.indexOf(".");
            decimal = decimal === -1 ? numberString.length : decimal;
            return decimal > width ? numberString : new Array(1 + width - decimal).join("0") + numberString;
        };
        _ol_string_.compareVersions = function(v1, v2) {
            var s1 = ("" + v1).split(".");
            var s2 = ("" + v2).split(".");
            for (var i = 0; i < Math.max(s1.length, s2.length); i++) {
                var n1 = parseInt(s1[i] || "0", 10);
                var n2 = parseInt(s2[i] || "0", 10);
                if (n1 > n2) {
                    return 1;
                }
                if (n2 > n1) {
                    return -1;
                }
            }
            return 0;
        };
        exports.default = _ol_string_;
    }, {} ],
    217: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_structs_LinkedList_ = function(opt_circular) {
            this.first_ = undefined;
            this.last_ = undefined;
            this.head_ = undefined;
            this.circular_ = opt_circular === undefined ? true : opt_circular;
            this.length_ = 0;
        };
        _ol_structs_LinkedList_.prototype.insertItem = function(data) {
            var item = {
                prev: undefined,
                next: undefined,
                data: data
            };
            var head = this.head_;
            if (!head) {
                this.first_ = item;
                this.last_ = item;
                if (this.circular_) {
                    item.next = item;
                    item.prev = item;
                }
            } else {
                var next = head.next;
                item.prev = head;
                item.next = next;
                head.next = item;
                if (next) {
                    next.prev = item;
                }
                if (head === this.last_) {
                    this.last_ = item;
                }
            }
            this.head_ = item;
            this.length_++;
        };
        _ol_structs_LinkedList_.prototype.removeItem = function() {
            var head = this.head_;
            if (head) {
                var next = head.next;
                var prev = head.prev;
                if (next) {
                    next.prev = prev;
                }
                if (prev) {
                    prev.next = next;
                }
                this.head_ = next || prev;
                if (this.first_ === this.last_) {
                    this.head_ = undefined;
                    this.first_ = undefined;
                    this.last_ = undefined;
                } else if (this.first_ === head) {
                    this.first_ = this.head_;
                } else if (this.last_ === head) {
                    this.last_ = prev ? this.head_.prev : this.head_;
                }
                this.length_--;
            }
        };
        _ol_structs_LinkedList_.prototype.firstItem = function() {
            this.head_ = this.first_;
            if (this.head_) {
                return this.head_.data;
            }
            return undefined;
        };
        _ol_structs_LinkedList_.prototype.lastItem = function() {
            this.head_ = this.last_;
            if (this.head_) {
                return this.head_.data;
            }
            return undefined;
        };
        _ol_structs_LinkedList_.prototype.nextItem = function() {
            if (this.head_ && this.head_.next) {
                this.head_ = this.head_.next;
                return this.head_.data;
            }
            return undefined;
        };
        _ol_structs_LinkedList_.prototype.getNextItem = function() {
            if (this.head_ && this.head_.next) {
                return this.head_.next.data;
            }
            return undefined;
        };
        _ol_structs_LinkedList_.prototype.prevItem = function() {
            if (this.head_ && this.head_.prev) {
                this.head_ = this.head_.prev;
                return this.head_.data;
            }
            return undefined;
        };
        _ol_structs_LinkedList_.prototype.getPrevItem = function() {
            if (this.head_ && this.head_.prev) {
                return this.head_.prev.data;
            }
            return undefined;
        };
        _ol_structs_LinkedList_.prototype.getCurrItem = function() {
            if (this.head_) {
                return this.head_.data;
            }
            return undefined;
        };
        _ol_structs_LinkedList_.prototype.setFirstItem = function() {
            if (this.circular_ && this.head_) {
                this.first_ = this.head_;
                this.last_ = this.head_.prev;
            }
        };
        _ol_structs_LinkedList_.prototype.concat = function(list) {
            if (list.head_) {
                if (this.head_) {
                    var end = this.head_.next;
                    this.head_.next = list.first_;
                    list.first_.prev = this.head_;
                    end.prev = list.last_;
                    list.last_.next = end;
                    this.length_ += list.length_;
                } else {
                    this.head_ = list.head_;
                    this.first_ = list.first_;
                    this.last_ = list.last_;
                    this.length_ = list.length_;
                }
                list.head_ = undefined;
                list.first_ = undefined;
                list.last_ = undefined;
                list.length_ = 0;
            }
        };
        _ol_structs_LinkedList_.prototype.getLength = function() {
            return this.length_;
        };
        exports.default = _ol_structs_LinkedList_;
    }, {} ],
    218: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _asserts = require("../asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _eventtarget = require("../events/eventtarget.js");
        var _eventtarget2 = _interopRequireDefault(_eventtarget);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_structs_LRUCache_ = function(opt_highWaterMark) {
            _eventtarget2.default.call(this);
            this.highWaterMark = opt_highWaterMark !== undefined ? opt_highWaterMark : 2048;
            this.count_ = 0;
            this.entries_ = {};
            this.oldest_ = null;
            this.newest_ = null;
        };
        _index2.default.inherits(_ol_structs_LRUCache_, _eventtarget2.default);
        _ol_structs_LRUCache_.prototype.canExpireCache = function() {
            return this.getCount() > this.highWaterMark;
        };
        _ol_structs_LRUCache_.prototype.clear = function() {
            this.count_ = 0;
            this.entries_ = {};
            this.oldest_ = null;
            this.newest_ = null;
            this.dispatchEvent(_eventtype2.default.CLEAR);
        };
        _ol_structs_LRUCache_.prototype.containsKey = function(key) {
            return this.entries_.hasOwnProperty(key);
        };
        _ol_structs_LRUCache_.prototype.forEach = function(f, opt_this) {
            var entry = this.oldest_;
            while (entry) {
                f.call(opt_this, entry.value_, entry.key_, this);
                entry = entry.newer;
            }
        };
        _ol_structs_LRUCache_.prototype.get = function(key) {
            var entry = this.entries_[key];
            _asserts2.default.assert(entry !== undefined, 15);
            if (entry === this.newest_) {
                return entry.value_;
            } else if (entry === this.oldest_) {
                this.oldest_ = this.oldest_.newer;
                this.oldest_.older = null;
            } else {
                entry.newer.older = entry.older;
                entry.older.newer = entry.newer;
            }
            entry.newer = null;
            entry.older = this.newest_;
            this.newest_.newer = entry;
            this.newest_ = entry;
            return entry.value_;
        };
        _ol_structs_LRUCache_.prototype.remove = function(key) {
            var entry = this.entries_[key];
            _asserts2.default.assert(entry !== undefined, 15);
            if (entry === this.newest_) {
                this.newest_ = entry.older;
                if (this.newest_) {
                    this.newest_.newer = null;
                }
            } else if (entry === this.oldest_) {
                this.oldest_ = entry.newer;
                if (this.oldest_) {
                    this.oldest_.older = null;
                }
            } else {
                entry.newer.older = entry.older;
                entry.older.newer = entry.newer;
            }
            delete this.entries_[key];
            --this.count_;
            return entry.value_;
        };
        _ol_structs_LRUCache_.prototype.getCount = function() {
            return this.count_;
        };
        _ol_structs_LRUCache_.prototype.getKeys = function() {
            var keys = new Array(this.count_);
            var i = 0;
            var entry;
            for (entry = this.newest_; entry; entry = entry.older) {
                keys[i++] = entry.key_;
            }
            return keys;
        };
        _ol_structs_LRUCache_.prototype.getValues = function() {
            var values = new Array(this.count_);
            var i = 0;
            var entry;
            for (entry = this.newest_; entry; entry = entry.older) {
                values[i++] = entry.value_;
            }
            return values;
        };
        _ol_structs_LRUCache_.prototype.peekLast = function() {
            return this.oldest_.value_;
        };
        _ol_structs_LRUCache_.prototype.peekLastKey = function() {
            return this.oldest_.key_;
        };
        _ol_structs_LRUCache_.prototype.peekFirstKey = function() {
            return this.newest_.key_;
        };
        _ol_structs_LRUCache_.prototype.pop = function() {
            var entry = this.oldest_;
            delete this.entries_[entry.key_];
            if (entry.newer) {
                entry.newer.older = null;
            }
            this.oldest_ = entry.newer;
            if (!this.oldest_) {
                this.newest_ = null;
            }
            --this.count_;
            return entry.value_;
        };
        _ol_structs_LRUCache_.prototype.replace = function(key, value) {
            this.get(key);
            this.entries_[key].value_ = value;
        };
        _ol_structs_LRUCache_.prototype.set = function(key, value) {
            _asserts2.default.assert(!(key in this.entries_), 16);
            var entry = {
                key_: key,
                newer: null,
                older: this.newest_,
                value_: value
            };
            if (!this.newest_) {
                this.oldest_ = entry;
            } else {
                this.newest_.newer = entry;
            }
            this.newest_ = entry;
            this.entries_[key] = entry;
            ++this.count_;
        };
        _ol_structs_LRUCache_.prototype.prune = function() {
            while (this.canExpireCache()) {
                this.pop();
            }
        };
        exports.default = _ol_structs_LRUCache_;
    }, {
        "../asserts.js": 31,
        "../events/eventtarget.js": 51,
        "../events/eventtype.js": 52,
        "../index.js": 89
    } ],
    219: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _asserts = require("../asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_structs_PriorityQueue_ = function(priorityFunction, keyFunction) {
            this.priorityFunction_ = priorityFunction;
            this.keyFunction_ = keyFunction;
            this.elements_ = [];
            this.priorities_ = [];
            this.queuedElements_ = {};
        };
        _ol_structs_PriorityQueue_.DROP = Infinity;
        _ol_structs_PriorityQueue_.prototype.clear = function() {
            this.elements_.length = 0;
            this.priorities_.length = 0;
            _obj2.default.clear(this.queuedElements_);
        };
        _ol_structs_PriorityQueue_.prototype.dequeue = function() {
            var elements = this.elements_;
            var priorities = this.priorities_;
            var element = elements[0];
            if (elements.length == 1) {
                elements.length = 0;
                priorities.length = 0;
            } else {
                elements[0] = elements.pop();
                priorities[0] = priorities.pop();
                this.siftUp_(0);
            }
            var elementKey = this.keyFunction_(element);
            delete this.queuedElements_[elementKey];
            return element;
        };
        _ol_structs_PriorityQueue_.prototype.enqueue = function(element) {
            _asserts2.default.assert(!(this.keyFunction_(element) in this.queuedElements_), 31);
            var priority = this.priorityFunction_(element);
            if (priority != _ol_structs_PriorityQueue_.DROP) {
                this.elements_.push(element);
                this.priorities_.push(priority);
                this.queuedElements_[this.keyFunction_(element)] = true;
                this.siftDown_(0, this.elements_.length - 1);
                return true;
            }
            return false;
        };
        _ol_structs_PriorityQueue_.prototype.getCount = function() {
            return this.elements_.length;
        };
        _ol_structs_PriorityQueue_.prototype.getLeftChildIndex_ = function(index) {
            return index * 2 + 1;
        };
        _ol_structs_PriorityQueue_.prototype.getRightChildIndex_ = function(index) {
            return index * 2 + 2;
        };
        _ol_structs_PriorityQueue_.prototype.getParentIndex_ = function(index) {
            return index - 1 >> 1;
        };
        _ol_structs_PriorityQueue_.prototype.heapify_ = function() {
            var i;
            for (i = (this.elements_.length >> 1) - 1; i >= 0; i--) {
                this.siftUp_(i);
            }
        };
        _ol_structs_PriorityQueue_.prototype.isEmpty = function() {
            return this.elements_.length === 0;
        };
        _ol_structs_PriorityQueue_.prototype.isKeyQueued = function(key) {
            return key in this.queuedElements_;
        };
        _ol_structs_PriorityQueue_.prototype.isQueued = function(element) {
            return this.isKeyQueued(this.keyFunction_(element));
        };
        _ol_structs_PriorityQueue_.prototype.siftUp_ = function(index) {
            var elements = this.elements_;
            var priorities = this.priorities_;
            var count = elements.length;
            var element = elements[index];
            var priority = priorities[index];
            var startIndex = index;
            while (index < count >> 1) {
                var lIndex = this.getLeftChildIndex_(index);
                var rIndex = this.getRightChildIndex_(index);
                var smallerChildIndex = rIndex < count && priorities[rIndex] < priorities[lIndex] ? rIndex : lIndex;
                elements[index] = elements[smallerChildIndex];
                priorities[index] = priorities[smallerChildIndex];
                index = smallerChildIndex;
            }
            elements[index] = element;
            priorities[index] = priority;
            this.siftDown_(startIndex, index);
        };
        _ol_structs_PriorityQueue_.prototype.siftDown_ = function(startIndex, index) {
            var elements = this.elements_;
            var priorities = this.priorities_;
            var element = elements[index];
            var priority = priorities[index];
            while (index > startIndex) {
                var parentIndex = this.getParentIndex_(index);
                if (priorities[parentIndex] > priority) {
                    elements[index] = elements[parentIndex];
                    priorities[index] = priorities[parentIndex];
                    index = parentIndex;
                } else {
                    break;
                }
            }
            elements[index] = element;
            priorities[index] = priority;
        };
        _ol_structs_PriorityQueue_.prototype.reprioritize = function() {
            var priorityFunction = this.priorityFunction_;
            var elements = this.elements_;
            var priorities = this.priorities_;
            var index = 0;
            var n = elements.length;
            var element, i, priority;
            for (i = 0; i < n; ++i) {
                element = elements[i];
                priority = priorityFunction(element);
                if (priority == _ol_structs_PriorityQueue_.DROP) {
                    delete this.queuedElements_[this.keyFunction_(element)];
                } else {
                    priorities[index] = priority;
                    elements[index++] = element;
                }
            }
            elements.length = index;
            priorities.length = index;
            this.heapify_();
        };
        exports.default = _ol_structs_PriorityQueue_;
    }, {
        "../asserts.js": 31,
        "../obj.js": 124
    } ],
    220: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _rbush = require("rbush");
        var _rbush2 = _interopRequireDefault(_rbush);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_structs_RBush_ = function(opt_maxEntries) {
            this.rbush_ = (0, _rbush2.default)(opt_maxEntries);
            this.items_ = {};
        };
        _ol_structs_RBush_.prototype.insert = function(extent, value) {
            var item = {
                minX: extent[0],
                minY: extent[1],
                maxX: extent[2],
                maxY: extent[3],
                value: value
            };
            this.rbush_.insert(item);
            this.items_[_index2.default.getUid(value)] = item;
        };
        _ol_structs_RBush_.prototype.load = function(extents, values) {
            var items = new Array(values.length);
            for (var i = 0, l = values.length; i < l; i++) {
                var extent = extents[i];
                var value = values[i];
                var item = {
                    minX: extent[0],
                    minY: extent[1],
                    maxX: extent[2],
                    maxY: extent[3],
                    value: value
                };
                items[i] = item;
                this.items_[_index2.default.getUid(value)] = item;
            }
            this.rbush_.load(items);
        };
        _ol_structs_RBush_.prototype.remove = function(value) {
            var uid = _index2.default.getUid(value);
            var item = this.items_[uid];
            delete this.items_[uid];
            return this.rbush_.remove(item) !== null;
        };
        _ol_structs_RBush_.prototype.update = function(extent, value) {
            var item = this.items_[_index2.default.getUid(value)];
            var bbox = [ item.minX, item.minY, item.maxX, item.maxY ];
            if (!_extent2.default.equals(bbox, extent)) {
                this.remove(value);
                this.insert(extent, value);
            }
        };
        _ol_structs_RBush_.prototype.getAll = function() {
            var items = this.rbush_.all();
            return items.map(function(item) {
                return item.value;
            });
        };
        _ol_structs_RBush_.prototype.getInExtent = function(extent) {
            var bbox = {
                minX: extent[0],
                minY: extent[1],
                maxX: extent[2],
                maxY: extent[3]
            };
            var items = this.rbush_.search(bbox);
            return items.map(function(item) {
                return item.value;
            });
        };
        _ol_structs_RBush_.prototype.forEach = function(callback, opt_this) {
            return this.forEach_(this.getAll(), callback, opt_this);
        };
        _ol_structs_RBush_.prototype.forEachInExtent = function(extent, callback, opt_this) {
            return this.forEach_(this.getInExtent(extent), callback, opt_this);
        };
        _ol_structs_RBush_.prototype.forEach_ = function(values, callback, opt_this) {
            var result;
            for (var i = 0, l = values.length; i < l; i++) {
                result = callback.call(opt_this, values[i]);
                if (result) {
                    return result;
                }
            }
            return result;
        };
        _ol_structs_RBush_.prototype.isEmpty = function() {
            return _obj2.default.isEmpty(this.items_);
        };
        _ol_structs_RBush_.prototype.clear = function() {
            this.rbush_.clear();
            this.items_ = {};
        };
        _ol_structs_RBush_.prototype.getExtent = function(opt_extent) {
            var data = this.rbush_.data;
            return _extent2.default.createOrUpdate(data.minX, data.minY, data.maxX, data.maxY, opt_extent);
        };
        _ol_structs_RBush_.prototype.concat = function(rbush) {
            this.rbush_.load(rbush.rbush_.all());
            for (var i in rbush.items_) {
                this.items_[i | 0] = rbush.items_[i | 0];
            }
        };
        exports.default = _ol_structs_RBush_;
    }, {
        "../extent.js": 54,
        "../index.js": 89,
        "../obj.js": 124,
        rbush: 258
    } ],
    221: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _iconimagecache = require("./style/iconimagecache.js");
        var _iconimagecache2 = _interopRequireDefault(_iconimagecache);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_ = {};
        _ol_style_.iconImageCache = new _iconimagecache2.default();
        exports.default = _ol_style_;
    }, {
        "./style/iconimagecache.js": 229
    } ],
    222: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _dom = require("../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_Atlas_ = function(size, space) {
            this.space_ = space;
            this.emptyBlocks_ = [ {
                x: 0,
                y: 0,
                width: size,
                height: size
            } ];
            this.entries_ = {};
            this.context_ = _dom2.default.createCanvasContext2D(size, size);
            this.canvas_ = this.context_.canvas;
        };
        _ol_style_Atlas_.prototype.get = function(id) {
            return this.entries_[id] || null;
        };
        _ol_style_Atlas_.prototype.add = function(id, width, height, renderCallback, opt_this) {
            var block, i, ii;
            for (i = 0, ii = this.emptyBlocks_.length; i < ii; ++i) {
                block = this.emptyBlocks_[i];
                if (block.width >= width + this.space_ && block.height >= height + this.space_) {
                    var entry = {
                        offsetX: block.x + this.space_,
                        offsetY: block.y + this.space_,
                        image: this.canvas_
                    };
                    this.entries_[id] = entry;
                    renderCallback.call(opt_this, this.context_, block.x + this.space_, block.y + this.space_);
                    this.split_(i, block, width + this.space_, height + this.space_);
                    return entry;
                }
            }
            return null;
        };
        _ol_style_Atlas_.prototype.split_ = function(index, block, width, height) {
            var deltaWidth = block.width - width;
            var deltaHeight = block.height - height;
            var newBlock1;
            var newBlock2;
            if (deltaWidth > deltaHeight) {
                newBlock1 = {
                    x: block.x + width,
                    y: block.y,
                    width: block.width - width,
                    height: block.height
                };
                newBlock2 = {
                    x: block.x,
                    y: block.y + height,
                    width: width,
                    height: block.height - height
                };
                this.updateBlocks_(index, newBlock1, newBlock2);
            } else {
                newBlock1 = {
                    x: block.x + width,
                    y: block.y,
                    width: block.width - width,
                    height: height
                };
                newBlock2 = {
                    x: block.x,
                    y: block.y + height,
                    width: block.width,
                    height: block.height - height
                };
                this.updateBlocks_(index, newBlock1, newBlock2);
            }
        };
        _ol_style_Atlas_.prototype.updateBlocks_ = function(index, newBlock1, newBlock2) {
            var args = [ index, 1 ];
            if (newBlock1.width > 0 && newBlock1.height > 0) {
                args.push(newBlock1);
            }
            if (newBlock2.width > 0 && newBlock2.height > 0) {
                args.push(newBlock2);
            }
            this.emptyBlocks_.splice.apply(this.emptyBlocks_, args);
        };
        exports.default = _ol_style_Atlas_;
    }, {
        "../dom.js": 46
    } ],
    223: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _atlas = require("../style/atlas.js");
        var _atlas2 = _interopRequireDefault(_atlas);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_AtlasManager_ = function(opt_options) {
            var options = opt_options || {};
            this.currentSize_ = options.initialSize !== undefined ? options.initialSize : _index2.default.INITIAL_ATLAS_SIZE;
            this.maxSize_ = options.maxSize !== undefined ? options.maxSize : _index2.default.MAX_ATLAS_SIZE != -1 ? _index2.default.MAX_ATLAS_SIZE : _index2.default.WEBGL_MAX_TEXTURE_SIZE !== undefined ? _index2.default.WEBGL_MAX_TEXTURE_SIZE : 2048;
            this.space_ = options.space !== undefined ? options.space : 1;
            this.atlases_ = [ new _atlas2.default(this.currentSize_, this.space_) ];
            this.currentHitSize_ = this.currentSize_;
            this.hitAtlases_ = [ new _atlas2.default(this.currentHitSize_, this.space_) ];
        };
        _ol_style_AtlasManager_.prototype.getInfo = function(id) {
            var info = this.getInfo_(this.atlases_, id);
            if (!info) {
                return null;
            }
            var hitInfo = this.getInfo_(this.hitAtlases_, id);
            return this.mergeInfos_(info, hitInfo);
        };
        _ol_style_AtlasManager_.prototype.getInfo_ = function(atlases, id) {
            var atlas, info, i, ii;
            for (i = 0, ii = atlases.length; i < ii; ++i) {
                atlas = atlases[i];
                info = atlas.get(id);
                if (info) {
                    return info;
                }
            }
            return null;
        };
        _ol_style_AtlasManager_.prototype.mergeInfos_ = function(info, hitInfo) {
            return {
                offsetX: info.offsetX,
                offsetY: info.offsetY,
                image: info.image,
                hitImage: hitInfo.image
            };
        };
        _ol_style_AtlasManager_.prototype.add = function(id, width, height, renderCallback, opt_renderHitCallback, opt_this) {
            if (width + this.space_ > this.maxSize_ || height + this.space_ > this.maxSize_) {
                return null;
            }
            var info = this.add_(false, id, width, height, renderCallback, opt_this);
            if (!info) {
                return null;
            }
            var renderHitCallback = opt_renderHitCallback !== undefined ? opt_renderHitCallback : _index2.default.nullFunction;
            var hitInfo = this.add_(true, id, width, height, renderHitCallback, opt_this);
            return this.mergeInfos_(info, hitInfo);
        };
        _ol_style_AtlasManager_.prototype.add_ = function(isHitAtlas, id, width, height, renderCallback, opt_this) {
            var atlases = isHitAtlas ? this.hitAtlases_ : this.atlases_;
            var atlas, info, i, ii;
            for (i = 0, ii = atlases.length; i < ii; ++i) {
                atlas = atlases[i];
                info = atlas.add(id, width, height, renderCallback, opt_this);
                if (info) {
                    return info;
                } else if (!info && i === ii - 1) {
                    var size;
                    if (isHitAtlas) {
                        size = Math.min(this.currentHitSize_ * 2, this.maxSize_);
                        this.currentHitSize_ = size;
                    } else {
                        size = Math.min(this.currentSize_ * 2, this.maxSize_);
                        this.currentSize_ = size;
                    }
                    atlas = new _atlas2.default(size, this.space_);
                    atlases.push(atlas);
                    ++ii;
                }
            }
            return null;
        };
        exports.default = _ol_style_AtlasManager_;
    }, {
        "../index.js": 89,
        "../style/atlas.js": 222
    } ],
    224: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _regularshape = require("../style/regularshape.js");
        var _regularshape2 = _interopRequireDefault(_regularshape);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_Circle_ = function(opt_options) {
            var options = opt_options || {};
            _regularshape2.default.call(this, {
                points: Infinity,
                fill: options.fill,
                radius: options.radius,
                snapToPixel: options.snapToPixel,
                stroke: options.stroke,
                atlasManager: options.atlasManager
            });
        };
        _index2.default.inherits(_ol_style_Circle_, _regularshape2.default);
        _ol_style_Circle_.prototype.clone = function() {
            var style = new _ol_style_Circle_({
                fill: this.getFill() ? this.getFill().clone() : undefined,
                stroke: this.getStroke() ? this.getStroke().clone() : undefined,
                radius: this.getRadius(),
                snapToPixel: this.getSnapToPixel(),
                atlasManager: this.atlasManager_
            });
            style.setOpacity(this.getOpacity());
            style.setScale(this.getScale());
            return style;
        };
        _ol_style_Circle_.prototype.setRadius = function(radius) {
            this.radius_ = radius;
            this.render_(this.atlasManager_);
        };
        exports.default = _ol_style_Circle_;
    }, {
        "../index.js": 89,
        "../style/regularshape.js": 232
    } ],
    225: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _color = require("../color.js");
        var _color2 = _interopRequireDefault(_color);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_Fill_ = function(opt_options) {
            var options = opt_options || {};
            this.color_ = options.color !== undefined ? options.color : null;
            this.checksum_ = undefined;
        };
        _ol_style_Fill_.prototype.clone = function() {
            var color = this.getColor();
            return new _ol_style_Fill_({
                color: color && color.slice ? color.slice() : color || undefined
            });
        };
        _ol_style_Fill_.prototype.getColor = function() {
            return this.color_;
        };
        _ol_style_Fill_.prototype.setColor = function(color) {
            this.color_ = color;
            this.checksum_ = undefined;
        };
        _ol_style_Fill_.prototype.getChecksum = function() {
            if (this.checksum_ === undefined) {
                if (this.color_ instanceof CanvasPattern || this.color_ instanceof CanvasGradient) {
                    this.checksum_ = _index2.default.getUid(this.color_).toString();
                } else {
                    this.checksum_ = "f" + (this.color_ ? _color2.default.asString(this.color_) : "-");
                }
            }
            return this.checksum_;
        };
        exports.default = _ol_style_Fill_;
    }, {
        "../color.js": 36,
        "../index.js": 89
    } ],
    226: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _imagestate = require("../imagestate.js");
        var _imagestate2 = _interopRequireDefault(_imagestate);
        var _asserts = require("../asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _color = require("../color.js");
        var _color2 = _interopRequireDefault(_color);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _iconanchorunits = require("../style/iconanchorunits.js");
        var _iconanchorunits2 = _interopRequireDefault(_iconanchorunits);
        var _iconimage = require("../style/iconimage.js");
        var _iconimage2 = _interopRequireDefault(_iconimage);
        var _iconorigin = require("../style/iconorigin.js");
        var _iconorigin2 = _interopRequireDefault(_iconorigin);
        var _image = require("../style/image.js");
        var _image2 = _interopRequireDefault(_image);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_Icon_ = function(opt_options) {
            var options = opt_options || {};
            this.anchor_ = options.anchor !== undefined ? options.anchor : [ .5, .5 ];
            this.normalizedAnchor_ = null;
            this.anchorOrigin_ = options.anchorOrigin !== undefined ? options.anchorOrigin : _iconorigin2.default.TOP_LEFT;
            this.anchorXUnits_ = options.anchorXUnits !== undefined ? options.anchorXUnits : _iconanchorunits2.default.FRACTION;
            this.anchorYUnits_ = options.anchorYUnits !== undefined ? options.anchorYUnits : _iconanchorunits2.default.FRACTION;
            this.crossOrigin_ = options.crossOrigin !== undefined ? options.crossOrigin : null;
            var image = options.img !== undefined ? options.img : null;
            var imgSize = options.imgSize !== undefined ? options.imgSize : null;
            var src = options.src;
            _asserts2.default.assert(!(src !== undefined && image), 4);
            _asserts2.default.assert(!image || image && imgSize, 5);
            if ((src === undefined || src.length === 0) && image) {
                src = image.src || _index2.default.getUid(image).toString();
            }
            _asserts2.default.assert(src !== undefined && src.length > 0, 6);
            var imageState = options.src !== undefined ? _imagestate2.default.IDLE : _imagestate2.default.LOADED;
            this.color_ = options.color !== undefined ? _color2.default.asArray(options.color) : null;
            this.iconImage_ = _iconimage2.default.get(image, src, imgSize, this.crossOrigin_, imageState, this.color_);
            this.offset_ = options.offset !== undefined ? options.offset : [ 0, 0 ];
            this.offsetOrigin_ = options.offsetOrigin !== undefined ? options.offsetOrigin : _iconorigin2.default.TOP_LEFT;
            this.origin_ = null;
            this.size_ = options.size !== undefined ? options.size : null;
            var opacity = options.opacity !== undefined ? options.opacity : 1;
            var rotateWithView = options.rotateWithView !== undefined ? options.rotateWithView : false;
            var rotation = options.rotation !== undefined ? options.rotation : 0;
            var scale = options.scale !== undefined ? options.scale : 1;
            var snapToPixel = options.snapToPixel !== undefined ? options.snapToPixel : true;
            _image2.default.call(this, {
                opacity: opacity,
                rotation: rotation,
                scale: scale,
                snapToPixel: snapToPixel,
                rotateWithView: rotateWithView
            });
        };
        _index2.default.inherits(_ol_style_Icon_, _image2.default);
        _ol_style_Icon_.prototype.clone = function() {
            return new _ol_style_Icon_({
                anchor: this.anchor_.slice(),
                anchorOrigin: this.anchorOrigin_,
                anchorXUnits: this.anchorXUnits_,
                anchorYUnits: this.anchorYUnits_,
                crossOrigin: this.crossOrigin_,
                color: this.color_ && this.color_.slice ? this.color_.slice() : this.color_ || undefined,
                src: this.getSrc(),
                offset: this.offset_.slice(),
                offsetOrigin: this.offsetOrigin_,
                size: this.size_ !== null ? this.size_.slice() : undefined,
                opacity: this.getOpacity(),
                scale: this.getScale(),
                snapToPixel: this.getSnapToPixel(),
                rotation: this.getRotation(),
                rotateWithView: this.getRotateWithView()
            });
        };
        _ol_style_Icon_.prototype.getAnchor = function() {
            if (this.normalizedAnchor_) {
                return this.normalizedAnchor_;
            }
            var anchor = this.anchor_;
            var size = this.getSize();
            if (this.anchorXUnits_ == _iconanchorunits2.default.FRACTION || this.anchorYUnits_ == _iconanchorunits2.default.FRACTION) {
                if (!size) {
                    return null;
                }
                anchor = this.anchor_.slice();
                if (this.anchorXUnits_ == _iconanchorunits2.default.FRACTION) {
                    anchor[0] *= size[0];
                }
                if (this.anchorYUnits_ == _iconanchorunits2.default.FRACTION) {
                    anchor[1] *= size[1];
                }
            }
            if (this.anchorOrigin_ != _iconorigin2.default.TOP_LEFT) {
                if (!size) {
                    return null;
                }
                if (anchor === this.anchor_) {
                    anchor = this.anchor_.slice();
                }
                if (this.anchorOrigin_ == _iconorigin2.default.TOP_RIGHT || this.anchorOrigin_ == _iconorigin2.default.BOTTOM_RIGHT) {
                    anchor[0] = -anchor[0] + size[0];
                }
                if (this.anchorOrigin_ == _iconorigin2.default.BOTTOM_LEFT || this.anchorOrigin_ == _iconorigin2.default.BOTTOM_RIGHT) {
                    anchor[1] = -anchor[1] + size[1];
                }
            }
            this.normalizedAnchor_ = anchor;
            return this.normalizedAnchor_;
        };
        _ol_style_Icon_.prototype.getColor = function() {
            return this.color_;
        };
        _ol_style_Icon_.prototype.getImage = function(pixelRatio) {
            return this.iconImage_.getImage(pixelRatio);
        };
        _ol_style_Icon_.prototype.getImageSize = function() {
            return this.iconImage_.getSize();
        };
        _ol_style_Icon_.prototype.getHitDetectionImageSize = function() {
            return this.getImageSize();
        };
        _ol_style_Icon_.prototype.getImageState = function() {
            return this.iconImage_.getImageState();
        };
        _ol_style_Icon_.prototype.getHitDetectionImage = function(pixelRatio) {
            return this.iconImage_.getHitDetectionImage(pixelRatio);
        };
        _ol_style_Icon_.prototype.getOrigin = function() {
            if (this.origin_) {
                return this.origin_;
            }
            var offset = this.offset_;
            if (this.offsetOrigin_ != _iconorigin2.default.TOP_LEFT) {
                var size = this.getSize();
                var iconImageSize = this.iconImage_.getSize();
                if (!size || !iconImageSize) {
                    return null;
                }
                offset = offset.slice();
                if (this.offsetOrigin_ == _iconorigin2.default.TOP_RIGHT || this.offsetOrigin_ == _iconorigin2.default.BOTTOM_RIGHT) {
                    offset[0] = iconImageSize[0] - size[0] - offset[0];
                }
                if (this.offsetOrigin_ == _iconorigin2.default.BOTTOM_LEFT || this.offsetOrigin_ == _iconorigin2.default.BOTTOM_RIGHT) {
                    offset[1] = iconImageSize[1] - size[1] - offset[1];
                }
            }
            this.origin_ = offset;
            return this.origin_;
        };
        _ol_style_Icon_.prototype.getSrc = function() {
            return this.iconImage_.getSrc();
        };
        _ol_style_Icon_.prototype.getSize = function() {
            return !this.size_ ? this.iconImage_.getSize() : this.size_;
        };
        _ol_style_Icon_.prototype.listenImageChange = function(listener, thisArg) {
            return _events2.default.listen(this.iconImage_, _eventtype2.default.CHANGE, listener, thisArg);
        };
        _ol_style_Icon_.prototype.load = function() {
            this.iconImage_.load();
        };
        _ol_style_Icon_.prototype.unlistenImageChange = function(listener, thisArg) {
            _events2.default.unlisten(this.iconImage_, _eventtype2.default.CHANGE, listener, thisArg);
        };
        exports.default = _ol_style_Icon_;
    }, {
        "../asserts.js": 31,
        "../color.js": 36,
        "../events.js": 48,
        "../events/eventtype.js": 52,
        "../imagestate.js": 88,
        "../index.js": 89,
        "../style/iconanchorunits.js": 227,
        "../style/iconimage.js": 228,
        "../style/iconorigin.js": 230,
        "../style/image.js": 231
    } ],
    227: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_style_IconAnchorUnits_ = {
            FRACTION: "fraction",
            PIXELS: "pixels"
        };
        exports.default = _ol_style_IconAnchorUnits_;
    }, {} ],
    228: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _dom = require("../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtarget = require("../events/eventtarget.js");
        var _eventtarget2 = _interopRequireDefault(_eventtarget);
        var _eventtype = require("../events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _imagestate = require("../imagestate.js");
        var _imagestate2 = _interopRequireDefault(_imagestate);
        var _style = require("../style.js");
        var _style2 = _interopRequireDefault(_style);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_IconImage_ = function(image, src, size, crossOrigin, imageState, color) {
            _eventtarget2.default.call(this);
            this.hitDetectionImage_ = null;
            this.image_ = !image ? new Image() : image;
            if (crossOrigin !== null) {
                this.image_.crossOrigin = crossOrigin;
            }
            this.canvas_ = color ? document.createElement("CANVAS") : null;
            this.color_ = color;
            this.imageListenerKeys_ = null;
            this.imageState_ = imageState;
            this.size_ = size;
            this.src_ = src;
            this.tainting_ = false;
            if (this.imageState_ == _imagestate2.default.LOADED) {
                this.determineTainting_();
            }
        };
        _index2.default.inherits(_ol_style_IconImage_, _eventtarget2.default);
        _ol_style_IconImage_.get = function(image, src, size, crossOrigin, imageState, color) {
            var iconImageCache = _style2.default.iconImageCache;
            var iconImage = iconImageCache.get(src, crossOrigin, color);
            if (!iconImage) {
                iconImage = new _ol_style_IconImage_(image, src, size, crossOrigin, imageState, color);
                iconImageCache.set(src, crossOrigin, color, iconImage);
            }
            return iconImage;
        };
        _ol_style_IconImage_.prototype.determineTainting_ = function() {
            var context = _dom2.default.createCanvasContext2D(1, 1);
            try {
                context.drawImage(this.image_, 0, 0);
                context.getImageData(0, 0, 1, 1);
            } catch (e) {
                this.tainting_ = true;
            }
        };
        _ol_style_IconImage_.prototype.dispatchChangeEvent_ = function() {
            this.dispatchEvent(_eventtype2.default.CHANGE);
        };
        _ol_style_IconImage_.prototype.handleImageError_ = function() {
            this.imageState_ = _imagestate2.default.ERROR;
            this.unlistenImage_();
            this.dispatchChangeEvent_();
        };
        _ol_style_IconImage_.prototype.handleImageLoad_ = function() {
            this.imageState_ = _imagestate2.default.LOADED;
            if (this.size_) {
                this.image_.width = this.size_[0];
                this.image_.height = this.size_[1];
            }
            this.size_ = [ this.image_.width, this.image_.height ];
            this.unlistenImage_();
            this.determineTainting_();
            this.replaceColor_();
            this.dispatchChangeEvent_();
        };
        _ol_style_IconImage_.prototype.getImage = function(pixelRatio) {
            return this.canvas_ ? this.canvas_ : this.image_;
        };
        _ol_style_IconImage_.prototype.getImageState = function() {
            return this.imageState_;
        };
        _ol_style_IconImage_.prototype.getHitDetectionImage = function(pixelRatio) {
            if (!this.hitDetectionImage_) {
                if (this.tainting_) {
                    var width = this.size_[0];
                    var height = this.size_[1];
                    var context = _dom2.default.createCanvasContext2D(width, height);
                    context.fillRect(0, 0, width, height);
                    this.hitDetectionImage_ = context.canvas;
                } else {
                    this.hitDetectionImage_ = this.image_;
                }
            }
            return this.hitDetectionImage_;
        };
        _ol_style_IconImage_.prototype.getSize = function() {
            return this.size_;
        };
        _ol_style_IconImage_.prototype.getSrc = function() {
            return this.src_;
        };
        _ol_style_IconImage_.prototype.load = function() {
            if (this.imageState_ == _imagestate2.default.IDLE) {
                this.imageState_ = _imagestate2.default.LOADING;
                this.imageListenerKeys_ = [ _events2.default.listenOnce(this.image_, _eventtype2.default.ERROR, this.handleImageError_, this), _events2.default.listenOnce(this.image_, _eventtype2.default.LOAD, this.handleImageLoad_, this) ];
                try {
                    this.image_.src = this.src_;
                } catch (e) {
                    this.handleImageError_();
                }
            }
        };
        _ol_style_IconImage_.prototype.replaceColor_ = function() {
            if (this.tainting_ || this.color_ === null) {
                return;
            }
            this.canvas_.width = this.image_.width;
            this.canvas_.height = this.image_.height;
            var ctx = this.canvas_.getContext("2d");
            ctx.drawImage(this.image_, 0, 0);
            var imgData = ctx.getImageData(0, 0, this.image_.width, this.image_.height);
            var data = imgData.data;
            var r = this.color_[0] / 255;
            var g = this.color_[1] / 255;
            var b = this.color_[2] / 255;
            for (var i = 0, ii = data.length; i < ii; i += 4) {
                data[i] *= r;
                data[i + 1] *= g;
                data[i + 2] *= b;
            }
            ctx.putImageData(imgData, 0, 0);
        };
        _ol_style_IconImage_.prototype.unlistenImage_ = function() {
            this.imageListenerKeys_.forEach(_events2.default.unlistenByKey);
            this.imageListenerKeys_ = null;
        };
        exports.default = _ol_style_IconImage_;
    }, {
        "../dom.js": 46,
        "../events.js": 48,
        "../events/eventtarget.js": 51,
        "../events/eventtype.js": 52,
        "../imagestate.js": 88,
        "../index.js": 89,
        "../style.js": 221
    } ],
    229: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _color = require("../color.js");
        var _color2 = _interopRequireDefault(_color);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_IconImageCache_ = function() {
            this.cache_ = {};
            this.cacheSize_ = 0;
            this.maxCacheSize_ = 32;
        };
        _ol_style_IconImageCache_.getKey = function(src, crossOrigin, color) {
            var colorString = color ? _color2.default.asString(color) : "null";
            return crossOrigin + ":" + src + ":" + colorString;
        };
        _ol_style_IconImageCache_.prototype.clear = function() {
            this.cache_ = {};
            this.cacheSize_ = 0;
        };
        _ol_style_IconImageCache_.prototype.expire = function() {
            if (this.cacheSize_ > this.maxCacheSize_) {
                var i = 0;
                var key, iconImage;
                for (key in this.cache_) {
                    iconImage = this.cache_[key];
                    if ((i++ & 3) === 0 && !iconImage.hasListener()) {
                        delete this.cache_[key];
                        --this.cacheSize_;
                    }
                }
            }
        };
        _ol_style_IconImageCache_.prototype.get = function(src, crossOrigin, color) {
            var key = _ol_style_IconImageCache_.getKey(src, crossOrigin, color);
            return key in this.cache_ ? this.cache_[key] : null;
        };
        _ol_style_IconImageCache_.prototype.set = function(src, crossOrigin, color, iconImage) {
            var key = _ol_style_IconImageCache_.getKey(src, crossOrigin, color);
            this.cache_[key] = iconImage;
            ++this.cacheSize_;
        };
        _ol_style_IconImageCache_.prototype.setSize = function(maxCacheSize) {
            this.maxCacheSize_ = maxCacheSize;
            this.expire();
        };
        exports.default = _ol_style_IconImageCache_;
    }, {
        "../color.js": 36
    } ],
    230: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_style_IconOrigin_ = {
            BOTTOM_LEFT: "bottom-left",
            BOTTOM_RIGHT: "bottom-right",
            TOP_LEFT: "top-left",
            TOP_RIGHT: "top-right"
        };
        exports.default = _ol_style_IconOrigin_;
    }, {} ],
    231: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_style_Image_ = function(options) {
            this.opacity_ = options.opacity;
            this.rotateWithView_ = options.rotateWithView;
            this.rotation_ = options.rotation;
            this.scale_ = options.scale;
            this.snapToPixel_ = options.snapToPixel;
        };
        _ol_style_Image_.prototype.getOpacity = function() {
            return this.opacity_;
        };
        _ol_style_Image_.prototype.getRotateWithView = function() {
            return this.rotateWithView_;
        };
        _ol_style_Image_.prototype.getRotation = function() {
            return this.rotation_;
        };
        _ol_style_Image_.prototype.getScale = function() {
            return this.scale_;
        };
        _ol_style_Image_.prototype.getSnapToPixel = function() {
            return this.snapToPixel_;
        };
        _ol_style_Image_.prototype.getAnchor = function() {};
        _ol_style_Image_.prototype.getImage = function(pixelRatio) {};
        _ol_style_Image_.prototype.getHitDetectionImage = function(pixelRatio) {};
        _ol_style_Image_.prototype.getImageState = function() {};
        _ol_style_Image_.prototype.getImageSize = function() {};
        _ol_style_Image_.prototype.getHitDetectionImageSize = function() {};
        _ol_style_Image_.prototype.getOrigin = function() {};
        _ol_style_Image_.prototype.getSize = function() {};
        _ol_style_Image_.prototype.setOpacity = function(opacity) {
            this.opacity_ = opacity;
        };
        _ol_style_Image_.prototype.setRotateWithView = function(rotateWithView) {
            this.rotateWithView_ = rotateWithView;
        };
        _ol_style_Image_.prototype.setRotation = function(rotation) {
            this.rotation_ = rotation;
        };
        _ol_style_Image_.prototype.setScale = function(scale) {
            this.scale_ = scale;
        };
        _ol_style_Image_.prototype.setSnapToPixel = function(snapToPixel) {
            this.snapToPixel_ = snapToPixel;
        };
        _ol_style_Image_.prototype.listenImageChange = function(listener, thisArg) {};
        _ol_style_Image_.prototype.load = function() {};
        _ol_style_Image_.prototype.unlistenImageChange = function(listener, thisArg) {};
        exports.default = _ol_style_Image_;
    }, {} ],
    232: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _colorlike = require("../colorlike.js");
        var _colorlike2 = _interopRequireDefault(_colorlike);
        var _dom = require("../dom.js");
        var _dom2 = _interopRequireDefault(_dom);
        var _has = require("../has.js");
        var _has2 = _interopRequireDefault(_has);
        var _imagestate = require("../imagestate.js");
        var _imagestate2 = _interopRequireDefault(_imagestate);
        var _canvas = require("../render/canvas.js");
        var _canvas2 = _interopRequireDefault(_canvas);
        var _image = require("../style/image.js");
        var _image2 = _interopRequireDefault(_image);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_RegularShape_ = function(options) {
            this.checksums_ = null;
            this.canvas_ = null;
            this.hitDetectionCanvas_ = null;
            this.fill_ = options.fill !== undefined ? options.fill : null;
            this.origin_ = [ 0, 0 ];
            this.points_ = options.points;
            this.radius_ = options.radius !== undefined ? options.radius : options.radius1;
            this.radius2_ = options.radius2;
            this.angle_ = options.angle !== undefined ? options.angle : 0;
            this.stroke_ = options.stroke !== undefined ? options.stroke : null;
            this.anchor_ = null;
            this.size_ = null;
            this.imageSize_ = null;
            this.hitDetectionImageSize_ = null;
            this.atlasManager_ = options.atlasManager;
            this.render_(this.atlasManager_);
            var snapToPixel = options.snapToPixel !== undefined ? options.snapToPixel : true;
            var rotateWithView = options.rotateWithView !== undefined ? options.rotateWithView : false;
            _image2.default.call(this, {
                opacity: 1,
                rotateWithView: rotateWithView,
                rotation: options.rotation !== undefined ? options.rotation : 0,
                scale: 1,
                snapToPixel: snapToPixel
            });
        };
        _index2.default.inherits(_ol_style_RegularShape_, _image2.default);
        _ol_style_RegularShape_.prototype.clone = function() {
            var style = new _ol_style_RegularShape_({
                fill: this.getFill() ? this.getFill().clone() : undefined,
                points: this.getPoints(),
                radius: this.getRadius(),
                radius2: this.getRadius2(),
                angle: this.getAngle(),
                snapToPixel: this.getSnapToPixel(),
                stroke: this.getStroke() ? this.getStroke().clone() : undefined,
                rotation: this.getRotation(),
                rotateWithView: this.getRotateWithView(),
                atlasManager: this.atlasManager_
            });
            style.setOpacity(this.getOpacity());
            style.setScale(this.getScale());
            return style;
        };
        _ol_style_RegularShape_.prototype.getAnchor = function() {
            return this.anchor_;
        };
        _ol_style_RegularShape_.prototype.getAngle = function() {
            return this.angle_;
        };
        _ol_style_RegularShape_.prototype.getFill = function() {
            return this.fill_;
        };
        _ol_style_RegularShape_.prototype.getHitDetectionImage = function(pixelRatio) {
            return this.hitDetectionCanvas_;
        };
        _ol_style_RegularShape_.prototype.getImage = function(pixelRatio) {
            return this.canvas_;
        };
        _ol_style_RegularShape_.prototype.getImageSize = function() {
            return this.imageSize_;
        };
        _ol_style_RegularShape_.prototype.getHitDetectionImageSize = function() {
            return this.hitDetectionImageSize_;
        };
        _ol_style_RegularShape_.prototype.getImageState = function() {
            return _imagestate2.default.LOADED;
        };
        _ol_style_RegularShape_.prototype.getOrigin = function() {
            return this.origin_;
        };
        _ol_style_RegularShape_.prototype.getPoints = function() {
            return this.points_;
        };
        _ol_style_RegularShape_.prototype.getRadius = function() {
            return this.radius_;
        };
        _ol_style_RegularShape_.prototype.getRadius2 = function() {
            return this.radius2_;
        };
        _ol_style_RegularShape_.prototype.getSize = function() {
            return this.size_;
        };
        _ol_style_RegularShape_.prototype.getStroke = function() {
            return this.stroke_;
        };
        _ol_style_RegularShape_.prototype.listenImageChange = function(listener, thisArg) {};
        _ol_style_RegularShape_.prototype.load = function() {};
        _ol_style_RegularShape_.prototype.unlistenImageChange = function(listener, thisArg) {};
        _ol_style_RegularShape_.prototype.render_ = function(atlasManager) {
            var imageSize;
            var lineCap = "";
            var lineJoin = "";
            var miterLimit = 0;
            var lineDash = null;
            var lineDashOffset = 0;
            var strokeStyle;
            var strokeWidth = 0;
            if (this.stroke_) {
                strokeStyle = this.stroke_.getColor();
                if (strokeStyle === null) {
                    strokeStyle = _canvas2.default.defaultStrokeStyle;
                }
                strokeStyle = _colorlike2.default.asColorLike(strokeStyle);
                strokeWidth = this.stroke_.getWidth();
                if (strokeWidth === undefined) {
                    strokeWidth = _canvas2.default.defaultLineWidth;
                }
                lineDash = this.stroke_.getLineDash();
                lineDashOffset = this.stroke_.getLineDashOffset();
                if (!_has2.default.CANVAS_LINE_DASH) {
                    lineDash = null;
                    lineDashOffset = 0;
                }
                lineJoin = this.stroke_.getLineJoin();
                if (lineJoin === undefined) {
                    lineJoin = _canvas2.default.defaultLineJoin;
                }
                lineCap = this.stroke_.getLineCap();
                if (lineCap === undefined) {
                    lineCap = _canvas2.default.defaultLineCap;
                }
                miterLimit = this.stroke_.getMiterLimit();
                if (miterLimit === undefined) {
                    miterLimit = _canvas2.default.defaultMiterLimit;
                }
            }
            var size = 2 * (this.radius_ + strokeWidth) + 1;
            var renderOptions = {
                strokeStyle: strokeStyle,
                strokeWidth: strokeWidth,
                size: size,
                lineCap: lineCap,
                lineDash: lineDash,
                lineDashOffset: lineDashOffset,
                lineJoin: lineJoin,
                miterLimit: miterLimit
            };
            if (atlasManager === undefined) {
                var context = _dom2.default.createCanvasContext2D(size, size);
                this.canvas_ = context.canvas;
                size = this.canvas_.width;
                imageSize = size;
                this.draw_(renderOptions, context, 0, 0);
                this.createHitDetectionCanvas_(renderOptions);
            } else {
                size = Math.round(size);
                var hasCustomHitDetectionImage = !this.fill_;
                var renderHitDetectionCallback;
                if (hasCustomHitDetectionImage) {
                    renderHitDetectionCallback = this.drawHitDetectionCanvas_.bind(this, renderOptions);
                }
                var id = this.getChecksum();
                var info = atlasManager.add(id, size, size, this.draw_.bind(this, renderOptions), renderHitDetectionCallback);
                this.canvas_ = info.image;
                this.origin_ = [ info.offsetX, info.offsetY ];
                imageSize = info.image.width;
                if (hasCustomHitDetectionImage) {
                    this.hitDetectionCanvas_ = info.hitImage;
                    this.hitDetectionImageSize_ = [ info.hitImage.width, info.hitImage.height ];
                } else {
                    this.hitDetectionCanvas_ = this.canvas_;
                    this.hitDetectionImageSize_ = [ imageSize, imageSize ];
                }
            }
            this.anchor_ = [ size / 2, size / 2 ];
            this.size_ = [ size, size ];
            this.imageSize_ = [ imageSize, imageSize ];
        };
        _ol_style_RegularShape_.prototype.draw_ = function(renderOptions, context, x, y) {
            var i, angle0, radiusC;
            context.setTransform(1, 0, 0, 1, 0, 0);
            context.translate(x, y);
            context.beginPath();
            var points = this.points_;
            if (points === Infinity) {
                context.arc(renderOptions.size / 2, renderOptions.size / 2, this.radius_, 0, 2 * Math.PI, true);
            } else {
                var radius2 = this.radius2_ !== undefined ? this.radius2_ : this.radius_;
                if (radius2 !== this.radius_) {
                    points = 2 * points;
                }
                for (i = 0; i <= points; i++) {
                    angle0 = i * 2 * Math.PI / points - Math.PI / 2 + this.angle_;
                    radiusC = i % 2 === 0 ? this.radius_ : radius2;
                    context.lineTo(renderOptions.size / 2 + radiusC * Math.cos(angle0), renderOptions.size / 2 + radiusC * Math.sin(angle0));
                }
            }
            if (this.fill_) {
                var color = this.fill_.getColor();
                if (color === null) {
                    color = _canvas2.default.defaultFillStyle;
                }
                context.fillStyle = _colorlike2.default.asColorLike(color);
                context.fill();
            }
            if (this.stroke_) {
                context.strokeStyle = renderOptions.strokeStyle;
                context.lineWidth = renderOptions.strokeWidth;
                if (renderOptions.lineDash) {
                    context.setLineDash(renderOptions.lineDash);
                    context.lineDashOffset = renderOptions.lineDashOffset;
                }
                context.lineCap = renderOptions.lineCap;
                context.lineJoin = renderOptions.lineJoin;
                context.miterLimit = renderOptions.miterLimit;
                context.stroke();
            }
            context.closePath();
        };
        _ol_style_RegularShape_.prototype.createHitDetectionCanvas_ = function(renderOptions) {
            this.hitDetectionImageSize_ = [ renderOptions.size, renderOptions.size ];
            if (this.fill_) {
                this.hitDetectionCanvas_ = this.canvas_;
                return;
            }
            var context = _dom2.default.createCanvasContext2D(renderOptions.size, renderOptions.size);
            this.hitDetectionCanvas_ = context.canvas;
            this.drawHitDetectionCanvas_(renderOptions, context, 0, 0);
        };
        _ol_style_RegularShape_.prototype.drawHitDetectionCanvas_ = function(renderOptions, context, x, y) {
            context.setTransform(1, 0, 0, 1, 0, 0);
            context.translate(x, y);
            context.beginPath();
            var points = this.points_;
            if (points === Infinity) {
                context.arc(renderOptions.size / 2, renderOptions.size / 2, this.radius_, 0, 2 * Math.PI, true);
            } else {
                var radius2 = this.radius2_ !== undefined ? this.radius2_ : this.radius_;
                if (radius2 !== this.radius_) {
                    points = 2 * points;
                }
                var i, radiusC, angle0;
                for (i = 0; i <= points; i++) {
                    angle0 = i * 2 * Math.PI / points - Math.PI / 2 + this.angle_;
                    radiusC = i % 2 === 0 ? this.radius_ : radius2;
                    context.lineTo(renderOptions.size / 2 + radiusC * Math.cos(angle0), renderOptions.size / 2 + radiusC * Math.sin(angle0));
                }
            }
            context.fillStyle = _canvas2.default.defaultFillStyle;
            context.fill();
            if (this.stroke_) {
                context.strokeStyle = renderOptions.strokeStyle;
                context.lineWidth = renderOptions.strokeWidth;
                if (renderOptions.lineDash) {
                    context.setLineDash(renderOptions.lineDash);
                    context.lineDashOffset = renderOptions.lineDashOffset;
                }
                context.stroke();
            }
            context.closePath();
        };
        _ol_style_RegularShape_.prototype.getChecksum = function() {
            var strokeChecksum = this.stroke_ ? this.stroke_.getChecksum() : "-";
            var fillChecksum = this.fill_ ? this.fill_.getChecksum() : "-";
            var recalculate = !this.checksums_ || strokeChecksum != this.checksums_[1] || fillChecksum != this.checksums_[2] || this.radius_ != this.checksums_[3] || this.radius2_ != this.checksums_[4] || this.angle_ != this.checksums_[5] || this.points_ != this.checksums_[6];
            if (recalculate) {
                var checksum = "r" + strokeChecksum + fillChecksum + (this.radius_ !== undefined ? this.radius_.toString() : "-") + (this.radius2_ !== undefined ? this.radius2_.toString() : "-") + (this.angle_ !== undefined ? this.angle_.toString() : "-") + (this.points_ !== undefined ? this.points_.toString() : "-");
                this.checksums_ = [ checksum, strokeChecksum, fillChecksum, this.radius_, this.radius2_, this.angle_, this.points_ ];
            }
            return this.checksums_[0];
        };
        exports.default = _ol_style_RegularShape_;
    }, {
        "../colorlike.js": 37,
        "../dom.js": 46,
        "../has.js": 84,
        "../imagestate.js": 88,
        "../index.js": 89,
        "../render/canvas.js": 150,
        "../style/image.js": 231
    } ],
    233: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_Stroke_ = function(opt_options) {
            var options = opt_options || {};
            this.color_ = options.color !== undefined ? options.color : null;
            this.lineCap_ = options.lineCap;
            this.lineDash_ = options.lineDash !== undefined ? options.lineDash : null;
            this.lineDashOffset_ = options.lineDashOffset;
            this.lineJoin_ = options.lineJoin;
            this.miterLimit_ = options.miterLimit;
            this.width_ = options.width;
            this.checksum_ = undefined;
        };
        _ol_style_Stroke_.prototype.clone = function() {
            var color = this.getColor();
            return new _ol_style_Stroke_({
                color: color && color.slice ? color.slice() : color || undefined,
                lineCap: this.getLineCap(),
                lineDash: this.getLineDash() ? this.getLineDash().slice() : undefined,
                lineDashOffset: this.getLineDashOffset(),
                lineJoin: this.getLineJoin(),
                miterLimit: this.getMiterLimit(),
                width: this.getWidth()
            });
        };
        _ol_style_Stroke_.prototype.getColor = function() {
            return this.color_;
        };
        _ol_style_Stroke_.prototype.getLineCap = function() {
            return this.lineCap_;
        };
        _ol_style_Stroke_.prototype.getLineDash = function() {
            return this.lineDash_;
        };
        _ol_style_Stroke_.prototype.getLineDashOffset = function() {
            return this.lineDashOffset_;
        };
        _ol_style_Stroke_.prototype.getLineJoin = function() {
            return this.lineJoin_;
        };
        _ol_style_Stroke_.prototype.getMiterLimit = function() {
            return this.miterLimit_;
        };
        _ol_style_Stroke_.prototype.getWidth = function() {
            return this.width_;
        };
        _ol_style_Stroke_.prototype.setColor = function(color) {
            this.color_ = color;
            this.checksum_ = undefined;
        };
        _ol_style_Stroke_.prototype.setLineCap = function(lineCap) {
            this.lineCap_ = lineCap;
            this.checksum_ = undefined;
        };
        _ol_style_Stroke_.prototype.setLineDash = function(lineDash) {
            this.lineDash_ = lineDash;
            this.checksum_ = undefined;
        };
        _ol_style_Stroke_.prototype.setLineDashOffset = function(lineDashOffset) {
            this.lineDashOffset_ = lineDashOffset;
            this.checksum_ = undefined;
        };
        _ol_style_Stroke_.prototype.setLineJoin = function(lineJoin) {
            this.lineJoin_ = lineJoin;
            this.checksum_ = undefined;
        };
        _ol_style_Stroke_.prototype.setMiterLimit = function(miterLimit) {
            this.miterLimit_ = miterLimit;
            this.checksum_ = undefined;
        };
        _ol_style_Stroke_.prototype.setWidth = function(width) {
            this.width_ = width;
            this.checksum_ = undefined;
        };
        _ol_style_Stroke_.prototype.getChecksum = function() {
            if (this.checksum_ === undefined) {
                this.checksum_ = "s";
                if (this.color_) {
                    if (typeof this.color_ === "string") {
                        this.checksum_ += this.color_;
                    } else {
                        this.checksum_ += _index2.default.getUid(this.color_).toString();
                    }
                } else {
                    this.checksum_ += "-";
                }
                this.checksum_ += "," + (this.lineCap_ !== undefined ? this.lineCap_.toString() : "-") + "," + (this.lineDash_ ? this.lineDash_.toString() : "-") + "," + (this.lineDashOffset_ !== undefined ? this.lineDashOffset_ : "-") + "," + (this.lineJoin_ !== undefined ? this.lineJoin_ : "-") + "," + (this.miterLimit_ !== undefined ? this.miterLimit_.toString() : "-") + "," + (this.width_ !== undefined ? this.width_.toString() : "-");
            }
            return this.checksum_;
        };
        exports.default = _ol_style_Stroke_;
    }, {
        "../index.js": 89
    } ],
    234: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _asserts = require("../asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _geometrytype = require("../geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _circle = require("../style/circle.js");
        var _circle2 = _interopRequireDefault(_circle);
        var _fill = require("../style/fill.js");
        var _fill2 = _interopRequireDefault(_fill);
        var _stroke = require("../style/stroke.js");
        var _stroke2 = _interopRequireDefault(_stroke);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_Style_ = function(opt_options) {
            var options = opt_options || {};
            this.geometry_ = null;
            this.geometryFunction_ = _ol_style_Style_.defaultGeometryFunction;
            if (options.geometry !== undefined) {
                this.setGeometry(options.geometry);
            }
            this.fill_ = options.fill !== undefined ? options.fill : null;
            this.image_ = options.image !== undefined ? options.image : null;
            this.renderer_ = options.renderer !== undefined ? options.renderer : null;
            this.stroke_ = options.stroke !== undefined ? options.stroke : null;
            this.text_ = options.text !== undefined ? options.text : null;
            this.zIndex_ = options.zIndex;
        };
        _ol_style_Style_.prototype.clone = function() {
            var geometry = this.getGeometry();
            if (geometry && geometry.clone) {
                geometry = geometry.clone();
            }
            return new _ol_style_Style_({
                geometry: geometry,
                fill: this.getFill() ? this.getFill().clone() : undefined,
                image: this.getImage() ? this.getImage().clone() : undefined,
                stroke: this.getStroke() ? this.getStroke().clone() : undefined,
                text: this.getText() ? this.getText().clone() : undefined,
                zIndex: this.getZIndex()
            });
        };
        _ol_style_Style_.prototype.getRenderer = function() {
            return this.renderer_;
        };
        _ol_style_Style_.prototype.setRenderer = function(renderer) {
            this.renderer_ = renderer;
        };
        _ol_style_Style_.prototype.getGeometry = function() {
            return this.geometry_;
        };
        _ol_style_Style_.prototype.getGeometryFunction = function() {
            return this.geometryFunction_;
        };
        _ol_style_Style_.prototype.getFill = function() {
            return this.fill_;
        };
        _ol_style_Style_.prototype.setFill = function(fill) {
            this.fill_ = fill;
        };
        _ol_style_Style_.prototype.getImage = function() {
            return this.image_;
        };
        _ol_style_Style_.prototype.setImage = function(image) {
            this.image_ = image;
        };
        _ol_style_Style_.prototype.getStroke = function() {
            return this.stroke_;
        };
        _ol_style_Style_.prototype.setStroke = function(stroke) {
            this.stroke_ = stroke;
        };
        _ol_style_Style_.prototype.getText = function() {
            return this.text_;
        };
        _ol_style_Style_.prototype.setText = function(text) {
            this.text_ = text;
        };
        _ol_style_Style_.prototype.getZIndex = function() {
            return this.zIndex_;
        };
        _ol_style_Style_.prototype.setGeometry = function(geometry) {
            if (typeof geometry === "function") {
                this.geometryFunction_ = geometry;
            } else if (typeof geometry === "string") {
                this.geometryFunction_ = function(feature) {
                    return feature.get(geometry);
                };
            } else if (!geometry) {
                this.geometryFunction_ = _ol_style_Style_.defaultGeometryFunction;
            } else if (geometry !== undefined) {
                this.geometryFunction_ = function() {
                    return geometry;
                };
            }
            this.geometry_ = geometry;
        };
        _ol_style_Style_.prototype.setZIndex = function(zIndex) {
            this.zIndex_ = zIndex;
        };
        _ol_style_Style_.createFunction = function(obj) {
            var styleFunction;
            if (typeof obj === "function") {
                styleFunction = obj;
            } else {
                var styles;
                if (Array.isArray(obj)) {
                    styles = obj;
                } else {
                    _asserts2.default.assert(obj instanceof _ol_style_Style_, 41);
                    styles = [ obj ];
                }
                styleFunction = function() {
                    return styles;
                };
            }
            return styleFunction;
        };
        _ol_style_Style_.default_ = null;
        _ol_style_Style_.defaultFunction = function(feature, resolution) {
            if (!_ol_style_Style_.default_) {
                var fill = new _fill2.default({
                    color: "rgba(255,255,255,0.4)"
                });
                var stroke = new _stroke2.default({
                    color: "#3399CC",
                    width: 1.25
                });
                _ol_style_Style_.default_ = [ new _ol_style_Style_({
                    image: new _circle2.default({
                        fill: fill,
                        stroke: stroke,
                        radius: 5
                    }),
                    fill: fill,
                    stroke: stroke
                }) ];
            }
            return _ol_style_Style_.default_;
        };
        _ol_style_Style_.createDefaultEditing = function() {
            var styles = {};
            var white = [ 255, 255, 255, 1 ];
            var blue = [ 0, 153, 255, 1 ];
            var width = 3;
            styles[_geometrytype2.default.POLYGON] = [ new _ol_style_Style_({
                fill: new _fill2.default({
                    color: [ 255, 255, 255, .5 ]
                })
            }) ];
            styles[_geometrytype2.default.MULTI_POLYGON] = styles[_geometrytype2.default.POLYGON];
            styles[_geometrytype2.default.LINE_STRING] = [ new _ol_style_Style_({
                stroke: new _stroke2.default({
                    color: white,
                    width: width + 2
                })
            }), new _ol_style_Style_({
                stroke: new _stroke2.default({
                    color: blue,
                    width: width
                })
            }) ];
            styles[_geometrytype2.default.MULTI_LINE_STRING] = styles[_geometrytype2.default.LINE_STRING];
            styles[_geometrytype2.default.CIRCLE] = styles[_geometrytype2.default.POLYGON].concat(styles[_geometrytype2.default.LINE_STRING]);
            styles[_geometrytype2.default.POINT] = [ new _ol_style_Style_({
                image: new _circle2.default({
                    radius: width * 2,
                    fill: new _fill2.default({
                        color: blue
                    }),
                    stroke: new _stroke2.default({
                        color: white,
                        width: width / 2
                    })
                }),
                zIndex: Infinity
            }) ];
            styles[_geometrytype2.default.MULTI_POINT] = styles[_geometrytype2.default.POINT];
            styles[_geometrytype2.default.GEOMETRY_COLLECTION] = styles[_geometrytype2.default.POLYGON].concat(styles[_geometrytype2.default.LINE_STRING], styles[_geometrytype2.default.POINT]);
            return styles;
        };
        _ol_style_Style_.defaultGeometryFunction = function(feature) {
            return feature.getGeometry();
        };
        exports.default = _ol_style_Style_;
    }, {
        "../asserts.js": 31,
        "../geom/geometrytype.js": 79,
        "../style/circle.js": 224,
        "../style/fill.js": 225,
        "../style/stroke.js": 233
    } ],
    235: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _fill = require("../style/fill.js");
        var _fill2 = _interopRequireDefault(_fill);
        var _textplacement = require("../style/textplacement.js");
        var _textplacement2 = _interopRequireDefault(_textplacement);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_style_Text_ = function(opt_options) {
            var options = opt_options || {};
            this.font_ = options.font;
            this.rotation_ = options.rotation;
            this.rotateWithView_ = options.rotateWithView;
            this.scale_ = options.scale;
            this.text_ = options.text;
            this.textAlign_ = options.textAlign;
            this.textBaseline_ = options.textBaseline;
            this.fill_ = options.fill !== undefined ? options.fill : new _fill2.default({
                color: _ol_style_Text_.DEFAULT_FILL_COLOR_
            });
            this.maxAngle_ = options.maxAngle !== undefined ? options.maxAngle : Math.PI / 4;
            this.placement_ = options.placement !== undefined ? options.placement : _textplacement2.default.POINT;
            var overflow = options.overflow === undefined ? options.exceedLength : options.overflow;
            this.overflow_ = overflow !== undefined ? overflow : false;
            this.stroke_ = options.stroke !== undefined ? options.stroke : null;
            this.offsetX_ = options.offsetX !== undefined ? options.offsetX : 0;
            this.offsetY_ = options.offsetY !== undefined ? options.offsetY : 0;
            this.backgroundFill_ = options.backgroundFill ? options.backgroundFill : null;
            this.backgroundStroke_ = options.backgroundStroke ? options.backgroundStroke : null;
            this.padding_ = options.padding === undefined ? null : options.padding;
        };
        _ol_style_Text_.DEFAULT_FILL_COLOR_ = "#333";
        _ol_style_Text_.prototype.clone = function() {
            return new _ol_style_Text_({
                font: this.getFont(),
                placement: this.getPlacement(),
                maxAngle: this.getMaxAngle(),
                overflow: this.getOverflow(),
                rotation: this.getRotation(),
                rotateWithView: this.getRotateWithView(),
                scale: this.getScale(),
                text: this.getText(),
                textAlign: this.getTextAlign(),
                textBaseline: this.getTextBaseline(),
                fill: this.getFill() ? this.getFill().clone() : undefined,
                stroke: this.getStroke() ? this.getStroke().clone() : undefined,
                offsetX: this.getOffsetX(),
                offsetY: this.getOffsetY()
            });
        };
        _ol_style_Text_.prototype.getOverflow = function() {
            return this.overflow_;
        };
        _ol_style_Text_.prototype.getFont = function() {
            return this.font_;
        };
        _ol_style_Text_.prototype.getMaxAngle = function() {
            return this.maxAngle_;
        };
        _ol_style_Text_.prototype.getPlacement = function() {
            return this.placement_;
        };
        _ol_style_Text_.prototype.getOffsetX = function() {
            return this.offsetX_;
        };
        _ol_style_Text_.prototype.getOffsetY = function() {
            return this.offsetY_;
        };
        _ol_style_Text_.prototype.getFill = function() {
            return this.fill_;
        };
        _ol_style_Text_.prototype.getRotateWithView = function() {
            return this.rotateWithView_;
        };
        _ol_style_Text_.prototype.getRotation = function() {
            return this.rotation_;
        };
        _ol_style_Text_.prototype.getScale = function() {
            return this.scale_;
        };
        _ol_style_Text_.prototype.getStroke = function() {
            return this.stroke_;
        };
        _ol_style_Text_.prototype.getText = function() {
            return this.text_;
        };
        _ol_style_Text_.prototype.getTextAlign = function() {
            return this.textAlign_;
        };
        _ol_style_Text_.prototype.getTextBaseline = function() {
            return this.textBaseline_;
        };
        _ol_style_Text_.prototype.getBackgroundFill = function() {
            return this.backgroundFill_;
        };
        _ol_style_Text_.prototype.getBackgroundStroke = function() {
            return this.backgroundStroke_;
        };
        _ol_style_Text_.prototype.getPadding = function() {
            return this.padding_;
        };
        _ol_style_Text_.prototype.setOverflow = function(overflow) {
            this.overflow_ = overflow;
        };
        _ol_style_Text_.prototype.setFont = function(font) {
            this.font_ = font;
        };
        _ol_style_Text_.prototype.setMaxAngle = function(maxAngle) {
            this.maxAngle_ = maxAngle;
        };
        _ol_style_Text_.prototype.setOffsetX = function(offsetX) {
            this.offsetX_ = offsetX;
        };
        _ol_style_Text_.prototype.setOffsetY = function(offsetY) {
            this.offsetY_ = offsetY;
        };
        _ol_style_Text_.prototype.setPlacement = function(placement) {
            this.placement_ = placement;
        };
        _ol_style_Text_.prototype.setFill = function(fill) {
            this.fill_ = fill;
        };
        _ol_style_Text_.prototype.setRotation = function(rotation) {
            this.rotation_ = rotation;
        };
        _ol_style_Text_.prototype.setScale = function(scale) {
            this.scale_ = scale;
        };
        _ol_style_Text_.prototype.setStroke = function(stroke) {
            this.stroke_ = stroke;
        };
        _ol_style_Text_.prototype.setText = function(text) {
            this.text_ = text;
        };
        _ol_style_Text_.prototype.setTextAlign = function(textAlign) {
            this.textAlign_ = textAlign;
        };
        _ol_style_Text_.prototype.setTextBaseline = function(textBaseline) {
            this.textBaseline_ = textBaseline;
        };
        _ol_style_Text_.prototype.setBackgroundFill = function(fill) {
            this.backgroundFill_ = fill;
        };
        _ol_style_Text_.prototype.setBackgroundStroke = function(stroke) {
            this.backgroundStroke_ = stroke;
        };
        _ol_style_Text_.prototype.setPadding = function(padding) {
            this.padding_ = padding;
        };
        exports.default = _ol_style_Text_;
    }, {
        "../style/fill.js": 225,
        "../style/textplacement.js": 236
    } ],
    236: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_style_TextPlacement_ = {
            POINT: "point",
            LINE: "line"
        };
        exports.default = _ol_style_TextPlacement_;
    }, {} ],
    237: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_tilecoord_ = {};
        _ol_tilecoord_.createOrUpdate = function(z, x, y, opt_tileCoord) {
            if (opt_tileCoord !== undefined) {
                opt_tileCoord[0] = z;
                opt_tileCoord[1] = x;
                opt_tileCoord[2] = y;
                return opt_tileCoord;
            } else {
                return [ z, x, y ];
            }
        };
        _ol_tilecoord_.getKeyZXY = function(z, x, y) {
            return z + "/" + x + "/" + y;
        };
        _ol_tilecoord_.getKey = function(tileCoord) {
            return _ol_tilecoord_.getKeyZXY(tileCoord[0], tileCoord[1], tileCoord[2]);
        };
        _ol_tilecoord_.fromKey = function(key) {
            return key.split("/").map(Number);
        };
        _ol_tilecoord_.hash = function(tileCoord) {
            return (tileCoord[1] << tileCoord[0]) + tileCoord[2];
        };
        _ol_tilecoord_.quadKey = function(tileCoord) {
            var z = tileCoord[0];
            var digits = new Array(z);
            var mask = 1 << z - 1;
            var i, charCode;
            for (i = 0; i < z; ++i) {
                charCode = 48;
                if (tileCoord[1] & mask) {
                    charCode += 1;
                }
                if (tileCoord[2] & mask) {
                    charCode += 2;
                }
                digits[i] = String.fromCharCode(charCode);
                mask >>= 1;
            }
            return digits.join("");
        };
        _ol_tilecoord_.withinExtentAndZ = function(tileCoord, tileGrid) {
            var z = tileCoord[0];
            var x = tileCoord[1];
            var y = tileCoord[2];
            if (tileGrid.getMinZoom() > z || z > tileGrid.getMaxZoom()) {
                return false;
            }
            var extent = tileGrid.getExtent();
            var tileRange;
            if (!extent) {
                tileRange = tileGrid.getFullTileRange(z);
            } else {
                tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);
            }
            if (!tileRange) {
                return true;
            } else {
                return tileRange.containsXY(x, y);
            }
        };
        exports.default = _ol_tilecoord_;
    }, {} ],
    238: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _size = require("./size.js");
        var _size2 = _interopRequireDefault(_size);
        var _extent = require("./extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _corner = require("./extent/corner.js");
        var _corner2 = _interopRequireDefault(_corner);
        var _obj = require("./obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _proj = require("./proj.js");
        var _proj2 = _interopRequireDefault(_proj);
        var _units = require("./proj/units.js");
        var _units2 = _interopRequireDefault(_units);
        var _tilegrid = require("./tilegrid/tilegrid.js");
        var _tilegrid2 = _interopRequireDefault(_tilegrid);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_tilegrid_ = {};
        _ol_tilegrid_.getForProjection = function(projection) {
            var tileGrid = projection.getDefaultTileGrid();
            if (!tileGrid) {
                tileGrid = _ol_tilegrid_.createForProjection(projection);
                projection.setDefaultTileGrid(tileGrid);
            }
            return tileGrid;
        };
        _ol_tilegrid_.wrapX = function(tileGrid, tileCoord, projection) {
            var z = tileCoord[0];
            var center = tileGrid.getTileCoordCenter(tileCoord);
            var projectionExtent = _ol_tilegrid_.extentFromProjection(projection);
            if (!_extent2.default.containsCoordinate(projectionExtent, center)) {
                var worldWidth = _extent2.default.getWidth(projectionExtent);
                var worldsAway = Math.ceil((projectionExtent[0] - center[0]) / worldWidth);
                center[0] += worldWidth * worldsAway;
                return tileGrid.getTileCoordForCoordAndZ(center, z);
            } else {
                return tileCoord;
            }
        };
        _ol_tilegrid_.createForExtent = function(extent, opt_maxZoom, opt_tileSize, opt_corner) {
            var corner = opt_corner !== undefined ? opt_corner : _corner2.default.TOP_LEFT;
            var resolutions = _ol_tilegrid_.resolutionsFromExtent(extent, opt_maxZoom, opt_tileSize);
            return new _tilegrid2.default({
                extent: extent,
                origin: _extent2.default.getCorner(extent, corner),
                resolutions: resolutions,
                tileSize: opt_tileSize
            });
        };
        _ol_tilegrid_.createXYZ = function(opt_options) {
            var options = {};
            _obj2.default.assign(options, opt_options !== undefined ? opt_options : {});
            if (options.extent === undefined) {
                options.extent = _proj2.default.get("EPSG:3857").getExtent();
            }
            options.resolutions = _ol_tilegrid_.resolutionsFromExtent(options.extent, options.maxZoom, options.tileSize);
            delete options.maxZoom;
            return new _tilegrid2.default(options);
        };
        _ol_tilegrid_.resolutionsFromExtent = function(extent, opt_maxZoom, opt_tileSize) {
            var maxZoom = opt_maxZoom !== undefined ? opt_maxZoom : _index2.default.DEFAULT_MAX_ZOOM;
            var height = _extent2.default.getHeight(extent);
            var width = _extent2.default.getWidth(extent);
            var tileSize = _size2.default.toSize(opt_tileSize !== undefined ? opt_tileSize : _index2.default.DEFAULT_TILE_SIZE);
            var maxResolution = Math.max(width / tileSize[0], height / tileSize[1]);
            var length = maxZoom + 1;
            var resolutions = new Array(length);
            for (var z = 0; z < length; ++z) {
                resolutions[z] = maxResolution / Math.pow(2, z);
            }
            return resolutions;
        };
        _ol_tilegrid_.createForProjection = function(projection, opt_maxZoom, opt_tileSize, opt_corner) {
            var extent = _ol_tilegrid_.extentFromProjection(projection);
            return _ol_tilegrid_.createForExtent(extent, opt_maxZoom, opt_tileSize, opt_corner);
        };
        _ol_tilegrid_.extentFromProjection = function(projection) {
            projection = _proj2.default.get(projection);
            var extent = projection.getExtent();
            if (!extent) {
                var half = 180 * _proj2.default.METERS_PER_UNIT[_units2.default.DEGREES] / projection.getMetersPerUnit();
                extent = _extent2.default.createOrUpdate(-half, -half, half, half);
            }
            return extent;
        };
        exports.default = _ol_tilegrid_;
    }, {
        "./extent.js": 54,
        "./extent/corner.js": 55,
        "./index.js": 89,
        "./obj.js": 124,
        "./proj.js": 141,
        "./proj/units.js": 148,
        "./size.js": 208,
        "./tilegrid/tilegrid.js": 239
    } ],
    239: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _asserts = require("../asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _tilerange = require("../tilerange.js");
        var _tilerange2 = _interopRequireDefault(_tilerange);
        var _array = require("../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _extent = require("../extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _math = require("../math.js");
        var _math2 = _interopRequireDefault(_math);
        var _size = require("../size.js");
        var _size2 = _interopRequireDefault(_size);
        var _tilecoord = require("../tilecoord.js");
        var _tilecoord2 = _interopRequireDefault(_tilecoord);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_tilegrid_TileGrid_ = function(options) {
            this.minZoom = options.minZoom !== undefined ? options.minZoom : 0;
            this.resolutions_ = options.resolutions;
            _asserts2.default.assert(_array2.default.isSorted(this.resolutions_, function(a, b) {
                return b - a;
            }, true), 17);
            var zoomFactor;
            if (!options.origins) {
                for (var i = 0, ii = this.resolutions_.length - 1; i < ii; ++i) {
                    if (!zoomFactor) {
                        zoomFactor = this.resolutions_[i] / this.resolutions_[i + 1];
                    } else {
                        if (this.resolutions_[i] / this.resolutions_[i + 1] !== zoomFactor) {
                            zoomFactor = undefined;
                            break;
                        }
                    }
                }
            }
            this.zoomFactor_ = zoomFactor;
            this.maxZoom = this.resolutions_.length - 1;
            this.origin_ = options.origin !== undefined ? options.origin : null;
            this.origins_ = null;
            if (options.origins !== undefined) {
                this.origins_ = options.origins;
                _asserts2.default.assert(this.origins_.length == this.resolutions_.length, 20);
            }
            var extent = options.extent;
            if (extent !== undefined && !this.origin_ && !this.origins_) {
                this.origin_ = _extent2.default.getTopLeft(extent);
            }
            _asserts2.default.assert(!this.origin_ && this.origins_ || this.origin_ && !this.origins_, 18);
            this.tileSizes_ = null;
            if (options.tileSizes !== undefined) {
                this.tileSizes_ = options.tileSizes;
                _asserts2.default.assert(this.tileSizes_.length == this.resolutions_.length, 19);
            }
            this.tileSize_ = options.tileSize !== undefined ? options.tileSize : !this.tileSizes_ ? _index2.default.DEFAULT_TILE_SIZE : null;
            _asserts2.default.assert(!this.tileSize_ && this.tileSizes_ || this.tileSize_ && !this.tileSizes_, 22);
            this.extent_ = extent !== undefined ? extent : null;
            this.fullTileRanges_ = null;
            this.tmpSize_ = [ 0, 0 ];
            if (options.sizes !== undefined) {
                this.fullTileRanges_ = options.sizes.map(function(size, z) {
                    var tileRange = new _tilerange2.default(Math.min(0, size[0]), Math.max(size[0] - 1, -1), Math.min(0, size[1]), Math.max(size[1] - 1, -1));
                    return tileRange;
                }, this);
            } else if (extent) {
                this.calculateTileRanges_(extent);
            }
        };
        _ol_tilegrid_TileGrid_.tmpTileCoord_ = [ 0, 0, 0 ];
        _ol_tilegrid_TileGrid_.prototype.forEachTileCoord = function(extent, zoom, callback) {
            var tileRange = this.getTileRangeForExtentAndZ(extent, zoom);
            for (var i = tileRange.minX, ii = tileRange.maxX; i <= ii; ++i) {
                for (var j = tileRange.minY, jj = tileRange.maxY; j <= jj; ++j) {
                    callback([ zoom, i, j ]);
                }
            }
        };
        _ol_tilegrid_TileGrid_.prototype.forEachTileCoordParentTileRange = function(tileCoord, callback, opt_this, opt_tileRange, opt_extent) {
            var tileRange, x, y;
            var tileCoordExtent = null;
            var z = tileCoord[0] - 1;
            if (this.zoomFactor_ === 2) {
                x = tileCoord[1];
                y = tileCoord[2];
            } else {
                tileCoordExtent = this.getTileCoordExtent(tileCoord, opt_extent);
            }
            while (z >= this.minZoom) {
                if (this.zoomFactor_ === 2) {
                    x = Math.floor(x / 2);
                    y = Math.floor(y / 2);
                    tileRange = _tilerange2.default.createOrUpdate(x, x, y, y, opt_tileRange);
                } else {
                    tileRange = this.getTileRangeForExtentAndZ(tileCoordExtent, z, opt_tileRange);
                }
                if (callback.call(opt_this, z, tileRange)) {
                    return true;
                }
                --z;
            }
            return false;
        };
        _ol_tilegrid_TileGrid_.prototype.getExtent = function() {
            return this.extent_;
        };
        _ol_tilegrid_TileGrid_.prototype.getMaxZoom = function() {
            return this.maxZoom;
        };
        _ol_tilegrid_TileGrid_.prototype.getMinZoom = function() {
            return this.minZoom;
        };
        _ol_tilegrid_TileGrid_.prototype.getOrigin = function(z) {
            if (this.origin_) {
                return this.origin_;
            } else {
                return this.origins_[z];
            }
        };
        _ol_tilegrid_TileGrid_.prototype.getResolution = function(z) {
            return this.resolutions_[z];
        };
        _ol_tilegrid_TileGrid_.prototype.getResolutions = function() {
            return this.resolutions_;
        };
        _ol_tilegrid_TileGrid_.prototype.getTileCoordChildTileRange = function(tileCoord, opt_tileRange, opt_extent) {
            if (tileCoord[0] < this.maxZoom) {
                if (this.zoomFactor_ === 2) {
                    var minX = tileCoord[1] * 2;
                    var minY = tileCoord[2] * 2;
                    return _tilerange2.default.createOrUpdate(minX, minX + 1, minY, minY + 1, opt_tileRange);
                }
                var tileCoordExtent = this.getTileCoordExtent(tileCoord, opt_extent);
                return this.getTileRangeForExtentAndZ(tileCoordExtent, tileCoord[0] + 1, opt_tileRange);
            }
            return null;
        };
        _ol_tilegrid_TileGrid_.prototype.getTileRangeExtent = function(z, tileRange, opt_extent) {
            var origin = this.getOrigin(z);
            var resolution = this.getResolution(z);
            var tileSize = _size2.default.toSize(this.getTileSize(z), this.tmpSize_);
            var minX = origin[0] + tileRange.minX * tileSize[0] * resolution;
            var maxX = origin[0] + (tileRange.maxX + 1) * tileSize[0] * resolution;
            var minY = origin[1] + tileRange.minY * tileSize[1] * resolution;
            var maxY = origin[1] + (tileRange.maxY + 1) * tileSize[1] * resolution;
            return _extent2.default.createOrUpdate(minX, minY, maxX, maxY, opt_extent);
        };
        _ol_tilegrid_TileGrid_.prototype.getTileRangeForExtentAndZ = function(extent, z, opt_tileRange) {
            var tileCoord = _ol_tilegrid_TileGrid_.tmpTileCoord_;
            this.getTileCoordForXYAndZ_(extent[0], extent[1], z, false, tileCoord);
            var minX = tileCoord[1];
            var minY = tileCoord[2];
            this.getTileCoordForXYAndZ_(extent[2], extent[3], z, true, tileCoord);
            return _tilerange2.default.createOrUpdate(minX, tileCoord[1], minY, tileCoord[2], opt_tileRange);
        };
        _ol_tilegrid_TileGrid_.prototype.getTileCoordCenter = function(tileCoord) {
            var origin = this.getOrigin(tileCoord[0]);
            var resolution = this.getResolution(tileCoord[0]);
            var tileSize = _size2.default.toSize(this.getTileSize(tileCoord[0]), this.tmpSize_);
            return [ origin[0] + (tileCoord[1] + .5) * tileSize[0] * resolution, origin[1] + (tileCoord[2] + .5) * tileSize[1] * resolution ];
        };
        _ol_tilegrid_TileGrid_.prototype.getTileCoordExtent = function(tileCoord, opt_extent) {
            var origin = this.getOrigin(tileCoord[0]);
            var resolution = this.getResolution(tileCoord[0]);
            var tileSize = _size2.default.toSize(this.getTileSize(tileCoord[0]), this.tmpSize_);
            var minX = origin[0] + tileCoord[1] * tileSize[0] * resolution;
            var minY = origin[1] + tileCoord[2] * tileSize[1] * resolution;
            var maxX = minX + tileSize[0] * resolution;
            var maxY = minY + tileSize[1] * resolution;
            return _extent2.default.createOrUpdate(minX, minY, maxX, maxY, opt_extent);
        };
        _ol_tilegrid_TileGrid_.prototype.getTileCoordForCoordAndResolution = function(coordinate, resolution, opt_tileCoord) {
            return this.getTileCoordForXYAndResolution_(coordinate[0], coordinate[1], resolution, false, opt_tileCoord);
        };
        _ol_tilegrid_TileGrid_.prototype.getTileCoordForXYAndResolution_ = function(x, y, resolution, reverseIntersectionPolicy, opt_tileCoord) {
            var z = this.getZForResolution(resolution);
            var scale = resolution / this.getResolution(z);
            var origin = this.getOrigin(z);
            var tileSize = _size2.default.toSize(this.getTileSize(z), this.tmpSize_);
            var adjustX = reverseIntersectionPolicy ? .5 : 0;
            var adjustY = reverseIntersectionPolicy ? 0 : .5;
            var xFromOrigin = Math.floor((x - origin[0]) / resolution + adjustX);
            var yFromOrigin = Math.floor((y - origin[1]) / resolution + adjustY);
            var tileCoordX = scale * xFromOrigin / tileSize[0];
            var tileCoordY = scale * yFromOrigin / tileSize[1];
            if (reverseIntersectionPolicy) {
                tileCoordX = Math.ceil(tileCoordX) - 1;
                tileCoordY = Math.ceil(tileCoordY) - 1;
            } else {
                tileCoordX = Math.floor(tileCoordX);
                tileCoordY = Math.floor(tileCoordY);
            }
            return _tilecoord2.default.createOrUpdate(z, tileCoordX, tileCoordY, opt_tileCoord);
        };
        _ol_tilegrid_TileGrid_.prototype.getTileCoordForXYAndZ_ = function(x, y, z, reverseIntersectionPolicy, opt_tileCoord) {
            var origin = this.getOrigin(z);
            var resolution = this.getResolution(z);
            var tileSize = _size2.default.toSize(this.getTileSize(z), this.tmpSize_);
            var adjustX = reverseIntersectionPolicy ? .5 : 0;
            var adjustY = reverseIntersectionPolicy ? 0 : .5;
            var xFromOrigin = Math.floor((x - origin[0]) / resolution + adjustX);
            var yFromOrigin = Math.floor((y - origin[1]) / resolution + adjustY);
            var tileCoordX = xFromOrigin / tileSize[0];
            var tileCoordY = yFromOrigin / tileSize[1];
            if (reverseIntersectionPolicy) {
                tileCoordX = Math.ceil(tileCoordX) - 1;
                tileCoordY = Math.ceil(tileCoordY) - 1;
            } else {
                tileCoordX = Math.floor(tileCoordX);
                tileCoordY = Math.floor(tileCoordY);
            }
            return _tilecoord2.default.createOrUpdate(z, tileCoordX, tileCoordY, opt_tileCoord);
        };
        _ol_tilegrid_TileGrid_.prototype.getTileCoordForCoordAndZ = function(coordinate, z, opt_tileCoord) {
            return this.getTileCoordForXYAndZ_(coordinate[0], coordinate[1], z, false, opt_tileCoord);
        };
        _ol_tilegrid_TileGrid_.prototype.getTileCoordResolution = function(tileCoord) {
            return this.resolutions_[tileCoord[0]];
        };
        _ol_tilegrid_TileGrid_.prototype.getTileSize = function(z) {
            if (this.tileSize_) {
                return this.tileSize_;
            } else {
                return this.tileSizes_[z];
            }
        };
        _ol_tilegrid_TileGrid_.prototype.getFullTileRange = function(z) {
            if (!this.fullTileRanges_) {
                return null;
            } else {
                return this.fullTileRanges_[z];
            }
        };
        _ol_tilegrid_TileGrid_.prototype.getZForResolution = function(resolution, opt_direction) {
            var z = _array2.default.linearFindNearest(this.resolutions_, resolution, opt_direction || 0);
            return _math2.default.clamp(z, this.minZoom, this.maxZoom);
        };
        _ol_tilegrid_TileGrid_.prototype.calculateTileRanges_ = function(extent) {
            var length = this.resolutions_.length;
            var fullTileRanges = new Array(length);
            for (var z = this.minZoom; z < length; ++z) {
                fullTileRanges[z] = this.getTileRangeForExtentAndZ(extent, z);
            }
            this.fullTileRanges_ = fullTileRanges;
        };
        exports.default = _ol_tilegrid_TileGrid_;
    }, {
        "../array.js": 29,
        "../asserts.js": 31,
        "../extent.js": 54,
        "../index.js": 89,
        "../math.js": 123,
        "../size.js": 208,
        "../tilecoord.js": 237,
        "../tilerange.js": 241
    } ],
    240: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _tilestate = require("./tilestate.js");
        var _tilestate2 = _interopRequireDefault(_tilestate);
        var _events = require("./events.js");
        var _events2 = _interopRequireDefault(_events);
        var _eventtype = require("./events/eventtype.js");
        var _eventtype2 = _interopRequireDefault(_eventtype);
        var _priorityqueue = require("./structs/priorityqueue.js");
        var _priorityqueue2 = _interopRequireDefault(_priorityqueue);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_TileQueue_ = function(tilePriorityFunction, tileChangeCallback) {
            _priorityqueue2.default.call(this, function(element) {
                return tilePriorityFunction.apply(null, element);
            }, function(element) {
                return element[0].getKey();
            });
            this.tileChangeCallback_ = tileChangeCallback;
            this.tilesLoading_ = 0;
            this.tilesLoadingKeys_ = {};
        };
        _index2.default.inherits(_ol_TileQueue_, _priorityqueue2.default);
        _ol_TileQueue_.prototype.enqueue = function(element) {
            var added = _priorityqueue2.default.prototype.enqueue.call(this, element);
            if (added) {
                var tile = element[0];
                _events2.default.listen(tile, _eventtype2.default.CHANGE, this.handleTileChange, this);
            }
            return added;
        };
        _ol_TileQueue_.prototype.getTilesLoading = function() {
            return this.tilesLoading_;
        };
        _ol_TileQueue_.prototype.handleTileChange = function(event) {
            var tile = event.target;
            var state = tile.getState();
            if (state === _tilestate2.default.LOADED || state === _tilestate2.default.ERROR || state === _tilestate2.default.EMPTY || state === _tilestate2.default.ABORT) {
                _events2.default.unlisten(tile, _eventtype2.default.CHANGE, this.handleTileChange, this);
                var tileKey = tile.getKey();
                if (tileKey in this.tilesLoadingKeys_) {
                    delete this.tilesLoadingKeys_[tileKey];
                    --this.tilesLoading_;
                }
                this.tileChangeCallback_();
            }
        };
        _ol_TileQueue_.prototype.loadMoreTiles = function(maxTotalLoading, maxNewLoads) {
            var newLoads = 0;
            var abortedTiles = false;
            var state, tile, tileKey;
            while (this.tilesLoading_ < maxTotalLoading && newLoads < maxNewLoads && this.getCount() > 0) {
                tile = this.dequeue()[0];
                tileKey = tile.getKey();
                state = tile.getState();
                if (state === _tilestate2.default.ABORT) {
                    abortedTiles = true;
                } else if (state === _tilestate2.default.IDLE && !(tileKey in this.tilesLoadingKeys_)) {
                    this.tilesLoadingKeys_[tileKey] = true;
                    ++this.tilesLoading_;
                    ++newLoads;
                    tile.load();
                }
            }
            if (newLoads === 0 && abortedTiles) {
                this.tileChangeCallback_();
            }
        };
        exports.default = _ol_TileQueue_;
    }, {
        "./events.js": 48,
        "./events/eventtype.js": 52,
        "./index.js": 89,
        "./structs/priorityqueue.js": 219,
        "./tilestate.js": 242
    } ],
    241: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_TileRange_ = function(minX, maxX, minY, maxY) {
            this.minX = minX;
            this.maxX = maxX;
            this.minY = minY;
            this.maxY = maxY;
        };
        _ol_TileRange_.createOrUpdate = function(minX, maxX, minY, maxY, tileRange) {
            if (tileRange !== undefined) {
                tileRange.minX = minX;
                tileRange.maxX = maxX;
                tileRange.minY = minY;
                tileRange.maxY = maxY;
                return tileRange;
            } else {
                return new _ol_TileRange_(minX, maxX, minY, maxY);
            }
        };
        _ol_TileRange_.prototype.contains = function(tileCoord) {
            return this.containsXY(tileCoord[1], tileCoord[2]);
        };
        _ol_TileRange_.prototype.containsTileRange = function(tileRange) {
            return this.minX <= tileRange.minX && tileRange.maxX <= this.maxX && this.minY <= tileRange.minY && tileRange.maxY <= this.maxY;
        };
        _ol_TileRange_.prototype.containsXY = function(x, y) {
            return this.minX <= x && x <= this.maxX && this.minY <= y && y <= this.maxY;
        };
        _ol_TileRange_.prototype.equals = function(tileRange) {
            return this.minX == tileRange.minX && this.minY == tileRange.minY && this.maxX == tileRange.maxX && this.maxY == tileRange.maxY;
        };
        _ol_TileRange_.prototype.extend = function(tileRange) {
            if (tileRange.minX < this.minX) {
                this.minX = tileRange.minX;
            }
            if (tileRange.maxX > this.maxX) {
                this.maxX = tileRange.maxX;
            }
            if (tileRange.minY < this.minY) {
                this.minY = tileRange.minY;
            }
            if (tileRange.maxY > this.maxY) {
                this.maxY = tileRange.maxY;
            }
        };
        _ol_TileRange_.prototype.getHeight = function() {
            return this.maxY - this.minY + 1;
        };
        _ol_TileRange_.prototype.getSize = function() {
            return [ this.getWidth(), this.getHeight() ];
        };
        _ol_TileRange_.prototype.getWidth = function() {
            return this.maxX - this.minX + 1;
        };
        _ol_TileRange_.prototype.intersects = function(tileRange) {
            return this.minX <= tileRange.maxX && this.maxX >= tileRange.minX && this.minY <= tileRange.maxY && this.maxY >= tileRange.minY;
        };
        exports.default = _ol_TileRange_;
    }, {} ],
    242: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_TileState_ = {
            IDLE: 0,
            LOADING: 1,
            LOADED: 2,
            ERROR: 3,
            EMPTY: 4,
            ABORT: 5
        };
        exports.default = _ol_TileState_;
    }, {} ],
    243: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _asserts = require("./asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_transform_ = {};
        _ol_transform_.tmp_ = new Array(6);
        _ol_transform_.create = function() {
            return [ 1, 0, 0, 1, 0, 0 ];
        };
        _ol_transform_.reset = function(transform) {
            return _ol_transform_.set(transform, 1, 0, 0, 1, 0, 0);
        };
        _ol_transform_.multiply = function(transform1, transform2) {
            var a1 = transform1[0];
            var b1 = transform1[1];
            var c1 = transform1[2];
            var d1 = transform1[3];
            var e1 = transform1[4];
            var f1 = transform1[5];
            var a2 = transform2[0];
            var b2 = transform2[1];
            var c2 = transform2[2];
            var d2 = transform2[3];
            var e2 = transform2[4];
            var f2 = transform2[5];
            transform1[0] = a1 * a2 + c1 * b2;
            transform1[1] = b1 * a2 + d1 * b2;
            transform1[2] = a1 * c2 + c1 * d2;
            transform1[3] = b1 * c2 + d1 * d2;
            transform1[4] = a1 * e2 + c1 * f2 + e1;
            transform1[5] = b1 * e2 + d1 * f2 + f1;
            return transform1;
        };
        _ol_transform_.set = function(transform, a, b, c, d, e, f) {
            transform[0] = a;
            transform[1] = b;
            transform[2] = c;
            transform[3] = d;
            transform[4] = e;
            transform[5] = f;
            return transform;
        };
        _ol_transform_.setFromArray = function(transform1, transform2) {
            transform1[0] = transform2[0];
            transform1[1] = transform2[1];
            transform1[2] = transform2[2];
            transform1[3] = transform2[3];
            transform1[4] = transform2[4];
            transform1[5] = transform2[5];
            return transform1;
        };
        _ol_transform_.apply = function(transform, coordinate) {
            var x = coordinate[0], y = coordinate[1];
            coordinate[0] = transform[0] * x + transform[2] * y + transform[4];
            coordinate[1] = transform[1] * x + transform[3] * y + transform[5];
            return coordinate;
        };
        _ol_transform_.rotate = function(transform, angle) {
            var cos = Math.cos(angle);
            var sin = Math.sin(angle);
            return _ol_transform_.multiply(transform, _ol_transform_.set(_ol_transform_.tmp_, cos, sin, -sin, cos, 0, 0));
        };
        _ol_transform_.scale = function(transform, x, y) {
            return _ol_transform_.multiply(transform, _ol_transform_.set(_ol_transform_.tmp_, x, 0, 0, y, 0, 0));
        };
        _ol_transform_.translate = function(transform, dx, dy) {
            return _ol_transform_.multiply(transform, _ol_transform_.set(_ol_transform_.tmp_, 1, 0, 0, 1, dx, dy));
        };
        _ol_transform_.compose = function(transform, dx1, dy1, sx, sy, angle, dx2, dy2) {
            var sin = Math.sin(angle);
            var cos = Math.cos(angle);
            transform[0] = sx * cos;
            transform[1] = sy * sin;
            transform[2] = -sx * sin;
            transform[3] = sy * cos;
            transform[4] = dx2 * sx * cos - dy2 * sx * sin + dx1;
            transform[5] = dx2 * sy * sin + dy2 * sy * cos + dy1;
            return transform;
        };
        _ol_transform_.invert = function(transform) {
            var det = _ol_transform_.determinant(transform);
            _asserts2.default.assert(det !== 0, 32);
            var a = transform[0];
            var b = transform[1];
            var c = transform[2];
            var d = transform[3];
            var e = transform[4];
            var f = transform[5];
            transform[0] = d / det;
            transform[1] = -b / det;
            transform[2] = -c / det;
            transform[3] = a / det;
            transform[4] = (c * f - d * e) / det;
            transform[5] = -(a * f - b * e) / det;
            return transform;
        };
        _ol_transform_.determinant = function(mat) {
            return mat[0] * mat[3] - mat[1] * mat[2];
        };
        exports.default = _ol_transform_;
    }, {
        "./asserts.js": 31
    } ],
    244: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_vec_Mat4_ = {};
        _ol_vec_Mat4_.create = function() {
            return [ 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1 ];
        };
        _ol_vec_Mat4_.fromTransform = function(mat4, transform) {
            mat4[0] = transform[0];
            mat4[1] = transform[1];
            mat4[4] = transform[2];
            mat4[5] = transform[3];
            mat4[12] = transform[4];
            mat4[13] = transform[5];
            return mat4;
        };
        exports.default = _ol_vec_Mat4_;
    }, {} ],
    245: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("./index.js");
        var _index2 = _interopRequireDefault(_index);
        var _centerconstraint = require("./centerconstraint.js");
        var _centerconstraint2 = _interopRequireDefault(_centerconstraint);
        var _object = require("./object.js");
        var _object2 = _interopRequireDefault(_object);
        var _resolutionconstraint = require("./resolutionconstraint.js");
        var _resolutionconstraint2 = _interopRequireDefault(_resolutionconstraint);
        var _rotationconstraint = require("./rotationconstraint.js");
        var _rotationconstraint2 = _interopRequireDefault(_rotationconstraint);
        var _viewhint = require("./viewhint.js");
        var _viewhint2 = _interopRequireDefault(_viewhint);
        var _viewproperty = require("./viewproperty.js");
        var _viewproperty2 = _interopRequireDefault(_viewproperty);
        var _array = require("./array.js");
        var _array2 = _interopRequireDefault(_array);
        var _asserts = require("./asserts.js");
        var _asserts2 = _interopRequireDefault(_asserts);
        var _coordinate = require("./coordinate.js");
        var _coordinate2 = _interopRequireDefault(_coordinate);
        var _easing = require("./easing.js");
        var _easing2 = _interopRequireDefault(_easing);
        var _extent = require("./extent.js");
        var _extent2 = _interopRequireDefault(_extent);
        var _geometrytype = require("./geom/geometrytype.js");
        var _geometrytype2 = _interopRequireDefault(_geometrytype);
        var _polygon = require("./geom/polygon.js");
        var _polygon2 = _interopRequireDefault(_polygon);
        var _simplegeometry = require("./geom/simplegeometry.js");
        var _simplegeometry2 = _interopRequireDefault(_simplegeometry);
        var _math = require("./math.js");
        var _math2 = _interopRequireDefault(_math);
        var _obj = require("./obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _proj = require("./proj.js");
        var _proj2 = _interopRequireDefault(_proj);
        var _units = require("./proj/units.js");
        var _units2 = _interopRequireDefault(_units);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_View_ = function(opt_options) {
            _object2.default.call(this);
            var options = _obj2.default.assign({}, opt_options);
            this.hints_ = [ 0, 0 ];
            this.animations_ = [];
            this.updateAnimationKey_;
            this.updateAnimations_ = this.updateAnimations_.bind(this);
            this.projection_ = _proj2.default.createProjection(options.projection, "EPSG:3857");
            this.applyOptions_(options);
        };
        _index2.default.inherits(_ol_View_, _object2.default);
        _ol_View_.prototype.applyOptions_ = function(options) {
            var properties = {};
            properties[_viewproperty2.default.CENTER] = options.center !== undefined ? options.center : null;
            var resolutionConstraintInfo = _ol_View_.createResolutionConstraint_(options);
            this.maxResolution_ = resolutionConstraintInfo.maxResolution;
            this.minResolution_ = resolutionConstraintInfo.minResolution;
            this.zoomFactor_ = resolutionConstraintInfo.zoomFactor;
            this.resolutions_ = options.resolutions;
            this.minZoom_ = resolutionConstraintInfo.minZoom;
            var centerConstraint = _ol_View_.createCenterConstraint_(options);
            var resolutionConstraint = resolutionConstraintInfo.constraint;
            var rotationConstraint = _ol_View_.createRotationConstraint_(options);
            this.constraints_ = {
                center: centerConstraint,
                resolution: resolutionConstraint,
                rotation: rotationConstraint
            };
            if (options.resolution !== undefined) {
                properties[_viewproperty2.default.RESOLUTION] = options.resolution;
            } else if (options.zoom !== undefined) {
                properties[_viewproperty2.default.RESOLUTION] = this.constrainResolution(this.maxResolution_, options.zoom - this.minZoom_);
                if (this.resolutions_) {
                    properties[_viewproperty2.default.RESOLUTION] = _math2.default.clamp(Number(this.getResolution() || properties[_viewproperty2.default.RESOLUTION]), this.minResolution_, this.maxResolution_);
                }
            }
            properties[_viewproperty2.default.ROTATION] = options.rotation !== undefined ? options.rotation : 0;
            this.setProperties(properties);
            this.options_ = options;
        };
        _ol_View_.prototype.getUpdatedOptions_ = function(newOptions) {
            var options = _obj2.default.assign({}, this.options_);
            if (options.resolution !== undefined) {
                options.resolution = this.getResolution();
            } else {
                options.zoom = this.getZoom();
            }
            options.center = this.getCenter();
            options.rotation = this.getRotation();
            return _obj2.default.assign({}, options, newOptions);
        };
        _ol_View_.prototype.animate = function(var_args) {
            var animationCount = arguments.length;
            var callback;
            if (animationCount > 1 && typeof arguments[animationCount - 1] === "function") {
                callback = arguments[animationCount - 1];
                --animationCount;
            }
            if (!this.isDef()) {
                var state = arguments[animationCount - 1];
                if (state.center) {
                    this.setCenter(state.center);
                }
                if (state.zoom !== undefined) {
                    this.setZoom(state.zoom);
                }
                if (state.rotation !== undefined) {
                    this.setRotation(state.rotation);
                }
                if (callback) {
                    callback(true);
                }
                return;
            }
            var start = Date.now();
            var center = this.getCenter().slice();
            var resolution = this.getResolution();
            var rotation = this.getRotation();
            var series = [];
            for (var i = 0; i < animationCount; ++i) {
                var options = arguments[i];
                var animation = {
                    start: start,
                    complete: false,
                    anchor: options.anchor,
                    duration: options.duration !== undefined ? options.duration : 1e3,
                    easing: options.easing || _easing2.default.inAndOut
                };
                if (options.center) {
                    animation.sourceCenter = center;
                    animation.targetCenter = options.center;
                    center = animation.targetCenter;
                }
                if (options.zoom !== undefined) {
                    animation.sourceResolution = resolution;
                    animation.targetResolution = this.constrainResolution(this.maxResolution_, options.zoom - this.minZoom_, 0);
                    resolution = animation.targetResolution;
                } else if (options.resolution) {
                    animation.sourceResolution = resolution;
                    animation.targetResolution = options.resolution;
                    resolution = animation.targetResolution;
                }
                if (options.rotation !== undefined) {
                    animation.sourceRotation = rotation;
                    var delta = _math2.default.modulo(options.rotation - rotation + Math.PI, 2 * Math.PI) - Math.PI;
                    animation.targetRotation = rotation + delta;
                    rotation = animation.targetRotation;
                }
                animation.callback = callback;
                if (_ol_View_.isNoopAnimation(animation)) {
                    animation.complete = true;
                } else {
                    start += animation.duration;
                }
                series.push(animation);
            }
            this.animations_.push(series);
            this.setHint(_viewhint2.default.ANIMATING, 1);
            this.updateAnimations_();
        };
        _ol_View_.prototype.getAnimating = function() {
            return this.hints_[_viewhint2.default.ANIMATING] > 0;
        };
        _ol_View_.prototype.getInteracting = function() {
            return this.hints_[_viewhint2.default.INTERACTING] > 0;
        };
        _ol_View_.prototype.cancelAnimations = function() {
            this.setHint(_viewhint2.default.ANIMATING, -this.hints_[_viewhint2.default.ANIMATING]);
            for (var i = 0, ii = this.animations_.length; i < ii; ++i) {
                var series = this.animations_[i];
                if (series[0].callback) {
                    series[0].callback(false);
                }
            }
            this.animations_.length = 0;
        };
        _ol_View_.prototype.updateAnimations_ = function() {
            if (this.updateAnimationKey_ !== undefined) {
                cancelAnimationFrame(this.updateAnimationKey_);
                this.updateAnimationKey_ = undefined;
            }
            if (!this.getAnimating()) {
                return;
            }
            var now = Date.now();
            var more = false;
            for (var i = this.animations_.length - 1; i >= 0; --i) {
                var series = this.animations_[i];
                var seriesComplete = true;
                for (var j = 0, jj = series.length; j < jj; ++j) {
                    var animation = series[j];
                    if (animation.complete) {
                        continue;
                    }
                    var elapsed = now - animation.start;
                    var fraction = animation.duration > 0 ? elapsed / animation.duration : 1;
                    if (fraction >= 1) {
                        animation.complete = true;
                        fraction = 1;
                    } else {
                        seriesComplete = false;
                    }
                    var progress = animation.easing(fraction);
                    if (animation.sourceCenter) {
                        var x0 = animation.sourceCenter[0];
                        var y0 = animation.sourceCenter[1];
                        var x1 = animation.targetCenter[0];
                        var y1 = animation.targetCenter[1];
                        var x = x0 + progress * (x1 - x0);
                        var y = y0 + progress * (y1 - y0);
                        this.set(_viewproperty2.default.CENTER, [ x, y ]);
                    }
                    if (animation.sourceResolution && animation.targetResolution) {
                        var resolution = progress === 1 ? animation.targetResolution : animation.sourceResolution + progress * (animation.targetResolution - animation.sourceResolution);
                        if (animation.anchor) {
                            this.set(_viewproperty2.default.CENTER, this.calculateCenterZoom(resolution, animation.anchor));
                        }
                        this.set(_viewproperty2.default.RESOLUTION, resolution);
                    }
                    if (animation.sourceRotation !== undefined && animation.targetRotation !== undefined) {
                        var rotation = progress === 1 ? _math2.default.modulo(animation.targetRotation + Math.PI, 2 * Math.PI) - Math.PI : animation.sourceRotation + progress * (animation.targetRotation - animation.sourceRotation);
                        if (animation.anchor) {
                            this.set(_viewproperty2.default.CENTER, this.calculateCenterRotate(rotation, animation.anchor));
                        }
                        this.set(_viewproperty2.default.ROTATION, rotation);
                    }
                    more = true;
                    if (!animation.complete) {
                        break;
                    }
                }
                if (seriesComplete) {
                    this.animations_[i] = null;
                    this.setHint(_viewhint2.default.ANIMATING, -1);
                    var callback = series[0].callback;
                    if (callback) {
                        callback(true);
                    }
                }
            }
            this.animations_ = this.animations_.filter(Boolean);
            if (more && this.updateAnimationKey_ === undefined) {
                this.updateAnimationKey_ = requestAnimationFrame(this.updateAnimations_);
            }
        };
        _ol_View_.prototype.calculateCenterRotate = function(rotation, anchor) {
            var center;
            var currentCenter = this.getCenter();
            if (currentCenter !== undefined) {
                center = [ currentCenter[0] - anchor[0], currentCenter[1] - anchor[1] ];
                _coordinate2.default.rotate(center, rotation - this.getRotation());
                _coordinate2.default.add(center, anchor);
            }
            return center;
        };
        _ol_View_.prototype.calculateCenterZoom = function(resolution, anchor) {
            var center;
            var currentCenter = this.getCenter();
            var currentResolution = this.getResolution();
            if (currentCenter !== undefined && currentResolution !== undefined) {
                var x = anchor[0] - resolution * (anchor[0] - currentCenter[0]) / currentResolution;
                var y = anchor[1] - resolution * (anchor[1] - currentCenter[1]) / currentResolution;
                center = [ x, y ];
            }
            return center;
        };
        _ol_View_.prototype.getSizeFromViewport_ = function() {
            var size = [ 100, 100 ];
            var selector = '.ol-viewport[data-view="' + _index2.default.getUid(this) + '"]';
            var element = document.querySelector(selector);
            if (element) {
                var metrics = getComputedStyle(element);
                size[0] = parseInt(metrics.width, 10);
                size[1] = parseInt(metrics.height, 10);
            }
            return size;
        };
        _ol_View_.prototype.constrainCenter = function(center) {
            return this.constraints_.center(center);
        };
        _ol_View_.prototype.constrainResolution = function(resolution, opt_delta, opt_direction) {
            var delta = opt_delta || 0;
            var direction = opt_direction || 0;
            return this.constraints_.resolution(resolution, delta, direction);
        };
        _ol_View_.prototype.constrainRotation = function(rotation, opt_delta) {
            var delta = opt_delta || 0;
            return this.constraints_.rotation(rotation, delta);
        };
        _ol_View_.prototype.getCenter = function() {
            return this.get(_viewproperty2.default.CENTER);
        };
        _ol_View_.prototype.getConstraints = function() {
            return this.constraints_;
        };
        _ol_View_.prototype.getHints = function(opt_hints) {
            if (opt_hints !== undefined) {
                opt_hints[0] = this.hints_[0];
                opt_hints[1] = this.hints_[1];
                return opt_hints;
            } else {
                return this.hints_.slice();
            }
        };
        _ol_View_.prototype.calculateExtent = function(opt_size) {
            var size = opt_size || this.getSizeFromViewport_();
            var center = this.getCenter();
            _asserts2.default.assert(center, 1);
            var resolution = this.getResolution();
            _asserts2.default.assert(resolution !== undefined, 2);
            var rotation = this.getRotation();
            _asserts2.default.assert(rotation !== undefined, 3);
            return _extent2.default.getForViewAndSize(center, resolution, rotation, size);
        };
        _ol_View_.prototype.getMaxResolution = function() {
            return this.maxResolution_;
        };
        _ol_View_.prototype.getMinResolution = function() {
            return this.minResolution_;
        };
        _ol_View_.prototype.getMaxZoom = function() {
            return this.getZoomForResolution(this.minResolution_);
        };
        _ol_View_.prototype.setMaxZoom = function(zoom) {
            this.applyOptions_(this.getUpdatedOptions_({
                maxZoom: zoom
            }));
        };
        _ol_View_.prototype.getMinZoom = function() {
            return this.getZoomForResolution(this.maxResolution_);
        };
        _ol_View_.prototype.setMinZoom = function(zoom) {
            this.applyOptions_(this.getUpdatedOptions_({
                minZoom: zoom
            }));
        };
        _ol_View_.prototype.getProjection = function() {
            return this.projection_;
        };
        _ol_View_.prototype.getResolution = function() {
            return this.get(_viewproperty2.default.RESOLUTION);
        };
        _ol_View_.prototype.getResolutions = function() {
            return this.resolutions_;
        };
        _ol_View_.prototype.getResolutionForExtent = function(extent, opt_size) {
            var size = opt_size || this.getSizeFromViewport_();
            var xResolution = _extent2.default.getWidth(extent) / size[0];
            var yResolution = _extent2.default.getHeight(extent) / size[1];
            return Math.max(xResolution, yResolution);
        };
        _ol_View_.prototype.getResolutionForValueFunction = function(opt_power) {
            var power = opt_power || 2;
            var maxResolution = this.maxResolution_;
            var minResolution = this.minResolution_;
            var max = Math.log(maxResolution / minResolution) / Math.log(power);
            return function(value) {
                var resolution = maxResolution / Math.pow(power, value * max);
                return resolution;
            };
        };
        _ol_View_.prototype.getRotation = function() {
            return this.get(_viewproperty2.default.ROTATION);
        };
        _ol_View_.prototype.getValueForResolutionFunction = function(opt_power) {
            var power = opt_power || 2;
            var maxResolution = this.maxResolution_;
            var minResolution = this.minResolution_;
            var max = Math.log(maxResolution / minResolution) / Math.log(power);
            return function(resolution) {
                var value = Math.log(maxResolution / resolution) / Math.log(power) / max;
                return value;
            };
        };
        _ol_View_.prototype.getState = function() {
            var center = this.getCenter();
            var projection = this.getProjection();
            var resolution = this.getResolution();
            var rotation = this.getRotation();
            return {
                center: center.slice(),
                projection: projection !== undefined ? projection : null,
                resolution: resolution,
                rotation: rotation,
                zoom: this.getZoom()
            };
        };
        _ol_View_.prototype.getZoom = function() {
            var zoom;
            var resolution = this.getResolution();
            if (resolution !== undefined) {
                zoom = this.getZoomForResolution(resolution);
            }
            return zoom;
        };
        _ol_View_.prototype.getZoomForResolution = function(resolution) {
            var offset = this.minZoom_ || 0;
            var max, zoomFactor;
            if (this.resolutions_) {
                var nearest = _array2.default.linearFindNearest(this.resolutions_, resolution, 1);
                offset = nearest;
                max = this.resolutions_[nearest];
                if (nearest == this.resolutions_.length - 1) {
                    zoomFactor = 2;
                } else {
                    zoomFactor = max / this.resolutions_[nearest + 1];
                }
            } else {
                max = this.maxResolution_;
                zoomFactor = this.zoomFactor_;
            }
            return offset + Math.log(max / resolution) / Math.log(zoomFactor);
        };
        _ol_View_.prototype.getResolutionForZoom = function(zoom) {
            return this.constrainResolution(this.maxResolution_, zoom - this.minZoom_, 0);
        };
        _ol_View_.prototype.fit = function(geometryOrExtent, opt_options) {
            var options = opt_options || {};
            var size = options.size;
            if (!size) {
                size = this.getSizeFromViewport_();
            }
            var geometry;
            if (!(geometryOrExtent instanceof _simplegeometry2.default)) {
                _asserts2.default.assert(Array.isArray(geometryOrExtent), 24);
                _asserts2.default.assert(!_extent2.default.isEmpty(geometryOrExtent), 25);
                geometry = _polygon2.default.fromExtent(geometryOrExtent);
            } else if (geometryOrExtent.getType() === _geometrytype2.default.CIRCLE) {
                geometryOrExtent = geometryOrExtent.getExtent();
                geometry = _polygon2.default.fromExtent(geometryOrExtent);
                geometry.rotate(this.getRotation(), _extent2.default.getCenter(geometryOrExtent));
            } else {
                geometry = geometryOrExtent;
            }
            var padding = options.padding !== undefined ? options.padding : [ 0, 0, 0, 0 ];
            var constrainResolution = options.constrainResolution !== undefined ? options.constrainResolution : true;
            var nearest = options.nearest !== undefined ? options.nearest : false;
            var minResolution;
            if (options.minResolution !== undefined) {
                minResolution = options.minResolution;
            } else if (options.maxZoom !== undefined) {
                minResolution = this.constrainResolution(this.maxResolution_, options.maxZoom - this.minZoom_, 0);
            } else {
                minResolution = 0;
            }
            var coords = geometry.getFlatCoordinates();
            var rotation = this.getRotation();
            var cosAngle = Math.cos(-rotation);
            var sinAngle = Math.sin(-rotation);
            var minRotX = +Infinity;
            var minRotY = +Infinity;
            var maxRotX = -Infinity;
            var maxRotY = -Infinity;
            var stride = geometry.getStride();
            for (var i = 0, ii = coords.length; i < ii; i += stride) {
                var rotX = coords[i] * cosAngle - coords[i + 1] * sinAngle;
                var rotY = coords[i] * sinAngle + coords[i + 1] * cosAngle;
                minRotX = Math.min(minRotX, rotX);
                minRotY = Math.min(minRotY, rotY);
                maxRotX = Math.max(maxRotX, rotX);
                maxRotY = Math.max(maxRotY, rotY);
            }
            var resolution = this.getResolutionForExtent([ minRotX, minRotY, maxRotX, maxRotY ], [ size[0] - padding[1] - padding[3], size[1] - padding[0] - padding[2] ]);
            resolution = isNaN(resolution) ? minResolution : Math.max(resolution, minResolution);
            if (constrainResolution) {
                var constrainedResolution = this.constrainResolution(resolution, 0, 0);
                if (!nearest && constrainedResolution < resolution) {
                    constrainedResolution = this.constrainResolution(constrainedResolution, -1, 0);
                }
                resolution = constrainedResolution;
            }
            sinAngle = -sinAngle;
            var centerRotX = (minRotX + maxRotX) / 2;
            var centerRotY = (minRotY + maxRotY) / 2;
            centerRotX += (padding[1] - padding[3]) / 2 * resolution;
            centerRotY += (padding[0] - padding[2]) / 2 * resolution;
            var centerX = centerRotX * cosAngle - centerRotY * sinAngle;
            var centerY = centerRotY * cosAngle + centerRotX * sinAngle;
            var center = [ centerX, centerY ];
            var callback = options.callback ? options.callback : _index2.default.nullFunction;
            if (options.duration !== undefined) {
                this.animate({
                    resolution: resolution,
                    center: center,
                    duration: options.duration,
                    easing: options.easing
                }, callback);
            } else {
                this.setResolution(resolution);
                this.setCenter(center);
                setTimeout(callback.bind(undefined, true), 0);
            }
        };
        _ol_View_.prototype.centerOn = function(coordinate, size, position) {
            var rotation = this.getRotation();
            var cosAngle = Math.cos(-rotation);
            var sinAngle = Math.sin(-rotation);
            var rotX = coordinate[0] * cosAngle - coordinate[1] * sinAngle;
            var rotY = coordinate[1] * cosAngle + coordinate[0] * sinAngle;
            var resolution = this.getResolution();
            rotX += (size[0] / 2 - position[0]) * resolution;
            rotY += (position[1] - size[1] / 2) * resolution;
            sinAngle = -sinAngle;
            var centerX = rotX * cosAngle - rotY * sinAngle;
            var centerY = rotY * cosAngle + rotX * sinAngle;
            this.setCenter([ centerX, centerY ]);
        };
        _ol_View_.prototype.isDef = function() {
            return !!this.getCenter() && this.getResolution() !== undefined;
        };
        _ol_View_.prototype.rotate = function(rotation, opt_anchor) {
            if (opt_anchor !== undefined) {
                var center = this.calculateCenterRotate(rotation, opt_anchor);
                this.setCenter(center);
            }
            this.setRotation(rotation);
        };
        _ol_View_.prototype.setCenter = function(center) {
            this.set(_viewproperty2.default.CENTER, center);
            if (this.getAnimating()) {
                this.cancelAnimations();
            }
        };
        _ol_View_.prototype.setHint = function(hint, delta) {
            this.hints_[hint] += delta;
            this.changed();
            return this.hints_[hint];
        };
        _ol_View_.prototype.setResolution = function(resolution) {
            this.set(_viewproperty2.default.RESOLUTION, resolution);
            if (this.getAnimating()) {
                this.cancelAnimations();
            }
        };
        _ol_View_.prototype.setRotation = function(rotation) {
            this.set(_viewproperty2.default.ROTATION, rotation);
            if (this.getAnimating()) {
                this.cancelAnimations();
            }
        };
        _ol_View_.prototype.setZoom = function(zoom) {
            this.setResolution(this.getResolutionForZoom(zoom));
        };
        _ol_View_.createCenterConstraint_ = function(options) {
            if (options.extent !== undefined) {
                return _centerconstraint2.default.createExtent(options.extent);
            } else {
                return _centerconstraint2.default.none;
            }
        };
        _ol_View_.createResolutionConstraint_ = function(options) {
            var resolutionConstraint;
            var maxResolution;
            var minResolution;
            var defaultMaxZoom = 28;
            var defaultZoomFactor = 2;
            var minZoom = options.minZoom !== undefined ? options.minZoom : _index2.default.DEFAULT_MIN_ZOOM;
            var maxZoom = options.maxZoom !== undefined ? options.maxZoom : defaultMaxZoom;
            var zoomFactor = options.zoomFactor !== undefined ? options.zoomFactor : defaultZoomFactor;
            if (options.resolutions !== undefined) {
                var resolutions = options.resolutions;
                maxResolution = resolutions[minZoom];
                minResolution = resolutions[maxZoom] !== undefined ? resolutions[maxZoom] : resolutions[resolutions.length - 1];
                resolutionConstraint = _resolutionconstraint2.default.createSnapToResolutions(resolutions);
            } else {
                var projection = _proj2.default.createProjection(options.projection, "EPSG:3857");
                var extent = projection.getExtent();
                var size = !extent ? 360 * _proj2.default.METERS_PER_UNIT[_units2.default.DEGREES] / projection.getMetersPerUnit() : Math.max(_extent2.default.getWidth(extent), _extent2.default.getHeight(extent));
                var defaultMaxResolution = size / _index2.default.DEFAULT_TILE_SIZE / Math.pow(defaultZoomFactor, _index2.default.DEFAULT_MIN_ZOOM);
                var defaultMinResolution = defaultMaxResolution / Math.pow(defaultZoomFactor, defaultMaxZoom - _index2.default.DEFAULT_MIN_ZOOM);
                maxResolution = options.maxResolution;
                if (maxResolution !== undefined) {
                    minZoom = 0;
                } else {
                    maxResolution = defaultMaxResolution / Math.pow(zoomFactor, minZoom);
                }
                minResolution = options.minResolution;
                if (minResolution === undefined) {
                    if (options.maxZoom !== undefined) {
                        if (options.maxResolution !== undefined) {
                            minResolution = maxResolution / Math.pow(zoomFactor, maxZoom);
                        } else {
                            minResolution = defaultMaxResolution / Math.pow(zoomFactor, maxZoom);
                        }
                    } else {
                        minResolution = defaultMinResolution;
                    }
                }
                maxZoom = minZoom + Math.floor(Math.log(maxResolution / minResolution) / Math.log(zoomFactor));
                minResolution = maxResolution / Math.pow(zoomFactor, maxZoom - minZoom);
                resolutionConstraint = _resolutionconstraint2.default.createSnapToPower(zoomFactor, maxResolution, maxZoom - minZoom);
            }
            return {
                constraint: resolutionConstraint,
                maxResolution: maxResolution,
                minResolution: minResolution,
                minZoom: minZoom,
                zoomFactor: zoomFactor
            };
        };
        _ol_View_.createRotationConstraint_ = function(options) {
            var enableRotation = options.enableRotation !== undefined ? options.enableRotation : true;
            if (enableRotation) {
                var constrainRotation = options.constrainRotation;
                if (constrainRotation === undefined || constrainRotation === true) {
                    return _rotationconstraint2.default.createSnapToZero();
                } else if (constrainRotation === false) {
                    return _rotationconstraint2.default.none;
                } else if (typeof constrainRotation === "number") {
                    return _rotationconstraint2.default.createSnapToN(constrainRotation);
                } else {
                    return _rotationconstraint2.default.none;
                }
            } else {
                return _rotationconstraint2.default.disable;
            }
        };
        _ol_View_.isNoopAnimation = function(animation) {
            if (animation.sourceCenter && animation.targetCenter) {
                if (!_coordinate2.default.equals(animation.sourceCenter, animation.targetCenter)) {
                    return false;
                }
            }
            if (animation.sourceResolution !== animation.targetResolution) {
                return false;
            }
            if (animation.sourceRotation !== animation.targetRotation) {
                return false;
            }
            return true;
        };
        exports.default = _ol_View_;
    }, {
        "./array.js": 29,
        "./asserts.js": 31,
        "./centerconstraint.js": 33,
        "./coordinate.js": 43,
        "./easing.js": 47,
        "./extent.js": 54,
        "./geom/geometrytype.js": 79,
        "./geom/polygon.js": 82,
        "./geom/simplegeometry.js": 83,
        "./index.js": 89,
        "./math.js": 123,
        "./obj.js": 124,
        "./object.js": 125,
        "./proj.js": 141,
        "./proj/units.js": 148,
        "./resolutionconstraint.js": 206,
        "./rotationconstraint.js": 207,
        "./viewhint.js": 246,
        "./viewproperty.js": 247
    } ],
    246: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_ViewHint_ = {
            ANIMATING: 0,
            INTERACTING: 1
        };
        exports.default = _ol_ViewHint_;
    }, {} ],
    247: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_ViewProperty_ = {
            CENTER: "center",
            RESOLUTION: "resolution",
            ROTATION: "rotation"
        };
        exports.default = _ol_ViewProperty_;
    }, {} ],
    248: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_webgl_ = {};
        _ol_webgl_.ONE = 1;
        _ol_webgl_.SRC_ALPHA = 770;
        _ol_webgl_.COLOR_ATTACHMENT0 = 36064;
        _ol_webgl_.COLOR_BUFFER_BIT = 16384;
        _ol_webgl_.TRIANGLES = 4;
        _ol_webgl_.TRIANGLE_STRIP = 5;
        _ol_webgl_.ONE_MINUS_SRC_ALPHA = 771;
        _ol_webgl_.ARRAY_BUFFER = 34962;
        _ol_webgl_.ELEMENT_ARRAY_BUFFER = 34963;
        _ol_webgl_.STREAM_DRAW = 35040;
        _ol_webgl_.STATIC_DRAW = 35044;
        _ol_webgl_.DYNAMIC_DRAW = 35048;
        _ol_webgl_.CULL_FACE = 2884;
        _ol_webgl_.BLEND = 3042;
        _ol_webgl_.STENCIL_TEST = 2960;
        _ol_webgl_.DEPTH_TEST = 2929;
        _ol_webgl_.SCISSOR_TEST = 3089;
        _ol_webgl_.UNSIGNED_BYTE = 5121;
        _ol_webgl_.UNSIGNED_SHORT = 5123;
        _ol_webgl_.UNSIGNED_INT = 5125;
        _ol_webgl_.FLOAT = 5126;
        _ol_webgl_.RGBA = 6408;
        _ol_webgl_.FRAGMENT_SHADER = 35632;
        _ol_webgl_.VERTEX_SHADER = 35633;
        _ol_webgl_.LINK_STATUS = 35714;
        _ol_webgl_.LINEAR = 9729;
        _ol_webgl_.TEXTURE_MAG_FILTER = 10240;
        _ol_webgl_.TEXTURE_MIN_FILTER = 10241;
        _ol_webgl_.TEXTURE_WRAP_S = 10242;
        _ol_webgl_.TEXTURE_WRAP_T = 10243;
        _ol_webgl_.TEXTURE_2D = 3553;
        _ol_webgl_.TEXTURE0 = 33984;
        _ol_webgl_.CLAMP_TO_EDGE = 33071;
        _ol_webgl_.COMPILE_STATUS = 35713;
        _ol_webgl_.FRAMEBUFFER = 36160;
        _ol_webgl_.CONTEXT_IDS_ = [ "experimental-webgl", "webgl", "webkit-3d", "moz-webgl" ];
        _ol_webgl_.getContext = function(canvas, opt_attributes) {
            var context, i, ii = _ol_webgl_.CONTEXT_IDS_.length;
            for (i = 0; i < ii; ++i) {
                try {
                    context = canvas.getContext(_ol_webgl_.CONTEXT_IDS_[i], opt_attributes);
                    if (context) {
                        return context;
                    }
                } catch (e) {}
            }
            return null;
        };
        exports.default = _ol_webgl_;
    }, {} ],
    249: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _webgl = require("../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_webgl_Buffer_ = function(opt_arr, opt_usage) {
            this.arr_ = opt_arr !== undefined ? opt_arr : [];
            this.usage_ = opt_usage !== undefined ? opt_usage : _ol_webgl_Buffer_.Usage_.STATIC_DRAW;
        };
        _ol_webgl_Buffer_.prototype.getArray = function() {
            return this.arr_;
        };
        _ol_webgl_Buffer_.prototype.getUsage = function() {
            return this.usage_;
        };
        _ol_webgl_Buffer_.Usage_ = {
            STATIC_DRAW: _webgl2.default.STATIC_DRAW,
            STREAM_DRAW: _webgl2.default.STREAM_DRAW,
            DYNAMIC_DRAW: _webgl2.default.DYNAMIC_DRAW
        };
        exports.default = _ol_webgl_Buffer_;
    }, {
        "../webgl.js": 248
    } ],
    250: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _disposable = require("../disposable.js");
        var _disposable2 = _interopRequireDefault(_disposable);
        var _array = require("../array.js");
        var _array2 = _interopRequireDefault(_array);
        var _events = require("../events.js");
        var _events2 = _interopRequireDefault(_events);
        var _obj = require("../obj.js");
        var _obj2 = _interopRequireDefault(_obj);
        var _webgl = require("../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _contexteventtype = require("../webgl/contexteventtype.js");
        var _contexteventtype2 = _interopRequireDefault(_contexteventtype);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_webgl_Context_ = function(canvas, gl) {
            this.canvas_ = canvas;
            this.gl_ = gl;
            this.bufferCache_ = {};
            this.shaderCache_ = {};
            this.programCache_ = {};
            this.currentProgram_ = null;
            this.hitDetectionFramebuffer_ = null;
            this.hitDetectionTexture_ = null;
            this.hitDetectionRenderbuffer_ = null;
            this.hasOESElementIndexUint = _array2.default.includes(_index2.default.WEBGL_EXTENSIONS, "OES_element_index_uint");
            if (this.hasOESElementIndexUint) {
                gl.getExtension("OES_element_index_uint");
            }
            _events2.default.listen(this.canvas_, _contexteventtype2.default.LOST, this.handleWebGLContextLost, this);
            _events2.default.listen(this.canvas_, _contexteventtype2.default.RESTORED, this.handleWebGLContextRestored, this);
        };
        _index2.default.inherits(_ol_webgl_Context_, _disposable2.default);
        _ol_webgl_Context_.prototype.bindBuffer = function(target, buf) {
            var gl = this.getGL();
            var arr = buf.getArray();
            var bufferKey = String(_index2.default.getUid(buf));
            if (bufferKey in this.bufferCache_) {
                var bufferCacheEntry = this.bufferCache_[bufferKey];
                gl.bindBuffer(target, bufferCacheEntry.buffer);
            } else {
                var buffer = gl.createBuffer();
                gl.bindBuffer(target, buffer);
                var arrayBuffer;
                if (target == _webgl2.default.ARRAY_BUFFER) {
                    arrayBuffer = new Float32Array(arr);
                } else if (target == _webgl2.default.ELEMENT_ARRAY_BUFFER) {
                    arrayBuffer = this.hasOESElementIndexUint ? new Uint32Array(arr) : new Uint16Array(arr);
                }
                gl.bufferData(target, arrayBuffer, buf.getUsage());
                this.bufferCache_[bufferKey] = {
                    buf: buf,
                    buffer: buffer
                };
            }
        };
        _ol_webgl_Context_.prototype.deleteBuffer = function(buf) {
            var gl = this.getGL();
            var bufferKey = String(_index2.default.getUid(buf));
            var bufferCacheEntry = this.bufferCache_[bufferKey];
            if (!gl.isContextLost()) {
                gl.deleteBuffer(bufferCacheEntry.buffer);
            }
            delete this.bufferCache_[bufferKey];
        };
        _ol_webgl_Context_.prototype.disposeInternal = function() {
            _events2.default.unlistenAll(this.canvas_);
            var gl = this.getGL();
            if (!gl.isContextLost()) {
                var key;
                for (key in this.bufferCache_) {
                    gl.deleteBuffer(this.bufferCache_[key].buffer);
                }
                for (key in this.programCache_) {
                    gl.deleteProgram(this.programCache_[key]);
                }
                for (key in this.shaderCache_) {
                    gl.deleteShader(this.shaderCache_[key]);
                }
                gl.deleteFramebuffer(this.hitDetectionFramebuffer_);
                gl.deleteRenderbuffer(this.hitDetectionRenderbuffer_);
                gl.deleteTexture(this.hitDetectionTexture_);
            }
        };
        _ol_webgl_Context_.prototype.getCanvas = function() {
            return this.canvas_;
        };
        _ol_webgl_Context_.prototype.getGL = function() {
            return this.gl_;
        };
        _ol_webgl_Context_.prototype.getHitDetectionFramebuffer = function() {
            if (!this.hitDetectionFramebuffer_) {
                this.initHitDetectionFramebuffer_();
            }
            return this.hitDetectionFramebuffer_;
        };
        _ol_webgl_Context_.prototype.getShader = function(shaderObject) {
            var shaderKey = String(_index2.default.getUid(shaderObject));
            if (shaderKey in this.shaderCache_) {
                return this.shaderCache_[shaderKey];
            } else {
                var gl = this.getGL();
                var shader = gl.createShader(shaderObject.getType());
                gl.shaderSource(shader, shaderObject.getSource());
                gl.compileShader(shader);
                this.shaderCache_[shaderKey] = shader;
                return shader;
            }
        };
        _ol_webgl_Context_.prototype.getProgram = function(fragmentShaderObject, vertexShaderObject) {
            var programKey = _index2.default.getUid(fragmentShaderObject) + "/" + _index2.default.getUid(vertexShaderObject);
            if (programKey in this.programCache_) {
                return this.programCache_[programKey];
            } else {
                var gl = this.getGL();
                var program = gl.createProgram();
                gl.attachShader(program, this.getShader(fragmentShaderObject));
                gl.attachShader(program, this.getShader(vertexShaderObject));
                gl.linkProgram(program);
                this.programCache_[programKey] = program;
                return program;
            }
        };
        _ol_webgl_Context_.prototype.handleWebGLContextLost = function() {
            _obj2.default.clear(this.bufferCache_);
            _obj2.default.clear(this.shaderCache_);
            _obj2.default.clear(this.programCache_);
            this.currentProgram_ = null;
            this.hitDetectionFramebuffer_ = null;
            this.hitDetectionTexture_ = null;
            this.hitDetectionRenderbuffer_ = null;
        };
        _ol_webgl_Context_.prototype.handleWebGLContextRestored = function() {};
        _ol_webgl_Context_.prototype.initHitDetectionFramebuffer_ = function() {
            var gl = this.gl_;
            var framebuffer = gl.createFramebuffer();
            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
            var texture = _ol_webgl_Context_.createEmptyTexture(gl, 1, 1);
            var renderbuffer = gl.createRenderbuffer();
            gl.bindRenderbuffer(gl.RENDERBUFFER, renderbuffer);
            gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, 1, 1);
            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);
            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, renderbuffer);
            gl.bindTexture(gl.TEXTURE_2D, null);
            gl.bindRenderbuffer(gl.RENDERBUFFER, null);
            gl.bindFramebuffer(gl.FRAMEBUFFER, null);
            this.hitDetectionFramebuffer_ = framebuffer;
            this.hitDetectionTexture_ = texture;
            this.hitDetectionRenderbuffer_ = renderbuffer;
        };
        _ol_webgl_Context_.prototype.useProgram = function(program) {
            if (program == this.currentProgram_) {
                return false;
            } else {
                var gl = this.getGL();
                gl.useProgram(program);
                this.currentProgram_ = program;
                return true;
            }
        };
        _ol_webgl_Context_.createTexture_ = function(gl, opt_wrapS, opt_wrapT) {
            var texture = gl.createTexture();
            gl.bindTexture(gl.TEXTURE_2D, texture);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
            if (opt_wrapS !== undefined) {
                gl.texParameteri(_webgl2.default.TEXTURE_2D, _webgl2.default.TEXTURE_WRAP_S, opt_wrapS);
            }
            if (opt_wrapT !== undefined) {
                gl.texParameteri(_webgl2.default.TEXTURE_2D, _webgl2.default.TEXTURE_WRAP_T, opt_wrapT);
            }
            return texture;
        };
        _ol_webgl_Context_.createEmptyTexture = function(gl, width, height, opt_wrapS, opt_wrapT) {
            var texture = _ol_webgl_Context_.createTexture_(gl, opt_wrapS, opt_wrapT);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
            return texture;
        };
        _ol_webgl_Context_.createTexture = function(gl, image, opt_wrapS, opt_wrapT) {
            var texture = _ol_webgl_Context_.createTexture_(gl, opt_wrapS, opt_wrapT);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);
            return texture;
        };
        exports.default = _ol_webgl_Context_;
    }, {
        "../array.js": 29,
        "../disposable.js": 45,
        "../events.js": 48,
        "../index.js": 89,
        "../obj.js": 124,
        "../webgl.js": 248,
        "../webgl/contexteventtype.js": 251
    } ],
    251: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _ol_webgl_ContextEventType_ = {
            LOST: "webglcontextlost",
            RESTORED: "webglcontextrestored"
        };
        exports.default = _ol_webgl_ContextEventType_;
    }, {} ],
    252: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _webgl = require("../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _shader = require("../webgl/shader.js");
        var _shader2 = _interopRequireDefault(_shader);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_webgl_Fragment_ = function(source) {
            _shader2.default.call(this, source);
        };
        _index2.default.inherits(_ol_webgl_Fragment_, _shader2.default);
        _ol_webgl_Fragment_.prototype.getType = function() {
            return _webgl2.default.FRAGMENT_SHADER;
        };
        exports.default = _ol_webgl_Fragment_;
    }, {
        "../index.js": 89,
        "../webgl.js": 248,
        "../webgl/shader.js": 253
    } ],
    253: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _functions = require("../functions.js");
        var _functions2 = _interopRequireDefault(_functions);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_webgl_Shader_ = function(source) {
            this.source_ = source;
        };
        _ol_webgl_Shader_.prototype.getType = function() {};
        _ol_webgl_Shader_.prototype.getSource = function() {
            return this.source_;
        };
        _ol_webgl_Shader_.prototype.isAnimated = _functions2.default.FALSE;
        exports.default = _ol_webgl_Shader_;
    }, {
        "../functions.js": 60
    } ],
    254: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _index = require("../index.js");
        var _index2 = _interopRequireDefault(_index);
        var _webgl = require("../webgl.js");
        var _webgl2 = _interopRequireDefault(_webgl);
        var _shader = require("../webgl/shader.js");
        var _shader2 = _interopRequireDefault(_shader);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_webgl_Vertex_ = function(source) {
            _shader2.default.call(this, source);
        };
        _index2.default.inherits(_ol_webgl_Vertex_, _shader2.default);
        _ol_webgl_Vertex_.prototype.getType = function() {
            return _webgl2.default.VERTEX_SHADER;
        };
        exports.default = _ol_webgl_Vertex_;
    }, {
        "../index.js": 89,
        "../webgl.js": 248,
        "../webgl/shader.js": 253
    } ],
    255: [ function(require, module, exports) {
        "use strict";
        Object.defineProperty(exports, "__esModule", {
            value: true
        });
        var _array = require("./array.js");
        var _array2 = _interopRequireDefault(_array);
        function _interopRequireDefault(obj) {
            return obj && obj.__esModule ? obj : {
                default: obj
            };
        }
        var _ol_xml_ = {};
        _ol_xml_.DOCUMENT = document.implementation.createDocument("", "", null);
        _ol_xml_.createElementNS = function(namespaceURI, qualifiedName) {
            return _ol_xml_.DOCUMENT.createElementNS(namespaceURI, qualifiedName);
        };
        _ol_xml_.getAllTextContent = function(node, normalizeWhitespace) {
            return _ol_xml_.getAllTextContent_(node, normalizeWhitespace, []).join("");
        };
        _ol_xml_.getAllTextContent_ = function(node, normalizeWhitespace, accumulator) {
            if (node.nodeType == Node.CDATA_SECTION_NODE || node.nodeType == Node.TEXT_NODE) {
                if (normalizeWhitespace) {
                    accumulator.push(String(node.nodeValue).replace(/(\r\n|\r|\n)/g, ""));
                } else {
                    accumulator.push(node.nodeValue);
                }
            } else {
                var n;
                for (n = node.firstChild; n; n = n.nextSibling) {
                    _ol_xml_.getAllTextContent_(n, normalizeWhitespace, accumulator);
                }
            }
            return accumulator;
        };
        _ol_xml_.isDocument = function(value) {
            return value instanceof Document;
        };
        _ol_xml_.isNode = function(value) {
            return value instanceof Node;
        };
        _ol_xml_.getAttributeNS = function(node, namespaceURI, name) {
            return node.getAttributeNS(namespaceURI, name) || "";
        };
        _ol_xml_.setAttributeNS = function(node, namespaceURI, name, value) {
            node.setAttributeNS(namespaceURI, name, value);
        };
        _ol_xml_.parse = function(xml) {
            return new DOMParser().parseFromString(xml, "application/xml");
        };
        _ol_xml_.makeArrayExtender = function(valueReader, opt_this) {
            return function(node, objectStack) {
                var value = valueReader.call(opt_this, node, objectStack);
                if (value !== undefined) {
                    var array = objectStack[objectStack.length - 1];
                    _array2.default.extend(array, value);
                }
            };
        };
        _ol_xml_.makeArrayPusher = function(valueReader, opt_this) {
            return function(node, objectStack) {
                var value = valueReader.call(opt_this !== undefined ? opt_this : this, node, objectStack);
                if (value !== undefined) {
                    var array = objectStack[objectStack.length - 1];
                    array.push(value);
                }
            };
        };
        _ol_xml_.makeReplacer = function(valueReader, opt_this) {
            return function(node, objectStack) {
                var value = valueReader.call(opt_this !== undefined ? opt_this : this, node, objectStack);
                if (value !== undefined) {
                    objectStack[objectStack.length - 1] = value;
                }
            };
        };
        _ol_xml_.makeObjectPropertyPusher = function(valueReader, opt_property, opt_this) {
            return function(node, objectStack) {
                var value = valueReader.call(opt_this !== undefined ? opt_this : this, node, objectStack);
                if (value !== undefined) {
                    var object = objectStack[objectStack.length - 1];
                    var property = opt_property !== undefined ? opt_property : node.localName;
                    var array;
                    if (property in object) {
                        array = object[property];
                    } else {
                        array = object[property] = [];
                    }
                    array.push(value);
                }
            };
        };
        _ol_xml_.makeObjectPropertySetter = function(valueReader, opt_property, opt_this) {
            return function(node, objectStack) {
                var value = valueReader.call(opt_this !== undefined ? opt_this : this, node, objectStack);
                if (value !== undefined) {
                    var object = objectStack[objectStack.length - 1];
                    var property = opt_property !== undefined ? opt_property : node.localName;
                    object[property] = value;
                }
            };
        };
        _ol_xml_.makeChildAppender = function(nodeWriter, opt_this) {
            return function(node, value, objectStack) {
                nodeWriter.call(opt_this !== undefined ? opt_this : this, node, value, objectStack);
                var parent = objectStack[objectStack.length - 1];
                var parentNode = parent.node;
                parentNode.appendChild(node);
            };
        };
        _ol_xml_.makeArraySerializer = function(nodeWriter, opt_this) {
            var serializersNS, nodeFactory;
            return function(node, value, objectStack) {
                if (serializersNS === undefined) {
                    serializersNS = {};
                    var serializers = {};
                    serializers[node.localName] = nodeWriter;
                    serializersNS[node.namespaceURI] = serializers;
                    nodeFactory = _ol_xml_.makeSimpleNodeFactory(node.localName);
                }
                _ol_xml_.serialize(serializersNS, nodeFactory, value, objectStack);
            };
        };
        _ol_xml_.makeSimpleNodeFactory = function(opt_nodeName, opt_namespaceURI) {
            var fixedNodeName = opt_nodeName;
            return function(value, objectStack, opt_nodeName) {
                var context = objectStack[objectStack.length - 1];
                var node = context.node;
                var nodeName = fixedNodeName;
                if (nodeName === undefined) {
                    nodeName = opt_nodeName;
                }
                var namespaceURI = opt_namespaceURI;
                if (opt_namespaceURI === undefined) {
                    namespaceURI = node.namespaceURI;
                }
                return _ol_xml_.createElementNS(namespaceURI, nodeName);
            };
        };
        _ol_xml_.OBJECT_PROPERTY_NODE_FACTORY = _ol_xml_.makeSimpleNodeFactory();
        _ol_xml_.makeSequence = function(object, orderedKeys) {
            var length = orderedKeys.length;
            var sequence = new Array(length);
            for (var i = 0; i < length; ++i) {
                sequence[i] = object[orderedKeys[i]];
            }
            return sequence;
        };
        _ol_xml_.makeStructureNS = function(namespaceURIs, structure, opt_structureNS) {
            var structureNS = opt_structureNS !== undefined ? opt_structureNS : {};
            var i, ii;
            for (i = 0, ii = namespaceURIs.length; i < ii; ++i) {
                structureNS[namespaceURIs[i]] = structure;
            }
            return structureNS;
        };
        _ol_xml_.parseNode = function(parsersNS, node, objectStack, opt_this) {
            var n;
            for (n = node.firstElementChild; n; n = n.nextElementSibling) {
                var parsers = parsersNS[n.namespaceURI];
                if (parsers !== undefined) {
                    var parser = parsers[n.localName];
                    if (parser !== undefined) {
                        parser.call(opt_this, n, objectStack);
                    }
                }
            }
        };
        _ol_xml_.pushParseAndPop = function(object, parsersNS, node, objectStack, opt_this) {
            objectStack.push(object);
            _ol_xml_.parseNode(parsersNS, node, objectStack, opt_this);
            return objectStack.pop();
        };
        _ol_xml_.serialize = function(serializersNS, nodeFactory, values, objectStack, opt_keys, opt_this) {
            var length = (opt_keys !== undefined ? opt_keys : values).length;
            var value, node;
            for (var i = 0; i < length; ++i) {
                value = values[i];
                if (value !== undefined) {
                    node = nodeFactory.call(opt_this, value, objectStack, opt_keys !== undefined ? opt_keys[i] : undefined);
                    if (node !== undefined) {
                        serializersNS[node.namespaceURI][node.localName].call(opt_this, node, value, objectStack);
                    }
                }
            }
        };
        _ol_xml_.pushSerializeAndPop = function(object, serializersNS, nodeFactory, values, objectStack, opt_keys, opt_this) {
            objectStack.push(object);
            _ol_xml_.serialize(serializersNS, nodeFactory, values, objectStack, opt_keys, opt_this);
            return objectStack.pop();
        };
        exports.default = _ol_xml_;
    }, {
        "./array.js": 29
    } ],
    256: [ function(require, module, exports) {
        var process = module.exports = {};
        var cachedSetTimeout;
        var cachedClearTimeout;
        function defaultSetTimout() {
            throw new Error("setTimeout has not been defined");
        }
        function defaultClearTimeout() {
            throw new Error("clearTimeout has not been defined");
        }
        (function() {
            try {
                if (typeof setTimeout === "function") {
                    cachedSetTimeout = setTimeout;
                } else {
                    cachedSetTimeout = defaultSetTimout;
                }
            } catch (e) {
                cachedSetTimeout = defaultSetTimout;
            }
            try {
                if (typeof clearTimeout === "function") {
                    cachedClearTimeout = clearTimeout;
                } else {
                    cachedClearTimeout = defaultClearTimeout;
                }
            } catch (e) {
                cachedClearTimeout = defaultClearTimeout;
            }
        })();
        function runTimeout(fun) {
            if (cachedSetTimeout === setTimeout) {
                return setTimeout(fun, 0);
            }
            if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
                cachedSetTimeout = setTimeout;
                return setTimeout(fun, 0);
            }
            try {
                return cachedSetTimeout(fun, 0);
            } catch (e) {
                try {
                    return cachedSetTimeout.call(null, fun, 0);
                } catch (e) {
                    return cachedSetTimeout.call(this, fun, 0);
                }
            }
        }
        function runClearTimeout(marker) {
            if (cachedClearTimeout === clearTimeout) {
                return clearTimeout(marker);
            }
            if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
                cachedClearTimeout = clearTimeout;
                return clearTimeout(marker);
            }
            try {
                return cachedClearTimeout(marker);
            } catch (e) {
                try {
                    return cachedClearTimeout.call(null, marker);
                } catch (e) {
                    return cachedClearTimeout.call(this, marker);
                }
            }
        }
        var queue = [];
        var draining = false;
        var currentQueue;
        var queueIndex = -1;
        function cleanUpNextTick() {
            if (!draining || !currentQueue) {
                return;
            }
            draining = false;
            if (currentQueue.length) {
                queue = currentQueue.concat(queue);
            } else {
                queueIndex = -1;
            }
            if (queue.length) {
                drainQueue();
            }
        }
        function drainQueue() {
            if (draining) {
                return;
            }
            var timeout = runTimeout(cleanUpNextTick);
            draining = true;
            var len = queue.length;
            while (len) {
                currentQueue = queue;
                queue = [];
                while (++queueIndex < len) {
                    if (currentQueue) {
                        currentQueue[queueIndex].run();
                    }
                }
                queueIndex = -1;
                len = queue.length;
            }
            currentQueue = null;
            draining = false;
            runClearTimeout(timeout);
        }
        process.nextTick = function(fun) {
            var args = new Array(arguments.length - 1);
            if (arguments.length > 1) {
                for (var i = 1; i < arguments.length; i++) {
                    args[i - 1] = arguments[i];
                }
            }
            queue.push(new Item(fun, args));
            if (queue.length === 1 && !draining) {
                runTimeout(drainQueue);
            }
        };
        function Item(fun, array) {
            this.fun = fun;
            this.array = array;
        }
        Item.prototype.run = function() {
            this.fun.apply(null, this.array);
        };
        process.title = "browser";
        process.browser = true;
        process.env = {};
        process.argv = [];
        process.version = "";
        process.versions = {};
        function noop() {}
        process.on = noop;
        process.addListener = noop;
        process.once = noop;
        process.off = noop;
        process.removeListener = noop;
        process.removeAllListeners = noop;
        process.emit = noop;
        process.prependListener = noop;
        process.prependOnceListener = noop;
        process.listeners = function(name) {
            return [];
        };
        process.binding = function(name) {
            throw new Error("process.binding is not supported");
        };
        process.cwd = function() {
            return "/";
        };
        process.chdir = function(dir) {
            throw new Error("process.chdir is not supported");
        };
        process.umask = function() {
            return 0;
        };
    }, {} ],
    257: [ function(require, module, exports) {
        (function(global, factory) {
            typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory() : typeof define === "function" && define.amd ? define(factory) : global.quickselect = factory();
        })(this, function() {
            "use strict";
            function quickselect(arr, k, left, right, compare) {
                quickselectStep(arr, k, left || 0, right || arr.length - 1, compare || defaultCompare);
            }
            function quickselectStep(arr, k, left, right, compare) {
                while (right > left) {
                    if (right - left > 600) {
                        var n = right - left + 1;
                        var m = k - left + 1;
                        var z = Math.log(n);
                        var s = .5 * Math.exp(2 * z / 3);
                        var sd = .5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);
                        var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));
                        var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));
                        quickselectStep(arr, k, newLeft, newRight, compare);
                    }
                    var t = arr[k];
                    var i = left;
                    var j = right;
                    swap(arr, left, k);
                    if (compare(arr[right], t) > 0) swap(arr, left, right);
                    while (i < j) {
                        swap(arr, i, j);
                        i++;
                        j--;
                        while (compare(arr[i], t) < 0) i++;
                        while (compare(arr[j], t) > 0) j--;
                    }
                    if (compare(arr[left], t) === 0) swap(arr, left, j); else {
                        j++;
                        swap(arr, j, right);
                    }
                    if (j <= k) left = j + 1;
                    if (k <= j) right = j - 1;
                }
            }
            function swap(arr, i, j) {
                var tmp = arr[i];
                arr[i] = arr[j];
                arr[j] = tmp;
            }
            function defaultCompare(a, b) {
                return a < b ? -1 : a > b ? 1 : 0;
            }
            return quickselect;
        });
    }, {} ],
    258: [ function(require, module, exports) {
        "use strict";
        module.exports = rbush;
        var quickselect = require("quickselect");
        function rbush(maxEntries, format) {
            if (!(this instanceof rbush)) return new rbush(maxEntries, format);
            this._maxEntries = Math.max(4, maxEntries || 9);
            this._minEntries = Math.max(2, Math.ceil(this._maxEntries * .4));
            if (format) {
                this._initFormat(format);
            }
            this.clear();
        }
        rbush.prototype = {
            all: function() {
                return this._all(this.data, []);
            },
            search: function(bbox) {
                var node = this.data, result = [], toBBox = this.toBBox;
                if (!intersects(bbox, node)) return result;
                var nodesToSearch = [], i, len, child, childBBox;
                while (node) {
                    for (i = 0, len = node.children.length; i < len; i++) {
                        child = node.children[i];
                        childBBox = node.leaf ? toBBox(child) : child;
                        if (intersects(bbox, childBBox)) {
                            if (node.leaf) result.push(child); else if (contains(bbox, childBBox)) this._all(child, result); else nodesToSearch.push(child);
                        }
                    }
                    node = nodesToSearch.pop();
                }
                return result;
            },
            collides: function(bbox) {
                var node = this.data, toBBox = this.toBBox;
                if (!intersects(bbox, node)) return false;
                var nodesToSearch = [], i, len, child, childBBox;
                while (node) {
                    for (i = 0, len = node.children.length; i < len; i++) {
                        child = node.children[i];
                        childBBox = node.leaf ? toBBox(child) : child;
                        if (intersects(bbox, childBBox)) {
                            if (node.leaf || contains(bbox, childBBox)) return true;
                            nodesToSearch.push(child);
                        }
                    }
                    node = nodesToSearch.pop();
                }
                return false;
            },
            load: function(data) {
                if (!(data && data.length)) return this;
                if (data.length < this._minEntries) {
                    for (var i = 0, len = data.length; i < len; i++) {
                        this.insert(data[i]);
                    }
                    return this;
                }
                var node = this._build(data.slice(), 0, data.length - 1, 0);
                if (!this.data.children.length) {
                    this.data = node;
                } else if (this.data.height === node.height) {
                    this._splitRoot(this.data, node);
                } else {
                    if (this.data.height < node.height) {
                        var tmpNode = this.data;
                        this.data = node;
                        node = tmpNode;
                    }
                    this._insert(node, this.data.height - node.height - 1, true);
                }
                return this;
            },
            insert: function(item) {
                if (item) this._insert(item, this.data.height - 1);
                return this;
            },
            clear: function() {
                this.data = createNode([]);
                return this;
            },
            remove: function(item, equalsFn) {
                if (!item) return this;
                var node = this.data, bbox = this.toBBox(item), path = [], indexes = [], i, parent, index, goingUp;
                while (node || path.length) {
                    if (!node) {
                        node = path.pop();
                        parent = path[path.length - 1];
                        i = indexes.pop();
                        goingUp = true;
                    }
                    if (node.leaf) {
                        index = findItem(item, node.children, equalsFn);
                        if (index !== -1) {
                            node.children.splice(index, 1);
                            path.push(node);
                            this._condense(path);
                            return this;
                        }
                    }
                    if (!goingUp && !node.leaf && contains(node, bbox)) {
                        path.push(node);
                        indexes.push(i);
                        i = 0;
                        parent = node;
                        node = node.children[0];
                    } else if (parent) {
                        i++;
                        node = parent.children[i];
                        goingUp = false;
                    } else node = null;
                }
                return this;
            },
            toBBox: function(item) {
                return item;
            },
            compareMinX: compareNodeMinX,
            compareMinY: compareNodeMinY,
            toJSON: function() {
                return this.data;
            },
            fromJSON: function(data) {
                this.data = data;
                return this;
            },
            _all: function(node, result) {
                var nodesToSearch = [];
                while (node) {
                    if (node.leaf) result.push.apply(result, node.children); else nodesToSearch.push.apply(nodesToSearch, node.children);
                    node = nodesToSearch.pop();
                }
                return result;
            },
            _build: function(items, left, right, height) {
                var N = right - left + 1, M = this._maxEntries, node;
                if (N <= M) {
                    node = createNode(items.slice(left, right + 1));
                    calcBBox(node, this.toBBox);
                    return node;
                }
                if (!height) {
                    height = Math.ceil(Math.log(N) / Math.log(M));
                    M = Math.ceil(N / Math.pow(M, height - 1));
                }
                node = createNode([]);
                node.leaf = false;
                node.height = height;
                var N2 = Math.ceil(N / M), N1 = N2 * Math.ceil(Math.sqrt(M)), i, j, right2, right3;
                multiSelect(items, left, right, N1, this.compareMinX);
                for (i = left; i <= right; i += N1) {
                    right2 = Math.min(i + N1 - 1, right);
                    multiSelect(items, i, right2, N2, this.compareMinY);
                    for (j = i; j <= right2; j += N2) {
                        right3 = Math.min(j + N2 - 1, right2);
                        node.children.push(this._build(items, j, right3, height - 1));
                    }
                }
                calcBBox(node, this.toBBox);
                return node;
            },
            _chooseSubtree: function(bbox, node, level, path) {
                var i, len, child, targetNode, area, enlargement, minArea, minEnlargement;
                while (true) {
                    path.push(node);
                    if (node.leaf || path.length - 1 === level) break;
                    minArea = minEnlargement = Infinity;
                    for (i = 0, len = node.children.length; i < len; i++) {
                        child = node.children[i];
                        area = bboxArea(child);
                        enlargement = enlargedArea(bbox, child) - area;
                        if (enlargement < minEnlargement) {
                            minEnlargement = enlargement;
                            minArea = area < minArea ? area : minArea;
                            targetNode = child;
                        } else if (enlargement === minEnlargement) {
                            if (area < minArea) {
                                minArea = area;
                                targetNode = child;
                            }
                        }
                    }
                    node = targetNode || node.children[0];
                }
                return node;
            },
            _insert: function(item, level, isNode) {
                var toBBox = this.toBBox, bbox = isNode ? item : toBBox(item), insertPath = [];
                var node = this._chooseSubtree(bbox, this.data, level, insertPath);
                node.children.push(item);
                extend(node, bbox);
                while (level >= 0) {
                    if (insertPath[level].children.length > this._maxEntries) {
                        this._split(insertPath, level);
                        level--;
                    } else break;
                }
                this._adjustParentBBoxes(bbox, insertPath, level);
            },
            _split: function(insertPath, level) {
                var node = insertPath[level], M = node.children.length, m = this._minEntries;
                this._chooseSplitAxis(node, m, M);
                var splitIndex = this._chooseSplitIndex(node, m, M);
                var newNode = createNode(node.children.splice(splitIndex, node.children.length - splitIndex));
                newNode.height = node.height;
                newNode.leaf = node.leaf;
                calcBBox(node, this.toBBox);
                calcBBox(newNode, this.toBBox);
                if (level) insertPath[level - 1].children.push(newNode); else this._splitRoot(node, newNode);
            },
            _splitRoot: function(node, newNode) {
                this.data = createNode([ node, newNode ]);
                this.data.height = node.height + 1;
                this.data.leaf = false;
                calcBBox(this.data, this.toBBox);
            },
            _chooseSplitIndex: function(node, m, M) {
                var i, bbox1, bbox2, overlap, area, minOverlap, minArea, index;
                minOverlap = minArea = Infinity;
                for (i = m; i <= M - m; i++) {
                    bbox1 = distBBox(node, 0, i, this.toBBox);
                    bbox2 = distBBox(node, i, M, this.toBBox);
                    overlap = intersectionArea(bbox1, bbox2);
                    area = bboxArea(bbox1) + bboxArea(bbox2);
                    if (overlap < minOverlap) {
                        minOverlap = overlap;
                        index = i;
                        minArea = area < minArea ? area : minArea;
                    } else if (overlap === minOverlap) {
                        if (area < minArea) {
                            minArea = area;
                            index = i;
                        }
                    }
                }
                return index;
            },
            _chooseSplitAxis: function(node, m, M) {
                var compareMinX = node.leaf ? this.compareMinX : compareNodeMinX, compareMinY = node.leaf ? this.compareMinY : compareNodeMinY, xMargin = this._allDistMargin(node, m, M, compareMinX), yMargin = this._allDistMargin(node, m, M, compareMinY);
                if (xMargin < yMargin) node.children.sort(compareMinX);
            },
            _allDistMargin: function(node, m, M, compare) {
                node.children.sort(compare);
                var toBBox = this.toBBox, leftBBox = distBBox(node, 0, m, toBBox), rightBBox = distBBox(node, M - m, M, toBBox), margin = bboxMargin(leftBBox) + bboxMargin(rightBBox), i, child;
                for (i = m; i < M - m; i++) {
                    child = node.children[i];
                    extend(leftBBox, node.leaf ? toBBox(child) : child);
                    margin += bboxMargin(leftBBox);
                }
                for (i = M - m - 1; i >= m; i--) {
                    child = node.children[i];
                    extend(rightBBox, node.leaf ? toBBox(child) : child);
                    margin += bboxMargin(rightBBox);
                }
                return margin;
            },
            _adjustParentBBoxes: function(bbox, path, level) {
                for (var i = level; i >= 0; i--) {
                    extend(path[i], bbox);
                }
            },
            _condense: function(path) {
                for (var i = path.length - 1, siblings; i >= 0; i--) {
                    if (path[i].children.length === 0) {
                        if (i > 0) {
                            siblings = path[i - 1].children;
                            siblings.splice(siblings.indexOf(path[i]), 1);
                        } else this.clear();
                    } else calcBBox(path[i], this.toBBox);
                }
            },
            _initFormat: function(format) {
                var compareArr = [ "return a", " - b", ";" ];
                this.compareMinX = new Function("a", "b", compareArr.join(format[0]));
                this.compareMinY = new Function("a", "b", compareArr.join(format[1]));
                this.toBBox = new Function("a", "return {minX: a" + format[0] + ", minY: a" + format[1] + ", maxX: a" + format[2] + ", maxY: a" + format[3] + "};");
            }
        };
        function findItem(item, items, equalsFn) {
            if (!equalsFn) return items.indexOf(item);
            for (var i = 0; i < items.length; i++) {
                if (equalsFn(item, items[i])) return i;
            }
            return -1;
        }
        function calcBBox(node, toBBox) {
            distBBox(node, 0, node.children.length, toBBox, node);
        }
        function distBBox(node, k, p, toBBox, destNode) {
            if (!destNode) destNode = createNode(null);
            destNode.minX = Infinity;
            destNode.minY = Infinity;
            destNode.maxX = -Infinity;
            destNode.maxY = -Infinity;
            for (var i = k, child; i < p; i++) {
                child = node.children[i];
                extend(destNode, node.leaf ? toBBox(child) : child);
            }
            return destNode;
        }
        function extend(a, b) {
            a.minX = Math.min(a.minX, b.minX);
            a.minY = Math.min(a.minY, b.minY);
            a.maxX = Math.max(a.maxX, b.maxX);
            a.maxY = Math.max(a.maxY, b.maxY);
            return a;
        }
        function compareNodeMinX(a, b) {
            return a.minX - b.minX;
        }
        function compareNodeMinY(a, b) {
            return a.minY - b.minY;
        }
        function bboxArea(a) {
            return (a.maxX - a.minX) * (a.maxY - a.minY);
        }
        function bboxMargin(a) {
            return a.maxX - a.minX + (a.maxY - a.minY);
        }
        function enlargedArea(a, b) {
            return (Math.max(b.maxX, a.maxX) - Math.min(b.minX, a.minX)) * (Math.max(b.maxY, a.maxY) - Math.min(b.minY, a.minY));
        }
        function intersectionArea(a, b) {
            var minX = Math.max(a.minX, b.minX), minY = Math.max(a.minY, b.minY), maxX = Math.min(a.maxX, b.maxX), maxY = Math.min(a.maxY, b.maxY);
            return Math.max(0, maxX - minX) * Math.max(0, maxY - minY);
        }
        function contains(a, b) {
            return a.minX <= b.minX && a.minY <= b.minY && b.maxX <= a.maxX && b.maxY <= a.maxY;
        }
        function intersects(a, b) {
            return b.minX <= a.maxX && b.minY <= a.maxY && b.maxX >= a.minX && b.maxY >= a.minY;
        }
        function createNode(children) {
            return {
                children: children,
                height: 1,
                leaf: true,
                minX: Infinity,
                minY: Infinity,
                maxX: -Infinity,
                maxY: -Infinity
            };
        }
        function multiSelect(arr, left, right, n, compare) {
            var stack = [ left, right ], mid;
            while (stack.length) {
                right = stack.pop();
                left = stack.pop();
                if (right - left <= n) continue;
                mid = left + Math.ceil((right - left) / n / 2) * n;
                quickselect(arr, mid, left, right, compare);
                stack.push(left, mid, mid, right);
            }
        }
    }, {
        quickselect: 257
    } ]
}, {}, [ 1 ]);
