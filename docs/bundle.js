!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){var fuse,InstiMap=require("instimapweb"),autocomplete=require("autocomplete.js"),Fuse=require("fuse.js"),Hammer=require("hammerjs"),locations=[],fuse_options={shouldSort:!0,threshold:.3,tokenize:!0,location:0,distance:7,maxPatternLength:10,minMatchCharLength:1,keys:["name","short_name"]};function locationSelected(loc){null==loc?(document.getElementById("infobox").style.opacity=0,document.getElementById("locfab").classList.remove("translate"),setTimeout(function(){document.getElementById("infobox").style.display="none",document.getElementById("locname").innerText="",document.getElementById("locdesc").innerText=""},300)):(document.getElementById("infobox").style.display="block",document.getElementById("locfab").classList.add("translate"),setTimeout(function(){document.getElementById("infobox").style.opacity=1},100),document.getElementById("locname").innerText=loc.name,document.getElementById("locdesc").innerText=loc.description)}autocomplete("#search",{hint:!0},[{source:function(query,cb){results=fuse.search(query).slice(0,10),cb(results)},displayKey:"short_name",templates:{suggestion:function(suggestion){return suggestion.short_name}}}]).on("autocomplete:selected",function(event,suggestion,dataset,context){InstiMap.moveToLocation(suggestion),locationSelected(suggestion)}),fetch("https://api.insti.app/api/locations").then(function(response){return response.json()}).then(function(jsonResponse){fuse=new Fuse(locations=jsonResponse,fuse_options),InstiMap.getMap({mapPath:"assets/map.jpg",mapMinPath:"assets/map-min.jpg",markersBase:"/assets/map/",attributions:'<a href="http://mrane.com/" target="_blank">Prof. Mandar Rane</a>',map_id:"map",marker_id:"marker",user_marker_id:"user-marker"},locations,function(location){locationSelected(location)},function(){console.log("map loaded")})});var square=document.querySelector("#infobox"),manager=new Hammer.Manager(square),Swipe=new Hammer.Swipe;manager.add(Swipe),manager.on("swipe",function(e){var direction=e.offsetDirection;8===direction?e.target.classList.add("expanded"):16==direction&&e.target.classList.remove("expanded")}),document.getElementById("locfab").addEventListener("click",function(){InstiMap.getGPS()})},{"autocomplete.js":2,"fuse.js":20,hammerjs:21,instimapweb:28}],2:[function(require,module,exports){"use strict";module.exports=require("./src/standalone/")},{"./src/standalone/":17}],3:[function(require,module,exports){"use strict";var _=require("../common/utils.js"),css={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:"0"},defaultClasses:{root:"algolia-autocomplete",prefix:"aa",noPrefix:!1,dropdownMenu:"dropdown-menu",input:"input",hint:"hint",suggestions:"suggestions",suggestion:"suggestion",cursor:"cursor",dataset:"dataset",empty:"empty"},appendTo:{wrapper:{position:"absolute",zIndex:"100",display:"none"},input:{},inputWithNoHint:{},dropdown:{display:"block"}}};_.isMsie()&&_.mixin(css.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),_.isMsie()&&_.isMsie()<=7&&_.mixin(css.input,{marginTop:"-1px"}),module.exports=css},{"../common/utils.js":13}],4:[function(require,module,exports){"use strict";var _=require("../common/utils.js"),DOM=require("../common/dom.js"),html=require("./html.js"),css=require("./css.js"),EventEmitter=require("./event_emitter.js");function Dataset(o){var str,display,templates,displayFn;(o=o||{}).templates=o.templates||{},o.source||_.error("missing source"),o.name&&(str=o.name,!/^[_a-zA-Z0-9-]+$/.test(str))&&_.error("invalid dataset name: "+o.name),this.query=null,this._isEmpty=!0,this.highlight=!!o.highlight,this.name=void 0===o.name||null===o.name?_.getUniqueId():o.name,this.source=o.source,this.displayFn=(display=(display=o.display||o.displayKey)||"value",_.isFunction(display)?display:function(obj){return obj[display]}),this.debounce=o.debounce,this.cache=!1!==o.cache,this.templates=(templates=o.templates,displayFn=this.displayFn,{empty:templates.empty&&_.templatify(templates.empty),header:templates.header&&_.templatify(templates.header),footer:templates.footer&&_.templatify(templates.footer),suggestion:templates.suggestion||function(context){return"<p>"+displayFn(context)+"</p>"}}),this.css=_.mixin({},css,o.appendTo?css.appendTo:{}),this.cssClasses=o.cssClasses=_.mixin({},css.defaultClasses,o.cssClasses||{}),this.cssClasses.prefix=o.cssClasses.formattedPrefix||_.formatPrefix(this.cssClasses.prefix,this.cssClasses.noPrefix);var clazz=_.className(this.cssClasses.prefix,this.cssClasses.dataset);this.$el=o.$menu&&0<o.$menu.find(clazz+"-"+this.name).length?DOM.element(o.$menu.find(clazz+"-"+this.name)[0]):DOM.element(html.dataset.replace("%CLASS%",this.name).replace("%PREFIX%",this.cssClasses.prefix).replace("%DATASET%",this.cssClasses.dataset)),this.$menu=o.$menu,this.clearCachedSuggestions()}Dataset.extractDatasetName=function(el){return DOM.element(el).data("aaDataset")},Dataset.extractValue=function(el){return DOM.element(el).data("aaValue")},Dataset.extractDatum=function(el){var datum=DOM.element(el).data("aaDatum");return"string"==typeof datum&&(datum=JSON.parse(datum)),datum},_.mixin(Dataset.prototype,EventEmitter,{_render:function(query,suggestions){if(this.$el){var hasSuggestions,that=this,renderArgs=[].slice.call(arguments,2);if(this.$el.empty(),hasSuggestions=suggestions&&suggestions.length,this._isEmpty=!hasSuggestions,!hasSuggestions&&this.templates.empty)this.$el.html(function(){var args=[].slice.call(arguments,0);return args=[{query:query,isEmpty:!0}].concat(args),that.templates.empty.apply(this,args)}.apply(this,renderArgs)).prepend(that.templates.header?getHeaderHtml.apply(this,renderArgs):null).append(that.templates.footer?getFooterHtml.apply(this,renderArgs):null);else if(hasSuggestions)this.$el.html(function(){var $suggestions,nodes,args=[].slice.call(arguments,0),self=this,suggestionsHtml=html.suggestions.replace("%PREFIX%",this.cssClasses.prefix).replace("%SUGGESTIONS%",this.cssClasses.suggestions);return $suggestions=DOM.element(suggestionsHtml).css(this.css.suggestions),nodes=_.map(suggestions,function(suggestion){var $el,suggestionHtml=html.suggestion.replace("%PREFIX%",self.cssClasses.prefix).replace("%SUGGESTION%",self.cssClasses.suggestion);return($el=DOM.element(suggestionHtml).attr({role:"option",id:["option",Math.floor(1e8*Math.random())].join("-")}).append(that.templates.suggestion.apply(this,[suggestion].concat(args)))).data("aaDataset",that.name),$el.data("aaValue",that.displayFn(suggestion)||void 0),$el.data("aaDatum",JSON.stringify(suggestion)),$el.children().each(function(){DOM.element(this).css(self.css.suggestionChild)}),$el}),$suggestions.append.apply($suggestions,nodes),$suggestions}.apply(this,renderArgs)).prepend(that.templates.header?getHeaderHtml.apply(this,renderArgs):null).append(that.templates.footer?getFooterHtml.apply(this,renderArgs):null);else if(suggestions&&!Array.isArray(suggestions))throw new TypeError("suggestions must be an array");this.$menu&&this.$menu.addClass(this.cssClasses.prefix+(hasSuggestions?"with":"without")+"-"+this.name).removeClass(this.cssClasses.prefix+(hasSuggestions?"without":"with")+"-"+this.name),this.trigger("rendered",query)}function getHeaderHtml(){var args=[].slice.call(arguments,0);return args=[{query:query,isEmpty:!hasSuggestions}].concat(args),that.templates.header.apply(this,args)}function getFooterHtml(){var args=[].slice.call(arguments,0);return args=[{query:query,isEmpty:!hasSuggestions}].concat(args),that.templates.footer.apply(this,args)}},getRoot:function(){return this.$el},update:function(query){function handleSuggestions(suggestions){if(!this.canceled&&query===this.query){var extraArgs=[].slice.call(arguments,1);this.cacheSuggestions(query,suggestions,extraArgs),this._render.apply(this,[query,suggestions].concat(extraArgs))}}if(this.query=query,this.canceled=!1,this.shouldFetchFromCache(query))handleSuggestions.apply(this,[this.cachedSuggestions].concat(this.cachedRenderExtraArgs));else{var that=this,execSource=function(){that.canceled||that.source(query,handleSuggestions.bind(that))};if(this.debounce){clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(function(){that.debounceTimeout=null,execSource()},this.debounce)}else execSource()}},cacheSuggestions:function(query,suggestions,extraArgs){this.cachedQuery=query,this.cachedSuggestions=suggestions,this.cachedRenderExtraArgs=extraArgs},shouldFetchFromCache:function(query){return this.cache&&this.cachedQuery===query&&this.cachedSuggestions&&this.cachedSuggestions.length},clearCachedSuggestions:function(){delete this.cachedQuery,delete this.cachedSuggestions,delete this.cachedRenderExtraArgs},cancel:function(){this.canceled=!0},clear:function(){this.cancel(),this.$el.empty(),this.trigger("rendered","")},isEmpty:function(){return this._isEmpty},destroy:function(){this.clearCachedSuggestions(),this.$el=null}}),module.exports=Dataset},{"../common/dom.js":11,"../common/utils.js":13,"./css.js":3,"./event_emitter.js":7,"./html.js":8}],5:[function(require,module,exports){"use strict";var _=require("../common/utils.js"),DOM=require("../common/dom.js"),EventEmitter=require("./event_emitter.js"),Dataset=require("./dataset.js"),css=require("./css.js");function Dropdown(o){var onSuggestionClick,onSuggestionMouseEnter,onSuggestionMouseLeave,that=this;(o=o||{}).menu||_.error("menu is required"),_.isArray(o.datasets)||_.isObject(o.datasets)||_.error("1 or more datasets required"),o.datasets||_.error("datasets is required"),this.isOpen=!1,this.isEmpty=!0,this.minLength=o.minLength||0,this.templates={},this.appendTo=o.appendTo||!1,this.css=_.mixin({},css,o.appendTo?css.appendTo:{}),this.cssClasses=o.cssClasses=_.mixin({},css.defaultClasses,o.cssClasses||{}),this.cssClasses.prefix=o.cssClasses.formattedPrefix||_.formatPrefix(this.cssClasses.prefix,this.cssClasses.noPrefix),onSuggestionClick=_.bind(this._onSuggestionClick,this),onSuggestionMouseEnter=_.bind(this._onSuggestionMouseEnter,this),onSuggestionMouseLeave=_.bind(this._onSuggestionMouseLeave,this);var cssClass=_.className(this.cssClasses.prefix,this.cssClasses.suggestion);this.$menu=DOM.element(o.menu).on("mouseenter.aa",cssClass,onSuggestionMouseEnter).on("mouseleave.aa",cssClass,onSuggestionMouseLeave).on("click.aa",cssClass,onSuggestionClick),this.$container=o.appendTo?o.wrapper:this.$menu,o.templates&&o.templates.header&&(this.templates.header=_.templatify(o.templates.header),this.$menu.prepend(this.templates.header())),o.templates&&o.templates.empty&&(this.templates.empty=_.templatify(o.templates.empty),this.$empty=DOM.element('<div class="'+_.className(this.cssClasses.prefix,this.cssClasses.empty,!0)+'"></div>'),this.$menu.append(this.$empty),this.$empty.hide()),this.datasets=_.map(o.datasets,function(oDataset){return function($menu,oDataset,cssClasses){return new Dropdown.Dataset(_.mixin({$menu:$menu,cssClasses:cssClasses},oDataset))}(that.$menu,oDataset,o.cssClasses)}),_.each(this.datasets,function(dataset){var root=dataset.getRoot();root&&0===root.parent().length&&that.$menu.append(root),dataset.onSync("rendered",that._onRendered,that)}),o.templates&&o.templates.footer&&(this.templates.footer=_.templatify(o.templates.footer),this.$menu.append(this.templates.footer()));var self=this;DOM.element(window).resize(function(){self._redraw()})}_.mixin(Dropdown.prototype,EventEmitter,{_onSuggestionClick:function($e){this.trigger("suggestionClicked",DOM.element($e.currentTarget))},_onSuggestionMouseEnter:function($e){var elt=DOM.element($e.currentTarget);if(!elt.hasClass(_.className(this.cssClasses.prefix,this.cssClasses.cursor,!0))){this._removeCursor();var suggestion=this;setTimeout(function(){suggestion._setCursor(elt,!1)},0)}},_onSuggestionMouseLeave:function($e){if($e.relatedTarget&&0<DOM.element($e.relatedTarget).closest("."+_.className(this.cssClasses.prefix,this.cssClasses.cursor,!0)).length)return;this._removeCursor(),this.trigger("cursorRemoved")},_onRendered:function(e,query){if(this.isEmpty=_.every(this.datasets,function(dataset){return dataset.isEmpty()}),this.isEmpty)if(query.length>=this.minLength&&this.trigger("empty"),this.$empty)if(query.length<this.minLength)this._hide();else{var html=this.templates.empty({query:this.datasets[0]&&this.datasets[0].query});this.$empty.html(html),this.$empty.show(),this._show()}else _.any(this.datasets,function(dataset){return dataset.templates&&dataset.templates.empty})?query.length<this.minLength?this._hide():this._show():this._hide();else this.isOpen&&(this.$empty&&(this.$empty.empty(),this.$empty.hide()),query.length>=this.minLength?this._show():this._hide());this.trigger("datasetRendered")},_hide:function(){this.$container.hide()},_show:function(){this.$container.css("display","block"),this._redraw(),this.trigger("shown")},_redraw:function(){this.isOpen&&this.appendTo&&this.trigger("redrawn")},_getSuggestions:function(){return this.$menu.find(_.className(this.cssClasses.prefix,this.cssClasses.suggestion))},_getCursor:function(){return this.$menu.find(_.className(this.cssClasses.prefix,this.cssClasses.cursor)).first()},_setCursor:function($el,updateInput){$el.first().addClass(_.className(this.cssClasses.prefix,this.cssClasses.cursor,!0)).attr("aria-selected","true"),this.trigger("cursorMoved",updateInput)},_removeCursor:function(){this._getCursor().removeClass(_.className(this.cssClasses.prefix,this.cssClasses.cursor,!0)).removeAttr("aria-selected")},_moveCursor:function(increment){var $suggestions,$oldCursor,newCursorIndex,$newCursor;this.isOpen&&($oldCursor=this._getCursor(),$suggestions=this._getSuggestions(),this._removeCursor(),-1!==(newCursorIndex=((newCursorIndex=$suggestions.index($oldCursor)+increment)+1)%($suggestions.length+1)-1)?(newCursorIndex<-1&&(newCursorIndex=$suggestions.length-1),this._setCursor($newCursor=$suggestions.eq(newCursorIndex),!0),this._ensureVisible($newCursor)):this.trigger("cursorRemoved"))},_ensureVisible:function($el){var elTop,elBottom,menuScrollTop,menuHeight;elBottom=(elTop=$el.position().top)+$el.height()+parseInt($el.css("margin-top"),10)+parseInt($el.css("margin-bottom"),10),menuScrollTop=this.$menu.scrollTop(),menuHeight=this.$menu.height()+parseInt(this.$menu.css("padding-top"),10)+parseInt(this.$menu.css("padding-bottom"),10),elTop<0?this.$menu.scrollTop(menuScrollTop+elTop):menuHeight<elBottom&&this.$menu.scrollTop(menuScrollTop+(elBottom-menuHeight))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,this.isEmpty||this._show(),this.trigger("opened"))},setLanguageDirection:function(dir){this.$menu.css("ltr"===dir?this.css.ltr:this.css.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function($el){var datum=null;return $el.length&&(datum={raw:Dataset.extractDatum($el),value:Dataset.extractValue($el),datasetName:Dataset.extractDatasetName($el)}),datum},getCurrentCursor:function(){return this._getCursor().first()},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},cursorTopSuggestion:function(){this._setCursor(this._getSuggestions().first(),!1)},update:function(query){_.each(this.datasets,function(dataset){dataset.update(query)})},empty:function(){_.each(this.datasets,function(dataset){dataset.clear()}),this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){this.$menu.off(".aa"),this.$menu=null,_.each(this.datasets,function(dataset){dataset.destroy()})}}),Dropdown.Dataset=Dataset,module.exports=Dropdown},{"../common/dom.js":11,"../common/utils.js":13,"./css.js":3,"./dataset.js":4,"./event_emitter.js":7}],6:[function(require,module,exports){"use strict";var _=require("../common/utils.js"),DOM=require("../common/dom.js");function EventBus(o){o&&o.el||_.error("EventBus initialized without el"),this.$el=DOM.element(o.el)}_.mixin(EventBus.prototype,{trigger:function(type,suggestion,dataset,context){var event=_.Event("autocomplete:"+type);return this.$el.trigger(event,[suggestion,dataset,context]),event}}),module.exports=EventBus},{"../common/dom.js":11,"../common/utils.js":13}],7:[function(require,module,exports){"use strict";var immediate=require("immediate"),splitter=/\s+/;function on(method,types,cb,context){var type;if(!cb)return this;for(types=types.split(splitter),cb=context?function(fn,context){return fn.bind?fn.bind(context):function(){fn.apply(context,[].slice.call(arguments,0))}}(cb,context):cb,this._callbacks=this._callbacks||{};type=types.shift();)this._callbacks[type]=this._callbacks[type]||{sync:[],async:[]},this._callbacks[type][method].push(cb);return this}function getFlush(callbacks,context,args){return function(){for(var cancelled,i=0,len=callbacks.length;!cancelled&&i<len;i+=1)cancelled=!1===callbacks[i].apply(context,args);return!cancelled}}module.exports={onSync:function(types,cb,context){return on.call(this,"sync",types,cb,context)},onAsync:function(types,cb,context){return on.call(this,"async",types,cb,context)},off:function(types){var type;if(!this._callbacks)return this;types=types.split(splitter);for(;type=types.shift();)delete this._callbacks[type];return this},trigger:function(types){var type,callbacks,args,syncFlush,asyncFlush;if(!this._callbacks)return this;types=types.split(splitter),args=[].slice.call(arguments,1);for(;(type=types.shift())&&(callbacks=this._callbacks[type]);)syncFlush=getFlush(callbacks.sync,this,[type].concat(args)),asyncFlush=getFlush(callbacks.async,this,[type].concat(args)),syncFlush()&&immediate(asyncFlush);return this}}},{immediate:22}],8:[function(require,module,exports){"use strict";module.exports={wrapper:'<span class="%ROOT%"></span>',dropdown:'<span class="%PREFIX%%DROPDOWN_MENU%"></span>',dataset:'<div class="%PREFIX%%DATASET%-%CLASS%"></div>',suggestions:'<span class="%PREFIX%%SUGGESTIONS%"></span>',suggestion:'<div class="%PREFIX%%SUGGESTION%"></div>'}},{}],9:[function(require,module,exports){"use strict";var specialKeyCodeMap;specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};var _=require("../common/utils.js"),DOM=require("../common/dom.js"),EventEmitter=require("./event_emitter.js");function Input(o){var onBlur,onFocus,onKeydown,onInput,$input,that=this;(o=o||{}).input||_.error("input is missing"),onBlur=_.bind(this._onBlur,this),onFocus=_.bind(this._onFocus,this),onKeydown=_.bind(this._onKeydown,this),onInput=_.bind(this._onInput,this),this.$hint=DOM.element(o.hint),this.$input=DOM.element(o.input).on("blur.aa",onBlur).on("focus.aa",onFocus).on("keydown.aa",onKeydown),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=_.noop),_.isMsie()?this.$input.on("keydown.aa keypress.aa cut.aa paste.aa",function($e){specialKeyCodeMap[$e.which||$e.keyCode]||_.defer(_.bind(that._onInput,that,$e))}):this.$input.on("input.aa",onInput),this.query=this.$input.val(),this.$overflowHelper=($input=this.$input,DOM.element('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:$input.css("font-family"),fontSize:$input.css("font-size"),fontStyle:$input.css("font-style"),fontVariant:$input.css("font-variant"),fontWeight:$input.css("font-weight"),wordSpacing:$input.css("word-spacing"),letterSpacing:$input.css("letter-spacing"),textIndent:$input.css("text-indent"),textRendering:$input.css("text-rendering"),textTransform:$input.css("text-transform")}).insertAfter($input))}function withModifier($e){return $e.altKey||$e.ctrlKey||$e.metaKey||$e.shiftKey}Input.normalizeQuery=function(str){return(str||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")},_.mixin(Input.prototype,EventEmitter,{_onBlur:function(){this.resetInputValue(),this.$input.removeAttr("aria-activedescendant"),this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function($e){var keyName=specialKeyCodeMap[$e.which||$e.keyCode];this._managePreventDefault(keyName,$e),keyName&&this._shouldTrigger(keyName,$e)&&this.trigger(keyName+"Keyed",$e)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(keyName,$e){var preventDefault,hintValue,inputValue;switch(keyName){case"tab":hintValue=this.getHint(),inputValue=this.getInputValue(),preventDefault=hintValue&&hintValue!==inputValue&&!withModifier($e);break;case"up":case"down":preventDefault=!withModifier($e);break;default:preventDefault=!1}preventDefault&&$e.preventDefault()},_shouldTrigger:function(keyName,$e){var trigger;switch(keyName){case"tab":trigger=!withModifier($e);break;default:trigger=!0}return trigger},_checkInputValue:function(){var inputValue,areEquivalent,hasDifferentWhitespace,a,b;inputValue=this.getInputValue(),a=inputValue,b=this.query,hasDifferentWhitespace=!(!(areEquivalent=Input.normalizeQuery(a)===Input.normalizeQuery(b))||!this.query)&&this.query.length!==inputValue.length,this.query=inputValue,areEquivalent?hasDifferentWhitespace&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(query){this.query=query},getInputValue:function(){return this.$input.val()},setInputValue:function(value,silent){void 0===value&&(value=this.query),this.$input.val(value),silent?this.clearHint():this._checkInputValue()},expand:function(){this.$input.attr("aria-expanded","true")},collapse:function(){this.$input.attr("aria-expanded","false")},setActiveDescendant:function(activedescendantId){this.$input.attr("aria-activedescendant",activedescendantId)},removeActiveDescendant:function(){this.$input.removeAttr("aria-activedescendant")},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(value){this.$hint.val(value)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var val,hint,valIsPrefixOfHint;valIsPrefixOfHint=(val=this.getInputValue())!==(hint=this.getHint())&&0===hint.indexOf(val),""!==val&&valIsPrefixOfHint&&!this.hasOverflow()||this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var constraint=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=constraint},isCursorAtEnd:function(){var valueLength,selectionStart,range;return valueLength=this.$input.val().length,selectionStart=this.$input[0].selectionStart,_.isNumber(selectionStart)?selectionStart===valueLength:!document.selection||((range=document.selection.createRange()).moveStart("character",-valueLength),valueLength===range.text.length)},destroy:function(){this.$hint.off(".aa"),this.$input.off(".aa"),this.$hint=this.$input=this.$overflowHelper=null}}),module.exports=Input},{"../common/dom.js":11,"../common/utils.js":13,"./event_emitter.js":7}],10:[function(require,module,exports){"use strict";var attrsKey="aaAttrs",_=require("../common/utils.js"),DOM=require("../common/dom.js"),EventBus=require("./event_bus.js"),Input=require("./input.js"),Dropdown=require("./dropdown.js"),html=require("./html.js"),css=require("./css.js");function Typeahead(o){var $menu,$hint;if((o=o||{}).input||_.error("missing input"),this.isActivated=!1,this.debug=!!o.debug,this.autoselect=!!o.autoselect,this.autoselectOnBlur=!!o.autoselectOnBlur,this.openOnFocus=!!o.openOnFocus,this.minLength=_.isNumber(o.minLength)?o.minLength:1,this.autoWidth=void 0===o.autoWidth||!!o.autoWidth,this.clearOnSelected=!!o.clearOnSelected,this.tabAutocomplete=void 0===o.tabAutocomplete||!!o.tabAutocomplete,o.hint=!!o.hint,o.hint&&o.appendTo)throw new Error("[autocomplete.js] hint and appendTo options can't be used at the same time");this.css=o.css=_.mixin({},css,o.appendTo?css.appendTo:{}),this.cssClasses=o.cssClasses=_.mixin({},css.defaultClasses,o.cssClasses||{}),this.cssClasses.prefix=o.cssClasses.formattedPrefix=_.formatPrefix(this.cssClasses.prefix,this.cssClasses.noPrefix),this.listboxId=o.listboxId=[this.cssClasses.root,"listbox",_.getUniqueId()].join("-");var domElts=function(options){var $input,$wrapper,$dropdown,$hint;$input=DOM.element(options.input),$wrapper=DOM.element(html.wrapper.replace("%ROOT%",options.cssClasses.root)).css(options.css.wrapper),options.appendTo||"block"!==$input.css("display")||"table"!==$input.parent().css("display")||$wrapper.css("display","table-cell");var dropdownHtml=html.dropdown.replace("%PREFIX%",options.cssClasses.prefix).replace("%DROPDOWN_MENU%",options.cssClasses.dropdownMenu);$dropdown=DOM.element(dropdownHtml).css(options.css.dropdown).attr({role:"listbox",id:options.listboxId}),options.templates&&options.templates.dropdownMenu&&$dropdown.html(_.templatify(options.templates.dropdownMenu)());($hint=$input.clone().css(options.css.hint).css(($el=$input,{backgroundAttachment:$el.css("background-attachment"),backgroundClip:$el.css("background-clip"),backgroundColor:$el.css("background-color"),backgroundImage:$el.css("background-image"),backgroundOrigin:$el.css("background-origin"),backgroundPosition:$el.css("background-position"),backgroundRepeat:$el.css("background-repeat"),backgroundSize:$el.css("background-size")}))).val("").addClass(_.className(options.cssClasses.prefix,options.cssClasses.hint,!0)).removeAttr("id name placeholder required").prop("readonly",!0).attr({"aria-hidden":"true",autocomplete:"off",spellcheck:"false",tabindex:-1}),$hint.removeData&&$hint.removeData();var $el;$input.data(attrsKey,{"aria-autocomplete":$input.attr("aria-autocomplete"),"aria-expanded":$input.attr("aria-expanded"),"aria-owns":$input.attr("aria-owns"),autocomplete:$input.attr("autocomplete"),dir:$input.attr("dir"),role:$input.attr("role"),spellcheck:$input.attr("spellcheck"),style:$input.attr("style"),type:$input.attr("type")}),$input.addClass(_.className(options.cssClasses.prefix,options.cssClasses.input,!0)).attr({autocomplete:"off",spellcheck:!1,role:"combobox","aria-autocomplete":options.datasets&&options.datasets[0]&&options.datasets[0].displayKey?"both":"list","aria-expanded":"false","aria-label":options.ariaLabel,"aria-owns":options.listboxId}).css(options.hint?options.css.input:options.css.inputWithNoHint);try{$input.attr("dir")||$input.attr("dir","auto")}catch(e){}return($wrapper=options.appendTo?$wrapper.appendTo(DOM.element(options.appendTo).eq(0)).eq(0):$input.wrap($wrapper).parent()).prepend(options.hint?$hint:null).append($dropdown),{wrapper:$wrapper,input:$input,hint:$hint,menu:$dropdown}}(o);this.$node=domElts.wrapper;var $input=this.$input=domElts.input;$menu=domElts.menu,$hint=domElts.hint,o.dropdownMenuContainer&&DOM.element(o.dropdownMenuContainer).css("position","relative").append($menu.css("top","0")),$input.on("blur.aa",function($e){var active=document.activeElement;_.isMsie()&&($menu[0]===active||$menu[0].contains(active))&&($e.preventDefault(),$e.stopImmediatePropagation(),_.defer(function(){$input.focus()}))}),$menu.on("mousedown.aa",function($e){$e.preventDefault()}),this.eventBus=o.eventBus||new EventBus({el:$input}),this.dropdown=new Typeahead.Dropdown({appendTo:o.appendTo,wrapper:this.$node,menu:$menu,datasets:o.datasets,templates:o.templates,cssClasses:o.cssClasses,minLength:this.minLength}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onSync("shown",this._onShown,this).onSync("empty",this._onEmpty,this).onSync("redrawn",this._onRedrawn,this).onAsync("datasetRendered",this._onDatasetRendered,this),this.input=new Typeahead.Input({input:$input,hint:$hint}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this),this._bindKeyboardShortcuts(o),this._setLanguageDirection()}_.mixin(Typeahead.prototype,{_bindKeyboardShortcuts:function(options){if(options.keyboardShortcuts){var $input=this.$input,keyboardShortcuts=[];_.each(options.keyboardShortcuts,function(key){"string"==typeof key&&(key=key.toUpperCase().charCodeAt(0)),keyboardShortcuts.push(key)}),DOM.element(document).keydown(function(event){var elt=event.target||event.srcElement,tagName=elt.tagName;if(!elt.isContentEditable&&"INPUT"!==tagName&&"SELECT"!==tagName&&"TEXTAREA"!==tagName){var which=event.which||event.keyCode;-1!==keyboardShortcuts.indexOf(which)&&($input.focus(),event.stopPropagation(),event.preventDefault())}})}},_onSuggestionClicked:function(type,$el){var datum;(datum=this.dropdown.getDatumForSuggestion($el))&&this._select(datum,{selectionMethod:"click"})},_onCursorMoved:function(event,updateInput){var datum=this.dropdown.getDatumForCursor(),currentCursorId=this.dropdown.getCurrentCursor().attr("id");this.input.setActiveDescendant(currentCursorId),datum&&(updateInput&&this.input.setInputValue(datum.value,!0),this.eventBus.trigger("cursorchanged",datum.raw,datum.datasetName))},_onCursorRemoved:function(){this.input.resetInputValue(),this._updateHint(),this.eventBus.trigger("cursorremoved")},_onDatasetRendered:function(){this._updateHint(),this.eventBus.trigger("updated")},_onOpened:function(){this._updateHint(),this.input.expand(),this.eventBus.trigger("opened")},_onEmpty:function(){this.eventBus.trigger("empty")},_onRedrawn:function(){this.$node.css("top","0px"),this.$node.css("left","0px");var inputRect=this.$input[0].getBoundingClientRect();this.autoWidth&&this.$node.css("width",inputRect.width+"px");var wrapperRect=this.$node[0].getBoundingClientRect(),top=inputRect.bottom-wrapperRect.top;this.$node.css("top",top+"px");var left=inputRect.left-wrapperRect.left;this.$node.css("left",left+"px"),this.eventBus.trigger("redrawn")},_onShown:function(){this.eventBus.trigger("shown"),this.autoselect&&this.dropdown.cursorTopSuggestion()},_onClosed:function(){this.input.clearHint(),this.input.removeActiveDescendant(),this.input.collapse(),this.eventBus.trigger("closed")},_onFocused:function(){if(this.isActivated=!0,this.openOnFocus){var query=this.input.getQuery();query.length>=this.minLength?this.dropdown.update(query):this.dropdown.empty(),this.dropdown.open()}},_onBlurred:function(){var cursorDatum,topSuggestionDatum;cursorDatum=this.dropdown.getDatumForCursor(),topSuggestionDatum=this.dropdown.getDatumForTopSuggestion();var context={selectionMethod:"blur"};this.debug||(this.autoselectOnBlur&&cursorDatum?this._select(cursorDatum,context):this.autoselectOnBlur&&topSuggestionDatum?this._select(topSuggestionDatum,context):(this.isActivated=!1,this.dropdown.empty(),this.dropdown.close()))},_onEnterKeyed:function(type,$e){var cursorDatum,topSuggestionDatum;cursorDatum=this.dropdown.getDatumForCursor(),topSuggestionDatum=this.dropdown.getDatumForTopSuggestion();var context={selectionMethod:"enterKey"};cursorDatum?(this._select(cursorDatum,context),$e.preventDefault()):this.autoselect&&topSuggestionDatum&&(this._select(topSuggestionDatum,context),$e.preventDefault())},_onTabKeyed:function(type,$e){if(this.tabAutocomplete){var datum;(datum=this.dropdown.getDatumForCursor())?(this._select(datum,{selectionMethod:"tabKey"}),$e.preventDefault()):this._autocomplete(!0)}else this.dropdown.close()},_onEscKeyed:function(){this.dropdown.close(),this.input.resetInputValue()},_onUpKeyed:function(){var query=this.input.getQuery();this.dropdown.isEmpty&&query.length>=this.minLength?this.dropdown.update(query):this.dropdown.moveCursorUp(),this.dropdown.open()},_onDownKeyed:function(){var query=this.input.getQuery();this.dropdown.isEmpty&&query.length>=this.minLength?this.dropdown.update(query):this.dropdown.moveCursorDown(),this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(e,query){this.input.clearHintIfInvalid(),query.length>=this.minLength?this.dropdown.update(query):this.dropdown.empty(),this.dropdown.open(),this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint(),this.dropdown.open()},_setLanguageDirection:function(){var dir=this.input.getLanguageDirection();this.dir!==dir&&(this.dir=dir,this.$node.css("direction",dir),this.dropdown.setLanguageDirection(dir))},_updateHint:function(){var datum,val,query,escapedQuery,match;(datum=this.dropdown.getDatumForTopSuggestion())&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(val=this.input.getInputValue(),query=Input.normalizeQuery(val),escapedQuery=_.escapeRegExChars(query),(match=new RegExp("^(?:"+escapedQuery+")(.+$)","i").exec(datum.value))?this.input.setHint(val+match[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(laxCursor){var hint,query,isCursorAtEnd,datum;hint=this.input.getHint(),query=this.input.getQuery(),isCursorAtEnd=laxCursor||this.input.isCursorAtEnd(),hint&&query!==hint&&isCursorAtEnd&&((datum=this.dropdown.getDatumForTopSuggestion())&&this.input.setInputValue(datum.value),this.eventBus.trigger("autocompleted",datum.raw,datum.datasetName))},_select:function(datum,context){void 0!==datum.value&&this.input.setQuery(datum.value),this.clearOnSelected?this.setVal(""):this.input.setInputValue(datum.value,!0),this._setLanguageDirection(),!1===this.eventBus.trigger("selected",datum.raw,datum.datasetName,context).isDefaultPrevented()&&(this.dropdown.close(),_.defer(_.bind(this.dropdown.empty,this.dropdown)))},open:function(){if(!this.isActivated){var query=this.input.getInputValue();query.length>=this.minLength?this.dropdown.update(query):this.dropdown.empty()}this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(val){val=_.toStr(val),this.isActivated?this.input.setInputValue(val):(this.input.setQuery(val),this.input.setInputValue(val,!0)),this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy(),this.dropdown.destroy(),function($node,cssClasses){var $input=$node.find(_.className(cssClasses.prefix,cssClasses.input));_.each($input.data(attrsKey),function(val,key){void 0===val?$input.removeAttr(key):$input.attr(key,val)}),$input.detach().removeClass(_.className(cssClasses.prefix,cssClasses.input,!0)).insertAfter($node),$input.removeData&&$input.removeData(attrsKey);$node.remove()}(this.$node,this.cssClasses),this.$node=null},getWrapper:function(){return this.dropdown.$container[0]}}),Typeahead.Dropdown=Dropdown,Typeahead.Input=Input,Typeahead.sources=require("../sources/index.js"),module.exports=Typeahead},{"../common/dom.js":11,"../common/utils.js":13,"../sources/index.js":15,"./css.js":3,"./dropdown.js":5,"./event_bus.js":6,"./html.js":8,"./input.js":9}],11:[function(require,module,exports){"use strict";module.exports={element:null}},{}],12:[function(require,module,exports){"use strict";module.exports=function(agent){var parsed=agent.match(/Algolia for vanilla JavaScript (\d+\.)(\d+\.)(\d+)/);if(parsed)return[parsed[1],parsed[2],parsed[3]]}},{}],13:[function(require,module,exports){"use strict";var counter,DOM=require("./dom.js");function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}module.exports={isArray:null,isFunction:null,isObject:null,bind:null,each:null,map:null,mixin:null,isMsie:function(agentString){if(void 0===agentString&&(agentString=navigator.userAgent),/(msie|trident)/i.test(agentString)){var match=agentString.match(/(msie |rv:)(\d+(.\d+)?)/i);if(match)return match[2]}return!1},escapeRegExChars:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isNumber:function(obj){return"number"==typeof obj},toStr:function(s){return null==s?"":s+""},cloneDeep:function(obj){var clone=this.mixin({},obj),self=this;return this.each(clone,function(value,key){value&&(self.isArray(value)?clone[key]=[].concat(value):self.isObject(value)&&(clone[key]=self.cloneDeep(value)))}),clone},error:function(msg){throw new Error(msg)},every:function(obj,test){var result=!0;return obj?(this.each(obj,function(val,key){result&&(result=test.call(null,val,key,obj)&&result)}),!!result):result},any:function(obj,test){var found=!1;return obj&&this.each(obj,function(val,key){if(test.call(null,val,key,obj))return!(found=!0)}),found},getUniqueId:(counter=0,function(){return counter++}),templatify:function(obj){if(this.isFunction(obj))return obj;var $template=DOM.element(obj);return"SCRIPT"===$template.prop("tagName")?function(){return $template.text()}:function(){return String(obj)}},defer:function(fn){setTimeout(fn,0)},noop:function(){},formatPrefix:function(prefix,noPrefix){return noPrefix?"":prefix+"-"},className:function(prefix,clazz,skipDot){return(skipDot?"":".")+prefix+clazz},escapeHighlightedString:function(str,highlightPreTag,highlightPostTag){highlightPreTag=highlightPreTag||"<em>";var pre=document.createElement("div");pre.appendChild(document.createTextNode(highlightPreTag)),highlightPostTag=highlightPostTag||"</em>";var post=document.createElement("div");post.appendChild(document.createTextNode(highlightPostTag));var div=document.createElement("div");return div.appendChild(document.createTextNode(str)),div.innerHTML.replace(RegExp(escapeRegExp(pre.innerHTML),"g"),highlightPreTag).replace(RegExp(escapeRegExp(post.innerHTML),"g"),highlightPostTag)}}},{"./dom.js":11}],14:[function(require,module,exports){"use strict";var _=require("../common/utils.js"),version=require("../../version.js"),parseAlgoliaClientVersion=require("../common/parseAlgoliaClientVersion.js");module.exports=function(index,params){var algoliaVersion=parseAlgoliaClientVersion(index.as._ua);return algoliaVersion&&3<=algoliaVersion[0]&&20<algoliaVersion[1]&&((params=params||{}).additionalUA="autocomplete.js "+version),function(query,cb){index.search(query,params,function(error,content){error?_.error(error.message):cb(content.hits,content)})}}},{"../../version.js":18,"../common/parseAlgoliaClientVersion.js":12,"../common/utils.js":13}],15:[function(require,module,exports){"use strict";module.exports={hits:require("./hits.js"),popularIn:require("./popularIn.js")}},{"./hits.js":14,"./popularIn.js":16}],16:[function(require,module,exports){"use strict";var _=require("../common/utils.js"),version=require("../../version.js"),parseAlgoliaClientVersion=require("../common/parseAlgoliaClientVersion.js");module.exports=function(index,params,details,options){var algoliaVersion=parseAlgoliaClientVersion(index.as._ua);if(algoliaVersion&&3<=algoliaVersion[0]&&20<algoliaVersion[1]&&((params=params||{}).additionalUA="autocomplete.js "+version),!details.source)return _.error("Missing 'source' key");var source=_.isFunction(details.source)?details.source:function(hit){return hit[details.source]};if(!details.index)return _.error("Missing 'index' key");var detailsIndex=details.index;return options=options||{},function(query,cb){index.search(query,params,function(error,content){if(error)_.error(error.message);else{if(0<content.hits.length){var first=content.hits[0],detailsParams=_.mixin({hitsPerPage:0},details);delete detailsParams.source,delete detailsParams.index;var detailsAlgoliaVersion=parseAlgoliaClientVersion(detailsIndex.as._ua);return detailsAlgoliaVersion&&3<=detailsAlgoliaVersion[0]&&20<detailsAlgoliaVersion[1]&&(params.additionalUA="autocomplete.js "+version),void detailsIndex.search(source(first),detailsParams,function(error2,content2){if(error2)_.error(error2.message);else{var suggestions=[];if(options.includeAll){var label=options.allTitle||"All departments";suggestions.push(_.mixin({facet:{value:label,count:content2.nbHits}},_.cloneDeep(first)))}_.each(content2.facets,function(values,facet){_.each(values,function(count,value){suggestions.push(_.mixin({facet:{facet:facet,value:value,count:count}},_.cloneDeep(first)))})});for(var i=1;i<content.hits.length;++i)suggestions.push(content.hits[i]);cb(suggestions,content)}})}cb([])}})}}},{"../../version.js":18,"../common/parseAlgoliaClientVersion.js":12,"../common/utils.js":13}],17:[function(require,module,exports){"use strict";var zepto=require("../../zepto.js");require("../common/dom.js").element=zepto;var _=require("../common/utils.js");_.isArray=zepto.isArray,_.isFunction=zepto.isFunction,_.isObject=zepto.isPlainObject,_.bind=zepto.proxy,_.each=function(collection,cb){zepto.each(collection,function(index,value){return cb(value,index)})},_.map=zepto.map,_.mixin=zepto.extend,_.Event=zepto.Event;var Typeahead=require("../autocomplete/typeahead.js"),EventBus=require("../autocomplete/event_bus.js");function autocomplete(selector,options,datasets,typeaheadObject){datasets=_.isArray(datasets)?datasets:[].slice.call(arguments,2);var inputs=zepto(selector).each(function(i,input){var $input=zepto(input),eventBus=new EventBus({el:$input}),typeahead=typeaheadObject||new Typeahead({input:$input,eventBus:eventBus,dropdownMenuContainer:options.dropdownMenuContainer,hint:void 0===options.hint||!!options.hint,minLength:options.minLength,autoselect:options.autoselect,autoselectOnBlur:options.autoselectOnBlur,tabAutocomplete:options.tabAutocomplete,openOnFocus:options.openOnFocus,templates:options.templates,debug:options.debug,clearOnSelected:options.clearOnSelected,cssClasses:options.cssClasses,datasets:datasets,keyboardShortcuts:options.keyboardShortcuts,appendTo:options.appendTo,autoWidth:options.autoWidth});$input.data("aaAutocomplete",typeahead)});return inputs.autocomplete={},_.each(["open","close","getVal","setVal","destroy","getWrapper"],function(method){inputs.autocomplete[method]=function(){var result,methodArguments=arguments;return inputs.each(function(j,input){var typeahead=zepto(input).data("aaAutocomplete");result=typeahead[method].apply(typeahead,methodArguments)}),result}}),inputs}autocomplete.sources=Typeahead.sources,autocomplete.escapeHighlightedString=_.escapeHighlightedString;var wasAutocompleteSet="autocomplete"in window,oldAutocomplete=window.autocomplete;autocomplete.noConflict=function(){return wasAutocompleteSet?window.autocomplete=oldAutocomplete:delete window.autocomplete,autocomplete},module.exports=autocomplete},{"../../zepto.js":19,"../autocomplete/event_bus.js":6,"../autocomplete/typeahead.js":10,"../common/dom.js":11,"../common/utils.js":13}],18:[function(require,module,exports){module.exports="0.35.0"},{}],19:[function(require,module,exports){!function(global,factory){var window,Zepto,timeout,cache;module.exports=(window=global,function($){var undefined,_zid=1,slice=Array.prototype.slice,isFunction=$.isFunction,isString=function(obj){return"string"==typeof obj},handlers={},specialEvents={},focusinSupported="onfocusin"in window,focus={focus:"focusin",blur:"focusout"},hover={mouseenter:"mouseover",mouseleave:"mouseout"};function zid(element){return element._zid||(element._zid=_zid++)}function findHandlers(element,event,fn,selector){if((event=parse(event)).ns)var matcher=(ns=event.ns,new RegExp("(?:^| )"+ns.replace(" "," .* ?")+"(?: |$)"));var ns;return(handlers[zid(element)]||[]).filter(function(handler){return handler&&(!event.e||handler.e==event.e)&&(!event.ns||matcher.test(handler.ns))&&(!fn||zid(handler.fn)===zid(fn))&&(!selector||handler.sel==selector)})}function parse(event){var parts=(""+event).split(".");return{e:parts[0],ns:parts.slice(1).sort().join(" ")}}function eventCapture(handler,captureSetting){return handler.del&&!focusinSupported&&handler.e in focus||!!captureSetting}function realEvent(type){return hover[type]||focusinSupported&&focus[type]||type}function add(element,events,fn,data,selector,delegator,capture){var id=zid(element),set=handlers[id]||(handlers[id]=[]);events.split(/\s/).forEach(function(event){if("ready"==event)return $(document).ready(fn);var handler=parse(event);handler.fn=fn,handler.sel=selector,handler.e in hover&&(fn=function(e){var related=e.relatedTarget;if(!related||related!==this&&!$.contains(this,related))return handler.fn.apply(this,arguments)});var callback=(handler.del=delegator)||fn;handler.proxy=function(e){if(!(e=compatible(e)).isImmediatePropagationStopped()){try{var dataPropDescriptor=Object.getOwnPropertyDescriptor(e,"data");dataPropDescriptor&&!dataPropDescriptor.writable||(e.data=data)}catch(e){}var result=callback.apply(element,e._args==undefined?[e]:[e].concat(e._args));return!1===result&&(e.preventDefault(),e.stopPropagation()),result}},handler.i=set.length,set.push(handler),"addEventListener"in element&&element.addEventListener(realEvent(handler.e),handler.proxy,eventCapture(handler,capture))})}function remove(element,events,fn,selector,capture){var id=zid(element);(events||"").split(/\s/).forEach(function(event){findHandlers(element,event,fn,selector).forEach(function(handler){delete handlers[id][handler.i],"removeEventListener"in element&&element.removeEventListener(realEvent(handler.e),handler.proxy,eventCapture(handler,capture))})})}specialEvents.click=specialEvents.mousedown=specialEvents.mouseup=specialEvents.mousemove="MouseEvents",$.event={add:add,remove:remove},$.proxy=function(fn,context){var args=2 in arguments&&slice.call(arguments,2);if(isFunction(fn)){var proxyFn=function(){return fn.apply(context,args?args.concat(slice.call(arguments)):arguments)};return proxyFn._zid=zid(fn),proxyFn}if(isString(context))return args?(args.unshift(fn[context],fn),$.proxy.apply(null,args)):$.proxy(fn[context],fn);throw new TypeError("expected function")},$.fn.bind=function(event,data,callback){return this.on(event,data,callback)},$.fn.unbind=function(event,callback){return this.off(event,callback)},$.fn.one=function(event,selector,data,callback){return this.on(event,selector,data,callback,1)};var returnTrue=function(){return!0},returnFalse=function(){return!1},ignoreProperties=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,eventMethods={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function compatible(event,source){return!source&&event.isDefaultPrevented||(source||(source=event),$.each(eventMethods,function(name,predicate){var sourceMethod=source[name];event[name]=function(){return this[predicate]=returnTrue,sourceMethod&&sourceMethod.apply(source,arguments)},event[predicate]=returnFalse}),event.timeStamp||(event.timeStamp=Date.now()),(source.defaultPrevented!==undefined?source.defaultPrevented:"returnValue"in source?!1===source.returnValue:source.getPreventDefault&&source.getPreventDefault())&&(event.isDefaultPrevented=returnTrue)),event}function createProxy(event){var key,proxy={originalEvent:event};for(key in event)ignoreProperties.test(key)||event[key]===undefined||(proxy[key]=event[key]);return compatible(proxy,event)}$.fn.delegate=function(selector,event,callback){return this.on(event,selector,callback)},$.fn.undelegate=function(selector,event,callback){return this.off(event,selector,callback)},$.fn.live=function(event,callback){return $(document.body).delegate(this.selector,event,callback),this},$.fn.die=function(event,callback){return $(document.body).undelegate(this.selector,event,callback),this},$.fn.on=function(event,selector,data,callback,one){var autoRemove,delegator,$this=this;return event&&!isString(event)?($.each(event,function(type,fn){$this.on(type,selector,data,fn,one)}),$this):(isString(selector)||isFunction(callback)||!1===callback||(callback=data,data=selector,selector=undefined),callback!==undefined&&!1!==data||(callback=data,data=undefined),!1===callback&&(callback=returnFalse),$this.each(function(_,element){one&&(autoRemove=function(e){return remove(element,e.type,callback),callback.apply(this,arguments)}),selector&&(delegator=function(e){var evt,match=$(e.target).closest(selector,element).get(0);if(match&&match!==element)return evt=$.extend(createProxy(e),{currentTarget:match,liveFired:element}),(autoRemove||callback).apply(match,[evt].concat(slice.call(arguments,1)))}),add(element,event,callback,data,selector,delegator||autoRemove)}))},$.fn.off=function(event,selector,callback){var $this=this;return event&&!isString(event)?($.each(event,function(type,fn){$this.off(type,selector,fn)}),$this):(isString(selector)||isFunction(callback)||!1===callback||(callback=selector,selector=undefined),!1===callback&&(callback=returnFalse),$this.each(function(){remove(this,event,callback,selector)}))},$.fn.trigger=function(event,args){return(event=isString(event)||$.isPlainObject(event)?$.Event(event):compatible(event))._args=args,this.each(function(){event.type in focus&&"function"==typeof this[event.type]?this[event.type]():"dispatchEvent"in this?this.dispatchEvent(event):$(this).triggerHandler(event,args)})},$.fn.triggerHandler=function(event,args){var e,result;return this.each(function(i,element){(e=createProxy(isString(event)?$.Event(event):event))._args=args,e.target=element,$.each(findHandlers(element,event.type||event),function(i,handler){if(result=handler.proxy(e),e.isImmediatePropagationStopped())return!1})}),result},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(event){$.fn[event]=function(callback){return 0 in arguments?this.bind(event,callback):this.trigger(event)}}),$.Event=function(type,props){isString(type)||(type=(props=type).type);var event=document.createEvent(specialEvents[type]||"Events"),bubbles=!0;if(props)for(var name in props)"bubbles"==name?bubbles=!!props[name]:event[name]=props[name];return event.initEvent(type,bubbles,!0),compatible(event)}}(Zepto=function(){var undefined,key,$,classList,camelize,uniq,emptyArray=[],concat=emptyArray.concat,filter=emptyArray.filter,slice=emptyArray.slice,document=window.document,elementDisplay={},classCache={},cssNumber={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},fragmentRE=/^\s*<(\w+|!)[^>]*>/,singleTagRE=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,tagExpanderRE=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rootNodeRE=/^(?:body|html)$/i,capitalRE=/([A-Z])/g,methodAttributes=["val","css","html","text","data","width","height","offset"],table=document.createElement("table"),tableRow=document.createElement("tr"),containers={tr:document.createElement("tbody"),tbody:table,thead:table,tfoot:table,td:tableRow,th:tableRow,"*":document.createElement("div")},readyRE=/complete|loaded|interactive/,simpleSelectorRE=/^[\w-]*$/,class2type={},toString=class2type.toString,zepto={},tempParent=document.createElement("div"),propMap={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},isArray=Array.isArray||function(object){return object instanceof Array};function type(obj){return null==obj?String(obj):class2type[toString.call(obj)]||"object"}function isFunction(value){return"function"==type(value)}function isWindow(obj){return null!=obj&&obj==obj.window}function isDocument(obj){return null!=obj&&obj.nodeType==obj.DOCUMENT_NODE}function isObject(obj){return"object"==type(obj)}function isPlainObject(obj){return isObject(obj)&&!isWindow(obj)&&Object.getPrototypeOf(obj)==Object.prototype}function likeArray(obj){var length=!!obj&&"length"in obj&&obj.length,type=$.type(obj);return"function"!=type&&!isWindow(obj)&&("array"==type||0===length||"number"==typeof length&&0<length&&length-1 in obj)}function dasherize(str){return str.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function classRE(name){return name in classCache?classCache[name]:classCache[name]=new RegExp("(^|\\s)"+name+"(\\s|$)")}function maybeAddPx(name,value){return"number"!=typeof value||cssNumber[dasherize(name)]?value:value+"px"}function children(element){return"children"in element?slice.call(element.children):$.map(element.childNodes,function(node){if(1==node.nodeType)return node})}function Z(dom,selector){var i,len=dom?dom.length:0;for(i=0;i<len;i++)this[i]=dom[i];this.length=len,this.selector=selector||""}function filtered(nodes,selector){return null==selector?$(nodes):$(nodes).filter(selector)}function funcArg(context,arg,idx,payload){return isFunction(arg)?arg.call(context,idx,payload):arg}function setAttribute(node,name,value){null==value?node.removeAttribute(name):node.setAttribute(name,value)}function className(node,value){var klass=node.className||"",svg=klass&&klass.baseVal!==undefined;if(value===undefined)return svg?klass.baseVal:klass;svg?klass.baseVal=value:node.className=value}function deserializeValue(value){try{return value?"true"==value||"false"!=value&&("null"==value?null:+value+""==value?+value:/^[\[\{]/.test(value)?$.parseJSON(value):value):value}catch(e){return value}}return zepto.matches=function(element,selector){if(!selector||!element||1!==element.nodeType)return!1;var matchesSelector=element.matches||element.webkitMatchesSelector||element.mozMatchesSelector||element.oMatchesSelector||element.matchesSelector;if(matchesSelector)return matchesSelector.call(element,selector);var match,parent=element.parentNode,temp=!parent;return temp&&(parent=tempParent).appendChild(element),match=~zepto.qsa(parent,selector).indexOf(element),temp&&tempParent.removeChild(element),match},camelize=function(str){return str.replace(/-+(.)?/g,function(match,chr){return chr?chr.toUpperCase():""})},uniq=function(array){return filter.call(array,function(item,idx){return array.indexOf(item)==idx})},zepto.fragment=function(html,name,properties){var dom,nodes,container;return singleTagRE.test(html)&&(dom=$(document.createElement(RegExp.$1))),dom||(html.replace&&(html=html.replace(tagExpanderRE,"<$1></$2>")),name===undefined&&(name=fragmentRE.test(html)&&RegExp.$1),name in containers||(name="*"),(container=containers[name]).innerHTML=""+html,dom=$.each(slice.call(container.childNodes),function(){container.removeChild(this)})),isPlainObject(properties)&&(nodes=$(dom),$.each(properties,function(key,value){-1<methodAttributes.indexOf(key)?nodes[key](value):nodes.attr(key,value)})),dom},zepto.Z=function(dom,selector){return new Z(dom,selector)},zepto.isZ=function(object){return object instanceof zepto.Z},zepto.init=function(selector,context){var dom,array;if(!selector)return zepto.Z();if("string"==typeof selector)if("<"==(selector=selector.trim())[0]&&fragmentRE.test(selector))dom=zepto.fragment(selector,RegExp.$1,context),selector=null;else{if(context!==undefined)return $(context).find(selector);dom=zepto.qsa(document,selector)}else{if(isFunction(selector))return $(document).ready(selector);if(zepto.isZ(selector))return selector;if(isArray(selector))array=selector,dom=filter.call(array,function(item){return null!=item});else if(isObject(selector))dom=[selector],selector=null;else if(fragmentRE.test(selector))dom=zepto.fragment(selector.trim(),RegExp.$1,context),selector=null;else{if(context!==undefined)return $(context).find(selector);dom=zepto.qsa(document,selector)}}return zepto.Z(dom,selector)},($=function(selector,context){return zepto.init(selector,context)}).extend=function(target){var deep,args=slice.call(arguments,1);return"boolean"==typeof target&&(deep=target,target=args.shift()),args.forEach(function(arg){!function extend(target,source,deep){for(key in source)deep&&(isPlainObject(source[key])||isArray(source[key]))?(isPlainObject(source[key])&&!isPlainObject(target[key])&&(target[key]={}),isArray(source[key])&&!isArray(target[key])&&(target[key]=[]),extend(target[key],source[key],deep)):source[key]!==undefined&&(target[key]=source[key])}(target,arg,deep)}),target},zepto.qsa=function(element,selector){var found,maybeID="#"==selector[0],maybeClass=!maybeID&&"."==selector[0],nameOnly=maybeID||maybeClass?selector.slice(1):selector,isSimple=simpleSelectorRE.test(nameOnly);return element.getElementById&&isSimple&&maybeID?(found=element.getElementById(nameOnly))?[found]:[]:1!==element.nodeType&&9!==element.nodeType&&11!==element.nodeType?[]:slice.call(isSimple&&!maybeID&&element.getElementsByClassName?maybeClass?element.getElementsByClassName(nameOnly):element.getElementsByTagName(selector):element.querySelectorAll(selector))},$.contains=document.documentElement.contains?function(parent,node){return parent!==node&&parent.contains(node)}:function(parent,node){for(;node&&(node=node.parentNode);)if(node===parent)return!0;return!1},$.type=type,$.isFunction=isFunction,$.isWindow=isWindow,$.isArray=isArray,$.isPlainObject=isPlainObject,$.isEmptyObject=function(obj){var name;for(name in obj)return!1;return!0},$.isNumeric=function(val){var num=Number(val),type=typeof val;return null!=val&&"boolean"!=type&&("string"!=type||val.length)&&!isNaN(num)&&isFinite(num)||!1},$.inArray=function(elem,array,i){return emptyArray.indexOf.call(array,elem,i)},$.camelCase=camelize,$.trim=function(str){return null==str?"":String.prototype.trim.call(str)},$.uuid=0,$.support={},$.expr={},$.noop=function(){},$.map=function(elements,callback){var value,i,key,array,values=[];if(likeArray(elements))for(i=0;i<elements.length;i++)null!=(value=callback(elements[i],i))&&values.push(value);else for(key in elements)null!=(value=callback(elements[key],key))&&values.push(value);return 0<(array=values).length?$.fn.concat.apply([],array):array},$.each=function(elements,callback){var i,key;if(likeArray(elements)){for(i=0;i<elements.length;i++)if(!1===callback.call(elements[i],i,elements[i]))return elements}else for(key in elements)if(!1===callback.call(elements[key],key,elements[key]))return elements;return elements},$.grep=function(elements,callback){return filter.call(elements,callback)},window.JSON&&($.parseJSON=JSON.parse),$.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()}),$.fn={constructor:zepto.Z,length:0,forEach:emptyArray.forEach,reduce:emptyArray.reduce,push:emptyArray.push,sort:emptyArray.sort,splice:emptyArray.splice,indexOf:emptyArray.indexOf,concat:function(){var i,value,args=[];for(i=0;i<arguments.length;i++)value=arguments[i],args[i]=zepto.isZ(value)?value.toArray():value;return concat.apply(zepto.isZ(this)?this.toArray():this,args)},map:function(fn){return $($.map(this,function(el,i){return fn.call(el,i,el)}))},slice:function(){return $(slice.apply(this,arguments))},ready:function(callback){return readyRE.test(document.readyState)&&document.body?callback($):document.addEventListener("DOMContentLoaded",function(){callback($)},!1),this},get:function(idx){return idx===undefined?slice.call(this):this[0<=idx?idx:idx+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(callback){return emptyArray.every.call(this,function(el,idx){return!1!==callback.call(el,idx,el)}),this},filter:function(selector){return isFunction(selector)?this.not(this.not(selector)):$(filter.call(this,function(element){return zepto.matches(element,selector)}))},add:function(selector,context){return $(uniq(this.concat($(selector,context))))},is:function(selector){return 0<this.length&&zepto.matches(this[0],selector)},not:function(selector){var nodes=[];if(isFunction(selector)&&selector.call!==undefined)this.each(function(idx){selector.call(this,idx)||nodes.push(this)});else{var excludes="string"==typeof selector?this.filter(selector):likeArray(selector)&&isFunction(selector.item)?slice.call(selector):$(selector);this.forEach(function(el){excludes.indexOf(el)<0&&nodes.push(el)})}return $(nodes)},has:function(selector){return this.filter(function(){return isObject(selector)?$.contains(this,selector):$(this).find(selector).size()})},eq:function(idx){return-1===idx?this.slice(idx):this.slice(idx,+idx+1)},first:function(){var el=this[0];return el&&!isObject(el)?el:$(el)},last:function(){var el=this[this.length-1];return el&&!isObject(el)?el:$(el)},find:function(selector){var $this=this;return selector?"object"==typeof selector?$(selector).filter(function(){var node=this;return emptyArray.some.call($this,function(parent){return $.contains(parent,node)})}):1==this.length?$(zepto.qsa(this[0],selector)):this.map(function(){return zepto.qsa(this,selector)}):$()},closest:function(selector,context){var nodes=[],collection="object"==typeof selector&&$(selector);return this.each(function(_,node){for(;node&&!(collection?0<=collection.indexOf(node):zepto.matches(node,selector));)node=node!==context&&!isDocument(node)&&node.parentNode;node&&nodes.indexOf(node)<0&&nodes.push(node)}),$(nodes)},parents:function(selector){for(var ancestors=[],nodes=this;0<nodes.length;)nodes=$.map(nodes,function(node){if((node=node.parentNode)&&!isDocument(node)&&ancestors.indexOf(node)<0)return ancestors.push(node),node});return filtered(ancestors,selector)},parent:function(selector){return filtered(uniq(this.pluck("parentNode")),selector)},children:function(selector){return filtered(this.map(function(){return children(this)}),selector)},contents:function(){return this.map(function(){return this.contentDocument||slice.call(this.childNodes)})},siblings:function(selector){return filtered(this.map(function(i,el){return filter.call(children(el.parentNode),function(child){return child!==el})}),selector)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(property){return $.map(this,function(el){return el[property]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=function(nodeName){var element,display;elementDisplay[nodeName]||(element=document.createElement(nodeName),document.body.appendChild(element),display=getComputedStyle(element,"").getPropertyValue("display"),element.parentNode.removeChild(element),"none"==display&&(display="block"),elementDisplay[nodeName]=display);return elementDisplay[nodeName]}(this.nodeName))})},replaceWith:function(newContent){return this.before(newContent).remove()},wrap:function(structure){var func=isFunction(structure);if(this[0]&&!func)var dom=$(structure).get(0),clone=dom.parentNode||1<this.length;return this.each(function(index){$(this).wrapAll(func?structure.call(this,index):clone?dom.cloneNode(!0):dom)})},wrapAll:function(structure){if(this[0]){var children;for($(this[0]).before(structure=$(structure));(children=structure.children()).length;)structure=children.first();$(structure).append(this)}return this},wrapInner:function(structure){var func=isFunction(structure);return this.each(function(index){var self=$(this),contents=self.contents(),dom=func?structure.call(this,index):structure;contents.length?contents.wrapAll(dom):self.append(dom)})},unwrap:function(){return this.parent().each(function(){$(this).replaceWith($(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(setting){return this.each(function(){var el=$(this);(setting===undefined?"none"==el.css("display"):setting)?el.show():el.hide()})},prev:function(selector){return $(this.pluck("previousElementSibling")).filter(selector||"*")},next:function(selector){return $(this.pluck("nextElementSibling")).filter(selector||"*")},html:function(html){return 0 in arguments?this.each(function(idx){var originHtml=this.innerHTML;$(this).empty().append(funcArg(this,html,idx,originHtml))}):0 in this?this[0].innerHTML:null},text:function(text){return 0 in arguments?this.each(function(idx){var newText=funcArg(this,text,idx,this.textContent);this.textContent=null==newText?"":""+newText}):0 in this?this.pluck("textContent").join(""):null},attr:function(name,value){var result;return"string"!=typeof name||1 in arguments?this.each(function(idx){if(1===this.nodeType)if(isObject(name))for(key in name)setAttribute(this,key,name[key]);else setAttribute(this,name,funcArg(this,value,idx,this.getAttribute(name)))}):0 in this&&1==this[0].nodeType&&null!=(result=this[0].getAttribute(name))?result:undefined},removeAttr:function(name){return this.each(function(){1===this.nodeType&&name.split(" ").forEach(function(attribute){setAttribute(this,attribute)},this)})},prop:function(name,value){return name=propMap[name]||name,1 in arguments?this.each(function(idx){this[name]=funcArg(this,value,idx,this[name])}):this[0]&&this[0][name]},removeProp:function(name){return name=propMap[name]||name,this.each(function(){delete this[name]})},data:function(name,value){var attrName="data-"+name.replace(capitalRE,"-$1").toLowerCase(),data=1 in arguments?this.attr(attrName,value):this.attr(attrName);return null!==data?deserializeValue(data):undefined},val:function(value){return 0 in arguments?(null==value&&(value=""),this.each(function(idx){this.value=funcArg(this,value,idx,this.value)})):this[0]&&(this[0].multiple?$(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(coordinates){if(coordinates)return this.each(function(index){var $this=$(this),coords=funcArg(this,coordinates,index,$this.offset()),parentOffset=$this.offsetParent().offset(),props={top:coords.top-parentOffset.top,left:coords.left-parentOffset.left};"static"==$this.css("position")&&(props.position="relative"),$this.css(props)});if(!this.length)return null;if(document.documentElement!==this[0]&&!$.contains(document.documentElement,this[0]))return{top:0,left:0};var obj=this[0].getBoundingClientRect();return{left:obj.left+window.pageXOffset,top:obj.top+window.pageYOffset,width:Math.round(obj.width),height:Math.round(obj.height)}},css:function(property,value){if(arguments.length<2){var element=this[0];if("string"==typeof property){if(!element)return;return element.style[camelize(property)]||getComputedStyle(element,"").getPropertyValue(property)}if(isArray(property)){if(!element)return;var props={},computedStyle=getComputedStyle(element,"");return $.each(property,function(_,prop){props[prop]=element.style[camelize(prop)]||computedStyle.getPropertyValue(prop)}),props}}var css="";if("string"==type(property))value||0===value?css=dasherize(property)+":"+maybeAddPx(property,value):this.each(function(){this.style.removeProperty(dasherize(property))});else for(key in property)property[key]||0===property[key]?css+=dasherize(key)+":"+maybeAddPx(key,property[key])+";":this.each(function(){this.style.removeProperty(dasherize(key))});return this.each(function(){this.style.cssText+=";"+css})},index:function(element){return element?this.indexOf($(element)[0]):this.parent().children().indexOf(this[0])},hasClass:function(name){return!!name&&emptyArray.some.call(this,function(el){return this.test(className(el))},classRE(name))},addClass:function(name){return name?this.each(function(idx){if("className"in this){classList=[];var cls=className(this),newName=funcArg(this,name,idx,cls);newName.split(/\s+/g).forEach(function(klass){$(this).hasClass(klass)||classList.push(klass)},this),classList.length&&className(this,cls+(cls?" ":"")+classList.join(" "))}}):this},removeClass:function(name){return this.each(function(idx){if("className"in this){if(name===undefined)return className(this,"");classList=className(this),funcArg(this,name,idx,classList).split(/\s+/g).forEach(function(klass){classList=classList.replace(classRE(klass)," ")}),className(this,classList.trim())}})},toggleClass:function(name,when){return name?this.each(function(idx){var $this=$(this),names=funcArg(this,name,idx,className(this));names.split(/\s+/g).forEach(function(klass){(when===undefined?!$this.hasClass(klass):when)?$this.addClass(klass):$this.removeClass(klass)})}):this},scrollTop:function(value){if(this.length){var hasScrollTop="scrollTop"in this[0];return value===undefined?hasScrollTop?this[0].scrollTop:this[0].pageYOffset:this.each(hasScrollTop?function(){this.scrollTop=value}:function(){this.scrollTo(this.scrollX,value)})}},scrollLeft:function(value){if(this.length){var hasScrollLeft="scrollLeft"in this[0];return value===undefined?hasScrollLeft?this[0].scrollLeft:this[0].pageXOffset:this.each(hasScrollLeft?function(){this.scrollLeft=value}:function(){this.scrollTo(value,this.scrollY)})}},position:function(){if(this.length){var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rootNodeRE.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();return offset.top-=parseFloat($(elem).css("margin-top"))||0,offset.left-=parseFloat($(elem).css("margin-left"))||0,parentOffset.top+=parseFloat($(offsetParent[0]).css("border-top-width"))||0,parentOffset.left+=parseFloat($(offsetParent[0]).css("border-left-width"))||0,{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}}},offsetParent:function(){return this.map(function(){for(var parent=this.offsetParent||document.body;parent&&!rootNodeRE.test(parent.nodeName)&&"static"==$(parent).css("position");)parent=parent.offsetParent;return parent})}},$.fn.detach=$.fn.remove,["width","height"].forEach(function(dimension){var dimensionProperty=dimension.replace(/./,function(m){return m[0].toUpperCase()});$.fn[dimension]=function(value){var offset,el=this[0];return value===undefined?isWindow(el)?el["inner"+dimensionProperty]:isDocument(el)?el.documentElement["scroll"+dimensionProperty]:(offset=this.offset())&&offset[dimension]:this.each(function(idx){(el=$(this)).css(dimension,funcArg(this,value,idx,el[dimension]()))})}}),["after","prepend","before","append"].forEach(function(operator,operatorIndex){var inside=operatorIndex%2;$.fn[operator]=function(){var argType,parent,nodes=$.map(arguments,function(arg){var arr=[];return"array"==(argType=type(arg))?(arg.forEach(function(el){return el.nodeType!==undefined?arr.push(el):$.zepto.isZ(el)?arr=arr.concat(el.get()):void(arr=arr.concat(zepto.fragment(el)))}),arr):"object"==argType||null==arg?arg:zepto.fragment(arg)}),copyByClone=1<this.length;return nodes.length<1?this:this.each(function(_,target){parent=inside?target:target.parentNode,target=0==operatorIndex?target.nextSibling:1==operatorIndex?target.firstChild:2==operatorIndex?target:null;var parentInDocument=$.contains(document.documentElement,parent);nodes.forEach(function(node){if(copyByClone)node=node.cloneNode(!0);else if(!parent)return $(node).remove();parent.insertBefore(node,target),parentInDocument&&function traverseNode(node,fun){fun(node);for(var i=0,len=node.childNodes.length;i<len;i++)traverseNode(node.childNodes[i],fun)}(node,function(el){if(!(null==el.nodeName||"SCRIPT"!==el.nodeName.toUpperCase()||el.type&&"text/javascript"!==el.type||el.src)){var target=el.ownerDocument?el.ownerDocument.defaultView:window;target.eval.call(target,el.innerHTML)}})})})},$.fn[inside?operator+"To":"insert"+(operatorIndex?"Before":"After")]=function(html){return $(html)[operator](this),this}}),zepto.Z.prototype=Z.prototype=$.fn,zepto.uniq=uniq,zepto.deserializeValue=deserializeValue,$.zepto=zepto,$}()),cache=[],Zepto.fn.remove=function(){return this.each(function(){this.parentNode&&("IMG"===this.tagName&&(cache.push(this),this.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",timeout&&clearTimeout(timeout),timeout=setTimeout(function(){cache=[]},6e4)),this.parentNode.removeChild(this))})},function($){var data={},dataAttr=$.fn.data,camelize=$.camelCase,exp=$.expando="Zepto"+ +new Date,emptyArray=[];function setData(node,name,value){var id=node[exp]||(node[exp]=++$.uuid),store=data[id]||(data[id]=function(node){var store={};return $.each(node.attributes||emptyArray,function(i,attr){0==attr.name.indexOf("data-")&&(store[camelize(attr.name.replace("data-",""))]=$.zepto.deserializeValue(attr.value))}),store}(node));return void 0!==name&&(store[camelize(name)]=value),store}$.fn.data=function(name,value){return void 0===value?$.isPlainObject(name)?this.each(function(i,node){$.each(name,function(key,value){setData(node,key,value)})}):0 in this?function(node,name){var id=node[exp],store=id&&data[id];if(void 0===name)return store||setData(node);if(store){if(name in store)return store[name];var camelName=camelize(name);if(camelName in store)return store[camelName]}return dataAttr.call($(node),name)}(this[0],name):void 0:this.each(function(){setData(this,name,value)})},$.data=function(elem,name,value){return $(elem).data(name,value)},$.hasData=function(elem){var id=elem[exp],store=id&&data[id];return!!store&&!$.isEmptyObject(store)},$.fn.removeData=function(names){return"string"==typeof names&&(names=names.split(/\s+/)),this.each(function(){var id=this[exp],store=id&&data[id];store&&$.each(names||store,function(key){delete store[names?camelize(this):key]})})},["remove","empty"].forEach(function(methodName){var origFn=$.fn[methodName];$.fn[methodName]=function(){var elements=this.find("*");return"remove"===methodName&&(elements=elements.add(this)),elements.removeData(),origFn.call(this)}})}(Zepto),Zepto)}(window)},{}],20:[function(require,module,exports){var root,factory;root=this,factory=function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s="./src/index.js")}({"./src/bitap/bitap_matched_indices.js":function(module,exports){module.exports=function(){for(var matchmask=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],minMatchCharLength=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,matchedIndices=[],start=-1,end=-1,i=0,len=matchmask.length;i<len;i+=1){var match=matchmask[i];match&&-1===start?start=i:match||-1===start||(minMatchCharLength<=(end=i-1)-start+1&&matchedIndices.push([start,end]),start=-1)}return matchmask[i-1]&&minMatchCharLength<=i-start&&matchedIndices.push([start,i-1]),matchedIndices}},"./src/bitap/bitap_pattern_alphabet.js":function(module,exports){module.exports=function(pattern){for(var mask={},len=pattern.length,i=0;i<len;i+=1)mask[pattern.charAt(i)]=0;for(var _i=0;_i<len;_i+=1)mask[pattern.charAt(_i)]|=1<<len-_i-1;return mask}},"./src/bitap/bitap_regex_search.js":function(module,exports){var SPECIAL_CHARS_REGEX=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;module.exports=function(text,pattern){var tokenSeparator=2<arguments.length&&void 0!==arguments[2]?arguments[2]:/ +/g,regex=new RegExp(pattern.replace(SPECIAL_CHARS_REGEX,"\\$&").replace(tokenSeparator,"|")),matches=text.match(regex),isMatch=!!matches,matchedIndices=[];if(isMatch)for(var i=0,matchesLen=matches.length;i<matchesLen;i+=1){var match=matches[i];matchedIndices.push([text.indexOf(match),match.length-1])}return{score:isMatch?.5:1,isMatch:isMatch,matchedIndices:matchedIndices}}},"./src/bitap/bitap_score.js":function(module,exports){module.exports=function(pattern,_ref){var _ref$errors=_ref.errors,errors=void 0===_ref$errors?0:_ref$errors,_ref$currentLocation=_ref.currentLocation,currentLocation=void 0===_ref$currentLocation?0:_ref$currentLocation,_ref$expectedLocation=_ref.expectedLocation,expectedLocation=void 0===_ref$expectedLocation?0:_ref$expectedLocation,_ref$distance=_ref.distance,distance=void 0===_ref$distance?100:_ref$distance,accuracy=errors/pattern.length,proximity=Math.abs(expectedLocation-currentLocation);return distance?accuracy+proximity/distance:proximity?1:accuracy}},"./src/bitap/bitap_search.js":function(module,exports,__webpack_require__){var bitapScore=__webpack_require__("./src/bitap/bitap_score.js"),matchedIndices=__webpack_require__("./src/bitap/bitap_matched_indices.js");module.exports=function(text,pattern,patternAlphabet,_ref){for(var _ref$location=_ref.location,location=void 0===_ref$location?0:_ref$location,_ref$distance=_ref.distance,distance=void 0===_ref$distance?100:_ref$distance,_ref$threshold=_ref.threshold,threshold=void 0===_ref$threshold?.6:_ref$threshold,_ref$findAllMatches=_ref.findAllMatches,findAllMatches=void 0!==_ref$findAllMatches&&_ref$findAllMatches,_ref$minMatchCharLeng=_ref.minMatchCharLength,minMatchCharLength=void 0===_ref$minMatchCharLeng?1:_ref$minMatchCharLeng,expectedLocation=location,textLen=text.length,currentThreshold=threshold,bestLocation=text.indexOf(pattern,expectedLocation),patternLen=pattern.length,matchMask=[],i=0;i<textLen;i+=1)matchMask[i]=0;if(-1!==bestLocation){var score=bitapScore(pattern,{errors:0,currentLocation:bestLocation,expectedLocation:expectedLocation,distance:distance});if(currentThreshold=Math.min(score,currentThreshold),-1!==(bestLocation=text.lastIndexOf(pattern,expectedLocation+patternLen))){var _score=bitapScore(pattern,{errors:0,currentLocation:bestLocation,expectedLocation:expectedLocation,distance:distance});currentThreshold=Math.min(_score,currentThreshold)}}bestLocation=-1;for(var lastBitArr=[],finalScore=1,binMax=patternLen+textLen,mask=1<<patternLen-1,_i=0;_i<patternLen;_i+=1){for(var binMin=0,binMid=binMax;binMin<binMid;){bitapScore(pattern,{errors:_i,currentLocation:expectedLocation+binMid,expectedLocation:expectedLocation,distance:distance})<=currentThreshold?binMin=binMid:binMax=binMid,binMid=Math.floor((binMax-binMin)/2+binMin)}binMax=binMid;var start=Math.max(1,expectedLocation-binMid+1),finish=findAllMatches?textLen:Math.min(expectedLocation+binMid,textLen)+patternLen,bitArr=Array(finish+2);bitArr[finish+1]=(1<<_i)-1;for(var j=finish;start<=j;j-=1){var currentLocation=j-1,charMatch=patternAlphabet[text.charAt(currentLocation)];if(charMatch&&(matchMask[currentLocation]=1),bitArr[j]=(bitArr[j+1]<<1|1)&charMatch,0!==_i&&(bitArr[j]|=(lastBitArr[j+1]|lastBitArr[j])<<1|1|lastBitArr[j+1]),bitArr[j]&mask&&(finalScore=bitapScore(pattern,{errors:_i,currentLocation:currentLocation,expectedLocation:expectedLocation,distance:distance}))<=currentThreshold){if(currentThreshold=finalScore,(bestLocation=currentLocation)<=expectedLocation)break;start=Math.max(1,2*expectedLocation-bestLocation)}}if(currentThreshold<bitapScore(pattern,{errors:_i+1,currentLocation:expectedLocation,expectedLocation:expectedLocation,distance:distance}))break;lastBitArr=bitArr}return{isMatch:0<=bestLocation,score:0===finalScore?.001:finalScore,matchedIndices:matchedIndices(matchMask,minMatchCharLength)}}},"./src/bitap/index.js":function(module,exports,__webpack_require__){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var bitapRegexSearch=__webpack_require__("./src/bitap/bitap_regex_search.js"),bitapSearch=__webpack_require__("./src/bitap/bitap_search.js"),patternAlphabet=__webpack_require__("./src/bitap/bitap_pattern_alphabet.js"),Bitap=function(){function Bitap(pattern,_ref){var _ref$location=_ref.location,location=void 0===_ref$location?0:_ref$location,_ref$distance=_ref.distance,distance=void 0===_ref$distance?100:_ref$distance,_ref$threshold=_ref.threshold,threshold=void 0===_ref$threshold?.6:_ref$threshold,_ref$maxPatternLength=_ref.maxPatternLength,maxPatternLength=void 0===_ref$maxPatternLength?32:_ref$maxPatternLength,_ref$isCaseSensitive=_ref.isCaseSensitive,isCaseSensitive=void 0!==_ref$isCaseSensitive&&_ref$isCaseSensitive,_ref$tokenSeparator=_ref.tokenSeparator,tokenSeparator=void 0===_ref$tokenSeparator?/ +/g:_ref$tokenSeparator,_ref$findAllMatches=_ref.findAllMatches,findAllMatches=void 0!==_ref$findAllMatches&&_ref$findAllMatches,_ref$minMatchCharLeng=_ref.minMatchCharLength,minMatchCharLength=void 0===_ref$minMatchCharLeng?1:_ref$minMatchCharLeng;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Bitap),this.options={location:location,distance:distance,threshold:threshold,maxPatternLength:maxPatternLength,isCaseSensitive:isCaseSensitive,tokenSeparator:tokenSeparator,findAllMatches:findAllMatches,minMatchCharLength:minMatchCharLength},this.pattern=this.options.isCaseSensitive?pattern:pattern.toLowerCase(),this.pattern.length<=maxPatternLength&&(this.patternAlphabet=patternAlphabet(this.pattern))}var Constructor,protoProps,staticProps;return Constructor=Bitap,(protoProps=[{key:"search",value:function(text){if(this.options.isCaseSensitive||(text=text.toLowerCase()),this.pattern===text)return{isMatch:!0,score:0,matchedIndices:[[0,text.length-1]]};var _this$options=this.options,maxPatternLength=_this$options.maxPatternLength,tokenSeparator=_this$options.tokenSeparator;if(this.pattern.length>maxPatternLength)return bitapRegexSearch(text,this.pattern,tokenSeparator);var _this$options2=this.options,location=_this$options2.location,distance=_this$options2.distance,threshold=_this$options2.threshold,findAllMatches=_this$options2.findAllMatches,minMatchCharLength=_this$options2.minMatchCharLength;return bitapSearch(text,this.pattern,this.patternAlphabet,{location:location,distance:distance,threshold:threshold,findAllMatches:findAllMatches,minMatchCharLength:minMatchCharLength})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Bitap}();module.exports=Bitap},"./src/helpers/deep_value.js":function(module,exports,__webpack_require__){var isArray=__webpack_require__("./src/helpers/is_array.js");module.exports=function(obj,path){return function deepValue(obj,path,list){if(path){var dotIndex=path.indexOf("."),firstSegment=path,remaining=null;-1!==dotIndex&&(firstSegment=path.slice(0,dotIndex),remaining=path.slice(dotIndex+1));var value=obj[firstSegment];if(null!=value)if(remaining||"string"!=typeof value&&"number"!=typeof value)if(isArray(value))for(var i=0,len=value.length;i<len;i+=1)deepValue(value[i],remaining,list);else remaining&&deepValue(value,remaining,list);else list.push(value.toString())}else list.push(obj);return list}(obj,path,[])}},"./src/helpers/is_array.js":function(module,exports){module.exports=function(obj){return Array.isArray?Array.isArray(obj):"[object Array]"===Object.prototype.toString.call(obj)}},"./src/index.js":function(module,exports,__webpack_require__){function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Bitap=__webpack_require__("./src/bitap/index.js"),deepValue=__webpack_require__("./src/helpers/deep_value.js"),isArray=__webpack_require__("./src/helpers/is_array.js"),Fuse=function(){function Fuse(list,_ref){var _ref$location=_ref.location,location=void 0===_ref$location?0:_ref$location,_ref$distance=_ref.distance,distance=void 0===_ref$distance?100:_ref$distance,_ref$threshold=_ref.threshold,threshold=void 0===_ref$threshold?.6:_ref$threshold,_ref$maxPatternLength=_ref.maxPatternLength,maxPatternLength=void 0===_ref$maxPatternLength?32:_ref$maxPatternLength,_ref$caseSensitive=_ref.caseSensitive,caseSensitive=void 0!==_ref$caseSensitive&&_ref$caseSensitive,_ref$tokenSeparator=_ref.tokenSeparator,tokenSeparator=void 0===_ref$tokenSeparator?/ +/g:_ref$tokenSeparator,_ref$findAllMatches=_ref.findAllMatches,findAllMatches=void 0!==_ref$findAllMatches&&_ref$findAllMatches,_ref$minMatchCharLeng=_ref.minMatchCharLength,minMatchCharLength=void 0===_ref$minMatchCharLeng?1:_ref$minMatchCharLeng,_ref$id=_ref.id,id=void 0===_ref$id?null:_ref$id,_ref$keys=_ref.keys,keys=void 0===_ref$keys?[]:_ref$keys,_ref$shouldSort=_ref.shouldSort,shouldSort=void 0===_ref$shouldSort||_ref$shouldSort,_ref$getFn=_ref.getFn,getFn=void 0===_ref$getFn?deepValue:_ref$getFn,_ref$sortFn=_ref.sortFn,sortFn=void 0===_ref$sortFn?function(a,b){return a.score-b.score}:_ref$sortFn,_ref$tokenize=_ref.tokenize,tokenize=void 0!==_ref$tokenize&&_ref$tokenize,_ref$matchAllTokens=_ref.matchAllTokens,matchAllTokens=void 0!==_ref$matchAllTokens&&_ref$matchAllTokens,_ref$includeMatches=_ref.includeMatches,includeMatches=void 0!==_ref$includeMatches&&_ref$includeMatches,_ref$includeScore=_ref.includeScore,includeScore=void 0!==_ref$includeScore&&_ref$includeScore,_ref$verbose=_ref.verbose,verbose=void 0!==_ref$verbose&&_ref$verbose;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Fuse),this.options={location:location,distance:distance,threshold:threshold,maxPatternLength:maxPatternLength,isCaseSensitive:caseSensitive,tokenSeparator:tokenSeparator,findAllMatches:findAllMatches,minMatchCharLength:minMatchCharLength,id:id,keys:keys,includeMatches:includeMatches,includeScore:includeScore,shouldSort:shouldSort,getFn:getFn,sortFn:sortFn,verbose:verbose,tokenize:tokenize,matchAllTokens:matchAllTokens},this.setCollection(list)}var Constructor,protoProps,staticProps;return Constructor=Fuse,(protoProps=[{key:"setCollection",value:function(list){return this.list=list}},{key:"search",value:function(pattern){var opts=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(pattern,'"'));var _this$_prepareSearche=this._prepareSearchers(pattern),tokenSearchers=_this$_prepareSearche.tokenSearchers,fullSearcher=_this$_prepareSearche.fullSearcher,_this$_search=this._search(tokenSearchers,fullSearcher),weights=_this$_search.weights,results=_this$_search.results;return this._computeScore(weights,results),this.options.shouldSort&&this._sort(results),opts.limit&&"number"==typeof opts.limit&&(results=results.slice(0,opts.limit)),this._format(results)}},{key:"_prepareSearchers",value:function(){var pattern=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",tokenSearchers=[];if(this.options.tokenize)for(var tokens=pattern.split(this.options.tokenSeparator),i=0,len=tokens.length;i<len;i+=1)tokenSearchers.push(new Bitap(tokens[i],this.options));return{tokenSearchers:tokenSearchers,fullSearcher:new Bitap(pattern,this.options)}}},{key:"_search",value:function(){var tokenSearchers=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],fullSearcher=1<arguments.length?arguments[1]:void 0,list=this.list,resultMap={},results=[];if("string"==typeof list[0]){for(var i=0,len=list.length;i<len;i+=1)this._analyze({key:"",value:list[i],record:i,index:i},{resultMap:resultMap,results:results,tokenSearchers:tokenSearchers,fullSearcher:fullSearcher});return{weights:null,results:results}}for(var weights={},_i=0,_len=list.length;_i<_len;_i+=1)for(var item=list[_i],j=0,keysLen=this.options.keys.length;j<keysLen;j+=1){var key=this.options.keys[j];if("string"!=typeof key){if(weights[key.name]={weight:1-key.weight||1},key.weight<=0||1<key.weight)throw new Error("Key weight has to be > 0 and <= 1");key=key.name}else weights[key]={weight:1};this._analyze({key:key,value:this.options.getFn(item,key),record:item,index:_i},{resultMap:resultMap,results:results,tokenSearchers:tokenSearchers,fullSearcher:fullSearcher})}return{weights:weights,results:results}}},{key:"_analyze",value:function(_ref2,_ref3){var key=_ref2.key,_ref2$arrayIndex=_ref2.arrayIndex,arrayIndex=void 0===_ref2$arrayIndex?-1:_ref2$arrayIndex,value=_ref2.value,record=_ref2.record,index=_ref2.index,_ref3$tokenSearchers=_ref3.tokenSearchers,tokenSearchers=void 0===_ref3$tokenSearchers?[]:_ref3$tokenSearchers,_ref3$fullSearcher=_ref3.fullSearcher,fullSearcher=void 0===_ref3$fullSearcher?[]:_ref3$fullSearcher,_ref3$resultMap=_ref3.resultMap,resultMap=void 0===_ref3$resultMap?{}:_ref3$resultMap,_ref3$results=_ref3.results,results=void 0===_ref3$results?[]:_ref3$results;if(null!=value){var exists=!1,averageScore=-1,numTextMatches=0;if("string"==typeof value){this._log("\nKey: ".concat(""===key?"-":key));var mainSearchResult=fullSearcher.search(value);if(this._log('Full text: "'.concat(value,'", score: ').concat(mainSearchResult.score)),this.options.tokenize){for(var words=value.split(this.options.tokenSeparator),scores=[],i=0;i<tokenSearchers.length;i+=1){var tokenSearcher=tokenSearchers[i];this._log('\nPattern: "'.concat(tokenSearcher.pattern,'"'));for(var hasMatchInText=!1,j=0;j<words.length;j+=1){var word=words[j],tokenSearchResult=tokenSearcher.search(word),obj={};tokenSearchResult.isMatch?(obj[word]=tokenSearchResult.score,hasMatchInText=exists=!0,scores.push(tokenSearchResult.score)):(obj[word]=1,this.options.matchAllTokens||scores.push(1)),this._log('Token: "'.concat(word,'", score: ').concat(obj[word]))}hasMatchInText&&(numTextMatches+=1)}averageScore=scores[0];for(var scoresLen=scores.length,_i2=1;_i2<scoresLen;_i2+=1)averageScore+=scores[_i2];averageScore/=scoresLen,this._log("Token score average:",averageScore)}var finalScore=mainSearchResult.score;-1<averageScore&&(finalScore=(finalScore+averageScore)/2),this._log("Score average:",finalScore);var checkTextMatches=!this.options.tokenize||!this.options.matchAllTokens||numTextMatches>=tokenSearchers.length;if(this._log("\nCheck Matches: ".concat(checkTextMatches)),(exists||mainSearchResult.isMatch)&&checkTextMatches){var existingResult=resultMap[index];existingResult?existingResult.output.push({key:key,arrayIndex:arrayIndex,value:value,score:finalScore,matchedIndices:mainSearchResult.matchedIndices}):(resultMap[index]={item:record,output:[{key:key,arrayIndex:arrayIndex,value:value,score:finalScore,matchedIndices:mainSearchResult.matchedIndices}]},results.push(resultMap[index]))}}else if(isArray(value))for(var _i3=0,len=value.length;_i3<len;_i3+=1)this._analyze({key:key,arrayIndex:_i3,value:value[_i3],record:record,index:index},{resultMap:resultMap,results:results,tokenSearchers:tokenSearchers,fullSearcher:fullSearcher})}}},{key:"_computeScore",value:function(weights,results){this._log("\n\nComputing score:\n");for(var i=0,len=results.length;i<len;i+=1){for(var output=results[i].output,scoreLen=output.length,currScore=1,bestScore=1,j=0;j<scoreLen;j+=1){var weight=weights?weights[output[j].key].weight:1,nScore=(1===weight?output[j].score:output[j].score||.001)*weight;1!==weight?bestScore=Math.min(bestScore,nScore):currScore*=output[j].nScore=nScore}results[i].score=1===bestScore?currScore:bestScore,this._log(results[i])}}},{key:"_sort",value:function(results){this._log("\n\nSorting...."),results.sort(this.options.sortFn)}},{key:"_format",value:function(results){var finalOutput=[];if(this.options.verbose){var cache=[];this._log("\n\nOutput:\n\n",JSON.stringify(results,function(key,value){if("object"===_typeof(value)&&null!==value){if(-1!==cache.indexOf(value))return;cache.push(value)}return value})),cache=null}var transformers=[];this.options.includeMatches&&transformers.push(function(result,data){var output=result.output;data.matches=[];for(var i=0,len=output.length;i<len;i+=1){var item=output[i];if(0!==item.matchedIndices.length){var obj={indices:item.matchedIndices,value:item.value};item.key&&(obj.key=item.key),item.hasOwnProperty("arrayIndex")&&-1<item.arrayIndex&&(obj.arrayIndex=item.arrayIndex),data.matches.push(obj)}}}),this.options.includeScore&&transformers.push(function(result,data){data.score=result.score});for(var i=0,len=results.length;i<len;i+=1){var result=results[i];if(this.options.id&&(result.item=this.options.getFn(result.item,this.options.id)[0]),transformers.length){for(var data={item:result.item},j=0,_len2=transformers.length;j<_len2;j+=1)transformers[j](result,data);finalOutput.push(data)}else finalOutput.push(result.item)}return finalOutput}},{key:"_log",value:function(){var _console;this.options.verbose&&(_console=console).log.apply(_console,arguments)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Fuse}();module.exports=Fuse}})},"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("Fuse",[],factory):"object"==typeof exports?exports.Fuse=factory():root.Fuse=factory()},{}],21:[function(require,module,exports){!function(window,document,exportName,undefined){"use strict";var assign,VENDOR_PREFIXES=["","webkit","Moz","MS","ms","o"],TEST_ELEMENT=document.createElement("div"),TYPE_FUNCTION="function",round=Math.round,abs=Math.abs,now=Date.now;function setTimeoutContext(fn,timeout,context){return setTimeout(bindFn(fn,context),timeout)}function invokeArrayArg(arg,fn,context){return!!Array.isArray(arg)&&(each(arg,context[fn],context),!0)}function each(obj,iterator,context){var i;if(obj)if(obj.forEach)obj.forEach(iterator,context);else if(obj.length!==undefined)for(i=0;i<obj.length;)iterator.call(context,obj[i],i,obj),i++;else for(i in obj)obj.hasOwnProperty(i)&&iterator.call(context,obj[i],i,obj)}function deprecate(method,name,message){var deprecationMessage="DEPRECATED METHOD: "+name+"\n"+message+" AT \n";return function(){var e=new Error("get-stack-trace"),stack=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",log=window.console&&(window.console.warn||window.console.log);return log&&log.call(window.console,deprecationMessage,stack),method.apply(this,arguments)}}assign="function"!=typeof Object.assign?function(target){if(target===undefined||null===target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),index=1;index<arguments.length;index++){var source=arguments[index];if(source!==undefined&&null!==source)for(var nextKey in source)source.hasOwnProperty(nextKey)&&(output[nextKey]=source[nextKey])}return output}:Object.assign;var extend=deprecate(function(dest,src,merge){for(var keys=Object.keys(src),i=0;i<keys.length;)(!merge||merge&&dest[keys[i]]===undefined)&&(dest[keys[i]]=src[keys[i]]),i++;return dest},"extend","Use `assign`."),merge=deprecate(function(dest,src){return extend(dest,src,!0)},"merge","Use `assign`.");function inherit(child,base,properties){var childP,baseP=base.prototype;(childP=child.prototype=Object.create(baseP)).constructor=child,childP._super=baseP,properties&&assign(childP,properties)}function bindFn(fn,context){return function(){return fn.apply(context,arguments)}}function boolOrFn(val,args){return typeof val==TYPE_FUNCTION?val.apply(args&&args[0]||undefined,args):val}function ifUndefined(val1,val2){return val1===undefined?val2:val1}function addEventListeners(target,types,handler){each(splitStr(types),function(type){target.addEventListener(type,handler,!1)})}function removeEventListeners(target,types,handler){each(splitStr(types),function(type){target.removeEventListener(type,handler,!1)})}function hasParent(node,parent){for(;node;){if(node==parent)return!0;node=node.parentNode}return!1}function inStr(str,find){return-1<str.indexOf(find)}function splitStr(str){return str.trim().split(/\s+/g)}function inArray(src,find,findByKey){if(src.indexOf&&!findByKey)return src.indexOf(find);for(var i=0;i<src.length;){if(findByKey&&src[i][findByKey]==find||!findByKey&&src[i]===find)return i;i++}return-1}function toArray(obj){return Array.prototype.slice.call(obj,0)}function uniqueArray(src,key,sort){for(var results=[],values=[],i=0;i<src.length;){var val=key?src[i][key]:src[i];inArray(values,val)<0&&results.push(src[i]),values[i]=val,i++}return sort&&(results=key?results.sort(function(a,b){return a[key]>b[key]}):results.sort()),results}function prefixed(obj,property){for(var prefix,prop,camelProp=property[0].toUpperCase()+property.slice(1),i=0;i<VENDOR_PREFIXES.length;){if((prop=(prefix=VENDOR_PREFIXES[i])?prefix+camelProp:property)in obj)return prop;i++}return undefined}var _uniqueId=1;function getWindowForElement(element){var doc=element.ownerDocument||element;return doc.defaultView||doc.parentWindow||window}var SUPPORT_TOUCH="ontouchstart"in window,SUPPORT_POINTER_EVENTS=prefixed(window,"PointerEvent")!==undefined,SUPPORT_ONLY_TOUCH=SUPPORT_TOUCH&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),COMPUTE_INTERVAL=25,INPUT_START=1,INPUT_END=4,INPUT_CANCEL=8,DIRECTION_NONE=1,DIRECTION_LEFT=2,DIRECTION_RIGHT=4,DIRECTION_UP=8,DIRECTION_DOWN=16,DIRECTION_HORIZONTAL=DIRECTION_LEFT|DIRECTION_RIGHT,DIRECTION_VERTICAL=DIRECTION_UP|DIRECTION_DOWN,DIRECTION_ALL=DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,PROPS_XY=["x","y"],PROPS_CLIENT_XY=["clientX","clientY"];function Input(manager,callback){var self=this;this.manager=manager,this.callback=callback,this.element=manager.element,this.target=manager.options.inputTarget,this.domHandler=function(ev){boolOrFn(manager.options.enable,[manager])&&self.handler(ev)},this.init()}function inputHandler(manager,eventType,input){var pointersLen=input.pointers.length,changedPointersLen=input.changedPointers.length,isFirst=eventType&INPUT_START&&pointersLen-changedPointersLen==0,isFinal=eventType&(INPUT_END|INPUT_CANCEL)&&pointersLen-changedPointersLen==0;input.isFirst=!!isFirst,input.isFinal=!!isFinal,isFirst&&(manager.session={}),input.eventType=eventType,function(manager,input){var session=manager.session,pointers=input.pointers,pointersLength=pointers.length;session.firstInput||(session.firstInput=simpleCloneInputData(input));1<pointersLength&&!session.firstMultiple?session.firstMultiple=simpleCloneInputData(input):1===pointersLength&&(session.firstMultiple=!1);var firstInput=session.firstInput,firstMultiple=session.firstMultiple,offsetCenter=firstMultiple?firstMultiple.center:firstInput.center,center=input.center=getCenter(pointers);input.timeStamp=now(),input.deltaTime=input.timeStamp-firstInput.timeStamp,input.angle=getAngle(offsetCenter,center),input.distance=getDistance(offsetCenter,center),function(session,input){var center=input.center,offset=session.offsetDelta||{},prevDelta=session.prevDelta||{},prevInput=session.prevInput||{};input.eventType!==INPUT_START&&prevInput.eventType!==INPUT_END||(prevDelta=session.prevDelta={x:prevInput.deltaX||0,y:prevInput.deltaY||0},offset=session.offsetDelta={x:center.x,y:center.y});input.deltaX=prevDelta.x+(center.x-offset.x),input.deltaY=prevDelta.y+(center.y-offset.y)}(session,input),input.offsetDirection=getDirection(input.deltaX,input.deltaY);var overallVelocity=getVelocity(input.deltaTime,input.deltaX,input.deltaY);input.overallVelocityX=overallVelocity.x,input.overallVelocityY=overallVelocity.y,input.overallVelocity=abs(overallVelocity.x)>abs(overallVelocity.y)?overallVelocity.x:overallVelocity.y,input.scale=firstMultiple?(start=firstMultiple.pointers,end=pointers,getDistance(end[0],end[1],PROPS_CLIENT_XY)/getDistance(start[0],start[1],PROPS_CLIENT_XY)):1,input.rotation=firstMultiple?function(start,end){return getAngle(end[1],end[0],PROPS_CLIENT_XY)+getAngle(start[1],start[0],PROPS_CLIENT_XY)}(firstMultiple.pointers,pointers):0,input.maxPointers=session.prevInput?input.pointers.length>session.prevInput.maxPointers?input.pointers.length:session.prevInput.maxPointers:input.pointers.length,function(session,input){var velocity,velocityX,velocityY,direction,last=session.lastInterval||input,deltaTime=input.timeStamp-last.timeStamp;if(input.eventType!=INPUT_CANCEL&&(COMPUTE_INTERVAL<deltaTime||last.velocity===undefined)){var deltaX=input.deltaX-last.deltaX,deltaY=input.deltaY-last.deltaY,v=getVelocity(deltaTime,deltaX,deltaY);velocityX=v.x,velocityY=v.y,velocity=abs(v.x)>abs(v.y)?v.x:v.y,direction=getDirection(deltaX,deltaY),session.lastInterval=input}else velocity=last.velocity,velocityX=last.velocityX,velocityY=last.velocityY,direction=last.direction;input.velocity=velocity,input.velocityX=velocityX,input.velocityY=velocityY,input.direction=direction}(session,input);var start,end;var target=manager.element;hasParent(input.srcEvent.target,target)&&(target=input.srcEvent.target);input.target=target}(manager,input),manager.emit("hammer.input",input),manager.recognize(input),manager.session.prevInput=input}function simpleCloneInputData(input){for(var pointers=[],i=0;i<input.pointers.length;)pointers[i]={clientX:round(input.pointers[i].clientX),clientY:round(input.pointers[i].clientY)},i++;return{timeStamp:now(),pointers:pointers,center:getCenter(pointers),deltaX:input.deltaX,deltaY:input.deltaY}}function getCenter(pointers){var pointersLength=pointers.length;if(1===pointersLength)return{x:round(pointers[0].clientX),y:round(pointers[0].clientY)};for(var x=0,y=0,i=0;i<pointersLength;)x+=pointers[i].clientX,y+=pointers[i].clientY,i++;return{x:round(x/pointersLength),y:round(y/pointersLength)}}function getVelocity(deltaTime,x,y){return{x:x/deltaTime||0,y:y/deltaTime||0}}function getDirection(x,y){return x===y?DIRECTION_NONE:abs(x)>=abs(y)?x<0?DIRECTION_LEFT:DIRECTION_RIGHT:y<0?DIRECTION_UP:DIRECTION_DOWN}function getDistance(p1,p2,props){props||(props=PROPS_XY);var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.sqrt(x*x+y*y)}function getAngle(p1,p2,props){props||(props=PROPS_XY);var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return 180*Math.atan2(y,x)/Math.PI}Input.prototype={handler:function(){},init:function(){this.evEl&&addEventListeners(this.element,this.evEl,this.domHandler),this.evTarget&&addEventListeners(this.target,this.evTarget,this.domHandler),this.evWin&&addEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&removeEventListeners(this.element,this.evEl,this.domHandler),this.evTarget&&removeEventListeners(this.target,this.evTarget,this.domHandler),this.evWin&&removeEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)}};var MOUSE_INPUT_MAP={mousedown:INPUT_START,mousemove:2,mouseup:INPUT_END},MOUSE_ELEMENT_EVENTS="mousedown",MOUSE_WINDOW_EVENTS="mousemove mouseup";function MouseInput(){this.evEl=MOUSE_ELEMENT_EVENTS,this.evWin=MOUSE_WINDOW_EVENTS,this.pressed=!1,Input.apply(this,arguments)}inherit(MouseInput,Input,{handler:function(ev){var eventType=MOUSE_INPUT_MAP[ev.type];eventType&INPUT_START&&0===ev.button&&(this.pressed=!0),2&eventType&&1!==ev.which&&(eventType=INPUT_END),this.pressed&&(eventType&INPUT_END&&(this.pressed=!1),this.callback(this.manager,eventType,{pointers:[ev],changedPointers:[ev],pointerType:"mouse",srcEvent:ev}))}});var POINTER_INPUT_MAP={pointerdown:INPUT_START,pointermove:2,pointerup:INPUT_END,pointercancel:INPUT_CANCEL,pointerout:INPUT_CANCEL},IE10_POINTER_TYPE_ENUM={2:"touch",3:"pen",4:"mouse",5:"kinect"},POINTER_ELEMENT_EVENTS="pointerdown",POINTER_WINDOW_EVENTS="pointermove pointerup pointercancel";function PointerEventInput(){this.evEl=POINTER_ELEMENT_EVENTS,this.evWin=POINTER_WINDOW_EVENTS,Input.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}window.MSPointerEvent&&!window.PointerEvent&&(POINTER_ELEMENT_EVENTS="MSPointerDown",POINTER_WINDOW_EVENTS="MSPointerMove MSPointerUp MSPointerCancel"),inherit(PointerEventInput,Input,{handler:function(ev){var store=this.store,removePointer=!1,eventTypeNormalized=ev.type.toLowerCase().replace("ms",""),eventType=POINTER_INPUT_MAP[eventTypeNormalized],pointerType=IE10_POINTER_TYPE_ENUM[ev.pointerType]||ev.pointerType,isTouch="touch"==pointerType,storeIndex=inArray(store,ev.pointerId,"pointerId");eventType&INPUT_START&&(0===ev.button||isTouch)?storeIndex<0&&(store.push(ev),storeIndex=store.length-1):eventType&(INPUT_END|INPUT_CANCEL)&&(removePointer=!0),storeIndex<0||(store[storeIndex]=ev,this.callback(this.manager,eventType,{pointers:store,changedPointers:[ev],pointerType:pointerType,srcEvent:ev}),removePointer&&store.splice(storeIndex,1))}});var SINGLE_TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:2,touchend:INPUT_END,touchcancel:INPUT_CANCEL};function SingleTouchInput(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,Input.apply(this,arguments)}inherit(SingleTouchInput,Input,{handler:function(ev){var type=SINGLE_TOUCH_INPUT_MAP[ev.type];if(type===INPUT_START&&(this.started=!0),this.started){var touches=function(ev,type){var all=toArray(ev.touches),changed=toArray(ev.changedTouches);type&(INPUT_END|INPUT_CANCEL)&&(all=uniqueArray(all.concat(changed),"identifier",!0));return[all,changed]}.call(this,ev,type);type&(INPUT_END|INPUT_CANCEL)&&touches[0].length-touches[1].length==0&&(this.started=!1),this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:"touch",srcEvent:ev})}}});var TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:2,touchend:INPUT_END,touchcancel:INPUT_CANCEL},TOUCH_TARGET_EVENTS="touchstart touchmove touchend touchcancel";function TouchInput(){this.evTarget=TOUCH_TARGET_EVENTS,this.targetIds={},Input.apply(this,arguments)}inherit(TouchInput,Input,{handler:function(ev){var type=TOUCH_INPUT_MAP[ev.type],touches=function(ev,type){var allTouches=toArray(ev.touches),targetIds=this.targetIds;if(type&(2|INPUT_START)&&1===allTouches.length)return targetIds[allTouches[0].identifier]=!0,[allTouches,allTouches];var i,targetTouches,changedTouches=toArray(ev.changedTouches),changedTargetTouches=[],target=this.target;if(targetTouches=allTouches.filter(function(touch){return hasParent(touch.target,target)}),type===INPUT_START)for(i=0;i<targetTouches.length;)targetIds[targetTouches[i].identifier]=!0,i++;i=0;for(;i<changedTouches.length;)targetIds[changedTouches[i].identifier]&&changedTargetTouches.push(changedTouches[i]),type&(INPUT_END|INPUT_CANCEL)&&delete targetIds[changedTouches[i].identifier],i++;return changedTargetTouches.length?[uniqueArray(targetTouches.concat(changedTargetTouches),"identifier",!0),changedTargetTouches]:void 0}.call(this,ev,type);touches&&this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:"touch",srcEvent:ev})}});var DEDUP_TIMEOUT=2500;function TouchMouseInput(){Input.apply(this,arguments);var handler=bindFn(this.handler,this);this.touch=new TouchInput(this.manager,handler),this.mouse=new MouseInput(this.manager,handler),this.primaryTouch=null,this.lastTouches=[]}function setLastTouch(eventData){var touch=eventData.changedPointers[0];if(touch.identifier===this.primaryTouch){var lastTouch={x:touch.clientX,y:touch.clientY};this.lastTouches.push(lastTouch);var lts=this.lastTouches;setTimeout(function(){var i=lts.indexOf(lastTouch);-1<i&&lts.splice(i,1)},DEDUP_TIMEOUT)}}inherit(TouchMouseInput,Input,{handler:function(manager,inputEvent,inputData){var isTouch="touch"==inputData.pointerType,isMouse="mouse"==inputData.pointerType;if(!(isMouse&&inputData.sourceCapabilities&&inputData.sourceCapabilities.firesTouchEvents)){if(isTouch)(function(eventType,eventData){eventType&INPUT_START?(this.primaryTouch=eventData.changedPointers[0].identifier,setLastTouch.call(this,eventData)):eventType&(INPUT_END|INPUT_CANCEL)&&setLastTouch.call(this,eventData)}).call(this,inputEvent,inputData);else if(isMouse&&function(eventData){for(var x=eventData.srcEvent.clientX,y=eventData.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var t=this.lastTouches[i],dx=Math.abs(x-t.x),dy=Math.abs(y-t.y);if(dx<=25&&dy<=25)return!0}return!1}.call(this,inputData))return;this.callback(manager,inputEvent,inputData)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var PREFIXED_TOUCH_ACTION=prefixed(TEST_ELEMENT.style,"touchAction"),NATIVE_TOUCH_ACTION=PREFIXED_TOUCH_ACTION!==undefined,TOUCH_ACTION_MAP=function(){if(!NATIVE_TOUCH_ACTION)return!1;var touchMap={},cssSupports=window.CSS&&window.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(val){touchMap[val]=!cssSupports||window.CSS.supports("touch-action",val)}),touchMap}();function TouchAction(manager,value){this.manager=manager,this.set(value)}TouchAction.prototype={set:function(value){"compute"==value&&(value=this.compute()),NATIVE_TOUCH_ACTION&&this.manager.element.style&&TOUCH_ACTION_MAP[value]&&(this.manager.element.style[PREFIXED_TOUCH_ACTION]=value),this.actions=value.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var actions=[];return each(this.manager.recognizers,function(recognizer){boolOrFn(recognizer.options.enable,[recognizer])&&(actions=actions.concat(recognizer.getTouchAction()))}),function(actions){if(inStr(actions,"none"))return"none";var hasPanX=inStr(actions,"pan-x"),hasPanY=inStr(actions,"pan-y");if(hasPanX&&hasPanY)return"none";if(hasPanX||hasPanY)return hasPanX?"pan-x":"pan-y";if(inStr(actions,"manipulation"))return"manipulation";return"auto"}(actions.join(" "))},preventDefaults:function(input){var srcEvent=input.srcEvent,direction=input.offsetDirection;if(this.manager.session.prevented)srcEvent.preventDefault();else{var actions=this.actions,hasNone=inStr(actions,"none")&&!TOUCH_ACTION_MAP.none,hasPanY=inStr(actions,"pan-y")&&!TOUCH_ACTION_MAP["pan-y"],hasPanX=inStr(actions,"pan-x")&&!TOUCH_ACTION_MAP["pan-x"];if(hasNone){var isTapPointer=1===input.pointers.length,isTapMovement=input.distance<2,isTapTouchTime=input.deltaTime<250;if(isTapPointer&&isTapMovement&&isTapTouchTime)return}if(!hasPanX||!hasPanY)return hasNone||hasPanY&&direction&DIRECTION_HORIZONTAL||hasPanX&&direction&DIRECTION_VERTICAL?this.preventSrc(srcEvent):void 0}},preventSrc:function(srcEvent){this.manager.session.prevented=!0,srcEvent.preventDefault()}};var STATE_POSSIBLE=1;function Recognizer(options){this.options=assign({},this.defaults,options||{}),this.id=_uniqueId++,this.manager=null,this.options.enable=ifUndefined(this.options.enable,!0),this.state=STATE_POSSIBLE,this.simultaneous={},this.requireFail=[]}function stateStr(state){return 16&state?"cancel":8&state?"end":4&state?"move":2&state?"start":""}function directionStr(direction){return direction==DIRECTION_DOWN?"down":direction==DIRECTION_UP?"up":direction==DIRECTION_LEFT?"left":direction==DIRECTION_RIGHT?"right":""}function getRecognizerByNameIfManager(otherRecognizer,recognizer){var manager=recognizer.manager;return manager?manager.get(otherRecognizer):otherRecognizer}function AttrRecognizer(){Recognizer.apply(this,arguments)}function PanRecognizer(){AttrRecognizer.apply(this,arguments),this.pX=null,this.pY=null}function PinchRecognizer(){AttrRecognizer.apply(this,arguments)}function PressRecognizer(){Recognizer.apply(this,arguments),this._timer=null,this._input=null}function RotateRecognizer(){AttrRecognizer.apply(this,arguments)}function SwipeRecognizer(){AttrRecognizer.apply(this,arguments)}function TapRecognizer(){Recognizer.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Hammer(element,options){return(options=options||{}).recognizers=ifUndefined(options.recognizers,Hammer.defaults.preset),new Manager(element,options)}Recognizer.prototype={defaults:{},set:function(options){return assign(this.options,options),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"recognizeWith",this))return this;var simultaneous=this.simultaneous;return simultaneous[(otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this)).id]||(simultaneous[otherRecognizer.id]=otherRecognizer).recognizeWith(this),this},dropRecognizeWith:function(otherRecognizer){return invokeArrayArg(otherRecognizer,"dropRecognizeWith",this)||(otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this),delete this.simultaneous[otherRecognizer.id]),this},requireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"requireFailure",this))return this;var requireFail=this.requireFail;return-1===inArray(requireFail,otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this))&&(requireFail.push(otherRecognizer),otherRecognizer.requireFailure(this)),this},dropRequireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"dropRequireFailure",this))return this;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);var index=inArray(this.requireFail,otherRecognizer);return-1<index&&this.requireFail.splice(index,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(otherRecognizer){return!!this.simultaneous[otherRecognizer.id]},emit:function(input){var self=this,state=this.state;function emit(event){self.manager.emit(event,input)}state<8&&emit(self.options.event+stateStr(state)),emit(self.options.event),input.additionalEvent&&emit(input.additionalEvent),8<=state&&emit(self.options.event+stateStr(state))},tryEmit:function(input){if(this.canEmit())return this.emit(input);this.state=32},canEmit:function(){for(var i=0;i<this.requireFail.length;){if(!(this.requireFail[i].state&(32|STATE_POSSIBLE)))return!1;i++}return!0},recognize:function(inputData){var inputDataClone=assign({},inputData);if(!boolOrFn(this.options.enable,[this,inputDataClone]))return this.reset(),void(this.state=32);56&this.state&&(this.state=STATE_POSSIBLE),this.state=this.process(inputDataClone),30&this.state&&this.tryEmit(inputDataClone)},process:function(inputData){},getTouchAction:function(){},reset:function(){}},inherit(AttrRecognizer,Recognizer,{defaults:{pointers:1},attrTest:function(input){var optionPointers=this.options.pointers;return 0===optionPointers||input.pointers.length===optionPointers},process:function(input){var state=this.state,eventType=input.eventType,isRecognized=6&state,isValid=this.attrTest(input);return isRecognized&&(eventType&INPUT_CANCEL||!isValid)?16|state:isRecognized||isValid?eventType&INPUT_END?8|state:2&state?4|state:2:32}}),inherit(PanRecognizer,AttrRecognizer,{defaults:{event:"pan",threshold:10,pointers:1,direction:DIRECTION_ALL},getTouchAction:function(){var direction=this.options.direction,actions=[];return direction&DIRECTION_HORIZONTAL&&actions.push("pan-y"),direction&DIRECTION_VERTICAL&&actions.push("pan-x"),actions},directionTest:function(input){var options=this.options,hasMoved=!0,distance=input.distance,direction=input.direction,x=input.deltaX,y=input.deltaY;return direction&options.direction||(distance=options.direction&DIRECTION_HORIZONTAL?(direction=0===x?DIRECTION_NONE:x<0?DIRECTION_LEFT:DIRECTION_RIGHT,hasMoved=x!=this.pX,Math.abs(input.deltaX)):(direction=0===y?DIRECTION_NONE:y<0?DIRECTION_UP:DIRECTION_DOWN,hasMoved=y!=this.pY,Math.abs(input.deltaY))),input.direction=direction,hasMoved&&distance>options.threshold&&direction&options.direction},attrTest:function(input){return AttrRecognizer.prototype.attrTest.call(this,input)&&(2&this.state||!(2&this.state)&&this.directionTest(input))},emit:function(input){this.pX=input.deltaX,this.pY=input.deltaY;var direction=directionStr(input.direction);direction&&(input.additionalEvent=this.options.event+direction),this._super.emit.call(this,input)}}),inherit(PinchRecognizer,AttrRecognizer,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.scale-1)>this.options.threshold||2&this.state)},emit:function(input){if(1!==input.scale){var inOut=input.scale<1?"in":"out";input.additionalEvent=this.options.event+inOut}this._super.emit.call(this,input)}}),inherit(PressRecognizer,Recognizer,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(input){var options=this.options,validPointers=input.pointers.length===options.pointers,validMovement=input.distance<options.threshold,validTime=input.deltaTime>options.time;if(this._input=input,!validMovement||!validPointers||input.eventType&(INPUT_END|INPUT_CANCEL)&&!validTime)this.reset();else if(input.eventType&INPUT_START)this.reset(),this._timer=setTimeoutContext(function(){this.state=8,this.tryEmit()},options.time,this);else if(input.eventType&INPUT_END)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(input){8===this.state&&(input&&input.eventType&INPUT_END?this.manager.emit(this.options.event+"up",input):(this._input.timeStamp=now(),this.manager.emit(this.options.event,this._input)))}}),inherit(RotateRecognizer,AttrRecognizer,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.rotation)>this.options.threshold||2&this.state)}}),inherit(SwipeRecognizer,AttrRecognizer,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,pointers:1},getTouchAction:function(){return PanRecognizer.prototype.getTouchAction.call(this)},attrTest:function(input){var velocity,direction=this.options.direction;return direction&(DIRECTION_HORIZONTAL|DIRECTION_VERTICAL)?velocity=input.overallVelocity:direction&DIRECTION_HORIZONTAL?velocity=input.overallVelocityX:direction&DIRECTION_VERTICAL&&(velocity=input.overallVelocityY),this._super.attrTest.call(this,input)&&direction&input.offsetDirection&&input.distance>this.options.threshold&&input.maxPointers==this.options.pointers&&abs(velocity)>this.options.velocity&&input.eventType&INPUT_END},emit:function(input){var direction=directionStr(input.offsetDirection);direction&&this.manager.emit(this.options.event+direction,input),this.manager.emit(this.options.event,input)}}),inherit(TapRecognizer,Recognizer,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(input){var options=this.options,validPointers=input.pointers.length===options.pointers,validMovement=input.distance<options.threshold,validTouchTime=input.deltaTime<options.time;if(this.reset(),input.eventType&INPUT_START&&0===this.count)return this.failTimeout();if(validMovement&&validTouchTime&&validPointers){if(input.eventType!=INPUT_END)return this.failTimeout();var validInterval=!this.pTime||input.timeStamp-this.pTime<options.interval,validMultiTap=!this.pCenter||getDistance(this.pCenter,input.center)<options.posThreshold;if(this.pTime=input.timeStamp,this.pCenter=input.center,validMultiTap&&validInterval?this.count+=1:this.count=1,this._input=input,0===this.count%options.taps)return this.hasRequireFailures()?(this._timer=setTimeoutContext(function(){this.state=8,this.tryEmit()},options.interval,this),2):8}return 32},failTimeout:function(){return this._timer=setTimeoutContext(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Hammer.VERSION="2.0.7",Hammer.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[RotateRecognizer,{enable:!1}],[PinchRecognizer,{enable:!1},["rotate"]],[SwipeRecognizer,{direction:DIRECTION_HORIZONTAL}],[PanRecognizer,{direction:DIRECTION_HORIZONTAL},["swipe"]],[TapRecognizer],[TapRecognizer,{event:"doubletap",taps:2},["tap"]],[PressRecognizer]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Manager(element,options){var manager;this.options=assign({},Hammer.defaults,options||{}),this.options.inputTarget=this.options.inputTarget||element,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=element,this.input=new((manager=this).options.inputClass||(SUPPORT_POINTER_EVENTS?PointerEventInput:SUPPORT_ONLY_TOUCH?TouchInput:SUPPORT_TOUCH?TouchMouseInput:MouseInput))(manager,inputHandler),this.touchAction=new TouchAction(this,this.options.touchAction),toggleCssProps(this,!0),each(this.options.recognizers,function(item){var recognizer=this.add(new item[0](item[1]));item[2]&&recognizer.recognizeWith(item[2]),item[3]&&recognizer.requireFailure(item[3])},this)}function toggleCssProps(manager,add){var prop,element=manager.element;element.style&&(each(manager.options.cssProps,function(value,name){prop=prefixed(element.style,name),element.style[prop]=add?(manager.oldCssProps[prop]=element.style[prop],value):manager.oldCssProps[prop]||""}),add||(manager.oldCssProps={}))}Manager.prototype={set:function(options){return assign(this.options,options),options.touchAction&&this.touchAction.update(),options.inputTarget&&(this.input.destroy(),this.input.target=options.inputTarget,this.input.init()),this},stop:function(force){this.session.stopped=force?2:1},recognize:function(inputData){var session=this.session;if(!session.stopped){var recognizer;this.touchAction.preventDefaults(inputData);var recognizers=this.recognizers,curRecognizer=session.curRecognizer;(!curRecognizer||curRecognizer&&8&curRecognizer.state)&&(curRecognizer=session.curRecognizer=null);for(var i=0;i<recognizers.length;)recognizer=recognizers[i],2===session.stopped||curRecognizer&&recognizer!=curRecognizer&&!recognizer.canRecognizeWith(curRecognizer)?recognizer.reset():recognizer.recognize(inputData),!curRecognizer&&14&recognizer.state&&(curRecognizer=session.curRecognizer=recognizer),i++}},get:function(recognizer){if(recognizer instanceof Recognizer)return recognizer;for(var recognizers=this.recognizers,i=0;i<recognizers.length;i++)if(recognizers[i].options.event==recognizer)return recognizers[i];return null},add:function(recognizer){if(invokeArrayArg(recognizer,"add",this))return this;var existing=this.get(recognizer.options.event);return existing&&this.remove(existing),this.recognizers.push(recognizer),(recognizer.manager=this).touchAction.update(),recognizer},remove:function(recognizer){if(invokeArrayArg(recognizer,"remove",this))return this;if(recognizer=this.get(recognizer)){var recognizers=this.recognizers,index=inArray(recognizers,recognizer);-1!==index&&(recognizers.splice(index,1),this.touchAction.update())}return this},on:function(events,handler){if(events!==undefined&&handler!==undefined){var handlers=this.handlers;return each(splitStr(events),function(event){handlers[event]=handlers[event]||[],handlers[event].push(handler)}),this}},off:function(events,handler){if(events!==undefined){var handlers=this.handlers;return each(splitStr(events),function(event){handler?handlers[event]&&handlers[event].splice(inArray(handlers[event],handler),1):delete handlers[event]}),this}},emit:function(event,data){this.options.domEvents&&function(event,data){var gestureEvent=document.createEvent("Event");gestureEvent.initEvent(event,!0,!0),(gestureEvent.gesture=data).target.dispatchEvent(gestureEvent)}(event,data);var handlers=this.handlers[event]&&this.handlers[event].slice();if(handlers&&handlers.length){data.type=event,data.preventDefault=function(){data.srcEvent.preventDefault()};for(var i=0;i<handlers.length;)handlers[i](data),i++}},destroy:function(){this.element&&toggleCssProps(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},assign(Hammer,{INPUT_START:INPUT_START,INPUT_MOVE:2,INPUT_END:INPUT_END,INPUT_CANCEL:INPUT_CANCEL,STATE_POSSIBLE:STATE_POSSIBLE,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:DIRECTION_NONE,DIRECTION_LEFT:DIRECTION_LEFT,DIRECTION_RIGHT:DIRECTION_RIGHT,DIRECTION_UP:DIRECTION_UP,DIRECTION_DOWN:DIRECTION_DOWN,DIRECTION_HORIZONTAL:DIRECTION_HORIZONTAL,DIRECTION_VERTICAL:DIRECTION_VERTICAL,DIRECTION_ALL:DIRECTION_ALL,Manager:Manager,Input:Input,TouchAction:TouchAction,TouchInput:TouchInput,MouseInput:MouseInput,PointerEventInput:PointerEventInput,TouchMouseInput:TouchMouseInput,SingleTouchInput:SingleTouchInput,Recognizer:Recognizer,AttrRecognizer:AttrRecognizer,Tap:TapRecognizer,Pan:PanRecognizer,Swipe:SwipeRecognizer,Pinch:PinchRecognizer,Rotate:RotateRecognizer,Press:PressRecognizer,on:addEventListeners,off:removeEventListeners,each:each,merge:merge,extend:extend,assign:assign,inherit:inherit,bindFn:bindFn,prefixed:prefixed}),(void 0!==window?window:"undefined"!=typeof self?self:{}).Hammer=Hammer,"function"==typeof define&&define.amd?define(function(){return Hammer}):void 0!==module&&module.exports?module.exports=Hammer:window.Hammer=Hammer}(window,document)},{}],22:[function(require,module,exports){"use strict";var draining,currentQueue,scheduleDrain,types=[require("./nextTick"),require("./mutation.js"),require("./messageChannel"),require("./stateChange"),require("./timeout")],queueIndex=-1,queue=[],scheduled=!1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&nextTick())}function nextTick(){if(!draining){draining=!(scheduled=!1);for(var len=queue.length,timeout=setTimeout(cleanUpNextTick);len;){for(currentQueue=queue,queue=[];currentQueue&&++queueIndex<len;)currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!(queueIndex=-1),clearTimeout(timeout)}}for(var i=-1,len=types.length;++i<len;)if(types[i]&&types[i].test&&types[i].test()){scheduleDrain=types[i].install(nextTick);break}function Item(fun,array){this.fun=fun,this.array=array}Item.prototype.run=function(){var fun=this.fun,array=this.array;switch(array.length){case 0:return fun();case 1:return fun(array[0]);case 2:return fun(array[0],array[1]);case 3:return fun(array[0],array[1],array[2]);default:return fun.apply(null,array)}},module.exports=function(task){var args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(task,args)),scheduled||draining||(scheduled=!0,scheduleDrain())}},{"./messageChannel":23,"./mutation.js":24,"./nextTick":25,"./stateChange":26,"./timeout":27}],23:[function(require,module,exports){(function(global){"use strict";exports.test=function(){return!global.setImmediate&&void 0!==global.MessageChannel},exports.install=function(func){var channel=new global.MessageChannel;return channel.port1.onmessage=func,function(){channel.port2.postMessage(0)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],24:[function(require,module,exports){(function(global){"use strict";var Mutation=global.MutationObserver||global.WebKitMutationObserver;exports.test=function(){return Mutation},exports.install=function(handle){var called=0,observer=new Mutation(handle),element=global.document.createTextNode("");return observer.observe(element,{characterData:!0}),function(){element.data=called=++called%2}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(require,module,exports){(function(process){"use strict";exports.test=function(){return void 0!==process&&!process.browser},exports.install=function(func){return function(){process.nextTick(func)}}}).call(this,require("_process"))},{_process:256}],26:[function(require,module,exports){(function(global){"use strict";exports.test=function(){return"document"in global&&"onreadystatechange"in global.document.createElement("script")},exports.install=function(handle){return function(){var scriptEl=global.document.createElement("script");return scriptEl.onreadystatechange=function(){handle(),scriptEl.onreadystatechange=null,scriptEl.parentNode.removeChild(scriptEl),scriptEl=null},global.document.documentElement.appendChild(scriptEl),handle}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(require,module,exports){"use strict";exports.test=function(){return!0},exports.install=function(t){return function(){setTimeout(t,0)}}},{}],28:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var _config,map,view,vectorLayer,imlayer,imExtent,imProjection,attributions,geoLocationId,geoLocationLast,map_1=__importDefault(require("ol/map")),image_1=__importDefault(require("ol/layer/image")),view_1=__importDefault(require("ol/view")),extent_1=__importDefault(require("ol/extent")),overlay_1=__importDefault(require("ol/overlay")),vector_1=__importDefault(require("ol/layer/vector")),imagestatic_1=__importDefault(require("ol/source/imagestatic")),vector_2=__importDefault(require("ol/source/vector")),projection_1=__importDefault(require("ol/proj/projection")),feature_1=__importDefault(require("ol/feature")),point_1=__importDefault(require("ol/geom/point")),polygon_1=__importDefault(require("ol/geom/polygon")),style_1=__importDefault(require("ol/style/style")),icon_1=__importDefault(require("ol/style/icon")),text_1=__importDefault(require("ol/style/text")),stroke_1=__importDefault(require("ol/style/stroke")),fill_1=__importDefault(require("ol/style/fill")),interaction_1=__importDefault(require("ol/interaction")),followingUser=!1,showResidences=!1,MAP_Xn=19.133691,MAP_Yn=72.916984,MAP_Zn=4189,MAP_Zyn=1655,MAP_WEIGHTS_X=[-7.769917472065843,159.26978694839946,244.46989575495544,-6.003894110679995,-.28864271213341297,.010398324019718075,4.215508849724247,-.6078830146963545,-7.0400449629241395],MAP_WEIGHTS_Y=[14.199431377059842,-158.80601990819815,68.9630034040724,5.796703402034644,1.1348242200568706,.11891051684489184,-.2930832938484276,.1448231125788526,-5.282895700923075];function moveToLocation(loc){moveMarker(loc.pixel_x,loc.pixel_y,!0)}function moveMarker(x,y,center,markerid){void 0===center&&(center=!0),void 0===markerid&&(markerid=_config.marker_id);var pos=[Number(x),3575-Number(y)],element=document.getElementById(markerid),marker=new overlay_1.default({position:pos,positioning:"bottom-center",element:element,stopEvent:!1,offset:[0,0]});map.addOverlay(marker),center&&(view.animate({center:pos}),view.animate({zoom:4.5}))}function hasGeolocation(){return!!navigator.geolocation}function moveGPS(center){null!=geoLocationLast&&moveMarker(geoLocationLast.pixel_x,geoLocationLast.pixel_y,center,_config.user_marker_id)}function getMapXY(position){var x=1e3*(position.coords.latitude-MAP_Xn),y=1e3*(position.coords.longitude-MAP_Yn),A=MAP_WEIGHTS_X,px=Math.round(MAP_Zn+A[0]+A[1]*x+A[2]*y+A[3]*x*x+A[4]*x*x*y+A[5]*x*x*y*y+A[6]*y*y+A[7]*x*y*y+A[8]*x*y);return A=MAP_WEIGHTS_Y,{pixel_x:px,pixel_y:Math.round(MAP_Zyn+A[0]+A[1]*x+A[2]*y+A[3]*x*x+A[4]*x*x*y+A[5]*x*x*y*y+A[6]*y*y+A[7]*x*y*y+A[8]*x*y)}}exports.getMap=function(config,locations,locationSelectCallback,mapLoadedCallback){_config=config;for(var features=[],_i=0,locations_1=locations;_i<locations_1.length;_i++){var loc=locations_1[_i],pos=[loc.pixel_x,3575-loc.pixel_y];if(null===loc.parent){var iconFeature=new feature_1.default({geometry:new point_1.default(pos),loc:loc});features.push(iconFeature)}}var vectorSource=new vector_2.default({features:features});vectorLayer=new vector_1.default({source:vectorSource,style:function(feature){var zoom=map.getView().getZoom(),loc=feature.get("loc");if(3!==loc.group_id||showResidences){var icon_color,font_size=3*zoom,loc_name=loc.name;"0"!==loc.short_name&&(loc_name=loc.short_name),icon_color=1===loc.group_id||4===loc.group_id||12===loc.group_id?"blue":3===loc.group_id?"green":2===loc.group_id?"yellow":"gray";var text=new text_1.default({offsetY:20,padding:[20,20,20,20],font:font_size+"px Roboto",text:loc_name,fill:new fill_1.default({color:"#ffffff"}),stroke:new stroke_1.default({color:"#444",width:3})}),icon=new icon_1.default({src:_config.markersBase+"marker_dot_"+icon_color+".png",scale:.2});return[new style_1.default({image:3<=zoom?icon:void 0,text:4<=zoom?text:void 0})]}}}),imExtent=[0,0,5430,3575],imProjection=new projection_1.default({code:"instiMAP",units:"pixels",extent:imExtent});var staticSource=new imagestatic_1.default({url:config.mapMinPath,attributions:attributions,projection:imProjection,imageExtent:imExtent,imageLoadFunction:function(image,src){var img=image.getImage();img.src=src,img.onload=function(){var highResSource,highRes;highResSource=new imagestatic_1.default({url:_config.mapPath,attributions:attributions,projection:imProjection,imageExtent:imExtent}),(highRes=new Image).src=_config.mapPath,highRes.onload=function(){imlayer.setSource(highResSource)},mapLoadedCallback()}}});imlayer=new image_1.default({source:staticSource});var interactions=interaction_1.default.defaults({altShiftDragRotate:!1,pinchRotate:!1});return view=new view_1.default({projection:imProjection,center:extent_1.default.getCenter(imExtent),zoom:3.4,minZoom:2,maxZoom:5.5,extent:[300,300,5e3,3e3]}),(map=new map_1.default({interactions:interactions,layers:[imlayer,vectorLayer],target:_config.map_id,view:view,controls:[]})).on("click",function(evt){var pixel=evt.pixel,pixelWithOffsetMin=[pixel[0]-30,pixel[1]+30],pixelWithOffsetMax=[pixel[0]+30,pixel[1]-30],XYMin=map.getCoordinateFromPixel(pixelWithOffsetMin),ext=map.getCoordinateFromPixel(pixelWithOffsetMax).concat(XYMin),extentFeat=new feature_1.default(new polygon_1.default([[[ext[0],ext[1]],[ext[0],ext[3]],[ext[2],ext[3]],[ext[2],ext[1]],[ext[0],ext[1]]]])),feature=vectorLayer.getSource().forEachFeatureIntersectingExtent(extentFeat.getGeometry().getExtent(),function(f){return f});if(feature){var location_1=feature.get("loc");moveToLocation(location_1),locationSelectCallback(location_1)}else moveMarker(-50,-50,!1),locationSelectCallback()}),map.on("pointermove",function(e){var pixel=map.getEventPixel(e.originalEvent),hit=map.hasFeatureAtPixel(pixel),nativeElem=document.getElementById(_config.map_id);null!=nativeElem&&(nativeElem.style.cursor=hit?"pointer":"move")}),map.on("pointerdrag",function(){followingUser=!1}),map},exports.moveToLocation=moveToLocation,exports.moveMarker=moveMarker,exports.setResidencesVisible=function(visible){showResidences=visible,vectorLayer.getSource().changed()},exports.hasGeolocation=hasGeolocation,exports.getGPS=function(failedCallback){if(hasGeolocation()){if(followingUser=!0,null!=geoLocationId)return void moveGPS(!0);geoLocationId=navigator.geolocation.watchPosition(function(position){var follow=followingUser||null==geoLocationLast,l=getMapXY(position);0<l.pixel_x&&0<l.pixel_y&&l.pixel_x<5430&&l.pixel_y<5375&&(geoLocationLast=l,moveGPS(follow))},function(){},{enableHighAccuracy:!0})}else failedCallback&&failedCallback()},exports.getMapXY=getMapXY,exports.isFollowingUser=function(){return followingUser},exports.getGeolocationLast=function(){return geoLocationLast},exports.cleanup=function(){null!=geoLocationId&&null!=geoLocationId&&navigator.geolocation.clearWatch(geoLocationId)}},{"ol/extent":54,"ol/feature":57,"ol/geom/point":81,"ol/geom/polygon":82,"ol/interaction":90,"ol/layer/image":107,"ol/layer/vector":110,"ol/map":115,"ol/overlay":128,"ol/proj/projection":145,"ol/source/imagestatic":210,"ol/source/vector":213,"ol/style/fill":225,"ol/style/icon":226,"ol/style/stroke":233,"ol/style/style":234,"ol/style/text":235,"ol/view":245}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_array_={binarySearch:function(haystack,needle,opt_comparator){for(var mid,cmp,comparator=opt_comparator||_ol_array_.numberSafeCompareFunction,low=0,high=haystack.length,found=!1;low<high;)(cmp=+comparator(haystack[mid=low+(high-low>>1)],needle))<0?low=mid+1:(high=mid,found=!cmp);return found?low:~low},numberSafeCompareFunction:function(a,b){return b<a?1:a<b?-1:0},includes:function(arr,obj){return 0<=arr.indexOf(obj)},linearFindNearest:function(arr,target,direction){var i,n=arr.length;if(arr[0]<=target)return 0;if(target<=arr[n-1])return n-1;if(0<direction){for(i=1;i<n;++i)if(arr[i]<target)return i-1}else if(direction<0){for(i=1;i<n;++i)if(arr[i]<=target)return i}else for(i=1;i<n;++i){if(arr[i]==target)return i;if(arr[i]<target)return arr[i-1]-target<target-arr[i]?i-1:i}return n-1},reverseSubArray:function(arr,begin,end){for(;begin<end;){var tmp=arr[begin];arr[begin]=arr[end],arr[end]=tmp,++begin,--end}},extend:function(arr,data){var i,extension=Array.isArray(data)?data:[data],length=extension.length;for(i=0;i<length;i++)arr[arr.length]=extension[i]},remove:function(arr,obj){var i=arr.indexOf(obj),found=-1<i;return found&&arr.splice(i,1),found},find:function(arr,func){for(var value,length=arr.length>>>0,i=0;i<length;i++)if(func(value=arr[i],i,arr))return value;return null},equals:function(arr1,arr2){var len1=arr1.length;if(len1!==arr2.length)return!1;for(var i=0;i<len1;i++)if(arr1[i]!==arr2[i])return!1;return!0},stableSort:function(arr,compareFnc){var i,length=arr.length,tmp=Array(arr.length);for(i=0;i<length;i++)tmp[i]={index:i,value:arr[i]};for(tmp.sort(function(a,b){return compareFnc(a.value,b.value)||a.index-b.index}),i=0;i<arr.length;i++)arr[i]=tmp[i].value},findIndex:function(arr,func){var index;return!arr.every(function(el,idx){return!func(el,index=idx,arr)})?index:-1},isSorted:function(arr,opt_func,opt_strict){var compare=opt_func||_ol_array_.numberSafeCompareFunction;return arr.every(function(currentVal,index){if(0===index)return!0;var res=compare(arr[index-1],currentVal);return!(0<res||opt_strict&&0===res)})}};exports.default=_ol_array_},{}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_index=require("./index.js"),_index2=(obj=_index)&&obj.__esModule?obj:{default:obj};var _ol_AssertionError_=function(code){var path=_index2.default.VERSION?_index2.default.VERSION.split("-")[0]:"latest";this.message="Assertion failed. See https://openlayers.org/en/"+path+"/doc/errors/#"+code+" for details.",this.code=code,this.name="AssertionError"};_index2.default.inherits(_ol_AssertionError_,Error),exports.default=_ol_AssertionError_},{"./index.js":89}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_assertionerror=require("./assertionerror.js"),_assertionerror2=(obj=_assertionerror)&&obj.__esModule?obj:{default:obj};var _ol_asserts_={assert:function(assertion,errorCode){if(!assertion)throw new _assertionerror2.default(errorCode)}};exports.default=_ol_asserts_},{"./assertionerror.js":30}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _tilerange2=_interopRequireDefault(require("./tilerange.js")),_math2=_interopRequireDefault(require("./math.js")),_tilegrid2=_interopRequireDefault(require("./tilegrid.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_Attribution_=function(options){this.html_=options.html,this.tileRanges_=options.tileRanges?options.tileRanges:null};_ol_Attribution_.prototype.getHTML=function(){return this.html_},_ol_Attribution_.prototype.intersectsAnyTileRange=function(tileRanges,tileGrid,projection){if(!this.tileRanges_)return!0;var i,ii,tileRange,zKey;for(zKey in tileRanges){var testTileRange;if(zKey in this.tileRanges_)for(tileRange=tileRanges[zKey],i=0,ii=this.tileRanges_[zKey].length;i<ii;++i){if((testTileRange=this.tileRanges_[zKey][i]).intersects(tileRange))return!0;var extentTileRange=tileGrid.getTileRangeForExtentAndZ(_tilegrid2.default.extentFromProjection(projection),parseInt(zKey,10)),width=extentTileRange.getWidth();if(tileRange.minX<extentTileRange.minX||tileRange.maxX>extentTileRange.maxX){if(testTileRange.intersects(new _tilerange2.default(_math2.default.modulo(tileRange.minX,width),_math2.default.modulo(tileRange.maxX,width),tileRange.minY,tileRange.maxY)))return!0;if(tileRange.getWidth()>width&&testTileRange.intersects(extentTileRange))return!0}}}return!1},exports.default=_ol_Attribution_},{"./math.js":123,"./tilegrid.js":238,"./tilerange.js":241}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_math=require("./math.js"),_math2=(obj=_math)&&obj.__esModule?obj:{default:obj};var _ol_CenterConstraint_={createExtent:function(extent){return function(center){return center?[_math2.default.clamp(center[0],extent[0],extent[2]),_math2.default.clamp(center[1],extent[1],extent[3])]:void 0}},none:function(center){return center}};exports.default=_ol_CenterConstraint_},{"./math.js":123}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_assertionerror2=_interopRequireDefault(require("./assertionerror.js")),_collectioneventtype2=_interopRequireDefault(require("./collectioneventtype.js")),_object2=_interopRequireDefault(require("./object.js")),_event2=_interopRequireDefault(require("./events/event.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_Collection_=function(opt_array,opt_options){_object2.default.call(this);var options=opt_options||{};if(this.unique_=!!options.unique,this.array_=opt_array||[],this.unique_)for(var i=0,ii=this.array_.length;i<ii;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()};_index2.default.inherits(_ol_Collection_,_object2.default),_ol_Collection_.prototype.clear=function(){for(;0<this.getLength();)this.pop()},_ol_Collection_.prototype.extend=function(arr){var i,ii;for(i=0,ii=arr.length;i<ii;++i)this.push(arr[i]);return this},_ol_Collection_.prototype.forEach=function(f,opt_this){for(var fn=opt_this?f.bind(opt_this):f,array=this.array_,i=0,ii=array.length;i<ii;++i)fn(array[i],i,array)},_ol_Collection_.prototype.getArray=function(){return this.array_},_ol_Collection_.prototype.item=function(index){return this.array_[index]},_ol_Collection_.prototype.getLength=function(){return this.get(_ol_Collection_.Property_.LENGTH)},_ol_Collection_.prototype.insertAt=function(index,elem){this.unique_&&this.assertUnique_(elem),this.array_.splice(index,0,elem),this.updateLength_(),this.dispatchEvent(new _ol_Collection_.Event(_collectioneventtype2.default.ADD,elem))},_ol_Collection_.prototype.pop=function(){return this.removeAt(this.getLength()-1)},_ol_Collection_.prototype.push=function(elem){this.unique_&&this.assertUnique_(elem);var n=this.getLength();return this.insertAt(n,elem),this.getLength()},_ol_Collection_.prototype.remove=function(elem){var i,ii,arr=this.array_;for(i=0,ii=arr.length;i<ii;++i)if(arr[i]===elem)return this.removeAt(i)},_ol_Collection_.prototype.removeAt=function(index){var prev=this.array_[index];return this.array_.splice(index,1),this.updateLength_(),this.dispatchEvent(new _ol_Collection_.Event(_collectioneventtype2.default.REMOVE,prev)),prev},_ol_Collection_.prototype.setAt=function(index,elem){var n=this.getLength();if(index<n){this.unique_&&this.assertUnique_(elem,index);var prev=this.array_[index];this.array_[index]=elem,this.dispatchEvent(new _ol_Collection_.Event(_collectioneventtype2.default.REMOVE,prev)),this.dispatchEvent(new _ol_Collection_.Event(_collectioneventtype2.default.ADD,elem))}else{var j;for(j=n;j<index;++j)this.insertAt(j,void 0);this.insertAt(index,elem)}},_ol_Collection_.prototype.updateLength_=function(){this.set(_ol_Collection_.Property_.LENGTH,this.array_.length)},_ol_Collection_.prototype.assertUnique_=function(elem,opt_except){for(var i=0,ii=this.array_.length;i<ii;++i)if(this.array_[i]===elem&&i!==opt_except)throw new _assertionerror2.default(58)},_ol_Collection_.Property_={LENGTH:"length"},_ol_Collection_.Event=function(type,opt_element){_event2.default.call(this,type),this.element=opt_element},_index2.default.inherits(_ol_Collection_.Event,_event2.default),exports.default=_ol_Collection_},{"./assertionerror.js":30,"./collectioneventtype.js":35,"./events/event.js":50,"./index.js":89,"./object.js":125}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={ADD:"add",REMOVE:"remove"}},{}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _asserts2=_interopRequireDefault(require("./asserts.js")),_math2=_interopRequireDefault(require("./math.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var cache,cacheSize,_ol_color_={};_ol_color_.HEX_COLOR_RE_=/^#(?:[0-9a-f]{3,4}){1,2}$/i,_ol_color_.NAMED_COLOR_RE_=/^([a-z]*)$/i,_ol_color_.asArray=function(color){return Array.isArray(color)?color:_ol_color_.fromString(color)},_ol_color_.asString=function(color){return"string"==typeof color?color:_ol_color_.toString(color)},_ol_color_.fromNamed=function(color){var el=document.createElement("div");el.style.color=color,document.body.appendChild(el);var rgb=getComputedStyle(el).color;return document.body.removeChild(el),rgb},_ol_color_.fromString=(cache={},cacheSize=0,function(s){var color;if(cache.hasOwnProperty(s))color=cache[s];else{if(1024<=cacheSize){var key,i=0;for(key in cache)0==(3&i++)&&(delete cache[key],--cacheSize)}color=_ol_color_.fromStringInternal_(s),cache[s]=color,++cacheSize}return color}),_ol_color_.fromStringInternal_=function(s){var r,g,b,a,color,parts;if(_ol_color_.NAMED_COLOR_RE_.exec(s)&&(s=_ol_color_.fromNamed(s)),_ol_color_.HEX_COLOR_RE_.exec(s)){var d,n=s.length-1;d=n<=4?1:2;var hasAlpha=4===n||8===n;r=parseInt(s.substr(1+0*d,d),16),g=parseInt(s.substr(1+1*d,d),16),b=parseInt(s.substr(1+2*d,d),16),a=hasAlpha?parseInt(s.substr(1+3*d,d),16):255,1==d&&(r=(r<<4)+r,g=(g<<4)+g,b=(b<<4)+b,hasAlpha&&(a=(a<<4)+a)),color=[r,g,b,a/255]}else 0==s.indexOf("rgba(")?(parts=s.slice(5,-1).split(",").map(Number),color=_ol_color_.normalize(parts)):0==s.indexOf("rgb(")?((parts=s.slice(4,-1).split(",").map(Number)).push(1),color=_ol_color_.normalize(parts)):_asserts2.default.assert(!1,14);return color},_ol_color_.normalize=function(color,opt_color){var result=opt_color||[];return result[0]=_math2.default.clamp(color[0]+.5|0,0,255),result[1]=_math2.default.clamp(color[1]+.5|0,0,255),result[2]=_math2.default.clamp(color[2]+.5|0,0,255),result[3]=_math2.default.clamp(color[3],0,1),result},_ol_color_.toString=function(color){var r=color[0];r!=(0|r)&&(r=r+.5|0);var g=color[1];g!=(0|g)&&(g=g+.5|0);var b=color[2];return b!=(0|b)&&(b=b+.5|0),"rgba("+r+","+g+","+b+","+(void 0===color[3]?1:color[3])+")"},exports.default=_ol_color_},{"./asserts.js":31,"./math.js":123}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_color=require("./color.js"),_color2=(obj=_color)&&obj.__esModule?obj:{default:obj};var _ol_colorlike_={asColorLike:function(color){return _ol_colorlike_.isColorLike(color)?color:_color2.default.asString(color)},isColorLike:function(color){return"string"==typeof color||color instanceof CanvasPattern||color instanceof CanvasGradient}};exports.default=_ol_colorlike_},{"./color.js":36}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _collection2=_interopRequireDefault(require("./collection.js")),_attribution2=_interopRequireDefault(require("./control/attribution.js")),_rotate2=_interopRequireDefault(require("./control/rotate.js")),_zoom2=_interopRequireDefault(require("./control/zoom.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_control_={defaults:function(opt_options){var options=opt_options||{},controls=new _collection2.default;return(void 0===options.zoom||options.zoom)&&controls.push(new _zoom2.default(options.zoomOptions)),(void 0===options.rotate||options.rotate)&&controls.push(new _rotate2.default(options.rotateOptions)),(void 0===options.attribution||options.attribution)&&controls.push(new _attribution2.default(options.attributionOptions)),controls}};exports.default=_ol_control_},{"./collection.js":34,"./control/attribution.js":39,"./control/rotate.js":41,"./control/zoom.js":42}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_array2=_interopRequireDefault(require("../array.js")),_control2=_interopRequireDefault(require("../control/control.js")),_css2=_interopRequireDefault(require("../css.js")),_dom2=_interopRequireDefault(require("../dom.js")),_events2=_interopRequireDefault(require("../events.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_layer2=_interopRequireDefault(require("../layer/layer.js")),_obj2=_interopRequireDefault(require("../obj.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_control_Attribution_=function(opt_options){var options=opt_options||{};this.ulElement_=document.createElement("UL"),this.logoLi_=document.createElement("LI"),this.ulElement_.appendChild(this.logoLi_),this.logoLi_.style.display="none",this.collapsed_=void 0===options.collapsed||options.collapsed,this.collapsible_=void 0===options.collapsible||options.collapsible,this.collapsible_||(this.collapsed_=!1);var className=void 0!==options.className?options.className:"ol-attribution",tipLabel=void 0!==options.tipLabel?options.tipLabel:"Attributions",collapseLabel=void 0!==options.collapseLabel?options.collapseLabel:"";"string"==typeof collapseLabel?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=collapseLabel):this.collapseLabel_=collapseLabel;var label=void 0!==options.label?options.label:"i";"string"==typeof label?(this.label_=document.createElement("span"),this.label_.textContent=label):this.label_=label;var activeLabel=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,button=document.createElement("button");button.setAttribute("type","button"),button.title=tipLabel,button.appendChild(activeLabel),_events2.default.listen(button,_eventtype2.default.CLICK,this.handleClick_,this);var cssClasses=className+" "+_css2.default.CLASS_UNSELECTABLE+" "+_css2.default.CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" ol-collapsed":"")+(this.collapsible_?"":" ol-uncollapsible"),element=document.createElement("div");element.className=cssClasses,element.appendChild(this.ulElement_),element.appendChild(button);var render=options.render?options.render:_ol_control_Attribution_.render;_control2.default.call(this,{element:element,render:render,target:options.target}),this.renderedAttributions_=[],this.renderedVisible_=!0,this.logoElements_={}};_index2.default.inherits(_ol_control_Attribution_,_control2.default),_ol_control_Attribution_.prototype.getSourceAttributions_=function(frameState){for(var lookup={},visibleAttributions=[],layerStatesArray=frameState.layerStatesArray,resolution=frameState.viewState.resolution,i=0,ii=layerStatesArray.length;i<ii;++i){var layerState=layerStatesArray[i];if(_layer2.default.visibleAtResolution(layerState,resolution)){var source=layerState.layer.getSource();if(source){var attributionGetter=source.getAttributions2();if(attributionGetter){var attributions=attributionGetter(frameState);if(attributions)if(Array.isArray(attributions))for(var j=0,jj=attributions.length;j<jj;++j)attributions[j]in lookup||(visibleAttributions.push(attributions[j]),lookup[attributions[j]]=!0);else attributions in lookup||(visibleAttributions.push(attributions),lookup[attributions]=!0)}}}}return visibleAttributions},_ol_control_Attribution_.render=function(mapEvent){this.updateElement_(mapEvent.frameState)},_ol_control_Attribution_.prototype.updateElement_=function(frameState){if(frameState){var attributions=this.getSourceAttributions_(frameState);if(!_array2.default.equals(attributions,this.renderedAttributions_)){for(;this.ulElement_.lastChild!==this.logoLi_;)this.ulElement_.removeChild(this.ulElement_.lastChild);for(var i=0,ii=attributions.length;i<ii;++i){var element=document.createElement("LI");element.innerHTML=attributions[i],this.ulElement_.appendChild(element)}0===attributions.length&&0<this.renderedAttributions_.length?this.element.classList.add("ol-logo-only"):0===this.renderedAttributions_.length&&0<attributions.length&&this.element.classList.remove("ol-logo-only");var visible=0<attributions.length||!_obj2.default.isEmpty(frameState.logos);this.renderedVisible_!=visible&&(this.element.style.display=visible?"":"none",this.renderedVisible_=visible),this.renderedAttributions_=attributions,this.insertLogos_(frameState)}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},_ol_control_Attribution_.prototype.insertLogos_=function(frameState){var logo,image,logoElement,logoKey,logos=frameState.logos,logoElements=this.logoElements_;for(logo in logoElements)logo in logos||(_dom2.default.removeNode(logoElements[logo]),delete logoElements[logo]);for(logoKey in logos){var logoValue=logos[logoKey];logoValue instanceof HTMLElement&&(this.logoLi_.appendChild(logoValue),logoElements[logoKey]=logoValue),logoKey in logoElements||((image=new Image).src=logoKey,""===logoValue?logoElement=image:((logoElement=document.createElement("a")).href=logoValue,logoElement.appendChild(image)),this.logoLi_.appendChild(logoElement),logoElements[logoKey]=logoElement)}this.logoLi_.style.display=_obj2.default.isEmpty(logos)?"none":""},_ol_control_Attribution_.prototype.handleClick_=function(event){event.preventDefault(),this.handleToggle_()},_ol_control_Attribution_.prototype.handleToggle_=function(){this.element.classList.toggle("ol-collapsed"),this.collapsed_?_dom2.default.replaceNode(this.collapseLabel_,this.label_):_dom2.default.replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},_ol_control_Attribution_.prototype.getCollapsible=function(){return this.collapsible_},_ol_control_Attribution_.prototype.setCollapsible=function(collapsible){this.collapsible_!==collapsible&&(this.collapsible_=collapsible,this.element.classList.toggle("ol-uncollapsible"),!collapsible&&this.collapsed_&&this.handleToggle_())},_ol_control_Attribution_.prototype.setCollapsed=function(collapsed){this.collapsible_&&this.collapsed_!==collapsed&&this.handleToggle_()},_ol_control_Attribution_.prototype.getCollapsed=function(){return this.collapsed_},exports.default=_ol_control_Attribution_},{"../array.js":29,"../control/control.js":40,"../css.js":44,"../dom.js":46,"../events.js":48,"../events/eventtype.js":52,"../index.js":89,"../layer/layer.js":108,"../obj.js":124}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_mapeventtype2=_interopRequireDefault(require("../mapeventtype.js")),_object2=_interopRequireDefault(require("../object.js")),_dom2=_interopRequireDefault(require("../dom.js")),_events2=_interopRequireDefault(require("../events.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_control_Control_=function(options){_object2.default.call(this),this.element=options.element?options.element:null,this.target_=null,this.map_=null,this.listenerKeys=[],this.render=options.render?options.render:_index2.default.nullFunction,options.target&&this.setTarget(options.target)};_index2.default.inherits(_ol_control_Control_,_object2.default),_ol_control_Control_.prototype.disposeInternal=function(){_dom2.default.removeNode(this.element),_object2.default.prototype.disposeInternal.call(this)},_ol_control_Control_.prototype.getMap=function(){return this.map_},_ol_control_Control_.prototype.setMap=function(map){this.map_&&_dom2.default.removeNode(this.element);for(var i=0,ii=this.listenerKeys.length;i<ii;++i)_events2.default.unlistenByKey(this.listenerKeys[i]);(this.listenerKeys.length=0,this.map_=map,this.map_)&&((this.target_?this.target_:map.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==_index2.default.nullFunction&&this.listenerKeys.push(_events2.default.listen(map,_mapeventtype2.default.POSTRENDER,this.render,this)),map.render())},_ol_control_Control_.prototype.setTarget=function(target){this.target_="string"==typeof target?document.getElementById(target):target},exports.default=_ol_control_Control_},{"../dom.js":46,"../events.js":48,"../index.js":89,"../mapeventtype.js":121,"../object.js":125}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _events2=_interopRequireDefault(require("../events.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_index2=_interopRequireDefault(require("../index.js")),_control2=_interopRequireDefault(require("../control/control.js")),_css2=_interopRequireDefault(require("../css.js")),_easing2=_interopRequireDefault(require("../easing.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_control_Rotate_=function(opt_options){var options=opt_options||{},className=void 0!==options.className?options.className:"ol-rotate",label=void 0!==options.label?options.label:"";this.label_=null,"string"==typeof label?(this.label_=document.createElement("span"),this.label_.className="ol-compass",this.label_.textContent=label):(this.label_=label,this.label_.classList.add("ol-compass"));var tipLabel=options.tipLabel?options.tipLabel:"Reset rotation",button=document.createElement("button");button.className=className+"-reset",button.setAttribute("type","button"),button.title=tipLabel,button.appendChild(this.label_),_events2.default.listen(button,_eventtype2.default.CLICK,_ol_control_Rotate_.prototype.handleClick_,this);var cssClasses=className+" "+_css2.default.CLASS_UNSELECTABLE+" "+_css2.default.CLASS_CONTROL,element=document.createElement("div");element.className=cssClasses,element.appendChild(button);var render=options.render?options.render:_ol_control_Rotate_.render;this.callResetNorth_=options.resetNorth?options.resetNorth:void 0,_control2.default.call(this,{element:element,render:render,target:options.target}),this.duration_=void 0!==options.duration?options.duration:250,this.autoHide_=void 0===options.autoHide||options.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(_css2.default.CLASS_HIDDEN)};_index2.default.inherits(_ol_control_Rotate_,_control2.default),_ol_control_Rotate_.prototype.handleClick_=function(event){event.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},_ol_control_Rotate_.prototype.resetNorth_=function(){var view=this.getMap().getView();view&&void 0!==view.getRotation()&&(0<this.duration_?view.animate({rotation:0,duration:this.duration_,easing:_easing2.default.easeOut}):view.setRotation(0))},_ol_control_Rotate_.render=function(mapEvent){var frameState=mapEvent.frameState;if(frameState){var rotation=frameState.viewState.rotation;if(rotation!=this.rotation_){var transform="rotate("+rotation+"rad)";if(this.autoHide_){var contains=this.element.classList.contains(_css2.default.CLASS_HIDDEN);contains||0!==rotation?contains&&0!==rotation&&this.element.classList.remove(_css2.default.CLASS_HIDDEN):this.element.classList.add(_css2.default.CLASS_HIDDEN)}this.label_.style.msTransform=transform,this.label_.style.webkitTransform=transform,this.label_.style.transform=transform}this.rotation_=rotation}},exports.default=_ol_control_Rotate_},{"../control/control.js":40,"../css.js":44,"../easing.js":47,"../events.js":48,"../events/eventtype.js":52,"../index.js":89}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_events2=_interopRequireDefault(require("../events.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_control2=_interopRequireDefault(require("../control/control.js")),_css2=_interopRequireDefault(require("../css.js")),_easing2=_interopRequireDefault(require("../easing.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_control_Zoom_=function(opt_options){var options=opt_options||{},className=void 0!==options.className?options.className:"ol-zoom",delta=void 0!==options.delta?options.delta:1,zoomInLabel=void 0!==options.zoomInLabel?options.zoomInLabel:"+",zoomOutLabel=void 0!==options.zoomOutLabel?options.zoomOutLabel:"",zoomInTipLabel=void 0!==options.zoomInTipLabel?options.zoomInTipLabel:"Zoom in",zoomOutTipLabel=void 0!==options.zoomOutTipLabel?options.zoomOutTipLabel:"Zoom out",inElement=document.createElement("button");inElement.className=className+"-in",inElement.setAttribute("type","button"),inElement.title=zoomInTipLabel,inElement.appendChild("string"==typeof zoomInLabel?document.createTextNode(zoomInLabel):zoomInLabel),_events2.default.listen(inElement,_eventtype2.default.CLICK,_ol_control_Zoom_.prototype.handleClick_.bind(this,delta));var outElement=document.createElement("button");outElement.className=className+"-out",outElement.setAttribute("type","button"),outElement.title=zoomOutTipLabel,outElement.appendChild("string"==typeof zoomOutLabel?document.createTextNode(zoomOutLabel):zoomOutLabel),_events2.default.listen(outElement,_eventtype2.default.CLICK,_ol_control_Zoom_.prototype.handleClick_.bind(this,-delta));var cssClasses=className+" "+_css2.default.CLASS_UNSELECTABLE+" "+_css2.default.CLASS_CONTROL,element=document.createElement("div");element.className=cssClasses,element.appendChild(inElement),element.appendChild(outElement),_control2.default.call(this,{element:element,target:options.target}),this.duration_=void 0!==options.duration?options.duration:250};_index2.default.inherits(_ol_control_Zoom_,_control2.default),_ol_control_Zoom_.prototype.handleClick_=function(delta,event){event.preventDefault(),this.zoomByDelta_(delta)},_ol_control_Zoom_.prototype.zoomByDelta_=function(delta){var view=this.getMap().getView();if(view){var currentResolution=view.getResolution();if(currentResolution){var newResolution=view.constrainResolution(currentResolution,delta);0<this.duration_?(view.getAnimating()&&view.cancelAnimations(),view.animate({resolution:newResolution,duration:this.duration_,easing:_easing2.default.easeOut})):view.setResolution(newResolution)}}},exports.default=_ol_control_Zoom_},{"../control/control.js":40,"../css.js":44,"../easing.js":47,"../events.js":48,"../events/eventtype.js":52,"../index.js":89}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _math2=_interopRequireDefault(require("./math.js")),_string2=_interopRequireDefault(require("./string.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_coordinate_={add:function(coordinate,delta){return coordinate[0]+=delta[0],coordinate[1]+=delta[1],coordinate},closestOnCircle:function(coordinate,circle){var r=circle.getRadius(),center=circle.getCenter(),x0=center[0],y0=center[1],dx=coordinate[0]-x0,dy=coordinate[1]-y0;0===dx&&0===dy&&(dx=1);var d=Math.sqrt(dx*dx+dy*dy);return[x0+r*dx/d,y0+r*dy/d]},closestOnSegment:function(coordinate,segment){var x,y,x0=coordinate[0],y0=coordinate[1],start=segment[0],end=segment[1],x1=start[0],y1=start[1],x2=end[0],y2=end[1],dx=x2-x1,dy=y2-y1,along=0===dx&&0===dy?0:(dx*(x0-x1)+dy*(y0-y1))/(dx*dx+dy*dy||0);return y=along<=0?(x=x1,y1):1<=along?(x=x2,y2):(x=x1+along*dx,y1+along*dy),[x,y]},createStringXY:function(opt_fractionDigits){return function(coordinate){return _ol_coordinate_.toStringXY(coordinate,opt_fractionDigits)}},degreesToStringHDMS:function(hemispheres,degrees,opt_fractionDigits){var normalizedDegrees=_math2.default.modulo(degrees+180,360)-180,x=Math.abs(3600*normalizedDegrees),dflPrecision=opt_fractionDigits||0,precision=Math.pow(10,dflPrecision),deg=Math.floor(x/3600),min=Math.floor((x-3600*deg)/60),sec=x-3600*deg-60*min;return 60<=(sec=Math.ceil(sec*precision)/precision)&&(sec=0,min+=1),60<=min&&(min=0,deg+=1),deg+" "+_string2.default.padNumber(min,2)+" "+_string2.default.padNumber(sec,2,dflPrecision)+""+(0==normalizedDegrees?"":" "+hemispheres.charAt(normalizedDegrees<0?1:0))},format:function(coordinate,template,opt_fractionDigits){return coordinate?template.replace("{x}",coordinate[0].toFixed(opt_fractionDigits)).replace("{y}",coordinate[1].toFixed(opt_fractionDigits)):""},equals:function(coordinate1,coordinate2){for(var equals=!0,i=coordinate1.length-1;0<=i;--i)if(coordinate1[i]!=coordinate2[i]){equals=!1;break}return equals},rotate:function(coordinate,angle){var cosAngle=Math.cos(angle),sinAngle=Math.sin(angle),x=coordinate[0]*cosAngle-coordinate[1]*sinAngle,y=coordinate[1]*cosAngle+coordinate[0]*sinAngle;return coordinate[0]=x,coordinate[1]=y,coordinate},scale:function(coordinate,scale){return coordinate[0]*=scale,coordinate[1]*=scale,coordinate},sub:function(coordinate,delta){return coordinate[0]-=delta[0],coordinate[1]-=delta[1],coordinate},squaredDistance:function(coord1,coord2){var dx=coord1[0]-coord2[0],dy=coord1[1]-coord2[1];return dx*dx+dy*dy},distance:function(coord1,coord2){return Math.sqrt(_ol_coordinate_.squaredDistance(coord1,coord2))},squaredDistanceToSegment:function(coordinate,segment){return _ol_coordinate_.squaredDistance(coordinate,_ol_coordinate_.closestOnSegment(coordinate,segment))},toStringHDMS:function(coordinate,opt_fractionDigits){return coordinate?_ol_coordinate_.degreesToStringHDMS("NS",coordinate[1],opt_fractionDigits)+" "+_ol_coordinate_.degreesToStringHDMS("EW",coordinate[0],opt_fractionDigits):""},toStringXY:function(coordinate,opt_fractionDigits){return _ol_coordinate_.format(coordinate,"{x}, {y}",opt_fractionDigits)}};exports.default=_ol_coordinate_},{"./math.js":123,"./string.js":216}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var style,cache,_ol_css_={};_ol_css_.CLASS_HIDDEN="ol-hidden",_ol_css_.CLASS_SELECTABLE="ol-selectable",_ol_css_.CLASS_UNSELECTABLE="ol-unselectable",_ol_css_.CLASS_UNSUPPORTED="ol-unsupported",_ol_css_.CLASS_CONTROL="ol-control",_ol_css_.getFontFamilies=(cache={},function(font){if(style||(style=document.createElement("div").style),!(font in cache)){style.font=font;var family=style.fontFamily;if(style.font="",!family)return null;cache[font]=family.split(/,\s?/)}return cache[font]}),exports.default=_ol_css_},{}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_index=require("./index.js"),_index2=(obj=_index)&&obj.__esModule?obj:{default:obj};var _ol_Disposable_=function(){};_ol_Disposable_.prototype.disposed_=!1,_ol_Disposable_.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},_ol_Disposable_.prototype.disposeInternal=_index2.default.nullFunction,exports.default=_ol_Disposable_},{"./index.js":89}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_dom_={createCanvasContext2D:function(opt_width,opt_height){var canvas=document.createElement("CANVAS");return opt_width&&(canvas.width=opt_width),opt_height&&(canvas.height=opt_height),canvas.getContext("2d")},outerWidth:function(element){var width=element.offsetWidth,style=getComputedStyle(element);return width+=parseInt(style.marginLeft,10)+parseInt(style.marginRight,10)},outerHeight:function(element){var height=element.offsetHeight,style=getComputedStyle(element);return height+=parseInt(style.marginTop,10)+parseInt(style.marginBottom,10)},replaceNode:function(newNode,oldNode){var parent=oldNode.parentNode;parent&&parent.replaceChild(newNode,oldNode)},removeNode:function(node){return node&&node.parentNode?node.parentNode.removeChild(node):null},removeChildren:function(node){for(;node.lastChild;)node.removeChild(node.lastChild)}};exports.default=_ol_dom_},{}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_easing_={easeIn:function(t){return Math.pow(t,3)},easeOut:function(t){return 1-_ol_easing_.easeIn(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?_ol_easing_.inAndOut(2*t):1-_ol_easing_.inAndOut(2*(t-.5))}};exports.default=_ol_easing_},{}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_obj=require("./obj.js"),_obj2=(obj=_obj)&&obj.__esModule?obj:{default:obj};var _ol_events_={bindListener_:function(listenerObj){var boundListener=function(evt){var listener=listenerObj.listener,bindTo=listenerObj.bindTo||listenerObj.target;return listenerObj.callOnce&&_ol_events_.unlistenByKey(listenerObj),listener.call(bindTo,evt)};return listenerObj.boundListener=boundListener},findListener_:function(listeners,listener,opt_this,opt_setDeleteIndex){for(var listenerObj,i=0,ii=listeners.length;i<ii;++i)if((listenerObj=listeners[i]).listener===listener&&listenerObj.bindTo===opt_this)return opt_setDeleteIndex&&(listenerObj.deleteIndex=i),listenerObj},getListeners:function(target,type){var listenerMap=target.ol_lm;return listenerMap?listenerMap[type]:void 0},getListenerMap_:function(target){var listenerMap=target.ol_lm;return listenerMap||(listenerMap=target.ol_lm={}),listenerMap},removeListeners_:function(target,type){var listeners=_ol_events_.getListeners(target,type);if(listeners){for(var i=0,ii=listeners.length;i<ii;++i)target.removeEventListener(type,listeners[i].boundListener),_obj2.default.clear(listeners[i]);listeners.length=0;var listenerMap=target.ol_lm;listenerMap&&(delete listenerMap[type],0===Object.keys(listenerMap).length&&delete target.ol_lm)}},listen:function(target,type,listener,opt_this,opt_once){var listenerMap=_ol_events_.getListenerMap_(target),listeners=listenerMap[type];listeners||(listeners=listenerMap[type]=[]);var listenerObj=_ol_events_.findListener_(listeners,listener,opt_this,!1);return listenerObj?opt_once||(listenerObj.callOnce=!1):(listenerObj={bindTo:opt_this,callOnce:!!opt_once,listener:listener,target:target,type:type},target.addEventListener(type,_ol_events_.bindListener_(listenerObj)),listeners.push(listenerObj)),listenerObj},listenOnce:function(target,type,listener,opt_this){return _ol_events_.listen(target,type,listener,opt_this,!0)},unlisten:function(target,type,listener,opt_this){var listeners=_ol_events_.getListeners(target,type);if(listeners){var listenerObj=_ol_events_.findListener_(listeners,listener,opt_this,!0);listenerObj&&_ol_events_.unlistenByKey(listenerObj)}},unlistenByKey:function(key){if(key&&key.target){key.target.removeEventListener(key.type,key.boundListener);var listeners=_ol_events_.getListeners(key.target,key.type);if(listeners){var i="deleteIndex"in key?key.deleteIndex:listeners.indexOf(key);-1!==i&&listeners.splice(i,1),0===listeners.length&&_ol_events_.removeListeners_(key.target,key.type)}_obj2.default.clear(key)}},unlistenAll:function(target){var listenerMap=_ol_events_.getListenerMap_(target);for(var type in listenerMap)_ol_events_.removeListeners_(target,type)}};exports.default=_ol_events_},{"./obj.js":124}],49:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _mapbrowsereventtype2=_interopRequireDefault(require("../mapbrowsereventtype.js")),_asserts2=_interopRequireDefault(require("../asserts.js")),_functions2=_interopRequireDefault(require("../functions.js")),_has2=_interopRequireDefault(require("../has.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_events_condition_={altKeyOnly:function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&!originalEvent.shiftKey},altShiftKeysOnly:function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&originalEvent.shiftKey}};_ol_events_condition_.always=_functions2.default.TRUE,_ol_events_condition_.click=function(mapBrowserEvent){return mapBrowserEvent.type==_mapbrowsereventtype2.default.CLICK},_ol_events_condition_.mouseActionButton=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return 0==originalEvent.button&&!(_has2.default.WEBKIT&&_has2.default.MAC&&originalEvent.ctrlKey)},_ol_events_condition_.never=_functions2.default.FALSE,_ol_events_condition_.pointerMove=function(mapBrowserEvent){return"pointermove"==mapBrowserEvent.type},_ol_events_condition_.singleClick=function(mapBrowserEvent){return mapBrowserEvent.type==_mapbrowsereventtype2.default.SINGLECLICK},_ol_events_condition_.doubleClick=function(mapBrowserEvent){return mapBrowserEvent.type==_mapbrowsereventtype2.default.DBLCLICK},_ol_events_condition_.noModifierKeys=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&!originalEvent.shiftKey},_ol_events_condition_.platformModifierKeyOnly=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&(_has2.default.MAC?originalEvent.metaKey:originalEvent.ctrlKey)&&!originalEvent.shiftKey},_ol_events_condition_.shiftKeyOnly=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&originalEvent.shiftKey},_ol_events_condition_.targetNotEditable=function(mapBrowserEvent){var tagName=mapBrowserEvent.originalEvent.target.tagName;return"INPUT"!==tagName&&"SELECT"!==tagName&&"TEXTAREA"!==tagName},_ol_events_condition_.mouseOnly=function(mapBrowserEvent){return _asserts2.default.assert(mapBrowserEvent.pointerEvent,56),"mouse"==mapBrowserEvent.pointerEvent.pointerType},_ol_events_condition_.primaryAction=function(mapBrowserEvent){var pointerEvent=mapBrowserEvent.pointerEvent;return pointerEvent.isPrimary&&0===pointerEvent.button},exports.default=_ol_events_condition_},{"../asserts.js":31,"../functions.js":60,"../has.js":84,"../mapbrowsereventtype.js":118}],50:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_events_Event_=function(type){this.propagationStopped,this.type=type,this.target=null};_ol_events_Event_.prototype.preventDefault=_ol_events_Event_.prototype.stopPropagation=function(){this.propagationStopped=!0},_ol_events_Event_.stopPropagation=function(evt){evt.stopPropagation()},_ol_events_Event_.preventDefault=function(evt){evt.preventDefault()},exports.default=_ol_events_Event_},{}],51:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_disposable2=_interopRequireDefault(require("../disposable.js")),_events2=_interopRequireDefault(require("../events.js")),_event2=_interopRequireDefault(require("../events/event.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_events_EventTarget_=function(){_disposable2.default.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}};_index2.default.inherits(_ol_events_EventTarget_,_disposable2.default),_ol_events_EventTarget_.prototype.addEventListener=function(type,listener){var listeners=this.listeners_[type];listeners||(listeners=this.listeners_[type]=[]),-1===listeners.indexOf(listener)&&listeners.push(listener)},_ol_events_EventTarget_.prototype.dispatchEvent=function(event){var propagate,evt="string"==typeof event?new _event2.default(event):event,type=evt.type,listeners=(evt.target=this).listeners_[type];if(listeners){type in this.dispatching_||(this.dispatching_[type]=0,this.pendingRemovals_[type]=0),++this.dispatching_[type];for(var i=0,ii=listeners.length;i<ii;++i)if(!1===listeners[i].call(this,evt)||evt.propagationStopped){propagate=!1;break}if(--this.dispatching_[type],0===this.dispatching_[type]){var pendingRemovals=this.pendingRemovals_[type];for(delete this.pendingRemovals_[type];pendingRemovals--;)this.removeEventListener(type,_index2.default.nullFunction);delete this.dispatching_[type]}return propagate}},_ol_events_EventTarget_.prototype.disposeInternal=function(){_events2.default.unlistenAll(this)},_ol_events_EventTarget_.prototype.getListeners=function(type){return this.listeners_[type]},_ol_events_EventTarget_.prototype.hasListener=function(opt_type){return opt_type?opt_type in this.listeners_:0<Object.keys(this.listeners_).length},_ol_events_EventTarget_.prototype.removeEventListener=function(type,listener){var listeners=this.listeners_[type];if(listeners){var index=listeners.indexOf(listener);type in this.pendingRemovals_?(listeners[index]=_index2.default.nullFunction,++this.pendingRemovals_[type]):(listeners.splice(index,1),0===listeners.length&&delete this.listeners_[type])}},exports.default=_ol_events_EventTarget_},{"../disposable.js":45,"../events.js":48,"../events/event.js":50,"../index.js":89}],52:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={CHANGE:"change",CLEAR:"clear",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"}},{}],53:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={LEFT:37,UP:38,RIGHT:39,DOWN:40}},{}],54:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _asserts2=_interopRequireDefault(require("./asserts.js")),_corner2=_interopRequireDefault(require("./extent/corner.js")),_relationship2=_interopRequireDefault(require("./extent/relationship.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_extent_={boundingExtent:function(coordinates){for(var extent=_ol_extent_.createEmpty(),i=0,ii=coordinates.length;i<ii;++i)_ol_extent_.extendCoordinate(extent,coordinates[i]);return extent},boundingExtentXYs_:function(xs,ys,opt_extent){var minX=Math.min.apply(null,xs),minY=Math.min.apply(null,ys),maxX=Math.max.apply(null,xs),maxY=Math.max.apply(null,ys);return _ol_extent_.createOrUpdate(minX,minY,maxX,maxY,opt_extent)},buffer:function(extent,value,opt_extent){return opt_extent?(opt_extent[0]=extent[0]-value,opt_extent[1]=extent[1]-value,opt_extent[2]=extent[2]+value,opt_extent[3]=extent[3]+value,opt_extent):[extent[0]-value,extent[1]-value,extent[2]+value,extent[3]+value]},clone:function(extent,opt_extent){return opt_extent?(opt_extent[0]=extent[0],opt_extent[1]=extent[1],opt_extent[2]=extent[2],opt_extent[3]=extent[3],opt_extent):extent.slice()},closestSquaredDistanceXY:function(extent,x,y){var dx,dy;return(dx=x<extent[0]?extent[0]-x:extent[2]<x?x-extent[2]:0)*dx+(dy=y<extent[1]?extent[1]-y:extent[3]<y?y-extent[3]:0)*dy},containsCoordinate:function(extent,coordinate){return _ol_extent_.containsXY(extent,coordinate[0],coordinate[1])},containsExtent:function(extent1,extent2){return extent1[0]<=extent2[0]&&extent2[2]<=extent1[2]&&extent1[1]<=extent2[1]&&extent2[3]<=extent1[3]},containsXY:function(extent,x,y){return extent[0]<=x&&x<=extent[2]&&extent[1]<=y&&y<=extent[3]},coordinateRelationship:function(extent,coordinate){var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],x=coordinate[0],y=coordinate[1],relationship=_relationship2.default.UNKNOWN;return x<minX?relationship|=_relationship2.default.LEFT:maxX<x&&(relationship|=_relationship2.default.RIGHT),y<minY?relationship|=_relationship2.default.BELOW:maxY<y&&(relationship|=_relationship2.default.ABOVE),relationship===_relationship2.default.UNKNOWN&&(relationship=_relationship2.default.INTERSECTING),relationship},createEmpty:function(){return[1/0,1/0,-1/0,-1/0]},createOrUpdate:function(minX,minY,maxX,maxY,opt_extent){return opt_extent?(opt_extent[0]=minX,opt_extent[1]=minY,opt_extent[2]=maxX,opt_extent[3]=maxY,opt_extent):[minX,minY,maxX,maxY]},createOrUpdateEmpty:function(opt_extent){return _ol_extent_.createOrUpdate(1/0,1/0,-1/0,-1/0,opt_extent)},createOrUpdateFromCoordinate:function(coordinate,opt_extent){var x=coordinate[0],y=coordinate[1];return _ol_extent_.createOrUpdate(x,y,x,y,opt_extent)},createOrUpdateFromCoordinates:function(coordinates,opt_extent){var extent=_ol_extent_.createOrUpdateEmpty(opt_extent);return _ol_extent_.extendCoordinates(extent,coordinates)},createOrUpdateFromFlatCoordinates:function(flatCoordinates,offset,end,stride,opt_extent){var extent=_ol_extent_.createOrUpdateEmpty(opt_extent);return _ol_extent_.extendFlatCoordinates(extent,flatCoordinates,offset,end,stride)},createOrUpdateFromRings:function(rings,opt_extent){var extent=_ol_extent_.createOrUpdateEmpty(opt_extent);return _ol_extent_.extendRings(extent,rings)},equals:function(extent1,extent2){return extent1[0]==extent2[0]&&extent1[2]==extent2[2]&&extent1[1]==extent2[1]&&extent1[3]==extent2[3]},extend:function(extent1,extent2){return extent2[0]<extent1[0]&&(extent1[0]=extent2[0]),extent2[2]>extent1[2]&&(extent1[2]=extent2[2]),extent2[1]<extent1[1]&&(extent1[1]=extent2[1]),extent2[3]>extent1[3]&&(extent1[3]=extent2[3]),extent1},extendCoordinate:function(extent,coordinate){coordinate[0]<extent[0]&&(extent[0]=coordinate[0]),coordinate[0]>extent[2]&&(extent[2]=coordinate[0]),coordinate[1]<extent[1]&&(extent[1]=coordinate[1]),coordinate[1]>extent[3]&&(extent[3]=coordinate[1])},extendCoordinates:function(extent,coordinates){var i,ii;for(i=0,ii=coordinates.length;i<ii;++i)_ol_extent_.extendCoordinate(extent,coordinates[i]);return extent},extendFlatCoordinates:function(extent,flatCoordinates,offset,end,stride){for(;offset<end;offset+=stride)_ol_extent_.extendXY(extent,flatCoordinates[offset],flatCoordinates[offset+1]);return extent},extendRings:function(extent,rings){var i,ii;for(i=0,ii=rings.length;i<ii;++i)_ol_extent_.extendCoordinates(extent,rings[i]);return extent},extendXY:function(extent,x,y){extent[0]=Math.min(extent[0],x),extent[1]=Math.min(extent[1],y),extent[2]=Math.max(extent[2],x),extent[3]=Math.max(extent[3],y)},forEachCorner:function(extent,callback,opt_this){var val;return(val=callback.call(opt_this,_ol_extent_.getBottomLeft(extent)))?val:(val=callback.call(opt_this,_ol_extent_.getBottomRight(extent)))?val:(val=callback.call(opt_this,_ol_extent_.getTopRight(extent)))?val:(val=callback.call(opt_this,_ol_extent_.getTopLeft(extent)))||!1},getArea:function(extent){var area=0;return _ol_extent_.isEmpty(extent)||(area=_ol_extent_.getWidth(extent)*_ol_extent_.getHeight(extent)),area},getBottomLeft:function(extent){return[extent[0],extent[1]]},getBottomRight:function(extent){return[extent[2],extent[1]]},getCenter:function(extent){return[(extent[0]+extent[2])/2,(extent[1]+extent[3])/2]},getCorner:function(extent,corner){var coordinate;return corner===_corner2.default.BOTTOM_LEFT?coordinate=_ol_extent_.getBottomLeft(extent):corner===_corner2.default.BOTTOM_RIGHT?coordinate=_ol_extent_.getBottomRight(extent):corner===_corner2.default.TOP_LEFT?coordinate=_ol_extent_.getTopLeft(extent):corner===_corner2.default.TOP_RIGHT?coordinate=_ol_extent_.getTopRight(extent):_asserts2.default.assert(!1,13),coordinate},getEnlargedArea:function(extent1,extent2){var minX=Math.min(extent1[0],extent2[0]),minY=Math.min(extent1[1],extent2[1]);return(Math.max(extent1[2],extent2[2])-minX)*(Math.max(extent1[3],extent2[3])-minY)},getForViewAndSize:function(center,resolution,rotation,size,opt_extent){var dx=resolution*size[0]/2,dy=resolution*size[1]/2,cosRotation=Math.cos(rotation),sinRotation=Math.sin(rotation),xCos=dx*cosRotation,xSin=dx*sinRotation,yCos=dy*cosRotation,ySin=dy*sinRotation,x=center[0],y=center[1],x0=x-xCos+ySin,x1=x-xCos-ySin,x2=x+xCos-ySin,x3=x+xCos+ySin,y0=y-xSin-yCos,y1=y-xSin+yCos,y2=y+xSin+yCos,y3=y+xSin-yCos;return _ol_extent_.createOrUpdate(Math.min(x0,x1,x2,x3),Math.min(y0,y1,y2,y3),Math.max(x0,x1,x2,x3),Math.max(y0,y1,y2,y3),opt_extent)},getHeight:function(extent){return extent[3]-extent[1]},getIntersectionArea:function(extent1,extent2){var intersection=_ol_extent_.getIntersection(extent1,extent2);return _ol_extent_.getArea(intersection)},getIntersection:function(extent1,extent2,opt_extent){var intersection=opt_extent||_ol_extent_.createEmpty();return _ol_extent_.intersects(extent1,extent2)&&(extent1[0]>extent2[0]?intersection[0]=extent1[0]:intersection[0]=extent2[0],extent1[1]>extent2[1]?intersection[1]=extent1[1]:intersection[1]=extent2[1],extent1[2]<extent2[2]?intersection[2]=extent1[2]:intersection[2]=extent2[2],extent1[3]<extent2[3]?intersection[3]=extent1[3]:intersection[3]=extent2[3]),intersection},getMargin:function(extent){return _ol_extent_.getWidth(extent)+_ol_extent_.getHeight(extent)},getSize:function(extent){return[extent[2]-extent[0],extent[3]-extent[1]]},getTopLeft:function(extent){return[extent[0],extent[3]]},getTopRight:function(extent){return[extent[2],extent[3]]},getWidth:function(extent){return extent[2]-extent[0]},intersects:function(extent1,extent2){return extent1[0]<=extent2[2]&&extent1[2]>=extent2[0]&&extent1[1]<=extent2[3]&&extent1[3]>=extent2[1]},isEmpty:function(extent){return extent[2]<extent[0]||extent[3]<extent[1]},returnOrUpdate:function(extent,opt_extent){return opt_extent?(opt_extent[0]=extent[0],opt_extent[1]=extent[1],opt_extent[2]=extent[2],opt_extent[3]=extent[3],opt_extent):extent},scaleFromCenter:function(extent,value){var deltaX=(extent[2]-extent[0])/2*(value-1),deltaY=(extent[3]-extent[1])/2*(value-1);extent[0]-=deltaX,extent[2]+=deltaX,extent[1]-=deltaY,extent[3]+=deltaY},intersectsSegment:function(extent,start,end){var intersects=!1,startRel=_ol_extent_.coordinateRelationship(extent,start),endRel=_ol_extent_.coordinateRelationship(extent,end);if(startRel===_relationship2.default.INTERSECTING||endRel===_relationship2.default.INTERSECTING)intersects=!0;else{var x,y,minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],startX=start[0],startY=start[1],endX=end[0],endY=end[1],slope=(endY-startY)/(endX-startX);endRel&_relationship2.default.ABOVE&&!(startRel&_relationship2.default.ABOVE)&&(intersects=minX<=(x=endX-(endY-maxY)/slope)&&x<=maxX),intersects||!(endRel&_relationship2.default.RIGHT)||startRel&_relationship2.default.RIGHT||(intersects=minY<=(y=endY-(endX-maxX)*slope)&&y<=maxY),intersects||!(endRel&_relationship2.default.BELOW)||startRel&_relationship2.default.BELOW||(intersects=minX<=(x=endX-(endY-minY)/slope)&&x<=maxX),intersects||!(endRel&_relationship2.default.LEFT)||startRel&_relationship2.default.LEFT||(intersects=minY<=(y=endY-(endX-minX)*slope)&&y<=maxY)}return intersects},applyTransform:function(extent,transformFn,opt_extent){var coordinates=[extent[0],extent[1],extent[0],extent[3],extent[2],extent[1],extent[2],extent[3]];transformFn(coordinates,coordinates,2);var xs=[coordinates[0],coordinates[2],coordinates[4],coordinates[6]],ys=[coordinates[1],coordinates[3],coordinates[5],coordinates[7]];return _ol_extent_.boundingExtentXYs_(xs,ys,opt_extent)}};exports.default=_ol_extent_},{"./asserts.js":31,"./extent/corner.js":55,"./extent/relationship.js":56}],55:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"}},{}],56:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16}},{}],57:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _asserts2=_interopRequireDefault(require("./asserts.js")),_events2=_interopRequireDefault(require("./events.js")),_eventtype2=_interopRequireDefault(require("./events/eventtype.js")),_index2=_interopRequireDefault(require("./index.js")),_object2=_interopRequireDefault(require("./object.js")),_geometry2=_interopRequireDefault(require("./geom/geometry.js")),_style2=_interopRequireDefault(require("./style/style.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_Feature_=function(opt_geometryOrProperties){if(_object2.default.call(this),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,_events2.default.listen(this,_object2.default.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),void 0!==opt_geometryOrProperties)if(opt_geometryOrProperties instanceof _geometry2.default||!opt_geometryOrProperties){var geometry=opt_geometryOrProperties;this.setGeometry(geometry)}else{var properties=opt_geometryOrProperties;this.setProperties(properties)}};_index2.default.inherits(_ol_Feature_,_object2.default),_ol_Feature_.prototype.clone=function(){var clone=new _ol_Feature_(this.getProperties());clone.setGeometryName(this.getGeometryName());var geometry=this.getGeometry();geometry&&clone.setGeometry(geometry.clone());var style=this.getStyle();return style&&clone.setStyle(style),clone},_ol_Feature_.prototype.getGeometry=function(){return this.get(this.geometryName_)},_ol_Feature_.prototype.getId=function(){return this.id_},_ol_Feature_.prototype.getGeometryName=function(){return this.geometryName_},_ol_Feature_.prototype.getStyle=function(){return this.style_},_ol_Feature_.prototype.getStyleFunction=function(){return this.styleFunction_},_ol_Feature_.prototype.handleGeometryChange_=function(){this.changed()},_ol_Feature_.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(_events2.default.unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);var geometry=this.getGeometry();geometry&&(this.geometryChangeKey_=_events2.default.listen(geometry,_eventtype2.default.CHANGE,this.handleGeometryChange_,this)),this.changed()},_ol_Feature_.prototype.setGeometry=function(geometry){this.set(this.geometryName_,geometry)},_ol_Feature_.prototype.setStyle=function(style){this.style_=style,this.styleFunction_=style?_ol_Feature_.createStyleFunction(style):void 0,this.changed()},_ol_Feature_.prototype.setId=function(id){this.id_=id,this.changed()},_ol_Feature_.prototype.setGeometryName=function(name){_events2.default.unlisten(this,_object2.default.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),this.geometryName_=name,_events2.default.listen(this,_object2.default.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),this.handleGeometryChanged_()},_ol_Feature_.createStyleFunction=function(obj){var styleFunction,styles;"function"==typeof obj?styleFunction=2==obj.length?function(resolution){return obj(this,resolution)}:obj:(styles=Array.isArray(obj)?obj:(_asserts2.default.assert(obj instanceof _style2.default,41),[obj]),styleFunction=function(){return styles});return styleFunction},exports.default=_ol_Feature_},{"./asserts.js":31,"./events.js":48,"./events/eventtype.js":52,"./geom/geometry.js":77,"./index.js":89,"./object.js":125,"./style/style.js":234}],58:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_formattype2=_interopRequireDefault(require("./format/formattype.js")),_xml2=_interopRequireDefault(require("./xml.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_featureloader_={loadFeaturesXhr:function(url,format,success,failure){return function(extent,resolution,projection){var xhr=new XMLHttpRequest;xhr.open("GET","function"==typeof url?url(extent,resolution,projection):url,!0),format.getType()==_formattype2.default.ARRAY_BUFFER&&(xhr.responseType="arraybuffer"),xhr.onload=function(event){if(!xhr.status||200<=xhr.status&&xhr.status<300){var source,type=format.getType();type==_formattype2.default.JSON||type==_formattype2.default.TEXT?source=xhr.responseText:type==_formattype2.default.XML?(source=xhr.responseXML)||(source=_xml2.default.parse(xhr.responseText)):type==_formattype2.default.ARRAY_BUFFER&&(source=xhr.response),source?success.call(this,format.readFeatures(source,{featureProjection:projection}),format.readProjection(source),format.getLastExtent()):failure.call(this)}else failure.call(this)}.bind(this),xhr.onerror=function(){failure.call(this)}.bind(this),xhr.send()}},xhr:function(url,format){return _ol_featureloader_.loadFeaturesXhr(url,format,function(features,dataProjection){this.addFeatures(features)},_index2.default.nullFunction)}};exports.default=_ol_featureloader_},{"./format/formattype.js":59,"./index.js":89,"./xml.js":255}],59:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"}},{}],60:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_functions_={TRUE:function(){return!0},FALSE:function(){return!1}};exports.default=_ol_functions_},{}],61:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_geom_flat_area_={linearRing:function(flatCoordinates,offset,end,stride){for(var twiceArea=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];twiceArea+=y1*x2-x1*y2,x1=x2,y1=y2}return twiceArea/2},linearRings:function(flatCoordinates,offset,ends,stride){var i,ii,area=0;for(i=0,ii=ends.length;i<ii;++i){var end=ends[i];area+=_ol_geom_flat_area_.linearRing(flatCoordinates,offset,end,stride),offset=end}return area},linearRingss:function(flatCoordinates,offset,endss,stride){var i,ii,area=0;for(i=0,ii=endss.length;i<ii;++i){var ends=endss[i];area+=_ol_geom_flat_area_.linearRings(flatCoordinates,offset,ends,stride),offset=ends[ends.length-1]}return area}};exports.default=_ol_geom_flat_area_},{}],62:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_math=require("../../math.js"),_math2=(obj=_math)&&obj.__esModule?obj:{default:obj};var _ol_geom_flat_closest_={point:function(flatCoordinates,offset1,offset2,stride,x,y,closestPoint){var i,offset,x1=flatCoordinates[offset1],y1=flatCoordinates[offset1+1],dx=flatCoordinates[offset2]-x1,dy=flatCoordinates[offset2+1]-y1;if(0===dx&&0===dy)offset=offset1;else{var t=((x-x1)*dx+(y-y1)*dy)/(dx*dx+dy*dy);if(1<t)offset=offset2;else{if(0<t){for(i=0;i<stride;++i)closestPoint[i]=_math2.default.lerp(flatCoordinates[offset1+i],flatCoordinates[offset2+i],t);return void(closestPoint.length=stride)}offset=offset1}}for(i=0;i<stride;++i)closestPoint[i]=flatCoordinates[offset+i];closestPoint.length=stride},getMaxSquaredDelta:function(flatCoordinates,offset,end,stride,maxSquaredDelta){var x1=flatCoordinates[offset],y1=flatCoordinates[offset+1];for(offset+=stride;offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1],squaredDelta=_math2.default.squaredDistance(x1,y1,x2,y2);maxSquaredDelta<squaredDelta&&(maxSquaredDelta=squaredDelta),x1=x2,y1=y2}return maxSquaredDelta},getsMaxSquaredDelta:function(flatCoordinates,offset,ends,stride,maxSquaredDelta){var i,ii;for(i=0,ii=ends.length;i<ii;++i){var end=ends[i];maxSquaredDelta=_ol_geom_flat_closest_.getMaxSquaredDelta(flatCoordinates,offset,end,stride,maxSquaredDelta),offset=end}return maxSquaredDelta},getssMaxSquaredDelta:function(flatCoordinates,offset,endss,stride,maxSquaredDelta){var i,ii;for(i=0,ii=endss.length;i<ii;++i){var ends=endss[i];maxSquaredDelta=_ol_geom_flat_closest_.getsMaxSquaredDelta(flatCoordinates,offset,ends,stride,maxSquaredDelta),offset=ends[ends.length-1]}return maxSquaredDelta},getClosestPoint:function(flatCoordinates,offset,end,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){if(offset==end)return minSquaredDistance;var i,squaredDistance;if(0===maxDelta){if((squaredDistance=_math2.default.squaredDistance(x,y,flatCoordinates[offset],flatCoordinates[offset+1]))<minSquaredDistance){for(i=0;i<stride;++i)closestPoint[i]=flatCoordinates[offset+i];return closestPoint.length=stride,squaredDistance}return minSquaredDistance}for(var tmpPoint=opt_tmpPoint||[NaN,NaN],index=offset+stride;index<end;)if(_ol_geom_flat_closest_.point(flatCoordinates,index-stride,index,stride,x,y,tmpPoint),(squaredDistance=_math2.default.squaredDistance(x,y,tmpPoint[0],tmpPoint[1]))<minSquaredDistance){for(minSquaredDistance=squaredDistance,i=0;i<stride;++i)closestPoint[i]=tmpPoint[i];index+=closestPoint.length=stride}else index+=stride*Math.max((Math.sqrt(squaredDistance)-Math.sqrt(minSquaredDistance))/maxDelta|0,1);if(isRing&&(_ol_geom_flat_closest_.point(flatCoordinates,end-stride,offset,stride,x,y,tmpPoint),(squaredDistance=_math2.default.squaredDistance(x,y,tmpPoint[0],tmpPoint[1]))<minSquaredDistance)){for(minSquaredDistance=squaredDistance,i=0;i<stride;++i)closestPoint[i]=tmpPoint[i];closestPoint.length=stride}return minSquaredDistance},getsClosestPoint:function(flatCoordinates,offset,ends,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){var i,ii,tmpPoint=opt_tmpPoint||[NaN,NaN];for(i=0,ii=ends.length;i<ii;++i){var end=ends[i];minSquaredDistance=_ol_geom_flat_closest_.getClosestPoint(flatCoordinates,offset,end,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,tmpPoint),offset=end}return minSquaredDistance},getssClosestPoint:function(flatCoordinates,offset,endss,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){var i,ii,tmpPoint=opt_tmpPoint||[NaN,NaN];for(i=0,ii=endss.length;i<ii;++i){var ends=endss[i];minSquaredDistance=_ol_geom_flat_closest_.getsClosestPoint(flatCoordinates,offset,ends,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,tmpPoint),offset=ends[ends.length-1]}return minSquaredDistance}};exports.default=_ol_geom_flat_closest_},{"../../math.js":123}],63:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_extent=require("../../extent.js"),_extent2=(obj=_extent)&&obj.__esModule?obj:{default:obj};var _ol_geom_flat_contains_={linearRingContainsExtent:function(flatCoordinates,offset,end,stride,extent){return!_extent2.default.forEachCorner(extent,function(coordinate){return!_ol_geom_flat_contains_.linearRingContainsXY(flatCoordinates,offset,end,stride,coordinate[0],coordinate[1])})},linearRingContainsXY:function(flatCoordinates,offset,end,stride,x,y){for(var wn=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];y1<=y?y<y2&&0<(x2-x1)*(y-y1)-(x-x1)*(y2-y1)&&wn++:y2<=y&&(x2-x1)*(y-y1)-(x-x1)*(y2-y1)<0&&wn--,x1=x2,y1=y2}return 0!==wn},linearRingsContainsXY:function(flatCoordinates,offset,ends,stride,x,y){if(0===ends.length)return!1;if(!_ol_geom_flat_contains_.linearRingContainsXY(flatCoordinates,offset,ends[0],stride,x,y))return!1;var i,ii;for(i=1,ii=ends.length;i<ii;++i)if(_ol_geom_flat_contains_.linearRingContainsXY(flatCoordinates,ends[i-1],ends[i],stride,x,y))return!1;return!0},linearRingssContainsXY:function(flatCoordinates,offset,endss,stride,x,y){if(0===endss.length)return!1;var i,ii;for(i=0,ii=endss.length;i<ii;++i){var ends=endss[i];if(_ol_geom_flat_contains_.linearRingsContainsXY(flatCoordinates,offset,ends,stride,x,y))return!0;offset=ends[ends.length-1]}return!1}};exports.default=_ol_geom_flat_contains_},{"../../extent.js":54}],64:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_geom_flat_deflate_={coordinate:function(flatCoordinates,offset,coordinate,stride){var i,ii;for(i=0,ii=coordinate.length;i<ii;++i)flatCoordinates[offset++]=coordinate[i];return offset},coordinates:function(flatCoordinates,offset,coordinates,stride){var i,ii;for(i=0,ii=coordinates.length;i<ii;++i){var j,coordinate=coordinates[i];for(j=0;j<stride;++j)flatCoordinates[offset++]=coordinate[j]}return offset},coordinatess:function(flatCoordinates,offset,coordinatess,stride,opt_ends){var j,jj,ends=opt_ends||[],i=0;for(j=0,jj=coordinatess.length;j<jj;++j){var end=_ol_geom_flat_deflate_.coordinates(flatCoordinates,offset,coordinatess[j],stride);offset=ends[i++]=end}return ends.length=i,ends},coordinatesss:function(flatCoordinates,offset,coordinatesss,stride,opt_endss){var j,jj,endss=opt_endss||[],i=0;for(j=0,jj=coordinatesss.length;j<jj;++j){var ends=_ol_geom_flat_deflate_.coordinatess(flatCoordinates,offset,coordinatesss[j],stride,endss[i]);offset=(endss[i++]=ends)[ends.length-1]}return endss.length=i,endss}};exports.default=_ol_geom_flat_deflate_},{}],65:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_geom_flat_inflate_={coordinates:function(flatCoordinates,offset,end,stride,opt_coordinates){var j,coordinates=void 0!==opt_coordinates?opt_coordinates:[],i=0;for(j=offset;j<end;j+=stride)coordinates[i++]=flatCoordinates.slice(j,j+stride);return coordinates.length=i,coordinates},coordinatess:function(flatCoordinates,offset,ends,stride,opt_coordinatess){var j,jj,coordinatess=void 0!==opt_coordinatess?opt_coordinatess:[],i=0;for(j=0,jj=ends.length;j<jj;++j){var end=ends[j];coordinatess[i++]=_ol_geom_flat_inflate_.coordinates(flatCoordinates,offset,end,stride,coordinatess[i]),offset=end}return coordinatess.length=i,coordinatess},coordinatesss:function(flatCoordinates,offset,endss,stride,opt_coordinatesss){var j,jj,coordinatesss=void 0!==opt_coordinatesss?opt_coordinatesss:[],i=0;for(j=0,jj=endss.length;j<jj;++j){var ends=endss[j];coordinatesss[i++]=_ol_geom_flat_inflate_.coordinatess(flatCoordinates,offset,ends,stride,coordinatesss[i]),offset=ends[ends.length-1]}return coordinatesss.length=i,coordinatesss}};exports.default=_ol_geom_flat_inflate_},{}],66:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _array2=_interopRequireDefault(require("../../array.js")),_contains2=_interopRequireDefault(require("../flat/contains.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_geom_flat_interiorpoint_={linearRings:function(flatCoordinates,offset,ends,stride,flatCenters,flatCentersOffset,opt_dest){for(var i,ii,x,x1,x2,y1,y2,y=flatCenters[flatCentersOffset+1],intersections=[],r=0,rr=ends.length;r<rr;++r){var end=ends[r];for(x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1],i=offset;i<end;i+=stride)x2=flatCoordinates[i],y2=flatCoordinates[i+1],(y<=y1&&y2<=y||y1<=y&&y<=y2)&&(x=(y-y1)/(y2-y1)*(x2-x1)+x1,intersections.push(x)),x1=x2,y1=y2}var pointX=NaN,maxSegmentLength=-1/0;for(intersections.sort(_array2.default.numberSafeCompareFunction),x1=intersections[0],i=1,ii=intersections.length;i<ii;++i){x2=intersections[i];var segmentLength=Math.abs(x2-x1);maxSegmentLength<segmentLength&&(x=(x1+x2)/2,_contains2.default.linearRingsContainsXY(flatCoordinates,offset,ends,stride,x,y)&&(pointX=x,maxSegmentLength=segmentLength)),x1=x2}return isNaN(pointX)&&(pointX=flatCenters[flatCentersOffset]),opt_dest?(opt_dest.push(pointX,y,maxSegmentLength),opt_dest):[pointX,y,maxSegmentLength]},linearRingss:function(flatCoordinates,offset,endss,stride,flatCenters){var i,ii,interiorPoints=[];for(i=0,ii=endss.length;i<ii;++i){var ends=endss[i];interiorPoints=_ol_geom_flat_interiorpoint_.linearRings(flatCoordinates,offset,ends,stride,flatCenters,2*i,interiorPoints),offset=ends[ends.length-1]}return interiorPoints}};exports.default=_ol_geom_flat_interiorpoint_},{"../../array.js":29,"../flat/contains.js":63}],67:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extent2=_interopRequireDefault(require("../../extent.js")),_contains2=_interopRequireDefault(require("../flat/contains.js")),_segments2=_interopRequireDefault(require("../flat/segments.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_geom_flat_intersectsextent_={lineString:function(flatCoordinates,offset,end,stride,extent){var coordinatesExtent=_extent2.default.extendFlatCoordinates(_extent2.default.createEmpty(),flatCoordinates,offset,end,stride);return!!_extent2.default.intersects(extent,coordinatesExtent)&&(!!_extent2.default.containsExtent(extent,coordinatesExtent)||(coordinatesExtent[0]>=extent[0]&&coordinatesExtent[2]<=extent[2]||(coordinatesExtent[1]>=extent[1]&&coordinatesExtent[3]<=extent[3]||_segments2.default.forEach(flatCoordinates,offset,end,stride,function(point1,point2){return _extent2.default.intersectsSegment(extent,point1,point2)}))))},lineStrings:function(flatCoordinates,offset,ends,stride,extent){var i,ii;for(i=0,ii=ends.length;i<ii;++i){if(_ol_geom_flat_intersectsextent_.lineString(flatCoordinates,offset,ends[i],stride,extent))return!0;offset=ends[i]}return!1},linearRing:function(flatCoordinates,offset,end,stride,extent){return!!_ol_geom_flat_intersectsextent_.lineString(flatCoordinates,offset,end,stride,extent)||(!!_contains2.default.linearRingContainsXY(flatCoordinates,offset,end,stride,extent[0],extent[1])||(!!_contains2.default.linearRingContainsXY(flatCoordinates,offset,end,stride,extent[0],extent[3])||(!!_contains2.default.linearRingContainsXY(flatCoordinates,offset,end,stride,extent[2],extent[1])||!!_contains2.default.linearRingContainsXY(flatCoordinates,offset,end,stride,extent[2],extent[3]))))},linearRings:function(flatCoordinates,offset,ends,stride,extent){if(!_ol_geom_flat_intersectsextent_.linearRing(flatCoordinates,offset,ends[0],stride,extent))return!1;if(1===ends.length)return!0;var i,ii;for(i=1,ii=ends.length;i<ii;++i)if(_contains2.default.linearRingContainsExtent(flatCoordinates,ends[i-1],ends[i],stride,extent))return!1;return!0},linearRingss:function(flatCoordinates,offset,endss,stride,extent){var i,ii;for(i=0,ii=endss.length;i<ii;++i){var ends=endss[i];if(_ol_geom_flat_intersectsextent_.linearRings(flatCoordinates,offset,ends,stride,extent))return!0;offset=ends[ends.length-1]}return!1}};exports.default=_ol_geom_flat_intersectsextent_},{"../../extent.js":54,"../flat/contains.js":63,"../flat/segments.js":71}],68:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_geom_flat_length_={lineString:function(flatCoordinates,offset,end,stride){var i,x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],length=0;for(i=offset+stride;i<end;i+=stride){var x2=flatCoordinates[i],y2=flatCoordinates[i+1];length+=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)),x1=x2,y1=y2}return length},linearRing:function(flatCoordinates,offset,end,stride){var perimeter=_ol_geom_flat_length_.lineString(flatCoordinates,offset,end,stride),dx=flatCoordinates[end-stride]-flatCoordinates[offset],dy=flatCoordinates[end-stride+1]-flatCoordinates[offset+1];return perimeter+=Math.sqrt(dx*dx+dy*dy)}};exports.default=_ol_geom_flat_length_},{}],69:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_reverse=require("../flat/reverse.js"),_reverse2=(obj=_reverse)&&obj.__esModule?obj:{default:obj};var _ol_geom_flat_orient_={linearRingIsClockwise:function(flatCoordinates,offset,end,stride){for(var edge=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];edge+=(x2-x1)*(y2+y1),x1=x2,y1=y2}return 0<edge},linearRingsAreOriented:function(flatCoordinates,offset,ends,stride,opt_right){var i,ii,right=void 0!==opt_right&&opt_right;for(i=0,ii=ends.length;i<ii;++i){var end=ends[i],isClockwise=_ol_geom_flat_orient_.linearRingIsClockwise(flatCoordinates,offset,end,stride);if(0===i){if(right&&isClockwise||!right&&!isClockwise)return!1}else if(right&&!isClockwise||!right&&isClockwise)return!1;offset=end}return!0},linearRingssAreOriented:function(flatCoordinates,offset,endss,stride,opt_right){var i,ii;for(i=0,ii=endss.length;i<ii;++i)if(!_ol_geom_flat_orient_.linearRingsAreOriented(flatCoordinates,offset,endss[i],stride,opt_right))return!1;return!0},orientLinearRings:function(flatCoordinates,offset,ends,stride,opt_right){var i,ii,right=void 0!==opt_right&&opt_right;for(i=0,ii=ends.length;i<ii;++i){var end=ends[i],isClockwise=_ol_geom_flat_orient_.linearRingIsClockwise(flatCoordinates,offset,end,stride);(0===i?right&&isClockwise||!right&&!isClockwise:right&&!isClockwise||!right&&isClockwise)&&_reverse2.default.coordinates(flatCoordinates,offset,end,stride),offset=end}return offset},orientLinearRingss:function(flatCoordinates,offset,endss,stride,opt_right){var i,ii;for(i=0,ii=endss.length;i<ii;++i)offset=_ol_geom_flat_orient_.orientLinearRings(flatCoordinates,offset,endss[i],stride,opt_right);return offset}};exports.default=_ol_geom_flat_orient_},{"../flat/reverse.js":70}],70:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_geom_flat_reverse_={coordinates:function(flatCoordinates,offset,end,stride){for(;offset<end-stride;){var i;for(i=0;i<stride;++i){var tmp=flatCoordinates[offset+i];flatCoordinates[offset+i]=flatCoordinates[end-stride+i],flatCoordinates[end-stride+i]=tmp}offset+=stride,end-=stride}}};exports.default=_ol_geom_flat_reverse_},{}],71:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_geom_flat_segments_={forEach:function(flatCoordinates,offset,end,stride,callback,opt_this){for(var ret,point1=[flatCoordinates[offset],flatCoordinates[offset+1]],point2=[];offset+stride<end;offset+=stride){if(point2[0]=flatCoordinates[offset+stride],point2[1]=flatCoordinates[offset+stride+1],ret=callback.call(opt_this,point1,point2))return ret;point1[0]=point2[0],point1[1]=point2[1]}return!1}};exports.default=_ol_geom_flat_segments_},{}],72:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_math=require("../../math.js"),_math2=(obj=_math)&&obj.__esModule?obj:{default:obj};var _ol_geom_flat_simplify_={lineString:function(flatCoordinates,offset,end,stride,squaredTolerance,highQuality,opt_simplifiedFlatCoordinates){var simplifiedFlatCoordinates=void 0!==opt_simplifiedFlatCoordinates?opt_simplifiedFlatCoordinates:[];return highQuality||(end=_ol_geom_flat_simplify_.radialDistance(flatCoordinates,offset,end,stride,squaredTolerance,simplifiedFlatCoordinates,0),flatCoordinates=simplifiedFlatCoordinates,offset=0,stride=2),simplifiedFlatCoordinates.length=_ol_geom_flat_simplify_.douglasPeucker(flatCoordinates,offset,end,stride,squaredTolerance,simplifiedFlatCoordinates,0),simplifiedFlatCoordinates},douglasPeucker:function(flatCoordinates,offset,end,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset){var n=(end-offset)/stride;if(n<3){for(;offset<end;offset+=stride)simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset],simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+1];return simplifiedOffset}var markers=new Array(n);markers[0]=1,markers[n-1]=1;for(var i,stack=[offset,end-stride],index=0;0<stack.length;){var last=stack.pop(),first=stack.pop(),maxSquaredDistance=0,x1=flatCoordinates[first],y1=flatCoordinates[first+1],x2=flatCoordinates[last],y2=flatCoordinates[last+1];for(i=first+stride;i<last;i+=stride){var x=flatCoordinates[i],y=flatCoordinates[i+1],squaredDistance=_math2.default.squaredSegmentDistance(x,y,x1,y1,x2,y2);maxSquaredDistance<squaredDistance&&(index=i,maxSquaredDistance=squaredDistance)}squaredTolerance<maxSquaredDistance&&(markers[(index-offset)/stride]=1,first+stride<index&&stack.push(first,index),index+stride<last&&stack.push(index,last))}for(i=0;i<n;++i)markers[i]&&(simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+i*stride],simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+i*stride+1]);return simplifiedOffset},douglasPeuckers:function(flatCoordinates,offset,ends,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds){var i,ii;for(i=0,ii=ends.length;i<ii;++i){var end=ends[i];simplifiedOffset=_ol_geom_flat_simplify_.douglasPeucker(flatCoordinates,offset,end,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset),simplifiedEnds.push(simplifiedOffset),offset=end}return simplifiedOffset},douglasPeuckerss:function(flatCoordinates,offset,endss,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEndss){var i,ii;for(i=0,ii=endss.length;i<ii;++i){var ends=endss[i],simplifiedEnds=[];simplifiedOffset=_ol_geom_flat_simplify_.douglasPeuckers(flatCoordinates,offset,ends,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds),simplifiedEndss.push(simplifiedEnds),offset=ends[ends.length-1]}return simplifiedOffset},radialDistance:function(flatCoordinates,offset,end,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset){if(end<=offset+stride){for(;offset<end;offset+=stride)simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset],simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+1];return simplifiedOffset}var x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],x2=simplifiedFlatCoordinates[simplifiedOffset++]=x1,y2=simplifiedFlatCoordinates[simplifiedOffset++]=y1;for(offset+=stride;offset<end;offset+=stride)x2=flatCoordinates[offset],y2=flatCoordinates[offset+1],_math2.default.squaredDistance(x1,y1,x2,y2)>squaredTolerance&&(x1=simplifiedFlatCoordinates[simplifiedOffset++]=x2,y1=simplifiedFlatCoordinates[simplifiedOffset++]=y2);return x2==x1&&y2==y1||(simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2),simplifiedOffset},snap:function(value,tolerance){return tolerance*Math.round(value/tolerance)},quantize:function(flatCoordinates,offset,end,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset){if(offset==end)return simplifiedOffset;var x2,y2,x1=_ol_geom_flat_simplify_.snap(flatCoordinates[offset],tolerance),y1=_ol_geom_flat_simplify_.snap(flatCoordinates[offset+1],tolerance);offset+=stride,simplifiedFlatCoordinates[simplifiedOffset++]=x1,simplifiedFlatCoordinates[simplifiedOffset++]=y1;do{if(x2=_ol_geom_flat_simplify_.snap(flatCoordinates[offset],tolerance),y2=_ol_geom_flat_simplify_.snap(flatCoordinates[offset+1],tolerance),(offset+=stride)==end)return simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2,simplifiedOffset}while(x2==x1&&y2==y1);for(;offset<end;){var x3,y3;if(x3=_ol_geom_flat_simplify_.snap(flatCoordinates[offset],tolerance),y3=_ol_geom_flat_simplify_.snap(flatCoordinates[offset+1],tolerance),offset+=stride,x3!=x2||y3!=y2){var dx1=x2-x1,dy1=y2-y1,dx2=x3-x1,dy2=y3-y1;y2=(x2=(dx1*dy2==dy1*dx2&&(dx1<0&&dx2<dx1||dx1==dx2||0<dx1&&dx1<dx2)&&(dy1<0&&dy2<dy1||dy1==dy2||0<dy1&&dy1<dy2)||(x1=simplifiedFlatCoordinates[simplifiedOffset++]=x2,y1=simplifiedFlatCoordinates[simplifiedOffset++]=y2),x3),y3)}}return simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2,simplifiedOffset},quantizes:function(flatCoordinates,offset,ends,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds){var i,ii;for(i=0,ii=ends.length;i<ii;++i){var end=ends[i];simplifiedOffset=_ol_geom_flat_simplify_.quantize(flatCoordinates,offset,end,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset),simplifiedEnds.push(simplifiedOffset),offset=end}return simplifiedOffset},quantizess:function(flatCoordinates,offset,endss,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEndss){var i,ii;for(i=0,ii=endss.length;i<ii;++i){var ends=endss[i],simplifiedEnds=[];simplifiedOffset=_ol_geom_flat_simplify_.quantizes(flatCoordinates,offset,ends,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds),simplifiedEndss.push(simplifiedEnds),offset=ends[ends.length-1]}return simplifiedOffset}};exports.default=_ol_geom_flat_simplify_},{"../../math.js":123}],73:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_geom_flat_straightchunk_={lineString:function(maxAngle,flatCoordinates,offset,end,stride){var i,m12,m23,x1,y1,x12,y12,x23,y23,chunkStart=offset,chunkEnd=offset,chunkM=0,m=0,start=offset;for(i=offset;i<end;i+=stride){var x2=flatCoordinates[i],y2=flatCoordinates[i+1];void 0!==x1&&(x23=x2-x1,y23=y2-y1,m23=Math.sqrt(x23*x23+y23*y23),void 0!==x12&&(m+=m12,maxAngle<Math.acos((x12*x23+y12*y23)/(m12*m23))&&(chunkM<m&&(chunkM=m,chunkStart=start,chunkEnd=i),m=0,start=i-stride)),m12=m23,x12=x23,y12=y23),x1=x2,y1=y2}return chunkM<(m+=m23)?[start,i]:[chunkStart,chunkEnd]}};exports.default=_ol_geom_flat_straightchunk_},{}],74:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_math=require("../../math.js"),_math2=(obj=_math)&&obj.__esModule?obj:{default:obj};var _ol_geom_flat_textpath_={lineString:function(flatCoordinates,offset,end,stride,text,measure,startM,maxAngle){for(var data,index,previousAngle,result=[],reverse=flatCoordinates[offset]>flatCoordinates[end-stride],numChars=text.length,x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],x2=flatCoordinates[offset+=stride],y2=flatCoordinates[offset+1],segmentM=0,segmentLength=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)),chunk="",chunkLength=0,i=0;i<numChars;++i){index=reverse?numChars-i-1:i;var char=text.charAt(index),charLength=measure(chunk=reverse?char+chunk:chunk+char)-chunkLength;chunkLength+=charLength;for(var charM=startM+charLength/2;offset<end-stride&&segmentM+segmentLength<charM;)x1=x2,y1=y2,x2=flatCoordinates[offset+=stride],y2=flatCoordinates[offset+1],segmentM+=segmentLength,segmentLength=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2));var segmentPos=charM-segmentM,angle=Math.atan2(y2-y1,x2-x1);if(reverse&&(angle+=0<angle?-Math.PI:Math.PI),void 0!==previousAngle){var delta=angle-previousAngle;if(delta+=delta>Math.PI?-2*Math.PI:delta<-Math.PI?2*Math.PI:0,Math.abs(delta)>maxAngle)return null}var interpolate=segmentPos/segmentLength,x=_math2.default.lerp(x1,x2,interpolate),y=_math2.default.lerp(y1,y2,interpolate);previousAngle==angle?(reverse&&(data[0]=x,data[1]=y,data[2]=charLength/2),data[4]=chunk):(data=[x,y,(chunkLength=charLength)/2,angle,chunk=char],reverse?result.unshift(data):result.push(data),previousAngle=angle),startM+=charLength}return result}};exports.default=_ol_geom_flat_textpath_},{"../../math.js":123}],75:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_area=require("../flat/area.js"),_area2=(obj=_area)&&obj.__esModule?obj:{default:obj};var _ol_geom_flat_topology_={lineStringIsClosed:function(flatCoordinates,offset,end,stride){var lastCoord=end-stride;return flatCoordinates[offset]===flatCoordinates[lastCoord]&&flatCoordinates[offset+1]===flatCoordinates[lastCoord+1]&&3<(end-offset)/stride&&!!_area2.default.linearRing(flatCoordinates,offset,end,stride)}};exports.default=_ol_geom_flat_topology_},{"../flat/area.js":61}],76:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_geom_flat_transform_={transform2D:function(flatCoordinates,offset,end,stride,transform,opt_dest){var j,dest=opt_dest||[],i=0;for(j=offset;j<end;j+=stride){var x=flatCoordinates[j],y=flatCoordinates[j+1];dest[i++]=transform[0]*x+transform[2]*y+transform[4],dest[i++]=transform[1]*x+transform[3]*y+transform[5]}return opt_dest&&dest.length!=i&&(dest.length=i),dest},rotate:function(flatCoordinates,offset,end,stride,angle,anchor,opt_dest){for(var dest=opt_dest||[],cos=Math.cos(angle),sin=Math.sin(angle),anchorX=anchor[0],anchorY=anchor[1],i=0,j=offset;j<end;j+=stride){var deltaX=flatCoordinates[j]-anchorX,deltaY=flatCoordinates[j+1]-anchorY;dest[i++]=anchorX+deltaX*cos-deltaY*sin,dest[i++]=anchorY+deltaX*sin+deltaY*cos;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}return opt_dest&&dest.length!=i&&(dest.length=i),dest},scale:function(flatCoordinates,offset,end,stride,sx,sy,anchor,opt_dest){for(var dest=opt_dest||[],anchorX=anchor[0],anchorY=anchor[1],i=0,j=offset;j<end;j+=stride){var deltaX=flatCoordinates[j]-anchorX,deltaY=flatCoordinates[j+1]-anchorY;dest[i++]=anchorX+sx*deltaX,dest[i++]=anchorY+sy*deltaY;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}return opt_dest&&dest.length!=i&&(dest.length=i),dest},translate:function(flatCoordinates,offset,end,stride,deltaX,deltaY,opt_dest){var j,k,dest=opt_dest||[],i=0;for(j=offset;j<end;j+=stride)for(dest[i++]=flatCoordinates[j]+deltaX,dest[i++]=flatCoordinates[j+1]+deltaY,k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k];return opt_dest&&dest.length!=i&&(dest.length=i),dest}};exports.default=_ol_geom_flat_transform_},{}],77:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_object2=_interopRequireDefault(require("../object.js")),_extent2=_interopRequireDefault(require("../extent.js")),_functions2=_interopRequireDefault(require("../functions.js")),_transform2=_interopRequireDefault(require("../geom/flat/transform.js")),_proj2=_interopRequireDefault(require("../proj.js")),_units2=_interopRequireDefault(require("../proj/units.js")),_transform4=_interopRequireDefault(require("../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_geom_Geometry_=function(){_object2.default.call(this),this.extent_=_extent2.default.createEmpty(),this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.tmpTransform_=_transform4.default.create()};_index2.default.inherits(_ol_geom_Geometry_,_object2.default),_ol_geom_Geometry_.prototype.clone=function(){},_ol_geom_Geometry_.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){},_ol_geom_Geometry_.prototype.getClosestPoint=function(point,opt_closestPoint){var closestPoint=opt_closestPoint||[NaN,NaN];return this.closestPointXY(point[0],point[1],closestPoint,1/0),closestPoint},_ol_geom_Geometry_.prototype.intersectsCoordinate=function(coordinate){return this.containsXY(coordinate[0],coordinate[1])},_ol_geom_Geometry_.prototype.computeExtent=function(extent){},_ol_geom_Geometry_.prototype.containsXY=_functions2.default.FALSE,_ol_geom_Geometry_.prototype.getExtent=function(opt_extent){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),_extent2.default.returnOrUpdate(this.extent_,opt_extent)},_ol_geom_Geometry_.prototype.rotate=function(angle,anchor){},_ol_geom_Geometry_.prototype.scale=function(sx,opt_sy,opt_anchor){},_ol_geom_Geometry_.prototype.simplify=function(tolerance){return this.getSimplifiedGeometry(tolerance*tolerance)},_ol_geom_Geometry_.prototype.getSimplifiedGeometry=function(squaredTolerance){},_ol_geom_Geometry_.prototype.getType=function(){},_ol_geom_Geometry_.prototype.applyTransform=function(transformFn){},_ol_geom_Geometry_.prototype.intersectsExtent=function(extent){},_ol_geom_Geometry_.prototype.translate=function(deltaX,deltaY){},_ol_geom_Geometry_.prototype.transform=function(source,destination){var tmpTransform=this.tmpTransform_,transformFn=(source=_proj2.default.get(source)).getUnits()==_units2.default.TILE_PIXELS?function(inCoordinates,outCoordinates,stride){var pixelExtent=source.getExtent(),projectedExtent=source.getWorldExtent(),scale=_extent2.default.getHeight(projectedExtent)/_extent2.default.getHeight(pixelExtent);return _transform4.default.compose(tmpTransform,projectedExtent[0],projectedExtent[3],scale,-scale,0,0,0),_transform2.default.transform2D(inCoordinates,0,inCoordinates.length,stride,tmpTransform,outCoordinates),_proj2.default.getTransform(source,destination)(inCoordinates,outCoordinates,stride)}:_proj2.default.getTransform(source,destination);return this.applyTransform(transformFn),this},exports.default=_ol_geom_Geometry_},{"../extent.js":54,"../functions.js":60,"../geom/flat/transform.js":76,"../index.js":89,"../object.js":125,"../proj.js":141,"../proj/units.js":148,"../transform.js":243}],78:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"}},{}],79:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"}},{}],80:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_extent2=_interopRequireDefault(require("../extent.js")),_geometrylayout2=_interopRequireDefault(require("../geom/geometrylayout.js")),_geometrytype2=_interopRequireDefault(require("../geom/geometrytype.js")),_simplegeometry2=_interopRequireDefault(require("../geom/simplegeometry.js")),_area2=_interopRequireDefault(require("../geom/flat/area.js")),_closest2=_interopRequireDefault(require("../geom/flat/closest.js")),_deflate2=_interopRequireDefault(require("../geom/flat/deflate.js")),_inflate2=_interopRequireDefault(require("../geom/flat/inflate.js")),_simplify2=_interopRequireDefault(require("../geom/flat/simplify.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_geom_LinearRing_=function(coordinates,opt_layout){_simplegeometry2.default.call(this),this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.setCoordinates(coordinates,opt_layout)};_index2.default.inherits(_ol_geom_LinearRing_,_simplegeometry2.default),_ol_geom_LinearRing_.prototype.clone=function(){var linearRing=new _ol_geom_LinearRing_(null);return linearRing.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),linearRing},_ol_geom_LinearRing_.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<_extent2.default.closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(_closest2.default.getMaxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_closest2.default.getClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,x,y,closestPoint,minSquaredDistance))},_ol_geom_LinearRing_.prototype.getArea=function(){return _area2.default.linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},_ol_geom_LinearRing_.prototype.getCoordinates=function(){return _inflate2.default.coordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},_ol_geom_LinearRing_.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[];simplifiedFlatCoordinates.length=_simplify2.default.douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,squaredTolerance,simplifiedFlatCoordinates,0);var simplifiedLinearRing=new _ol_geom_LinearRing_(null);return simplifiedLinearRing.setFlatCoordinates(_geometrylayout2.default.XY,simplifiedFlatCoordinates),simplifiedLinearRing},_ol_geom_LinearRing_.prototype.getType=function(){return _geometrytype2.default.LINEAR_RING},_ol_geom_LinearRing_.prototype.intersectsExtent=function(extent){},_ol_geom_LinearRing_.prototype.setCoordinates=function(coordinates,opt_layout){coordinates?(this.setLayout(opt_layout,coordinates,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=_deflate2.default.coordinates(this.flatCoordinates,0,coordinates,this.stride),this.changed()):this.setFlatCoordinates(_geometrylayout2.default.XY,null)},_ol_geom_LinearRing_.prototype.setFlatCoordinates=function(layout,flatCoordinates){this.setFlatCoordinatesInternal(layout,flatCoordinates),this.changed()},exports.default=_ol_geom_LinearRing_},{"../extent.js":54,"../geom/flat/area.js":61,"../geom/flat/closest.js":62,"../geom/flat/deflate.js":64,"../geom/flat/inflate.js":65,"../geom/flat/simplify.js":72,"../geom/geometrylayout.js":78,"../geom/geometrytype.js":79,"../geom/simplegeometry.js":83,"../index.js":89}],81:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_extent2=_interopRequireDefault(require("../extent.js")),_geometrylayout2=_interopRequireDefault(require("../geom/geometrylayout.js")),_geometrytype2=_interopRequireDefault(require("../geom/geometrytype.js")),_simplegeometry2=_interopRequireDefault(require("../geom/simplegeometry.js")),_deflate2=_interopRequireDefault(require("../geom/flat/deflate.js")),_math2=_interopRequireDefault(require("../math.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_geom_Point_=function(coordinates,opt_layout){_simplegeometry2.default.call(this),this.setCoordinates(coordinates,opt_layout)};_index2.default.inherits(_ol_geom_Point_,_simplegeometry2.default),_ol_geom_Point_.prototype.clone=function(){var point=new _ol_geom_Point_(null);return point.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),point},_ol_geom_Point_.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){var flatCoordinates=this.flatCoordinates,squaredDistance=_math2.default.squaredDistance(x,y,flatCoordinates[0],flatCoordinates[1]);if(squaredDistance<minSquaredDistance){var i,stride=this.stride;for(i=0;i<stride;++i)closestPoint[i]=flatCoordinates[i];return closestPoint.length=stride,squaredDistance}return minSquaredDistance},_ol_geom_Point_.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},_ol_geom_Point_.prototype.computeExtent=function(extent){return _extent2.default.createOrUpdateFromCoordinate(this.flatCoordinates,extent)},_ol_geom_Point_.prototype.getType=function(){return _geometrytype2.default.POINT},_ol_geom_Point_.prototype.intersectsExtent=function(extent){return _extent2.default.containsXY(extent,this.flatCoordinates[0],this.flatCoordinates[1])},_ol_geom_Point_.prototype.setCoordinates=function(coordinates,opt_layout){coordinates?(this.setLayout(opt_layout,coordinates,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=_deflate2.default.coordinate(this.flatCoordinates,0,coordinates,this.stride),this.changed()):this.setFlatCoordinates(_geometrylayout2.default.XY,null)},_ol_geom_Point_.prototype.setFlatCoordinates=function(layout,flatCoordinates){this.setFlatCoordinatesInternal(layout,flatCoordinates),this.changed()},exports.default=_ol_geom_Point_},{"../extent.js":54,"../geom/flat/deflate.js":64,"../geom/geometrylayout.js":78,"../geom/geometrytype.js":79,"../geom/simplegeometry.js":83,"../index.js":89,"../math.js":123}],82:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_array2=_interopRequireDefault(require("../array.js")),_extent2=_interopRequireDefault(require("../extent.js")),_geometrylayout2=_interopRequireDefault(require("../geom/geometrylayout.js")),_geometrytype2=_interopRequireDefault(require("../geom/geometrytype.js")),_linearring2=_interopRequireDefault(require("../geom/linearring.js")),_point2=_interopRequireDefault(require("../geom/point.js")),_simplegeometry2=_interopRequireDefault(require("../geom/simplegeometry.js")),_area2=_interopRequireDefault(require("../geom/flat/area.js")),_closest2=_interopRequireDefault(require("../geom/flat/closest.js")),_contains2=_interopRequireDefault(require("../geom/flat/contains.js")),_deflate2=_interopRequireDefault(require("../geom/flat/deflate.js")),_inflate2=_interopRequireDefault(require("../geom/flat/inflate.js")),_interiorpoint2=_interopRequireDefault(require("../geom/flat/interiorpoint.js")),_intersectsextent2=_interopRequireDefault(require("../geom/flat/intersectsextent.js")),_orient2=_interopRequireDefault(require("../geom/flat/orient.js")),_simplify2=_interopRequireDefault(require("../geom/flat/simplify.js")),_math2=_interopRequireDefault(require("../math.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_geom_Polygon_=function(coordinates,opt_layout){_simplegeometry2.default.call(this),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,this.setCoordinates(coordinates,opt_layout)};_index2.default.inherits(_ol_geom_Polygon_,_simplegeometry2.default),_ol_geom_Polygon_.prototype.appendLinearRing=function(linearRing){this.flatCoordinates?_array2.default.extend(this.flatCoordinates,linearRing.getFlatCoordinates()):this.flatCoordinates=linearRing.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},_ol_geom_Polygon_.prototype.clone=function(){var polygon=new _ol_geom_Polygon_(null);return polygon.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice()),polygon},_ol_geom_Polygon_.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<_extent2.default.closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(_closest2.default.getsMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_closest2.default.getsClosestPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,x,y,closestPoint,minSquaredDistance))},_ol_geom_Polygon_.prototype.containsXY=function(x,y){return _contains2.default.linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,x,y)},_ol_geom_Polygon_.prototype.getArea=function(){return _area2.default.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},_ol_geom_Polygon_.prototype.getCoordinates=function(opt_right){var flatCoordinates;return void 0!==opt_right?(flatCoordinates=this.getOrientedFlatCoordinates().slice(),_orient2.default.orientLinearRings(flatCoordinates,0,this.ends_,this.stride,opt_right)):flatCoordinates=this.flatCoordinates,_inflate2.default.coordinatess(flatCoordinates,0,this.ends_,this.stride)},_ol_geom_Polygon_.prototype.getEnds=function(){return this.ends_},_ol_geom_Polygon_.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var flatCenter=_extent2.default.getCenter(this.getExtent());this.flatInteriorPoint_=_interiorpoint2.default.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,flatCenter,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},_ol_geom_Polygon_.prototype.getInteriorPoint=function(){return new _point2.default(this.getFlatInteriorPoint(),_geometrylayout2.default.XYM)},_ol_geom_Polygon_.prototype.getLinearRingCount=function(){return this.ends_.length},_ol_geom_Polygon_.prototype.getLinearRing=function(index){if(index<0||this.ends_.length<=index)return null;var linearRing=new _linearring2.default(null);return linearRing.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===index?0:this.ends_[index-1],this.ends_[index])),linearRing},_ol_geom_Polygon_.prototype.getLinearRings=function(){var i,ii,layout=this.layout,flatCoordinates=this.flatCoordinates,ends=this.ends_,linearRings=[],offset=0;for(i=0,ii=ends.length;i<ii;++i){var end=ends[i],linearRing=new _linearring2.default(null);linearRing.setFlatCoordinates(layout,flatCoordinates.slice(offset,end)),linearRings.push(linearRing),offset=end}return linearRings},_ol_geom_Polygon_.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var flatCoordinates=this.flatCoordinates;_orient2.default.linearRingsAreOriented(flatCoordinates,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=flatCoordinates:(this.orientedFlatCoordinates_=flatCoordinates.slice(),this.orientedFlatCoordinates_.length=_orient2.default.orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},_ol_geom_Polygon_.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[],simplifiedEnds=[];simplifiedFlatCoordinates.length=_simplify2.default.quantizes(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(squaredTolerance),simplifiedFlatCoordinates,0,simplifiedEnds);var simplifiedPolygon=new _ol_geom_Polygon_(null);return simplifiedPolygon.setFlatCoordinates(_geometrylayout2.default.XY,simplifiedFlatCoordinates,simplifiedEnds),simplifiedPolygon},_ol_geom_Polygon_.prototype.getType=function(){return _geometrytype2.default.POLYGON},_ol_geom_Polygon_.prototype.intersectsExtent=function(extent){return _intersectsextent2.default.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,extent)},_ol_geom_Polygon_.prototype.setCoordinates=function(coordinates,opt_layout){if(coordinates){this.setLayout(opt_layout,coordinates,2),this.flatCoordinates||(this.flatCoordinates=[]);var ends=_deflate2.default.coordinatess(this.flatCoordinates,0,coordinates,this.stride,this.ends_);this.flatCoordinates.length=0===ends.length?0:ends[ends.length-1],this.changed()}else this.setFlatCoordinates(_geometrylayout2.default.XY,null,this.ends_)},_ol_geom_Polygon_.prototype.setFlatCoordinates=function(layout,flatCoordinates,ends){this.setFlatCoordinatesInternal(layout,flatCoordinates),this.ends_=ends,this.changed()},_ol_geom_Polygon_.circular=function(sphere,center,radius,opt_n){var i,n=opt_n||32,flatCoordinates=[];for(i=0;i<n;++i)_array2.default.extend(flatCoordinates,sphere.offset(center,radius,2*Math.PI*i/n));flatCoordinates.push(flatCoordinates[0],flatCoordinates[1]);var polygon=new _ol_geom_Polygon_(null);return polygon.setFlatCoordinates(_geometrylayout2.default.XY,flatCoordinates,[flatCoordinates.length]),polygon},_ol_geom_Polygon_.fromExtent=function(extent){var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],flatCoordinates=[minX,minY,minX,maxY,maxX,maxY,maxX,minY,minX,minY],polygon=new _ol_geom_Polygon_(null);return polygon.setFlatCoordinates(_geometrylayout2.default.XY,flatCoordinates,[flatCoordinates.length]),polygon},_ol_geom_Polygon_.fromCircle=function(circle,opt_sides,opt_angle){for(var sides=opt_sides||32,stride=circle.getStride(),layout=circle.getLayout(),polygon=new _ol_geom_Polygon_(null,layout),arrayLength=stride*(sides+1),flatCoordinates=new Array(arrayLength),i=0;i<arrayLength;i++)flatCoordinates[i]=0;var ends=[flatCoordinates.length];return polygon.setFlatCoordinates(layout,flatCoordinates,ends),_ol_geom_Polygon_.makeRegular(polygon,circle.getCenter(),circle.getRadius(),opt_angle),polygon},_ol_geom_Polygon_.makeRegular=function(polygon,center,radius,opt_angle){for(var angle,offset,flatCoordinates=polygon.getFlatCoordinates(),layout=polygon.getLayout(),stride=polygon.getStride(),ends=polygon.getEnds(),sides=flatCoordinates.length/stride-1,startAngle=opt_angle||0,i=0;i<=sides;++i)offset=i*stride,angle=startAngle+2*_math2.default.modulo(i,sides)*Math.PI/sides,flatCoordinates[offset]=center[0]+radius*Math.cos(angle),flatCoordinates[offset+1]=center[1]+radius*Math.sin(angle);polygon.setFlatCoordinates(layout,flatCoordinates,ends)},exports.default=_ol_geom_Polygon_},{"../array.js":29,"../extent.js":54,"../geom/flat/area.js":61,"../geom/flat/closest.js":62,"../geom/flat/contains.js":63,"../geom/flat/deflate.js":64,"../geom/flat/inflate.js":65,"../geom/flat/interiorpoint.js":66,"../geom/flat/intersectsextent.js":67,"../geom/flat/orient.js":69,"../geom/flat/simplify.js":72,"../geom/geometrylayout.js":78,"../geom/geometrytype.js":79,"../geom/linearring.js":80,"../geom/point.js":81,"../geom/simplegeometry.js":83,"../index.js":89,"../math.js":123}],83:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_functions2=_interopRequireDefault(require("../functions.js")),_extent2=_interopRequireDefault(require("../extent.js")),_geometry2=_interopRequireDefault(require("../geom/geometry.js")),_geometrylayout2=_interopRequireDefault(require("../geom/geometrylayout.js")),_transform2=_interopRequireDefault(require("../geom/flat/transform.js")),_obj2=_interopRequireDefault(require("../obj.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_geom_SimpleGeometry_=function(){_geometry2.default.call(this),this.layout=_geometrylayout2.default.XY,this.stride=2,this.flatCoordinates=null};_index2.default.inherits(_ol_geom_SimpleGeometry_,_geometry2.default),_ol_geom_SimpleGeometry_.getLayoutForStride_=function(stride){var layout;return 2==stride?layout=_geometrylayout2.default.XY:3==stride?layout=_geometrylayout2.default.XYZ:4==stride&&(layout=_geometrylayout2.default.XYZM),layout},_ol_geom_SimpleGeometry_.getStrideForLayout=function(layout){var stride;return layout==_geometrylayout2.default.XY?stride=2:layout==_geometrylayout2.default.XYZ||layout==_geometrylayout2.default.XYM?stride=3:layout==_geometrylayout2.default.XYZM&&(stride=4),stride},_ol_geom_SimpleGeometry_.prototype.containsXY=_functions2.default.FALSE,_ol_geom_SimpleGeometry_.prototype.computeExtent=function(extent){return _extent2.default.createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,extent)},_ol_geom_SimpleGeometry_.prototype.getCoordinates=function(){},_ol_geom_SimpleGeometry_.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},_ol_geom_SimpleGeometry_.prototype.getFlatCoordinates=function(){return this.flatCoordinates},_ol_geom_SimpleGeometry_.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},_ol_geom_SimpleGeometry_.prototype.getLayout=function(){return this.layout},_ol_geom_SimpleGeometry_.prototype.getSimplifiedGeometry=function(squaredTolerance){if(this.simplifiedGeometryRevision!=this.getRevision()&&(_obj2.default.clear(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),squaredTolerance<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&squaredTolerance<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var key=squaredTolerance.toString();if(this.simplifiedGeometryCache.hasOwnProperty(key))return this.simplifiedGeometryCache[key];var simplifiedGeometry=this.getSimplifiedGeometryInternal(squaredTolerance);return simplifiedGeometry.getFlatCoordinates().length<this.flatCoordinates.length?this.simplifiedGeometryCache[key]=simplifiedGeometry:(this.simplifiedGeometryMaxMinSquaredTolerance=squaredTolerance,this)},_ol_geom_SimpleGeometry_.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){return this},_ol_geom_SimpleGeometry_.prototype.getStride=function(){return this.stride},_ol_geom_SimpleGeometry_.prototype.setFlatCoordinatesInternal=function(layout,flatCoordinates){this.stride=_ol_geom_SimpleGeometry_.getStrideForLayout(layout),this.layout=layout,this.flatCoordinates=flatCoordinates},_ol_geom_SimpleGeometry_.prototype.setCoordinates=function(coordinates,opt_layout){},_ol_geom_SimpleGeometry_.prototype.setLayout=function(layout,coordinates,nesting){var stride;if(layout)stride=_ol_geom_SimpleGeometry_.getStrideForLayout(layout);else{var i;for(i=0;i<nesting;++i){if(0===coordinates.length)return this.layout=_geometrylayout2.default.XY,void(this.stride=2);coordinates=coordinates[0]}stride=coordinates.length,layout=_ol_geom_SimpleGeometry_.getLayoutForStride_(stride)}this.layout=layout,this.stride=stride},_ol_geom_SimpleGeometry_.prototype.applyTransform=function(transformFn){this.flatCoordinates&&(transformFn(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},_ol_geom_SimpleGeometry_.prototype.rotate=function(angle,anchor){var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();_transform2.default.rotate(flatCoordinates,0,flatCoordinates.length,stride,angle,anchor,flatCoordinates),this.changed()}},_ol_geom_SimpleGeometry_.prototype.scale=function(sx,opt_sy,opt_anchor){var sy=opt_sy;void 0===sy&&(sy=sx);var anchor=opt_anchor;anchor||(anchor=_extent2.default.getCenter(this.getExtent()));var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();_transform2.default.scale(flatCoordinates,0,flatCoordinates.length,stride,sx,sy,anchor,flatCoordinates),this.changed()}},_ol_geom_SimpleGeometry_.prototype.translate=function(deltaX,deltaY){var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();_transform2.default.translate(flatCoordinates,0,flatCoordinates.length,stride,deltaX,deltaY,flatCoordinates),this.changed()}},_ol_geom_SimpleGeometry_.transform2D=function(simpleGeometry,transform,opt_dest){var flatCoordinates=simpleGeometry.getFlatCoordinates();if(flatCoordinates){var stride=simpleGeometry.getStride();return _transform2.default.transform2D(flatCoordinates,0,flatCoordinates.length,stride,transform,opt_dest)}return null},exports.default=_ol_geom_SimpleGeometry_},{"../extent.js":54,"../functions.js":60,"../geom/flat/transform.js":76,"../geom/geometry.js":77,"../geom/geometrylayout.js":78,"../index.js":89,"../obj.js":124}],84:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_webgl2=_interopRequireDefault(require("./webgl.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_has_={},ua="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"";_ol_has_.FIREFOX=-1!==ua.indexOf("firefox"),_ol_has_.SAFARI=-1!==ua.indexOf("safari")&&-1==ua.indexOf("chrom"),_ol_has_.WEBKIT=-1!==ua.indexOf("webkit")&&-1==ua.indexOf("edge"),_ol_has_.MAC=-1!==ua.indexOf("macintosh"),_ol_has_.DEVICE_PIXEL_RATIO=window.devicePixelRatio||1,_ol_has_.CANVAS_LINE_DASH=!1,_ol_has_.CANVAS=_index2.default.ENABLE_CANVAS&&function(){if(!("HTMLCanvasElement"in window))return!1;try{var context=document.createElement("CANVAS").getContext("2d");return!!context&&(void 0!==context.setLineDash&&(_ol_has_.CANVAS_LINE_DASH=!0),!0)}catch(e){return!1}}(),_ol_has_.DEVICE_ORIENTATION="DeviceOrientationEvent"in window,_ol_has_.GEOLOCATION="geolocation"in navigator,_ol_has_.TOUCH=_index2.default.ASSUME_TOUCH||"ontouchstart"in window,_ol_has_.POINTER="PointerEvent"in window,_ol_has_.MSPOINTER=!!navigator.msPointerEnabled,_ol_has_.WEBGL,function(){if(_index2.default.ENABLE_WEBGL){var textureSize,hasWebGL=!1,extensions=[];if("WebGLRenderingContext"in window)try{var canvas=document.createElement("CANVAS"),gl=_webgl2.default.getContext(canvas,{failIfMajorPerformanceCaveat:!0});gl&&(hasWebGL=!0,textureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE),extensions=gl.getSupportedExtensions())}catch(e){}_ol_has_.WEBGL=hasWebGL,_index2.default.WEBGL_EXTENSIONS=extensions,_index2.default.WEBGL_MAX_TEXTURE_SIZE=textureSize}}(),exports.default=_ol_has_},{"./index.js":89,"./webgl.js":248}],85:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_imagebase2=_interopRequireDefault(require("./imagebase.js")),_imagestate2=_interopRequireDefault(require("./imagestate.js")),_events2=_interopRequireDefault(require("./events.js")),_eventtype2=_interopRequireDefault(require("./events/eventtype.js")),_extent2=_interopRequireDefault(require("./extent.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_Image_=function(extent,resolution,pixelRatio,src,crossOrigin,imageLoadFunction){_imagebase2.default.call(this,extent,resolution,pixelRatio,_imagestate2.default.IDLE),this.src_=src,this.image_=new Image,null!==crossOrigin&&(this.image_.crossOrigin=crossOrigin),this.imageListenerKeys_=null,this.state=_imagestate2.default.IDLE,this.imageLoadFunction_=imageLoadFunction};_index2.default.inherits(_ol_Image_,_imagebase2.default),_ol_Image_.prototype.getImage=function(){return this.image_},_ol_Image_.prototype.handleImageError_=function(){this.state=_imagestate2.default.ERROR,this.unlistenImage_(),this.changed()},_ol_Image_.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=_extent2.default.getHeight(this.extent)/this.image_.height),this.state=_imagestate2.default.LOADED,this.unlistenImage_(),this.changed()},_ol_Image_.prototype.load=function(){this.state!=_imagestate2.default.IDLE&&this.state!=_imagestate2.default.ERROR||(this.state=_imagestate2.default.LOADING,this.changed(),this.imageListenerKeys_=[_events2.default.listenOnce(this.image_,_eventtype2.default.ERROR,this.handleImageError_,this),_events2.default.listenOnce(this.image_,_eventtype2.default.LOAD,this.handleImageLoad_,this)],this.imageLoadFunction_(this,this.src_))},_ol_Image_.prototype.setImage=function(image){this.image_=image},_ol_Image_.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(_events2.default.unlistenByKey),this.imageListenerKeys_=null},exports.default=_ol_Image_},{"./events.js":48,"./events/eventtype.js":52,"./extent.js":54,"./imagebase.js":86,"./imagestate.js":88,"./index.js":89}],86:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_eventtarget2=_interopRequireDefault(require("./events/eventtarget.js")),_eventtype2=_interopRequireDefault(require("./events/eventtype.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_ImageBase_=function(extent,resolution,pixelRatio,state){_eventtarget2.default.call(this),this.extent=extent,this.pixelRatio_=pixelRatio,this.resolution=resolution,this.state=state};_index2.default.inherits(_ol_ImageBase_,_eventtarget2.default),_ol_ImageBase_.prototype.changed=function(){this.dispatchEvent(_eventtype2.default.CHANGE)},_ol_ImageBase_.prototype.getExtent=function(){return this.extent},_ol_ImageBase_.prototype.getImage=function(){},_ol_ImageBase_.prototype.getPixelRatio=function(){return this.pixelRatio_},_ol_ImageBase_.prototype.getResolution=function(){return this.resolution},_ol_ImageBase_.prototype.getState=function(){return this.state},_ol_ImageBase_.prototype.load=function(){},exports.default=_ol_ImageBase_},{"./events/eventtarget.js":51,"./events/eventtype.js":52,"./index.js":89}],87:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_imagebase2=_interopRequireDefault(require("./imagebase.js")),_imagestate2=_interopRequireDefault(require("./imagestate.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_ImageCanvas_=function(extent,resolution,pixelRatio,canvas,opt_loader){this.loader_=void 0!==opt_loader?opt_loader:null;var state=void 0!==opt_loader?_imagestate2.default.IDLE:_imagestate2.default.LOADED;_imagebase2.default.call(this,extent,resolution,pixelRatio,state),this.canvas_=canvas,this.error_=null};_index2.default.inherits(_ol_ImageCanvas_,_imagebase2.default),_ol_ImageCanvas_.prototype.getError=function(){return this.error_},_ol_ImageCanvas_.prototype.handleLoad_=function(err){this.state=err?(this.error_=err,_imagestate2.default.ERROR):_imagestate2.default.LOADED,this.changed()},_ol_ImageCanvas_.prototype.load=function(){this.state==_imagestate2.default.IDLE&&(this.state=_imagestate2.default.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},_ol_ImageCanvas_.prototype.getImage=function(){return this.canvas_},exports.default=_ol_ImageCanvas_},{"./imagebase.js":86,"./imagestate.js":88,"./index.js":89}],88:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={IDLE:0,LOADING:1,LOADED:2,ERROR:3}},{}],89:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_={ASSUME_TOUCH:!1,DEFAULT_MAX_ZOOM:42,DEFAULT_MIN_ZOOM:0,DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD:.5,DEFAULT_TILE_SIZE:256,DEFAULT_WMS_VERSION:"1.3.0",ENABLE_CANVAS:!0,ENABLE_PROJ4JS:!0,ENABLE_RASTER_REPROJECTION:!0,ENABLE_WEBGL:!0,DEBUG_WEBGL:!0,INITIAL_ATLAS_SIZE:256,MAX_ATLAS_SIZE:-1,MOUSEWHEELZOOM_MAXDELTA:1,OVERVIEWMAP_MAX_RATIO:.75,OVERVIEWMAP_MIN_RATIO:.1,RASTER_REPROJECTION_MAX_SOURCE_TILES:100,RASTER_REPROJECTION_MAX_SUBDIVISION:10,RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH:.25,SIMPLIFY_TOLERANCE:.5,WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK:1024,VERSION:"v4.6.4"};_ol_.WEBGL_MAX_TEXTURE_SIZE,_ol_.WEBGL_EXTENSIONS,_ol_.inherits=function(childCtor,parentCtor){childCtor.prototype=Object.create(parentCtor.prototype),childCtor.prototype.constructor=childCtor},_ol_.nullFunction=function(){},_ol_.getUid=function(obj){return obj.ol_uid||(obj.ol_uid=++_ol_.uidCounter_)},_ol_.uidCounter_=0,exports.default=_ol_},{}],90:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _collection2=_interopRequireDefault(require("./collection.js")),_kinetic2=_interopRequireDefault(require("./kinetic.js")),_doubleclickzoom2=_interopRequireDefault(require("./interaction/doubleclickzoom.js")),_dragpan2=_interopRequireDefault(require("./interaction/dragpan.js")),_dragrotate2=_interopRequireDefault(require("./interaction/dragrotate.js")),_dragzoom2=_interopRequireDefault(require("./interaction/dragzoom.js")),_keyboardpan2=_interopRequireDefault(require("./interaction/keyboardpan.js")),_keyboardzoom2=_interopRequireDefault(require("./interaction/keyboardzoom.js")),_mousewheelzoom2=_interopRequireDefault(require("./interaction/mousewheelzoom.js")),_pinchrotate2=_interopRequireDefault(require("./interaction/pinchrotate.js")),_pinchzoom2=_interopRequireDefault(require("./interaction/pinchzoom.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_={defaults:function(opt_options){var options=opt_options||{},interactions=new _collection2.default,kinetic=new _kinetic2.default(-.005,.05,100);return(void 0===options.altShiftDragRotate||options.altShiftDragRotate)&&interactions.push(new _dragrotate2.default),(void 0===options.doubleClickZoom||options.doubleClickZoom)&&interactions.push(new _doubleclickzoom2.default({delta:options.zoomDelta,duration:options.zoomDuration})),(void 0===options.dragPan||options.dragPan)&&interactions.push(new _dragpan2.default({kinetic:kinetic})),(void 0===options.pinchRotate||options.pinchRotate)&&interactions.push(new _pinchrotate2.default),(void 0===options.pinchZoom||options.pinchZoom)&&interactions.push(new _pinchzoom2.default({constrainResolution:options.constrainResolution,duration:options.zoomDuration})),(void 0===options.keyboard||options.keyboard)&&(interactions.push(new _keyboardpan2.default),interactions.push(new _keyboardzoom2.default({delta:options.zoomDelta,duration:options.zoomDuration}))),(void 0===options.mouseWheelZoom||options.mouseWheelZoom)&&interactions.push(new _mousewheelzoom2.default({constrainResolution:options.constrainResolution,duration:options.zoomDuration})),(void 0===options.shiftDragZoom||options.shiftDragZoom)&&interactions.push(new _dragzoom2.default({duration:options.zoomDuration})),interactions}};exports.default=_ol_interaction_},{"./collection.js":34,"./interaction/doubleclickzoom.js":91,"./interaction/dragpan.js":93,"./interaction/dragrotate.js":94,"./interaction/dragzoom.js":95,"./interaction/keyboardpan.js":97,"./interaction/keyboardzoom.js":98,"./interaction/mousewheelzoom.js":99,"./interaction/pinchrotate.js":100,"./interaction/pinchzoom.js":101,"./kinetic.js":104}],91:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_mapbrowsereventtype2=_interopRequireDefault(require("../mapbrowsereventtype.js")),_interaction2=_interopRequireDefault(require("../interaction/interaction.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_DoubleClickZoom_=function(opt_options){var options=opt_options||{};this.delta_=options.delta?options.delta:1,_interaction2.default.call(this,{handleEvent:_ol_interaction_DoubleClickZoom_.handleEvent}),this.duration_=void 0!==options.duration?options.duration:250};_index2.default.inherits(_ol_interaction_DoubleClickZoom_,_interaction2.default),_ol_interaction_DoubleClickZoom_.handleEvent=function(mapBrowserEvent){var stopEvent=!1,browserEvent=mapBrowserEvent.originalEvent;if(mapBrowserEvent.type==_mapbrowsereventtype2.default.DBLCLICK){var map=mapBrowserEvent.map,anchor=mapBrowserEvent.coordinate,delta=browserEvent.shiftKey?-this.delta_:this.delta_,view=map.getView();_interaction2.default.zoomByDelta(view,delta,anchor,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}return!stopEvent},exports.default=_ol_interaction_DoubleClickZoom_},{"../index.js":89,"../interaction/interaction.js":96,"../mapbrowsereventtype.js":118}],92:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _event2=_interopRequireDefault(require("../events/event.js")),_index2=_interopRequireDefault(require("../index.js")),_condition2=_interopRequireDefault(require("../events/condition.js")),_pointer2=_interopRequireDefault(require("../interaction/pointer.js")),_box2=_interopRequireDefault(require("../render/box.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_DragBox_=function(opt_options){_pointer2.default.call(this,{handleDownEvent:_ol_interaction_DragBox_.handleDownEvent_,handleDragEvent:_ol_interaction_DragBox_.handleDragEvent_,handleUpEvent:_ol_interaction_DragBox_.handleUpEvent_});var options=opt_options||{};this.box_=new _box2.default(options.className||"ol-dragbox"),this.minArea_=void 0!==options.minArea?options.minArea:64,this.startPixel_=null,this.condition_=options.condition?options.condition:_condition2.default.always,this.boxEndCondition_=options.boxEndCondition?options.boxEndCondition:_ol_interaction_DragBox_.defaultBoxEndCondition};_index2.default.inherits(_ol_interaction_DragBox_,_pointer2.default),_ol_interaction_DragBox_.defaultBoxEndCondition=function(mapBrowserEvent,startPixel,endPixel){var width=endPixel[0]-startPixel[0],height=endPixel[1]-startPixel[1];return width*width+height*height>=this.minArea_},_ol_interaction_DragBox_.handleDragEvent_=function(mapBrowserEvent){_condition2.default.mouseOnly(mapBrowserEvent)&&(this.box_.setPixels(this.startPixel_,mapBrowserEvent.pixel),this.dispatchEvent(new _ol_interaction_DragBox_.Event(_ol_interaction_DragBox_.EventType_.BOXDRAG,mapBrowserEvent.coordinate,mapBrowserEvent)))},_ol_interaction_DragBox_.prototype.getGeometry=function(){return this.box_.getGeometry()},_ol_interaction_DragBox_.prototype.onBoxEnd=_index2.default.nullFunction,_ol_interaction_DragBox_.handleUpEvent_=function(mapBrowserEvent){return!_condition2.default.mouseOnly(mapBrowserEvent)||(this.box_.setMap(null),this.boxEndCondition_(mapBrowserEvent,this.startPixel_,mapBrowserEvent.pixel)&&(this.onBoxEnd(mapBrowserEvent),this.dispatchEvent(new _ol_interaction_DragBox_.Event(_ol_interaction_DragBox_.EventType_.BOXEND,mapBrowserEvent.coordinate,mapBrowserEvent))),!1)},_ol_interaction_DragBox_.handleDownEvent_=function(mapBrowserEvent){return!!_condition2.default.mouseOnly(mapBrowserEvent)&&(!(!_condition2.default.mouseActionButton(mapBrowserEvent)||!this.condition_(mapBrowserEvent))&&(this.startPixel_=mapBrowserEvent.pixel,this.box_.setMap(mapBrowserEvent.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new _ol_interaction_DragBox_.Event(_ol_interaction_DragBox_.EventType_.BOXSTART,mapBrowserEvent.coordinate,mapBrowserEvent)),!0))},_ol_interaction_DragBox_.EventType_={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"},_ol_interaction_DragBox_.Event=function(type,coordinate,mapBrowserEvent){_event2.default.call(this,type),this.coordinate=coordinate,this.mapBrowserEvent=mapBrowserEvent},_index2.default.inherits(_ol_interaction_DragBox_.Event,_event2.default),exports.default=_ol_interaction_DragBox_},{"../events/condition.js":49,"../events/event.js":50,"../index.js":89,"../interaction/pointer.js":102,"../render/box.js":149}],93:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_viewhint2=_interopRequireDefault(require("../viewhint.js")),_coordinate2=_interopRequireDefault(require("../coordinate.js")),_easing2=_interopRequireDefault(require("../easing.js")),_condition2=_interopRequireDefault(require("../events/condition.js")),_functions2=_interopRequireDefault(require("../functions.js")),_pointer2=_interopRequireDefault(require("../interaction/pointer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_DragPan_=function(opt_options){_pointer2.default.call(this,{handleDownEvent:_ol_interaction_DragPan_.handleDownEvent_,handleDragEvent:_ol_interaction_DragPan_.handleDragEvent_,handleUpEvent:_ol_interaction_DragPan_.handleUpEvent_});var options=opt_options||{};this.kinetic_=options.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.condition_=options.condition?options.condition:_condition2.default.noModifierKeys,this.noKinetic_=!1};_index2.default.inherits(_ol_interaction_DragPan_,_pointer2.default),_ol_interaction_DragPan_.handleDragEvent_=function(mapBrowserEvent){var targetPointers=this.targetPointers,centroid=_pointer2.default.centroid(targetPointers);if(targetPointers.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(centroid[0],centroid[1]),this.lastCentroid){var deltaX=this.lastCentroid[0]-centroid[0],deltaY=centroid[1]-this.lastCentroid[1],view=mapBrowserEvent.map.getView(),viewState=view.getState(),center=[deltaX,deltaY];_coordinate2.default.scale(center,viewState.resolution),_coordinate2.default.rotate(center,viewState.rotation),_coordinate2.default.add(center,viewState.center),center=view.constrainCenter(center),view.setCenter(center)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=centroid,this.lastPointersCount_=targetPointers.length},_ol_interaction_DragPan_.handleUpEvent_=function(mapBrowserEvent){var map=mapBrowserEvent.map,view=map.getView();if(0!==this.targetPointers.length)return this.kinetic_&&this.kinetic_.begin(),!(this.lastCentroid=null);if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var distance=this.kinetic_.getDistance(),angle=this.kinetic_.getAngle(),center=view.getCenter(),centerpx=map.getPixelFromCoordinate(center),dest=map.getCoordinateFromPixel([centerpx[0]-distance*Math.cos(angle),centerpx[1]-distance*Math.sin(angle)]);view.animate({center:view.constrainCenter(dest),duration:500,easing:_easing2.default.easeOut})}return view.setHint(_viewhint2.default.INTERACTING,-1),!1},_ol_interaction_DragPan_.handleDownEvent_=function(mapBrowserEvent){if(0<this.targetPointers.length&&this.condition_(mapBrowserEvent)){var view=mapBrowserEvent.map.getView();return this.lastCentroid=null,this.handlingDownUpSequence||view.setHint(_viewhint2.default.INTERACTING,1),view.getAnimating()&&view.setCenter(mapBrowserEvent.frameState.viewState.center),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=1<this.targetPointers.length,!0}return!1},_ol_interaction_DragPan_.prototype.shouldStopEvent=_functions2.default.FALSE,exports.default=_ol_interaction_DragPan_},{"../coordinate.js":43,"../easing.js":47,"../events/condition.js":49,"../functions.js":60,"../index.js":89,"../interaction/pointer.js":102,"../viewhint.js":246}],94:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_rotationconstraint2=_interopRequireDefault(require("../rotationconstraint.js")),_viewhint2=_interopRequireDefault(require("../viewhint.js")),_condition2=_interopRequireDefault(require("../events/condition.js")),_functions2=_interopRequireDefault(require("../functions.js")),_interaction2=_interopRequireDefault(require("../interaction/interaction.js")),_pointer2=_interopRequireDefault(require("../interaction/pointer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_DragRotate_=function(opt_options){var options=opt_options||{};_pointer2.default.call(this,{handleDownEvent:_ol_interaction_DragRotate_.handleDownEvent_,handleDragEvent:_ol_interaction_DragRotate_.handleDragEvent_,handleUpEvent:_ol_interaction_DragRotate_.handleUpEvent_}),this.condition_=options.condition?options.condition:_condition2.default.altShiftKeysOnly,this.lastAngle_=void 0,this.duration_=void 0!==options.duration?options.duration:250};_index2.default.inherits(_ol_interaction_DragRotate_,_pointer2.default),_ol_interaction_DragRotate_.handleDragEvent_=function(mapBrowserEvent){if(_condition2.default.mouseOnly(mapBrowserEvent)){var map=mapBrowserEvent.map,view=map.getView();if(view.getConstraints().rotation!==_rotationconstraint2.default.disable){var size=map.getSize(),offset=mapBrowserEvent.pixel,theta=Math.atan2(size[1]/2-offset[1],offset[0]-size[0]/2);if(void 0!==this.lastAngle_){var delta=theta-this.lastAngle_,rotation=view.getRotation();_interaction2.default.rotateWithoutConstraints(view,rotation-delta)}this.lastAngle_=theta}}},_ol_interaction_DragRotate_.handleUpEvent_=function(mapBrowserEvent){if(!_condition2.default.mouseOnly(mapBrowserEvent))return!0;var view=mapBrowserEvent.map.getView();view.setHint(_viewhint2.default.INTERACTING,-1);var rotation=view.getRotation();return _interaction2.default.rotate(view,rotation,void 0,this.duration_),!1},_ol_interaction_DragRotate_.handleDownEvent_=function(mapBrowserEvent){return!!_condition2.default.mouseOnly(mapBrowserEvent)&&(!(!_condition2.default.mouseActionButton(mapBrowserEvent)||!this.condition_(mapBrowserEvent))&&(mapBrowserEvent.map.getView().setHint(_viewhint2.default.INTERACTING,1),!(this.lastAngle_=void 0)))},_ol_interaction_DragRotate_.prototype.shouldStopEvent=_functions2.default.FALSE,exports.default=_ol_interaction_DragRotate_},{"../events/condition.js":49,"../functions.js":60,"../index.js":89,"../interaction/interaction.js":96,"../interaction/pointer.js":102,"../rotationconstraint.js":207,"../viewhint.js":246}],95:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_easing2=_interopRequireDefault(require("../easing.js")),_condition2=_interopRequireDefault(require("../events/condition.js")),_extent2=_interopRequireDefault(require("../extent.js")),_dragbox2=_interopRequireDefault(require("../interaction/dragbox.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_DragZoom_=function(opt_options){var options=opt_options||{},condition=options.condition?options.condition:_condition2.default.shiftKeyOnly;this.duration_=void 0!==options.duration?options.duration:200,this.out_=void 0!==options.out&&options.out,_dragbox2.default.call(this,{condition:condition,className:options.className||"ol-dragzoom"})};_index2.default.inherits(_ol_interaction_DragZoom_,_dragbox2.default),_ol_interaction_DragZoom_.prototype.onBoxEnd=function(){var map=this.getMap(),view=map.getView(),size=map.getSize(),extent=this.getGeometry().getExtent();if(this.out_){var mapExtent=view.calculateExtent(size),boxPixelExtent=_extent2.default.createOrUpdateFromCoordinates([map.getPixelFromCoordinate(_extent2.default.getBottomLeft(extent)),map.getPixelFromCoordinate(_extent2.default.getTopRight(extent))]),factor=view.getResolutionForExtent(boxPixelExtent,size);_extent2.default.scaleFromCenter(mapExtent,1/factor),extent=mapExtent}var resolution=view.constrainResolution(view.getResolutionForExtent(extent,size)),center=_extent2.default.getCenter(extent);center=view.constrainCenter(center),view.animate({resolution:resolution,center:center,duration:this.duration_,easing:_easing2.default.easeOut})},exports.default=_ol_interaction_DragZoom_},{"../easing.js":47,"../events/condition.js":49,"../extent.js":54,"../index.js":89,"../interaction/dragbox.js":92}],96:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_object2=_interopRequireDefault(require("../object.js")),_easing2=_interopRequireDefault(require("../easing.js")),_property2=_interopRequireDefault(require("../interaction/property.js")),_math2=_interopRequireDefault(require("../math.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_Interaction_=function(options){_object2.default.call(this),this.map_=null,this.setActive(!0),this.handleEvent=options.handleEvent};_index2.default.inherits(_ol_interaction_Interaction_,_object2.default),_ol_interaction_Interaction_.prototype.getActive=function(){return this.get(_property2.default.ACTIVE)},_ol_interaction_Interaction_.prototype.getMap=function(){return this.map_},_ol_interaction_Interaction_.prototype.setActive=function(active){this.set(_property2.default.ACTIVE,active)},_ol_interaction_Interaction_.prototype.setMap=function(map){this.map_=map},_ol_interaction_Interaction_.pan=function(view,delta,opt_duration){var currentCenter=view.getCenter();if(currentCenter){var center=view.constrainCenter([currentCenter[0]+delta[0],currentCenter[1]+delta[1]]);opt_duration?view.animate({duration:opt_duration,easing:_easing2.default.linear,center:center}):view.setCenter(center)}},_ol_interaction_Interaction_.rotate=function(view,rotation,opt_anchor,opt_duration){rotation=view.constrainRotation(rotation,0),_ol_interaction_Interaction_.rotateWithoutConstraints(view,rotation,opt_anchor,opt_duration)},_ol_interaction_Interaction_.rotateWithoutConstraints=function(view,rotation,opt_anchor,opt_duration){if(void 0!==rotation){var currentRotation=view.getRotation(),currentCenter=view.getCenter();void 0!==currentRotation&&currentCenter&&0<opt_duration?view.animate({rotation:rotation,anchor:opt_anchor,duration:opt_duration,easing:_easing2.default.easeOut}):view.rotate(rotation,opt_anchor)}},_ol_interaction_Interaction_.zoom=function(view,resolution,opt_anchor,opt_duration,opt_direction){resolution=view.constrainResolution(resolution,0,opt_direction),_ol_interaction_Interaction_.zoomWithoutConstraints(view,resolution,opt_anchor,opt_duration)},_ol_interaction_Interaction_.zoomByDelta=function(view,delta,opt_anchor,opt_duration){var currentResolution=view.getResolution(),resolution=view.constrainResolution(currentResolution,delta,0);if(void 0!==resolution){var resolutions=view.getResolutions();resolution=_math2.default.clamp(resolution,view.getMinResolution()||resolutions[resolutions.length-1],view.getMaxResolution()||resolutions[0])}if(opt_anchor&&void 0!==resolution&&resolution!==currentResolution){var currentCenter=view.getCenter(),center=view.calculateCenterZoom(resolution,opt_anchor);center=view.constrainCenter(center),opt_anchor=[(resolution*currentCenter[0]-currentResolution*center[0])/(resolution-currentResolution),(resolution*currentCenter[1]-currentResolution*center[1])/(resolution-currentResolution)]}_ol_interaction_Interaction_.zoomWithoutConstraints(view,resolution,opt_anchor,opt_duration)},_ol_interaction_Interaction_.zoomWithoutConstraints=function(view,resolution,opt_anchor,opt_duration){if(resolution){var currentResolution=view.getResolution(),currentCenter=view.getCenter();if(void 0!==currentResolution&&currentCenter&&resolution!==currentResolution&&opt_duration)view.animate({resolution:resolution,anchor:opt_anchor,duration:opt_duration,easing:_easing2.default.easeOut});else{if(opt_anchor){var center=view.calculateCenterZoom(resolution,opt_anchor);view.setCenter(center)}view.setResolution(resolution)}}},exports.default=_ol_interaction_Interaction_},{"../easing.js":47,"../index.js":89,"../interaction/property.js":103,"../math.js":123,"../object.js":125}],97:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_coordinate2=_interopRequireDefault(require("../coordinate.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_keycode2=_interopRequireDefault(require("../events/keycode.js")),_condition2=_interopRequireDefault(require("../events/condition.js")),_interaction2=_interopRequireDefault(require("../interaction/interaction.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_KeyboardPan_=function(opt_options){_interaction2.default.call(this,{handleEvent:_ol_interaction_KeyboardPan_.handleEvent});var options=opt_options||{};this.defaultCondition_=function(mapBrowserEvent){return _condition2.default.noModifierKeys(mapBrowserEvent)&&_condition2.default.targetNotEditable(mapBrowserEvent)},this.condition_=void 0!==options.condition?options.condition:this.defaultCondition_,this.duration_=void 0!==options.duration?options.duration:100,this.pixelDelta_=void 0!==options.pixelDelta?options.pixelDelta:128};_index2.default.inherits(_ol_interaction_KeyboardPan_,_interaction2.default),_ol_interaction_KeyboardPan_.handleEvent=function(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==_eventtype2.default.KEYDOWN){var keyCode=mapBrowserEvent.originalEvent.keyCode;if(this.condition_(mapBrowserEvent)&&(keyCode==_keycode2.default.DOWN||keyCode==_keycode2.default.LEFT||keyCode==_keycode2.default.RIGHT||keyCode==_keycode2.default.UP)){var view=mapBrowserEvent.map.getView(),mapUnitsDelta=view.getResolution()*this.pixelDelta_,deltaX=0,deltaY=0;keyCode==_keycode2.default.DOWN?deltaY=-mapUnitsDelta:keyCode==_keycode2.default.LEFT?deltaX=-mapUnitsDelta:keyCode==_keycode2.default.RIGHT?deltaX=mapUnitsDelta:deltaY=mapUnitsDelta;var delta=[deltaX,deltaY];_coordinate2.default.rotate(delta,view.getRotation()),_interaction2.default.pan(view,delta,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}}return!stopEvent},exports.default=_ol_interaction_KeyboardPan_},{"../coordinate.js":43,"../events/condition.js":49,"../events/eventtype.js":52,"../events/keycode.js":53,"../index.js":89,"../interaction/interaction.js":96}],98:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_condition2=_interopRequireDefault(require("../events/condition.js")),_interaction2=_interopRequireDefault(require("../interaction/interaction.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_KeyboardZoom_=function(opt_options){_interaction2.default.call(this,{handleEvent:_ol_interaction_KeyboardZoom_.handleEvent});var options=opt_options||{};this.condition_=options.condition?options.condition:_condition2.default.targetNotEditable,this.delta_=options.delta?options.delta:1,this.duration_=void 0!==options.duration?options.duration:100};_index2.default.inherits(_ol_interaction_KeyboardZoom_,_interaction2.default),_ol_interaction_KeyboardZoom_.handleEvent=function(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==_eventtype2.default.KEYDOWN||mapBrowserEvent.type==_eventtype2.default.KEYPRESS){var charCode=mapBrowserEvent.originalEvent.charCode;if(this.condition_(mapBrowserEvent)&&(charCode=="+".charCodeAt(0)||charCode=="-".charCodeAt(0))){var map=mapBrowserEvent.map,delta=charCode=="+".charCodeAt(0)?this.delta_:-this.delta_,view=map.getView();_interaction2.default.zoomByDelta(view,delta,void 0,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}}return!stopEvent},exports.default=_ol_interaction_KeyboardZoom_},{"../events/condition.js":49,"../events/eventtype.js":52,"../index.js":89,"../interaction/interaction.js":96}],99:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_viewhint2=_interopRequireDefault(require("../viewhint.js")),_easing2=_interopRequireDefault(require("../easing.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_has2=_interopRequireDefault(require("../has.js")),_interaction2=_interopRequireDefault(require("../interaction/interaction.js")),_math2=_interopRequireDefault(require("../math.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_MouseWheelZoom_=function(opt_options){_interaction2.default.call(this,{handleEvent:_ol_interaction_MouseWheelZoom_.handleEvent});var options=opt_options||{};this.delta_=0,this.duration_=void 0!==options.duration?options.duration:250,this.timeout_=void 0!==options.timeout?options.timeout:80,this.useAnchor_=void 0===options.useAnchor||options.useAnchor,this.constrainResolution_=options.constrainResolution||!1,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_=void 0,this.trackpadDeltaPerZoom_=300,this.trackpadZoomBuffer_=1.5};_index2.default.inherits(_ol_interaction_MouseWheelZoom_,_interaction2.default),_ol_interaction_MouseWheelZoom_.handleEvent=function(mapBrowserEvent){var type=mapBrowserEvent.type;if(type!==_eventtype2.default.WHEEL&&type!==_eventtype2.default.MOUSEWHEEL)return!0;mapBrowserEvent.preventDefault();var delta,map=mapBrowserEvent.map,wheelEvent=mapBrowserEvent.originalEvent;if(this.useAnchor_&&(this.lastAnchor_=mapBrowserEvent.coordinate),mapBrowserEvent.type==_eventtype2.default.WHEEL?(delta=wheelEvent.deltaY,_has2.default.FIREFOX&&wheelEvent.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(delta/=_has2.default.DEVICE_PIXEL_RATIO),wheelEvent.deltaMode===WheelEvent.DOM_DELTA_LINE&&(delta*=40)):mapBrowserEvent.type==_eventtype2.default.MOUSEWHEEL&&(delta=-wheelEvent.wheelDeltaY,_has2.default.SAFARI&&(delta/=3)),0===delta)return!1;var now=Date.now();if(void 0===this.startTime_&&(this.startTime_=now),(!this.mode_||now-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(delta)<4?_ol_interaction_MouseWheelZoom_.Mode_.TRACKPAD:_ol_interaction_MouseWheelZoom_.Mode_.WHEEL),this.mode_===_ol_interaction_MouseWheelZoom_.Mode_.TRACKPAD){var view=map.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):view.setHint(_viewhint2.default.INTERACTING,1),this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);var resolution=view.getResolution()*Math.pow(2,delta/this.trackpadDeltaPerZoom_),minResolution=view.getMinResolution(),maxResolution=view.getMaxResolution(),rebound=0;if(resolution<minResolution?(resolution=Math.max(resolution,minResolution/this.trackpadZoomBuffer_),rebound=1):maxResolution<resolution&&(resolution=Math.min(resolution,maxResolution*this.trackpadZoomBuffer_),rebound=-1),this.lastAnchor_){var center=view.calculateCenterZoom(resolution,this.lastAnchor_);view.setCenter(view.constrainCenter(center))}return view.setResolution(resolution),0===rebound&&this.constrainResolution_&&view.animate({resolution:view.constrainResolution(resolution,0<delta?-1:1),easing:_easing2.default.easeOut,anchor:this.lastAnchor_,duration:this.duration_}),0<rebound?view.animate({resolution:minResolution,easing:_easing2.default.easeOut,anchor:this.lastAnchor_,duration:500}):rebound<0&&view.animate({resolution:maxResolution,easing:_easing2.default.easeOut,anchor:this.lastAnchor_,duration:500}),this.startTime_=now,!1}this.delta_+=delta;var timeLeft=Math.max(this.timeout_-(now-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,map),timeLeft),!1},_ol_interaction_MouseWheelZoom_.prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().setHint(_viewhint2.default.INTERACTING,-1)},_ol_interaction_MouseWheelZoom_.prototype.handleWheelZoom_=function(map){var view=map.getView();view.getAnimating()&&view.cancelAnimations();var maxDelta=_index2.default.MOUSEWHEELZOOM_MAXDELTA,delta=_math2.default.clamp(this.delta_,-maxDelta,maxDelta);_interaction2.default.zoomByDelta(view,-delta,this.lastAnchor_,this.duration_),this.mode_=void 0,this.delta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},_ol_interaction_MouseWheelZoom_.prototype.setMouseAnchor=function(useAnchor){(this.useAnchor_=useAnchor)||(this.lastAnchor_=null)},_ol_interaction_MouseWheelZoom_.Mode_={TRACKPAD:"trackpad",WHEEL:"wheel"},exports.default=_ol_interaction_MouseWheelZoom_},{"../easing.js":47,"../events/eventtype.js":52,"../has.js":84,"../index.js":89,"../interaction/interaction.js":96,"../math.js":123,"../viewhint.js":246}],100:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_viewhint2=_interopRequireDefault(require("../viewhint.js")),_functions2=_interopRequireDefault(require("../functions.js")),_interaction2=_interopRequireDefault(require("../interaction/interaction.js")),_pointer2=_interopRequireDefault(require("../interaction/pointer.js")),_rotationconstraint2=_interopRequireDefault(require("../rotationconstraint.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_PinchRotate_=function(opt_options){_pointer2.default.call(this,{handleDownEvent:_ol_interaction_PinchRotate_.handleDownEvent_,handleDragEvent:_ol_interaction_PinchRotate_.handleDragEvent_,handleUpEvent:_ol_interaction_PinchRotate_.handleUpEvent_});var options=opt_options||{};this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==options.threshold?options.threshold:.3,this.duration_=void 0!==options.duration?options.duration:250};_index2.default.inherits(_ol_interaction_PinchRotate_,_pointer2.default),_ol_interaction_PinchRotate_.handleDragEvent_=function(mapBrowserEvent){var rotationDelta=0,touch0=this.targetPointers[0],touch1=this.targetPointers[1],angle=Math.atan2(touch1.clientY-touch0.clientY,touch1.clientX-touch0.clientX);if(void 0!==this.lastAngle_){var delta=angle-this.lastAngle_;this.rotationDelta_+=delta,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),rotationDelta=delta}this.lastAngle_=angle;var map=mapBrowserEvent.map,view=map.getView();if(view.getConstraints().rotation!==_rotationconstraint2.default.disable){var viewportPosition=map.getViewport().getBoundingClientRect(),centroid=_pointer2.default.centroid(this.targetPointers);if(centroid[0]-=viewportPosition.left,centroid[1]-=viewportPosition.top,this.anchor_=map.getCoordinateFromPixel(centroid),this.rotating_){var rotation=view.getRotation();map.render(),_interaction2.default.rotateWithoutConstraints(view,rotation+rotationDelta,this.anchor_)}}},_ol_interaction_PinchRotate_.handleUpEvent_=function(mapBrowserEvent){if(this.targetPointers.length<2){var view=mapBrowserEvent.map.getView();if(view.setHint(_viewhint2.default.INTERACTING,-1),this.rotating_){var rotation=view.getRotation();_interaction2.default.rotate(view,rotation,this.anchor_,this.duration_)}return!1}return!0},_ol_interaction_PinchRotate_.handleDownEvent_=function(mapBrowserEvent){if(2<=this.targetPointers.length){var map=mapBrowserEvent.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||map.getView().setHint(_viewhint2.default.INTERACTING,1),!0}return!1},_ol_interaction_PinchRotate_.prototype.shouldStopEvent=_functions2.default.FALSE,exports.default=_ol_interaction_PinchRotate_},{"../functions.js":60,"../index.js":89,"../interaction/interaction.js":96,"../interaction/pointer.js":102,"../rotationconstraint.js":207,"../viewhint.js":246}],101:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_viewhint2=_interopRequireDefault(require("../viewhint.js")),_functions2=_interopRequireDefault(require("../functions.js")),_interaction2=_interopRequireDefault(require("../interaction/interaction.js")),_pointer2=_interopRequireDefault(require("../interaction/pointer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_PinchZoom_=function(opt_options){_pointer2.default.call(this,{handleDownEvent:_ol_interaction_PinchZoom_.handleDownEvent_,handleDragEvent:_ol_interaction_PinchZoom_.handleDragEvent_,handleUpEvent:_ol_interaction_PinchZoom_.handleUpEvent_});var options=opt_options||{};this.constrainResolution_=options.constrainResolution||!1,this.anchor_=null,this.duration_=void 0!==options.duration?options.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1};_index2.default.inherits(_ol_interaction_PinchZoom_,_pointer2.default),_ol_interaction_PinchZoom_.handleDragEvent_=function(mapBrowserEvent){var scaleDelta=1,touch0=this.targetPointers[0],touch1=this.targetPointers[1],dx=touch0.clientX-touch1.clientX,dy=touch0.clientY-touch1.clientY,distance=Math.sqrt(dx*dx+dy*dy);void 0!==this.lastDistance_&&(scaleDelta=this.lastDistance_/distance),this.lastDistance_=distance;var map=mapBrowserEvent.map,view=map.getView(),resolution=view.getResolution(),maxResolution=view.getMaxResolution(),minResolution=view.getMinResolution(),newResolution=resolution*scaleDelta;maxResolution<newResolution?(scaleDelta=maxResolution/resolution,newResolution=maxResolution):newResolution<minResolution&&(scaleDelta=minResolution/resolution,newResolution=minResolution),1!=scaleDelta&&(this.lastScaleDelta_=scaleDelta);var viewportPosition=map.getViewport().getBoundingClientRect(),centroid=_pointer2.default.centroid(this.targetPointers);centroid[0]-=viewportPosition.left,centroid[1]-=viewportPosition.top,this.anchor_=map.getCoordinateFromPixel(centroid),map.render(),_interaction2.default.zoomWithoutConstraints(view,newResolution,this.anchor_)},_ol_interaction_PinchZoom_.handleUpEvent_=function(mapBrowserEvent){if(this.targetPointers.length<2){var view=mapBrowserEvent.map.getView();view.setHint(_viewhint2.default.INTERACTING,-1);var resolution=view.getResolution();if(this.constrainResolution_||resolution<view.getMinResolution()||resolution>view.getMaxResolution()){var direction=this.lastScaleDelta_-1;_interaction2.default.zoom(view,resolution,this.anchor_,this.duration_,direction)}return!1}return!0},_ol_interaction_PinchZoom_.handleDownEvent_=function(mapBrowserEvent){if(2<=this.targetPointers.length){var map=mapBrowserEvent.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||map.getView().setHint(_viewhint2.default.INTERACTING,1),!0}return!1},_ol_interaction_PinchZoom_.prototype.shouldStopEvent=_functions2.default.FALSE,exports.default=_ol_interaction_PinchZoom_},{"../functions.js":60,"../index.js":89,"../interaction/interaction.js":96,"../interaction/pointer.js":102,"../viewhint.js":246}],102:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_functions2=_interopRequireDefault(require("../functions.js")),_mapbrowsereventtype2=_interopRequireDefault(require("../mapbrowsereventtype.js")),_mapbrowserpointerevent2=_interopRequireDefault(require("../mapbrowserpointerevent.js")),_interaction2=_interopRequireDefault(require("../interaction/interaction.js")),_obj2=_interopRequireDefault(require("../obj.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_interaction_Pointer_=function(opt_options){var options=opt_options||{},handleEvent=options.handleEvent?options.handleEvent:_ol_interaction_Pointer_.handleEvent;_interaction2.default.call(this,{handleEvent:handleEvent}),this.handleDownEvent_=options.handleDownEvent?options.handleDownEvent:_ol_interaction_Pointer_.handleDownEvent,this.handleDragEvent_=options.handleDragEvent?options.handleDragEvent:_ol_interaction_Pointer_.handleDragEvent,this.handleMoveEvent_=options.handleMoveEvent?options.handleMoveEvent:_ol_interaction_Pointer_.handleMoveEvent,this.handleUpEvent_=options.handleUpEvent?options.handleUpEvent:_ol_interaction_Pointer_.handleUpEvent,this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]};_index2.default.inherits(_ol_interaction_Pointer_,_interaction2.default),_ol_interaction_Pointer_.centroid=function(pointerEvents){for(var length=pointerEvents.length,clientX=0,clientY=0,i=0;i<length;i++)clientX+=pointerEvents[i].clientX,clientY+=pointerEvents[i].clientY;return[clientX/length,clientY/length]},_ol_interaction_Pointer_.prototype.isPointerDraggingEvent_=function(mapBrowserEvent){var type=mapBrowserEvent.type;return type===_mapbrowsereventtype2.default.POINTERDOWN||type===_mapbrowsereventtype2.default.POINTERDRAG||type===_mapbrowsereventtype2.default.POINTERUP},_ol_interaction_Pointer_.prototype.updateTrackedPointers_=function(mapBrowserEvent){if(this.isPointerDraggingEvent_(mapBrowserEvent)){var event=mapBrowserEvent.pointerEvent,id=event.pointerId.toString();mapBrowserEvent.type==_mapbrowsereventtype2.default.POINTERUP?delete this.trackedPointers_[id]:mapBrowserEvent.type==_mapbrowsereventtype2.default.POINTERDOWN?this.trackedPointers_[id]=event:id in this.trackedPointers_&&(this.trackedPointers_[id]=event),this.targetPointers=_obj2.default.getValues(this.trackedPointers_)}},_ol_interaction_Pointer_.handleDragEvent=_index2.default.nullFunction,_ol_interaction_Pointer_.handleUpEvent=_functions2.default.FALSE,_ol_interaction_Pointer_.handleDownEvent=_functions2.default.FALSE,_ol_interaction_Pointer_.handleMoveEvent=_index2.default.nullFunction,_ol_interaction_Pointer_.handleEvent=function(mapBrowserEvent){if(!(mapBrowserEvent instanceof _mapbrowserpointerevent2.default))return!0;var stopEvent=!1;if(this.updateTrackedPointers_(mapBrowserEvent),this.handlingDownUpSequence){if(mapBrowserEvent.type==_mapbrowsereventtype2.default.POINTERDRAG)this.handleDragEvent_(mapBrowserEvent);else if(mapBrowserEvent.type==_mapbrowsereventtype2.default.POINTERUP){var handledUp=this.handleUpEvent_(mapBrowserEvent);this.handlingDownUpSequence=handledUp&&0<this.targetPointers.length}}else if(mapBrowserEvent.type==_mapbrowsereventtype2.default.POINTERDOWN){var handled=this.handleDownEvent_(mapBrowserEvent);this.handlingDownUpSequence=handled,stopEvent=this.shouldStopEvent(handled)}else mapBrowserEvent.type==_mapbrowsereventtype2.default.POINTERMOVE&&this.handleMoveEvent_(mapBrowserEvent);return!stopEvent},_ol_interaction_Pointer_.prototype.shouldStopEvent=function(handled){return handled},exports.default=_ol_interaction_Pointer_},{"../functions.js":60,"../index.js":89,"../interaction/interaction.js":96,"../mapbrowsereventtype.js":118,"../mapbrowserpointerevent.js":119,"../obj.js":124}],103:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={ACTIVE:"active"}},{}],104:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_Kinetic_=function(decay,minVelocity,delay){this.decay_=decay,this.minVelocity_=minVelocity,this.delay_=delay,this.points_=[],this.angle_=0,this.initialVelocity_=0};_ol_Kinetic_.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},_ol_Kinetic_.prototype.update=function(x,y){this.points_.push(x,y,Date.now())},_ol_Kinetic_.prototype.end=function(){if(this.points_.length<6)return!1;var delay=Date.now()-this.delay_,lastIndex=this.points_.length-3;if(this.points_[lastIndex+2]<delay)return!1;for(var firstIndex=lastIndex-3;0<firstIndex&&this.points_[firstIndex+2]>delay;)firstIndex-=3;var duration=this.points_[lastIndex+2]-this.points_[firstIndex+2];if(duration<1e3/60)return!1;var dx=this.points_[lastIndex]-this.points_[firstIndex],dy=this.points_[lastIndex+1]-this.points_[firstIndex+1];return this.angle_=Math.atan2(dy,dx),this.initialVelocity_=Math.sqrt(dx*dx+dy*dy)/duration,this.initialVelocity_>this.minVelocity_},_ol_Kinetic_.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},_ol_Kinetic_.prototype.getAngle=function(){return this.angle_},exports.default=_ol_Kinetic_},{}],105:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_object2=_interopRequireDefault(require("../object.js")),_property2=_interopRequireDefault(require("../layer/property.js")),_math2=_interopRequireDefault(require("../math.js")),_obj2=_interopRequireDefault(require("../obj.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_layer_Base_=function(options){_object2.default.call(this);var properties=_obj2.default.assign({},options);properties[_property2.default.OPACITY]=void 0!==options.opacity?options.opacity:1,properties[_property2.default.VISIBLE]=void 0===options.visible||options.visible,properties[_property2.default.Z_INDEX]=void 0!==options.zIndex?options.zIndex:0,properties[_property2.default.MAX_RESOLUTION]=void 0!==options.maxResolution?options.maxResolution:1/0,properties[_property2.default.MIN_RESOLUTION]=void 0!==options.minResolution?options.minResolution:0,this.setProperties(properties),this.state_={layer:this,managed:!0},this.type};_index2.default.inherits(_ol_layer_Base_,_object2.default),_ol_layer_Base_.prototype.getType=function(){return this.type},_ol_layer_Base_.prototype.getLayerState=function(){return this.state_.opacity=_math2.default.clamp(this.getOpacity(),0,1),this.state_.sourceState=this.getSourceState(),this.state_.visible=this.getVisible(),this.state_.extent=this.getExtent(),this.state_.zIndex=this.getZIndex(),this.state_.maxResolution=this.getMaxResolution(),this.state_.minResolution=Math.max(this.getMinResolution(),0),this.state_},_ol_layer_Base_.prototype.getLayersArray=function(opt_array){},_ol_layer_Base_.prototype.getLayerStatesArray=function(opt_states){},_ol_layer_Base_.prototype.getExtent=function(){return this.get(_property2.default.EXTENT)},_ol_layer_Base_.prototype.getMaxResolution=function(){return this.get(_property2.default.MAX_RESOLUTION)},_ol_layer_Base_.prototype.getMinResolution=function(){return this.get(_property2.default.MIN_RESOLUTION)},_ol_layer_Base_.prototype.getOpacity=function(){return this.get(_property2.default.OPACITY)},_ol_layer_Base_.prototype.getSourceState=function(){},_ol_layer_Base_.prototype.getVisible=function(){return this.get(_property2.default.VISIBLE)},_ol_layer_Base_.prototype.getZIndex=function(){return this.get(_property2.default.Z_INDEX)},_ol_layer_Base_.prototype.setExtent=function(extent){this.set(_property2.default.EXTENT,extent)},_ol_layer_Base_.prototype.setMaxResolution=function(maxResolution){this.set(_property2.default.MAX_RESOLUTION,maxResolution)},_ol_layer_Base_.prototype.setMinResolution=function(minResolution){this.set(_property2.default.MIN_RESOLUTION,minResolution)},_ol_layer_Base_.prototype.setOpacity=function(opacity){this.set(_property2.default.OPACITY,opacity)},_ol_layer_Base_.prototype.setVisible=function(visible){this.set(_property2.default.VISIBLE,visible)},_ol_layer_Base_.prototype.setZIndex=function(zindex){this.set(_property2.default.Z_INDEX,zindex)},exports.default=_ol_layer_Base_},{"../index.js":89,"../layer/property.js":109,"../math.js":123,"../obj.js":124,"../object.js":125}],106:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_collection2=_interopRequireDefault(require("../collection.js")),_collectioneventtype2=_interopRequireDefault(require("../collectioneventtype.js")),_object2=_interopRequireDefault(require("../object.js")),_objecteventtype2=_interopRequireDefault(require("../objecteventtype.js")),_asserts2=_interopRequireDefault(require("../asserts.js")),_events2=_interopRequireDefault(require("../events.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_extent2=_interopRequireDefault(require("../extent.js")),_base2=_interopRequireDefault(require("../layer/base.js")),_obj2=_interopRequireDefault(require("../obj.js")),_state2=_interopRequireDefault(require("../source/state.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_layer_Group_=function(opt_options){var options=opt_options||{},baseOptions=_obj2.default.assign({},options);delete baseOptions.layers;var layers=options.layers;_base2.default.call(this,baseOptions),this.layersListenerKeys_=[],this.listenerKeys_={},_events2.default.listen(this,_object2.default.getChangeEventType(_ol_layer_Group_.Property_.LAYERS),this.handleLayersChanged_,this),layers=layers?Array.isArray(layers)?new _collection2.default(layers.slice(),{unique:!0}):(_asserts2.default.assert(layers instanceof _collection2.default,43),layers):new _collection2.default(void 0,{unique:!0}),this.setLayers(layers)};_index2.default.inherits(_ol_layer_Group_,_base2.default),_ol_layer_Group_.prototype.handleLayerChange_=function(){this.changed()},_ol_layer_Group_.prototype.handleLayersChanged_=function(event){this.layersListenerKeys_.forEach(_events2.default.unlistenByKey),this.layersListenerKeys_.length=0;var layers=this.getLayers();for(var id in this.layersListenerKeys_.push(_events2.default.listen(layers,_collectioneventtype2.default.ADD,this.handleLayersAdd_,this),_events2.default.listen(layers,_collectioneventtype2.default.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[id].forEach(_events2.default.unlistenByKey);_obj2.default.clear(this.listenerKeys_);var i,ii,layer,layersArray=layers.getArray();for(i=0,ii=layersArray.length;i<ii;i++)layer=layersArray[i],this.listenerKeys_[_index2.default.getUid(layer).toString()]=[_events2.default.listen(layer,_objecteventtype2.default.PROPERTYCHANGE,this.handleLayerChange_,this),_events2.default.listen(layer,_eventtype2.default.CHANGE,this.handleLayerChange_,this)];this.changed()},_ol_layer_Group_.prototype.handleLayersAdd_=function(collectionEvent){var layer=collectionEvent.element,key=_index2.default.getUid(layer).toString();this.listenerKeys_[key]=[_events2.default.listen(layer,_objecteventtype2.default.PROPERTYCHANGE,this.handleLayerChange_,this),_events2.default.listen(layer,_eventtype2.default.CHANGE,this.handleLayerChange_,this)],this.changed()},_ol_layer_Group_.prototype.handleLayersRemove_=function(collectionEvent){var layer=collectionEvent.element,key=_index2.default.getUid(layer).toString();this.listenerKeys_[key].forEach(_events2.default.unlistenByKey),delete this.listenerKeys_[key],this.changed()},_ol_layer_Group_.prototype.getLayers=function(){return this.get(_ol_layer_Group_.Property_.LAYERS)},_ol_layer_Group_.prototype.setLayers=function(layers){this.set(_ol_layer_Group_.Property_.LAYERS,layers)},_ol_layer_Group_.prototype.getLayersArray=function(opt_array){var array=void 0!==opt_array?opt_array:[];return this.getLayers().forEach(function(layer){layer.getLayersArray(array)}),array},_ol_layer_Group_.prototype.getLayerStatesArray=function(opt_states){var states=void 0!==opt_states?opt_states:[],pos=states.length;this.getLayers().forEach(function(layer){layer.getLayerStatesArray(states)});var i,ii,layerState,ownLayerState=this.getLayerState();for(i=pos,ii=states.length;i<ii;i++)(layerState=states[i]).opacity*=ownLayerState.opacity,layerState.visible=layerState.visible&&ownLayerState.visible,layerState.maxResolution=Math.min(layerState.maxResolution,ownLayerState.maxResolution),layerState.minResolution=Math.max(layerState.minResolution,ownLayerState.minResolution),void 0!==ownLayerState.extent&&(void 0!==layerState.extent?layerState.extent=_extent2.default.getIntersection(layerState.extent,ownLayerState.extent):layerState.extent=ownLayerState.extent);return states},_ol_layer_Group_.prototype.getSourceState=function(){return _state2.default.READY},_ol_layer_Group_.Property_={LAYERS:"layers"},exports.default=_ol_layer_Group_},{"../asserts.js":31,"../collection.js":34,"../collectioneventtype.js":35,"../events.js":48,"../events/eventtype.js":52,"../extent.js":54,"../index.js":89,"../layer/base.js":105,"../obj.js":124,"../object.js":125,"../objecteventtype.js":126,"../source/state.js":212}],107:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_layertype2=_interopRequireDefault(require("../layertype.js")),_layer2=_interopRequireDefault(require("../layer/layer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_layer_Image_=function(opt_options){var options=opt_options||{};_layer2.default.call(this,options),this.type=_layertype2.default.IMAGE};_index2.default.inherits(_ol_layer_Image_,_layer2.default),exports.default=_ol_layer_Image_},{"../index.js":89,"../layer/layer.js":108,"../layertype.js":113}],108:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _events2=_interopRequireDefault(require("../events.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_index2=_interopRequireDefault(require("../index.js")),_object2=_interopRequireDefault(require("../object.js")),_base2=_interopRequireDefault(require("../layer/base.js")),_property2=_interopRequireDefault(require("../layer/property.js")),_obj2=_interopRequireDefault(require("../obj.js")),_eventtype4=_interopRequireDefault(require("../render/eventtype.js")),_state2=_interopRequireDefault(require("../source/state.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_layer_Layer_=function(options){var baseOptions=_obj2.default.assign({},options);delete baseOptions.source,_base2.default.call(this,baseOptions),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,options.map&&this.setMap(options.map),_events2.default.listen(this,_object2.default.getChangeEventType(_property2.default.SOURCE),this.handleSourcePropertyChange_,this);var source=options.source?options.source:null;this.setSource(source)};_index2.default.inherits(_ol_layer_Layer_,_base2.default),_ol_layer_Layer_.visibleAtResolution=function(layerState,resolution){return layerState.visible&&resolution>=layerState.minResolution&&resolution<layerState.maxResolution},_ol_layer_Layer_.prototype.getLayersArray=function(opt_array){var array=opt_array||[];return array.push(this),array},_ol_layer_Layer_.prototype.getLayerStatesArray=function(opt_states){var states=opt_states||[];return states.push(this.getLayerState()),states},_ol_layer_Layer_.prototype.getSource=function(){return this.get(_property2.default.SOURCE)||null},_ol_layer_Layer_.prototype.getSourceState=function(){var source=this.getSource();return source?source.getState():_state2.default.UNDEFINED},_ol_layer_Layer_.prototype.handleSourceChange_=function(){this.changed()},_ol_layer_Layer_.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(_events2.default.unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null);var source=this.getSource();source&&(this.sourceChangeKey_=_events2.default.listen(source,_eventtype2.default.CHANGE,this.handleSourceChange_,this)),this.changed()},_ol_layer_Layer_.prototype.setMap=function(map){this.mapPrecomposeKey_&&(_events2.default.unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),map||this.changed(),this.mapRenderKey_&&(_events2.default.unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),map&&(this.mapPrecomposeKey_=_events2.default.listen(map,_eventtype4.default.PRECOMPOSE,function(evt){var layerState=this.getLayerState();layerState.managed=!1,layerState.zIndex=1/0,evt.frameState.layerStatesArray.push(layerState),evt.frameState.layerStates[_index2.default.getUid(this)]=layerState},this),this.mapRenderKey_=_events2.default.listen(this,_eventtype2.default.CHANGE,map.render,map),this.changed())},_ol_layer_Layer_.prototype.setSource=function(source){this.set(_property2.default.SOURCE,source)},exports.default=_ol_layer_Layer_},{"../events.js":48,"../events/eventtype.js":52,"../index.js":89,"../layer/base.js":105,"../layer/property.js":109,"../obj.js":124,"../object.js":125,"../render/eventtype.js":160,"../source/state.js":212}],109:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",SOURCE:"source"}},{}],110:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_layertype2=_interopRequireDefault(require("../layertype.js")),_layer2=_interopRequireDefault(require("../layer/layer.js")),_vectorrendertype2=_interopRequireDefault(require("../layer/vectorrendertype.js")),_obj2=_interopRequireDefault(require("../obj.js")),_style2=_interopRequireDefault(require("../style/style.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_layer_Vector_=function(opt_options){var options=opt_options||{},baseOptions=_obj2.default.assign({},options);delete baseOptions.style,delete baseOptions.renderBuffer,delete baseOptions.updateWhileAnimating,delete baseOptions.updateWhileInteracting,_layer2.default.call(this,baseOptions),this.declutter_=void 0!==options.declutter&&options.declutter,this.renderBuffer_=void 0!==options.renderBuffer?options.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(options.style),this.updateWhileAnimating_=void 0!==options.updateWhileAnimating&&options.updateWhileAnimating,this.updateWhileInteracting_=void 0!==options.updateWhileInteracting&&options.updateWhileInteracting,this.renderMode_=options.renderMode||_vectorrendertype2.default.VECTOR,this.type=_layertype2.default.VECTOR};_index2.default.inherits(_ol_layer_Vector_,_layer2.default),_ol_layer_Vector_.prototype.getDeclutter=function(){return this.declutter_},_ol_layer_Vector_.prototype.setDeclutter=function(declutter){this.declutter_=declutter},_ol_layer_Vector_.prototype.getRenderBuffer=function(){return this.renderBuffer_},_ol_layer_Vector_.prototype.getRenderOrder=function(){return this.get(_ol_layer_Vector_.Property_.RENDER_ORDER)},_ol_layer_Vector_.prototype.getStyle=function(){return this.style_},_ol_layer_Vector_.prototype.getStyleFunction=function(){return this.styleFunction_},_ol_layer_Vector_.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},_ol_layer_Vector_.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},_ol_layer_Vector_.prototype.setRenderOrder=function(renderOrder){this.set(_ol_layer_Vector_.Property_.RENDER_ORDER,renderOrder)},_ol_layer_Vector_.prototype.setStyle=function(style){this.style_=void 0!==style?style:_style2.default.defaultFunction,this.styleFunction_=null===style?void 0:_style2.default.createFunction(this.style_),this.changed()},_ol_layer_Vector_.prototype.getRenderMode=function(){return this.renderMode_},_ol_layer_Vector_.Property_={RENDER_ORDER:"renderOrder"},exports.default=_ol_layer_Vector_},{"../index.js":89,"../layer/layer.js":108,"../layer/vectorrendertype.js":111,"../layertype.js":113,"../obj.js":124,"../style/style.js":234}],111:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={IMAGE:"image",VECTOR:"vector"}},{}],112:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"}},{}],113:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={IMAGE:"IMAGE",TILE:"TILE",VECTOR_TILE:"VECTOR_TILE",VECTOR:"VECTOR"}},{}],114:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_loadingstrategy_={all:function(extent,resolution){return[[-1/0,-1/0,1/0,1/0]]},bbox:function(extent,resolution){return[extent]},tile:function(tileGrid){return function(extent,resolution){var z=tileGrid.getZForResolution(resolution),tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z),extents=[],tileCoord=[z,0,0];for(tileCoord[1]=tileRange.minX;tileCoord[1]<=tileRange.maxX;++tileCoord[1])for(tileCoord[2]=tileRange.minY;tileCoord[2]<=tileRange.maxY;++tileCoord[2])extents.push(tileGrid.getTileCoordExtent(tileCoord));return extents}}};exports.default=_ol_loadingstrategy_},{}],115:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_pluggablemap2=_interopRequireDefault(require("./pluggablemap.js")),_plugintype2=_interopRequireDefault(require("./plugintype.js")),_control2=_interopRequireDefault(require("./control.js")),_interaction2=_interopRequireDefault(require("./interaction.js")),_obj2=_interopRequireDefault(require("./obj.js")),_plugins2=_interopRequireDefault(require("./plugins.js")),_imagelayer2=_interopRequireDefault(require("./renderer/canvas/imagelayer.js")),_map2=_interopRequireDefault(require("./renderer/canvas/map.js")),_tilelayer2=_interopRequireDefault(require("./renderer/canvas/tilelayer.js")),_vectorlayer2=_interopRequireDefault(require("./renderer/canvas/vectorlayer.js")),_vectortilelayer2=_interopRequireDefault(require("./renderer/canvas/vectortilelayer.js")),_imagelayer4=_interopRequireDefault(require("./renderer/webgl/imagelayer.js")),_map4=_interopRequireDefault(require("./renderer/webgl/map.js")),_tilelayer4=_interopRequireDefault(require("./renderer/webgl/tilelayer.js")),_vectorlayer4=_interopRequireDefault(require("./renderer/webgl/vectorlayer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_index2.default.ENABLE_CANVAS&&(_plugins2.default.register(_plugintype2.default.MAP_RENDERER,_map2.default),_plugins2.default.registerMultiple(_plugintype2.default.LAYER_RENDERER,[_imagelayer2.default,_tilelayer2.default,_vectorlayer2.default,_vectortilelayer2.default])),_index2.default.ENABLE_WEBGL&&(_plugins2.default.register(_plugintype2.default.MAP_RENDERER,_map4.default),_plugins2.default.registerMultiple(_plugintype2.default.LAYER_RENDERER,[_imagelayer4.default,_tilelayer4.default,_vectorlayer4.default]));var _ol_Map_=function(options){(options=_obj2.default.assign({},options)).controls||(options.controls=_control2.default.defaults()),options.interactions||(options.interactions=_interaction2.default.defaults()),_pluggablemap2.default.call(this,options)};_index2.default.inherits(_ol_Map_,_pluggablemap2.default),exports.default=_ol_Map_},{"./control.js":38,"./index.js":89,"./interaction.js":90,"./obj.js":124,"./pluggablemap.js":130,"./plugins.js":131,"./plugintype.js":132,"./renderer/canvas/imagelayer.js":183,"./renderer/canvas/map.js":186,"./renderer/canvas/tilelayer.js":187,"./renderer/canvas/vectorlayer.js":188,"./renderer/canvas/vectortilelayer.js":189,"./renderer/webgl/imagelayer.js":196,"./renderer/webgl/map.js":198,"./renderer/webgl/tilelayer.js":199,"./renderer/webgl/vectorlayer.js":202}],116:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_mapevent2=_interopRequireDefault(require("./mapevent.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_MapBrowserEvent_=function(type,map,browserEvent,opt_dragging,opt_frameState){_mapevent2.default.call(this,type,map,opt_frameState),this.originalEvent=browserEvent,this.pixel=map.getEventPixel(browserEvent),this.coordinate=map.getCoordinateFromPixel(this.pixel),this.dragging=void 0!==opt_dragging&&opt_dragging};_index2.default.inherits(_ol_MapBrowserEvent_,_mapevent2.default),_ol_MapBrowserEvent_.prototype.preventDefault=function(){_mapevent2.default.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},_ol_MapBrowserEvent_.prototype.stopPropagation=function(){_mapevent2.default.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},exports.default=_ol_MapBrowserEvent_},{"./index.js":89,"./mapevent.js":120}],117:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_has2=_interopRequireDefault(require("./has.js")),_mapbrowsereventtype2=_interopRequireDefault(require("./mapbrowsereventtype.js")),_mapbrowserpointerevent2=_interopRequireDefault(require("./mapbrowserpointerevent.js")),_events2=_interopRequireDefault(require("./events.js")),_eventtarget2=_interopRequireDefault(require("./events/eventtarget.js")),_eventtype2=_interopRequireDefault(require("./pointer/eventtype.js")),_pointereventhandler2=_interopRequireDefault(require("./pointer/pointereventhandler.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_MapBrowserEventHandler_=function(map,moveTolerance){_eventtarget2.default.call(this),this.map_=map,this.clickTimeoutId_=0,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=moveTolerance?moveTolerance*_has2.default.DEVICE_PIXEL_RATIO:_has2.default.DEVICE_PIXEL_RATIO,this.down_=null;var element=this.map_.getViewport();this.activePointers_=0,this.trackedTouches_={},this.pointerEventHandler_=new _pointereventhandler2.default(element),this.documentPointerEventHandler_=null,this.pointerdownListenerKey_=_events2.default.listen(this.pointerEventHandler_,_eventtype2.default.POINTERDOWN,this.handlePointerDown_,this),this.relayedListenerKey_=_events2.default.listen(this.pointerEventHandler_,_eventtype2.default.POINTERMOVE,this.relayEvent_,this)};_index2.default.inherits(_ol_MapBrowserEventHandler_,_eventtarget2.default),_ol_MapBrowserEventHandler_.prototype.emulateClick_=function(pointerEvent){var newEvent=new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.CLICK,this.map_,pointerEvent);this.dispatchEvent(newEvent),0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=0,newEvent=new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.DBLCLICK,this.map_,pointerEvent),this.dispatchEvent(newEvent)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=0;var newEvent=new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.SINGLECLICK,this.map_,pointerEvent);this.dispatchEvent(newEvent)}.bind(this),250)},_ol_MapBrowserEventHandler_.prototype.updateActivePointers_=function(pointerEvent){var event=pointerEvent;event.type==_mapbrowsereventtype2.default.POINTERUP||event.type==_mapbrowsereventtype2.default.POINTERCANCEL?delete this.trackedTouches_[event.pointerId]:event.type==_mapbrowsereventtype2.default.POINTERDOWN&&(this.trackedTouches_[event.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},_ol_MapBrowserEventHandler_.prototype.handlePointerUp_=function(pointerEvent){this.updateActivePointers_(pointerEvent);var newEvent=new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.POINTERUP,this.map_,pointerEvent);this.dispatchEvent(newEvent),newEvent.propagationStopped||this.dragging_||!this.isMouseActionButton_(pointerEvent)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(_events2.default.unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)},_ol_MapBrowserEventHandler_.prototype.isMouseActionButton_=function(pointerEvent){return 0===pointerEvent.button},_ol_MapBrowserEventHandler_.prototype.handlePointerDown_=function(pointerEvent){this.updateActivePointers_(pointerEvent);var newEvent=new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.POINTERDOWN,this.map_,pointerEvent);this.dispatchEvent(newEvent),this.down_=pointerEvent,0===this.dragListenerKeys_.length&&(this.documentPointerEventHandler_=new _pointereventhandler2.default(document),this.dragListenerKeys_.push(_events2.default.listen(this.documentPointerEventHandler_,_mapbrowsereventtype2.default.POINTERMOVE,this.handlePointerMove_,this),_events2.default.listen(this.documentPointerEventHandler_,_mapbrowsereventtype2.default.POINTERUP,this.handlePointerUp_,this),_events2.default.listen(this.pointerEventHandler_,_mapbrowsereventtype2.default.POINTERCANCEL,this.handlePointerUp_,this)))},_ol_MapBrowserEventHandler_.prototype.handlePointerMove_=function(pointerEvent){if(this.isMoving_(pointerEvent)){this.dragging_=!0;var newEvent=new _mapbrowserpointerevent2.default(_mapbrowsereventtype2.default.POINTERDRAG,this.map_,pointerEvent,this.dragging_);this.dispatchEvent(newEvent)}pointerEvent.preventDefault()},_ol_MapBrowserEventHandler_.prototype.relayEvent_=function(pointerEvent){var dragging=!(!this.down_||!this.isMoving_(pointerEvent));this.dispatchEvent(new _mapbrowserpointerevent2.default(pointerEvent.type,this.map_,pointerEvent,dragging))},_ol_MapBrowserEventHandler_.prototype.isMoving_=function(pointerEvent){return Math.abs(pointerEvent.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(pointerEvent.clientY-this.down_.clientY)>this.moveTolerance_},_ol_MapBrowserEventHandler_.prototype.disposeInternal=function(){this.relayedListenerKey_&&(_events2.default.unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(_events2.default.unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(_events2.default.unlistenByKey),this.dragListenerKeys_.length=0,this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null),this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null),_eventtarget2.default.prototype.disposeInternal.call(this)},exports.default=_ol_MapBrowserEventHandler_},{"./events.js":48,"./events/eventtarget.js":51,"./has.js":84,"./index.js":89,"./mapbrowsereventtype.js":118,"./mapbrowserpointerevent.js":119,"./pointer/eventtype.js":134,"./pointer/pointereventhandler.js":139}],118:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_eventtype=require("./events/eventtype.js"),_eventtype2=(obj=_eventtype)&&obj.__esModule?obj:{default:obj};var _ol_MapBrowserEventType_={SINGLECLICK:"singleclick",CLICK:_eventtype2.default.CLICK,DBLCLICK:_eventtype2.default.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};exports.default=_ol_MapBrowserEventType_},{"./events/eventtype.js":52}],119:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_mapbrowserevent2=_interopRequireDefault(require("./mapbrowserevent.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_MapBrowserPointerEvent_=function(type,map,pointerEvent,opt_dragging,opt_frameState){_mapbrowserevent2.default.call(this,type,map,pointerEvent.originalEvent,opt_dragging,opt_frameState),this.pointerEvent=pointerEvent};_index2.default.inherits(_ol_MapBrowserPointerEvent_,_mapbrowserevent2.default),exports.default=_ol_MapBrowserPointerEvent_},{"./index.js":89,"./mapbrowserevent.js":116}],120:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_event2=_interopRequireDefault(require("./events/event.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_MapEvent_=function(type,map,opt_frameState){_event2.default.call(this,type),this.map=map,this.frameState=void 0!==opt_frameState?opt_frameState:null};_index2.default.inherits(_ol_MapEvent_,_event2.default),exports.default=_ol_MapEvent_},{"./events/event.js":50,"./index.js":89}],121:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"}},{}],122:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"}},{}],123:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_asserts=require("./asserts.js"),_asserts2=(obj=_asserts)&&obj.__esModule?obj:{default:obj};var _ol_math_={clamp:function(value,min,max){return Math.min(Math.max(value,min),max)}};_ol_math_.cosh="cosh"in Math?Math.cosh:function(x){var y=Math.exp(x);return(y+1/y)/2},_ol_math_.roundUpToPowerOfTwo=function(x){return _asserts2.default.assert(0<x,29),Math.pow(2,Math.ceil(Math.log(x)/Math.LN2))},_ol_math_.squaredSegmentDistance=function(x,y,x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;if(0!==dx||0!==dy){var t=((x-x1)*dx+(y-y1)*dy)/(dx*dx+dy*dy);1<t?(x1=x2,y1=y2):0<t&&(x1+=dx*t,y1+=dy*t)}return _ol_math_.squaredDistance(x,y,x1,y1)},_ol_math_.squaredDistance=function(x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;return dx*dx+dy*dy},_ol_math_.solveLinearSystem=function(mat){for(var n=mat.length,i=0;i<n;i++){for(var maxRow=i,maxEl=Math.abs(mat[i][i]),r=i+1;r<n;r++){var absValue=Math.abs(mat[r][i]);maxEl<absValue&&(maxEl=absValue,maxRow=r)}if(0===maxEl)return null;var tmp=mat[maxRow];mat[maxRow]=mat[i],mat[i]=tmp;for(var j=i+1;j<n;j++)for(var coef=-mat[j][i]/mat[i][i],k=i;k<n+1;k++)i==k?mat[j][k]=0:mat[j][k]+=coef*mat[i][k]}for(var x=new Array(n),l=n-1;0<=l;l--){x[l]=mat[l][n]/mat[l][l];for(var m=l-1;0<=m;m--)mat[m][n]-=mat[m][l]*x[l]}return x},_ol_math_.toDegrees=function(angleInRadians){return 180*angleInRadians/Math.PI},_ol_math_.toRadians=function(angleInDegrees){return angleInDegrees*Math.PI/180},_ol_math_.modulo=function(a,b){var r=a%b;return r*b<0?r+b:r},_ol_math_.lerp=function(a,b,x){return a+x*(b-a)},exports.default=_ol_math_},{"./asserts.js":31}],124:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_obj_={};_ol_obj_.assign="function"==typeof Object.assign?Object.assign:function(target,var_sources){if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),i=1,ii=arguments.length;i<ii;++i){var source=arguments[i];if(null!=source)for(var key in source)source.hasOwnProperty(key)&&(output[key]=source[key])}return output},_ol_obj_.clear=function(object){for(var property in object)delete object[property]},_ol_obj_.getValues=function(object){var values=[];for(var property in object)values.push(object[property]);return values},_ol_obj_.isEmpty=function(object){var property;for(property in object)return!1;return!property},exports.default=_ol_obj_},{}],125:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_objecteventtype2=_interopRequireDefault(require("./objecteventtype.js")),_observable2=_interopRequireDefault(require("./observable.js")),_event2=_interopRequireDefault(require("./events/event.js")),_obj2=_interopRequireDefault(require("./obj.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_Object_=function(opt_values){_observable2.default.call(this),_index2.default.getUid(this),this.values_={},void 0!==opt_values&&this.setProperties(opt_values)};_index2.default.inherits(_ol_Object_,_observable2.default),_ol_Object_.changeEventTypeCache_={},_ol_Object_.getChangeEventType=function(key){return _ol_Object_.changeEventTypeCache_.hasOwnProperty(key)?_ol_Object_.changeEventTypeCache_[key]:_ol_Object_.changeEventTypeCache_[key]="change:"+key},_ol_Object_.prototype.get=function(key){var value;return this.values_.hasOwnProperty(key)&&(value=this.values_[key]),value},_ol_Object_.prototype.getKeys=function(){return Object.keys(this.values_)},_ol_Object_.prototype.getProperties=function(){return _obj2.default.assign({},this.values_)},_ol_Object_.prototype.notify=function(key,oldValue){var eventType;eventType=_ol_Object_.getChangeEventType(key),this.dispatchEvent(new _ol_Object_.Event(eventType,key,oldValue)),eventType=_objecteventtype2.default.PROPERTYCHANGE,this.dispatchEvent(new _ol_Object_.Event(eventType,key,oldValue))},_ol_Object_.prototype.set=function(key,value,opt_silent){if(opt_silent)this.values_[key]=value;else{var oldValue=this.values_[key];oldValue!==(this.values_[key]=value)&&this.notify(key,oldValue)}},_ol_Object_.prototype.setProperties=function(values,opt_silent){var key;for(key in values)this.set(key,values[key],opt_silent)},_ol_Object_.prototype.unset=function(key,opt_silent){if(key in this.values_){var oldValue=this.values_[key];delete this.values_[key],opt_silent||this.notify(key,oldValue)}},_ol_Object_.Event=function(type,key,oldValue){_event2.default.call(this,type),this.key=key,this.oldValue=oldValue},_index2.default.inherits(_ol_Object_.Event,_event2.default),exports.default=_ol_Object_},{"./events/event.js":50,"./index.js":89,"./obj.js":124,"./objecteventtype.js":126,"./observable.js":127}],126:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={PROPERTYCHANGE:"propertychange"}},{}],127:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_events2=_interopRequireDefault(require("./events.js")),_eventtarget2=_interopRequireDefault(require("./events/eventtarget.js")),_eventtype2=_interopRequireDefault(require("./events/eventtype.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_Observable_=function(){_eventtarget2.default.call(this),this.revision_=0};_index2.default.inherits(_ol_Observable_,_eventtarget2.default),_ol_Observable_.unByKey=function(key){if(Array.isArray(key))for(var i=0,ii=key.length;i<ii;++i)_events2.default.unlistenByKey(key[i]);else _events2.default.unlistenByKey(key)},_ol_Observable_.prototype.changed=function(){++this.revision_,this.dispatchEvent(_eventtype2.default.CHANGE)},_ol_Observable_.prototype.getRevision=function(){return this.revision_},_ol_Observable_.prototype.on=function(type,listener,opt_this){if(Array.isArray(type)){for(var len=type.length,keys=new Array(len),i=0;i<len;++i)keys[i]=_events2.default.listen(this,type[i],listener,opt_this);return keys}return _events2.default.listen(this,type,listener,opt_this)},_ol_Observable_.prototype.once=function(type,listener,opt_this){if(Array.isArray(type)){for(var len=type.length,keys=new Array(len),i=0;i<len;++i)keys[i]=_events2.default.listenOnce(this,type[i],listener,opt_this);return keys}return _events2.default.listenOnce(this,type,listener,opt_this)},_ol_Observable_.prototype.un=function(type,listener,opt_this){if(Array.isArray(type))for(var i=0,ii=type.length;i<ii;++i)_events2.default.unlisten(this,type[i],listener,opt_this);else _events2.default.unlisten(this,type,listener,opt_this)},exports.default=_ol_Observable_},{"./events.js":48,"./events/eventtarget.js":51,"./events/eventtype.js":52,"./index.js":89}],128:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_mapeventtype2=_interopRequireDefault(require("./mapeventtype.js")),_object2=_interopRequireDefault(require("./object.js")),_overlaypositioning2=_interopRequireDefault(require("./overlaypositioning.js")),_css2=_interopRequireDefault(require("./css.js")),_dom2=_interopRequireDefault(require("./dom.js")),_events2=_interopRequireDefault(require("./events.js")),_extent2=_interopRequireDefault(require("./extent.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_Overlay_=function(options){_object2.default.call(this),this.options=options,this.id=options.id,this.insertFirst=void 0===options.insertFirst||options.insertFirst,this.stopEvent=void 0===options.stopEvent||options.stopEvent,this.element=document.createElement("DIV"),this.element.className=void 0!==options.className?options.className:"ol-overlay-container "+_css2.default.CLASS_SELECTABLE,this.element.style.position="absolute",this.autoPan=void 0!==options.autoPan&&options.autoPan,this.autoPanAnimation=options.autoPanAnimation||{},this.autoPanMargin=void 0!==options.autoPanMargin?options.autoPanMargin:20,this.rendered={bottom_:"",left_:"",right_:"",top_:"",visible:!0},this.mapPostrenderListenerKey=null,_events2.default.listen(this,_object2.default.getChangeEventType(_ol_Overlay_.Property.ELEMENT),this.handleElementChanged,this),_events2.default.listen(this,_object2.default.getChangeEventType(_ol_Overlay_.Property.MAP),this.handleMapChanged,this),_events2.default.listen(this,_object2.default.getChangeEventType(_ol_Overlay_.Property.OFFSET),this.handleOffsetChanged,this),_events2.default.listen(this,_object2.default.getChangeEventType(_ol_Overlay_.Property.POSITION),this.handlePositionChanged,this),_events2.default.listen(this,_object2.default.getChangeEventType(_ol_Overlay_.Property.POSITIONING),this.handlePositioningChanged,this),void 0!==options.element&&this.setElement(options.element),this.setOffset(void 0!==options.offset?options.offset:[0,0]),this.setPositioning(void 0!==options.positioning?options.positioning:_overlaypositioning2.default.TOP_LEFT),void 0!==options.position&&this.setPosition(options.position)};_index2.default.inherits(_ol_Overlay_,_object2.default),_ol_Overlay_.prototype.getElement=function(){return this.get(_ol_Overlay_.Property.ELEMENT)},_ol_Overlay_.prototype.getId=function(){return this.id},_ol_Overlay_.prototype.getMap=function(){return this.get(_ol_Overlay_.Property.MAP)},_ol_Overlay_.prototype.getOffset=function(){return this.get(_ol_Overlay_.Property.OFFSET)},_ol_Overlay_.prototype.getPosition=function(){return this.get(_ol_Overlay_.Property.POSITION)},_ol_Overlay_.prototype.getPositioning=function(){return this.get(_ol_Overlay_.Property.POSITIONING)},_ol_Overlay_.prototype.handleElementChanged=function(){_dom2.default.removeChildren(this.element);var element=this.getElement();element&&this.element.appendChild(element)},_ol_Overlay_.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(_dom2.default.removeNode(this.element),_events2.default.unlistenByKey(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var map=this.getMap();if(map){this.mapPostrenderListenerKey=_events2.default.listen(map,_mapeventtype2.default.POSTRENDER,this.render,this),this.updatePixelPosition();var container=this.stopEvent?map.getOverlayContainerStopEvent():map.getOverlayContainer();this.insertFirst?container.insertBefore(this.element,container.childNodes[0]||null):container.appendChild(this.element)}},_ol_Overlay_.prototype.render=function(){this.updatePixelPosition()},_ol_Overlay_.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},_ol_Overlay_.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.get(_ol_Overlay_.Property.POSITION)&&this.autoPan&&this.panIntoView()},_ol_Overlay_.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},_ol_Overlay_.prototype.setElement=function(element){this.set(_ol_Overlay_.Property.ELEMENT,element)},_ol_Overlay_.prototype.setMap=function(map){this.set(_ol_Overlay_.Property.MAP,map)},_ol_Overlay_.prototype.setOffset=function(offset){this.set(_ol_Overlay_.Property.OFFSET,offset)},_ol_Overlay_.prototype.setPosition=function(position){this.set(_ol_Overlay_.Property.POSITION,position)},_ol_Overlay_.prototype.panIntoView=function(){var map=this.getMap();if(map&&map.getTargetElement()){var mapRect=this.getRect(map.getTargetElement(),map.getSize()),element=this.getElement(),overlayRect=this.getRect(element,[_dom2.default.outerWidth(element),_dom2.default.outerHeight(element)]),margin=this.autoPanMargin;if(!_extent2.default.containsExtent(mapRect,overlayRect)){var offsetLeft=overlayRect[0]-mapRect[0],offsetRight=mapRect[2]-overlayRect[2],offsetTop=overlayRect[1]-mapRect[1],offsetBottom=mapRect[3]-overlayRect[3],delta=[0,0];if(offsetLeft<0?delta[0]=offsetLeft-margin:offsetRight<0&&(delta[0]=Math.abs(offsetRight)+margin),offsetTop<0?delta[1]=offsetTop-margin:offsetBottom<0&&(delta[1]=Math.abs(offsetBottom)+margin),0!==delta[0]||0!==delta[1]){var center=map.getView().getCenter(),centerPx=map.getPixelFromCoordinate(center),newCenterPx=[centerPx[0]+delta[0],centerPx[1]+delta[1]];map.getView().animate({center:map.getCoordinateFromPixel(newCenterPx),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}},_ol_Overlay_.prototype.getRect=function(element,size){var box=element.getBoundingClientRect(),offsetX=box.left+window.pageXOffset,offsetY=box.top+window.pageYOffset;return[offsetX,offsetY,offsetX+size[0],offsetY+size[1]]},_ol_Overlay_.prototype.setPositioning=function(positioning){this.set(_ol_Overlay_.Property.POSITIONING,positioning)},_ol_Overlay_.prototype.setVisible=function(visible){this.rendered.visible!==visible&&(this.element.style.display=visible?"":"none",this.rendered.visible=visible)},_ol_Overlay_.prototype.updatePixelPosition=function(){var map=this.getMap(),position=this.getPosition();if(map&&map.isRendered()&&position){var pixel=map.getPixelFromCoordinate(position),mapSize=map.getSize();this.updateRenderedPosition(pixel,mapSize)}else this.setVisible(!1)},_ol_Overlay_.prototype.updateRenderedPosition=function(pixel,mapSize){var style=this.element.style,offset=this.getOffset(),positioning=this.getPositioning();this.setVisible(!0);var offsetX=offset[0],offsetY=offset[1];if(positioning==_overlaypositioning2.default.BOTTOM_RIGHT||positioning==_overlaypositioning2.default.CENTER_RIGHT||positioning==_overlaypositioning2.default.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_=style.left="");var right=Math.round(mapSize[0]-pixel[0]-offsetX)+"px";this.rendered.right_!=right&&(this.rendered.right_=style.right=right)}else{""!==this.rendered.right_&&(this.rendered.right_=style.right=""),positioning!=_overlaypositioning2.default.BOTTOM_CENTER&&positioning!=_overlaypositioning2.default.CENTER_CENTER&&positioning!=_overlaypositioning2.default.TOP_CENTER||(offsetX-=this.element.offsetWidth/2);var left=Math.round(pixel[0]+offsetX)+"px";this.rendered.left_!=left&&(this.rendered.left_=style.left=left)}if(positioning==_overlaypositioning2.default.BOTTOM_LEFT||positioning==_overlaypositioning2.default.BOTTOM_CENTER||positioning==_overlaypositioning2.default.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_=style.top="");var bottom=Math.round(mapSize[1]-pixel[1]-offsetY)+"px";this.rendered.bottom_!=bottom&&(this.rendered.bottom_=style.bottom=bottom)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=style.bottom=""),positioning!=_overlaypositioning2.default.CENTER_LEFT&&positioning!=_overlaypositioning2.default.CENTER_CENTER&&positioning!=_overlaypositioning2.default.CENTER_RIGHT||(offsetY-=this.element.offsetHeight/2);var top=Math.round(pixel[1]+offsetY)+"px";this.rendered.top_!=top&&(this.rendered.top_=style.top=top)}},_ol_Overlay_.prototype.getOptions=function(){return this.options},_ol_Overlay_.Property={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},exports.default=_ol_Overlay_},{"./css.js":44,"./dom.js":46,"./events.js":48,"./extent.js":54,"./index.js":89,"./mapeventtype.js":121,"./object.js":125,"./overlaypositioning.js":129}],129:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"}},{}],130:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_collection2=_interopRequireDefault(require("./collection.js")),_collectioneventtype2=_interopRequireDefault(require("./collectioneventtype.js")),_mapbrowserevent2=_interopRequireDefault(require("./mapbrowserevent.js")),_mapbrowsereventhandler2=_interopRequireDefault(require("./mapbrowsereventhandler.js")),_mapbrowsereventtype2=_interopRequireDefault(require("./mapbrowsereventtype.js")),_mapevent2=_interopRequireDefault(require("./mapevent.js")),_mapeventtype2=_interopRequireDefault(require("./mapeventtype.js")),_mapproperty2=_interopRequireDefault(require("./mapproperty.js")),_object2=_interopRequireDefault(require("./object.js")),_objecteventtype2=_interopRequireDefault(require("./objecteventtype.js")),_tilequeue2=_interopRequireDefault(require("./tilequeue.js")),_view2=_interopRequireDefault(require("./view.js")),_viewhint2=_interopRequireDefault(require("./viewhint.js")),_asserts2=_interopRequireDefault(require("./asserts.js")),_dom2=_interopRequireDefault(require("./dom.js")),_events2=_interopRequireDefault(require("./events.js")),_event2=_interopRequireDefault(require("./events/event.js")),_eventtype2=_interopRequireDefault(require("./events/eventtype.js")),_extent2=_interopRequireDefault(require("./extent.js")),_functions2=_interopRequireDefault(require("./functions.js")),_has2=_interopRequireDefault(require("./has.js")),_group2=_interopRequireDefault(require("./layer/group.js")),_obj2=_interopRequireDefault(require("./obj.js")),_plugins2=_interopRequireDefault(require("./plugins.js")),_type2=_interopRequireDefault(require("./renderer/type.js")),_size2=_interopRequireDefault(require("./size.js")),_priorityqueue2=_interopRequireDefault(require("./structs/priorityqueue.js")),_transform2=_interopRequireDefault(require("./transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_PluggableMap_=function(options){_object2.default.call(this);var optionsInternal=_ol_PluggableMap_.createOptionsInternal(options);this.loadTilesWhileAnimating_=void 0!==options.loadTilesWhileAnimating&&options.loadTilesWhileAnimating,this.loadTilesWhileInteracting_=void 0!==options.loadTilesWhileInteracting&&options.loadTilesWhileInteracting,this.pixelRatio_=void 0!==options.pixelRatio?options.pixelRatio:_has2.default.DEVICE_PIXEL_RATIO,this.logos_=optionsInternal.logos,this.animationDelayKey_,this.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_.call(this,Date.now())}.bind(this),this.coordinateToPixelTransform_=_transform2.default.create(),this.pixelToCoordinateTransform_=_transform2.default.create(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("DIV"),this.viewport_.className="ol-viewport"+(_has2.default.TOUCH?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.viewport_.style.msTouchAction="none",this.viewport_.style.touchAction="none",this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var overlayEvents=[_eventtype2.default.CLICK,_eventtype2.default.DBLCLICK,_eventtype2.default.MOUSEDOWN,_eventtype2.default.TOUCHSTART,_eventtype2.default.MSPOINTERDOWN,_mapbrowsereventtype2.default.POINTERDOWN,_eventtype2.default.MOUSEWHEEL,_eventtype2.default.WHEEL],i=0,ii=overlayEvents.length;i<ii;++i)_events2.default.listen(this.overlayContainerStopEvent_,overlayEvents[i],_event2.default.stopPropagation);for(var key in this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new _mapbrowsereventhandler2.default(this,options.moveTolerance),_mapbrowsereventtype2.default)_events2.default.listen(this.mapBrowserEventHandler_,_mapbrowsereventtype2.default[key],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=optionsInternal.keyboardEventTarget,this.keyHandlerKeys_=null,_events2.default.listen(this.viewport_,_eventtype2.default.WHEEL,this.handleBrowserEvent,this),_events2.default.listen(this.viewport_,_eventtype2.default.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls=optionsInternal.controls||new _collection2.default,this.interactions=optionsInternal.interactions||new _collection2.default,this.overlays_=optionsInternal.overlays,this.overlayIdIndex_={},this.renderer_=optionsInternal.mapRendererPlugin.create(this.viewport_,this),this.handleResize_,this.focus_=null,this.postRenderFunctions_=[],this.tileQueue_=new _tilequeue2.default(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},_events2.default.listen(this,_object2.default.getChangeEventType(_mapproperty2.default.LAYERGROUP),this.handleLayerGroupChanged_,this),_events2.default.listen(this,_object2.default.getChangeEventType(_mapproperty2.default.VIEW),this.handleViewChanged_,this),_events2.default.listen(this,_object2.default.getChangeEventType(_mapproperty2.default.SIZE),this.handleSizeChanged_,this),_events2.default.listen(this,_object2.default.getChangeEventType(_mapproperty2.default.TARGET),this.handleTargetChanged_,this),this.setProperties(optionsInternal.values),this.controls.forEach(function(control){control.setMap(this)},this),_events2.default.listen(this.controls,_collectioneventtype2.default.ADD,function(event){event.element.setMap(this)},this),_events2.default.listen(this.controls,_collectioneventtype2.default.REMOVE,function(event){event.element.setMap(null)},this),this.interactions.forEach(function(interaction){interaction.setMap(this)},this),_events2.default.listen(this.interactions,_collectioneventtype2.default.ADD,function(event){event.element.setMap(this)},this),_events2.default.listen(this.interactions,_collectioneventtype2.default.REMOVE,function(event){event.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_,this),_events2.default.listen(this.overlays_,_collectioneventtype2.default.ADD,function(event){this.addOverlayInternal_(event.element)},this),_events2.default.listen(this.overlays_,_collectioneventtype2.default.REMOVE,function(event){var id=event.element.getId();void 0!==id&&delete this.overlayIdIndex_[id.toString()],event.element.setMap(null)},this)};_index2.default.inherits(_ol_PluggableMap_,_object2.default),_ol_PluggableMap_.prototype.addControl=function(control){this.getControls().push(control)},_ol_PluggableMap_.prototype.addInteraction=function(interaction){this.getInteractions().push(interaction)},_ol_PluggableMap_.prototype.addLayer=function(layer){this.getLayerGroup().getLayers().push(layer)},_ol_PluggableMap_.prototype.addOverlay=function(overlay){this.getOverlays().push(overlay)},_ol_PluggableMap_.prototype.addOverlayInternal_=function(overlay){var id=overlay.getId();void 0!==id&&(this.overlayIdIndex_[id.toString()]=overlay),overlay.setMap(this)},_ol_PluggableMap_.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),_events2.default.unlisten(this.viewport_,_eventtype2.default.WHEEL,this.handleBrowserEvent,this),_events2.default.unlisten(this.viewport_,_eventtype2.default.MOUSEWHEEL,this.handleBrowserEvent,this),void 0!==this.handleResize_&&(window.removeEventListener(_eventtype2.default.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),this.setTarget(null),_object2.default.prototype.disposeInternal.call(this)},_ol_PluggableMap_.prototype.forEachFeatureAtPixel=function(pixel,callback,opt_options){if(this.frameState_){var coordinate=this.getCoordinateFromPixel(pixel),hitTolerance=void 0!==(opt_options=void 0!==opt_options?opt_options:{}).hitTolerance?opt_options.hitTolerance*this.frameState_.pixelRatio:0,layerFilter=void 0!==opt_options.layerFilter?opt_options.layerFilter:_functions2.default.TRUE;return this.renderer_.forEachFeatureAtCoordinate(coordinate,this.frameState_,hitTolerance,callback,null,layerFilter,null)}},_ol_PluggableMap_.prototype.getFeaturesAtPixel=function(pixel,opt_options){var features=null;return this.forEachFeatureAtPixel(pixel,function(feature){features||(features=[]),features.push(feature)},opt_options),features},_ol_PluggableMap_.prototype.forEachLayerAtPixel=function(pixel,callback,opt_this,opt_layerFilter,opt_this2){if(this.frameState_){var thisArg=void 0!==opt_this?opt_this:null,layerFilter=void 0!==opt_layerFilter?opt_layerFilter:_functions2.default.TRUE,thisArg2=void 0!==opt_this2?opt_this2:null;return this.renderer_.forEachLayerAtPixel(pixel,this.frameState_,callback,thisArg,layerFilter,thisArg2)}},_ol_PluggableMap_.prototype.hasFeatureAtPixel=function(pixel,opt_options){if(!this.frameState_)return!1;var coordinate=this.getCoordinateFromPixel(pixel),layerFilter=void 0!==(opt_options=void 0!==opt_options?opt_options:{}).layerFilter?opt_options.layerFilter:_functions2.default.TRUE,hitTolerance=void 0!==opt_options.hitTolerance?opt_options.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(coordinate,this.frameState_,hitTolerance,layerFilter,null)},_ol_PluggableMap_.prototype.getEventCoordinate=function(event){return this.getCoordinateFromPixel(this.getEventPixel(event))},_ol_PluggableMap_.prototype.getEventPixel=function(event){var viewportPosition=this.viewport_.getBoundingClientRect(),eventPosition=event.changedTouches?event.changedTouches[0]:event;return[eventPosition.clientX-viewportPosition.left,eventPosition.clientY-viewportPosition.top]},_ol_PluggableMap_.prototype.getTarget=function(){return this.get(_mapproperty2.default.TARGET)},_ol_PluggableMap_.prototype.getTargetElement=function(){var target=this.getTarget();return void 0!==target?"string"==typeof target?document.getElementById(target):target:null},_ol_PluggableMap_.prototype.getCoordinateFromPixel=function(pixel){var frameState=this.frameState_;return frameState?_transform2.default.apply(frameState.pixelToCoordinateTransform,pixel.slice()):null},_ol_PluggableMap_.prototype.getControls=function(){return this.controls},_ol_PluggableMap_.prototype.getOverlays=function(){return this.overlays_},_ol_PluggableMap_.prototype.getOverlayById=function(id){var overlay=this.overlayIdIndex_[id.toString()];return void 0!==overlay?overlay:null},_ol_PluggableMap_.prototype.getInteractions=function(){return this.interactions},_ol_PluggableMap_.prototype.getLayerGroup=function(){return this.get(_mapproperty2.default.LAYERGROUP)},_ol_PluggableMap_.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},_ol_PluggableMap_.prototype.getPixelFromCoordinate=function(coordinate){var frameState=this.frameState_;return frameState?_transform2.default.apply(frameState.coordinateToPixelTransform,coordinate.slice(0,2)):null},_ol_PluggableMap_.prototype.getRenderer=function(){return this.renderer_},_ol_PluggableMap_.prototype.getSize=function(){return this.get(_mapproperty2.default.SIZE)},_ol_PluggableMap_.prototype.getView=function(){return this.get(_mapproperty2.default.VIEW)},_ol_PluggableMap_.prototype.getViewport=function(){return this.viewport_},_ol_PluggableMap_.prototype.getOverlayContainer=function(){return this.overlayContainer_},_ol_PluggableMap_.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},_ol_PluggableMap_.prototype.getTilePriority=function(tile,tileSourceKey,tileCenter,tileResolution){var frameState=this.frameState_;if(!(frameState&&tileSourceKey in frameState.wantedTiles))return _priorityqueue2.default.DROP;if(!frameState.wantedTiles[tileSourceKey][tile.getKey()])return _priorityqueue2.default.DROP;var deltaX=tileCenter[0]-frameState.focus[0],deltaY=tileCenter[1]-frameState.focus[1];return 65536*Math.log(tileResolution)+Math.sqrt(deltaX*deltaX+deltaY*deltaY)/tileResolution},_ol_PluggableMap_.prototype.handleBrowserEvent=function(browserEvent,opt_type){var type=opt_type||browserEvent.type,mapBrowserEvent=new _mapbrowserevent2.default(type,this,browserEvent);this.handleMapBrowserEvent(mapBrowserEvent)},_ol_PluggableMap_.prototype.handleMapBrowserEvent=function(mapBrowserEvent){if(this.frameState_){this.focus_=mapBrowserEvent.coordinate,mapBrowserEvent.frameState=this.frameState_;var i,interactionsArray=this.getInteractions().getArray();if(!1!==this.dispatchEvent(mapBrowserEvent))for(i=interactionsArray.length-1;0<=i;i--){var interaction=interactionsArray[i];if(interaction.getActive())if(!interaction.handleEvent(mapBrowserEvent))break}}},_ol_PluggableMap_.prototype.handlePostRender=function(){var frameState=this.frameState_,tileQueue=this.tileQueue_;if(!tileQueue.isEmpty()){var maxTotalLoading=16,maxNewLoads=maxTotalLoading;if(frameState){var hints=frameState.viewHints;hints[_viewhint2.default.ANIMATING]&&(maxTotalLoading=this.loadTilesWhileAnimating_?8:0,maxNewLoads=2),hints[_viewhint2.default.INTERACTING]&&(maxTotalLoading=this.loadTilesWhileInteracting_?8:0,maxNewLoads=2)}tileQueue.getTilesLoading()<maxTotalLoading&&(tileQueue.reprioritize(),tileQueue.loadMoreTiles(maxTotalLoading,maxNewLoads))}var i,ii,postRenderFunctions=this.postRenderFunctions_;for(i=0,ii=postRenderFunctions.length;i<ii;++i)postRenderFunctions[i](this,frameState);postRenderFunctions.length=0},_ol_PluggableMap_.prototype.handleSizeChanged_=function(){this.render()},_ol_PluggableMap_.prototype.handleTargetChanged_=function(){var targetElement;if(this.getTarget()&&(targetElement=this.getTargetElement()),this.keyHandlerKeys_){for(var i=0,ii=this.keyHandlerKeys_.length;i<ii;++i)_events2.default.unlistenByKey(this.keyHandlerKeys_[i]);this.keyHandlerKeys_=null}if(targetElement){targetElement.appendChild(this.viewport_);var keyboardEventTarget=this.keyboardEventTarget_?this.keyboardEventTarget_:targetElement;this.keyHandlerKeys_=[_events2.default.listen(keyboardEventTarget,_eventtype2.default.KEYDOWN,this.handleBrowserEvent,this),_events2.default.listen(keyboardEventTarget,_eventtype2.default.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(_eventtype2.default.RESIZE,this.handleResize_,!1))}else this.renderer_.removeLayerRenderers(),_dom2.default.removeNode(this.viewport_),void 0!==this.handleResize_&&(window.removeEventListener(_eventtype2.default.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);this.updateSize()},_ol_PluggableMap_.prototype.handleTileChange_=function(){this.render()},_ol_PluggableMap_.prototype.handleViewPropertyChanged_=function(){this.render()},_ol_PluggableMap_.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(_events2.default.unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(_events2.default.unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var view=this.getView();view&&(this.viewport_.setAttribute("data-view",_index2.default.getUid(view)),this.viewPropertyListenerKey_=_events2.default.listen(view,_objecteventtype2.default.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=_events2.default.listen(view,_eventtype2.default.CHANGE,this.handleViewPropertyChanged_,this)),this.render()},_ol_PluggableMap_.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(_events2.default.unlistenByKey),this.layerGroupPropertyListenerKeys_=null);var layerGroup=this.getLayerGroup();layerGroup&&(this.layerGroupPropertyListenerKeys_=[_events2.default.listen(layerGroup,_objecteventtype2.default.PROPERTYCHANGE,this.render,this),_events2.default.listen(layerGroup,_eventtype2.default.CHANGE,this.render,this)]),this.render()},_ol_PluggableMap_.prototype.isRendered=function(){return!!this.frameState_},_ol_PluggableMap_.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},_ol_PluggableMap_.prototype.render=function(){void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},_ol_PluggableMap_.prototype.removeControl=function(control){return this.getControls().remove(control)},_ol_PluggableMap_.prototype.removeInteraction=function(interaction){return this.getInteractions().remove(interaction)},_ol_PluggableMap_.prototype.removeLayer=function(layer){return this.getLayerGroup().getLayers().remove(layer)},_ol_PluggableMap_.prototype.removeOverlay=function(overlay){return this.getOverlays().remove(overlay)},_ol_PluggableMap_.prototype.renderFrame_=function(time){var i,ii,viewState,size=this.getSize(),view=this.getView(),extent=_extent2.default.createEmpty(),previousFrameState=this.frameState_,frameState=null;if(void 0!==size&&_size2.default.hasArea(size)&&view&&view.isDef()){var viewHints=view.getHints(this.frameState_?this.frameState_.viewHints:void 0),layerStatesArray=this.getLayerGroup().getLayerStatesArray(),layerStates={};for(i=0,ii=layerStatesArray.length;i<ii;++i)layerStates[_index2.default.getUid(layerStatesArray[i].layer)]=layerStatesArray[i];var center=(viewState=view.getState()).center,pixelResolution=viewState.resolution/this.pixelRatio_;center[0]=Math.round(center[0]/pixelResolution)*pixelResolution,center[1]=Math.round(center[1]/pixelResolution)*pixelResolution,frameState={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:extent,focus:this.focus_?this.focus_:center,index:this.frameIndex_++,layerStates:layerStates,layerStatesArray:layerStatesArray,logos:_obj2.default.assign({},this.logos_),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:size,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:time,usedTiles:{},viewState:viewState,viewHints:viewHints,wantedTiles:{}}}if(frameState&&(frameState.extent=_extent2.default.getForViewAndSize(viewState.center,viewState.resolution,viewState.rotation,frameState.size,extent)),this.frameState_=frameState,this.renderer_.renderFrame(frameState),frameState){if(frameState.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,frameState.postRenderFunctions),previousFrameState)(!this.previousExtent_||!_extent2.default.isEmpty(this.previousExtent_)&&!_extent2.default.equals(frameState.extent,this.previousExtent_))&&(this.dispatchEvent(new _mapevent2.default(_mapeventtype2.default.MOVESTART,this,previousFrameState)),this.previousExtent_=_extent2.default.createOrUpdateEmpty(this.previousExtent_));this.previousExtent_&&!frameState.viewHints[_viewhint2.default.ANIMATING]&&!frameState.viewHints[_viewhint2.default.INTERACTING]&&!_extent2.default.equals(frameState.extent,this.previousExtent_)&&(this.dispatchEvent(new _mapevent2.default(_mapeventtype2.default.MOVEEND,this,frameState)),_extent2.default.clone(frameState.extent,this.previousExtent_))}this.dispatchEvent(new _mapevent2.default(_mapeventtype2.default.POSTRENDER,this,frameState)),setTimeout(this.handlePostRender.bind(this),0)},_ol_PluggableMap_.prototype.setLayerGroup=function(layerGroup){this.set(_mapproperty2.default.LAYERGROUP,layerGroup)},_ol_PluggableMap_.prototype.setSize=function(size){this.set(_mapproperty2.default.SIZE,size)},_ol_PluggableMap_.prototype.setTarget=function(target){this.set(_mapproperty2.default.TARGET,target)},_ol_PluggableMap_.prototype.setView=function(view){this.set(_mapproperty2.default.VIEW,view)},_ol_PluggableMap_.prototype.skipFeature=function(feature){var featureUid=_index2.default.getUid(feature).toString();this.skippedFeatureUids_[featureUid]=!0,this.render()},_ol_PluggableMap_.prototype.updateSize=function(){var targetElement=this.getTargetElement();if(targetElement){var computedStyle=getComputedStyle(targetElement);this.setSize([targetElement.offsetWidth-parseFloat(computedStyle.borderLeftWidth)-parseFloat(computedStyle.paddingLeft)-parseFloat(computedStyle.paddingRight)-parseFloat(computedStyle.borderRightWidth),targetElement.offsetHeight-parseFloat(computedStyle.borderTopWidth)-parseFloat(computedStyle.paddingTop)-parseFloat(computedStyle.paddingBottom)-parseFloat(computedStyle.borderBottomWidth)])}else this.setSize(void 0)},_ol_PluggableMap_.prototype.unskipFeature=function(feature){var featureUid=_index2.default.getUid(feature).toString();delete this.skippedFeatureUids_[featureUid],this.render()},_ol_PluggableMap_.DEFAULT_RENDERER_TYPES=[_type2.default.CANVAS,_type2.default.WEBGL],_ol_PluggableMap_.LOGO_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAHGAAABxgEXwfpGAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAhNQTFRF////AP//AICAgP//AFVVQECA////K1VVSbbbYL/fJ05idsTYJFtbbcjbJllmZszWWMTOIFhoHlNiZszTa9DdUcHNHlNlV8XRIVdiasrUHlZjIVZjaMnVH1RlIFRkH1RkH1ZlasvYasvXVsPQH1VkacnVa8vWIVZjIFRjVMPQa8rXIVVkXsXRsNveIFVkIFZlIVVj3eDeh6GmbMvXH1ZkIFRka8rWbMvXIFVkIFVjIFVkbMvWH1VjbMvWIFVlbcvWIFVla8vVIFVkbMvWbMvVH1VkbMvWIFVlbcvWIFVkbcvVbMvWjNPbIFVkU8LPwMzNIFVkbczWIFVkbsvWbMvXIFVkRnB8bcvW2+TkW8XRIFVkIlZlJVloJlpoKlxrLl9tMmJwOWd0Omh1RXF8TneCT3iDUHiDU8LPVMLPVcLPVcPQVsPPVsPQV8PQWMTQWsTQW8TQXMXSXsXRX4SNX8bSYMfTYcfTYsfTY8jUZcfSZsnUaIqTacrVasrVa8jTa8rWbI2VbMvWbcvWdJObdcvUdszUd8vVeJaee87Yfc3WgJyjhqGnitDYjaarldPZnrK2oNbborW5o9bbo9fbpLa6q9ndrL3ArtndscDDutzfu8fJwN7gwt7gxc/QyuHhy+HizeHi0NfX0+Pj19zb1+Tj2uXk29/e3uLg3+Lh3+bl4uXj4ufl4+fl5Ofl5ufl5ujm5+jmySDnBAAAAFp0Uk5TAAECAgMEBAYHCA0NDg4UGRogIiMmKSssLzU7PkJJT1JTVFliY2hrdHZ3foSFhYeJjY2QkpugqbG1tre5w8zQ09XY3uXn6+zx8vT09vf4+Pj5+fr6/P39/f3+gz7SsAAAAVVJREFUOMtjYKA7EBDnwCPLrObS1BRiLoJLnte6CQy8FLHLCzs2QUG4FjZ5GbcmBDDjxJBXDWxCBrb8aM4zbkIDzpLYnAcE9VXlJSWlZRU13koIeW57mGx5XjoMZEUqwxWYQaQbSzLSkYGfKFSe0QMsX5WbjgY0YS4MBplemI4BdGBW+DQ11eZiymfqQuXZIjqwyadPNoSZ4L+0FVM6e+oGI6g8a9iKNT3o8kVzNkzRg5lgl7p4wyRUL9Yt2jAxVh6mQCogae6GmflI8p0r13VFWTHBQ0rWPW7ahgWVcPm+9cuLoyy4kCJDzCm6d8PSFoh0zvQNC5OjDJhQopPPJqph1doJBUD5tnkbZiUEqaCnB3bTqLTFG1bPn71kw4b+GFdpLElKIzRxxgYgWNYc5SCENVHKeUaltHdXx0dZ8uBI1hJ2UUDgq82CM2MwKeibqAvSO7MCABq0wXEPiqWEAAAAAElFTkSuQmCC",_ol_PluggableMap_.createOptionsInternal=function(options){var keyboardEventTarget=null;void 0!==options.keyboardEventTarget&&(keyboardEventTarget="string"==typeof options.keyboardEventTarget?document.getElementById(options.keyboardEventTarget):options.keyboardEventTarget);var values={},logos={};if(void 0===options.logo||"boolean"==typeof options.logo&&options.logo)logos[_ol_PluggableMap_.LOGO_URL]="https://openlayers.org/";else{var logo=options.logo;"string"==typeof logo?logos[logo]="":logo instanceof HTMLElement?logos[_index2.default.getUid(logo).toString()]=logo:logo&&(_asserts2.default.assert("string"==typeof logo.href,44),_asserts2.default.assert("string"==typeof logo.src,45),logos[logo.src]=logo.href)}var rendererTypes,mapRendererPlugin,layerGroup=options.layers instanceof _group2.default?options.layers:new _group2.default({layers:options.layers});values[_mapproperty2.default.LAYERGROUP]=layerGroup,values[_mapproperty2.default.TARGET]=options.target,values[_mapproperty2.default.VIEW]=void 0!==options.view?options.view:new _view2.default,void 0!==options.renderer?(Array.isArray(options.renderer)?rendererTypes=options.renderer:"string"==typeof options.renderer?rendererTypes=[options.renderer]:_asserts2.default.assert(!1,46),0<=rendererTypes.indexOf("dom")&&(rendererTypes=rendererTypes.concat(_ol_PluggableMap_.DEFAULT_RENDERER_TYPES))):rendererTypes=_ol_PluggableMap_.DEFAULT_RENDERER_TYPES;var controls,interactions,mapRendererPlugins=_plugins2.default.getMapRendererPlugins();outer:for(var i=0,ii=rendererTypes.length;i<ii;++i)for(var rendererType=rendererTypes[i],j=0,jj=mapRendererPlugins.length;j<jj;++j){var candidate=mapRendererPlugins[j];if(candidate.handles(rendererType)){mapRendererPlugin=candidate;break outer}}if(!mapRendererPlugin)throw new Error("Unable to create a map renderer for types: "+rendererTypes.join(", "));return void 0!==options.controls&&(controls=Array.isArray(options.controls)?new _collection2.default(options.controls.slice()):(_asserts2.default.assert(options.controls instanceof _collection2.default,47),options.controls)),void 0!==options.interactions&&(interactions=Array.isArray(options.interactions)?new _collection2.default(options.interactions.slice()):(_asserts2.default.assert(options.interactions instanceof _collection2.default,48),options.interactions)),{controls:controls,interactions:interactions,keyboardEventTarget:keyboardEventTarget,logos:logos,overlays:void 0!==options.overlays?Array.isArray(options.overlays)?new _collection2.default(options.overlays.slice()):(_asserts2.default.assert(options.overlays instanceof _collection2.default,49),options.overlays):new _collection2.default,mapRendererPlugin:mapRendererPlugin,values:values}},exports.default=_ol_PluggableMap_},{"./asserts.js":31,"./collection.js":34,"./collectioneventtype.js":35,"./dom.js":46,"./events.js":48,"./events/event.js":50,"./events/eventtype.js":52,"./extent.js":54,"./functions.js":60,"./has.js":84,"./index.js":89,"./layer/group.js":106,"./mapbrowserevent.js":116,"./mapbrowsereventhandler.js":117,"./mapbrowsereventtype.js":118,"./mapevent.js":120,"./mapeventtype.js":121,"./mapproperty.js":122,"./obj.js":124,"./object.js":125,"./objecteventtype.js":126,"./plugins.js":131,"./renderer/type.js":192,"./size.js":208,"./structs/priorityqueue.js":219,"./tilequeue.js":240,"./transform.js":243,"./view.js":245,"./viewhint.js":246}],131:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_plugintype=require("./plugintype.js"),_plugintype2=(obj=_plugintype)&&obj.__esModule?obj:{default:obj};var _ol_plugins_={mapRendererPlugins_:[],getMapRendererPlugins:function(){return _ol_plugins_.mapRendererPlugins_},layerRendererPlugins_:[],getLayerRendererPlugins:function(){return _ol_plugins_.layerRendererPlugins_},register:function(type,plugin){switch(type){case _plugintype2.default.MAP_RENDERER:_ol_plugins_.mapRendererPlugins_.push(plugin);break;case _plugintype2.default.LAYER_RENDERER:_ol_plugins_.layerRendererPlugins_.push(plugin);break;default:throw new Error("Unsupported plugin type: "+type)}},registerMultiple:function(type,plugins){for(var i=0,ii=plugins.length;i<ii;++i)_ol_plugins_.register(type,plugins[i])}};exports.default=_ol_plugins_},{"./plugintype.js":132}],132:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={MAP_RENDERER:"MAP_RENDERER",LAYER_RENDERER:"LAYER_RENDERER"}},{}],133:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_pointer_EventSource_=function(dispatcher,mapping){this.dispatcher=dispatcher,this.mapping_=mapping};_ol_pointer_EventSource_.prototype.getEvents=function(){return Object.keys(this.mapping_)},_ol_pointer_EventSource_.prototype.getHandlerForEvent=function(eventType){return this.mapping_[eventType]},exports.default=_ol_pointer_EventSource_},{}],134:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"}},{}],135:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_eventsource2=_interopRequireDefault(require("../pointer/eventsource.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_pointer_MouseSource_=function(dispatcher){var mapping={mousedown:this.mousedown,mousemove:this.mousemove,mouseup:this.mouseup,mouseover:this.mouseover,mouseout:this.mouseout};_eventsource2.default.call(this,dispatcher,mapping),this.pointerMap=dispatcher.pointerMap,this.lastTouches=[]};_index2.default.inherits(_ol_pointer_MouseSource_,_eventsource2.default),_ol_pointer_MouseSource_.POINTER_ID=1,_ol_pointer_MouseSource_.POINTER_TYPE="mouse",_ol_pointer_MouseSource_.DEDUP_DIST=25,_ol_pointer_MouseSource_.prototype.isEventSimulatedFromTouch_=function(inEvent){for(var t,lts=this.lastTouches,x=inEvent.clientX,y=inEvent.clientY,i=0,l=lts.length;i<l&&(t=lts[i]);i++){var dx=Math.abs(x-t[0]),dy=Math.abs(y-t[1]);if(dx<=_ol_pointer_MouseSource_.DEDUP_DIST&&dy<=_ol_pointer_MouseSource_.DEDUP_DIST)return!0}return!1},_ol_pointer_MouseSource_.prepareEvent=function(inEvent,dispatcher){var e=dispatcher.cloneEvent(inEvent,inEvent),pd=e.preventDefault;return e.preventDefault=function(){inEvent.preventDefault(),pd()},e.pointerId=_ol_pointer_MouseSource_.POINTER_ID,e.isPrimary=!0,e.pointerType=_ol_pointer_MouseSource_.POINTER_TYPE,e},_ol_pointer_MouseSource_.prototype.mousedown=function(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){_ol_pointer_MouseSource_.POINTER_ID.toString()in this.pointerMap&&this.cancel(inEvent);var e=_ol_pointer_MouseSource_.prepareEvent(inEvent,this.dispatcher);this.pointerMap[_ol_pointer_MouseSource_.POINTER_ID.toString()]=inEvent,this.dispatcher.down(e,inEvent)}},_ol_pointer_MouseSource_.prototype.mousemove=function(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var e=_ol_pointer_MouseSource_.prepareEvent(inEvent,this.dispatcher);this.dispatcher.move(e,inEvent)}},_ol_pointer_MouseSource_.prototype.mouseup=function(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var p=this.pointerMap[_ol_pointer_MouseSource_.POINTER_ID.toString()];if(p&&p.button===inEvent.button){var e=_ol_pointer_MouseSource_.prepareEvent(inEvent,this.dispatcher);this.dispatcher.up(e,inEvent),this.cleanupMouse()}}},_ol_pointer_MouseSource_.prototype.mouseover=function(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var e=_ol_pointer_MouseSource_.prepareEvent(inEvent,this.dispatcher);this.dispatcher.enterOver(e,inEvent)}},_ol_pointer_MouseSource_.prototype.mouseout=function(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var e=_ol_pointer_MouseSource_.prepareEvent(inEvent,this.dispatcher);this.dispatcher.leaveOut(e,inEvent)}},_ol_pointer_MouseSource_.prototype.cancel=function(inEvent){var e=_ol_pointer_MouseSource_.prepareEvent(inEvent,this.dispatcher);this.dispatcher.cancel(e,inEvent),this.cleanupMouse()},_ol_pointer_MouseSource_.prototype.cleanupMouse=function(){delete this.pointerMap[_ol_pointer_MouseSource_.POINTER_ID.toString()]},exports.default=_ol_pointer_MouseSource_},{"../index.js":89,"../pointer/eventsource.js":133}],136:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_eventsource2=_interopRequireDefault(require("../pointer/eventsource.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_pointer_MsSource_=function(dispatcher){var mapping={MSPointerDown:this.msPointerDown,MSPointerMove:this.msPointerMove,MSPointerUp:this.msPointerUp,MSPointerOut:this.msPointerOut,MSPointerOver:this.msPointerOver,MSPointerCancel:this.msPointerCancel,MSGotPointerCapture:this.msGotPointerCapture,MSLostPointerCapture:this.msLostPointerCapture};_eventsource2.default.call(this,dispatcher,mapping),this.pointerMap=dispatcher.pointerMap,this.POINTER_TYPES=["","unavailable","touch","pen","mouse"]};_index2.default.inherits(_ol_pointer_MsSource_,_eventsource2.default),_ol_pointer_MsSource_.prototype.prepareEvent_=function(inEvent){var e=inEvent;return"number"==typeof inEvent.pointerType&&((e=this.dispatcher.cloneEvent(inEvent,inEvent)).pointerType=this.POINTER_TYPES[inEvent.pointerType]),e},_ol_pointer_MsSource_.prototype.cleanup=function(pointerId){delete this.pointerMap[pointerId.toString()]},_ol_pointer_MsSource_.prototype.msPointerDown=function(inEvent){this.pointerMap[inEvent.pointerId.toString()]=inEvent;var e=this.prepareEvent_(inEvent);this.dispatcher.down(e,inEvent)},_ol_pointer_MsSource_.prototype.msPointerMove=function(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.move(e,inEvent)},_ol_pointer_MsSource_.prototype.msPointerUp=function(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.up(e,inEvent),this.cleanup(inEvent.pointerId)},_ol_pointer_MsSource_.prototype.msPointerOut=function(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.leaveOut(e,inEvent)},_ol_pointer_MsSource_.prototype.msPointerOver=function(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.enterOver(e,inEvent)},_ol_pointer_MsSource_.prototype.msPointerCancel=function(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.cancel(e,inEvent),this.cleanup(inEvent.pointerId)},_ol_pointer_MsSource_.prototype.msLostPointerCapture=function(inEvent){var e=this.dispatcher.makeEvent("lostpointercapture",inEvent,inEvent);this.dispatcher.dispatchEvent(e)},_ol_pointer_MsSource_.prototype.msGotPointerCapture=function(inEvent){var e=this.dispatcher.makeEvent("gotpointercapture",inEvent,inEvent);this.dispatcher.dispatchEvent(e)},exports.default=_ol_pointer_MsSource_},{"../index.js":89,"../pointer/eventsource.js":133}],137:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_eventsource2=_interopRequireDefault(require("../pointer/eventsource.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_pointer_NativeSource_=function(dispatcher){var mapping={pointerdown:this.pointerDown,pointermove:this.pointerMove,pointerup:this.pointerUp,pointerout:this.pointerOut,pointerover:this.pointerOver,pointercancel:this.pointerCancel,gotpointercapture:this.gotPointerCapture,lostpointercapture:this.lostPointerCapture};_eventsource2.default.call(this,dispatcher,mapping)};_index2.default.inherits(_ol_pointer_NativeSource_,_eventsource2.default),_ol_pointer_NativeSource_.prototype.pointerDown=function(inEvent){this.dispatcher.fireNativeEvent(inEvent)},_ol_pointer_NativeSource_.prototype.pointerMove=function(inEvent){this.dispatcher.fireNativeEvent(inEvent)},_ol_pointer_NativeSource_.prototype.pointerUp=function(inEvent){this.dispatcher.fireNativeEvent(inEvent)},_ol_pointer_NativeSource_.prototype.pointerOut=function(inEvent){this.dispatcher.fireNativeEvent(inEvent)},_ol_pointer_NativeSource_.prototype.pointerOver=function(inEvent){this.dispatcher.fireNativeEvent(inEvent)},_ol_pointer_NativeSource_.prototype.pointerCancel=function(inEvent){this.dispatcher.fireNativeEvent(inEvent)},_ol_pointer_NativeSource_.prototype.lostPointerCapture=function(inEvent){this.dispatcher.fireNativeEvent(inEvent)},_ol_pointer_NativeSource_.prototype.gotPointerCapture=function(inEvent){this.dispatcher.fireNativeEvent(inEvent)},exports.default=_ol_pointer_NativeSource_},{"../index.js":89,"../pointer/eventsource.js":133}],138:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_event2=_interopRequireDefault(require("../events/event.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_pointer_PointerEvent_=function(type,originalEvent,opt_eventDict){_event2.default.call(this,type),this.originalEvent=originalEvent;var eventDict=opt_eventDict||{};this.buttons=this.getButtons_(eventDict),this.pressure=this.getPressure_(eventDict,this.buttons),this.bubbles="bubbles"in eventDict&&eventDict.bubbles,this.cancelable="cancelable"in eventDict&&eventDict.cancelable,this.view="view"in eventDict?eventDict.view:null,this.detail="detail"in eventDict?eventDict.detail:null,this.screenX="screenX"in eventDict?eventDict.screenX:0,this.screenY="screenY"in eventDict?eventDict.screenY:0,this.clientX="clientX"in eventDict?eventDict.clientX:0,this.clientY="clientY"in eventDict?eventDict.clientY:0,this.ctrlKey="ctrlKey"in eventDict&&eventDict.ctrlKey,this.altKey="altKey"in eventDict&&eventDict.altKey,this.shiftKey="shiftKey"in eventDict&&eventDict.shiftKey,this.metaKey="metaKey"in eventDict&&eventDict.metaKey,this.button="button"in eventDict?eventDict.button:0,this.relatedTarget="relatedTarget"in eventDict?eventDict.relatedTarget:null,this.pointerId="pointerId"in eventDict?eventDict.pointerId:0,this.width="width"in eventDict?eventDict.width:0,this.height="height"in eventDict?eventDict.height:0,this.tiltX="tiltX"in eventDict?eventDict.tiltX:0,this.tiltY="tiltY"in eventDict?eventDict.tiltY:0,this.pointerType="pointerType"in eventDict?eventDict.pointerType:"",this.hwTimestamp="hwTimestamp"in eventDict?eventDict.hwTimestamp:0,this.isPrimary="isPrimary"in eventDict&&eventDict.isPrimary,originalEvent.preventDefault&&(this.preventDefault=function(){originalEvent.preventDefault()})};_index2.default.inherits(_ol_pointer_PointerEvent_,_event2.default),_ol_pointer_PointerEvent_.prototype.getButtons_=function(eventDict){var buttons;if(eventDict.buttons||_ol_pointer_PointerEvent_.HAS_BUTTONS)buttons=eventDict.buttons;else switch(eventDict.which){case 1:buttons=1;break;case 2:buttons=4;break;case 3:buttons=2;break;default:buttons=0}return buttons},_ol_pointer_PointerEvent_.prototype.getPressure_=function(eventDict,buttons){return eventDict.pressure?eventDict.pressure:buttons?.5:0},_ol_pointer_PointerEvent_.HAS_BUTTONS=!1,function(){try{var ev=new MouseEvent("click",{buttons:1});_ol_pointer_PointerEvent_.HAS_BUTTONS=1===ev.buttons}catch(e){}}(),exports.default=_ol_pointer_PointerEvent_},{"../events/event.js":50,"../index.js":89}],139:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_events2=_interopRequireDefault(require("../events.js")),_eventtarget2=_interopRequireDefault(require("../events/eventtarget.js")),_has2=_interopRequireDefault(require("../has.js")),_eventtype2=_interopRequireDefault(require("../pointer/eventtype.js")),_mousesource2=_interopRequireDefault(require("../pointer/mousesource.js")),_mssource2=_interopRequireDefault(require("../pointer/mssource.js")),_nativesource2=_interopRequireDefault(require("../pointer/nativesource.js")),_pointerevent2=_interopRequireDefault(require("../pointer/pointerevent.js")),_touchsource2=_interopRequireDefault(require("../pointer/touchsource.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_pointer_PointerEventHandler_=function(element){_eventtarget2.default.call(this),this.element_=element,this.pointerMap={},this.eventMap_={},this.eventSourceList_=[],this.registerSources()};_index2.default.inherits(_ol_pointer_PointerEventHandler_,_eventtarget2.default),_ol_pointer_PointerEventHandler_.prototype.registerSources=function(){if(_has2.default.POINTER)this.registerSource("native",new _nativesource2.default(this));else if(_has2.default.MSPOINTER)this.registerSource("ms",new _mssource2.default(this));else{var mouseSource=new _mousesource2.default(this);this.registerSource("mouse",mouseSource),_has2.default.TOUCH&&this.registerSource("touch",new _touchsource2.default(this,mouseSource))}this.register_()},_ol_pointer_PointerEventHandler_.prototype.registerSource=function(name,source){var s=source,newEvents=s.getEvents();newEvents&&(newEvents.forEach(function(e){var handler=s.getHandlerForEvent(e);handler&&(this.eventMap_[e]=handler.bind(s))},this),this.eventSourceList_.push(s))},_ol_pointer_PointerEventHandler_.prototype.register_=function(){for(var eventSource,l=this.eventSourceList_.length,i=0;i<l;i++)eventSource=this.eventSourceList_[i],this.addEvents_(eventSource.getEvents())},_ol_pointer_PointerEventHandler_.prototype.unregister_=function(){for(var eventSource,l=this.eventSourceList_.length,i=0;i<l;i++)eventSource=this.eventSourceList_[i],this.removeEvents_(eventSource.getEvents())},_ol_pointer_PointerEventHandler_.prototype.eventHandler_=function(inEvent){var type=inEvent.type,handler=this.eventMap_[type];handler&&handler(inEvent)},_ol_pointer_PointerEventHandler_.prototype.addEvents_=function(events){events.forEach(function(eventName){_events2.default.listen(this.element_,eventName,this.eventHandler_,this)},this)},_ol_pointer_PointerEventHandler_.prototype.removeEvents_=function(events){events.forEach(function(e){_events2.default.unlisten(this.element_,e,this.eventHandler_,this)},this)},_ol_pointer_PointerEventHandler_.prototype.cloneEvent=function(event,inEvent){for(var p,eventCopy={},i=0,ii=_ol_pointer_PointerEventHandler_.CLONE_PROPS.length;i<ii;i++)eventCopy[p=_ol_pointer_PointerEventHandler_.CLONE_PROPS[i][0]]=event[p]||inEvent[p]||_ol_pointer_PointerEventHandler_.CLONE_PROPS[i][1];return eventCopy},_ol_pointer_PointerEventHandler_.prototype.down=function(data,event){this.fireEvent(_eventtype2.default.POINTERDOWN,data,event)},_ol_pointer_PointerEventHandler_.prototype.move=function(data,event){this.fireEvent(_eventtype2.default.POINTERMOVE,data,event)},_ol_pointer_PointerEventHandler_.prototype.up=function(data,event){this.fireEvent(_eventtype2.default.POINTERUP,data,event)},_ol_pointer_PointerEventHandler_.prototype.enter=function(data,event){data.bubbles=!1,this.fireEvent(_eventtype2.default.POINTERENTER,data,event)},_ol_pointer_PointerEventHandler_.prototype.leave=function(data,event){data.bubbles=!1,this.fireEvent(_eventtype2.default.POINTERLEAVE,data,event)},_ol_pointer_PointerEventHandler_.prototype.over=function(data,event){data.bubbles=!0,this.fireEvent(_eventtype2.default.POINTEROVER,data,event)},_ol_pointer_PointerEventHandler_.prototype.out=function(data,event){data.bubbles=!0,this.fireEvent(_eventtype2.default.POINTEROUT,data,event)},_ol_pointer_PointerEventHandler_.prototype.cancel=function(data,event){this.fireEvent(_eventtype2.default.POINTERCANCEL,data,event)},_ol_pointer_PointerEventHandler_.prototype.leaveOut=function(data,event){this.out(data,event),this.contains_(data.target,data.relatedTarget)||this.leave(data,event)},_ol_pointer_PointerEventHandler_.prototype.enterOver=function(data,event){this.over(data,event),this.contains_(data.target,data.relatedTarget)||this.enter(data,event)},_ol_pointer_PointerEventHandler_.prototype.contains_=function(container,contained){return!(!container||!contained)&&container.contains(contained)},_ol_pointer_PointerEventHandler_.prototype.makeEvent=function(inType,data,event){return new _pointerevent2.default(inType,event,data)},_ol_pointer_PointerEventHandler_.prototype.fireEvent=function(inType,data,event){var e=this.makeEvent(inType,data,event);this.dispatchEvent(e)},_ol_pointer_PointerEventHandler_.prototype.fireNativeEvent=function(event){var e=this.makeEvent(event.type,event,event);this.dispatchEvent(e)},_ol_pointer_PointerEventHandler_.prototype.wrapMouseEvent=function(eventType,event){return this.makeEvent(eventType,_mousesource2.default.prepareEvent(event,this),event)},_ol_pointer_PointerEventHandler_.prototype.disposeInternal=function(){this.unregister_(),_eventtarget2.default.prototype.disposeInternal.call(this)},_ol_pointer_PointerEventHandler_.CLONE_PROPS=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]],exports.default=_ol_pointer_PointerEventHandler_},{"../events.js":48,"../events/eventtarget.js":51,"../has.js":84,"../index.js":89,"../pointer/eventtype.js":134,"../pointer/mousesource.js":135,"../pointer/mssource.js":136,"../pointer/nativesource.js":137,"../pointer/pointerevent.js":138,"../pointer/touchsource.js":140}],140:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_array2=_interopRequireDefault(require("../array.js")),_eventsource2=_interopRequireDefault(require("../pointer/eventsource.js")),_mousesource2=_interopRequireDefault(require("../pointer/mousesource.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_pointer_TouchSource_=function(dispatcher,mouseSource){var mapping={touchstart:this.touchstart,touchmove:this.touchmove,touchend:this.touchend,touchcancel:this.touchcancel};_eventsource2.default.call(this,dispatcher,mapping),this.pointerMap=dispatcher.pointerMap,this.mouseSource=mouseSource,this.firstTouchId_=void 0,this.clickCount_=0,this.resetId_=void 0};_index2.default.inherits(_ol_pointer_TouchSource_,_eventsource2.default),_ol_pointer_TouchSource_.DEDUP_TIMEOUT=2500,_ol_pointer_TouchSource_.CLICK_COUNT_TIMEOUT=200,_ol_pointer_TouchSource_.POINTER_TYPE="touch",_ol_pointer_TouchSource_.prototype.isPrimaryTouch_=function(inTouch){return this.firstTouchId_===inTouch.identifier},_ol_pointer_TouchSource_.prototype.setPrimaryTouch_=function(inTouch){var count=Object.keys(this.pointerMap).length;(0===count||1===count&&_mousesource2.default.POINTER_ID.toString()in this.pointerMap)&&(this.firstTouchId_=inTouch.identifier,this.cancelResetClickCount_())},_ol_pointer_TouchSource_.prototype.removePrimaryPointer_=function(inPointer){inPointer.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())},_ol_pointer_TouchSource_.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),_ol_pointer_TouchSource_.CLICK_COUNT_TIMEOUT)},_ol_pointer_TouchSource_.prototype.resetClickCountHandler_=function(){this.clickCount_=0,this.resetId_=void 0},_ol_pointer_TouchSource_.prototype.cancelResetClickCount_=function(){void 0!==this.resetId_&&clearTimeout(this.resetId_)},_ol_pointer_TouchSource_.prototype.touchToPointer_=function(browserEvent,inTouch){var e=this.dispatcher.cloneEvent(browserEvent,inTouch);return e.pointerId=inTouch.identifier+2,e.bubbles=!0,e.cancelable=!0,e.detail=this.clickCount_,e.button=0,e.buttons=1,e.width=inTouch.webkitRadiusX||inTouch.radiusX||0,e.height=inTouch.webkitRadiusY||inTouch.radiusY||0,e.pressure=inTouch.webkitForce||inTouch.force||.5,e.isPrimary=this.isPrimaryTouch_(inTouch),e.pointerType=_ol_pointer_TouchSource_.POINTER_TYPE,e.clientX=inTouch.clientX,e.clientY=inTouch.clientY,e.screenX=inTouch.screenX,e.screenY=inTouch.screenY,e},_ol_pointer_TouchSource_.prototype.processTouches_=function(inEvent,inFunction){var i,pointer,touches=Array.prototype.slice.call(inEvent.changedTouches),count=touches.length;function preventDefault(){inEvent.preventDefault()}for(i=0;i<count;++i)(pointer=this.touchToPointer_(inEvent,touches[i])).preventDefault=preventDefault,inFunction.call(this,inEvent,pointer)},_ol_pointer_TouchSource_.prototype.findTouch_=function(touchList,searchId){for(var l=touchList.length,i=0;i<l;i++)if(touchList[i].identifier===searchId)return!0;return!1},_ol_pointer_TouchSource_.prototype.vacuumTouches_=function(inEvent){var touchList=inEvent.touches,keys=Object.keys(this.pointerMap),count=keys.length;if(count>=touchList.length){var i,key,value,d=[];for(i=0;i<count;++i)key=keys[i],value=this.pointerMap[key],key==_mousesource2.default.POINTER_ID||this.findTouch_(touchList,key-2)||d.push(value.out);for(i=0;i<d.length;++i)this.cancelOut_(inEvent,d[i])}},_ol_pointer_TouchSource_.prototype.touchstart=function(inEvent){this.vacuumTouches_(inEvent),this.setPrimaryTouch_(inEvent.changedTouches[0]),this.dedupSynthMouse_(inEvent),this.clickCount_++,this.processTouches_(inEvent,this.overDown_)},_ol_pointer_TouchSource_.prototype.overDown_=function(browserEvent,inPointer){this.pointerMap[inPointer.pointerId]={target:inPointer.target,out:inPointer,outTarget:inPointer.target},this.dispatcher.over(inPointer,browserEvent),this.dispatcher.enter(inPointer,browserEvent),this.dispatcher.down(inPointer,browserEvent)},_ol_pointer_TouchSource_.prototype.touchmove=function(inEvent){inEvent.preventDefault(),this.processTouches_(inEvent,this.moveOverOut_)},_ol_pointer_TouchSource_.prototype.moveOverOut_=function(browserEvent,inPointer){var event=inPointer,pointer=this.pointerMap[event.pointerId];if(pointer){var outEvent=pointer.out,outTarget=pointer.outTarget;this.dispatcher.move(event,browserEvent),outEvent&&outTarget!==event.target&&(outEvent.relatedTarget=event.target,event.relatedTarget=outTarget,outEvent.target=outTarget,event.target?(this.dispatcher.leaveOut(outEvent,browserEvent),this.dispatcher.enterOver(event,browserEvent)):(event.target=outTarget,event.relatedTarget=null,this.cancelOut_(browserEvent,event))),pointer.out=event,pointer.outTarget=event.target}},_ol_pointer_TouchSource_.prototype.touchend=function(inEvent){this.dedupSynthMouse_(inEvent),this.processTouches_(inEvent,this.upOut_)},_ol_pointer_TouchSource_.prototype.upOut_=function(browserEvent,inPointer){this.dispatcher.up(inPointer,browserEvent),this.dispatcher.out(inPointer,browserEvent),this.dispatcher.leave(inPointer,browserEvent),this.cleanUpPointer_(inPointer)},_ol_pointer_TouchSource_.prototype.touchcancel=function(inEvent){this.processTouches_(inEvent,this.cancelOut_)},_ol_pointer_TouchSource_.prototype.cancelOut_=function(browserEvent,inPointer){this.dispatcher.cancel(inPointer,browserEvent),this.dispatcher.out(inPointer,browserEvent),this.dispatcher.leave(inPointer,browserEvent),this.cleanUpPointer_(inPointer)},_ol_pointer_TouchSource_.prototype.cleanUpPointer_=function(inPointer){delete this.pointerMap[inPointer.pointerId],this.removePrimaryPointer_(inPointer)},_ol_pointer_TouchSource_.prototype.dedupSynthMouse_=function(inEvent){var lts=this.mouseSource.lastTouches,t=inEvent.changedTouches[0];if(this.isPrimaryTouch_(t)){var lt=[t.clientX,t.clientY];lts.push(lt),setTimeout(function(){_array2.default.remove(lts,lt)},_ol_pointer_TouchSource_.DEDUP_TIMEOUT)}},exports.default=_ol_pointer_TouchSource_},{"../array.js":29,"../index.js":89,"../pointer/eventsource.js":133,"../pointer/mousesource.js":135}],141:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_sphere2=_interopRequireDefault(require("./sphere.js")),_extent2=_interopRequireDefault(require("./extent.js")),_math2=_interopRequireDefault(require("./math.js")),_epsg2=_interopRequireDefault(require("./proj/epsg3857.js")),_epsg4=_interopRequireDefault(require("./proj/epsg4326.js")),_projection2=_interopRequireDefault(require("./proj/projection.js")),_units2=_interopRequireDefault(require("./proj/units.js")),_proj2=_interopRequireDefault(require("./proj/proj4.js")),_projections2=_interopRequireDefault(require("./proj/projections.js")),_transforms2=_interopRequireDefault(require("./proj/transforms.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_proj_={};_ol_proj_.METERS_PER_UNIT=_units2.default.METERS_PER_UNIT,_ol_proj_.SPHERE_=new _sphere2.default(_sphere2.default.DEFAULT_RADIUS),_index2.default.ENABLE_PROJ4JS&&(_ol_proj_.setProj4=function(proj4){_proj2.default.set(proj4)}),_ol_proj_.getPointResolution=function(projection,resolution,point,opt_units){var pointResolution,getter=(projection=_ol_proj_.get(projection)).getPointResolutionFunc();if(getter)pointResolution=getter(resolution,point);else if(projection.getUnits()==_units2.default.DEGREES&&!opt_units||opt_units==_units2.default.DEGREES)pointResolution=resolution;else{var toEPSG4326=_ol_proj_.getTransformFromProjections(projection,_ol_proj_.get("EPSG:4326")),vertices=[point[0]-resolution/2,point[1],point[0]+resolution/2,point[1],point[0],point[1]-resolution/2,point[0],point[1]+resolution/2];vertices=toEPSG4326(vertices,vertices,2),pointResolution=(_ol_proj_.SPHERE_.haversineDistance(vertices.slice(0,2),vertices.slice(2,4))+_ol_proj_.SPHERE_.haversineDistance(vertices.slice(4,6),vertices.slice(6,8)))/2;var metersPerUnit=opt_units?_units2.default.METERS_PER_UNIT[opt_units]:projection.getMetersPerUnit();void 0!==metersPerUnit&&(pointResolution/=metersPerUnit)}return pointResolution},_ol_proj_.addEquivalentProjections=function(projections){_ol_proj_.addProjections(projections),projections.forEach(function(source){projections.forEach(function(destination){source!==destination&&_transforms2.default.add(source,destination,_ol_proj_.cloneTransform)})})},_ol_proj_.addEquivalentTransforms=function(projections1,projections2,forwardTransform,inverseTransform){projections1.forEach(function(projection1){projections2.forEach(function(projection2){_transforms2.default.add(projection1,projection2,forwardTransform),_transforms2.default.add(projection2,projection1,inverseTransform)})})},_ol_proj_.addProjection=function(projection){_projections2.default.add(projection.getCode(),projection),_transforms2.default.add(projection,projection,_ol_proj_.cloneTransform)},_ol_proj_.addProjections=function(projections){projections.forEach(_ol_proj_.addProjection)},_ol_proj_.clearAllProjections=function(){_projections2.default.clear(),_transforms2.default.clear()},_ol_proj_.createProjection=function(projection,defaultCode){return projection?"string"==typeof projection?_ol_proj_.get(projection):projection:_ol_proj_.get(defaultCode)},_ol_proj_.addCoordinateTransforms=function(source,destination,forward,inverse){var sourceProj=_ol_proj_.get(source),destProj=_ol_proj_.get(destination);_transforms2.default.add(sourceProj,destProj,_ol_proj_.createTransformFromCoordinateTransform(forward)),_transforms2.default.add(destProj,sourceProj,_ol_proj_.createTransformFromCoordinateTransform(inverse))},_ol_proj_.createTransformFromCoordinateTransform=function(transform){return function(input,opt_output,opt_dimension){var point,i,j,length=input.length,dimension=void 0!==opt_dimension?opt_dimension:2,output=void 0!==opt_output?opt_output:new Array(length);for(i=0;i<length;i+=dimension)for(point=transform([input[i],input[i+1]]),output[i]=point[0],output[i+1]=point[1],j=dimension-1;2<=j;--j)output[i+j]=input[i+j];return output}},_ol_proj_.fromLonLat=function(coordinate,opt_projection){return _ol_proj_.transform(coordinate,"EPSG:4326",void 0!==opt_projection?opt_projection:"EPSG:3857")},_ol_proj_.toLonLat=function(coordinate,opt_projection){var lonLat=_ol_proj_.transform(coordinate,void 0!==opt_projection?opt_projection:"EPSG:3857","EPSG:4326"),lon=lonLat[0];return(lon<-180||180<lon)&&(lonLat[0]=_math2.default.modulo(lon+180,360)-180),lonLat},_ol_proj_.get=function(projectionLike){var projection=null;if(projectionLike instanceof _projection2.default)projection=projectionLike;else if("string"==typeof projectionLike){var code=projectionLike;if(projection=_projections2.default.get(code),_index2.default.ENABLE_PROJ4JS&&!projection){var proj4js=_proj2.default.get();"function"==typeof proj4js&&void 0!==proj4js.defs(code)&&(projection=new _projection2.default({code:code}),_ol_proj_.addProjection(projection))}}return projection},_ol_proj_.equivalent=function(projection1,projection2){if(projection1===projection2)return!0;var equalUnits=projection1.getUnits()===projection2.getUnits();return projection1.getCode()===projection2.getCode()?equalUnits:_ol_proj_.getTransformFromProjections(projection1,projection2)===_ol_proj_.cloneTransform&&equalUnits},_ol_proj_.getTransform=function(source,destination){var sourceProjection=_ol_proj_.get(source),destinationProjection=_ol_proj_.get(destination);return _ol_proj_.getTransformFromProjections(sourceProjection,destinationProjection)},_ol_proj_.getTransformFromProjections=function(sourceProjection,destinationProjection){var sourceCode=sourceProjection.getCode(),destinationCode=destinationProjection.getCode(),transform=_transforms2.default.get(sourceCode,destinationCode);if(_index2.default.ENABLE_PROJ4JS&&!transform){var proj4js=_proj2.default.get();if("function"==typeof proj4js){var sourceDef=proj4js.defs(sourceCode),destinationDef=proj4js.defs(destinationCode);if(void 0!==sourceDef&&void 0!==destinationDef){if(sourceDef===destinationDef)_ol_proj_.addEquivalentProjections([destinationProjection,sourceProjection]);else{var proj4Transform=proj4js(destinationCode,sourceCode);_ol_proj_.addCoordinateTransforms(destinationProjection,sourceProjection,proj4Transform.forward,proj4Transform.inverse)}transform=_transforms2.default.get(sourceCode,destinationCode)}}}return transform||(transform=_ol_proj_.identityTransform),transform},_ol_proj_.identityTransform=function(input,opt_output,opt_dimension){if(void 0!==opt_output&&input!==opt_output){for(var i=0,ii=input.length;i<ii;++i)opt_output[i]=input[i];input=opt_output}return input},_ol_proj_.cloneTransform=function(input,opt_output,opt_dimension){var output;if(void 0!==opt_output){for(var i=0,ii=input.length;i<ii;++i)opt_output[i]=input[i];output=opt_output}else output=input.slice();return output},_ol_proj_.transform=function(coordinate,source,destination){return _ol_proj_.getTransform(source,destination)(coordinate,void 0,coordinate.length)},_ol_proj_.transformExtent=function(extent,source,destination){var transformFn=_ol_proj_.getTransform(source,destination);return _extent2.default.applyTransform(extent,transformFn)},_ol_proj_.transformWithProjections=function(point,sourceProjection,destinationProjection){return _ol_proj_.getTransformFromProjections(sourceProjection,destinationProjection)(point)},_ol_proj_.addCommon=function(){_ol_proj_.addEquivalentProjections(_epsg2.default.PROJECTIONS),_ol_proj_.addEquivalentProjections(_epsg4.default.PROJECTIONS),_ol_proj_.addEquivalentTransforms(_epsg4.default.PROJECTIONS,_epsg2.default.PROJECTIONS,_epsg2.default.fromEPSG4326,_epsg2.default.toEPSG4326)},_ol_proj_.addCommon(),exports.default=_ol_proj_},{"./extent.js":54,"./index.js":89,"./math.js":123,"./proj/epsg3857.js":142,"./proj/epsg4326.js":143,"./proj/proj4.js":144,"./proj/projection.js":145,"./proj/projections.js":146,"./proj/transforms.js":147,"./proj/units.js":148,"./sphere.js":215}],142:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_math2=_interopRequireDefault(require("../math.js")),_projection2=_interopRequireDefault(require("../proj/projection.js")),_units2=_interopRequireDefault(require("../proj/units.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_proj_EPSG3857_={Projection_:function(code){_projection2.default.call(this,{code:code,units:_units2.default.METERS,extent:_ol_proj_EPSG3857_.EXTENT,global:!0,worldExtent:_ol_proj_EPSG3857_.WORLD_EXTENT,getPointResolution:function(resolution,point){return resolution/_math2.default.cosh(point[1]/_ol_proj_EPSG3857_.RADIUS)}})}};_index2.default.inherits(_ol_proj_EPSG3857_.Projection_,_projection2.default),_ol_proj_EPSG3857_.RADIUS=6378137,_ol_proj_EPSG3857_.HALF_SIZE=Math.PI*_ol_proj_EPSG3857_.RADIUS,_ol_proj_EPSG3857_.EXTENT=[-_ol_proj_EPSG3857_.HALF_SIZE,-_ol_proj_EPSG3857_.HALF_SIZE,_ol_proj_EPSG3857_.HALF_SIZE,_ol_proj_EPSG3857_.HALF_SIZE],_ol_proj_EPSG3857_.WORLD_EXTENT=[-180,-85,180,85],_ol_proj_EPSG3857_.PROJECTIONS=[new _ol_proj_EPSG3857_.Projection_("EPSG:3857"),new _ol_proj_EPSG3857_.Projection_("EPSG:102100"),new _ol_proj_EPSG3857_.Projection_("EPSG:102113"),new _ol_proj_EPSG3857_.Projection_("EPSG:900913"),new _ol_proj_EPSG3857_.Projection_("urn:ogc:def:crs:EPSG:6.18:3:3857"),new _ol_proj_EPSG3857_.Projection_("urn:ogc:def:crs:EPSG::3857"),new _ol_proj_EPSG3857_.Projection_("http://www.opengis.net/gml/srs/epsg.xml#3857")],_ol_proj_EPSG3857_.fromEPSG4326=function(input,opt_output,opt_dimension){var length=input.length,dimension=1<opt_dimension?opt_dimension:2,output=opt_output;void 0===output&&(output=2<dimension?input.slice():new Array(length));for(var halfSize=_ol_proj_EPSG3857_.HALF_SIZE,i=0;i<length;i+=dimension){output[i]=halfSize*input[i]/180;var y=_ol_proj_EPSG3857_.RADIUS*Math.log(Math.tan(Math.PI*(input[i+1]+90)/360));halfSize<y?y=halfSize:y<-halfSize&&(y=-halfSize),output[i+1]=y}return output},_ol_proj_EPSG3857_.toEPSG4326=function(input,opt_output,opt_dimension){var length=input.length,dimension=1<opt_dimension?opt_dimension:2,output=opt_output;void 0===output&&(output=2<dimension?input.slice():new Array(length));for(var i=0;i<length;i+=dimension)output[i]=180*input[i]/_ol_proj_EPSG3857_.HALF_SIZE,output[i+1]=360*Math.atan(Math.exp(input[i+1]/_ol_proj_EPSG3857_.RADIUS))/Math.PI-90;return output},exports.default=_ol_proj_EPSG3857_},{"../index.js":89,"../math.js":123,"../proj/projection.js":145,"../proj/units.js":148}],143:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_projection2=_interopRequireDefault(require("../proj/projection.js")),_units2=_interopRequireDefault(require("../proj/units.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_proj_EPSG4326_={Projection_:function(code,opt_axisOrientation){_projection2.default.call(this,{code:code,units:_units2.default.DEGREES,extent:_ol_proj_EPSG4326_.EXTENT,axisOrientation:opt_axisOrientation,global:!0,metersPerUnit:_ol_proj_EPSG4326_.METERS_PER_UNIT,worldExtent:_ol_proj_EPSG4326_.EXTENT})}};_index2.default.inherits(_ol_proj_EPSG4326_.Projection_,_projection2.default),_ol_proj_EPSG4326_.RADIUS=6378137,_ol_proj_EPSG4326_.EXTENT=[-180,-90,180,90],_ol_proj_EPSG4326_.METERS_PER_UNIT=Math.PI*_ol_proj_EPSG4326_.RADIUS/180,_ol_proj_EPSG4326_.PROJECTIONS=[new _ol_proj_EPSG4326_.Projection_("CRS:84"),new _ol_proj_EPSG4326_.Projection_("EPSG:4326","neu"),new _ol_proj_EPSG4326_.Projection_("urn:ogc:def:crs:EPSG::4326","neu"),new _ol_proj_EPSG4326_.Projection_("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new _ol_proj_EPSG4326_.Projection_("urn:ogc:def:crs:OGC:1.3:CRS84"),new _ol_proj_EPSG4326_.Projection_("urn:ogc:def:crs:OGC:2:84"),new _ol_proj_EPSG4326_.Projection_("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new _ol_proj_EPSG4326_.Projection_("urn:x-ogc:def:crs:EPSG:4326","neu")],exports.default=_ol_proj_EPSG4326_},{"../index.js":89,"../proj/projection.js":145,"../proj/units.js":148}],144:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_proj_proj4_={cache_:null,set:function(proj4){_ol_proj_proj4_.cache_=proj4},get:function(){return _ol_proj_proj4_.cache_||window.proj4}};exports.default=_ol_proj_proj4_},{}],145:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_units2=_interopRequireDefault(require("../proj/units.js")),_proj2=_interopRequireDefault(require("../proj/proj4.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_proj_Projection_=function(options){this.code_=options.code,this.units_=options.units,this.extent_=void 0!==options.extent?options.extent:null,this.worldExtent_=void 0!==options.worldExtent?options.worldExtent:null,this.axisOrientation_=void 0!==options.axisOrientation?options.axisOrientation:"enu",this.global_=void 0!==options.global&&options.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=options.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=options.metersPerUnit;var code=options.code;if(_index2.default.ENABLE_PROJ4JS){var proj4js=_proj2.default.get();if("function"==typeof proj4js){var def=proj4js.defs(code);void 0!==def&&(void 0!==def.axis&&void 0===options.axisOrientation&&(this.axisOrientation_=def.axis),void 0===options.metersPerUnit&&(this.metersPerUnit_=def.to_meter),void 0===options.units&&(this.units_=def.units))}}};_ol_proj_Projection_.prototype.canWrapX=function(){return this.canWrapX_},_ol_proj_Projection_.prototype.getCode=function(){return this.code_},_ol_proj_Projection_.prototype.getExtent=function(){return this.extent_},_ol_proj_Projection_.prototype.getUnits=function(){return this.units_},_ol_proj_Projection_.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||_units2.default.METERS_PER_UNIT[this.units_]},_ol_proj_Projection_.prototype.getWorldExtent=function(){return this.worldExtent_},_ol_proj_Projection_.prototype.getAxisOrientation=function(){return this.axisOrientation_},_ol_proj_Projection_.prototype.isGlobal=function(){return this.global_},_ol_proj_Projection_.prototype.setGlobal=function(global){this.global_=global,this.canWrapX_=!(!global||!this.extent_)},_ol_proj_Projection_.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},_ol_proj_Projection_.prototype.setDefaultTileGrid=function(tileGrid){this.defaultTileGrid_=tileGrid},_ol_proj_Projection_.prototype.setExtent=function(extent){this.extent_=extent,this.canWrapX_=!(!this.global_||!extent)},_ol_proj_Projection_.prototype.setWorldExtent=function(worldExtent){this.worldExtent_=worldExtent},_ol_proj_Projection_.prototype.setGetPointResolution=function(func){this.getPointResolutionFunc_=func},_ol_proj_Projection_.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},exports.default=_ol_proj_Projection_},{"../index.js":89,"../proj/proj4.js":144,"../proj/units.js":148}],146:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_proj_projections_={cache_:{},clear:function(){_ol_proj_projections_.cache_={}},get:function(code){return _ol_proj_projections_.cache_[code]||null},add:function(code,projection){_ol_proj_projections_.cache_[code]=projection}};exports.default=_ol_proj_projections_},{}],147:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_obj=require("../obj.js"),_obj2=(obj=_obj)&&obj.__esModule?obj:{default:obj};var _ol_proj_transforms_={cache_:{},clear:function(){_ol_proj_transforms_.cache_={}},add:function(source,destination,transformFn){var sourceCode=source.getCode(),destinationCode=destination.getCode(),transforms=_ol_proj_transforms_.cache_;sourceCode in transforms||(transforms[sourceCode]={}),transforms[sourceCode][destinationCode]=transformFn},remove:function(source,destination){var sourceCode=source.getCode(),destinationCode=destination.getCode(),transforms=_ol_proj_transforms_.cache_,transform=transforms[sourceCode][destinationCode];return delete transforms[sourceCode][destinationCode],_obj2.default.isEmpty(transforms[sourceCode])&&delete transforms[sourceCode],transform},get:function(sourceCode,destinationCode){var transform,transforms=_ol_proj_transforms_.cache_;return sourceCode in transforms&&destinationCode in transforms[sourceCode]&&(transform=transforms[sourceCode][destinationCode]),transform}};exports.default=_ol_proj_transforms_},{"../obj.js":124}],148:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_proj_Units_={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft",METERS_PER_UNIT:{}};_ol_proj_Units_.METERS_PER_UNIT[_ol_proj_Units_.DEGREES]=2*Math.PI*6370997/360,_ol_proj_Units_.METERS_PER_UNIT[_ol_proj_Units_.FEET]=.3048,_ol_proj_Units_.METERS_PER_UNIT[_ol_proj_Units_.METERS]=1,_ol_proj_Units_.METERS_PER_UNIT[_ol_proj_Units_.USFEET]=1200/3937,exports.default=_ol_proj_Units_},{}],149:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_disposable2=_interopRequireDefault(require("../disposable.js")),_polygon2=_interopRequireDefault(require("../geom/polygon.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_Box_=function(className){this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.className="ol-box "+className,this.map_=null,this.startPixel_=null,this.endPixel_=null};_index2.default.inherits(_ol_render_Box_,_disposable2.default),_ol_render_Box_.prototype.disposeInternal=function(){this.setMap(null)},_ol_render_Box_.prototype.render_=function(){var startPixel=this.startPixel_,endPixel=this.endPixel_,style=this.element_.style;style.left=Math.min(startPixel[0],endPixel[0])+"px",style.top=Math.min(startPixel[1],endPixel[1])+"px",style.width=Math.abs(endPixel[0]-startPixel[0])+"px",style.height=Math.abs(endPixel[1]-startPixel[1])+"px"},_ol_render_Box_.prototype.setMap=function(map){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var style=this.element_.style;style.left=style.top=style.width=style.height="inherit"}this.map_=map,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},_ol_render_Box_.prototype.setPixels=function(startPixel,endPixel){this.startPixel_=startPixel,this.endPixel_=endPixel,this.createOrUpdateGeometry(),this.render_()},_ol_render_Box_.prototype.createOrUpdateGeometry=function(){var startPixel=this.startPixel_,endPixel=this.endPixel_,coordinates=[startPixel,[startPixel[0],endPixel[1]],endPixel,[endPixel[0],startPixel[1]]].map(this.map_.getCoordinateFromPixel,this.map_);coordinates[4]=coordinates[0].slice(),this.geometry_?this.geometry_.setCoordinates([coordinates]):this.geometry_=new _polygon2.default([coordinates])},_ol_render_Box_.prototype.getGeometry=function(){return this.geometry_},exports.default=_ol_render_Box_},{"../disposable.js":45,"../geom/polygon.js":82,"../index.js":89}],150:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _css2=_interopRequireDefault(require("../css.js")),_dom2=_interopRequireDefault(require("../dom.js")),_obj2=_interopRequireDefault(require("../obj.js")),_lrucache2=_interopRequireDefault(require("../structs/lrucache.js")),_transform2=_interopRequireDefault(require("../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var span,heights,_ol_render_canvas_={};_ol_render_canvas_.defaultFont="10px sans-serif",_ol_render_canvas_.defaultFillStyle=[0,0,0,1],_ol_render_canvas_.defaultLineCap="round",_ol_render_canvas_.defaultLineDash=[],_ol_render_canvas_.defaultLineDashOffset=0,_ol_render_canvas_.defaultLineJoin="round",_ol_render_canvas_.defaultMiterLimit=10,_ol_render_canvas_.defaultStrokeStyle=[0,0,0,1],_ol_render_canvas_.defaultTextAlign="center",_ol_render_canvas_.defaultTextBaseline="middle",_ol_render_canvas_.defaultPadding=[0,0,0,0],_ol_render_canvas_.defaultLineWidth=1,_ol_render_canvas_.labelCache=new _lrucache2.default,_ol_render_canvas_.checkedFonts_={},_ol_render_canvas_.measureContext_=null,_ol_render_canvas_.textHeights_={},_ol_render_canvas_.checkFont=function(){var interval,referenceWidth,retries=60,checked=_ol_render_canvas_.checkedFonts_,labelCache=_ol_render_canvas_.labelCache,font="32px monospace",text="wmytzilWMYTZIL@#/&?$%10";function isAvailable(fontFamily){var context=_ol_render_canvas_.getMeasureContext();context.font=font,referenceWidth=context.measureText(text).width;var available=!0;"monospace"!=fontFamily&&(context.font="32px "+fontFamily+",monospace",available=context.measureText(text).width!=referenceWidth);return available}function check(){var done=!0;for(var font in checked)checked[font]<retries&&(isAvailable(font)?(checked[font]=retries,_obj2.default.clear(_ol_render_canvas_.textHeights_),_ol_render_canvas_.measureContext_=null,labelCache.clear()):(++checked[font],done=!1));done&&(window.clearInterval(interval),interval=void 0)}return function(fontSpec){var fontFamilies=_css2.default.getFontFamilies(fontSpec);if(fontFamilies)for(var i=0,ii=fontFamilies.length;i<ii;++i){var fontFamily=fontFamilies[i];fontFamily in checked||(checked[fontFamily]=retries,isAvailable(fontFamily)||void(checked[fontFamily]=0)===interval&&(interval=window.setInterval(check,32)))}}}(),_ol_render_canvas_.getMeasureContext=function(){var context=_ol_render_canvas_.measureContext_;return context||(context=_ol_render_canvas_.measureContext_=_dom2.default.createCanvasContext2D(1,1)),context},_ol_render_canvas_.measureTextHeight=(heights=_ol_render_canvas_.textHeights_,function(font){var height=heights[font];return null==height&&(span||((span=document.createElement("span")).textContent="M",span.style.margin=span.style.padding="0 !important",span.style.position="absolute !important",span.style.left="-99999px !important"),span.style.font=font,document.body.appendChild(span),height=heights[font]=span.offsetHeight,document.body.removeChild(span)),height}),_ol_render_canvas_.measureTextWidth=function(font,text){var measureContext=_ol_render_canvas_.getMeasureContext();return font!=measureContext.font&&(measureContext.font=font),measureContext.measureText(text).width},_ol_render_canvas_.rotateAtOffset=function(context,rotation,offsetX,offsetY){0!==rotation&&(context.translate(offsetX,offsetY),context.rotate(rotation),context.translate(-offsetX,-offsetY))},_ol_render_canvas_.resetTransform_=_transform2.default.create(),_ol_render_canvas_.drawImage=function(context,transform,opacity,image,originX,originY,w,h,x,y,scale){var alpha;1!=opacity&&(alpha=context.globalAlpha,context.globalAlpha=alpha*opacity),transform&&context.setTransform.apply(context,transform),context.drawImage(image,originX,originY,w,h,x,y,w*scale,h*scale),alpha&&(context.globalAlpha=alpha),transform&&context.setTransform.apply(context,_ol_render_canvas_.resetTransform_)},exports.default=_ol_render_canvas_},{"../css.js":44,"../dom.js":46,"../obj.js":124,"../structs/lrucache.js":218,"../transform.js":243}],151:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_instruction2=_interopRequireDefault(require("../canvas/instruction.js")),_replay2=_interopRequireDefault(require("../canvas/replay.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_canvas_ImageReplay_=function(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){_replay2.default.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.snapToPixel_=void 0,this.width_=void 0};_index2.default.inherits(_ol_render_canvas_ImageReplay_,_replay2.default),_ol_render_canvas_ImageReplay_.prototype.drawCoordinates_=function(flatCoordinates,offset,end,stride){return this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1)},_ol_render_canvas_ImageReplay_.prototype.drawPoint=function(pointGeometry,feature){if(this.image_){this.beginGeometry(pointGeometry,feature);var flatCoordinates=pointGeometry.getFlatCoordinates(),stride=pointGeometry.getStride(),myBegin=this.coordinates.length,myEnd=this.drawCoordinates_(flatCoordinates,0,flatCoordinates.length,stride);this.instructions.push([_instruction2.default.DRAW_IMAGE,myBegin,myEnd,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([_instruction2.default.DRAW_IMAGE,myBegin,myEnd,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(pointGeometry,feature)}},_ol_render_canvas_ImageReplay_.prototype.drawMultiPoint=function(multiPointGeometry,feature){if(this.image_){this.beginGeometry(multiPointGeometry,feature);var flatCoordinates=multiPointGeometry.getFlatCoordinates(),stride=multiPointGeometry.getStride(),myBegin=this.coordinates.length,myEnd=this.drawCoordinates_(flatCoordinates,0,flatCoordinates.length,stride);this.instructions.push([_instruction2.default.DRAW_IMAGE,myBegin,myEnd,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([_instruction2.default.DRAW_IMAGE,myBegin,myEnd,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(multiPointGeometry,feature)}},_ol_render_canvas_ImageReplay_.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.snapToPixel_=void 0,this.width_=void 0},_ol_render_canvas_ImageReplay_.prototype.setImageStyle=function(imageStyle,declutterGroup){var anchor=imageStyle.getAnchor(),size=imageStyle.getSize(),hitDetectionImage=imageStyle.getHitDetectionImage(1),image=imageStyle.getImage(1),origin=imageStyle.getOrigin();this.anchorX_=anchor[0],this.anchorY_=anchor[1],this.declutterGroup_=declutterGroup,this.hitDetectionImage_=hitDetectionImage,this.image_=image,this.height_=size[1],this.opacity_=imageStyle.getOpacity(),this.originX_=origin[0],this.originY_=origin[1],this.rotateWithView_=imageStyle.getRotateWithView(),this.rotation_=imageStyle.getRotation(),this.scale_=imageStyle.getScale(),this.snapToPixel_=imageStyle.getSnapToPixel(),this.width_=size[0]},exports.default=_ol_render_canvas_ImageReplay_},{"../../index.js":89,"../canvas/instruction.js":153,"../canvas/replay.js":156}],152:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_array2=_interopRequireDefault(require("../../array.js")),_colorlike2=_interopRequireDefault(require("../../colorlike.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_geometrytype2=_interopRequireDefault(require("../../geom/geometrytype.js")),_simplegeometry2=_interopRequireDefault(require("../../geom/simplegeometry.js")),_transform2=_interopRequireDefault(require("../../geom/flat/transform.js")),_has2=_interopRequireDefault(require("../../has.js")),_vectorcontext2=_interopRequireDefault(require("../vectorcontext.js")),_canvas2=_interopRequireDefault(require("../canvas.js")),_transform4=_interopRequireDefault(require("../../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_canvas_Immediate_=function(context,pixelRatio,extent,transform,viewRotation){_vectorcontext2.default.call(this),this.context_=context,this.pixelRatio_=pixelRatio,this.extent_=extent,this.transform_=transform,this.viewRotation_=viewRotation,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=0,this.imageSnapToPixel_=!1,this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=0,this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=_transform4.default.create()};_index2.default.inherits(_ol_render_canvas_Immediate_,_vectorcontext2.default),_ol_render_canvas_Immediate_.prototype.drawImages_=function(flatCoordinates,offset,end,stride){if(this.image_){var pixelCoordinates=_transform2.default.transform2D(flatCoordinates,offset,end,2,this.transform_,this.pixelCoordinates_),context=this.context_,localTransform=this.tmpLocalTransform_,alpha=context.globalAlpha;1!=this.imageOpacity_&&(context.globalAlpha=alpha*this.imageOpacity_);var i,ii,rotation=this.imageRotation_;for(this.imageRotateWithView_&&(rotation+=this.viewRotation_),i=0,ii=pixelCoordinates.length;i<ii;i+=2){var x=pixelCoordinates[i]-this.imageAnchorX_,y=pixelCoordinates[i+1]-this.imageAnchorY_;if(this.imageSnapToPixel_&&(x=Math.round(x),y=Math.round(y)),0!==rotation||1!=this.imageScale_){var centerX=x+this.imageAnchorX_,centerY=y+this.imageAnchorY_;_transform4.default.compose(localTransform,centerX,centerY,this.imageScale_,this.imageScale_,rotation,-centerX,-centerY),context.setTransform.apply(context,localTransform)}context.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,x,y,this.imageWidth_,this.imageHeight_)}0===rotation&&1==this.imageScale_||context.setTransform(1,0,0,1,0,0),1!=this.imageOpacity_&&(context.globalAlpha=alpha)}},_ol_render_canvas_Immediate_.prototype.drawText_=function(flatCoordinates,offset,end,stride){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var pixelCoordinates=_transform2.default.transform2D(flatCoordinates,offset,end,stride,this.transform_,this.pixelCoordinates_),context=this.context_,rotation=this.textRotation_;for(this.textRotateWithView_&&(rotation+=this.viewRotation_);offset<end;offset+=stride){var x=pixelCoordinates[offset]+this.textOffsetX_,y=pixelCoordinates[offset+1]+this.textOffsetY_;if(0!==rotation||1!=this.textScale_){var localTransform=_transform4.default.compose(this.tmpLocalTransform_,x,y,this.textScale_,this.textScale_,rotation,-x,-y);context.setTransform.apply(context,localTransform)}this.textStrokeState_&&context.strokeText(this.text_,x,y),this.textFillState_&&context.fillText(this.text_,x,y)}0===rotation&&1==this.textScale_||context.setTransform(1,0,0,1,0,0)}},_ol_render_canvas_Immediate_.prototype.moveToLineTo_=function(flatCoordinates,offset,end,stride,close){var context=this.context_,pixelCoordinates=_transform2.default.transform2D(flatCoordinates,offset,end,stride,this.transform_,this.pixelCoordinates_);context.moveTo(pixelCoordinates[0],pixelCoordinates[1]);var length=pixelCoordinates.length;close&&(length-=2);for(var i=2;i<length;i+=2)context.lineTo(pixelCoordinates[i],pixelCoordinates[i+1]);return close&&context.closePath(),end},_ol_render_canvas_Immediate_.prototype.drawRings_=function(flatCoordinates,offset,ends,stride){var i,ii;for(i=0,ii=ends.length;i<ii;++i)offset=this.moveToLineTo_(flatCoordinates,offset,ends[i],stride,!0);return offset},_ol_render_canvas_Immediate_.prototype.drawCircle=function(geometry){if(_extent2.default.intersects(this.extent_,geometry.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var pixelCoordinates=_simplegeometry2.default.transform2D(geometry,this.transform_,this.pixelCoordinates_),dx=pixelCoordinates[2]-pixelCoordinates[0],dy=pixelCoordinates[3]-pixelCoordinates[1],radius=Math.sqrt(dx*dx+dy*dy),context=this.context_;context.beginPath(),context.arc(pixelCoordinates[0],pixelCoordinates[1],radius,0,2*Math.PI),this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}""!==this.text_&&this.drawText_(geometry.getCenter(),0,2,2)}},_ol_render_canvas_Immediate_.prototype.setStyle=function(style){this.setFillStrokeStyle(style.getFill(),style.getStroke()),this.setImageStyle(style.getImage()),this.setTextStyle(style.getText())},_ol_render_canvas_Immediate_.prototype.drawGeometry=function(geometry){switch(geometry.getType()){case _geometrytype2.default.POINT:this.drawPoint(geometry);break;case _geometrytype2.default.LINE_STRING:this.drawLineString(geometry);break;case _geometrytype2.default.POLYGON:this.drawPolygon(geometry);break;case _geometrytype2.default.MULTI_POINT:this.drawMultiPoint(geometry);break;case _geometrytype2.default.MULTI_LINE_STRING:this.drawMultiLineString(geometry);break;case _geometrytype2.default.MULTI_POLYGON:this.drawMultiPolygon(geometry);break;case _geometrytype2.default.GEOMETRY_COLLECTION:this.drawGeometryCollection(geometry);break;case _geometrytype2.default.CIRCLE:this.drawCircle(geometry)}},_ol_render_canvas_Immediate_.prototype.drawFeature=function(feature,style){var geometry=style.getGeometryFunction()(feature);geometry&&_extent2.default.intersects(this.extent_,geometry.getExtent())&&(this.setStyle(style),this.drawGeometry(geometry))},_ol_render_canvas_Immediate_.prototype.drawGeometryCollection=function(geometry){var i,ii,geometries=geometry.getGeometriesArray();for(i=0,ii=geometries.length;i<ii;++i)this.drawGeometry(geometries[i])},_ol_render_canvas_Immediate_.prototype.drawPoint=function(geometry){var flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride();this.image_&&this.drawImages_(flatCoordinates,0,flatCoordinates.length,stride),""!==this.text_&&this.drawText_(flatCoordinates,0,flatCoordinates.length,stride)},_ol_render_canvas_Immediate_.prototype.drawMultiPoint=function(geometry){var flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride();this.image_&&this.drawImages_(flatCoordinates,0,flatCoordinates.length,stride),""!==this.text_&&this.drawText_(flatCoordinates,0,flatCoordinates.length,stride)},_ol_render_canvas_Immediate_.prototype.drawLineString=function(geometry){if(_extent2.default.intersects(this.extent_,geometry.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var context=this.context_,flatCoordinates=geometry.getFlatCoordinates();context.beginPath(),this.moveToLineTo_(flatCoordinates,0,flatCoordinates.length,geometry.getStride(),!1),context.stroke()}if(""!==this.text_){var flatMidpoint=geometry.getFlatMidpoint();this.drawText_(flatMidpoint,0,2,2)}}},_ol_render_canvas_Immediate_.prototype.drawMultiLineString=function(geometry){var geometryExtent=geometry.getExtent();if(_extent2.default.intersects(this.extent_,geometryExtent)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i,ii,context=this.context_,flatCoordinates=geometry.getFlatCoordinates(),offset=0,ends=geometry.getEnds(),stride=geometry.getStride();for(context.beginPath(),i=0,ii=ends.length;i<ii;++i)offset=this.moveToLineTo_(flatCoordinates,offset,ends[i],stride,!1);context.stroke()}if(""!==this.text_){var flatMidpoints=geometry.getFlatMidpoints();this.drawText_(flatMidpoints,0,flatMidpoints.length,2)}}},_ol_render_canvas_Immediate_.prototype.drawPolygon=function(geometry){if(_extent2.default.intersects(this.extent_,geometry.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var context=this.context_;context.beginPath(),this.drawRings_(geometry.getOrientedFlatCoordinates(),0,geometry.getEnds(),geometry.getStride()),this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}if(""!==this.text_){var flatInteriorPoint=geometry.getFlatInteriorPoint();this.drawText_(flatInteriorPoint,0,2,2)}}},_ol_render_canvas_Immediate_.prototype.drawMultiPolygon=function(geometry){if(_extent2.default.intersects(this.extent_,geometry.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var i,ii,context=this.context_,flatCoordinates=geometry.getOrientedFlatCoordinates(),offset=0,endss=geometry.getEndss(),stride=geometry.getStride();for(context.beginPath(),i=0,ii=endss.length;i<ii;++i){var ends=endss[i];offset=this.drawRings_(flatCoordinates,offset,ends,stride)}this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}if(""!==this.text_){var flatInteriorPoints=geometry.getFlatInteriorPoints();this.drawText_(flatInteriorPoints,0,flatInteriorPoints.length,2)}}},_ol_render_canvas_Immediate_.prototype.setContextFillState_=function(fillState){var context=this.context_,contextFillState=this.contextFillState_;contextFillState?contextFillState.fillStyle!=fillState.fillStyle&&(contextFillState.fillStyle=context.fillStyle=fillState.fillStyle):(context.fillStyle=fillState.fillStyle,this.contextFillState_={fillStyle:fillState.fillStyle})},_ol_render_canvas_Immediate_.prototype.setContextStrokeState_=function(strokeState){var context=this.context_,contextStrokeState=this.contextStrokeState_;contextStrokeState?(contextStrokeState.lineCap!=strokeState.lineCap&&(contextStrokeState.lineCap=context.lineCap=strokeState.lineCap),_has2.default.CANVAS_LINE_DASH&&(_array2.default.equals(contextStrokeState.lineDash,strokeState.lineDash)||context.setLineDash(contextStrokeState.lineDash=strokeState.lineDash),contextStrokeState.lineDashOffset!=strokeState.lineDashOffset&&(contextStrokeState.lineDashOffset=context.lineDashOffset=strokeState.lineDashOffset)),contextStrokeState.lineJoin!=strokeState.lineJoin&&(contextStrokeState.lineJoin=context.lineJoin=strokeState.lineJoin),contextStrokeState.lineWidth!=strokeState.lineWidth&&(contextStrokeState.lineWidth=context.lineWidth=strokeState.lineWidth),contextStrokeState.miterLimit!=strokeState.miterLimit&&(contextStrokeState.miterLimit=context.miterLimit=strokeState.miterLimit),contextStrokeState.strokeStyle!=strokeState.strokeStyle&&(contextStrokeState.strokeStyle=context.strokeStyle=strokeState.strokeStyle)):(context.lineCap=strokeState.lineCap,_has2.default.CANVAS_LINE_DASH&&(context.setLineDash(strokeState.lineDash),context.lineDashOffset=strokeState.lineDashOffset),context.lineJoin=strokeState.lineJoin,context.lineWidth=strokeState.lineWidth,context.miterLimit=strokeState.miterLimit,context.strokeStyle=strokeState.strokeStyle,this.contextStrokeState_={lineCap:strokeState.lineCap,lineDash:strokeState.lineDash,lineDashOffset:strokeState.lineDashOffset,lineJoin:strokeState.lineJoin,lineWidth:strokeState.lineWidth,miterLimit:strokeState.miterLimit,strokeStyle:strokeState.strokeStyle})},_ol_render_canvas_Immediate_.prototype.setContextTextState_=function(textState){var context=this.context_,contextTextState=this.contextTextState_,textAlign=textState.textAlign?textState.textAlign:_canvas2.default.defaultTextAlign;contextTextState?(contextTextState.font!=textState.font&&(contextTextState.font=context.font=textState.font),contextTextState.textAlign!=textAlign&&(contextTextState.textAlign=textAlign),contextTextState.textBaseline!=textState.textBaseline&&(contextTextState.textBaseline=context.textBaseline=textState.textBaseline)):(context.font=textState.font,context.textAlign=textAlign,context.textBaseline=textState.textBaseline,this.contextTextState_={font:textState.font,textAlign:textAlign,textBaseline:textState.textBaseline})},_ol_render_canvas_Immediate_.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){if(fillStyle){var fillStyleColor=fillStyle.getColor();this.fillState_={fillStyle:_colorlike2.default.asColorLike(fillStyleColor||_canvas2.default.defaultFillStyle)}}else this.fillState_=null;if(strokeStyle){var strokeStyleColor=strokeStyle.getColor(),strokeStyleLineCap=strokeStyle.getLineCap(),strokeStyleLineDash=strokeStyle.getLineDash(),strokeStyleLineDashOffset=strokeStyle.getLineDashOffset(),strokeStyleLineJoin=strokeStyle.getLineJoin(),strokeStyleWidth=strokeStyle.getWidth(),strokeStyleMiterLimit=strokeStyle.getMiterLimit();this.strokeState_={lineCap:void 0!==strokeStyleLineCap?strokeStyleLineCap:_canvas2.default.defaultLineCap,lineDash:strokeStyleLineDash||_canvas2.default.defaultLineDash,lineDashOffset:strokeStyleLineDashOffset||_canvas2.default.defaultLineDashOffset,lineJoin:void 0!==strokeStyleLineJoin?strokeStyleLineJoin:_canvas2.default.defaultLineJoin,lineWidth:this.pixelRatio_*(void 0!==strokeStyleWidth?strokeStyleWidth:_canvas2.default.defaultLineWidth),miterLimit:void 0!==strokeStyleMiterLimit?strokeStyleMiterLimit:_canvas2.default.defaultMiterLimit,strokeStyle:_colorlike2.default.asColorLike(strokeStyleColor||_canvas2.default.defaultStrokeStyle)}}else this.strokeState_=null},_ol_render_canvas_Immediate_.prototype.setImageStyle=function(imageStyle){if(imageStyle){var imageAnchor=imageStyle.getAnchor(),imageImage=imageStyle.getImage(1),imageOrigin=imageStyle.getOrigin(),imageSize=imageStyle.getSize();this.imageAnchorX_=imageAnchor[0],this.imageAnchorY_=imageAnchor[1],this.imageHeight_=imageSize[1],this.image_=imageImage,this.imageOpacity_=imageStyle.getOpacity(),this.imageOriginX_=imageOrigin[0],this.imageOriginY_=imageOrigin[1],this.imageRotateWithView_=imageStyle.getRotateWithView(),this.imageRotation_=imageStyle.getRotation(),this.imageScale_=imageStyle.getScale()*this.pixelRatio_,this.imageSnapToPixel_=imageStyle.getSnapToPixel(),this.imageWidth_=imageSize[0]}else this.image_=null},_ol_render_canvas_Immediate_.prototype.setTextStyle=function(textStyle){if(textStyle){var textFillStyle=textStyle.getFill();if(textFillStyle){var textFillStyleColor=textFillStyle.getColor();this.textFillState_={fillStyle:_colorlike2.default.asColorLike(textFillStyleColor||_canvas2.default.defaultFillStyle)}}else this.textFillState_=null;var textStrokeStyle=textStyle.getStroke();if(textStrokeStyle){var textStrokeStyleColor=textStrokeStyle.getColor(),textStrokeStyleLineCap=textStrokeStyle.getLineCap(),textStrokeStyleLineDash=textStrokeStyle.getLineDash(),textStrokeStyleLineDashOffset=textStrokeStyle.getLineDashOffset(),textStrokeStyleLineJoin=textStrokeStyle.getLineJoin(),textStrokeStyleWidth=textStrokeStyle.getWidth(),textStrokeStyleMiterLimit=textStrokeStyle.getMiterLimit();this.textStrokeState_={lineCap:void 0!==textStrokeStyleLineCap?textStrokeStyleLineCap:_canvas2.default.defaultLineCap,lineDash:textStrokeStyleLineDash||_canvas2.default.defaultLineDash,lineDashOffset:textStrokeStyleLineDashOffset||_canvas2.default.defaultLineDashOffset,lineJoin:void 0!==textStrokeStyleLineJoin?textStrokeStyleLineJoin:_canvas2.default.defaultLineJoin,lineWidth:void 0!==textStrokeStyleWidth?textStrokeStyleWidth:_canvas2.default.defaultLineWidth,miterLimit:void 0!==textStrokeStyleMiterLimit?textStrokeStyleMiterLimit:_canvas2.default.defaultMiterLimit,strokeStyle:_colorlike2.default.asColorLike(textStrokeStyleColor||_canvas2.default.defaultStrokeStyle)}}else this.textStrokeState_=null;var textFont=textStyle.getFont(),textOffsetX=textStyle.getOffsetX(),textOffsetY=textStyle.getOffsetY(),textRotateWithView=textStyle.getRotateWithView(),textRotation=textStyle.getRotation(),textScale=textStyle.getScale(),textText=textStyle.getText(),textTextAlign=textStyle.getTextAlign(),textTextBaseline=textStyle.getTextBaseline();this.textState_={font:void 0!==textFont?textFont:_canvas2.default.defaultFont,textAlign:void 0!==textTextAlign?textTextAlign:_canvas2.default.defaultTextAlign,textBaseline:void 0!==textTextBaseline?textTextBaseline:_canvas2.default.defaultTextBaseline},this.text_=void 0!==textText?textText:"",this.textOffsetX_=void 0!==textOffsetX?this.pixelRatio_*textOffsetX:0,this.textOffsetY_=void 0!==textOffsetY?this.pixelRatio_*textOffsetY:0,this.textRotateWithView_=void 0!==textRotateWithView&&textRotateWithView,this.textRotation_=void 0!==textRotation?textRotation:0,this.textScale_=this.pixelRatio_*(void 0!==textScale?textScale:1)}else this.text_=""},exports.default=_ol_render_canvas_Immediate_},{"../../array.js":29,"../../colorlike.js":37,"../../extent.js":54,"../../geom/flat/transform.js":76,"../../geom/geometrytype.js":79,"../../geom/simplegeometry.js":83,"../../has.js":84,"../../index.js":89,"../../transform.js":243,"../canvas.js":150,"../vectorcontext.js":164}],153:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12}},{}],154:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_instruction2=_interopRequireDefault(require("../canvas/instruction.js")),_replay2=_interopRequireDefault(require("../canvas/replay.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_canvas_LineStringReplay_=function(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){_replay2.default.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree)};_index2.default.inherits(_ol_render_canvas_LineStringReplay_,_replay2.default),_ol_render_canvas_LineStringReplay_.prototype.drawFlatCoordinates_=function(flatCoordinates,offset,end,stride){var myBegin=this.coordinates.length,myEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1),moveToLineToInstruction=[_instruction2.default.MOVE_TO_LINE_TO,myBegin,myEnd];return this.instructions.push(moveToLineToInstruction),this.hitDetectionInstructions.push(moveToLineToInstruction),end},_ol_render_canvas_LineStringReplay_.prototype.drawLineString=function(lineStringGeometry,feature){var state=this.state,strokeStyle=state.strokeStyle,lineWidth=state.lineWidth;if(void 0!==strokeStyle&&void 0!==lineWidth){this.updateStrokeStyle(state,this.applyStroke),this.beginGeometry(lineStringGeometry,feature),this.hitDetectionInstructions.push([_instruction2.default.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset],[_instruction2.default.BEGIN_PATH]);var flatCoordinates=lineStringGeometry.getFlatCoordinates(),stride=lineStringGeometry.getStride();this.drawFlatCoordinates_(flatCoordinates,0,flatCoordinates.length,stride),this.hitDetectionInstructions.push([_instruction2.default.STROKE]),this.endGeometry(lineStringGeometry,feature)}},_ol_render_canvas_LineStringReplay_.prototype.drawMultiLineString=function(multiLineStringGeometry,feature){var state=this.state,strokeStyle=state.strokeStyle,lineWidth=state.lineWidth;if(void 0!==strokeStyle&&void 0!==lineWidth){this.updateStrokeStyle(state,this.applyStroke),this.beginGeometry(multiLineStringGeometry,feature),this.hitDetectionInstructions.push([_instruction2.default.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset],[_instruction2.default.BEGIN_PATH]);var i,ii,ends=multiLineStringGeometry.getEnds(),flatCoordinates=multiLineStringGeometry.getFlatCoordinates(),stride=multiLineStringGeometry.getStride(),offset=0;for(i=0,ii=ends.length;i<ii;++i)offset=this.drawFlatCoordinates_(flatCoordinates,offset,ends[i],stride);this.hitDetectionInstructions.push([_instruction2.default.STROKE]),this.endGeometry(multiLineStringGeometry,feature)}},_ol_render_canvas_LineStringReplay_.prototype.finish=function(){var state=this.state;null!=state.lastStroke&&state.lastStroke!=this.coordinates.length&&this.instructions.push([_instruction2.default.STROKE]),this.reverseHitDetectionInstructions(),this.state=null},_ol_render_canvas_LineStringReplay_.prototype.applyStroke=function(state){null!=state.lastStroke&&state.lastStroke!=this.coordinates.length&&(this.instructions.push([_instruction2.default.STROKE]),state.lastStroke=this.coordinates.length),state.lastStroke=0,_replay2.default.prototype.applyStroke.call(this,state),this.instructions.push([_instruction2.default.BEGIN_PATH])},exports.default=_ol_render_canvas_LineStringReplay_},{"../../index.js":89,"../canvas/instruction.js":153,"../canvas/replay.js":156}],155:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_color2=_interopRequireDefault(require("../../color.js")),_simplify2=_interopRequireDefault(require("../../geom/flat/simplify.js")),_canvas2=_interopRequireDefault(require("../canvas.js")),_instruction2=_interopRequireDefault(require("../canvas/instruction.js")),_replay2=_interopRequireDefault(require("../canvas/replay.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_canvas_PolygonReplay_=function(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){_replay2.default.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree)};_index2.default.inherits(_ol_render_canvas_PolygonReplay_,_replay2.default),_ol_render_canvas_PolygonReplay_.prototype.drawFlatCoordinatess_=function(flatCoordinates,offset,ends,stride){var state=this.state,fill=void 0!==state.fillStyle,stroke=null!=state.strokeStyle,numEnds=ends.length,beginPathInstruction=[_instruction2.default.BEGIN_PATH];this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(var i=0;i<numEnds;++i){var end=ends[i],myBegin=this.coordinates.length,myEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!0,!stroke),moveToLineToInstruction=[_instruction2.default.MOVE_TO_LINE_TO,myBegin,myEnd];if(this.instructions.push(moveToLineToInstruction),this.hitDetectionInstructions.push(moveToLineToInstruction),stroke){var closePathInstruction=[_instruction2.default.CLOSE_PATH];this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)}offset=end}var fillInstruction=[_instruction2.default.FILL];if(this.hitDetectionInstructions.push(fillInstruction),fill&&this.instructions.push(fillInstruction),stroke){var strokeInstruction=[_instruction2.default.STROKE];this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)}return offset},_ol_render_canvas_PolygonReplay_.prototype.drawCircle=function(circleGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(circleGeometry),this.beginGeometry(circleGeometry,feature),this.hitDetectionInstructions.push([_instruction2.default.SET_FILL_STYLE,_color2.default.asString(_canvas2.default.defaultFillStyle)]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([_instruction2.default.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);var flatCoordinates=circleGeometry.getFlatCoordinates(),stride=circleGeometry.getStride(),myBegin=this.coordinates.length;this.appendFlatCoordinates(flatCoordinates,0,flatCoordinates.length,stride,!1,!1);var beginPathInstruction=[_instruction2.default.BEGIN_PATH],circleInstruction=[_instruction2.default.CIRCLE,myBegin];this.instructions.push(beginPathInstruction,circleInstruction),this.hitDetectionInstructions.push(beginPathInstruction,circleInstruction);var fillInstruction=[_instruction2.default.FILL];if(this.hitDetectionInstructions.push(fillInstruction),void 0!==state.fillStyle&&this.instructions.push(fillInstruction),void 0!==state.strokeStyle){var strokeInstruction=[_instruction2.default.STROKE];this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)}this.endGeometry(circleGeometry,feature)}},_ol_render_canvas_PolygonReplay_.prototype.drawPolygon=function(polygonGeometry,feature){var state=this.state;this.setFillStrokeStyles_(polygonGeometry),this.beginGeometry(polygonGeometry,feature),this.hitDetectionInstructions.push([_instruction2.default.SET_FILL_STYLE,_color2.default.asString(_canvas2.default.defaultFillStyle)]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([_instruction2.default.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);var ends=polygonGeometry.getEnds(),flatCoordinates=polygonGeometry.getOrientedFlatCoordinates(),stride=polygonGeometry.getStride();this.drawFlatCoordinatess_(flatCoordinates,0,ends,stride),this.endGeometry(polygonGeometry,feature)},_ol_render_canvas_PolygonReplay_.prototype.drawMultiPolygon=function(multiPolygonGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(multiPolygonGeometry),this.beginGeometry(multiPolygonGeometry,feature),this.hitDetectionInstructions.push([_instruction2.default.SET_FILL_STYLE,_color2.default.asString(_canvas2.default.defaultFillStyle)]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([_instruction2.default.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);var i,ii,endss=multiPolygonGeometry.getEndss(),flatCoordinates=multiPolygonGeometry.getOrientedFlatCoordinates(),stride=multiPolygonGeometry.getStride(),offset=0;for(i=0,ii=endss.length;i<ii;++i)offset=this.drawFlatCoordinatess_(flatCoordinates,offset,endss[i],stride);this.endGeometry(multiPolygonGeometry,feature)}},_ol_render_canvas_PolygonReplay_.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var tolerance=this.tolerance;if(0!==tolerance){var i,ii,coordinates=this.coordinates;for(i=0,ii=coordinates.length;i<ii;++i)coordinates[i]=_simplify2.default.snap(coordinates[i],tolerance)}},_ol_render_canvas_PolygonReplay_.prototype.setFillStrokeStyles_=function(geometry){var state=this.state;void 0!==state.fillStyle&&this.updateFillStyle(state,this.applyFill,geometry),void 0!==state.strokeStyle&&this.updateStrokeStyle(state,this.applyStroke)},exports.default=_ol_render_canvas_PolygonReplay_},{"../../color.js":36,"../../geom/flat/simplify.js":72,"../../index.js":89,"../canvas.js":150,"../canvas/instruction.js":153,"../canvas/replay.js":156}],156:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_array2=_interopRequireDefault(require("../../array.js")),_colorlike2=_interopRequireDefault(require("../../colorlike.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_relationship2=_interopRequireDefault(require("../../extent/relationship.js")),_geometrytype2=_interopRequireDefault(require("../../geom/geometrytype.js")),_inflate2=_interopRequireDefault(require("../../geom/flat/inflate.js")),_length2=_interopRequireDefault(require("../../geom/flat/length.js")),_textpath2=_interopRequireDefault(require("../../geom/flat/textpath.js")),_transform2=_interopRequireDefault(require("../../geom/flat/transform.js")),_has2=_interopRequireDefault(require("../../has.js")),_obj2=_interopRequireDefault(require("../../obj.js")),_vectorcontext2=_interopRequireDefault(require("../vectorcontext.js")),_canvas2=_interopRequireDefault(require("../canvas.js")),_instruction2=_interopRequireDefault(require("../canvas/instruction.js")),_replay2=_interopRequireDefault(require("../replay.js")),_transform4=_interopRequireDefault(require("../../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_canvas_Replay_=function(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){_vectorcontext2.default.call(this),this.declutterTree=declutterTree,this.tmpExtent_=_extent2.default.createEmpty(),this.tolerance=tolerance,this.maxExtent=maxExtent,this.overlaps=overlaps,this.pixelRatio=pixelRatio,this.maxLineWidth=0,this.resolution=resolution,this.fillOrigin_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=_transform4.default.create(),this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.state={},this.viewRotation_=0,this.tmpLocalTransform_=_transform4.default.create(),this.resetTransform_=_transform4.default.create()};_index2.default.inherits(_ol_render_canvas_Replay_,_vectorcontext2.default),_ol_render_canvas_Replay_.prototype.replayTextBackground_=function(context,p1,p2,p3,p4,fillInstruction,strokeInstruction){context.beginPath(),context.moveTo.apply(context,p1),context.lineTo.apply(context,p2),context.lineTo.apply(context,p3),context.lineTo.apply(context,p4),context.lineTo.apply(context,p1),fillInstruction&&(this.fillOrigin_=fillInstruction[2],this.fill_(context)),strokeInstruction&&(this.setStrokeStyle_(context,strokeInstruction),context.stroke())},_ol_render_canvas_Replay_.prototype.replayImage_=function(context,x,y,image,anchorX,anchorY,declutterGroup,height,opacity,originX,originY,rotation,scale,snapToPixel,width,padding,fillInstruction,strokeInstruction){var fillStroke=fillInstruction||strokeInstruction,localTransform=this.tmpLocalTransform_;x-=anchorX*=scale,y-=anchorY*=scale,snapToPixel&&(x=Math.round(x),y=Math.round(y));var p1,p2,p3,p4,w=width+originX>image.width?image.width-originX:width,h=height+originY>image.height?image.height-originY:height,box=this.tmpExtent_,boxW=padding[3]+w*scale+padding[1],boxH=padding[0]+h*scale+padding[2],boxX=x-padding[3],boxY=y-padding[0];(fillStroke||0!==rotation)&&(p1=[boxX,boxY],p2=[boxX+boxW,boxY],p3=[boxX+boxW,boxY+boxH],p4=[boxX,boxY+boxH]);var transform=null;if(0!==rotation){var centerX=x+anchorX,centerY=y+anchorY;transform=_transform4.default.compose(localTransform,centerX,centerY,1,1,rotation,-centerX,-centerY),_extent2.default.createOrUpdateEmpty(box),_extent2.default.extendCoordinate(box,_transform4.default.apply(localTransform,p1)),_extent2.default.extendCoordinate(box,_transform4.default.apply(localTransform,p2)),_extent2.default.extendCoordinate(box,_transform4.default.apply(localTransform,p3)),_extent2.default.extendCoordinate(box,_transform4.default.apply(localTransform,p4))}else _extent2.default.createOrUpdate(boxX,boxY,boxX+boxW,boxY+boxH,box);var canvas=context.canvas,intersects=box[0]<=canvas.width&&0<=box[2]&&box[1]<=canvas.height&&0<=box[3];if(declutterGroup){if(!intersects&&1==declutterGroup[4])return;_extent2.default.extend(declutterGroup,box);var declutterArgs=intersects?[context,transform?transform.slice(0):null,opacity,image,originX,originY,w,h,x,y,scale]:null;declutterArgs&&fillStroke&&declutterArgs.push(fillInstruction,strokeInstruction,p1,p2,p3,p4),declutterGroup.push(declutterArgs)}else intersects&&(fillStroke&&this.replayTextBackground_(context,p1,p2,p3,p4,fillInstruction,strokeInstruction),_canvas2.default.drawImage(context,transform,opacity,image,originX,originY,w,h,x,y,scale))},_ol_render_canvas_Replay_.prototype.applyPixelRatio=function(dashArray){var pixelRatio=this.pixelRatio;return 1==pixelRatio?dashArray:dashArray.map(function(dash){return dash*pixelRatio})},_ol_render_canvas_Replay_.prototype.appendFlatCoordinates=function(flatCoordinates,offset,end,stride,closed,skipFirst){var myEnd=this.coordinates.length,extent=this.getBufferedMaxExtent();skipFirst&&(offset+=stride);var i,lastRel,nextRel,lastCoord=[flatCoordinates[offset],flatCoordinates[offset+1]],nextCoord=[NaN,NaN],skipped=!0;for(i=offset+stride;i<end;i+=stride)nextCoord[0]=flatCoordinates[i],nextCoord[1]=flatCoordinates[i+1],skipped=(nextRel=_extent2.default.coordinateRelationship(extent,nextCoord))!==lastRel?(skipped&&(this.coordinates[myEnd++]=lastCoord[0],this.coordinates[myEnd++]=lastCoord[1]),this.coordinates[myEnd++]=nextCoord[0],this.coordinates[myEnd++]=nextCoord[1],!1):nextRel!==_relationship2.default.INTERSECTING||(this.coordinates[myEnd++]=nextCoord[0],this.coordinates[myEnd++]=nextCoord[1],!1),lastCoord[0]=nextCoord[0],lastCoord[1]=nextCoord[1],lastRel=nextRel;return(closed&&skipped||i===offset+stride)&&(this.coordinates[myEnd++]=lastCoord[0],this.coordinates[myEnd++]=lastCoord[1]),myEnd},_ol_render_canvas_Replay_.prototype.drawCustomCoordinates_=function(flatCoordinates,offset,ends,stride,replayEnds){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i],replayEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1);replayEnds.push(replayEnd),offset=end}return offset},_ol_render_canvas_Replay_.prototype.drawCustom=function(geometry,feature,renderer){this.beginGeometry(geometry,feature);var flatCoordinates,replayEnd,replayEnds,replayEndss,offset,type=geometry.getType(),stride=geometry.getStride(),replayBegin=this.coordinates.length;if(type==_geometrytype2.default.MULTI_POLYGON){flatCoordinates=(geometry=geometry).getOrientedFlatCoordinates(),replayEndss=[];for(var endss=geometry.getEndss(),i=offset=0,ii=endss.length;i<ii;++i){var myEnds=[];offset=this.drawCustomCoordinates_(flatCoordinates,offset,endss[i],stride,myEnds),replayEndss.push(myEnds)}this.instructions.push([_instruction2.default.CUSTOM,replayBegin,replayEndss,geometry,renderer,_inflate2.default.coordinatesss])}else type==_geometrytype2.default.POLYGON||type==_geometrytype2.default.MULTI_LINE_STRING?(replayEnds=[],flatCoordinates=type==_geometrytype2.default.POLYGON?geometry.getOrientedFlatCoordinates():geometry.getFlatCoordinates(),offset=this.drawCustomCoordinates_(flatCoordinates,0,geometry.getEnds(),stride,replayEnds),this.instructions.push([_instruction2.default.CUSTOM,replayBegin,replayEnds,geometry,renderer,_inflate2.default.coordinatess])):type==_geometrytype2.default.LINE_STRING||type==_geometrytype2.default.MULTI_POINT?(flatCoordinates=geometry.getFlatCoordinates(),replayEnd=this.appendFlatCoordinates(flatCoordinates,0,flatCoordinates.length,stride,!1,!1),this.instructions.push([_instruction2.default.CUSTOM,replayBegin,replayEnd,geometry,renderer,_inflate2.default.coordinates])):type==_geometrytype2.default.POINT&&(flatCoordinates=geometry.getFlatCoordinates(),this.coordinates.push(flatCoordinates[0],flatCoordinates[1]),replayEnd=this.coordinates.length,this.instructions.push([_instruction2.default.CUSTOM,replayBegin,replayEnd,geometry,renderer]));this.endGeometry(geometry,feature)},_ol_render_canvas_Replay_.prototype.beginGeometry=function(geometry,feature){this.beginGeometryInstruction1_=[_instruction2.default.BEGIN_GEOMETRY,feature,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[_instruction2.default.BEGIN_GEOMETRY,feature,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},_ol_render_canvas_Replay_.prototype.fill_=function(context){if(this.fillOrigin_){var origin=_transform4.default.apply(this.renderedTransform_,this.fillOrigin_.slice());context.translate(origin[0],origin[1]),context.rotate(this.viewRotation_)}context.fill(),this.fillOrigin_&&context.setTransform.apply(context,_canvas2.default.resetTransform_)},_ol_render_canvas_Replay_.prototype.setStrokeStyle_=function(context,instruction){context.strokeStyle=instruction[1],context.lineWidth=instruction[2],context.lineCap=instruction[3],context.lineJoin=instruction[4],context.miterLimit=instruction[5],_has2.default.CANVAS_LINE_DASH&&(context.lineDashOffset=instruction[7],context.setLineDash(instruction[6]))},_ol_render_canvas_Replay_.prototype.renderDeclutter_=function(declutterGroup,feature){if(declutterGroup&&5<declutterGroup.length){var groupCount=declutterGroup[4];if(1==groupCount||groupCount==declutterGroup.length-5){var box={minX:declutterGroup[0],minY:declutterGroup[1],maxX:declutterGroup[2],maxY:declutterGroup[3],value:feature};if(!this.declutterTree.collides(box)){this.declutterTree.insert(box);for(var drawImage=_canvas2.default.drawImage,j=5,jj=declutterGroup.length;j<jj;++j){var declutterData=declutterGroup[j];declutterData&&(11<declutterData.length&&this.replayTextBackground_(declutterData[0],declutterData[13],declutterData[14],declutterData[15],declutterData[16],declutterData[11],declutterData[12]),drawImage.apply(void 0,declutterData))}}declutterGroup.length=5,_extent2.default.createOrUpdateEmpty(declutterGroup)}}},_ol_render_canvas_Replay_.prototype.replay_=function(context,transform,skippedFeaturesHash,instructions,featureCallback,opt_hitExtent){var pixelCoordinates;this.pixelCoordinates_&&_array2.default.equals(transform,this.renderedTransform_)?pixelCoordinates=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),pixelCoordinates=_transform2.default.transform2D(this.coordinates,0,this.coordinates.length,2,transform,this.pixelCoordinates_),_transform4.default.setFromArray(this.renderedTransform_,transform));for(var dd,anchorX,anchorY,prevX,prevY,roundX,roundY,declutterGroup,image,skipFeatures=!_obj2.default.isEmpty(skippedFeaturesHash),i=0,ii=instructions.length,d=0,pendingFill=0,pendingStroke=0,lastFillInstruction=null,lastStrokeInstruction=null,coordinateCache=this.coordinateCache_,viewRotation=this.viewRotation_,state={context:context,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:viewRotation},batchSize=this.instructions!=instructions||this.overlaps?0:200;i<ii;){var feature,x,y,instruction=instructions[i];switch(instruction[0]){case _instruction2.default.BEGIN_GEOMETRY:feature=instruction[1],skipFeatures&&skippedFeaturesHash[_index2.default.getUid(feature).toString()]||!feature.getGeometry()?i=instruction[2]:void 0===opt_hitExtent||_extent2.default.intersects(opt_hitExtent,feature.getGeometry().getExtent())?++i:i=instruction[2]+1;break;case _instruction2.default.BEGIN_PATH:batchSize<pendingFill&&(this.fill_(context),pendingFill=0),batchSize<pendingStroke&&(context.stroke(),pendingStroke=0),pendingFill||pendingStroke||(context.beginPath(),prevX=prevY=NaN),++i;break;case _instruction2.default.CIRCLE:var x1=pixelCoordinates[d=instruction[1]],y1=pixelCoordinates[d+1],dx=pixelCoordinates[d+2]-x1,dy=pixelCoordinates[d+3]-y1,r=Math.sqrt(dx*dx+dy*dy);context.moveTo(x1+r,y1),context.arc(x1,y1,r,0,2*Math.PI,!0),++i;break;case _instruction2.default.CLOSE_PATH:context.closePath(),++i;break;case _instruction2.default.CUSTOM:d=instruction[1],dd=instruction[2];var geometry=instruction[3],renderer=instruction[4],fn=6==instruction.length?instruction[5]:void 0;state.geometry=geometry,state.feature=feature,i in coordinateCache||(coordinateCache[i]=[]);var coords=coordinateCache[i];fn?fn(pixelCoordinates,d,dd,2,coords):(coords[0]=pixelCoordinates[d],coords[1]=pixelCoordinates[d+1],coords.length=2),renderer(coords,state),++i;break;case _instruction2.default.DRAW_IMAGE:d=instruction[1],dd=instruction[2],image=instruction[3],anchorX=instruction[4],anchorY=instruction[5],declutterGroup=featureCallback?null:instruction[6];var padding,backgroundFill,backgroundStroke,height=instruction[7],opacity=instruction[8],originX=instruction[9],originY=instruction[10],rotateWithView=instruction[11],rotation=instruction[12],scale=instruction[13],snapToPixel=instruction[14],width=instruction[15];for(16<instruction.length?(padding=instruction[16],backgroundFill=instruction[17],backgroundStroke=instruction[18]):(padding=_canvas2.default.defaultPadding,backgroundFill=backgroundStroke=!1),rotateWithView&&(rotation+=viewRotation);d<dd;d+=2)this.replayImage_(context,pixelCoordinates[d],pixelCoordinates[d+1],image,anchorX,anchorY,declutterGroup,height,opacity,originX,originY,rotation,scale,snapToPixel,width,padding,backgroundFill?lastFillInstruction:null,backgroundStroke?lastStrokeInstruction:null);this.renderDeclutter_(declutterGroup,feature),++i;break;case _instruction2.default.DRAW_CHARS:var begin=instruction[1],end=instruction[2],baseline=instruction[3];declutterGroup=featureCallback?null:instruction[4];var overflow=instruction[5],fillKey=instruction[6],maxAngle=instruction[7],measure=instruction[8],offsetY=instruction[9],strokeKey=instruction[10],strokeWidth=instruction[11],text=instruction[12],textKey=instruction[13],textScale=instruction[14],pathLength=_length2.default.lineString(pixelCoordinates,begin,end,2),textLength=measure(text);if(overflow||textLength<=pathLength){var textAlign=this.textStates[textKey].textAlign,startM=(pathLength-textLength)*_replay2.default.TEXT_ALIGN[textAlign],parts=_textpath2.default.lineString(pixelCoordinates,begin,end,2,text,measure,startM,maxAngle);if(parts){var c,cc,chars,label,part;if(strokeKey)for(c=0,cc=parts.length;c<cc;++c)chars=(part=parts[c])[4],label=this.getImage(chars,textKey,"",strokeKey),anchorX=part[2]+strokeWidth,anchorY=baseline*label.height+2*(.5-baseline)*strokeWidth-offsetY,this.replayImage_(context,part[0],part[1],label,anchorX,anchorY,declutterGroup,label.height,1,0,0,part[3],textScale,!1,label.width,_canvas2.default.defaultPadding,null,null);if(fillKey)for(c=0,cc=parts.length;c<cc;++c)chars=(part=parts[c])[4],label=this.getImage(chars,textKey,fillKey,""),anchorX=part[2],anchorY=baseline*label.height-offsetY,this.replayImage_(context,part[0],part[1],label,anchorX,anchorY,declutterGroup,label.height,1,0,0,part[3],textScale,!1,label.width,_canvas2.default.defaultPadding,null,null)}}this.renderDeclutter_(declutterGroup,feature),++i;break;case _instruction2.default.END_GEOMETRY:if(void 0!==featureCallback){var result=featureCallback(feature=instruction[1]);if(result)return result}++i;break;case _instruction2.default.FILL:batchSize?pendingFill++:this.fill_(context),++i;break;case _instruction2.default.MOVE_TO_LINE_TO:for(d=instruction[1],dd=instruction[2],x=pixelCoordinates[d],roundY=(y=pixelCoordinates[d+1])+.5|0,(roundX=x+.5|0)===prevX&&roundY===prevY||(context.moveTo(x,y),prevX=roundX,prevY=roundY),d+=2;d<dd;d+=2)roundX=(x=pixelCoordinates[d])+.5|0,roundY=(y=pixelCoordinates[d+1])+.5|0,d!=dd-2&&roundX===prevX&&roundY===prevY||(context.lineTo(x,y),prevX=roundX,prevY=roundY);++i;break;case _instruction2.default.SET_FILL_STYLE:lastFillInstruction=instruction,this.fillOrigin_=instruction[2],pendingFill&&(this.fill_(context),pendingFill=0,pendingStroke&&(context.stroke(),pendingStroke=0)),context.fillStyle=instruction[1],++i;break;case _instruction2.default.SET_STROKE_STYLE:lastStrokeInstruction=instruction,pendingStroke&&(context.stroke(),pendingStroke=0),this.setStrokeStyle_(context,instruction),++i;break;case _instruction2.default.STROKE:batchSize?pendingStroke++:context.stroke(),++i;break;default:++i}}pendingFill&&this.fill_(context),pendingStroke&&context.stroke()},_ol_render_canvas_Replay_.prototype.replay=function(context,transform,viewRotation,skippedFeaturesHash){this.viewRotation_=viewRotation,this.replay_(context,transform,skippedFeaturesHash,this.instructions,void 0,void 0)},_ol_render_canvas_Replay_.prototype.replayHitDetection=function(context,transform,viewRotation,skippedFeaturesHash,opt_featureCallback,opt_hitExtent){return this.viewRotation_=viewRotation,this.replay_(context,transform,skippedFeaturesHash,this.hitDetectionInstructions,opt_featureCallback,opt_hitExtent)},_ol_render_canvas_Replay_.prototype.reverseHitDetectionInstructions=function(){var i,hitDetectionInstructions=this.hitDetectionInstructions;hitDetectionInstructions.reverse();var instruction,type,n=hitDetectionInstructions.length,begin=-1;for(i=0;i<n;++i)(type=(instruction=hitDetectionInstructions[i])[0])==_instruction2.default.END_GEOMETRY?begin=i:type==_instruction2.default.BEGIN_GEOMETRY&&(instruction[2]=i,_array2.default.reverseSubArray(this.hitDetectionInstructions,begin,i),begin=-1)},_ol_render_canvas_Replay_.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){var state=this.state;if(fillStyle){var fillStyleColor=fillStyle.getColor();state.fillStyle=_colorlike2.default.asColorLike(fillStyleColor||_canvas2.default.defaultFillStyle)}else state.fillStyle=void 0;if(strokeStyle){var strokeStyleColor=strokeStyle.getColor();state.strokeStyle=_colorlike2.default.asColorLike(strokeStyleColor||_canvas2.default.defaultStrokeStyle);var strokeStyleLineCap=strokeStyle.getLineCap();state.lineCap=void 0!==strokeStyleLineCap?strokeStyleLineCap:_canvas2.default.defaultLineCap;var strokeStyleLineDash=strokeStyle.getLineDash();state.lineDash=strokeStyleLineDash?strokeStyleLineDash.slice():_canvas2.default.defaultLineDash;var strokeStyleLineDashOffset=strokeStyle.getLineDashOffset();state.lineDashOffset=strokeStyleLineDashOffset||_canvas2.default.defaultLineDashOffset;var strokeStyleLineJoin=strokeStyle.getLineJoin();state.lineJoin=void 0!==strokeStyleLineJoin?strokeStyleLineJoin:_canvas2.default.defaultLineJoin;var strokeStyleWidth=strokeStyle.getWidth();state.lineWidth=void 0!==strokeStyleWidth?strokeStyleWidth:_canvas2.default.defaultLineWidth;var strokeStyleMiterLimit=strokeStyle.getMiterLimit();state.miterLimit=void 0!==strokeStyleMiterLimit?strokeStyleMiterLimit:_canvas2.default.defaultMiterLimit,state.lineWidth>this.maxLineWidth&&(this.maxLineWidth=state.lineWidth,this.bufferedMaxExtent_=null)}else state.strokeStyle=void 0,state.lineCap=void 0,state.lineDash=null,state.lineDashOffset=void 0,state.lineJoin=void 0,state.lineWidth=void 0,state.miterLimit=void 0},_ol_render_canvas_Replay_.prototype.applyFill=function(state,geometry){var fillStyle=state.fillStyle,fillInstruction=[_instruction2.default.SET_FILL_STYLE,fillStyle];if("string"!=typeof fillStyle){var fillExtent=geometry.getExtent();fillInstruction.push([fillExtent[0],fillExtent[3]])}this.instructions.push(fillInstruction)},_ol_render_canvas_Replay_.prototype.applyStroke=function(state){this.instructions.push([_instruction2.default.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth*this.pixelRatio,state.lineCap,state.lineJoin,state.miterLimit,this.applyPixelRatio(state.lineDash),state.lineDashOffset*this.pixelRatio])},_ol_render_canvas_Replay_.prototype.updateFillStyle=function(state,applyFill,geometry){var fillStyle=state.fillStyle;"string"==typeof fillStyle&&state.currentFillStyle==fillStyle||(applyFill.call(this,state,geometry),state.currentFillStyle=fillStyle)},_ol_render_canvas_Replay_.prototype.updateStrokeStyle=function(state,applyStroke){var strokeStyle=state.strokeStyle,lineCap=state.lineCap,lineDash=state.lineDash,lineDashOffset=state.lineDashOffset,lineJoin=state.lineJoin,lineWidth=state.lineWidth,miterLimit=state.miterLimit;(state.currentStrokeStyle!=strokeStyle||state.currentLineCap!=lineCap||lineDash!=state.currentLineDash&&!_array2.default.equals(state.currentLineDash,lineDash)||state.currentLineDashOffset!=lineDashOffset||state.currentLineJoin!=lineJoin||state.currentLineWidth!=lineWidth||state.currentMiterLimit!=miterLimit)&&(applyStroke.call(this,state),state.currentStrokeStyle=strokeStyle,state.currentLineCap=lineCap,state.currentLineDash=lineDash,state.currentLineDashOffset=lineDashOffset,state.currentLineJoin=lineJoin,state.currentLineWidth=lineWidth,state.currentMiterLimit=miterLimit)},_ol_render_canvas_Replay_.prototype.endGeometry=function(geometry,feature){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var endGeometryInstruction=[_instruction2.default.END_GEOMETRY,feature];this.instructions.push(endGeometryInstruction),this.hitDetectionInstructions.push(endGeometryInstruction)},_ol_render_canvas_Replay_.prototype.finish=_index2.default.nullFunction,_ol_render_canvas_Replay_.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=_extent2.default.clone(this.maxExtent),0<this.maxLineWidth)){var width=this.resolution*(this.maxLineWidth+1)/2;_extent2.default.buffer(this.bufferedMaxExtent_,width,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},exports.default=_ol_render_canvas_Replay_},{"../../array.js":29,"../../colorlike.js":37,"../../extent.js":54,"../../extent/relationship.js":56,"../../geom/flat/inflate.js":65,"../../geom/flat/length.js":68,"../../geom/flat/textpath.js":74,"../../geom/flat/transform.js":76,"../../geom/geometrytype.js":79,"../../has.js":84,"../../index.js":89,"../../obj.js":124,"../../transform.js":243,"../canvas.js":150,"../canvas/instruction.js":153,"../replay.js":161,"../vectorcontext.js":164}],157:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_array2=_interopRequireDefault(require("../../array.js")),_dom2=_interopRequireDefault(require("../../dom.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_transform2=_interopRequireDefault(require("../../geom/flat/transform.js")),_obj2=_interopRequireDefault(require("../../obj.js")),_replaygroup2=_interopRequireDefault(require("../replaygroup.js")),_replaytype2=_interopRequireDefault(require("../replaytype.js")),_replay2=_interopRequireDefault(require("../canvas/replay.js")),_imagereplay2=_interopRequireDefault(require("../canvas/imagereplay.js")),_linestringreplay2=_interopRequireDefault(require("../canvas/linestringreplay.js")),_polygonreplay2=_interopRequireDefault(require("../canvas/polygonreplay.js")),_textreplay2=_interopRequireDefault(require("../canvas/textreplay.js")),_replay4=_interopRequireDefault(require("../replay.js")),_transform4=_interopRequireDefault(require("../../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_canvas_ReplayGroup_=function(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree,opt_renderBuffer){_replaygroup2.default.call(this),this.declutterTree_=declutterTree,this.declutterGroup_=null,this.tolerance_=tolerance,this.maxExtent_=maxExtent,this.overlaps_=overlaps,this.pixelRatio_=pixelRatio,this.resolution_=resolution,this.renderBuffer_=opt_renderBuffer,this.replaysByZIndex_={},this.hitDetectionContext_=_dom2.default.createCanvasContext2D(1,1),this.hitDetectionTransform_=_transform4.default.create()};_index2.default.inherits(_ol_render_canvas_ReplayGroup_,_replaygroup2.default),_ol_render_canvas_ReplayGroup_.circleArrayCache_={0:[[!0]]},_ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_=function(array,x,y){var i,radius=Math.floor(array.length/2);if(radius<=x)for(i=radius;i<x;i++)array[i][y]=!0;else if(x<radius)for(i=x+1;i<radius;i++)array[i][y]=!0},_ol_render_canvas_ReplayGroup_.getCircleArray_=function(radius){if(void 0!==_ol_render_canvas_ReplayGroup_.circleArrayCache_[radius])return _ol_render_canvas_ReplayGroup_.circleArrayCache_[radius];for(var arraySize=2*radius+1,arr=new Array(arraySize),i=0;i<arraySize;i++)arr[i]=new Array(arraySize);for(var x=radius,y=0,error=0;y<=x;)_ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr,radius+x,radius+y),_ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr,radius+y,radius+x),_ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr,radius-y,radius+x),_ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr,radius-x,radius+y),_ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr,radius-x,radius-y),_ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr,radius-y,radius-x),_ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr,radius+y,radius-x),_ol_render_canvas_ReplayGroup_.fillCircleArrayRowToMiddle_(arr,radius+x,radius-y),0<2*((error+=1+2*++y)-x)+1&&(error+=1-2*(x-=1));return _ol_render_canvas_ReplayGroup_.circleArrayCache_[radius]=arr},_ol_render_canvas_ReplayGroup_.replayDeclutter=function(declutterReplays,context,rotation){for(var zs=Object.keys(declutterReplays).map(Number).sort(_array2.default.numberSafeCompareFunction),skippedFeatureUids={},z=0,zz=zs.length;z<zz;++z)for(var replayData=declutterReplays[zs[z].toString()],i=0,ii=replayData.length;i<ii;){var replay=replayData[i++],transform=replayData[i++];replay.replay(context,transform,rotation,skippedFeatureUids)}},_ol_render_canvas_ReplayGroup_.prototype.addDeclutter=function(group){var declutter=null;return this.declutterTree_&&(group?(declutter=this.declutterGroup_)[4]++:(declutter=this.declutterGroup_=_extent2.default.createEmpty()).push(1)),declutter},_ol_render_canvas_ReplayGroup_.prototype.clip=function(context,transform){var flatClipCoords=this.getClipCoords(transform);context.beginPath(),context.moveTo(flatClipCoords[0],flatClipCoords[1]),context.lineTo(flatClipCoords[2],flatClipCoords[3]),context.lineTo(flatClipCoords[4],flatClipCoords[5]),context.lineTo(flatClipCoords[6],flatClipCoords[7]),context.clip()},_ol_render_canvas_ReplayGroup_.prototype.hasReplays=function(replays){for(var zIndex in this.replaysByZIndex_)for(var candidates=this.replaysByZIndex_[zIndex],i=0,ii=replays.length;i<ii;++i)if(replays[i]in candidates)return!0;return!1},_ol_render_canvas_ReplayGroup_.prototype.finish=function(){var zKey;for(zKey in this.replaysByZIndex_){var replayKey,replays=this.replaysByZIndex_[zKey];for(replayKey in replays)replays[replayKey].finish()}},_ol_render_canvas_ReplayGroup_.prototype.forEachFeatureAtCoordinate=function(coordinate,resolution,rotation,hitTolerance,skippedFeaturesHash,callback,declutterReplays){var hitExtent,contextSize=2*(hitTolerance=Math.round(hitTolerance))+1,transform=_transform4.default.compose(this.hitDetectionTransform_,hitTolerance+.5,hitTolerance+.5,1/resolution,-1/resolution,-rotation,-coordinate[0],-coordinate[1]),context=this.hitDetectionContext_;context.canvas.width!==contextSize||context.canvas.height!==contextSize?(context.canvas.width=contextSize,context.canvas.height=contextSize):context.clearRect(0,0,contextSize,contextSize),void 0!==this.renderBuffer_&&(hitExtent=_extent2.default.createEmpty(),_extent2.default.extendCoordinate(hitExtent,coordinate),_extent2.default.buffer(hitExtent,resolution*(this.renderBuffer_+hitTolerance),hitExtent));var declutteredFeatures,mask=_ol_render_canvas_ReplayGroup_.getCircleArray_(hitTolerance);return this.declutterTree_&&(declutteredFeatures=this.declutterTree_.all().map(function(entry){return entry.value})),this.replayHitDetection_(context,transform,rotation,skippedFeaturesHash,function(feature){for(var imageData=context.getImageData(0,0,contextSize,contextSize).data,i=0;i<contextSize;i++)for(var j=0;j<contextSize;j++){var result;if(mask[i][j]&&0<imageData[4*(j*contextSize+i)+3])return declutteredFeatures&&-1===declutteredFeatures.indexOf(feature)||(result=callback(feature)),result||void context.clearRect(0,0,contextSize,contextSize)}},hitExtent,declutterReplays)},_ol_render_canvas_ReplayGroup_.prototype.getClipCoords=function(transform){var maxExtent=this.maxExtent_,minX=maxExtent[0],minY=maxExtent[1],maxX=maxExtent[2],maxY=maxExtent[3],flatClipCoords=[minX,minY,minX,maxY,maxX,maxY,maxX,minY];return _transform2.default.transform2D(flatClipCoords,0,8,2,transform,flatClipCoords),flatClipCoords},_ol_render_canvas_ReplayGroup_.prototype.getReplay=function(zIndex,replayType){var zIndexKey=void 0!==zIndex?zIndex.toString():"0",replays=this.replaysByZIndex_[zIndexKey];void 0===replays&&(replays={},this.replaysByZIndex_[zIndexKey]=replays);var replay=replays[replayType];void 0===replay&&(replay=new _ol_render_canvas_ReplayGroup_.BATCH_CONSTRUCTORS_[replayType](this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),replays[replayType]=replay);return replay},_ol_render_canvas_ReplayGroup_.prototype.getReplays=function(){return this.replaysByZIndex_},_ol_render_canvas_ReplayGroup_.prototype.isEmpty=function(){return _obj2.default.isEmpty(this.replaysByZIndex_)},_ol_render_canvas_ReplayGroup_.prototype.replay=function(context,transform,viewRotation,skippedFeaturesHash,opt_replayTypes,opt_declutterReplays){var zs=Object.keys(this.replaysByZIndex_).map(Number);zs.sort(_array2.default.numberSafeCompareFunction),context.save(),this.clip(context,transform);var i,ii,j,jj,replays,replay,replayTypes=opt_replayTypes||_replay4.default.ORDER;for(i=0,ii=zs.length;i<ii;++i){var zIndexKey=zs[i].toString();for(replays=this.replaysByZIndex_[zIndexKey],j=0,jj=replayTypes.length;j<jj;++j){var replayType=replayTypes[j];if(void 0!==(replay=replays[replayType]))if(!opt_declutterReplays||replayType!=_replaytype2.default.IMAGE&&replayType!=_replaytype2.default.TEXT)replay.replay(context,transform,viewRotation,skippedFeaturesHash);else{var declutter=opt_declutterReplays[zIndexKey];declutter?declutter.push(replay,transform.slice(0)):opt_declutterReplays[zIndexKey]=[replay,transform.slice(0)]}}}context.restore()},_ol_render_canvas_ReplayGroup_.prototype.replayHitDetection_=function(context,transform,viewRotation,skippedFeaturesHash,featureCallback,opt_hitExtent,opt_declutterReplays){var i,j,replays,replay,result,zs=Object.keys(this.replaysByZIndex_).map(Number);for(zs.sort(_array2.default.numberSafeCompareFunction),i=zs.length-1;0<=i;--i){var zIndexKey=zs[i].toString();for(replays=this.replaysByZIndex_[zIndexKey],j=_replay4.default.ORDER.length-1;0<=j;--j){var replayType=_replay4.default.ORDER[j];if(void 0!==(replay=replays[replayType]))if(!opt_declutterReplays||replayType!=_replaytype2.default.IMAGE&&replayType!=_replaytype2.default.TEXT){if(result=replay.replayHitDetection(context,transform,viewRotation,skippedFeaturesHash,featureCallback,opt_hitExtent))return result}else{var declutter=opt_declutterReplays[zIndexKey];declutter?declutter.push(replay,transform.slice(0)):opt_declutterReplays[zIndexKey]=[replay,transform.slice(0)]}}}},_ol_render_canvas_ReplayGroup_.BATCH_CONSTRUCTORS_={Circle:_polygonreplay2.default,Default:_replay2.default,Image:_imagereplay2.default,LineString:_linestringreplay2.default,Polygon:_polygonreplay2.default,Text:_textreplay2.default},exports.default=_ol_render_canvas_ReplayGroup_},{"../../array.js":29,"../../dom.js":46,"../../extent.js":54,"../../geom/flat/transform.js":76,"../../index.js":89,"../../obj.js":124,"../../transform.js":243,"../canvas/imagereplay.js":151,"../canvas/linestringreplay.js":154,"../canvas/polygonreplay.js":155,"../canvas/replay.js":156,"../canvas/textreplay.js":158,"../replay.js":161,"../replaygroup.js":162,"../replaytype.js":163}],158:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_colorlike2=_interopRequireDefault(require("../../colorlike.js")),_dom2=_interopRequireDefault(require("../../dom.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_straightchunk2=_interopRequireDefault(require("../../geom/flat/straightchunk.js")),_geometrytype2=_interopRequireDefault(require("../../geom/geometrytype.js")),_has2=_interopRequireDefault(require("../../has.js")),_canvas2=_interopRequireDefault(require("../canvas.js")),_instruction2=_interopRequireDefault(require("../canvas/instruction.js")),_replay2=_interopRequireDefault(require("../canvas/replay.js")),_replay4=_interopRequireDefault(require("../replay.js")),_textplacement2=_interopRequireDefault(require("../../style/textplacement.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_canvas_TextReplay_=function(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){_replay2.default.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree),this.declutterGroup_,this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.widths_={},_canvas2.default.labelCache.prune()};_index2.default.inherits(_ol_render_canvas_TextReplay_,_replay2.default),_ol_render_canvas_TextReplay_.measureTextWidths=function(font,lines,widths){var currentWidth,i,numLines=lines.length,width=0;for(i=0;i<numLines;++i)currentWidth=_canvas2.default.measureTextWidth(font,lines[i]),width=Math.max(width,currentWidth),widths.push(currentWidth);return width},_ol_render_canvas_TextReplay_.prototype.drawText=function(geometry,feature){var fillState=this.textFillState_,strokeState=this.textStrokeState_,textState=this.textState_;if(""!==this.text_&&textState&&(fillState||strokeState)){var i,ii,begin=this.coordinates.length,geometryType=geometry.getType(),flatCoordinates=null,end=2,stride=2;if(textState.placement===_textplacement2.default.LINE){if(!_extent2.default.intersects(this.getBufferedMaxExtent(),geometry.getExtent()))return;var ends;if(flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride(),geometryType==_geometrytype2.default.LINE_STRING)ends=[flatCoordinates.length];else if(geometryType==_geometrytype2.default.MULTI_LINE_STRING)ends=geometry.getEnds();else if(geometryType==_geometrytype2.default.POLYGON)ends=geometry.getEnds().slice(0,1);else if(geometryType==_geometrytype2.default.MULTI_POLYGON){var endss=geometry.getEndss();for(ends=[],i=0,ii=endss.length;i<ii;++i)ends.push(endss[i][0])}this.beginGeometry(geometry,feature);for(var flatEnd,textAlign=textState.textAlign,flatOffset=0,o=0,oo=ends.length;o<oo;++o){if(null==textAlign){var range=_straightchunk2.default.lineString(textState.maxAngle,flatCoordinates,flatOffset,ends[o],stride);flatOffset=range[0],flatEnd=range[1]}else flatEnd=ends[o];for(i=flatOffset;i<flatEnd;i+=stride)this.coordinates.push(flatCoordinates[i],flatCoordinates[i+1]);end=this.coordinates.length,flatOffset=ends[o],this.drawChars_(begin,end,this.declutterGroup_),begin=end}this.endGeometry(geometry,feature)}else{var label=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),width=label.width/this.pixelRatio;switch(geometryType){case _geometrytype2.default.POINT:case _geometrytype2.default.MULTI_POINT:end=(flatCoordinates=geometry.getFlatCoordinates()).length;break;case _geometrytype2.default.LINE_STRING:flatCoordinates=geometry.getFlatMidpoint();break;case _geometrytype2.default.CIRCLE:flatCoordinates=geometry.getCenter();break;case _geometrytype2.default.MULTI_LINE_STRING:end=(flatCoordinates=geometry.getFlatMidpoints()).length;break;case _geometrytype2.default.POLYGON:if(flatCoordinates=geometry.getFlatInteriorPoint(),!textState.overflow&&flatCoordinates[2]/this.resolution<width)return;stride=3;break;case _geometrytype2.default.MULTI_POLYGON:var interiorPoints=geometry.getFlatInteriorPoints();for(flatCoordinates=[],i=0,ii=interiorPoints.length;i<ii;i+=3)(textState.overflow||interiorPoints[i+2]/this.resolution>=width)&&flatCoordinates.push(interiorPoints[i],interiorPoints[i+1]);if(0==(end=flatCoordinates.length))return}end=this.appendFlatCoordinates(flatCoordinates,0,end,stride,!1,!1),this.beginGeometry(geometry,feature),(textState.backgroundFill||textState.backgroundStroke)&&(this.setFillStrokeStyle(textState.backgroundFill,textState.backgroundStroke),this.updateFillStyle(this.state,this.applyFill,geometry),this.updateStrokeStyle(this.state,this.applyStroke)),this.drawTextImage_(label,begin,end),this.endGeometry(geometry,feature)}}},_ol_render_canvas_TextReplay_.prototype.getImage=function(text,textKey,fillKey,strokeKey){var label,key=strokeKey+textKey+text+fillKey+this.pixelRatio,labelCache=_canvas2.default.labelCache;if(!labelCache.containsKey(key)){var strokeState=strokeKey?this.strokeStates[strokeKey]||this.textStrokeState_:null,fillState=fillKey?this.fillStates[fillKey]||this.textFillState_:null,textState=this.textStates[textKey]||this.textState_,pixelRatio=this.pixelRatio,scale=textState.scale*pixelRatio,align=_replay4.default.TEXT_ALIGN[textState.textAlign||_canvas2.default.defaultTextAlign],strokeWidth=strokeKey&&strokeState.lineWidth?strokeState.lineWidth:0,lines=text.split("\n"),numLines=lines.length,widths=[],width=_ol_render_canvas_TextReplay_.measureTextWidths(textState.font,lines,widths),lineHeight=_canvas2.default.measureTextHeight(textState.font),height=lineHeight*numLines,renderWidth=width+strokeWidth,context=_dom2.default.createCanvasContext2D(Math.ceil(renderWidth*scale),Math.ceil((height+strokeWidth)*scale));label=context.canvas,labelCache.set(key,label),1!=scale&&context.scale(scale,scale),context.font=textState.font,strokeKey&&(context.strokeStyle=strokeState.strokeStyle,context.lineWidth=strokeWidth*(_has2.default.SAFARI?scale:1),context.lineCap=strokeState.lineCap,context.lineJoin=strokeState.lineJoin,context.miterLimit=strokeState.miterLimit,_has2.default.CANVAS_LINE_DASH&&strokeState.lineDash.length&&(context.setLineDash(strokeState.lineDash),context.lineDashOffset=strokeState.lineDashOffset)),fillKey&&(context.fillStyle=fillState.fillStyle),context.textBaseline="middle",context.textAlign="center";var i,leftRight=.5-align,x=align*label.width/scale+leftRight*strokeWidth;if(strokeKey)for(i=0;i<numLines;++i)context.strokeText(lines[i],x+leftRight*widths[i],.5*(strokeWidth+lineHeight)+i*lineHeight);if(fillKey)for(i=0;i<numLines;++i)context.fillText(lines[i],x+leftRight*widths[i],.5*(strokeWidth+lineHeight)+i*lineHeight)}return labelCache.get(key)},_ol_render_canvas_TextReplay_.prototype.drawTextImage_=function(label,begin,end){var textState=this.textState_,strokeState=this.textStrokeState_,pixelRatio=this.pixelRatio,align=_replay4.default.TEXT_ALIGN[textState.textAlign||_canvas2.default.defaultTextAlign],baseline=_replay4.default.TEXT_ALIGN[textState.textBaseline],strokeWidth=strokeState&&strokeState.lineWidth?strokeState.lineWidth:0,anchorX=align*label.width/pixelRatio+2*(.5-align)*strokeWidth,anchorY=baseline*label.height/pixelRatio+2*(.5-baseline)*strokeWidth;this.instructions.push([_instruction2.default.DRAW_IMAGE,begin,end,label,(anchorX-this.textOffsetX_)*pixelRatio,(anchorY-this.textOffsetY_)*pixelRatio,this.declutterGroup_,label.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,!0,label.width,textState.padding==_canvas2.default.defaultPadding?_canvas2.default.defaultPadding:textState.padding.map(function(p){return p*pixelRatio}),!!textState.backgroundFill,!!textState.backgroundStroke]),this.hitDetectionInstructions.push([_instruction2.default.DRAW_IMAGE,begin,end,label,(anchorX-this.textOffsetX_)*pixelRatio,(anchorY-this.textOffsetY_)*pixelRatio,this.declutterGroup_,label.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/pixelRatio,!0,label.width,textState.padding,!!textState.backgroundFill,!!textState.backgroundStroke])},_ol_render_canvas_TextReplay_.prototype.drawChars_=function(begin,end,declutterGroup){var strokeState=this.textStrokeState_,textState=this.textState_,fillState=this.textFillState_,strokeKey=this.strokeKey_;strokeState&&(strokeKey in this.strokeStates||(this.strokeStates[strokeKey]={strokeStyle:strokeState.strokeStyle,lineCap:strokeState.lineCap,lineDashOffset:strokeState.lineDashOffset,lineWidth:strokeState.lineWidth,lineJoin:strokeState.lineJoin,miterLimit:strokeState.miterLimit,lineDash:strokeState.lineDash}));var textKey=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:textState.font,textAlign:textState.textAlign||_canvas2.default.defaultTextAlign,scale:textState.scale});var fillKey=this.fillKey_;fillState&&(fillKey in this.fillStates||(this.fillStates[fillKey]={fillStyle:fillState.fillStyle}));var pixelRatio=this.pixelRatio,baseline=_replay4.default.TEXT_ALIGN[textState.textBaseline],offsetY=this.textOffsetY_*pixelRatio,text=this.text_,font=textState.font,textScale=textState.scale,strokeWidth=strokeState?strokeState.lineWidth*textScale/2:0,widths=this.widths_[font];widths||(this.widths_[font]=widths={}),this.instructions.push([_instruction2.default.DRAW_CHARS,begin,end,baseline,declutterGroup,textState.overflow,fillKey,textState.maxAngle,function(text){var width=widths[text];return width||(width=widths[text]=_canvas2.default.measureTextWidth(font,text)),width*textScale*pixelRatio},offsetY,strokeKey,strokeWidth*pixelRatio,text,textKey,1]),this.hitDetectionInstructions.push([_instruction2.default.DRAW_CHARS,begin,end,baseline,declutterGroup,textState.overflow,fillKey,textState.maxAngle,function(text){var width=widths[text];return width||(width=widths[text]=_canvas2.default.measureTextWidth(font,text)),width*textScale},offsetY,strokeKey,strokeWidth,text,textKey,1/pixelRatio])},_ol_render_canvas_TextReplay_.prototype.setTextStyle=function(textStyle,declutterGroup){var textState,fillState,strokeState;if(textStyle){this.declutterGroup_=declutterGroup;var textFillStyle=textStyle.getFill();textFillStyle?((fillState=this.textFillState_)||(fillState=this.textFillState_={}),fillState.fillStyle=_colorlike2.default.asColorLike(textFillStyle.getColor()||_canvas2.default.defaultFillStyle)):fillState=this.textFillState_=null;var textStrokeStyle=textStyle.getStroke();if(textStrokeStyle){(strokeState=this.textStrokeState_)||(strokeState=this.textStrokeState_={});var lineDash=textStrokeStyle.getLineDash(),lineDashOffset=textStrokeStyle.getLineDashOffset(),lineWidth=textStrokeStyle.getWidth(),miterLimit=textStrokeStyle.getMiterLimit();strokeState.lineCap=textStrokeStyle.getLineCap()||_canvas2.default.defaultLineCap,strokeState.lineDash=lineDash?lineDash.slice():_canvas2.default.defaultLineDash,strokeState.lineDashOffset=void 0===lineDashOffset?_canvas2.default.defaultLineDashOffset:lineDashOffset,strokeState.lineJoin=textStrokeStyle.getLineJoin()||_canvas2.default.defaultLineJoin,strokeState.lineWidth=void 0===lineWidth?_canvas2.default.defaultLineWidth:lineWidth,strokeState.miterLimit=void 0===miterLimit?_canvas2.default.defaultMiterLimit:miterLimit,strokeState.strokeStyle=_colorlike2.default.asColorLike(textStrokeStyle.getColor()||_canvas2.default.defaultStrokeStyle)}else strokeState=this.textStrokeState_=null;textState=this.textState_;var font=textStyle.getFont()||_canvas2.default.defaultFont;_canvas2.default.checkFont(font);var textScale=textStyle.getScale();textState.overflow=textStyle.getOverflow(),textState.font=font,textState.maxAngle=textStyle.getMaxAngle(),textState.placement=textStyle.getPlacement(),textState.textAlign=textStyle.getTextAlign(),textState.textBaseline=textStyle.getTextBaseline()||_canvas2.default.defaultTextBaseline,textState.backgroundFill=textStyle.getBackgroundFill(),textState.backgroundStroke=textStyle.getBackgroundStroke(),textState.padding=textStyle.getPadding()||_canvas2.default.defaultPadding,textState.scale=void 0===textScale?1:textScale;var textOffsetX=textStyle.getOffsetX(),textOffsetY=textStyle.getOffsetY(),textRotateWithView=textStyle.getRotateWithView(),textRotation=textStyle.getRotation();this.text_=textStyle.getText()||"",this.textOffsetX_=void 0===textOffsetX?0:textOffsetX,this.textOffsetY_=void 0===textOffsetY?0:textOffsetY,this.textRotateWithView_=void 0!==textRotateWithView&&textRotateWithView,this.textRotation_=void 0===textRotation?0:textRotation,this.strokeKey_=strokeState?("string"==typeof strokeState.strokeStyle?strokeState.strokeStyle:_index2.default.getUid(strokeState.strokeStyle))+strokeState.lineCap+strokeState.lineDashOffset+"|"+strokeState.lineWidth+strokeState.lineJoin+strokeState.miterLimit+"["+strokeState.lineDash.join()+"]":"",this.textKey_=textState.font+textState.scale+(textState.textAlign||"?"),this.fillKey_=fillState?"string"==typeof fillState.fillStyle?fillState.fillStyle:"|"+_index2.default.getUid(fillState.fillStyle):""}else this.text_=""},exports.default=_ol_render_canvas_TextReplay_},{"../../colorlike.js":37,"../../dom.js":46,"../../extent.js":54,"../../geom/flat/straightchunk.js":73,"../../geom/geometrytype.js":79,"../../has.js":84,"../../index.js":89,"../../style/textplacement.js":236,"../canvas.js":150,"../canvas/instruction.js":153,"../canvas/replay.js":156,"../replay.js":161}],159:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_event2=_interopRequireDefault(require("../events/event.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_Event_=function(type,opt_vectorContext,opt_frameState,opt_context,opt_glContext){_event2.default.call(this,type),this.vectorContext=opt_vectorContext,this.frameState=opt_frameState,this.context=opt_context,this.glContext=opt_glContext};_index2.default.inherits(_ol_render_Event_,_event2.default),exports.default=_ol_render_Event_},{"../events/event.js":50,"../index.js":89}],160:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={POSTCOMPOSE:"postcompose",PRECOMPOSE:"precompose",RENDER:"render"}},{}],161:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_replaytype=require("../render/replaytype.js"),_replaytype2=(obj=_replaytype)&&obj.__esModule?obj:{default:obj};var _ol_render_replay_={};_ol_render_replay_.ORDER=[_replaytype2.default.POLYGON,_replaytype2.default.CIRCLE,_replaytype2.default.LINE_STRING,_replaytype2.default.IMAGE,_replaytype2.default.TEXT,_replaytype2.default.DEFAULT],_ol_render_replay_.TEXT_ALIGN={},_ol_render_replay_.TEXT_ALIGN.left=0,_ol_render_replay_.TEXT_ALIGN.end=0,_ol_render_replay_.TEXT_ALIGN.center=.5,_ol_render_replay_.TEXT_ALIGN.right=1,_ol_render_replay_.TEXT_ALIGN.start=1,_ol_render_replay_.TEXT_ALIGN.top=0,_ol_render_replay_.TEXT_ALIGN.middle=.5,_ol_render_replay_.TEXT_ALIGN.hanging=.2,_ol_render_replay_.TEXT_ALIGN.alphabetic=.8,_ol_render_replay_.TEXT_ALIGN.ideographic=.8,_ol_render_replay_.TEXT_ALIGN.bottom=1,exports.default=_ol_render_replay_},{"../render/replaytype.js":163}],162:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_render_ReplayGroup_=function(){};_ol_render_ReplayGroup_.prototype.getReplay=function(zIndex,replayType){},_ol_render_ReplayGroup_.prototype.isEmpty=function(){},exports.default=_ol_render_ReplayGroup_},{}],163:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"}},{}],164:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_render_VectorContext_=function(){};_ol_render_VectorContext_.prototype.drawCustom=function(geometry,feature,renderer){},_ol_render_VectorContext_.prototype.drawGeometry=function(geometry){},_ol_render_VectorContext_.prototype.setStyle=function(style){},_ol_render_VectorContext_.prototype.drawCircle=function(circleGeometry,feature){},_ol_render_VectorContext_.prototype.drawFeature=function(feature,style){},_ol_render_VectorContext_.prototype.drawGeometryCollection=function(geometryCollectionGeometry,feature){},_ol_render_VectorContext_.prototype.drawLineString=function(lineStringGeometry,feature){},_ol_render_VectorContext_.prototype.drawMultiLineString=function(multiLineStringGeometry,feature){},_ol_render_VectorContext_.prototype.drawMultiPoint=function(multiPointGeometry,feature){},_ol_render_VectorContext_.prototype.drawMultiPolygon=function(multiPolygonGeometry,feature){},_ol_render_VectorContext_.prototype.drawPoint=function(pointGeometry,feature){},_ol_render_VectorContext_.prototype.drawPolygon=function(polygonGeometry,feature){},_ol_render_VectorContext_.prototype.drawText=function(geometry,feature){},_ol_render_VectorContext_.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){},_ol_render_VectorContext_.prototype.setImageStyle=function(imageStyle,opt_declutterGroup){},_ol_render_VectorContext_.prototype.setTextStyle=function(textStyle,opt_declutterGroup){},exports.default=_ol_render_VectorContext_},{}],165:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_render_webgl_={defaultFont:"10px sans-serif",defaultFillStyle:[0,0,0,1],defaultLineCap:"round",defaultLineDash:[],defaultLineDashOffset:0,defaultLineJoin:"round",defaultMiterLimit:10,defaultStrokeStyle:[0,0,0,1],defaultTextAlign:.5,defaultTextBaseline:.5,defaultLineWidth:1,triangleIsCounterClockwise:function(x1,y1,x2,y2,x3,y3){var area=(x2-x1)*(y3-y1)-(x3-x1)*(y2-y1);return area<=_ol_render_webgl_.EPSILON&&area>=-_ol_render_webgl_.EPSILON?void 0:0<area}};_ol_render_webgl_.EPSILON=Number.EPSILON||2220446049250313e-31,exports.default=_ol_render_webgl_},{}],166:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_array2=_interopRequireDefault(require("../../array.js")),_color2=_interopRequireDefault(require("../../color.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_obj2=_interopRequireDefault(require("../../obj.js")),_transform2=_interopRequireDefault(require("../../geom/flat/transform.js")),_defaultshader2=_interopRequireDefault(require("../webgl/circlereplay/defaultshader.js")),_locations2=_interopRequireDefault(require("../webgl/circlereplay/defaultshader/locations.js")),_replay2=_interopRequireDefault(require("../webgl/replay.js")),_webgl2=_interopRequireDefault(require("../webgl.js")),_webgl4=_interopRequireDefault(require("../../webgl.js")),_buffer2=_interopRequireDefault(require("../../webgl/buffer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_CircleReplay_=function(tolerance,maxExtent){_replay2.default.call(this,tolerance,maxExtent),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.radius_=0,this.state_={fillColor:null,strokeColor:null,lineDash:null,lineDashOffset:void 0,lineWidth:void 0,changed:!1}};_index2.default.inherits(_ol_render_webgl_CircleReplay_,_replay2.default),_ol_render_webgl_CircleReplay_.prototype.drawCoordinates_=function(flatCoordinates,offset,end,stride){var i,ii,numVertices=this.vertices.length,numIndices=this.indices.length,n=numVertices/4;for(i=offset,ii=end;i<ii;i+=stride)this.vertices[numVertices++]=flatCoordinates[i],this.vertices[numVertices++]=flatCoordinates[i+1],this.vertices[numVertices++]=0,this.vertices[numVertices++]=this.radius_,this.vertices[numVertices++]=flatCoordinates[i],this.vertices[numVertices++]=flatCoordinates[i+1],this.vertices[numVertices++]=1,this.vertices[numVertices++]=this.radius_,this.vertices[numVertices++]=flatCoordinates[i],this.vertices[numVertices++]=flatCoordinates[i+1],this.vertices[numVertices++]=2,this.vertices[numVertices++]=this.radius_,this.vertices[numVertices++]=flatCoordinates[i],this.vertices[numVertices++]=flatCoordinates[i+1],this.vertices[numVertices++]=3,this.vertices[numVertices++]=this.radius_,this.indices[numIndices++]=n,this.indices[numIndices++]=n+1,this.indices[numIndices++]=n+2,this.indices[numIndices++]=n+2,this.indices[numIndices++]=n+3,this.indices[numIndices++]=n,n+=4},_ol_render_webgl_CircleReplay_.prototype.drawCircle=function(circleGeometry,feature){var radius=circleGeometry.getRadius(),stride=circleGeometry.getStride();if(radius){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(feature),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.radius_=radius;var flatCoordinates=circleGeometry.getFlatCoordinates();flatCoordinates=_transform2.default.translate(flatCoordinates,0,2,stride,-this.origin[0],-this.origin[1]),this.drawCoordinates_(flatCoordinates,0,2,stride)}else if(this.state_.changed&&(this.styles_.pop(),this.styles_.length)){var lastState=this.styles_[this.styles_.length-1];this.state_.fillColor=lastState[0],this.state_.strokeColor=lastState[1],this.state_.lineWidth=lastState[2],this.state_.changed=!1}},_ol_render_webgl_CircleReplay_.prototype.finish=function(context){this.verticesBuffer=new _buffer2.default(this.vertices),this.indicesBuffer=new _buffer2.default(this.indices),this.startIndices.push(this.indices.length),0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]),this.vertices=null,this.indices=null},_ol_render_webgl_CircleReplay_.prototype.getDeleteResourcesFunction=function(context){var verticesBuffer=this.verticesBuffer,indicesBuffer=this.indicesBuffer;return function(){context.deleteBuffer(verticesBuffer),context.deleteBuffer(indicesBuffer)}},_ol_render_webgl_CircleReplay_.prototype.setUpProgram=function(gl,context,size,pixelRatio){var fragmentShader,vertexShader;fragmentShader=_defaultshader2.default.fragment,vertexShader=_defaultshader2.default.vertex;var locations,program=context.getProgram(fragmentShader,vertexShader);return this.defaultLocations_?locations=this.defaultLocations_:(locations=new _locations2.default(gl,program),this.defaultLocations_=locations),context.useProgram(program),gl.enableVertexAttribArray(locations.a_position),gl.vertexAttribPointer(locations.a_position,2,_webgl4.default.FLOAT,!1,16,0),gl.enableVertexAttribArray(locations.a_instruction),gl.vertexAttribPointer(locations.a_instruction,1,_webgl4.default.FLOAT,!1,16,8),gl.enableVertexAttribArray(locations.a_radius),gl.vertexAttribPointer(locations.a_radius,1,_webgl4.default.FLOAT,!1,16,12),gl.uniform2fv(locations.u_size,size),gl.uniform1f(locations.u_pixelRatio,pixelRatio),locations},_ol_render_webgl_CircleReplay_.prototype.shutDownProgram=function(gl,locations){gl.disableVertexAttribArray(locations.a_position),gl.disableVertexAttribArray(locations.a_instruction),gl.disableVertexAttribArray(locations.a_radius)},_ol_render_webgl_CircleReplay_.prototype.drawReplay=function(gl,context,skippedFeaturesHash,hitDetection){var i,start,end,nextStyle;if(_obj2.default.isEmpty(skippedFeaturesHash))for(end=this.startIndices[this.startIndices.length-1],i=this.styleIndices_.length-1;0<=i;--i)start=this.styleIndices_[i],nextStyle=this.styles_[i],this.setFillStyle_(gl,nextStyle[0]),this.setStrokeStyle_(gl,nextStyle[1],nextStyle[2]),this.drawElements(gl,context,start,end),end=start;else this.drawReplaySkipping_(gl,context,skippedFeaturesHash)},_ol_render_webgl_CircleReplay_.prototype.drawHitDetectionReplayOneByOne=function(gl,context,skippedFeaturesHash,featureCallback,opt_hitExtent){var i,start,end,nextStyle,groupStart,feature,featureIndex;for(featureIndex=this.startIndices.length-2,end=this.startIndices[featureIndex+1],i=this.styleIndices_.length-1;0<=i;--i)for(nextStyle=this.styles_[i],this.setFillStyle_(gl,nextStyle[0]),this.setStrokeStyle_(gl,nextStyle[1],nextStyle[2]),groupStart=this.styleIndices_[i];0<=featureIndex&&this.startIndices[featureIndex]>=groupStart;){if(start=this.startIndices[featureIndex],feature=this.startIndicesFeature[featureIndex],void 0===skippedFeaturesHash[_index2.default.getUid(feature).toString()]&&feature.getGeometry()&&(void 0===opt_hitExtent||_extent2.default.intersects(opt_hitExtent,feature.getGeometry().getExtent()))){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),this.drawElements(gl,context,start,end);var result=featureCallback(feature);if(result)return result}featureIndex--,end=start}},_ol_render_webgl_CircleReplay_.prototype.drawReplaySkipping_=function(gl,context,skippedFeaturesHash){var i,start,end,nextStyle,groupStart,feature,featureIndex,featureStart;for(featureIndex=this.startIndices.length-2,end=start=this.startIndices[featureIndex+1],i=this.styleIndices_.length-1;0<=i;--i){for(nextStyle=this.styles_[i],this.setFillStyle_(gl,nextStyle[0]),this.setStrokeStyle_(gl,nextStyle[1],nextStyle[2]),groupStart=this.styleIndices_[i];0<=featureIndex&&this.startIndices[featureIndex]>=groupStart;)featureStart=this.startIndices[featureIndex],feature=this.startIndicesFeature[featureIndex],skippedFeaturesHash[_index2.default.getUid(feature).toString()]&&(start!==end&&this.drawElements(gl,context,start,end),end=featureStart),featureIndex--,start=featureStart;start!==end&&this.drawElements(gl,context,start,end),start=end=groupStart}},_ol_render_webgl_CircleReplay_.prototype.setFillStyle_=function(gl,color){gl.uniform4fv(this.defaultLocations_.u_fillColor,color)},_ol_render_webgl_CircleReplay_.prototype.setStrokeStyle_=function(gl,color,lineWidth){gl.uniform4fv(this.defaultLocations_.u_strokeColor,color),gl.uniform1f(this.defaultLocations_.u_lineWidth,lineWidth)},_ol_render_webgl_CircleReplay_.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){var strokeStyleColor,strokeStyleWidth;if(strokeStyle){var strokeStyleLineDash=strokeStyle.getLineDash();this.state_.lineDash=strokeStyleLineDash||_webgl2.default.defaultLineDash;var strokeStyleLineDashOffset=strokeStyle.getLineDashOffset();this.state_.lineDashOffset=strokeStyleLineDashOffset||_webgl2.default.defaultLineDashOffset,strokeStyleColor=(strokeStyleColor=strokeStyle.getColor())instanceof CanvasGradient||strokeStyleColor instanceof CanvasPattern?_webgl2.default.defaultStrokeStyle:_color2.default.asArray(strokeStyleColor).map(function(c,i){return 3!=i?c/255:c})||_webgl2.default.defaultStrokeStyle,strokeStyleWidth=void 0!==(strokeStyleWidth=strokeStyle.getWidth())?strokeStyleWidth:_webgl2.default.defaultLineWidth}else strokeStyleColor=[0,0,0,0],strokeStyleWidth=0;var fillStyleColor=fillStyle?fillStyle.getColor():[0,0,0,0];fillStyleColor=fillStyleColor instanceof CanvasGradient||fillStyleColor instanceof CanvasPattern?_webgl2.default.defaultFillStyle:_color2.default.asArray(fillStyleColor).map(function(c,i){return 3!=i?c/255:c})||_webgl2.default.defaultFillStyle,this.state_.strokeColor&&_array2.default.equals(this.state_.strokeColor,strokeStyleColor)&&this.state_.fillColor&&_array2.default.equals(this.state_.fillColor,fillStyleColor)&&this.state_.lineWidth===strokeStyleWidth||(this.state_.changed=!0,this.state_.fillColor=fillStyleColor,this.state_.strokeColor=strokeStyleColor,this.state_.lineWidth=strokeStyleWidth,this.styles_.push([fillStyleColor,strokeStyleColor,strokeStyleWidth]))},exports.default=_ol_render_webgl_CircleReplay_},{"../../array.js":29,"../../color.js":36,"../../extent.js":54,"../../geom/flat/transform.js":76,"../../index.js":89,"../../obj.js":124,"../../webgl.js":248,"../../webgl/buffer.js":249,"../webgl.js":165,"../webgl/circlereplay/defaultshader.js":167,"../webgl/circlereplay/defaultshader/locations.js":168,"../webgl/replay.js":177}],167:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../../index.js")),_fragment2=_interopRequireDefault(require("../../../webgl/fragment.js")),_vertex2=_interopRequireDefault(require("../../../webgl/vertex.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_circlereplay_defaultshader_={};_ol_render_webgl_circlereplay_defaultshader_.fragment=new _fragment2.default(_index2.default.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_fillColor;\nuniform vec4 u_strokeColor;\nuniform vec2 u_size;\n\nvoid main(void) {\n  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  float radius = length(windowCenter - windowOffset);\n  float dist = length(windowCenter - gl_FragCoord.xy);\n  if (dist > radius + v_halfWidth) {\n    if (u_strokeColor.a == 0.0) {\n      gl_FragColor = u_fillColor;\n    } else {\n      gl_FragColor = u_strokeColor;\n    }\n    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));\n  } else if (u_fillColor.a == 0.0) {\n    // Hooray, no fill, just stroke. We can use real antialiasing.\n    gl_FragColor = u_strokeColor;\n    if (dist < radius - v_halfWidth) {\n      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);\n    }\n  } else {\n    gl_FragColor = u_fillColor;\n    float strokeDist = radius - v_halfWidth;\n    float antialias = 2.0 * v_pixelRatio;\n    if (dist > strokeDist) {\n      gl_FragColor = u_strokeColor;\n    } else if (dist >= strokeDist - antialias) {\n      float step = smoothstep(strokeDist - antialias, strokeDist, dist);\n      gl_FragColor = mix(u_fillColor, u_strokeColor, step);\n    }\n  }\n  gl_FragColor.a = gl_FragColor.a * u_opacity;\n  if (gl_FragColor.a <= 0.0) {\n    discard;\n  }\n}\n":"precision mediump float;varying vec2 a;varying vec2 b;varying float c;varying float d;uniform float m;uniform vec4 n;uniform vec4 o;uniform vec2 p;void main(void){vec2 windowCenter=vec2((a.x+1.0)/2.0*p.x*d,(a.y+1.0)/2.0*p.y*d);vec2 windowOffset=vec2((b.x+1.0)/2.0*p.x*d,(b.y+1.0)/2.0*p.y*d);float radius=length(windowCenter-windowOffset);float dist=length(windowCenter-gl_FragCoord.xy);if(dist>radius+c){if(o.a==0.0){gl_FragColor=n;}else{gl_FragColor=o;}gl_FragColor.a=gl_FragColor.a-(dist-(radius+c));}else if(n.a==0.0){gl_FragColor=o;if(dist<radius-c){gl_FragColor.a=gl_FragColor.a-(radius-c-dist);}} else{gl_FragColor=n;float strokeDist=radius-c;float antialias=2.0*d;if(dist>strokeDist){gl_FragColor=o;}else if(dist>=strokeDist-antialias){float step=smoothstep(strokeDist-antialias,strokeDist,dist);gl_FragColor=mix(n,o,step);}} gl_FragColor.a=gl_FragColor.a*m;if(gl_FragColor.a<=0.0){discard;}}"),_ol_render_webgl_circlereplay_defaultshader_.vertex=new _vertex2.default(_index2.default.DEBUG_WEBGL?"varying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\nattribute vec2 a_position;\nattribute float a_instruction;\nattribute float a_radius;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;\n  v_pixelRatio = u_pixelRatio;\n  float lineWidth = u_lineWidth * u_pixelRatio;\n  v_halfWidth = lineWidth / 2.0;\n  if (lineWidth == 0.0) {\n    lineWidth = 2.0 * u_pixelRatio;\n  }\n  vec2 offset;\n  // Radius with anitaliasing (roughly).\n  float radius = a_radius + 3.0 * u_pixelRatio;\n  // Until we get gl_VertexID in WebGL, we store an instruction.\n  if (a_instruction == 0.0) {\n    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however\n    // we should also leave some space for the antialiasing, thus we offset by lineWidth.\n    offset = vec2(-1.0, 1.0);\n  } else if (a_instruction == 1.0) {\n    offset = vec2(-1.0, -1.0);\n  } else if (a_instruction == 2.0) {\n    offset = vec2(1.0, -1.0);\n  } else {\n    offset = vec2(1.0, 1.0);\n  }\n\n  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +\n      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);\n  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,\n      0.0, 1.0)).xy;\n\n  if (distance(v_center, v_offset) > 20000.0) {\n    gl_Position = vec4(v_center, 0.0, 1.0);\n  }\n}\n\n\n":"varying vec2 a;varying vec2 b;varying float c;varying float d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;void main(void){mat4 offsetMatrix=i*j;a=vec4(h*vec4(e,0.0,1.0)).xy;d=l;float lineWidth=k*l;c=lineWidth/2.0;if(lineWidth==0.0){lineWidth=2.0*l;}vec2 offset;float radius=g+3.0*l;//Until we get gl_VertexID in WebGL,we store an instruction.if(f==0.0){//Offsetting the edges of the triangle by lineWidth/2 is necessary,however//we should also leave some space for the antialiasing,thus we offset by lineWidth.offset=vec2(-1.0,1.0);}else if(f==1.0){offset=vec2(-1.0,-1.0);}else if(f==2.0){offset=vec2(1.0,-1.0);}else{offset=vec2(1.0,1.0);}gl_Position=h*vec4(e+offset*radius,0.0,1.0)+offsetMatrix*vec4(offset*lineWidth,0.0,0.0);b=vec4(h*vec4(e.x+g,e.y,0.0,1.0)).xy;if(distance(a,b)>20000.0){gl_Position=vec4(a,0.0,1.0);}}"),exports.default=_ol_render_webgl_circlereplay_defaultshader_},{"../../../index.js":89,"../../../webgl/fragment.js":252,"../../../webgl/vertex.js":254}],168:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_index=require("../../../../index.js"),_index2=(obj=_index)&&obj.__esModule?obj:{default:obj};exports.default=function(gl,program){this.u_projectionMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_projectionMatrix":"h"),this.u_offsetScaleMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_offsetScaleMatrix":"i"),this.u_offsetRotateMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_offsetRotateMatrix":"j"),this.u_lineWidth=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_lineWidth":"k"),this.u_pixelRatio=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_pixelRatio":"l"),this.u_opacity=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_opacity":"m"),this.u_fillColor=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_fillColor":"n"),this.u_strokeColor=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_strokeColor":"o"),this.u_size=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_size":"p"),this.a_position=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_position":"e"),this.a_instruction=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_instruction":"f"),this.a_radius=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_radius":"g")}},{"../../../../index.js":89}],169:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_texturereplay2=_interopRequireDefault(require("../webgl/texturereplay.js")),_buffer2=_interopRequireDefault(require("../../webgl/buffer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_ImageReplay_=function(tolerance,maxExtent){_texturereplay2.default.call(this,tolerance,maxExtent),this.images_=[],this.hitDetectionImages_=[],this.textures_=[],this.hitDetectionTextures_=[]};_index2.default.inherits(_ol_render_webgl_ImageReplay_,_texturereplay2.default),_ol_render_webgl_ImageReplay_.prototype.drawMultiPoint=function(multiPointGeometry,feature){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(feature);var flatCoordinates=multiPointGeometry.getFlatCoordinates(),stride=multiPointGeometry.getStride();this.drawCoordinates(flatCoordinates,0,flatCoordinates.length,stride)},_ol_render_webgl_ImageReplay_.prototype.drawPoint=function(pointGeometry,feature){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(feature);var flatCoordinates=pointGeometry.getFlatCoordinates(),stride=pointGeometry.getStride();this.drawCoordinates(flatCoordinates,0,flatCoordinates.length,stride)},_ol_render_webgl_ImageReplay_.prototype.finish=function(context){var gl=context.getGL();this.groupIndices.push(this.indices.length),this.hitDetectionGroupIndices.push(this.indices.length),this.verticesBuffer=new _buffer2.default(this.vertices);var indices=this.indices;this.indicesBuffer=new _buffer2.default(indices);var texturePerImage={};this.createTextures(this.textures_,this.images_,texturePerImage,gl),this.createTextures(this.hitDetectionTextures_,this.hitDetectionImages_,texturePerImage,gl),this.images_=null,this.hitDetectionImages_=null,_texturereplay2.default.prototype.finish.call(this,context)},_ol_render_webgl_ImageReplay_.prototype.setImageStyle=function(imageStyle){var currentImage,anchor=imageStyle.getAnchor(),image=imageStyle.getImage(1),imageSize=imageStyle.getImageSize(),hitDetectionImage=imageStyle.getHitDetectionImage(1),opacity=imageStyle.getOpacity(),origin=imageStyle.getOrigin(),rotateWithView=imageStyle.getRotateWithView(),rotation=imageStyle.getRotation(),size=imageStyle.getSize(),scale=imageStyle.getScale();0===this.images_.length?this.images_.push(image):(currentImage=this.images_[this.images_.length-1],_index2.default.getUid(currentImage)!=_index2.default.getUid(image)&&(this.groupIndices.push(this.indices.length),this.images_.push(image))),0===this.hitDetectionImages_.length?this.hitDetectionImages_.push(hitDetectionImage):(currentImage=this.hitDetectionImages_[this.hitDetectionImages_.length-1],_index2.default.getUid(currentImage)!=_index2.default.getUid(hitDetectionImage)&&(this.hitDetectionGroupIndices.push(this.indices.length),this.hitDetectionImages_.push(hitDetectionImage))),this.anchorX=anchor[0],this.anchorY=anchor[1],this.height=size[1],this.imageHeight=imageSize[1],this.imageWidth=imageSize[0],this.opacity=opacity,this.originX=origin[0],this.originY=origin[1],this.rotation=rotation,this.rotateWithView=rotateWithView,this.scale=scale,this.width=size[0]},_ol_render_webgl_ImageReplay_.prototype.getTextures=function(opt_all){return opt_all?this.textures_.concat(this.hitDetectionTextures_):this.textures_},_ol_render_webgl_ImageReplay_.prototype.getHitDetectionTextures=function(){return this.hitDetectionTextures_},exports.default=_ol_render_webgl_ImageReplay_},{"../../index.js":89,"../../webgl/buffer.js":249,"../webgl/texturereplay.js":180}],170:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_geometrytype2=_interopRequireDefault(require("../../geom/geometrytype.js")),_replaytype2=_interopRequireDefault(require("../replaytype.js")),_vectorcontext2=_interopRequireDefault(require("../vectorcontext.js")),_replaygroup2=_interopRequireDefault(require("../webgl/replaygroup.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_Immediate_=function(context,center,resolution,rotation,size,extent,pixelRatio){_vectorcontext2.default.call(this),this.context_=context,this.center_=center,this.extent_=extent,this.pixelRatio_=pixelRatio,this.size_=size,this.rotation_=rotation,this.resolution_=resolution,this.imageStyle_=null,this.fillStyle_=null,this.strokeStyle_=null,this.textStyle_=null};_index2.default.inherits(_ol_render_webgl_Immediate_,_vectorcontext2.default),_ol_render_webgl_Immediate_.prototype.drawText_=function(replayGroup,geometry){var context=this.context_,replay=replayGroup.getReplay(0,_replaytype2.default.TEXT);replay.setTextStyle(this.textStyle_),replay.drawText(geometry,null),replay.finish(context);replay.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1),replay.getDeleteResourcesFunction(context)()},_ol_render_webgl_Immediate_.prototype.setStyle=function(style){this.setFillStrokeStyle(style.getFill(),style.getStroke()),this.setImageStyle(style.getImage()),this.setTextStyle(style.getText())},_ol_render_webgl_Immediate_.prototype.drawGeometry=function(geometry){switch(geometry.getType()){case _geometrytype2.default.POINT:this.drawPoint(geometry,null);break;case _geometrytype2.default.LINE_STRING:this.drawLineString(geometry,null);break;case _geometrytype2.default.POLYGON:this.drawPolygon(geometry,null);break;case _geometrytype2.default.MULTI_POINT:this.drawMultiPoint(geometry,null);break;case _geometrytype2.default.MULTI_LINE_STRING:this.drawMultiLineString(geometry,null);break;case _geometrytype2.default.MULTI_POLYGON:this.drawMultiPolygon(geometry,null);break;case _geometrytype2.default.GEOMETRY_COLLECTION:this.drawGeometryCollection(geometry,null);break;case _geometrytype2.default.CIRCLE:this.drawCircle(geometry,null)}},_ol_render_webgl_Immediate_.prototype.drawFeature=function(feature,style){var geometry=style.getGeometryFunction()(feature);geometry&&_extent2.default.intersects(this.extent_,geometry.getExtent())&&(this.setStyle(style),this.drawGeometry(geometry))},_ol_render_webgl_Immediate_.prototype.drawGeometryCollection=function(geometry,data){var i,ii,geometries=geometry.getGeometriesArray();for(i=0,ii=geometries.length;i<ii;++i)this.drawGeometry(geometries[i])},_ol_render_webgl_Immediate_.prototype.drawPoint=function(geometry,data){var context=this.context_,replayGroup=new _replaygroup2.default(1,this.extent_),replay=replayGroup.getReplay(0,_replaytype2.default.IMAGE);replay.setImageStyle(this.imageStyle_),replay.drawPoint(geometry,data),replay.finish(context);replay.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1),replay.getDeleteResourcesFunction(context)(),this.textStyle_&&this.drawText_(replayGroup,geometry)},_ol_render_webgl_Immediate_.prototype.drawMultiPoint=function(geometry,data){var context=this.context_,replayGroup=new _replaygroup2.default(1,this.extent_),replay=replayGroup.getReplay(0,_replaytype2.default.IMAGE);replay.setImageStyle(this.imageStyle_),replay.drawMultiPoint(geometry,data),replay.finish(context);replay.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1),replay.getDeleteResourcesFunction(context)(),this.textStyle_&&this.drawText_(replayGroup,geometry)},_ol_render_webgl_Immediate_.prototype.drawLineString=function(geometry,data){var context=this.context_,replayGroup=new _replaygroup2.default(1,this.extent_),replay=replayGroup.getReplay(0,_replaytype2.default.LINE_STRING);replay.setFillStrokeStyle(null,this.strokeStyle_),replay.drawLineString(geometry,data),replay.finish(context);replay.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1),replay.getDeleteResourcesFunction(context)(),this.textStyle_&&this.drawText_(replayGroup,geometry)},_ol_render_webgl_Immediate_.prototype.drawMultiLineString=function(geometry,data){var context=this.context_,replayGroup=new _replaygroup2.default(1,this.extent_),replay=replayGroup.getReplay(0,_replaytype2.default.LINE_STRING);replay.setFillStrokeStyle(null,this.strokeStyle_),replay.drawMultiLineString(geometry,data),replay.finish(context);replay.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1),replay.getDeleteResourcesFunction(context)(),this.textStyle_&&this.drawText_(replayGroup,geometry)},_ol_render_webgl_Immediate_.prototype.drawPolygon=function(geometry,data){var context=this.context_,replayGroup=new _replaygroup2.default(1,this.extent_),replay=replayGroup.getReplay(0,_replaytype2.default.POLYGON);replay.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),replay.drawPolygon(geometry,data),replay.finish(context);replay.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1),replay.getDeleteResourcesFunction(context)(),this.textStyle_&&this.drawText_(replayGroup,geometry)},_ol_render_webgl_Immediate_.prototype.drawMultiPolygon=function(geometry,data){var context=this.context_,replayGroup=new _replaygroup2.default(1,this.extent_),replay=replayGroup.getReplay(0,_replaytype2.default.POLYGON);replay.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),replay.drawMultiPolygon(geometry,data),replay.finish(context);replay.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1),replay.getDeleteResourcesFunction(context)(),this.textStyle_&&this.drawText_(replayGroup,geometry)},_ol_render_webgl_Immediate_.prototype.drawCircle=function(geometry,data){var context=this.context_,replayGroup=new _replaygroup2.default(1,this.extent_),replay=replayGroup.getReplay(0,_replaytype2.default.CIRCLE);replay.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),replay.drawCircle(geometry,data),replay.finish(context);replay.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1),replay.getDeleteResourcesFunction(context)(),this.textStyle_&&this.drawText_(replayGroup,geometry)},_ol_render_webgl_Immediate_.prototype.setImageStyle=function(imageStyle){this.imageStyle_=imageStyle},_ol_render_webgl_Immediate_.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){this.fillStyle_=fillStyle,this.strokeStyle_=strokeStyle},_ol_render_webgl_Immediate_.prototype.setTextStyle=function(textStyle){this.textStyle_=textStyle},exports.default=_ol_render_webgl_Immediate_},{"../../extent.js":54,"../../geom/geometrytype.js":79,"../../index.js":89,"../replaytype.js":163,"../vectorcontext.js":164,"../webgl/replaygroup.js":178}],171:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_array2=_interopRequireDefault(require("../../array.js")),_color2=_interopRequireDefault(require("../../color.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_orient2=_interopRequireDefault(require("../../geom/flat/orient.js")),_transform2=_interopRequireDefault(require("../../geom/flat/transform.js")),_topology2=_interopRequireDefault(require("../../geom/flat/topology.js")),_obj2=_interopRequireDefault(require("../../obj.js")),_webgl2=_interopRequireDefault(require("../webgl.js")),_replay2=_interopRequireDefault(require("../webgl/replay.js")),_defaultshader2=_interopRequireDefault(require("../webgl/linestringreplay/defaultshader.js")),_locations2=_interopRequireDefault(require("../webgl/linestringreplay/defaultshader/locations.js")),_webgl4=_interopRequireDefault(require("../../webgl.js")),_buffer2=_interopRequireDefault(require("../../webgl/buffer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_LineStringReplay_=function(tolerance,maxExtent){_replay2.default.call(this,tolerance,maxExtent),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0,changed:!1}};_index2.default.inherits(_ol_render_webgl_LineStringReplay_,_replay2.default),_ol_render_webgl_LineStringReplay_.prototype.drawCoordinates_=function(flatCoordinates,offset,end,stride){var i,ii,startCoords,sign,n,p0,p1,p2,numVertices=this.vertices.length,numIndices=this.indices.length,lineJoin="bevel"===this.state_.lineJoin?0:"miter"===this.state_.lineJoin?1:2,lineCap="butt"===this.state_.lineCap?0:"square"===this.state_.lineCap?1:2,closed=_topology2.default.lineStringIsClosed(flatCoordinates,offset,end,stride),lastIndex=numIndices,lastSign=1;for(i=offset,ii=end;i<ii;i+=stride){if(n=numVertices/7,p0=p1,p1=p2||[flatCoordinates[i],flatCoordinates[i+1]],i===offset){if(p2=[flatCoordinates[i+stride],flatCoordinates[i+stride+1]],end-offset==2*stride&&_array2.default.equals(p1,p2))break;if(!closed){lineCap&&(numVertices=this.addVertices_([0,0],p1,p2,lastSign*_ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE_CAP*lineCap,numVertices),numVertices=this.addVertices_([0,0],p1,p2,-lastSign*_ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE_CAP*lineCap,numVertices),this.indices[numIndices++]=n+2,this.indices[numIndices++]=n,this.indices[numIndices++]=n+1,this.indices[numIndices++]=n+1,this.indices[numIndices++]=n+3,this.indices[numIndices++]=n+2),numVertices=this.addVertices_([0,0],p1,p2,lastSign*_ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE*(lineCap||1),numVertices),lastIndex=(numVertices=this.addVertices_([0,0],p1,p2,-lastSign*_ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE*(lineCap||1),numVertices))/7-1;continue}p0=[flatCoordinates[end-2*stride],flatCoordinates[end-2*stride+1]],startCoords=p2}else{if(i===end-stride){if(closed){p2=startCoords;break}p0=p0||[0,0],numVertices=this.addVertices_(p0,p1,[0,0],lastSign*_ol_render_webgl_LineStringReplay_.Instruction_.END_LINE*(lineCap||1),numVertices),numVertices=this.addVertices_(p0,p1,[0,0],-lastSign*_ol_render_webgl_LineStringReplay_.Instruction_.END_LINE*(lineCap||1),numVertices),this.indices[numIndices++]=n,this.indices[numIndices++]=lastIndex-1,this.indices[numIndices++]=lastIndex,this.indices[numIndices++]=lastIndex,this.indices[numIndices++]=n+1,this.indices[numIndices++]=n,lineCap&&(numVertices=this.addVertices_(p0,p1,[0,0],lastSign*_ol_render_webgl_LineStringReplay_.Instruction_.END_LINE_CAP*lineCap,numVertices),numVertices=this.addVertices_(p0,p1,[0,0],-lastSign*_ol_render_webgl_LineStringReplay_.Instruction_.END_LINE_CAP*lineCap,numVertices),this.indices[numIndices++]=n+2,this.indices[numIndices++]=n,this.indices[numIndices++]=n+1,this.indices[numIndices++]=n+1,this.indices[numIndices++]=n+3,this.indices[numIndices++]=n+2);break}p2=[flatCoordinates[i+stride],flatCoordinates[i+stride+1]]}sign=_webgl2.default.triangleIsCounterClockwise(p0[0],p0[1],p1[0],p1[1],p2[0],p2[1])?-1:1,numVertices=this.addVertices_(p0,p1,p2,sign*_ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_FIRST*(lineJoin||1),numVertices),numVertices=this.addVertices_(p0,p1,p2,sign*_ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_SECOND*(lineJoin||1),numVertices),numVertices=this.addVertices_(p0,p1,p2,-sign*_ol_render_webgl_LineStringReplay_.Instruction_.MITER_BOTTOM*(lineJoin||1),numVertices),offset<i&&(this.indices[numIndices++]=n,this.indices[numIndices++]=lastIndex-1,this.indices[numIndices++]=lastIndex,this.indices[numIndices++]=n+2,this.indices[numIndices++]=n,this.indices[numIndices++]=0<lastSign*sign?lastIndex:lastIndex-1),this.indices[numIndices++]=n,this.indices[numIndices++]=n+2,this.indices[numIndices++]=n+1,lastIndex=n+2,lastSign=sign,lineJoin&&(numVertices=this.addVertices_(p0,p1,p2,sign*_ol_render_webgl_LineStringReplay_.Instruction_.MITER_TOP*lineJoin,numVertices),this.indices[numIndices++]=n+1,this.indices[numIndices++]=n+3,this.indices[numIndices++]=n)}closed&&(n=n||numVertices/7,sign=_orient2.default.linearRingIsClockwise([p0[0],p0[1],p1[0],p1[1],p2[0],p2[1]],0,6,2)?1:-1,numVertices=this.addVertices_(p0,p1,p2,sign*_ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_FIRST*(lineJoin||1),numVertices),numVertices=this.addVertices_(p0,p1,p2,-sign*_ol_render_webgl_LineStringReplay_.Instruction_.MITER_BOTTOM*(lineJoin||1),numVertices),this.indices[numIndices++]=n,this.indices[numIndices++]=lastIndex-1,this.indices[numIndices++]=lastIndex,this.indices[numIndices++]=n+1,this.indices[numIndices++]=n,this.indices[numIndices++]=0<lastSign*sign?lastIndex:lastIndex-1)},_ol_render_webgl_LineStringReplay_.prototype.addVertices_=function(p0,p1,p2,product,numVertices){return this.vertices[numVertices++]=p0[0],this.vertices[numVertices++]=p0[1],this.vertices[numVertices++]=p1[0],this.vertices[numVertices++]=p1[1],this.vertices[numVertices++]=p2[0],this.vertices[numVertices++]=p2[1],this.vertices[numVertices++]=product,numVertices},_ol_render_webgl_LineStringReplay_.prototype.isValid_=function(flatCoordinates,offset,end,stride){var range=end-offset;if(range<2*stride)return!1;if(range!==2*stride)return!0;var firstP=[flatCoordinates[offset],flatCoordinates[offset+1]],lastP=[flatCoordinates[offset+stride],flatCoordinates[offset+stride+1]];return!_array2.default.equals(firstP,lastP)},_ol_render_webgl_LineStringReplay_.prototype.drawLineString=function(lineStringGeometry,feature){var flatCoordinates=lineStringGeometry.getFlatCoordinates(),stride=lineStringGeometry.getStride();this.isValid_(flatCoordinates,0,flatCoordinates.length,stride)&&(flatCoordinates=_transform2.default.translate(flatCoordinates,0,flatCoordinates.length,stride,-this.origin[0],-this.origin[1]),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.startIndices.push(this.indices.length),this.startIndicesFeature.push(feature),this.drawCoordinates_(flatCoordinates,0,flatCoordinates.length,stride))},_ol_render_webgl_LineStringReplay_.prototype.drawMultiLineString=function(multiLineStringGeometry,feature){var indexCount=this.indices.length,ends=multiLineStringGeometry.getEnds();ends.unshift(0);var i,ii,flatCoordinates=multiLineStringGeometry.getFlatCoordinates(),stride=multiLineStringGeometry.getStride();if(1<ends.length)for(i=1,ii=ends.length;i<ii;++i)if(this.isValid_(flatCoordinates,ends[i-1],ends[i],stride)){var lineString=_transform2.default.translate(flatCoordinates,ends[i-1],ends[i],stride,-this.origin[0],-this.origin[1]);this.drawCoordinates_(lineString,0,lineString.length,stride)}this.indices.length>indexCount&&(this.startIndices.push(indexCount),this.startIndicesFeature.push(feature),this.state_.changed&&(this.styleIndices_.push(indexCount),this.state_.changed=!1))},_ol_render_webgl_LineStringReplay_.prototype.drawPolygonCoordinates=function(flatCoordinates,holeFlatCoordinates,stride){var i,ii;if(_topology2.default.lineStringIsClosed(flatCoordinates,0,flatCoordinates.length,stride)||(flatCoordinates.push(flatCoordinates[0]),flatCoordinates.push(flatCoordinates[1])),this.drawCoordinates_(flatCoordinates,0,flatCoordinates.length,stride),holeFlatCoordinates.length)for(i=0,ii=holeFlatCoordinates.length;i<ii;++i)_topology2.default.lineStringIsClosed(holeFlatCoordinates[i],0,holeFlatCoordinates[i].length,stride)||(holeFlatCoordinates[i].push(holeFlatCoordinates[i][0]),holeFlatCoordinates[i].push(holeFlatCoordinates[i][1])),this.drawCoordinates_(holeFlatCoordinates[i],0,holeFlatCoordinates[i].length,stride)},_ol_render_webgl_LineStringReplay_.prototype.setPolygonStyle=function(feature,opt_index){var index=void 0===opt_index?this.indices.length:opt_index;this.startIndices.push(index),this.startIndicesFeature.push(feature),this.state_.changed&&(this.styleIndices_.push(index),this.state_.changed=!1)},_ol_render_webgl_LineStringReplay_.prototype.getCurrentIndex=function(){return this.indices.length},_ol_render_webgl_LineStringReplay_.prototype.finish=function(context){this.verticesBuffer=new _buffer2.default(this.vertices),this.indicesBuffer=new _buffer2.default(this.indices),this.startIndices.push(this.indices.length),0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]),this.vertices=null,this.indices=null},_ol_render_webgl_LineStringReplay_.prototype.getDeleteResourcesFunction=function(context){var verticesBuffer=this.verticesBuffer,indicesBuffer=this.indicesBuffer;return function(){context.deleteBuffer(verticesBuffer),context.deleteBuffer(indicesBuffer)}},_ol_render_webgl_LineStringReplay_.prototype.setUpProgram=function(gl,context,size,pixelRatio){var fragmentShader,vertexShader;fragmentShader=_defaultshader2.default.fragment,vertexShader=_defaultshader2.default.vertex;var locations,program=context.getProgram(fragmentShader,vertexShader);return this.defaultLocations_?locations=this.defaultLocations_:(locations=new _locations2.default(gl,program),this.defaultLocations_=locations),context.useProgram(program),gl.enableVertexAttribArray(locations.a_lastPos),gl.vertexAttribPointer(locations.a_lastPos,2,_webgl4.default.FLOAT,!1,28,0),gl.enableVertexAttribArray(locations.a_position),gl.vertexAttribPointer(locations.a_position,2,_webgl4.default.FLOAT,!1,28,8),gl.enableVertexAttribArray(locations.a_nextPos),gl.vertexAttribPointer(locations.a_nextPos,2,_webgl4.default.FLOAT,!1,28,16),gl.enableVertexAttribArray(locations.a_direction),gl.vertexAttribPointer(locations.a_direction,1,_webgl4.default.FLOAT,!1,28,24),gl.uniform2fv(locations.u_size,size),gl.uniform1f(locations.u_pixelRatio,pixelRatio),locations},_ol_render_webgl_LineStringReplay_.prototype.shutDownProgram=function(gl,locations){gl.disableVertexAttribArray(locations.a_lastPos),gl.disableVertexAttribArray(locations.a_position),gl.disableVertexAttribArray(locations.a_nextPos),gl.disableVertexAttribArray(locations.a_direction)},_ol_render_webgl_LineStringReplay_.prototype.drawReplay=function(gl,context,skippedFeaturesHash,hitDetection){var i,start,end,nextStyle,tmpDepthFunc=gl.getParameter(gl.DEPTH_FUNC),tmpDepthMask=gl.getParameter(gl.DEPTH_WRITEMASK);if(hitDetection||(gl.enable(gl.DEPTH_TEST),gl.depthMask(!0),gl.depthFunc(gl.NOTEQUAL)),_obj2.default.isEmpty(skippedFeaturesHash))for(end=this.startIndices[this.startIndices.length-1],i=this.styleIndices_.length-1;0<=i;--i)start=this.styleIndices_[i],nextStyle=this.styles_[i],this.setStrokeStyle_(gl,nextStyle[0],nextStyle[1],nextStyle[2]),this.drawElements(gl,context,start,end),gl.clear(gl.DEPTH_BUFFER_BIT),end=start;else this.drawReplaySkipping_(gl,context,skippedFeaturesHash);hitDetection||(gl.disable(gl.DEPTH_TEST),gl.clear(gl.DEPTH_BUFFER_BIT),gl.depthMask(tmpDepthMask),gl.depthFunc(tmpDepthFunc))},_ol_render_webgl_LineStringReplay_.prototype.drawReplaySkipping_=function(gl,context,skippedFeaturesHash){var i,start,end,nextStyle,groupStart,feature,featureIndex,featureStart;for(featureIndex=this.startIndices.length-2,end=start=this.startIndices[featureIndex+1],i=this.styleIndices_.length-1;0<=i;--i){for(nextStyle=this.styles_[i],this.setStrokeStyle_(gl,nextStyle[0],nextStyle[1],nextStyle[2]),groupStart=this.styleIndices_[i];0<=featureIndex&&this.startIndices[featureIndex]>=groupStart;)featureStart=this.startIndices[featureIndex],feature=this.startIndicesFeature[featureIndex],skippedFeaturesHash[_index2.default.getUid(feature).toString()]&&(start!==end&&(this.drawElements(gl,context,start,end),gl.clear(gl.DEPTH_BUFFER_BIT)),end=featureStart),featureIndex--,start=featureStart;start!==end&&(this.drawElements(gl,context,start,end),gl.clear(gl.DEPTH_BUFFER_BIT)),start=end=groupStart}},_ol_render_webgl_LineStringReplay_.prototype.drawHitDetectionReplayOneByOne=function(gl,context,skippedFeaturesHash,featureCallback,opt_hitExtent){var i,start,end,nextStyle,groupStart,feature,featureIndex;for(featureIndex=this.startIndices.length-2,end=this.startIndices[featureIndex+1],i=this.styleIndices_.length-1;0<=i;--i)for(nextStyle=this.styles_[i],this.setStrokeStyle_(gl,nextStyle[0],nextStyle[1],nextStyle[2]),groupStart=this.styleIndices_[i];0<=featureIndex&&this.startIndices[featureIndex]>=groupStart;){if(start=this.startIndices[featureIndex],feature=this.startIndicesFeature[featureIndex],void 0===skippedFeaturesHash[_index2.default.getUid(feature).toString()]&&feature.getGeometry()&&(void 0===opt_hitExtent||_extent2.default.intersects(opt_hitExtent,feature.getGeometry().getExtent()))){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),this.drawElements(gl,context,start,end);var result=featureCallback(feature);if(result)return result}featureIndex--,end=start}},_ol_render_webgl_LineStringReplay_.prototype.setStrokeStyle_=function(gl,color,lineWidth,miterLimit){gl.uniform4fv(this.defaultLocations_.u_color,color),gl.uniform1f(this.defaultLocations_.u_lineWidth,lineWidth),gl.uniform1f(this.defaultLocations_.u_miterLimit,miterLimit)},_ol_render_webgl_LineStringReplay_.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){var strokeStyleLineCap=strokeStyle.getLineCap();this.state_.lineCap=void 0!==strokeStyleLineCap?strokeStyleLineCap:_webgl2.default.defaultLineCap;var strokeStyleLineDash=strokeStyle.getLineDash();this.state_.lineDash=strokeStyleLineDash||_webgl2.default.defaultLineDash;var strokeStyleLineDashOffset=strokeStyle.getLineDashOffset();this.state_.lineDashOffset=strokeStyleLineDashOffset||_webgl2.default.defaultLineDashOffset;var strokeStyleLineJoin=strokeStyle.getLineJoin();this.state_.lineJoin=void 0!==strokeStyleLineJoin?strokeStyleLineJoin:_webgl2.default.defaultLineJoin;var strokeStyleColor=strokeStyle.getColor();strokeStyleColor=strokeStyleColor instanceof CanvasGradient||strokeStyleColor instanceof CanvasPattern?_webgl2.default.defaultStrokeStyle:_color2.default.asArray(strokeStyleColor).map(function(c,i){return 3!=i?c/255:c})||_webgl2.default.defaultStrokeStyle;var strokeStyleWidth=strokeStyle.getWidth();strokeStyleWidth=void 0!==strokeStyleWidth?strokeStyleWidth:_webgl2.default.defaultLineWidth;var strokeStyleMiterLimit=strokeStyle.getMiterLimit();strokeStyleMiterLimit=void 0!==strokeStyleMiterLimit?strokeStyleMiterLimit:_webgl2.default.defaultMiterLimit,this.state_.strokeColor&&_array2.default.equals(this.state_.strokeColor,strokeStyleColor)&&this.state_.lineWidth===strokeStyleWidth&&this.state_.miterLimit===strokeStyleMiterLimit||(this.state_.changed=!0,this.state_.strokeColor=strokeStyleColor,this.state_.lineWidth=strokeStyleWidth,this.state_.miterLimit=strokeStyleMiterLimit,this.styles_.push([strokeStyleColor,strokeStyleWidth,strokeStyleMiterLimit]))},_ol_render_webgl_LineStringReplay_.Instruction_={ROUND:2,BEGIN_LINE:3,END_LINE:5,BEGIN_LINE_CAP:7,END_LINE_CAP:11,BEVEL_FIRST:13,BEVEL_SECOND:17,MITER_BOTTOM:19,MITER_TOP:23},exports.default=_ol_render_webgl_LineStringReplay_},{"../../array.js":29,"../../color.js":36,"../../extent.js":54,"../../geom/flat/orient.js":69,"../../geom/flat/topology.js":75,"../../geom/flat/transform.js":76,"../../index.js":89,"../../obj.js":124,"../../webgl.js":248,"../../webgl/buffer.js":249,"../webgl.js":165,"../webgl/linestringreplay/defaultshader.js":172,"../webgl/linestringreplay/defaultshader/locations.js":173,"../webgl/replay.js":177}],172:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../../index.js")),_fragment2=_interopRequireDefault(require("../../../webgl/fragment.js")),_vertex2=_interopRequireDefault(require("../../../webgl/vertex.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_linestringreplay_defaultshader_={};_ol_render_webgl_linestringreplay_defaultshader_.fragment=new _fragment2.default(_index2.default.DEBUG_WEBGL?"precision mediump float;\nvarying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_color;\nuniform vec2 u_size;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  if (v_round > 0.0) {\n    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,\n        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);\n    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {\n      discard;\n    }\n  }\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n":"precision mediump float;varying float a;varying vec2 aVertex;varying float c;uniform float m;uniform vec4 n;uniform vec2 o;uniform float p;void main(void){if(a>0.0){vec2 windowCoords=vec2((aVertex.x+1.0)/2.0*o.x*p,(aVertex.y+1.0)/2.0*o.y*p);if(length(windowCoords-gl_FragCoord.xy)>c*p){discard;}} gl_FragColor=n;float alpha=n.a*m;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}"),_ol_render_webgl_linestringreplay_defaultshader_.vertex=new _vertex2.default(_index2.default.DEBUG_WEBGL?"varying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\nattribute vec2 a_lastPos;\nattribute vec2 a_position;\nattribute vec2 a_nextPos;\nattribute float a_direction;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_miterLimit;\n\nbool nearlyEquals(in float value, in float ref) {\n  float epsilon = 0.000000000001;\n  return value >= ref - epsilon && value <= ref + epsilon;\n}\n\nvoid alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {\n  vec2 dirVect = nextP - a_position;\n  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));\n  offset = u_lineWidth / 2.0 * normal * direction;\n}\n\nvoid miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {\n  float halfWidth = u_lineWidth / 2.0;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_nextPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n  offset = normal * direction * miterLength;\n  round = 0.0;\n  if (isRound) {\n    round = 1.0;\n  } else if (miterLength > u_miterLimit + u_lineWidth) {\n    offset = halfWidth * tmpNormal * direction;\n  }\n}\n\nbool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {\n  bool degenerate = false;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_lastPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  vec2 longOffset, shortOffset, longVertex;\n  vec4 shortProjVertex;\n  float halfWidth = u_lineWidth / 2.0;\n  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {\n    longOffset = tmpNormal * direction * halfWidth;\n    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_nextPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);\n  } else {\n    shortOffset = tmpNormal * direction * halfWidth;\n    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_lastPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);\n  }\n  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).\n  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);\n  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);\n  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);\n  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;\n  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;\n  float epsilon = 0.000000000001;\n  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {\n    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);\n    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);\n    offset = shortProjVertex.xy;\n    degenerate = true;\n  } else {\n    float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n    offset = normal * direction * miterLength;\n  }\n  return degenerate;\n}\n\nvoid squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,\n    in float turnDir, in float direction) {\n  round = 0.0;\n  vec2 dirVect = a_position - nextP;\n  vec2 firstNormal = normalize(dirVect);\n  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);\n  vec2 hypotenuse = normalize(firstNormal - secondNormal);\n  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);\n  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);\n  offset = normal * length;\n  if (isRound) {\n    round = 1.0;\n  }\n}\n\nvoid main(void) {\n  bool degenerate = false;\n  float direction = float(sign(a_direction));\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  vec2 offset;\n  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);\n\n  v_round = 0.0;\n  v_halfWidth = u_lineWidth / 2.0;\n  v_roundVertex = projPos.xy;\n\n  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {\n    alongNormal(offset, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {\n    alongNormal(offset, a_lastPos, -1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {\n    miterUp(offset, v_round, round, direction);\n  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {\n    degenerate = miterDown(offset, projPos, offsetMatrix, direction);\n  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {\n    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {\n    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);\n  }\n  if (!degenerate) {\n    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);\n    gl_Position = projPos + offsets;\n  } else {\n    gl_Position = vec4(offset, 0.0, 1.0);\n  }\n}\n\n\n":"varying float a;varying vec2 aVertex;varying float c;attribute vec2 d;attribute vec2 e;attribute vec2 f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;bool nearlyEquals(in float value,in float ref){float epsilon=0.000000000001;return value>=ref-epsilon&&value<=ref+epsilon;}void alongNormal(out vec2 offset,in vec2 nextP,in float turnDir,in float direction){vec2 dirVect=nextP-e;vec2 normal=normalize(vec2(-turnDir*dirVect.y,turnDir*dirVect.x));offset=k/2.0*normal*direction;}void miterUp(out vec2 offset,out float round,in bool isRound,in float direction){float halfWidth=k/2.0;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=f-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;round=0.0;if(isRound){round=1.0;}else if(miterLength>l+k){offset=halfWidth*tmpNormal*direction;}} bool miterDown(out vec2 offset,in vec4 projPos,in mat4 offsetMatrix,in float direction){bool degenerate=false;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=d-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));vec2 longOffset,shortOffset,longVertex;vec4 shortProjVertex;float halfWidth=k/2.0;if(length(f-e)>length(d-e)){longOffset=tmpNormal*direction*halfWidth;shortOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=f;shortProjVertex=h*vec4(d,0.0,1.0);}else{shortOffset=tmpNormal*direction*halfWidth;longOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=d;shortProjVertex=h*vec4(f,0.0,1.0);}vec4 p1=h*vec4(longVertex,0.0,1.0)+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p2=projPos+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p3=shortProjVertex+offsetMatrix*vec4(-shortOffset,0.0,0.0);vec4 p4=shortProjVertex+offsetMatrix*vec4(shortOffset,0.0,0.0);float denom=(p4.y-p3.y)*(p2.x-p1.x)-(p4.x-p3.x)*(p2.y-p1.y);float firstU=((p4.x-p3.x)*(p1.y-p3.y)-(p4.y-p3.y)*(p1.x-p3.x))/denom;float secondU=((p2.x-p1.x)*(p1.y-p3.y)-(p2.y-p1.y)*(p1.x-p3.x))/denom;float epsilon=0.000000000001;if(firstU>epsilon&&firstU<1.0-epsilon&&secondU>epsilon&&secondU<1.0-epsilon){shortProjVertex.x=p1.x+firstU*(p2.x-p1.x);shortProjVertex.y=p1.y+firstU*(p2.y-p1.y);offset=shortProjVertex.xy;degenerate=true;}else{float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;}return degenerate;}void squareCap(out vec2 offset,out float round,in bool isRound,in vec2 nextP,in float turnDir,in float direction){round=0.0;vec2 dirVect=e-nextP;vec2 firstNormal=normalize(dirVect);vec2 secondNormal=vec2(turnDir*firstNormal.y*direction,-turnDir*firstNormal.x*direction);vec2 hypotenuse=normalize(firstNormal-secondNormal);vec2 normal=vec2(turnDir*hypotenuse.y*direction,-turnDir*hypotenuse.x*direction);float length=sqrt(c*c*2.0);offset=normal*length;if(isRound){round=1.0;}} void main(void){bool degenerate=false;float direction=float(sign(g));mat4 offsetMatrix=i*j;vec2 offset;vec4 projPos=h*vec4(e,0.0,1.0);bool round=nearlyEquals(mod(g,2.0),0.0);a=0.0;c=k/2.0;aVertex=projPos.xy;if(nearlyEquals(mod(g,3.0),0.0)||nearlyEquals(mod(g,17.0),0.0)){alongNormal(offset,f,1.0,direction);}else if(nearlyEquals(mod(g,5.0),0.0)||nearlyEquals(mod(g,13.0),0.0)){alongNormal(offset,d,-1.0,direction);}else if(nearlyEquals(mod(g,23.0),0.0)){miterUp(offset,a,round,direction);}else if(nearlyEquals(mod(g,19.0),0.0)){degenerate=miterDown(offset,projPos,offsetMatrix,direction);}else if(nearlyEquals(mod(g,7.0),0.0)){squareCap(offset,a,round,f,1.0,direction);}else if(nearlyEquals(mod(g,11.0),0.0)){squareCap(offset,a,round,d,-1.0,direction);}if(!degenerate){vec4 offsets=offsetMatrix*vec4(offset,0.0,0.0);gl_Position=projPos+offsets;}else{gl_Position=vec4(offset,0.0,1.0);}}"),exports.default=_ol_render_webgl_linestringreplay_defaultshader_},{"../../../index.js":89,"../../../webgl/fragment.js":252,"../../../webgl/vertex.js":254}],173:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_index=require("../../../../index.js"),_index2=(obj=_index)&&obj.__esModule?obj:{default:obj};exports.default=function(gl,program){this.u_projectionMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_projectionMatrix":"h"),this.u_offsetScaleMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_offsetScaleMatrix":"i"),this.u_offsetRotateMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_offsetRotateMatrix":"j"),this.u_lineWidth=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_lineWidth":"k"),this.u_miterLimit=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_miterLimit":"l"),this.u_opacity=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_opacity":"m"),this.u_color=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_color":"n"),this.u_size=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_size":"o"),this.u_pixelRatio=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_pixelRatio":"p"),this.a_lastPos=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_lastPos":"d"),this.a_position=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_position":"e"),this.a_nextPos=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_nextPos":"f"),this.a_direction=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_direction":"g")}},{"../../../../index.js":89}],174:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_array2=_interopRequireDefault(require("../../array.js")),_color2=_interopRequireDefault(require("../../color.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_obj2=_interopRequireDefault(require("../../obj.js")),_contains2=_interopRequireDefault(require("../../geom/flat/contains.js")),_orient2=_interopRequireDefault(require("../../geom/flat/orient.js")),_transform2=_interopRequireDefault(require("../../geom/flat/transform.js")),_defaultshader2=_interopRequireDefault(require("../webgl/polygonreplay/defaultshader.js")),_locations2=_interopRequireDefault(require("../webgl/polygonreplay/defaultshader/locations.js")),_linestringreplay2=_interopRequireDefault(require("../webgl/linestringreplay.js")),_replay2=_interopRequireDefault(require("../webgl/replay.js")),_webgl2=_interopRequireDefault(require("../webgl.js")),_stroke2=_interopRequireDefault(require("../../style/stroke.js")),_linkedlist2=_interopRequireDefault(require("../../structs/linkedlist.js")),_rbush2=_interopRequireDefault(require("../../structs/rbush.js")),_webgl4=_interopRequireDefault(require("../../webgl.js")),_buffer2=_interopRequireDefault(require("../../webgl/buffer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_PolygonReplay_=function(tolerance,maxExtent){_replay2.default.call(this,tolerance,maxExtent),this.lineStringReplay=new _linestringreplay2.default(tolerance,maxExtent),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.state_={fillColor:null,changed:!1}};_index2.default.inherits(_ol_render_webgl_PolygonReplay_,_replay2.default),_ol_render_webgl_PolygonReplay_.prototype.drawCoordinates_=function(flatCoordinates,holeFlatCoordinates,stride){var outerRing=new _linkedlist2.default,rtree=new _rbush2.default;this.processFlatCoordinates_(flatCoordinates,stride,outerRing,rtree,!0);var maxCoords=this.getMaxCoords_(outerRing);if(holeFlatCoordinates.length){var i,ii,holeLists=[];for(i=0,ii=holeFlatCoordinates.length;i<ii;++i){var holeList={list:new _linkedlist2.default,maxCoords:void 0,rtree:new _rbush2.default};holeLists.push(holeList),this.processFlatCoordinates_(holeFlatCoordinates[i],stride,holeList.list,holeList.rtree,!1),this.classifyPoints_(holeList.list,holeList.rtree,!0),holeList.maxCoords=this.getMaxCoords_(holeList.list)}for(holeLists.sort(function(a,b){return b.maxCoords[0]===a.maxCoords[0]?a.maxCoords[1]-b.maxCoords[1]:b.maxCoords[0]-a.maxCoords[0]}),i=0;i<holeLists.length;++i){var intersection,currList=holeLists[i].list,start=currList.firstItem(),currItem=start;do{if(this.getIntersections_(currItem,rtree).length){intersection=!0;break}currItem=currList.nextItem()}while(start!==currItem);intersection||this.bridgeHole_(currList,holeLists[i].maxCoords[0],outerRing,maxCoords[0],rtree)&&(rtree.concat(holeLists[i].rtree),this.classifyPoints_(outerRing,rtree,!1))}}else this.classifyPoints_(outerRing,rtree,!1);this.triangulate_(outerRing,rtree)},_ol_render_webgl_PolygonReplay_.prototype.processFlatCoordinates_=function(flatCoordinates,stride,list,rtree,clockwise){var i,ii,start,p0,p1,isClockwise=_orient2.default.linearRingIsClockwise(flatCoordinates,0,flatCoordinates.length,stride),n=this.vertices.length/2,extents=[],segments=[];if(clockwise===isClockwise){for(p0=start=this.createPoint_(flatCoordinates[0],flatCoordinates[1],n++),i=stride,ii=flatCoordinates.length;i<ii;i+=stride)p1=this.createPoint_(flatCoordinates[i],flatCoordinates[i+1],n++),segments.push(this.insertItem_(p0,p1,list)),extents.push([Math.min(p0.x,p1.x),Math.min(p0.y,p1.y),Math.max(p0.x,p1.x),Math.max(p0.y,p1.y)]),p0=p1;segments.push(this.insertItem_(p1,start,list)),extents.push([Math.min(p0.x,p1.x),Math.min(p0.y,p1.y),Math.max(p0.x,p1.x),Math.max(p0.y,p1.y)])}else{var end=flatCoordinates.length-stride;for(p0=start=this.createPoint_(flatCoordinates[end],flatCoordinates[end+1],n++),i=end-stride,ii=0;ii<=i;i-=stride)p1=this.createPoint_(flatCoordinates[i],flatCoordinates[i+1],n++),segments.push(this.insertItem_(p0,p1,list)),extents.push([Math.min(p0.x,p1.x),Math.min(p0.y,p1.y),Math.max(p0.x,p1.x),Math.max(p0.y,p1.y)]),p0=p1;segments.push(this.insertItem_(p1,start,list)),extents.push([Math.min(p0.x,p1.x),Math.min(p0.y,p1.y),Math.max(p0.x,p1.x),Math.max(p0.y,p1.y)])}rtree.load(extents,segments)},_ol_render_webgl_PolygonReplay_.prototype.getMaxCoords_=function(list){for(var start=list.firstItem(),seg=start,maxCoords=[seg.p0.x,seg.p0.y];(seg=list.nextItem()).p0.x>maxCoords[0]&&(maxCoords=[seg.p0.x,seg.p0.y]),seg!==start;);return maxCoords},_ol_render_webgl_PolygonReplay_.prototype.classifyPoints_=function(list,rtree,ccw){var start=list.firstItem(),s0=start,s1=list.nextItem(),pointsReclassified=!1;do{var reflex=ccw?_webgl2.default.triangleIsCounterClockwise(s1.p1.x,s1.p1.y,s0.p1.x,s0.p1.y,s0.p0.x,s0.p0.y):_webgl2.default.triangleIsCounterClockwise(s0.p0.x,s0.p0.y,s0.p1.x,s0.p1.y,s1.p1.x,s1.p1.y);void 0===reflex?(this.removeItem_(s0,s1,list,rtree),pointsReclassified=!0,s1===start&&(start=list.getNextItem()),s1=s0,list.prevItem()):s0.p1.reflex!==reflex&&(s0.p1.reflex=reflex,pointsReclassified=!0),s0=s1,s1=list.nextItem()}while(s0!==start);return pointsReclassified},_ol_render_webgl_PolygonReplay_.prototype.bridgeHole_=function(hole,holeMaxX,list,listMaxX,rtree){for(var seg=hole.firstItem();seg.p1.x!==holeMaxX;)seg=hole.nextItem();var i,ii,bestPoint,p5,p1=seg.p1,p2={x:listMaxX,y:p1.y,i:-1},minDist=1/0,intersectingSegments=this.getIntersections_({p0:p1,p1:p2},rtree,!0);for(i=0,ii=intersectingSegments.length;i<ii;++i){var currSeg=intersectingSegments[i],intersection=this.calculateIntersection_(p1,p2,currSeg.p0,currSeg.p1,!0),dist=Math.abs(p1.x-intersection[0]);dist<minDist&&void 0!==_webgl2.default.triangleIsCounterClockwise(p1.x,p1.y,currSeg.p0.x,currSeg.p0.y,currSeg.p1.x,currSeg.p1.y)&&(minDist=dist,p5={x:intersection[0],y:intersection[1],i:-1},seg=currSeg)}if(minDist===1/0)return!1;if(bestPoint=seg.p1,0<minDist){var pointsInTriangle=this.getPointsInTriangle_(p1,p5,seg.p1,rtree);if(pointsInTriangle.length){var theta=1/0;for(i=0,ii=pointsInTriangle.length;i<ii;++i){var currPoint=pointsInTriangle[i],currTheta=Math.atan2(p1.y-currPoint.y,p2.x-currPoint.x);(currTheta<theta||currTheta===theta&&currPoint.x<bestPoint.x)&&(theta=currTheta,bestPoint=currPoint)}}}for(seg=list.firstItem();seg.p1.x!==bestPoint.x||seg.p1.y!==bestPoint.y;)seg=list.nextItem();var p0Bridge={x:p1.x,y:p1.y,i:p1.i,reflex:void 0},p1Bridge={x:seg.p1.x,y:seg.p1.y,i:seg.p1.i,reflex:void 0};return hole.getNextItem().p0=p0Bridge,this.insertItem_(p1,seg.p1,hole,rtree),this.insertItem_(p1Bridge,p0Bridge,hole,rtree),seg.p1=p1Bridge,hole.setFirstItem(),list.concat(hole),!0},_ol_render_webgl_PolygonReplay_.prototype.triangulate_=function(list,rtree){for(var ccw=!1,simple=this.isSimple_(list,rtree);3<list.getLength();)if(simple){if(!this.clipEars_(list,rtree,simple,ccw)&&!this.classifyPoints_(list,rtree,ccw)&&!this.resolveSelfIntersections_(list,rtree,!0))break}else if(!this.clipEars_(list,rtree,simple,ccw)&&!this.classifyPoints_(list,rtree,ccw)&&!this.resolveSelfIntersections_(list,rtree)){if(!(simple=this.isSimple_(list,rtree))){this.splitPolygon_(list,rtree);break}ccw=!this.isClockwise_(list),this.classifyPoints_(list,rtree,ccw)}if(3===list.getLength()){var numIndices=this.indices.length;this.indices[numIndices++]=list.getPrevItem().p0.i,this.indices[numIndices++]=list.getCurrItem().p0.i,this.indices[numIndices++]=list.getNextItem().p0.i}},_ol_render_webgl_PolygonReplay_.prototype.clipEars_=function(list,rtree,simple,ccw){var p0,p1,p2,numIndices=this.indices.length,start=list.firstItem(),s0=list.getPrevItem(),s1=start,s2=list.nextItem(),s3=list.getNextItem(),processedEars=!1;do{var variableCriterion;if(p0=s1.p0,p1=s1.p1,p2=s2.p1,!1===p1.reflex)variableCriterion=simple?0===this.getPointsInTriangle_(p0,p1,p2,rtree,!0).length:ccw?this.diagonalIsInside_(s3.p1,p2,p1,p0,s0.p0):this.diagonalIsInside_(s0.p0,p0,p1,p2,s3.p1),(simple||0===this.getIntersections_({p0:p0,p1:p2},rtree).length)&&variableCriterion&&(simple||!1===p0.reflex||!1===p2.reflex||_orient2.default.linearRingIsClockwise([s0.p0.x,s0.p0.y,p0.x,p0.y,p1.x,p1.y,p2.x,p2.y,s3.p1.x,s3.p1.y],0,10,2)===!ccw)&&(this.indices[numIndices++]=p0.i,this.indices[numIndices++]=p1.i,this.indices[numIndices++]=p2.i,this.removeItem_(s1,s2,list,rtree),s2===start&&(start=s3),processedEars=!0);s0=list.getPrevItem(),s1=list.getCurrItem(),s2=list.nextItem(),s3=list.getNextItem()}while(s1!==start&&3<list.getLength());return processedEars},_ol_render_webgl_PolygonReplay_.prototype.resolveSelfIntersections_=function(list,rtree,opt_touch){var start=list.firstItem();list.nextItem();var s0=start,s1=list.nextItem(),resolvedIntersections=!1;do{var intersection=this.calculateIntersection_(s0.p0,s0.p1,s1.p0,s1.p1,opt_touch);if(intersection){var p,breakCond=!1,numVertices=this.vertices.length,numIndices=this.indices.length,n=numVertices/2,seg=list.prevItem();if(list.removeItem(),rtree.remove(seg),breakCond=seg===start,opt_touch?(breakCond=intersection[0]===s0.p0.x&&intersection[1]===s0.p0.y?(list.prevItem(),p=s0.p0,s1.p0=p,rtree.remove(s0),breakCond||s0===start):(p=s1.p1,s0.p1=p,rtree.remove(s1),breakCond||s1===start),list.removeItem()):(p=this.createPoint_(intersection[0],intersection[1],n),s0.p1=p,s1.p0=p,rtree.update([Math.min(s0.p0.x,s0.p1.x),Math.min(s0.p0.y,s0.p1.y),Math.max(s0.p0.x,s0.p1.x),Math.max(s0.p0.y,s0.p1.y)],s0),rtree.update([Math.min(s1.p0.x,s1.p1.x),Math.min(s1.p0.y,s1.p1.y),Math.max(s1.p0.x,s1.p1.x),Math.max(s1.p0.y,s1.p1.y)],s1)),this.indices[numIndices++]=seg.p0.i,this.indices[numIndices++]=seg.p1.i,this.indices[numIndices++]=p.i,resolvedIntersections=!0,breakCond)break}s0=list.getPrevItem(),s1=list.nextItem()}while(s0!==start);return resolvedIntersections},_ol_render_webgl_PolygonReplay_.prototype.isSimple_=function(list,rtree){var start=list.firstItem(),seg=start;do{if(this.getIntersections_(seg,rtree).length)return!1;seg=list.nextItem()}while(seg!==start);return!0},_ol_render_webgl_PolygonReplay_.prototype.isClockwise_=function(list){for(var length=2*list.getLength(),flatCoordinates=new Array(length),start=list.firstItem(),seg=start,i=0;flatCoordinates[i++]=seg.p0.x,flatCoordinates[i++]=seg.p0.y,(seg=list.nextItem())!==start;);return _orient2.default.linearRingIsClockwise(flatCoordinates,0,length,2)},_ol_render_webgl_PolygonReplay_.prototype.splitPolygon_=function(list,rtree){var start=list.firstItem(),s0=start;do{var intersections=this.getIntersections_(s0,rtree);if(intersections.length){var s1=intersections[0],n=this.vertices.length/2,intersection=this.calculateIntersection_(s0.p0,s0.p1,s1.p0,s1.p1),p=this.createPoint_(intersection[0],intersection[1],n),newPolygon=new _linkedlist2.default,newRtree=new _rbush2.default;this.insertItem_(p,s0.p1,newPolygon,newRtree),s0.p1=p,rtree.update([Math.min(s0.p0.x,p.x),Math.min(s0.p0.y,p.y),Math.max(s0.p0.x,p.x),Math.max(s0.p0.y,p.y)],s0);for(var currItem=list.nextItem();currItem!==s1;)this.insertItem_(currItem.p0,currItem.p1,newPolygon,newRtree),rtree.remove(currItem),list.removeItem(),currItem=list.getCurrItem();this.insertItem_(s1.p0,p,newPolygon,newRtree),s1.p0=p,rtree.update([Math.min(s1.p1.x,p.x),Math.min(s1.p1.y,p.y),Math.max(s1.p1.x,p.x),Math.max(s1.p1.y,p.y)],s1),this.classifyPoints_(list,rtree,!1),this.triangulate_(list,rtree),this.classifyPoints_(newPolygon,newRtree,!1),this.triangulate_(newPolygon,newRtree);break}s0=list.nextItem()}while(s0!==start)},_ol_render_webgl_PolygonReplay_.prototype.createPoint_=function(x,y,i){var numVertices=this.vertices.length;return{x:this.vertices[numVertices++]=x,y:this.vertices[numVertices++]=y,i:i,reflex:void 0}},_ol_render_webgl_PolygonReplay_.prototype.insertItem_=function(p0,p1,list,opt_rtree){var seg={p0:p0,p1:p1};return list.insertItem(seg),opt_rtree&&opt_rtree.insert([Math.min(p0.x,p1.x),Math.min(p0.y,p1.y),Math.max(p0.x,p1.x),Math.max(p0.y,p1.y)],seg),seg},_ol_render_webgl_PolygonReplay_.prototype.removeItem_=function(s0,s1,list,rtree){list.getCurrItem()===s1&&(list.removeItem(),s0.p1=s1.p1,rtree.remove(s1),rtree.update([Math.min(s0.p0.x,s0.p1.x),Math.min(s0.p0.y,s0.p1.y),Math.max(s0.p0.x,s0.p1.x),Math.max(s0.p0.y,s0.p1.y)],s0))},_ol_render_webgl_PolygonReplay_.prototype.getPointsInTriangle_=function(p0,p1,p2,rtree,opt_reflex){var i,ii,j,p,result=[],segmentsInExtent=rtree.getInExtent([Math.min(p0.x,p1.x,p2.x),Math.min(p0.y,p1.y,p2.y),Math.max(p0.x,p1.x,p2.x),Math.max(p0.y,p1.y,p2.y)]);for(i=0,ii=segmentsInExtent.length;i<ii;++i)for(j in segmentsInExtent[i])"object"!=typeof(p=segmentsInExtent[i][j])||opt_reflex&&!p.reflex||p.x===p0.x&&p.y===p0.y||p.x===p1.x&&p.y===p1.y||p.x===p2.x&&p.y===p2.y||-1!==result.indexOf(p)||!_contains2.default.linearRingContainsXY([p0.x,p0.y,p1.x,p1.y,p2.x,p2.y],0,6,2,p.x,p.y)||result.push(p);return result},_ol_render_webgl_PolygonReplay_.prototype.getIntersections_=function(segment,rtree,opt_touch){var i,ii,p0=segment.p0,p1=segment.p1,segmentsInExtent=rtree.getInExtent([Math.min(p0.x,p1.x),Math.min(p0.y,p1.y),Math.max(p0.x,p1.x),Math.max(p0.y,p1.y)]),result=[];for(i=0,ii=segmentsInExtent.length;i<ii;++i){var currSeg=segmentsInExtent[i];segment!==currSeg&&(opt_touch||currSeg.p0!==p1||currSeg.p1!==p0)&&this.calculateIntersection_(p0,p1,currSeg.p0,currSeg.p1,opt_touch)&&result.push(currSeg)}return result},_ol_render_webgl_PolygonReplay_.prototype.calculateIntersection_=function(p0,p1,p2,p3,opt_touch){var denom=(p3.y-p2.y)*(p1.x-p0.x)-(p3.x-p2.x)*(p1.y-p0.y);if(0!==denom){var ua=((p3.x-p2.x)*(p0.y-p2.y)-(p3.y-p2.y)*(p0.x-p2.x))/denom,ub=((p1.x-p0.x)*(p0.y-p2.y)-(p1.y-p0.y)*(p0.x-p2.x))/denom;if(!opt_touch&&ua>_webgl2.default.EPSILON&&ua<1-_webgl2.default.EPSILON&&ub>_webgl2.default.EPSILON&&ub<1-_webgl2.default.EPSILON||opt_touch&&0<=ua&&ua<=1&&0<=ub&&ub<=1)return[p0.x+ua*(p1.x-p0.x),p0.y+ua*(p1.y-p0.y)]}},_ol_render_webgl_PolygonReplay_.prototype.diagonalIsInside_=function(p0,p1,p2,p3,p4){if(void 0===p1.reflex||void 0===p3.reflex)return!1;var p1IsLeftOf=(p2.x-p3.x)*(p1.y-p3.y)>(p2.y-p3.y)*(p1.x-p3.x),p1IsRightOf=(p4.x-p3.x)*(p1.y-p3.y)<(p4.y-p3.y)*(p1.x-p3.x),p3IsLeftOf=(p0.x-p1.x)*(p3.y-p1.y)>(p0.y-p1.y)*(p3.x-p1.x),p3IsRightOf=(p2.x-p1.x)*(p3.y-p1.y)<(p2.y-p1.y)*(p3.x-p1.x),p1InCone=p3.reflex?p1IsRightOf||p1IsLeftOf:p1IsRightOf&&p1IsLeftOf,p3InCone=p1.reflex?p3IsRightOf||p3IsLeftOf:p3IsRightOf&&p3IsLeftOf;return p1InCone&&p3InCone},_ol_render_webgl_PolygonReplay_.prototype.drawMultiPolygon=function(multiPolygonGeometry,feature){var i,ii,j,jj,endss=multiPolygonGeometry.getEndss(),stride=multiPolygonGeometry.getStride(),currIndex=this.indices.length,currLineIndex=this.lineStringReplay.getCurrentIndex(),flatCoordinates=multiPolygonGeometry.getFlatCoordinates(),start=0;for(i=0,ii=endss.length;i<ii;++i){var ends=endss[i];if(0<ends.length){var outerRing=_transform2.default.translate(flatCoordinates,start,ends[0],stride,-this.origin[0],-this.origin[1]);if(outerRing.length){var holeFlatCoords,holes=[];for(j=1,jj=ends.length;j<jj;++j)ends[j]!==ends[j-1]&&(holeFlatCoords=_transform2.default.translate(flatCoordinates,ends[j-1],ends[j],stride,-this.origin[0],-this.origin[1]),holes.push(holeFlatCoords));this.lineStringReplay.drawPolygonCoordinates(outerRing,holes,stride),this.drawCoordinates_(outerRing,holes,stride)}}start=ends[ends.length-1]}this.indices.length>currIndex&&(this.startIndices.push(currIndex),this.startIndicesFeature.push(feature),this.state_.changed&&(this.styleIndices_.push(currIndex),this.state_.changed=!1)),this.lineStringReplay.getCurrentIndex()>currLineIndex&&this.lineStringReplay.setPolygonStyle(feature,currLineIndex)},_ol_render_webgl_PolygonReplay_.prototype.drawPolygon=function(polygonGeometry,feature){var ends=polygonGeometry.getEnds(),stride=polygonGeometry.getStride();if(0<ends.length){var flatCoordinates=polygonGeometry.getFlatCoordinates().map(Number),outerRing=_transform2.default.translate(flatCoordinates,0,ends[0],stride,-this.origin[0],-this.origin[1]);if(outerRing.length){var i,ii,holeFlatCoords,holes=[];for(i=1,ii=ends.length;i<ii;++i)ends[i]!==ends[i-1]&&(holeFlatCoords=_transform2.default.translate(flatCoordinates,ends[i-1],ends[i],stride,-this.origin[0],-this.origin[1]),holes.push(holeFlatCoords));this.startIndices.push(this.indices.length),this.startIndicesFeature.push(feature),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.lineStringReplay.setPolygonStyle(feature),this.lineStringReplay.drawPolygonCoordinates(outerRing,holes,stride),this.drawCoordinates_(outerRing,holes,stride)}}},_ol_render_webgl_PolygonReplay_.prototype.finish=function(context){this.verticesBuffer=new _buffer2.default(this.vertices),this.indicesBuffer=new _buffer2.default(this.indices),this.startIndices.push(this.indices.length),this.lineStringReplay.finish(context),0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]),this.vertices=null,this.indices=null},_ol_render_webgl_PolygonReplay_.prototype.getDeleteResourcesFunction=function(context){var verticesBuffer=this.verticesBuffer,indicesBuffer=this.indicesBuffer,lineDeleter=this.lineStringReplay.getDeleteResourcesFunction(context);return function(){context.deleteBuffer(verticesBuffer),context.deleteBuffer(indicesBuffer),lineDeleter()}},_ol_render_webgl_PolygonReplay_.prototype.setUpProgram=function(gl,context,size,pixelRatio){var fragmentShader,vertexShader;fragmentShader=_defaultshader2.default.fragment,vertexShader=_defaultshader2.default.vertex;var locations,program=context.getProgram(fragmentShader,vertexShader);return this.defaultLocations_?locations=this.defaultLocations_:(locations=new _locations2.default(gl,program),this.defaultLocations_=locations),context.useProgram(program),gl.enableVertexAttribArray(locations.a_position),gl.vertexAttribPointer(locations.a_position,2,_webgl4.default.FLOAT,!1,8,0),locations},_ol_render_webgl_PolygonReplay_.prototype.shutDownProgram=function(gl,locations){gl.disableVertexAttribArray(locations.a_position)},_ol_render_webgl_PolygonReplay_.prototype.drawReplay=function(gl,context,skippedFeaturesHash,hitDetection){var i,start,end,nextStyle,tmpDepthFunc=gl.getParameter(gl.DEPTH_FUNC),tmpDepthMask=gl.getParameter(gl.DEPTH_WRITEMASK);if(hitDetection||(gl.enable(gl.DEPTH_TEST),gl.depthMask(!0),gl.depthFunc(gl.NOTEQUAL)),_obj2.default.isEmpty(skippedFeaturesHash))for(end=this.startIndices[this.startIndices.length-1],i=this.styleIndices_.length-1;0<=i;--i)start=this.styleIndices_[i],nextStyle=this.styles_[i],this.setFillStyle_(gl,nextStyle),this.drawElements(gl,context,start,end),end=start;else this.drawReplaySkipping_(gl,context,skippedFeaturesHash);hitDetection||(gl.disable(gl.DEPTH_TEST),gl.clear(gl.DEPTH_BUFFER_BIT),gl.depthMask(tmpDepthMask),gl.depthFunc(tmpDepthFunc))},_ol_render_webgl_PolygonReplay_.prototype.drawHitDetectionReplayOneByOne=function(gl,context,skippedFeaturesHash,featureCallback,opt_hitExtent){var i,start,end,nextStyle,groupStart,feature,featureIndex;for(featureIndex=this.startIndices.length-2,end=this.startIndices[featureIndex+1],i=this.styleIndices_.length-1;0<=i;--i)for(nextStyle=this.styles_[i],this.setFillStyle_(gl,nextStyle),groupStart=this.styleIndices_[i];0<=featureIndex&&this.startIndices[featureIndex]>=groupStart;){if(start=this.startIndices[featureIndex],feature=this.startIndicesFeature[featureIndex],void 0===skippedFeaturesHash[_index2.default.getUid(feature).toString()]&&feature.getGeometry()&&(void 0===opt_hitExtent||_extent2.default.intersects(opt_hitExtent,feature.getGeometry().getExtent()))){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),this.drawElements(gl,context,start,end);var result=featureCallback(feature);if(result)return result}featureIndex--,end=start}},_ol_render_webgl_PolygonReplay_.prototype.drawReplaySkipping_=function(gl,context,skippedFeaturesHash){var i,start,end,nextStyle,groupStart,feature,featureIndex,featureStart;for(featureIndex=this.startIndices.length-2,end=start=this.startIndices[featureIndex+1],i=this.styleIndices_.length-1;0<=i;--i){for(nextStyle=this.styles_[i],this.setFillStyle_(gl,nextStyle),groupStart=this.styleIndices_[i];0<=featureIndex&&this.startIndices[featureIndex]>=groupStart;)featureStart=this.startIndices[featureIndex],feature=this.startIndicesFeature[featureIndex],skippedFeaturesHash[_index2.default.getUid(feature).toString()]&&(start!==end&&(this.drawElements(gl,context,start,end),gl.clear(gl.DEPTH_BUFFER_BIT)),end=featureStart),featureIndex--,start=featureStart;start!==end&&(this.drawElements(gl,context,start,end),gl.clear(gl.DEPTH_BUFFER_BIT)),start=end=groupStart}},_ol_render_webgl_PolygonReplay_.prototype.setFillStyle_=function(gl,color){gl.uniform4fv(this.defaultLocations_.u_color,color)},_ol_render_webgl_PolygonReplay_.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){var fillStyleColor=fillStyle?fillStyle.getColor():[0,0,0,0];if(fillStyleColor=fillStyleColor instanceof CanvasGradient||fillStyleColor instanceof CanvasPattern?_webgl2.default.defaultFillStyle:_color2.default.asArray(fillStyleColor).map(function(c,i){return 3!=i?c/255:c})||_webgl2.default.defaultFillStyle,this.state_.fillColor&&_array2.default.equals(fillStyleColor,this.state_.fillColor)||(this.state_.fillColor=fillStyleColor,this.state_.changed=!0,this.styles_.push(fillStyleColor)),strokeStyle)this.lineStringReplay.setFillStrokeStyle(null,strokeStyle);else{var nullStrokeStyle=new _stroke2.default({color:[0,0,0,0],lineWidth:0});this.lineStringReplay.setFillStrokeStyle(null,nullStrokeStyle)}},exports.default=_ol_render_webgl_PolygonReplay_},{"../../array.js":29,"../../color.js":36,"../../extent.js":54,"../../geom/flat/contains.js":63,"../../geom/flat/orient.js":69,"../../geom/flat/transform.js":76,"../../index.js":89,"../../obj.js":124,"../../structs/linkedlist.js":217,"../../structs/rbush.js":220,"../../style/stroke.js":233,"../../webgl.js":248,"../../webgl/buffer.js":249,"../webgl.js":165,"../webgl/linestringreplay.js":171,"../webgl/polygonreplay/defaultshader.js":175,"../webgl/polygonreplay/defaultshader/locations.js":176,"../webgl/replay.js":177}],175:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../../index.js")),_fragment2=_interopRequireDefault(require("../../../webgl/fragment.js")),_vertex2=_interopRequireDefault(require("../../../webgl/vertex.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_polygonreplay_defaultshader_={};_ol_render_webgl_polygonreplay_defaultshader_.fragment=new _fragment2.default(_index2.default.DEBUG_WEBGL?"precision mediump float;\n\n\n\nuniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main(void) {\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n":"precision mediump float;uniform vec4 e;uniform float f;void main(void){gl_FragColor=e;float alpha=e.a*f;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}"),_ol_render_webgl_polygonreplay_defaultshader_.vertex=new _vertex2.default(_index2.default.DEBUG_WEBGL?"\n\nattribute vec2 a_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n}\n\n\n":"attribute vec2 a;uniform mat4 b;uniform mat4 c;uniform mat4 d;void main(void){gl_Position=b*vec4(a,0.0,1.0);}"),exports.default=_ol_render_webgl_polygonreplay_defaultshader_},{"../../../index.js":89,"../../../webgl/fragment.js":252,"../../../webgl/vertex.js":254}],176:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_index=require("../../../../index.js"),_index2=(obj=_index)&&obj.__esModule?obj:{default:obj};exports.default=function(gl,program){this.u_projectionMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_projectionMatrix":"b"),this.u_offsetScaleMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_offsetScaleMatrix":"c"),this.u_offsetRotateMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_offsetRotateMatrix":"d"),this.u_color=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_color":"e"),this.u_opacity=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_opacity":"f"),this.a_position=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_position":"a")}},{"../../../../index.js":89}],177:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_vectorcontext2=_interopRequireDefault(require("../vectorcontext.js")),_transform2=_interopRequireDefault(require("../../transform.js")),_mat2=_interopRequireDefault(require("../../vec/mat4.js")),_webgl2=_interopRequireDefault(require("../../webgl.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_Replay_=function(tolerance,maxExtent){_vectorcontext2.default.call(this),this.tolerance=tolerance,this.maxExtent=maxExtent,this.origin=_extent2.default.getCenter(maxExtent),this.projectionMatrix_=_transform2.default.create(),this.offsetRotateMatrix_=_transform2.default.create(),this.offsetScaleMatrix_=_transform2.default.create(),this.tmpMat4_=_mat2.default.create(),this.indices=[],this.indicesBuffer=null,this.startIndices=[],this.startIndicesFeature=[],this.vertices=[],this.verticesBuffer=null,this.lineStringReplay=void 0};_index2.default.inherits(_ol_render_webgl_Replay_,_vectorcontext2.default),_ol_render_webgl_Replay_.prototype.getDeleteResourcesFunction=function(context){},_ol_render_webgl_Replay_.prototype.finish=function(context){},_ol_render_webgl_Replay_.prototype.setUpProgram=function(gl,context,size,pixelRatio){},_ol_render_webgl_Replay_.prototype.shutDownProgram=function(gl,locations){},_ol_render_webgl_Replay_.prototype.drawReplay=function(gl,context,skippedFeaturesHash,hitDetection){},_ol_render_webgl_Replay_.prototype.drawHitDetectionReplayOneByOne=function(gl,context,skippedFeaturesHash,featureCallback,opt_hitExtent){},_ol_render_webgl_Replay_.prototype.drawHitDetectionReplay=function(gl,context,skippedFeaturesHash,featureCallback,oneByOne,opt_hitExtent){return oneByOne?this.drawHitDetectionReplayOneByOne(gl,context,skippedFeaturesHash,featureCallback,opt_hitExtent):this.drawHitDetectionReplayAll(gl,context,skippedFeaturesHash,featureCallback)},_ol_render_webgl_Replay_.prototype.drawHitDetectionReplayAll=function(gl,context,skippedFeaturesHash,featureCallback){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),this.drawReplay(gl,context,skippedFeaturesHash,!0);var result=featureCallback(null);return result||void 0},_ol_render_webgl_Replay_.prototype.replay=function(context,center,resolution,rotation,size,pixelRatio,opacity,skippedFeaturesHash,featureCallback,oneByOne,opt_hitExtent){var tmpStencil,tmpStencilFunc,tmpStencilMaskVal,tmpStencilRef,tmpStencilMask,tmpStencilOpFail,tmpStencilOpPass,tmpStencilOpZFail,gl=context.getGL();this.lineStringReplay&&(tmpStencil=gl.isEnabled(gl.STENCIL_TEST),tmpStencilFunc=gl.getParameter(gl.STENCIL_FUNC),tmpStencilMaskVal=gl.getParameter(gl.STENCIL_VALUE_MASK),tmpStencilRef=gl.getParameter(gl.STENCIL_REF),tmpStencilMask=gl.getParameter(gl.STENCIL_WRITEMASK),tmpStencilOpFail=gl.getParameter(gl.STENCIL_FAIL),tmpStencilOpPass=gl.getParameter(gl.STENCIL_PASS_DEPTH_PASS),tmpStencilOpZFail=gl.getParameter(gl.STENCIL_PASS_DEPTH_FAIL),gl.enable(gl.STENCIL_TEST),gl.clear(gl.STENCIL_BUFFER_BIT),gl.stencilMask(255),gl.stencilFunc(gl.ALWAYS,1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.REPLACE),this.lineStringReplay.replay(context,center,resolution,rotation,size,pixelRatio,opacity,skippedFeaturesHash,featureCallback,oneByOne,opt_hitExtent),gl.stencilMask(0),gl.stencilFunc(gl.NOTEQUAL,1,255)),context.bindBuffer(_webgl2.default.ARRAY_BUFFER,this.verticesBuffer),context.bindBuffer(_webgl2.default.ELEMENT_ARRAY_BUFFER,this.indicesBuffer);var locations=this.setUpProgram(gl,context,size,pixelRatio),projectionMatrix=_transform2.default.reset(this.projectionMatrix_);_transform2.default.scale(projectionMatrix,2/(resolution*size[0]),2/(resolution*size[1])),_transform2.default.rotate(projectionMatrix,-rotation),_transform2.default.translate(projectionMatrix,-(center[0]-this.origin[0]),-(center[1]-this.origin[1]));var offsetScaleMatrix=_transform2.default.reset(this.offsetScaleMatrix_);_transform2.default.scale(offsetScaleMatrix,2/size[0],2/size[1]);var result,offsetRotateMatrix=_transform2.default.reset(this.offsetRotateMatrix_);return 0!==rotation&&_transform2.default.rotate(offsetRotateMatrix,-rotation),gl.uniformMatrix4fv(locations.u_projectionMatrix,!1,_mat2.default.fromTransform(this.tmpMat4_,projectionMatrix)),gl.uniformMatrix4fv(locations.u_offsetScaleMatrix,!1,_mat2.default.fromTransform(this.tmpMat4_,offsetScaleMatrix)),gl.uniformMatrix4fv(locations.u_offsetRotateMatrix,!1,_mat2.default.fromTransform(this.tmpMat4_,offsetRotateMatrix)),gl.uniform1f(locations.u_opacity,opacity),void 0===featureCallback?this.drawReplay(gl,context,skippedFeaturesHash,!1):result=this.drawHitDetectionReplay(gl,context,skippedFeaturesHash,featureCallback,oneByOne,opt_hitExtent),this.shutDownProgram(gl,locations),this.lineStringReplay&&(tmpStencil||gl.disable(gl.STENCIL_TEST),gl.clear(gl.STENCIL_BUFFER_BIT),gl.stencilFunc(tmpStencilFunc,tmpStencilRef,tmpStencilMaskVal),gl.stencilMask(tmpStencilMask),gl.stencilOp(tmpStencilOpFail,tmpStencilOpZFail,tmpStencilOpPass)),result},_ol_render_webgl_Replay_.prototype.drawElements=function(gl,context,start,end){var elementType=context.hasOESElementIndexUint?_webgl2.default.UNSIGNED_INT:_webgl2.default.UNSIGNED_SHORT,numItems=end-start,offsetInBytes=start*(context.hasOESElementIndexUint?4:2);gl.drawElements(_webgl2.default.TRIANGLES,numItems,elementType,offsetInBytes)},exports.default=_ol_render_webgl_Replay_},{"../../extent.js":54,"../../index.js":89,"../../transform.js":243,"../../vec/mat4.js":244,"../../webgl.js":248,"../vectorcontext.js":164}],178:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_array2=_interopRequireDefault(require("../../array.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_obj2=_interopRequireDefault(require("../../obj.js")),_replay2=_interopRequireDefault(require("../replay.js")),_replaygroup2=_interopRequireDefault(require("../replaygroup.js")),_circlereplay2=_interopRequireDefault(require("../webgl/circlereplay.js")),_imagereplay2=_interopRequireDefault(require("../webgl/imagereplay.js")),_linestringreplay2=_interopRequireDefault(require("../webgl/linestringreplay.js")),_polygonreplay2=_interopRequireDefault(require("../webgl/polygonreplay.js")),_textreplay2=_interopRequireDefault(require("../webgl/textreplay.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_ReplayGroup_=function(tolerance,maxExtent,opt_renderBuffer){_replaygroup2.default.call(this),this.maxExtent_=maxExtent,this.tolerance_=tolerance,this.renderBuffer_=opt_renderBuffer,this.replaysByZIndex_={}};_index2.default.inherits(_ol_render_webgl_ReplayGroup_,_replaygroup2.default),_ol_render_webgl_ReplayGroup_.prototype.addDeclutter=function(style,group){},_ol_render_webgl_ReplayGroup_.prototype.getDeleteResourcesFunction=function(context){var zKey,functions=[];for(zKey in this.replaysByZIndex_){var replayKey,replays=this.replaysByZIndex_[zKey];for(replayKey in replays)functions.push(replays[replayKey].getDeleteResourcesFunction(context))}return function(){for(var result,length=functions.length,i=0;i<length;i++)result=functions[i].apply(this,arguments);return result}},_ol_render_webgl_ReplayGroup_.prototype.finish=function(context){var zKey;for(zKey in this.replaysByZIndex_){var replayKey,replays=this.replaysByZIndex_[zKey];for(replayKey in replays)replays[replayKey].finish(context)}},_ol_render_webgl_ReplayGroup_.prototype.getReplay=function(zIndex,replayType){var zIndexKey=void 0!==zIndex?zIndex.toString():"0",replays=this.replaysByZIndex_[zIndexKey];void 0===replays&&(replays={},this.replaysByZIndex_[zIndexKey]=replays);var replay=replays[replayType];void 0===replay&&(replay=new _ol_render_webgl_ReplayGroup_.BATCH_CONSTRUCTORS_[replayType](this.tolerance_,this.maxExtent_),replays[replayType]=replay);return replay},_ol_render_webgl_ReplayGroup_.prototype.isEmpty=function(){return _obj2.default.isEmpty(this.replaysByZIndex_)},_ol_render_webgl_ReplayGroup_.prototype.replay=function(context,center,resolution,rotation,size,pixelRatio,opacity,skippedFeaturesHash){var i,ii,j,jj,replays,replay,zs=Object.keys(this.replaysByZIndex_).map(Number);for(zs.sort(_array2.default.numberSafeCompareFunction),i=0,ii=zs.length;i<ii;++i)for(replays=this.replaysByZIndex_[zs[i].toString()],j=0,jj=_replay2.default.ORDER.length;j<jj;++j)void 0!==(replay=replays[_replay2.default.ORDER[j]])&&replay.replay(context,center,resolution,rotation,size,pixelRatio,opacity,skippedFeaturesHash,void 0,!1)},_ol_render_webgl_ReplayGroup_.prototype.replayHitDetection_=function(context,center,resolution,rotation,size,pixelRatio,opacity,skippedFeaturesHash,featureCallback,oneByOne,opt_hitExtent){var i,ii,j,replays,replay,result,zs=Object.keys(this.replaysByZIndex_).map(Number);for(zs.sort(function(a,b){return b-a}),i=0,ii=zs.length;i<ii;++i)for(replays=this.replaysByZIndex_[zs[i].toString()],j=_replay2.default.ORDER.length-1;0<=j;--j)if(void 0!==(replay=replays[_replay2.default.ORDER[j]])&&(result=replay.replay(context,center,resolution,rotation,size,pixelRatio,opacity,skippedFeaturesHash,featureCallback,oneByOne,opt_hitExtent)))return result},_ol_render_webgl_ReplayGroup_.prototype.forEachFeatureAtCoordinate=function(coordinate,context,center,resolution,rotation,size,pixelRatio,opacity,skippedFeaturesHash,callback){var hitExtent,gl=context.getGL();return gl.bindFramebuffer(gl.FRAMEBUFFER,context.getHitDetectionFramebuffer()),void 0!==this.renderBuffer_&&(hitExtent=_extent2.default.buffer(_extent2.default.createOrUpdateFromCoordinate(coordinate),resolution*this.renderBuffer_)),this.replayHitDetection_(context,coordinate,resolution,rotation,_ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_,pixelRatio,opacity,skippedFeaturesHash,function(feature){var imageData=new Uint8Array(4);if(gl.readPixels(0,0,1,1,gl.RGBA,gl.UNSIGNED_BYTE,imageData),0<imageData[3]){var result=callback(feature);if(result)return result}},!0,hitExtent)},_ol_render_webgl_ReplayGroup_.prototype.hasFeatureAtCoordinate=function(coordinate,context,center,resolution,rotation,size,pixelRatio,opacity,skippedFeaturesHash){var gl=context.getGL();return gl.bindFramebuffer(gl.FRAMEBUFFER,context.getHitDetectionFramebuffer()),void 0!==this.replayHitDetection_(context,coordinate,resolution,rotation,_ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_,pixelRatio,opacity,skippedFeaturesHash,function(feature){var imageData=new Uint8Array(4);return gl.readPixels(0,0,1,1,gl.RGBA,gl.UNSIGNED_BYTE,imageData),0<imageData[3]},!1)},_ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_=[1,1],_ol_render_webgl_ReplayGroup_.BATCH_CONSTRUCTORS_={Circle:_circlereplay2.default,Image:_imagereplay2.default,LineString:_linestringreplay2.default,Polygon:_polygonreplay2.default,Text:_textreplay2.default},exports.default=_ol_render_webgl_ReplayGroup_},{"../../array.js":29,"../../extent.js":54,"../../index.js":89,"../../obj.js":124,"../replay.js":161,"../replaygroup.js":162,"../webgl/circlereplay.js":166,"../webgl/imagereplay.js":169,"../webgl/linestringreplay.js":171,"../webgl/polygonreplay.js":174,"../webgl/textreplay.js":179}],179:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_colorlike2=_interopRequireDefault(require("../../colorlike.js")),_dom2=_interopRequireDefault(require("../../dom.js")),_geometrytype2=_interopRequireDefault(require("../../geom/geometrytype.js")),_has2=_interopRequireDefault(require("../../has.js")),_replay2=_interopRequireDefault(require("../replay.js")),_webgl2=_interopRequireDefault(require("../webgl.js")),_texturereplay2=_interopRequireDefault(require("../webgl/texturereplay.js")),_atlasmanager2=_interopRequireDefault(require("../../style/atlasmanager.js")),_buffer2=_interopRequireDefault(require("../../webgl/buffer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_TextReplay_=function(tolerance,maxExtent){_texturereplay2.default.call(this,tolerance,maxExtent),this.images_=[],this.textures_=[],this.measureCanvas_=_dom2.default.createCanvasContext2D(0,0).canvas,this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0},this.text_="",this.textAlign_=void 0,this.textBaseline_=void 0,this.offsetX_=void 0,this.offsetY_=void 0,this.atlases_={},this.currAtlas_=void 0,this.scale=1,this.opacity=1};_index2.default.inherits(_ol_render_webgl_TextReplay_,_texturereplay2.default),_ol_render_webgl_TextReplay_.prototype.drawText=function(geometry,feature){if(this.text_){var flatCoordinates=null,end=2,stride=2;switch(geometry.getType()){case _geometrytype2.default.POINT:case _geometrytype2.default.MULTI_POINT:end=(flatCoordinates=geometry.getFlatCoordinates()).length,stride=geometry.getStride();break;case _geometrytype2.default.CIRCLE:flatCoordinates=geometry.getCenter();break;case _geometrytype2.default.LINE_STRING:flatCoordinates=geometry.getFlatMidpoint();break;case _geometrytype2.default.MULTI_LINE_STRING:end=(flatCoordinates=geometry.getFlatMidpoints()).length;break;case _geometrytype2.default.POLYGON:flatCoordinates=geometry.getFlatInteriorPoint();break;case _geometrytype2.default.MULTI_POLYGON:end=(flatCoordinates=geometry.getFlatInteriorPoints()).length}this.startIndices.push(this.indices.length),this.startIndicesFeature.push(feature);var i,ii,j,jj,currX,currY,charArr,charInfo,glyphAtlas=this.currAtlas_,lines=this.text_.split("\n"),textSize=this.getTextSize_(lines),anchorX=Math.round(textSize[0]*this.textAlign_-this.offsetX_),anchorY=Math.round(textSize[1]*this.textBaseline_-this.offsetY_),lineWidth=this.state_.lineWidth/2*this.state_.scale;for(i=0,ii=lines.length;i<ii;++i)for(currX=0,currY=glyphAtlas.height*i,j=0,jj=(charArr=lines[i].split("")).length;j<jj;++j){if(charInfo=glyphAtlas.atlas.getInfo(charArr[j])){var currentImage,image=charInfo.image;this.anchorX=anchorX-currX,this.anchorY=anchorY-currY,this.originX=0===j?charInfo.offsetX-lineWidth:charInfo.offsetX,this.originY=charInfo.offsetY,this.height=glyphAtlas.height,this.width=0===j||j===charArr.length-1?glyphAtlas.width[charArr[j]]+lineWidth:glyphAtlas.width[charArr[j]],this.imageHeight=image.height,this.imageWidth=image.width,0===this.images_.length?this.images_.push(image):(currentImage=this.images_[this.images_.length-1],_index2.default.getUid(currentImage)!=_index2.default.getUid(image)&&(this.groupIndices.push(this.indices.length),this.images_.push(image))),this.drawText_(flatCoordinates,0,end,stride)}currX+=this.width}}},_ol_render_webgl_TextReplay_.prototype.getTextSize_=function(lines){var self=this,glyphAtlas=this.currAtlas_,textHeight=lines.length*glyphAtlas.height;return[lines.map(function(str){var i,ii,sum=0;for(i=0,ii=str.length;i<ii;++i){var curr=str[i];glyphAtlas.width[curr]||self.addCharToAtlas_(curr),sum+=glyphAtlas.width[curr]?glyphAtlas.width[curr]:0}return sum}).reduce(function(max,curr){return Math.max(max,curr)}),textHeight]},_ol_render_webgl_TextReplay_.prototype.drawText_=function(flatCoordinates,offset,end,stride){var i,ii;for(i=offset,ii=end;i<ii;i+=stride)this.drawCoordinates(flatCoordinates,offset,end,stride)},_ol_render_webgl_TextReplay_.prototype.addCharToAtlas_=function(char){if(1===char.length){var glyphAtlas=this.currAtlas_,state=this.state_,mCtx=this.measureCanvas_.getContext("2d");mCtx.font=state.font;var width=Math.ceil(mCtx.measureText(char).width*state.scale);glyphAtlas.atlas.add(char,width,glyphAtlas.height,function(ctx,x,y){ctx.font=state.font,ctx.fillStyle=state.fillColor,ctx.strokeStyle=state.strokeColor,ctx.lineWidth=state.lineWidth,ctx.lineCap=state.lineCap,ctx.lineJoin=state.lineJoin,ctx.miterLimit=state.miterLimit,ctx.textAlign="left",ctx.textBaseline="top",_has2.default.CANVAS_LINE_DASH&&state.lineDash&&(ctx.setLineDash(state.lineDash),ctx.lineDashOffset=state.lineDashOffset),1!==state.scale&&ctx.setTransform(state.scale,0,0,state.scale,0,0),state.strokeColor&&ctx.strokeText(char,x,y),state.fillColor&&ctx.fillText(char,x,y)})&&(glyphAtlas.width[char]=width)}},_ol_render_webgl_TextReplay_.prototype.finish=function(context){var gl=context.getGL();this.groupIndices.push(this.indices.length),this.hitDetectionGroupIndices=this.groupIndices,this.verticesBuffer=new _buffer2.default(this.vertices),this.indicesBuffer=new _buffer2.default(this.indices);this.createTextures(this.textures_,this.images_,{},gl),this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0},this.text_="",this.textAlign_=void 0,this.textBaseline_=void 0,this.offsetX_=void 0,this.offsetY_=void 0,this.images_=null,this.atlases_={},this.currAtlas_=void 0,_texturereplay2.default.prototype.finish.call(this,context)},_ol_render_webgl_TextReplay_.prototype.setTextStyle=function(textStyle){var state=this.state_,textFillStyle=textStyle.getFill(),textStrokeStyle=textStyle.getStroke();if(textStyle&&textStyle.getText()&&(textFillStyle||textStrokeStyle)){if(textFillStyle){var textFillStyleColor=textFillStyle.getColor();state.fillColor=_colorlike2.default.asColorLike(textFillStyleColor||_webgl2.default.defaultFillStyle)}else state.fillColor=null;if(textStrokeStyle){var textStrokeStyleColor=textStrokeStyle.getColor();state.strokeColor=_colorlike2.default.asColorLike(textStrokeStyleColor||_webgl2.default.defaultStrokeStyle),state.lineWidth=textStrokeStyle.getWidth()||_webgl2.default.defaultLineWidth,state.lineCap=textStrokeStyle.getLineCap()||_webgl2.default.defaultLineCap,state.lineDashOffset=textStrokeStyle.getLineDashOffset()||_webgl2.default.defaultLineDashOffset,state.lineJoin=textStrokeStyle.getLineJoin()||_webgl2.default.defaultLineJoin,state.miterLimit=textStrokeStyle.getMiterLimit()||_webgl2.default.defaultMiterLimit;var lineDash=textStrokeStyle.getLineDash();state.lineDash=lineDash?lineDash.slice():_webgl2.default.defaultLineDash}else state.strokeColor=null,state.lineWidth=0;state.font=textStyle.getFont()||_webgl2.default.defaultFont,state.scale=textStyle.getScale()||1,this.text_=textStyle.getText();var textAlign=_replay2.default.TEXT_ALIGN[textStyle.getTextAlign()],textBaseline=_replay2.default.TEXT_ALIGN[textStyle.getTextBaseline()];this.textAlign_=void 0===textAlign?_webgl2.default.defaultTextAlign:textAlign,this.textBaseline_=void 0===textBaseline?_webgl2.default.defaultTextBaseline:textBaseline,this.offsetX_=textStyle.getOffsetX()||0,this.offsetY_=textStyle.getOffsetY()||0,this.rotateWithView=!!textStyle.getRotateWithView(),this.rotation=textStyle.getRotation()||0,this.currAtlas_=this.getAtlas_(state)}else this.text_=""},_ol_render_webgl_TextReplay_.prototype.getAtlas_=function(state){var i,params=[];for(i in state)(state[i]||0===state[i])&&(Array.isArray(state[i])?params=params.concat(state[i]):params.push(state[i]));var hash=this.calculateHash_(params);if(!this.atlases_[hash]){var mCtx=this.measureCanvas_.getContext("2d");mCtx.font=state.font;var height=Math.ceil((1.5*mCtx.measureText("M").width+state.lineWidth/2)*state.scale);this.atlases_[hash]={atlas:new _atlasmanager2.default({space:state.lineWidth+1}),width:{},height:height}}return this.atlases_[hash]},_ol_render_webgl_TextReplay_.prototype.calculateHash_=function(params){var i,ii,hash="";for(i=0,ii=params.length;i<ii;++i)hash+=params[i];return hash},_ol_render_webgl_TextReplay_.prototype.getTextures=function(opt_all){return this.textures_},_ol_render_webgl_TextReplay_.prototype.getHitDetectionTextures=function(){return this.textures_},exports.default=_ol_render_webgl_TextReplay_},{"../../colorlike.js":37,"../../dom.js":46,"../../geom/geometrytype.js":79,"../../has.js":84,"../../index.js":89,"../../style/atlasmanager.js":223,"../../webgl/buffer.js":249,"../replay.js":161,"../webgl.js":165,"../webgl/texturereplay.js":180}],180:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_obj2=_interopRequireDefault(require("../../obj.js")),_defaultshader2=_interopRequireDefault(require("../webgl/texturereplay/defaultshader.js")),_locations2=_interopRequireDefault(require("../webgl/texturereplay/defaultshader/locations.js")),_replay2=_interopRequireDefault(require("../webgl/replay.js")),_webgl2=_interopRequireDefault(require("../../webgl.js")),_context2=_interopRequireDefault(require("../../webgl/context.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_TextureReplay_=function(tolerance,maxExtent){_replay2.default.call(this,tolerance,maxExtent),this.anchorX=void 0,this.anchorY=void 0,this.groupIndices=[],this.hitDetectionGroupIndices=[],this.height=void 0,this.imageHeight=void 0,this.imageWidth=void 0,this.defaultLocations=null,this.opacity=void 0,this.originX=void 0,this.originY=void 0,this.rotateWithView=void 0,this.rotation=void 0,this.scale=void 0,this.width=void 0};_index2.default.inherits(_ol_render_webgl_TextureReplay_,_replay2.default),_ol_render_webgl_TextureReplay_.prototype.getDeleteResourcesFunction=function(context){var verticesBuffer=this.verticesBuffer,indicesBuffer=this.indicesBuffer,textures=this.getTextures(!0),gl=context.getGL();return function(){var i,ii;if(!gl.isContextLost())for(i=0,ii=textures.length;i<ii;++i)gl.deleteTexture(textures[i]);context.deleteBuffer(verticesBuffer),context.deleteBuffer(indicesBuffer)}},_ol_render_webgl_TextureReplay_.prototype.drawCoordinates=function(flatCoordinates,offset,end,stride){var i,n,offsetX,offsetY,x,y,anchorX=this.anchorX,anchorY=this.anchorY,height=this.height,imageHeight=this.imageHeight,imageWidth=this.imageWidth,opacity=this.opacity,originX=this.originX,originY=this.originY,rotateWithView=this.rotateWithView?1:0,rotation=-this.rotation,scale=this.scale,width=this.width,cos=Math.cos(rotation),sin=Math.sin(rotation),numIndices=this.indices.length,numVertices=this.vertices.length;for(i=offset;i<end;i+=stride)x=flatCoordinates[i]-this.origin[0],y=flatCoordinates[i+1]-this.origin[1],n=numVertices/8,offsetX=-scale*anchorX,offsetY=-scale*(height-anchorY),this.vertices[numVertices++]=x,this.vertices[numVertices++]=y,this.vertices[numVertices++]=offsetX*cos-offsetY*sin,this.vertices[numVertices++]=offsetX*sin+offsetY*cos,this.vertices[numVertices++]=originX/imageWidth,this.vertices[numVertices++]=(originY+height)/imageHeight,this.vertices[numVertices++]=opacity,this.vertices[numVertices++]=rotateWithView,offsetX=scale*(width-anchorX),offsetY=-scale*(height-anchorY),this.vertices[numVertices++]=x,this.vertices[numVertices++]=y,this.vertices[numVertices++]=offsetX*cos-offsetY*sin,this.vertices[numVertices++]=offsetX*sin+offsetY*cos,this.vertices[numVertices++]=(originX+width)/imageWidth,this.vertices[numVertices++]=(originY+height)/imageHeight,this.vertices[numVertices++]=opacity,this.vertices[numVertices++]=rotateWithView,offsetX=scale*(width-anchorX),offsetY=scale*anchorY,this.vertices[numVertices++]=x,this.vertices[numVertices++]=y,this.vertices[numVertices++]=offsetX*cos-offsetY*sin,this.vertices[numVertices++]=offsetX*sin+offsetY*cos,this.vertices[numVertices++]=(originX+width)/imageWidth,this.vertices[numVertices++]=originY/imageHeight,this.vertices[numVertices++]=opacity,this.vertices[numVertices++]=rotateWithView,offsetX=-scale*anchorX,offsetY=scale*anchorY,this.vertices[numVertices++]=x,this.vertices[numVertices++]=y,this.vertices[numVertices++]=offsetX*cos-offsetY*sin,this.vertices[numVertices++]=offsetX*sin+offsetY*cos,this.vertices[numVertices++]=originX/imageWidth,this.vertices[numVertices++]=originY/imageHeight,this.vertices[numVertices++]=opacity,this.vertices[numVertices++]=rotateWithView,this.indices[numIndices++]=n,this.indices[numIndices++]=n+1,this.indices[numIndices++]=n+2,this.indices[numIndices++]=n,this.indices[numIndices++]=n+2,this.indices[numIndices++]=n+3;return numVertices},_ol_render_webgl_TextureReplay_.prototype.createTextures=function(textures,images,texturePerImage,gl){var texture,image,uid,i,ii=images.length;for(i=0;i<ii;++i)image=images[i],(uid=_index2.default.getUid(image).toString())in texturePerImage?texture=texturePerImage[uid]:(texture=_context2.default.createTexture(gl,image,_webgl2.default.CLAMP_TO_EDGE,_webgl2.default.CLAMP_TO_EDGE),texturePerImage[uid]=texture),textures[i]=texture},_ol_render_webgl_TextureReplay_.prototype.setUpProgram=function(gl,context,size,pixelRatio){var locations,fragmentShader=_defaultshader2.default.fragment,vertexShader=_defaultshader2.default.vertex,program=context.getProgram(fragmentShader,vertexShader);return this.defaultLocations?locations=this.defaultLocations:(locations=new _locations2.default(gl,program),this.defaultLocations=locations),context.useProgram(program),gl.enableVertexAttribArray(locations.a_position),gl.vertexAttribPointer(locations.a_position,2,_webgl2.default.FLOAT,!1,32,0),gl.enableVertexAttribArray(locations.a_offsets),gl.vertexAttribPointer(locations.a_offsets,2,_webgl2.default.FLOAT,!1,32,8),gl.enableVertexAttribArray(locations.a_texCoord),gl.vertexAttribPointer(locations.a_texCoord,2,_webgl2.default.FLOAT,!1,32,16),gl.enableVertexAttribArray(locations.a_opacity),gl.vertexAttribPointer(locations.a_opacity,1,_webgl2.default.FLOAT,!1,32,24),gl.enableVertexAttribArray(locations.a_rotateWithView),gl.vertexAttribPointer(locations.a_rotateWithView,1,_webgl2.default.FLOAT,!1,32,28),locations},_ol_render_webgl_TextureReplay_.prototype.shutDownProgram=function(gl,locations){gl.disableVertexAttribArray(locations.a_position),gl.disableVertexAttribArray(locations.a_offsets),gl.disableVertexAttribArray(locations.a_texCoord),gl.disableVertexAttribArray(locations.a_opacity),gl.disableVertexAttribArray(locations.a_rotateWithView)},_ol_render_webgl_TextureReplay_.prototype.drawReplay=function(gl,context,skippedFeaturesHash,hitDetection){var i,ii,start,textures=hitDetection?this.getHitDetectionTextures():this.getTextures(),groupIndices=hitDetection?this.hitDetectionGroupIndices:this.groupIndices;if(_obj2.default.isEmpty(skippedFeaturesHash))for(i=0,ii=textures.length,start=0;i<ii;++i){gl.bindTexture(_webgl2.default.TEXTURE_2D,textures[i]);var end=groupIndices[i];this.drawElements(gl,context,start,end),start=end}else this.drawReplaySkipping(gl,context,skippedFeaturesHash,textures,groupIndices)},_ol_render_webgl_TextureReplay_.prototype.drawReplaySkipping=function(gl,context,skippedFeaturesHash,textures,groupIndices){var i,ii,featureIndex=0;for(i=0,ii=textures.length;i<ii;++i){gl.bindTexture(_webgl2.default.TEXTURE_2D,textures[i]);for(var groupStart=0<i?groupIndices[i-1]:0,groupEnd=groupIndices[i],start=groupStart,end=groupStart;featureIndex<this.startIndices.length&&this.startIndices[featureIndex]<=groupEnd;){var feature=this.startIndicesFeature[featureIndex];end=void 0!==skippedFeaturesHash[_index2.default.getUid(feature).toString()]?(start!==end&&this.drawElements(gl,context,start,end),start=featureIndex===this.startIndices.length-1?groupEnd:this.startIndices[featureIndex+1]):featureIndex===this.startIndices.length-1?groupEnd:this.startIndices[featureIndex+1],featureIndex++}start!==end&&this.drawElements(gl,context,start,end)}},_ol_render_webgl_TextureReplay_.prototype.drawHitDetectionReplayOneByOne=function(gl,context,skippedFeaturesHash,featureCallback,opt_hitExtent){var i,groupStart,start,end,feature,featureIndex=this.startIndices.length-1,hitDetectionTextures=this.getHitDetectionTextures();for(i=hitDetectionTextures.length-1;0<=i;--i)for(gl.bindTexture(_webgl2.default.TEXTURE_2D,hitDetectionTextures[i]),groupStart=0<i?this.hitDetectionGroupIndices[i-1]:0,end=this.hitDetectionGroupIndices[i];0<=featureIndex&&this.startIndices[featureIndex]>=groupStart;){if(start=this.startIndices[featureIndex],feature=this.startIndicesFeature[featureIndex],void 0===skippedFeaturesHash[_index2.default.getUid(feature).toString()]&&feature.getGeometry()&&(void 0===opt_hitExtent||_extent2.default.intersects(opt_hitExtent,feature.getGeometry().getExtent()))){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),this.drawElements(gl,context,start,end);var result=featureCallback(feature);if(result)return result}end=start,featureIndex--}},_ol_render_webgl_TextureReplay_.prototype.finish=function(context){this.anchorX=void 0,this.anchorY=void 0,this.height=void 0,this.imageHeight=void 0,this.imageWidth=void 0,this.indices=null,this.opacity=void 0,this.originX=void 0,this.originY=void 0,this.rotateWithView=void 0,this.rotation=void 0,this.scale=void 0,this.vertices=null,this.width=void 0},_ol_render_webgl_TextureReplay_.prototype.getTextures=function(opt_all){},_ol_render_webgl_TextureReplay_.prototype.getHitDetectionTextures=function(){},exports.default=_ol_render_webgl_TextureReplay_},{"../../extent.js":54,"../../index.js":89,"../../obj.js":124,"../../webgl.js":248,"../../webgl/context.js":250,"../webgl/replay.js":177,"../webgl/texturereplay/defaultshader.js":181,"../webgl/texturereplay/defaultshader/locations.js":182}],181:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../../index.js")),_fragment2=_interopRequireDefault(require("../../../webgl/fragment.js")),_vertex2=_interopRequireDefault(require("../../../webgl/vertex.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_render_webgl_texturereplay_defaultshader_={};_ol_render_webgl_texturereplay_defaultshader_.fragment=new _fragment2.default(_index2.default.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_texCoord;\nvarying float v_opacity;\n\nuniform float u_opacity;\nuniform sampler2D u_image;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  float alpha = texColor.a * v_opacity * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n":"precision mediump float;varying vec2 a;varying float b;uniform float k;uniform sampler2D l;void main(void){vec4 texColor=texture2D(l,a);gl_FragColor.rgb=texColor.rgb;float alpha=texColor.a*b*k;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}"),_ol_render_webgl_texturereplay_defaultshader_.vertex=new _vertex2.default(_index2.default.DEBUG_WEBGL?"varying vec2 v_texCoord;\nvarying float v_opacity;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nattribute vec2 a_offsets;\nattribute float a_opacity;\nattribute float a_rotateWithView;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix;\n  if (a_rotateWithView == 1.0) {\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  }\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n  v_texCoord = a_texCoord;\n  v_opacity = a_opacity;\n}\n\n\n":"varying vec2 a;varying float b;attribute vec2 c;attribute vec2 d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;void main(void){mat4 offsetMatrix=i;if(g==1.0){offsetMatrix=i*j;}vec4 offsets=offsetMatrix*vec4(e,0.0,0.0);gl_Position=h*vec4(c,0.0,1.0)+offsets;a=d;b=f;}"),exports.default=_ol_render_webgl_texturereplay_defaultshader_},{"../../../index.js":89,"../../../webgl/fragment.js":252,"../../../webgl/vertex.js":254}],182:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_index=require("../../../../index.js"),_index2=(obj=_index)&&obj.__esModule?obj:{default:obj};exports.default=function(gl,program){this.u_projectionMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_projectionMatrix":"h"),this.u_offsetScaleMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_offsetScaleMatrix":"i"),this.u_offsetRotateMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_offsetRotateMatrix":"j"),this.u_opacity=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_opacity":"k"),this.u_image=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_image":"l"),this.a_position=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_position":"c"),this.a_texCoord=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_texCoord":"d"),this.a_offsets=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_offsets":"e"),this.a_opacity=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_opacity":"f"),this.a_rotateWithView=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_rotateWithView":"g")}},{"../../../../index.js":89}],183:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_imagecanvas2=_interopRequireDefault(require("../../imagecanvas.js")),_layertype2=_interopRequireDefault(require("../../layertype.js")),_viewhint2=_interopRequireDefault(require("../../viewhint.js")),_array2=_interopRequireDefault(require("../../array.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_vectorrendertype2=_interopRequireDefault(require("../../layer/vectorrendertype.js")),_obj2=_interopRequireDefault(require("../../obj.js")),_plugins2=_interopRequireDefault(require("../../plugins.js")),_type2=_interopRequireDefault(require("../type.js")),_intermediatecanvas2=_interopRequireDefault(require("../canvas/intermediatecanvas.js")),_transform2=_interopRequireDefault(require("../../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_canvas_ImageLayer_=function(imageLayer){_intermediatecanvas2.default.call(this,imageLayer),this.image_=null,this.imageTransform_=_transform2.default.create(),this.skippedFeatures_=[],this.vectorRenderer_=null};_index2.default.inherits(_ol_renderer_canvas_ImageLayer_,_intermediatecanvas2.default),_ol_renderer_canvas_ImageLayer_.handles=function(type,layer){return type===_type2.default.CANVAS&&(layer.getType()===_layertype2.default.IMAGE||layer.getType()===_layertype2.default.VECTOR&&layer.getRenderMode()===_vectorrendertype2.default.IMAGE)},_ol_renderer_canvas_ImageLayer_.create=function(mapRenderer,layer){var renderer=new _ol_renderer_canvas_ImageLayer_(layer);if(layer.getType()===_layertype2.default.VECTOR)for(var candidates=_plugins2.default.getLayerRendererPlugins(),i=0,ii=candidates.length;i<ii;++i){var candidate=candidates[i];candidate!==_ol_renderer_canvas_ImageLayer_&&candidate.handles(_type2.default.CANVAS,layer)&&renderer.setVectorRenderer(candidate.create(mapRenderer,layer))}return renderer},_ol_renderer_canvas_ImageLayer_.prototype.getImage=function(){return this.image_?this.image_.getImage():null},_ol_renderer_canvas_ImageLayer_.prototype.getImageTransform=function(){return this.imageTransform_},_ol_renderer_canvas_ImageLayer_.prototype.prepareFrame=function(frameState,layerState){var image,pixelRatio=frameState.pixelRatio,size=frameState.size,viewState=frameState.viewState,viewCenter=viewState.center,viewResolution=viewState.resolution,imageSource=this.getLayer().getSource(),hints=frameState.viewHints,renderedExtent=frameState.extent;if(void 0!==layerState.extent&&(renderedExtent=_extent2.default.getIntersection(renderedExtent,layerState.extent)),!hints[_viewhint2.default.ANIMATING]&&!hints[_viewhint2.default.INTERACTING]&&!_extent2.default.isEmpty(renderedExtent)){var projection=viewState.projection;if(!_index2.default.ENABLE_RASTER_REPROJECTION){var sourceProjection=imageSource.getProjection();sourceProjection&&(projection=sourceProjection)}var vectorRenderer=this.vectorRenderer_;if(vectorRenderer){var context=vectorRenderer.context,imageFrameState=_obj2.default.assign({},frameState,{size:[_extent2.default.getWidth(renderedExtent)/viewResolution,_extent2.default.getHeight(renderedExtent)/viewResolution],viewState:_obj2.default.assign({},frameState.viewState,{rotation:0})}),skippedFeatures=Object.keys(imageFrameState.skippedFeatureUids).sort();!vectorRenderer.prepareFrame(imageFrameState,layerState)||!vectorRenderer.replayGroupChanged&&_array2.default.equals(skippedFeatures,this.skippedFeatures_)||(context.canvas.width=imageFrameState.size[0]*pixelRatio,context.canvas.height=imageFrameState.size[1]*pixelRatio,vectorRenderer.composeFrame(imageFrameState,layerState,context),this.image_=new _imagecanvas2.default(renderedExtent,viewResolution,pixelRatio,context.canvas),this.skippedFeatures_=skippedFeatures)}else{if(image=imageSource.getImage(renderedExtent,viewResolution,pixelRatio,projection))this.loadImage(image)&&(this.image_=image)}}if(this.image_){var imageExtent=(image=this.image_).getExtent(),imageResolution=image.getResolution(),imagePixelRatio=image.getPixelRatio(),scale=pixelRatio*imageResolution/(viewResolution*imagePixelRatio),transform=_transform2.default.compose(this.imageTransform_,pixelRatio*size[0]/2,pixelRatio*size[1]/2,scale,scale,0,imagePixelRatio*(imageExtent[0]-viewCenter[0])/imageResolution,imagePixelRatio*(viewCenter[1]-imageExtent[3])/imageResolution);_transform2.default.compose(this.coordinateToCanvasPixelTransform,pixelRatio*size[0]/2-transform[4],pixelRatio*size[1]/2-transform[5],pixelRatio/viewResolution,-pixelRatio/viewResolution,0,-viewCenter[0],-viewCenter[1]),this.updateLogos(frameState,imageSource),this.renderedResolution=imageResolution*pixelRatio/imagePixelRatio}return!!this.image_},_ol_renderer_canvas_ImageLayer_.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,callback,thisArg):_intermediatecanvas2.default.prototype.forEachFeatureAtCoordinate.call(this,coordinate,frameState,hitTolerance,callback,thisArg)},_ol_renderer_canvas_ImageLayer_.prototype.setVectorRenderer=function(renderer){this.vectorRenderer_=renderer},exports.default=_ol_renderer_canvas_ImageLayer_},{"../../array.js":29,"../../extent.js":54,"../../imagecanvas.js":87,"../../index.js":89,"../../layer/vectorrendertype.js":111,"../../layertype.js":113,"../../obj.js":124,"../../plugins.js":131,"../../transform.js":243,"../../viewhint.js":246,"../canvas/intermediatecanvas.js":184,"../type.js":192}],184:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_coordinate2=_interopRequireDefault(require("../../coordinate.js")),_dom2=_interopRequireDefault(require("../../dom.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_layer2=_interopRequireDefault(require("../canvas/layer.js")),_transform2=_interopRequireDefault(require("../../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_canvas_IntermediateCanvas_=function(layer){_layer2.default.call(this,layer),this.coordinateToCanvasPixelTransform=_transform2.default.create(),this.hitCanvasContext_=null};_index2.default.inherits(_ol_renderer_canvas_IntermediateCanvas_,_layer2.default),_ol_renderer_canvas_IntermediateCanvas_.prototype.composeFrame=function(frameState,layerState,context){this.preCompose(context,frameState);var image=this.getImage();if(image){var extent=layerState.extent,clipped=void 0!==extent&&!_extent2.default.containsExtent(extent,frameState.extent)&&_extent2.default.intersects(extent,frameState.extent);clipped&&this.clip(context,frameState,extent);var imageTransform=this.getImageTransform(),alpha=context.globalAlpha;context.globalAlpha=layerState.opacity;var dx=imageTransform[4],dy=imageTransform[5],dw=image.width*imageTransform[0],dh=image.height*imageTransform[3];context.drawImage(image,0,0,+image.width,+image.height,Math.round(dx),Math.round(dy),Math.round(dw),Math.round(dh)),context.globalAlpha=alpha,clipped&&context.restore()}this.postCompose(context,frameState,layerState)},_ol_renderer_canvas_IntermediateCanvas_.prototype.getImage=function(){},_ol_renderer_canvas_IntermediateCanvas_.prototype.getImageTransform=function(){},_ol_renderer_canvas_IntermediateCanvas_.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){var layer=this.getLayer(),source=layer.getSource(),resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation,skippedFeatureUids=frameState.skippedFeatureUids;return source.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,skippedFeatureUids,function(feature){return callback.call(thisArg,feature,layer)})},_ol_renderer_canvas_IntermediateCanvas_.prototype.forEachLayerAtCoordinate=function(coordinate,frameState,callback,thisArg){if(this.getImage()){if(this.getLayer().getSource().forEachFeatureAtCoordinate!==_index2.default.nullFunction)return _layer2.default.prototype.forEachLayerAtCoordinate.apply(this,arguments);var pixel=_transform2.default.apply(this.coordinateToCanvasPixelTransform,coordinate.slice());_coordinate2.default.scale(pixel,frameState.viewState.resolution/this.renderedResolution),this.hitCanvasContext_||(this.hitCanvasContext_=_dom2.default.createCanvasContext2D(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.getImage(),pixel[0],pixel[1],1,1,0,0,1,1);var imageData=this.hitCanvasContext_.getImageData(0,0,1,1).data;return 0<imageData[3]?callback.call(thisArg,this.getLayer(),imageData):void 0}},exports.default=_ol_renderer_canvas_IntermediateCanvas_},{"../../coordinate.js":43,"../../dom.js":46,"../../extent.js":54,"../../index.js":89,"../../transform.js":243,"../canvas/layer.js":185}],185:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_functions2=_interopRequireDefault(require("../../functions.js")),_event2=_interopRequireDefault(require("../../render/event.js")),_eventtype2=_interopRequireDefault(require("../../render/eventtype.js")),_canvas2=_interopRequireDefault(require("../../render/canvas.js")),_immediate2=_interopRequireDefault(require("../../render/canvas/immediate.js")),_layer2=_interopRequireDefault(require("../layer.js")),_transform2=_interopRequireDefault(require("../../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_canvas_Layer_=function(layer){_layer2.default.call(this,layer),this.renderedResolution,this.transform_=_transform2.default.create()};_index2.default.inherits(_ol_renderer_canvas_Layer_,_layer2.default),_ol_renderer_canvas_Layer_.prototype.clip=function(context,frameState,extent){var pixelRatio=frameState.pixelRatio,width=frameState.size[0]*pixelRatio,height=frameState.size[1]*pixelRatio,rotation=frameState.viewState.rotation,topLeft=_extent2.default.getTopLeft(extent),topRight=_extent2.default.getTopRight(extent),bottomRight=_extent2.default.getBottomRight(extent),bottomLeft=_extent2.default.getBottomLeft(extent);_transform2.default.apply(frameState.coordinateToPixelTransform,topLeft),_transform2.default.apply(frameState.coordinateToPixelTransform,topRight),_transform2.default.apply(frameState.coordinateToPixelTransform,bottomRight),_transform2.default.apply(frameState.coordinateToPixelTransform,bottomLeft),context.save(),_canvas2.default.rotateAtOffset(context,-rotation,width/2,height/2),context.beginPath(),context.moveTo(topLeft[0]*pixelRatio,topLeft[1]*pixelRatio),context.lineTo(topRight[0]*pixelRatio,topRight[1]*pixelRatio),context.lineTo(bottomRight[0]*pixelRatio,bottomRight[1]*pixelRatio),context.lineTo(bottomLeft[0]*pixelRatio,bottomLeft[1]*pixelRatio),context.clip(),_canvas2.default.rotateAtOffset(context,rotation,width/2,height/2)},_ol_renderer_canvas_Layer_.prototype.dispatchComposeEvent_=function(type,context,frameState,opt_transform){var layer=this.getLayer();if(layer.hasListener(type)){var width=frameState.size[0]*frameState.pixelRatio,height=frameState.size[1]*frameState.pixelRatio,rotation=frameState.viewState.rotation;_canvas2.default.rotateAtOffset(context,-rotation,width/2,height/2);var transform=void 0!==opt_transform?opt_transform:this.getTransform(frameState,0),render=new _immediate2.default(context,frameState.pixelRatio,frameState.extent,transform,frameState.viewState.rotation),composeEvent=new _event2.default(type,render,frameState,context,null);layer.dispatchEvent(composeEvent),_canvas2.default.rotateAtOffset(context,rotation,width/2,height/2)}},_ol_renderer_canvas_Layer_.prototype.forEachLayerAtCoordinate=function(coordinate,frameState,callback,thisArg){return this.forEachFeatureAtCoordinate(coordinate,frameState,0,_functions2.default.TRUE,this)?callback.call(thisArg,this.getLayer(),null):void 0},_ol_renderer_canvas_Layer_.prototype.postCompose=function(context,frameState,layerState,opt_transform){this.dispatchComposeEvent_(_eventtype2.default.POSTCOMPOSE,context,frameState,opt_transform)},_ol_renderer_canvas_Layer_.prototype.preCompose=function(context,frameState,opt_transform){this.dispatchComposeEvent_(_eventtype2.default.PRECOMPOSE,context,frameState,opt_transform)},_ol_renderer_canvas_Layer_.prototype.dispatchRenderEvent=function(context,frameState,opt_transform){this.dispatchComposeEvent_(_eventtype2.default.RENDER,context,frameState,opt_transform)},_ol_renderer_canvas_Layer_.prototype.getTransform=function(frameState,offsetX){var viewState=frameState.viewState,pixelRatio=frameState.pixelRatio,dx1=pixelRatio*frameState.size[0]/2,dy1=pixelRatio*frameState.size[1]/2,sx=pixelRatio/viewState.resolution,sy=-sx,angle=-viewState.rotation,dx2=-viewState.center[0]+offsetX,dy2=-viewState.center[1];return _transform2.default.compose(this.transform_,dx1,dy1,sx,sy,angle,dx2,dy2)},_ol_renderer_canvas_Layer_.prototype.composeFrame=function(frameState,layerState,context){},_ol_renderer_canvas_Layer_.prototype.prepareFrame=function(frameState,layerState){},exports.default=_ol_renderer_canvas_Layer_},{"../../extent.js":54,"../../functions.js":60,"../../index.js":89,"../../render/canvas.js":150,"../../render/canvas/immediate.js":152,"../../render/event.js":159,"../../render/eventtype.js":160,"../../transform.js":243,"../layer.js":190}],186:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _transform2=_interopRequireDefault(require("../../transform.js")),_index2=_interopRequireDefault(require("../../index.js")),_array2=_interopRequireDefault(require("../../array.js")),_css2=_interopRequireDefault(require("../../css.js")),_dom2=_interopRequireDefault(require("../../dom.js")),_layer2=_interopRequireDefault(require("../../layer/layer.js")),_event2=_interopRequireDefault(require("../../render/event.js")),_eventtype2=_interopRequireDefault(require("../../render/eventtype.js")),_canvas2=_interopRequireDefault(require("../../render/canvas.js")),_immediate2=_interopRequireDefault(require("../../render/canvas/immediate.js")),_map2=_interopRequireDefault(require("../map.js")),_type2=_interopRequireDefault(require("../type.js")),_state2=_interopRequireDefault(require("../../source/state.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_canvas_Map_=function(container,map){_map2.default.call(this,container,map),this.context_=_dom2.default.createCanvasContext2D(),this.canvas_=this.context_.canvas,this.canvas_.style.width="100%",this.canvas_.style.height="100%",this.canvas_.style.display="block",this.canvas_.className=_css2.default.CLASS_UNSELECTABLE,container.insertBefore(this.canvas_,container.childNodes[0]||null),this.renderedVisible_=!0,this.transform_=_transform2.default.create()};_index2.default.inherits(_ol_renderer_canvas_Map_,_map2.default),_ol_renderer_canvas_Map_.handles=function(type){return type===_type2.default.CANVAS},_ol_renderer_canvas_Map_.create=function(container,map){return new _ol_renderer_canvas_Map_(container,map)},_ol_renderer_canvas_Map_.prototype.dispatchComposeEvent_=function(type,frameState){var map=this.getMap(),context=this.context_;if(map.hasListener(type)){var extent=frameState.extent,pixelRatio=frameState.pixelRatio,rotation=frameState.viewState.rotation,transform=this.getTransform(frameState),vectorContext=new _immediate2.default(context,pixelRatio,extent,transform,rotation),composeEvent=new _event2.default(type,vectorContext,frameState,context,null);map.dispatchEvent(composeEvent)}},_ol_renderer_canvas_Map_.prototype.getTransform=function(frameState){var viewState=frameState.viewState,dx1=this.canvas_.width/2,dy1=this.canvas_.height/2,sx=frameState.pixelRatio/viewState.resolution,sy=-sx,angle=-viewState.rotation,dx2=-viewState.center[0],dy2=-viewState.center[1];return _transform2.default.compose(this.transform_,dx1,dy1,sx,sy,angle,dx2,dy2)},_ol_renderer_canvas_Map_.prototype.getType=function(){return _type2.default.CANVAS},_ol_renderer_canvas_Map_.prototype.renderFrame=function(frameState){if(frameState){var context=this.context_,pixelRatio=frameState.pixelRatio,width=Math.round(frameState.size[0]*pixelRatio),height=Math.round(frameState.size[1]*pixelRatio);this.canvas_.width!=width||this.canvas_.height!=height?(this.canvas_.width=width,this.canvas_.height=height):context.clearRect(0,0,width,height);var rotation=frameState.viewState.rotation;this.calculateMatrices2D(frameState),this.dispatchComposeEvent_(_eventtype2.default.PRECOMPOSE,frameState);var layerStatesArray=frameState.layerStatesArray;_array2.default.stableSort(layerStatesArray,_map2.default.sortByZIndex),rotation&&(context.save(),_canvas2.default.rotateAtOffset(context,rotation,width/2,height/2));var i,ii,layer,layerRenderer,layerState,viewResolution=frameState.viewState.resolution;for(i=0,ii=layerStatesArray.length;i<ii;++i)layer=(layerState=layerStatesArray[i]).layer,layerRenderer=this.getLayerRenderer(layer),_layer2.default.visibleAtResolution(layerState,viewResolution)&&layerState.sourceState==_state2.default.READY&&layerRenderer.prepareFrame(frameState,layerState)&&layerRenderer.composeFrame(frameState,layerState,context);rotation&&context.restore(),this.dispatchComposeEvent_(_eventtype2.default.POSTCOMPOSE,frameState),this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0),this.scheduleRemoveUnusedLayerRenderers(frameState),this.scheduleExpireIconCache(frameState)}else this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1)},_ol_renderer_canvas_Map_.prototype.forEachLayerAtPixel=function(pixel,frameState,callback,thisArg,layerFilter,thisArg2){var result,i,viewResolution=frameState.viewState.resolution,layerStates=frameState.layerStatesArray,numLayers=layerStates.length,coordinate=_transform2.default.apply(frameState.pixelToCoordinateTransform,pixel.slice());for(i=numLayers-1;0<=i;--i){var layerState=layerStates[i],layer=layerState.layer;if(_layer2.default.visibleAtResolution(layerState,viewResolution)&&layerFilter.call(thisArg2,layer))if(result=this.getLayerRenderer(layer).forEachLayerAtCoordinate(coordinate,frameState,callback,thisArg))return result}},exports.default=_ol_renderer_canvas_Map_},{"../../array.js":29,"../../css.js":44,"../../dom.js":46,"../../index.js":89,"../../layer/layer.js":108,"../../render/canvas.js":150,"../../render/canvas/immediate.js":152,"../../render/event.js":159,"../../render/eventtype.js":160,"../../source/state.js":212,"../../transform.js":243,"../map.js":191,"../type.js":192}],187:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_layertype2=_interopRequireDefault(require("../../layertype.js")),_tilerange2=_interopRequireDefault(require("../../tilerange.js")),_tilestate2=_interopRequireDefault(require("../../tilestate.js")),_viewhint2=_interopRequireDefault(require("../../viewhint.js")),_dom2=_interopRequireDefault(require("../../dom.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_type2=_interopRequireDefault(require("../type.js")),_intermediatecanvas2=_interopRequireDefault(require("../canvas/intermediatecanvas.js")),_transform2=_interopRequireDefault(require("../../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_canvas_TileLayer_=function(tileLayer){_intermediatecanvas2.default.call(this,tileLayer),this.context=null===this.context?null:_dom2.default.createCanvasContext2D(),this.oversampling_,this.renderedExtent_=null,this.renderedRevision,this.renderedTiles=[],this.tmpExtent=_extent2.default.createEmpty(),this.tmpTileRange_=new _tilerange2.default(0,0,0,0),this.imageTransform_=_transform2.default.create(),this.zDirection=0};_index2.default.inherits(_ol_renderer_canvas_TileLayer_,_intermediatecanvas2.default),_ol_renderer_canvas_TileLayer_.handles=function(type,layer){return type===_type2.default.CANVAS&&layer.getType()===_layertype2.default.TILE},_ol_renderer_canvas_TileLayer_.create=function(mapRenderer,layer){return new _ol_renderer_canvas_TileLayer_(layer)},_ol_renderer_canvas_TileLayer_.prototype.isDrawableTile_=function(tile){var tileState=tile.getState(),useInterimTilesOnError=this.getLayer().getUseInterimTilesOnError();return tileState==_tilestate2.default.LOADED||tileState==_tilestate2.default.EMPTY||tileState==_tilestate2.default.ERROR&&!useInterimTilesOnError},_ol_renderer_canvas_TileLayer_.prototype.prepareFrame=function(frameState,layerState){var pixelRatio=frameState.pixelRatio,size=frameState.size,viewState=frameState.viewState,projection=viewState.projection,viewResolution=viewState.resolution,viewCenter=viewState.center,tileLayer=this.getLayer(),tileSource=tileLayer.getSource(),sourceRevision=tileSource.getRevision(),tileGrid=tileSource.getTileGridForProjection(projection),z=tileGrid.getZForResolution(viewResolution,this.zDirection),tileResolution=tileGrid.getResolution(z),oversampling=Math.round(viewResolution/tileResolution)||1,extent=frameState.extent;if(void 0!==layerState.extent&&(extent=_extent2.default.getIntersection(extent,layerState.extent)),_extent2.default.isEmpty(extent))return!1;var tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z),imageExtent=tileGrid.getTileRangeExtent(z,tileRange),tilePixelRatio=tileSource.getTilePixelRatio(pixelRatio),tilesToDrawByZ={};tilesToDrawByZ[z]={};var tile,x,y,findLoadedTiles=this.createLoadedTileFinder(tileSource,projection,tilesToDrawByZ),tmpExtent=this.tmpExtent,tmpTileRange=this.tmpTileRange_,newTiles=!1;for(x=tileRange.minX;x<=tileRange.maxX;++x)for(y=tileRange.minY;y<=tileRange.maxY;++y){if((tile=tileSource.getTile(z,x,y,pixelRatio,projection)).getState()==_tilestate2.default.ERROR&&(tileLayer.getUseInterimTilesOnError()?0<tileLayer.getPreload()&&(newTiles=!0):tile.setState(_tilestate2.default.LOADED)),this.isDrawableTile_(tile)||(tile=tile.getInterimTile()),this.isDrawableTile_(tile)){var uid=_index2.default.getUid(this);if(tile.getState()==_tilestate2.default.LOADED){var inTransition=(tilesToDrawByZ[z][tile.tileCoord.toString()]=tile).inTransition(uid);newTiles||!inTransition&&-1!==this.renderedTiles.indexOf(tile)||(newTiles=!0)}if(1===tile.getAlpha(uid,frameState.time))continue}var childTileRange=tileGrid.getTileCoordChildTileRange(tile.tileCoord,tmpTileRange,tmpExtent),covered=!1;childTileRange&&(covered=findLoadedTiles(z+1,childTileRange)),covered||tileGrid.forEachTileCoordParentTileRange(tile.tileCoord,findLoadedTiles,null,tmpTileRange,tmpExtent)}var renderedResolution=tileResolution*pixelRatio/tilePixelRatio*oversampling,hints=frameState.viewHints,animatingOrInteracting=hints[_viewhint2.default.ANIMATING]||hints[_viewhint2.default.INTERACTING];if(!(this.renderedResolution&&16<Date.now()-frameState.time&&animatingOrInteracting)&&(newTiles||!this.renderedExtent_||!_extent2.default.containsExtent(this.renderedExtent_,extent)||this.renderedRevision!=sourceRevision||oversampling!=this.oversampling_||!animatingOrInteracting&&renderedResolution!=this.renderedResolution)){var context=this.context;if(context){var tilePixelSize=tileSource.getTilePixelSize(z,pixelRatio,projection),width=Math.round(tileRange.getWidth()*tilePixelSize[0]/oversampling),height=Math.round(tileRange.getHeight()*tilePixelSize[1]/oversampling),canvas=context.canvas;canvas.width!=width||canvas.height!=height?(this.oversampling_=oversampling,canvas.width=width,canvas.height=height):(this.renderedExtent_&&!_extent2.default.equals(imageExtent,this.renderedExtent_)&&context.clearRect(0,0,width,height),oversampling=this.oversampling_)}this.renderedTiles.length=0;var currentScale,currentTilePixelSize,currentZ,i,ii,tileExtent,tileGutter,tilesToDraw,w,h,zs=Object.keys(tilesToDrawByZ).map(Number);for(zs.sort(function(a,b){return a===z?1:b===z?-1:b<a?1:a<b?-1:0}),i=0,ii=zs.length;i<ii;++i)for(var tileCoordKey in currentZ=zs[i],currentTilePixelSize=tileSource.getTilePixelSize(currentZ,pixelRatio,projection),currentScale=tileGrid.getResolution(currentZ)/tileResolution,tileGutter=tilePixelRatio*tileSource.getGutter(projection),tilesToDraw=tilesToDrawByZ[currentZ])tile=tilesToDraw[tileCoordKey],x=((tileExtent=tileGrid.getTileCoordExtent(tile.getTileCoord(),tmpExtent))[0]-imageExtent[0])/tileResolution*tilePixelRatio/oversampling,y=(imageExtent[3]-tileExtent[3])/tileResolution*tilePixelRatio/oversampling,w=currentTilePixelSize[0]*currentScale/oversampling,h=currentTilePixelSize[1]*currentScale/oversampling,this.drawTileImage(tile,frameState,layerState,x,y,w,h,tileGutter,z===currentZ),this.renderedTiles.push(tile);this.renderedRevision=sourceRevision,this.renderedResolution=tileResolution*pixelRatio/tilePixelRatio*oversampling,this.renderedExtent_=imageExtent}var scale=this.renderedResolution/viewResolution,transform=_transform2.default.compose(this.imageTransform_,pixelRatio*size[0]/2,pixelRatio*size[1]/2,scale,scale,0,(this.renderedExtent_[0]-viewCenter[0])/this.renderedResolution*pixelRatio,(viewCenter[1]-this.renderedExtent_[3])/this.renderedResolution*pixelRatio);return _transform2.default.compose(this.coordinateToCanvasPixelTransform,pixelRatio*size[0]/2-transform[4],pixelRatio*size[1]/2-transform[5],pixelRatio/viewResolution,-pixelRatio/viewResolution,0,-viewCenter[0],-viewCenter[1]),this.updateUsedTiles(frameState.usedTiles,tileSource,z,tileRange),this.manageTilePyramid(frameState,tileSource,tileGrid,pixelRatio,projection,extent,z,tileLayer.getPreload()),this.scheduleExpireCache(frameState,tileSource),this.updateLogos(frameState,tileSource),0<this.renderedTiles.length},_ol_renderer_canvas_TileLayer_.prototype.drawTileImage=function(tile,frameState,layerState,x,y,w,h,gutter,transition){var image=tile.getImage(this.getLayer());if(image){var uid=_index2.default.getUid(this),alpha=transition?tile.getAlpha(uid,frameState.time):1;1!==alpha||this.getLayer().getSource().getOpaque(frameState.viewState.projection)||this.context.clearRect(x,y,w,h);var alphaChanged=alpha!==this.context.globalAlpha;alphaChanged&&(this.context.save(),this.context.globalAlpha=alpha),this.context.drawImage(image,gutter,gutter,image.width-2*gutter,image.height-2*gutter,x,y,w,h),alphaChanged&&this.context.restore(),1!==alpha?frameState.animate=!0:transition&&tile.endTransition(uid)}},_ol_renderer_canvas_TileLayer_.prototype.getImage=function(){var context=this.context;return context?context.canvas:null},_ol_renderer_canvas_TileLayer_.prototype.getImageTransform=function(){return this.imageTransform_},exports.default=_ol_renderer_canvas_TileLayer_},{"../../dom.js":46,"../../extent.js":54,"../../index.js":89,"../../layertype.js":113,"../../tilerange.js":241,"../../tilestate.js":242,"../../transform.js":243,"../../viewhint.js":246,"../canvas/intermediatecanvas.js":184,"../type.js":192}],188:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_layertype2=_interopRequireDefault(require("../../layertype.js")),_viewhint2=_interopRequireDefault(require("../../viewhint.js")),_dom2=_interopRequireDefault(require("../../dom.js")),_events2=_interopRequireDefault(require("../../events.js")),_eventtype2=_interopRequireDefault(require("../../events/eventtype.js")),_rbush2=_interopRequireDefault(require("rbush")),_extent2=_interopRequireDefault(require("../../extent.js")),_eventtype4=_interopRequireDefault(require("../../render/eventtype.js")),_canvas2=_interopRequireDefault(require("../../render/canvas.js")),_replaygroup2=_interopRequireDefault(require("../../render/canvas/replaygroup.js")),_type2=_interopRequireDefault(require("../type.js")),_layer2=_interopRequireDefault(require("../canvas/layer.js")),_vector2=_interopRequireDefault(require("../vector.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_canvas_VectorLayer_=function(vectorLayer){_layer2.default.call(this,vectorLayer),this.declutterTree_=vectorLayer.getDeclutter()?(0,_rbush2.default)(9):null,this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=_extent2.default.createEmpty(),this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.context=_dom2.default.createCanvasContext2D(),_events2.default.listen(_canvas2.default.labelCache,_eventtype2.default.CLEAR,this.handleFontsChanged_,this)};_index2.default.inherits(_ol_renderer_canvas_VectorLayer_,_layer2.default),_ol_renderer_canvas_VectorLayer_.handles=function(type,layer){return type===_type2.default.CANVAS&&layer.getType()===_layertype2.default.VECTOR},_ol_renderer_canvas_VectorLayer_.create=function(mapRenderer,layer){return new _ol_renderer_canvas_VectorLayer_(layer)},_ol_renderer_canvas_VectorLayer_.prototype.disposeInternal=function(){_events2.default.unlisten(_canvas2.default.labelCache,_eventtype2.default.CLEAR,this.handleFontsChanged_,this),_layer2.default.prototype.disposeInternal.call(this)},_ol_renderer_canvas_VectorLayer_.prototype.composeFrame=function(frameState,layerState,context){var extent=frameState.extent,pixelRatio=frameState.pixelRatio,skippedFeatureUids=layerState.managed?frameState.skippedFeatureUids:{},viewState=frameState.viewState,projection=viewState.projection,rotation=viewState.rotation,projectionExtent=projection.getExtent(),vectorSource=this.getLayer().getSource(),transform=this.getTransform(frameState,0);this.preCompose(context,frameState,transform);var clipExtent=layerState.extent,clipped=void 0!==clipExtent;clipped&&this.clip(context,frameState,clipExtent);var replayGroup=this.replayGroup_;if(replayGroup&&!replayGroup.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();var replayContext,layer=this.getLayer(),drawOffsetX=0,drawOffsetY=0,transparentLayer=1!==layerState.opacity,hasRenderListeners=layer.hasListener(_eventtype4.default.RENDER);if(transparentLayer||hasRenderListeners){var drawWidth=context.canvas.width,drawHeight=context.canvas.height;if(rotation){var drawSize=Math.round(Math.sqrt(drawWidth*drawWidth+drawHeight*drawHeight));drawOffsetX=(drawSize-drawWidth)/2,drawOffsetY=(drawSize-drawHeight)/2,drawWidth=drawHeight=drawSize}this.context.canvas.width=drawWidth,this.context.canvas.height=drawHeight,replayContext=this.context}else replayContext=context;var alpha=replayContext.globalAlpha;transparentLayer||(replayContext.globalAlpha=layerState.opacity),replayContext!=context&&replayContext.translate(drawOffsetX,drawOffsetY);var width=frameState.size[0]*pixelRatio,height=frameState.size[1]*pixelRatio;if(_canvas2.default.rotateAtOffset(replayContext,-rotation,width/2,height/2),replayGroup.replay(replayContext,transform,rotation,skippedFeatureUids),vectorSource.getWrapX()&&projection.canWrapX()&&!_extent2.default.containsExtent(projectionExtent,extent)){for(var offsetX,startX=extent[0],worldWidth=_extent2.default.getWidth(projectionExtent),world=0;startX<projectionExtent[0];)offsetX=worldWidth*--world,transform=this.getTransform(frameState,offsetX),replayGroup.replay(replayContext,transform,rotation,skippedFeatureUids),startX+=worldWidth;for(world=0,startX=extent[2];startX>projectionExtent[2];)offsetX=worldWidth*++world,transform=this.getTransform(frameState,offsetX),replayGroup.replay(replayContext,transform,rotation,skippedFeatureUids),startX-=worldWidth;transform=this.getTransform(frameState,0)}if(_canvas2.default.rotateAtOffset(replayContext,rotation,width/2,height/2),replayContext!=context){if(hasRenderListeners&&this.dispatchRenderEvent(replayContext,frameState,transform),transparentLayer){var mainContextAlpha=context.globalAlpha;context.globalAlpha=layerState.opacity,context.drawImage(replayContext.canvas,-drawOffsetX,-drawOffsetY),context.globalAlpha=mainContextAlpha}else context.drawImage(replayContext.canvas,-drawOffsetX,-drawOffsetY);replayContext.translate(-drawOffsetX,-drawOffsetY)}transparentLayer||(replayContext.globalAlpha=alpha)}clipped&&context.restore(),this.postCompose(context,frameState,layerState,transform)},_ol_renderer_canvas_VectorLayer_.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){if(this.replayGroup_){var resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation,layer=this.getLayer(),features={};return this.replayGroup_.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,{},function(feature){var key=_index2.default.getUid(feature).toString();if(!(key in features))return features[key]=!0,callback.call(thisArg,feature,layer)},null)}},_ol_renderer_canvas_VectorLayer_.prototype.handleFontsChanged_=function(event){var layer=this.getLayer();layer.getVisible()&&this.replayGroup_&&layer.changed()},_ol_renderer_canvas_VectorLayer_.prototype.handleStyleImageChange_=function(event){this.renderIfReadyAndVisible()},_ol_renderer_canvas_VectorLayer_.prototype.prepareFrame=function(frameState,layerState){var vectorLayer=this.getLayer(),vectorSource=vectorLayer.getSource();this.updateLogos(frameState,vectorSource);var animating=frameState.viewHints[_viewhint2.default.ANIMATING],interacting=frameState.viewHints[_viewhint2.default.INTERACTING],updateWhileAnimating=vectorLayer.getUpdateWhileAnimating(),updateWhileInteracting=vectorLayer.getUpdateWhileInteracting();if(!this.dirty_&&!updateWhileAnimating&&animating||!updateWhileInteracting&&interacting)return!0;var frameStateExtent=frameState.extent,viewState=frameState.viewState,projection=viewState.projection,resolution=viewState.resolution,pixelRatio=frameState.pixelRatio,vectorLayerRevision=vectorLayer.getRevision(),vectorLayerRenderBuffer=vectorLayer.getRenderBuffer(),vectorLayerRenderOrder=vectorLayer.getRenderOrder();void 0===vectorLayerRenderOrder&&(vectorLayerRenderOrder=_vector2.default.defaultOrder);var extent=_extent2.default.buffer(frameStateExtent,vectorLayerRenderBuffer*resolution),projectionExtent=viewState.projection.getExtent();if(vectorSource.getWrapX()&&viewState.projection.canWrapX()&&!_extent2.default.containsExtent(projectionExtent,frameState.extent)){var worldWidth=_extent2.default.getWidth(projectionExtent),buffer=Math.max(_extent2.default.getWidth(extent)/2,worldWidth);extent[0]=projectionExtent[0]-buffer,extent[2]=projectionExtent[2]+buffer}if(!this.dirty_&&this.renderedResolution_==resolution&&this.renderedRevision_==vectorLayerRevision&&this.renderedRenderOrder_==vectorLayerRenderOrder&&_extent2.default.containsExtent(this.renderedExtent_,extent))return!(this.replayGroupChanged=!1);this.replayGroup_=null,this.dirty_=!1;var replayGroup=new _replaygroup2.default(_vector2.default.getTolerance(resolution,pixelRatio),extent,resolution,pixelRatio,vectorSource.getOverlaps(),this.declutterTree_,vectorLayer.getRenderBuffer());vectorSource.loadFeatures(extent,resolution,projection);var renderFeature=function(feature){var styles,styleFunction=feature.getStyleFunction();if(styleFunction?styles=styleFunction.call(feature,resolution):(styleFunction=vectorLayer.getStyleFunction())&&(styles=styleFunction(feature,resolution)),styles){var dirty=this.renderFeature(feature,resolution,pixelRatio,styles,replayGroup);this.dirty_=this.dirty_||dirty}}.bind(this);if(vectorLayerRenderOrder){var features=[];vectorSource.forEachFeatureInExtent(extent,function(feature){features.push(feature)},this),features.sort(vectorLayerRenderOrder);for(var i=0,ii=features.length;i<ii;++i)renderFeature(features[i])}else vectorSource.forEachFeatureInExtent(extent,renderFeature,this);return replayGroup.finish(),this.renderedResolution_=resolution,this.renderedRevision_=vectorLayerRevision,this.renderedRenderOrder_=vectorLayerRenderOrder,this.renderedExtent_=extent,this.replayGroup_=replayGroup,this.replayGroupChanged=!0},_ol_renderer_canvas_VectorLayer_.prototype.renderFeature=function(feature,resolution,pixelRatio,styles,replayGroup){if(!styles)return!1;var loading=!1;if(Array.isArray(styles))for(var i=0,ii=styles.length;i<ii;++i)loading=_vector2.default.renderFeature(replayGroup,feature,styles[i],_vector2.default.getSquaredTolerance(resolution,pixelRatio),this.handleStyleImageChange_,this)||loading;else loading=_vector2.default.renderFeature(replayGroup,feature,styles,_vector2.default.getSquaredTolerance(resolution,pixelRatio),this.handleStyleImageChange_,this);return loading},exports.default=_ol_renderer_canvas_VectorLayer_},{"../../dom.js":46,"../../events.js":48,"../../events/eventtype.js":52,"../../extent.js":54,"../../index.js":89,"../../layertype.js":113,"../../render/canvas.js":150,"../../render/canvas/replaygroup.js":157,"../../render/eventtype.js":160,"../../viewhint.js":246,"../canvas/layer.js":185,"../type.js":192,"../vector.js":193,rbush:258}],189:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_layertype2=_interopRequireDefault(require("../../layertype.js")),_tilestate2=_interopRequireDefault(require("../../tilestate.js")),_dom2=_interopRequireDefault(require("../../dom.js")),_events2=_interopRequireDefault(require("../../events.js")),_eventtype2=_interopRequireDefault(require("../../events/eventtype.js")),_rbush2=_interopRequireDefault(require("rbush")),_extent2=_interopRequireDefault(require("../../extent.js")),_vectortilerendertype2=_interopRequireDefault(require("../../layer/vectortilerendertype.js")),_proj2=_interopRequireDefault(require("../../proj.js")),_units2=_interopRequireDefault(require("../../proj/units.js")),_replaytype2=_interopRequireDefault(require("../../render/replaytype.js")),_canvas2=_interopRequireDefault(require("../../render/canvas.js")),_replaygroup2=_interopRequireDefault(require("../../render/canvas/replaygroup.js")),_replay2=_interopRequireDefault(require("../../render/replay.js")),_type2=_interopRequireDefault(require("../type.js")),_tilelayer2=_interopRequireDefault(require("../canvas/tilelayer.js")),_vector2=_interopRequireDefault(require("../vector.js")),_transform2=_interopRequireDefault(require("../../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_canvas_VectorTileLayer_=function(layer){this.context=null,_tilelayer2.default.call(this,layer),this.declutterTree_=layer.getDeclutter()?(0,_rbush2.default)(9):null,this.dirty_=!1,this.renderedLayerRevision_,this.tmpTransform_=_transform2.default.create(),this.zDirection=layer.getRenderMode()==_vectortilerendertype2.default.VECTOR?1:0,_events2.default.listen(_canvas2.default.labelCache,_eventtype2.default.CLEAR,this.handleFontsChanged_,this)};_index2.default.inherits(_ol_renderer_canvas_VectorTileLayer_,_tilelayer2.default),_ol_renderer_canvas_VectorTileLayer_.handles=function(type,layer){return type===_type2.default.CANVAS&&layer.getType()===_layertype2.default.VECTOR_TILE},_ol_renderer_canvas_VectorTileLayer_.create=function(mapRenderer,layer){return new _ol_renderer_canvas_VectorTileLayer_(layer)},_ol_renderer_canvas_VectorTileLayer_.IMAGE_REPLAYS={image:[_replaytype2.default.POLYGON,_replaytype2.default.CIRCLE,_replaytype2.default.LINE_STRING,_replaytype2.default.IMAGE,_replaytype2.default.TEXT],hybrid:[_replaytype2.default.POLYGON,_replaytype2.default.LINE_STRING]},_ol_renderer_canvas_VectorTileLayer_.VECTOR_REPLAYS={image:[_replaytype2.default.DEFAULT],hybrid:[_replaytype2.default.IMAGE,_replaytype2.default.TEXT,_replaytype2.default.DEFAULT],vector:_replay2.default.ORDER},_ol_renderer_canvas_VectorTileLayer_.prototype.disposeInternal=function(){_events2.default.unlisten(_canvas2.default.labelCache,_eventtype2.default.CLEAR,this.handleFontsChanged_,this),_tilelayer2.default.prototype.disposeInternal.call(this)},_ol_renderer_canvas_VectorTileLayer_.prototype.prepareFrame=function(frameState,layerState){var layer=this.getLayer(),layerRevision=layer.getRevision();if(this.renderedLayerRevision_!=layerRevision){this.renderedTiles.length=0;var renderMode=layer.getRenderMode();this.context||renderMode==_vectortilerendertype2.default.VECTOR||(this.context=_dom2.default.createCanvasContext2D()),this.context&&renderMode==_vectortilerendertype2.default.VECTOR&&(this.context=null)}return this.renderedLayerRevision_=layerRevision,_tilelayer2.default.prototype.prepareFrame.apply(this,arguments)},_ol_renderer_canvas_VectorTileLayer_.prototype.createReplayGroup_=function(tile,frameState){var layer=this.getLayer(),pixelRatio=frameState.pixelRatio,projection=frameState.viewState.projection,revision=layer.getRevision(),renderOrder=layer.getRenderOrder()||null,replayState=tile.getReplayState(layer);if(replayState.dirty||replayState.renderedRevision!=revision||replayState.renderedRenderOrder!=renderOrder){for(var source=layer.getSource(),sourceTileGrid=source.getTileGrid(),tileGrid=source.getTileGridForProjection(projection),resolution=tileGrid.getResolution(tile.tileCoord[0]),tileExtent=tileGrid.getTileCoordExtent(tile.wrappedTileCoord),zIndexKeys={},t=0,tt=tile.tileKeys.length;t<tt;++t){var sourceTile=tile.getTile(tile.tileKeys[t]);if(sourceTile.getState()!=_tilestate2.default.ERROR){var sourceTileCoord=sourceTile.tileCoord,sourceTileExtent=sourceTileGrid.getTileCoordExtent(sourceTileCoord),sharedExtent=_extent2.default.getIntersection(tileExtent,sourceTileExtent),bufferedExtent=_extent2.default.equals(sourceTileExtent,sharedExtent)?null:_extent2.default.buffer(sharedExtent,layer.getRenderBuffer()*resolution),tileProjection=sourceTile.getProjection(),reproject=!1;_proj2.default.equivalent(projection,tileProjection)||(reproject=!0,sourceTile.setProjection(projection)),replayState.dirty=!1;var feature,replayGroup=new _replaygroup2.default(0,sharedExtent,resolution,pixelRatio,source.getOverlaps(),this.declutterTree_,layer.getRenderBuffer()),squaredTolerance=_vector2.default.getSquaredTolerance(resolution,pixelRatio),renderFeature=function(feature){var styles,styleFunction=feature.getStyleFunction();if(styleFunction?styles=styleFunction.call(feature,resolution):(styleFunction=layer.getStyleFunction())&&(styles=styleFunction(feature,resolution)),styles){var dirty=this.renderFeature(feature,squaredTolerance,styles,replayGroup);this.dirty_=this.dirty_||dirty,replayState.dirty=replayState.dirty||dirty}},features=sourceTile.getFeatures();renderOrder&&renderOrder!==replayState.renderedRenderOrder&&features.sort(renderOrder);for(var i=0,ii=features.length;i<ii;++i)feature=features[i],reproject&&(tileProjection.getUnits()==_units2.default.TILE_PIXELS&&(tileProjection.setWorldExtent(sourceTileExtent),tileProjection.setExtent(sourceTile.getExtent())),feature.getGeometry().transform(tileProjection,projection)),bufferedExtent&&!_extent2.default.intersects(bufferedExtent,feature.getGeometry().getExtent())||renderFeature.call(this,feature);for(var r in replayGroup.finish(),replayGroup.getReplays())zIndexKeys[r]=!0;sourceTile.setReplayGroup(layer,tile.tileCoord.toString(),replayGroup)}}replayState.renderedRevision=revision,replayState.renderedRenderOrder=renderOrder}},_ol_renderer_canvas_VectorTileLayer_.prototype.drawTileImage=function(tile,frameState,layerState,x,y,w,h,gutter,transition){var vectorImageTile=tile;this.createReplayGroup_(vectorImageTile,frameState),this.context&&(this.renderTileImage_(vectorImageTile,frameState,layerState),_tilelayer2.default.prototype.drawTileImage.apply(this,arguments))},_ol_renderer_canvas_VectorTileLayer_.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){var resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation;hitTolerance=null==hitTolerance?0:hitTolerance;var bufferedExtent,found,i,ii,replayGroup,tile,tileCoord,tileExtent,layer=this.getLayer(),features={},renderedTiles=this.renderedTiles,tileGrid=layer.getSource().getTileGridForProjection(frameState.viewState.projection);for(i=0,ii=renderedTiles.length;i<ii;++i)if(tileCoord=(tile=renderedTiles[i]).wrappedTileCoord,tileExtent=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent),bufferedExtent=_extent2.default.buffer(tileExtent,hitTolerance*resolution,bufferedExtent),_extent2.default.containsCoordinate(bufferedExtent,coordinate))for(var t=0,tt=tile.tileKeys.length;t<tt;++t){var sourceTile=tile.getTile(tile.tileKeys[t]);sourceTile.getState()!=_tilestate2.default.ERROR&&(replayGroup=sourceTile.getReplayGroup(layer,tile.tileCoord.toString()),found=found||replayGroup.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,{},function(feature){var key=_index2.default.getUid(feature).toString();if(!(key in features))return features[key]=!0,callback.call(thisArg,feature,layer)},null))}return found},_ol_renderer_canvas_VectorTileLayer_.prototype.getReplayTransform_=function(tile,frameState){var tileGrid=this.getLayer().getSource().getTileGrid(),tileCoord=tile.tileCoord,tileResolution=tileGrid.getResolution(tileCoord[0]),viewState=frameState.viewState,pixelRatio=frameState.pixelRatio,renderResolution=viewState.resolution/pixelRatio,tileExtent=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent),center=viewState.center,origin=_extent2.default.getTopLeft(tileExtent),size=frameState.size,offsetX=Math.round(pixelRatio*size[0]/2),offsetY=Math.round(pixelRatio*size[1]/2);return _transform2.default.compose(this.tmpTransform_,offsetX,offsetY,tileResolution/renderResolution,tileResolution/renderResolution,viewState.rotation,(origin[0]-center[0])/tileResolution,(center[1]-origin[1])/tileResolution)},_ol_renderer_canvas_VectorTileLayer_.prototype.handleFontsChanged_=function(event){var layer=this.getLayer();layer.getVisible()&&void 0!==this.renderedLayerRevision_&&layer.changed()},_ol_renderer_canvas_VectorTileLayer_.prototype.handleStyleImageChange_=function(event){this.renderIfReadyAndVisible()},_ol_renderer_canvas_VectorTileLayer_.prototype.postCompose=function(context,frameState,layerState){var offsetX,offsetY,layer=this.getLayer(),declutterReplays=layer.getDeclutter()?{}:null,source=layer.getSource(),renderMode=layer.getRenderMode(),replayTypes=_ol_renderer_canvas_VectorTileLayer_.VECTOR_REPLAYS[renderMode],pixelRatio=frameState.pixelRatio,rotation=frameState.viewState.rotation,size=frameState.size;rotation&&(offsetX=Math.round(pixelRatio*size[0]/2),offsetY=Math.round(pixelRatio*size[1]/2),_canvas2.default.rotateAtOffset(context,-rotation,offsetX,offsetY)),declutterReplays&&this.declutterTree_.clear();for(var tiles=this.renderedTiles,tileGrid=source.getTileGridForProjection(frameState.viewState.projection),clips=[],zs=[],i=tiles.length-1;0<=i;--i){var tile=tiles[i];if(tile.getState()!=_tilestate2.default.ABORT)for(var tileCoord=tile.tileCoord,worldOffset=tileGrid.getTileCoordExtent(tileCoord)[0]-tileGrid.getTileCoordExtent(tile.wrappedTileCoord)[0],transform=void 0,t=0,tt=tile.tileKeys.length;t<tt;++t){var sourceTile=tile.getTile(tile.tileKeys[t]);if(sourceTile.getState()!=_tilestate2.default.ERROR){var replayGroup=sourceTile.getReplayGroup(layer,tileCoord.toString());if(renderMode==_vectortilerendertype2.default.VECTOR||replayGroup.hasReplays(replayTypes)){transform||(transform=this.getTransform(frameState,worldOffset));var currentZ=sourceTile.tileCoord[0],currentClip=replayGroup.getClipCoords(transform);context.save(),context.globalAlpha=layerState.opacity;for(var j=0,jj=clips.length;j<jj;++j){var clip=clips[j];currentZ<zs[j]&&(context.beginPath(),context.moveTo(currentClip[0],currentClip[1]),context.lineTo(currentClip[2],currentClip[3]),context.lineTo(currentClip[4],currentClip[5]),context.lineTo(currentClip[6],currentClip[7]),context.moveTo(clip[6],clip[7]),context.lineTo(clip[4],clip[5]),context.lineTo(clip[2],clip[3]),context.lineTo(clip[0],clip[1]),context.clip())}replayGroup.replay(context,transform,rotation,{},replayTypes,declutterReplays),context.restore(),clips.push(currentClip),zs.push(currentZ)}}}}declutterReplays&&_replaygroup2.default.replayDeclutter(declutterReplays,context,rotation),rotation&&_canvas2.default.rotateAtOffset(context,rotation,offsetX,offsetY),_tilelayer2.default.prototype.postCompose.apply(this,arguments)},_ol_renderer_canvas_VectorTileLayer_.prototype.renderFeature=function(feature,squaredTolerance,styles,replayGroup){if(!styles)return!1;var loading=!1;if(Array.isArray(styles))for(var i=0,ii=styles.length;i<ii;++i)loading=_vector2.default.renderFeature(replayGroup,feature,styles[i],squaredTolerance,this.handleStyleImageChange_,this)||loading;else loading=_vector2.default.renderFeature(replayGroup,feature,styles,squaredTolerance,this.handleStyleImageChange_,this);return loading},_ol_renderer_canvas_VectorTileLayer_.prototype.renderTileImage_=function(tile,frameState,layerState){var layer=this.getLayer(),replayState=tile.getReplayState(layer),revision=layer.getRevision(),replays=_ol_renderer_canvas_VectorTileLayer_.IMAGE_REPLAYS[layer.getRenderMode()];if(replays&&replayState.renderedTileRevision!==revision){replayState.renderedTileRevision=revision;var tileCoord=tile.wrappedTileCoord,z=tileCoord[0],pixelRatio=frameState.pixelRatio,source=layer.getSource(),tileGrid=source.getTileGridForProjection(frameState.viewState.projection),resolution=tileGrid.getResolution(z),context=tile.getContext(layer),size=source.getTilePixelSize(z,pixelRatio,frameState.viewState.projection);context.canvas.width=size[0],context.canvas.height=size[1];for(var tileExtent=tileGrid.getTileCoordExtent(tileCoord),i=0,ii=tile.tileKeys.length;i<ii;++i){var sourceTile=tile.getTile(tile.tileKeys[i]);if(sourceTile.getState()!=_tilestate2.default.ERROR){var pixelScale=pixelRatio/resolution,transform=_transform2.default.reset(this.tmpTransform_);_transform2.default.scale(transform,pixelScale,-pixelScale),_transform2.default.translate(transform,-tileExtent[0],-tileExtent[3]),sourceTile.getReplayGroup(layer,tile.tileCoord.toString()).replay(context,transform,0,{},replays)}}}},exports.default=_ol_renderer_canvas_VectorTileLayer_},{"../../dom.js":46,"../../events.js":48,"../../events/eventtype.js":52,"../../extent.js":54,"../../index.js":89,"../../layer/vectortilerendertype.js":112,"../../layertype.js":113,"../../proj.js":141,"../../proj/units.js":148,"../../render/canvas.js":150,"../../render/canvas/replaygroup.js":157,"../../render/replay.js":161,"../../render/replaytype.js":163,"../../tilestate.js":242,"../../transform.js":243,"../canvas/tilelayer.js":187,"../type.js":192,"../vector.js":193,rbush:258}],190:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_imagestate2=_interopRequireDefault(require("../imagestate.js")),_observable2=_interopRequireDefault(require("../observable.js")),_tilestate2=_interopRequireDefault(require("../tilestate.js")),_asserts2=_interopRequireDefault(require("../asserts.js")),_events2=_interopRequireDefault(require("../events.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_functions2=_interopRequireDefault(require("../functions.js")),_state2=_interopRequireDefault(require("../source/state.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_Layer_=function(layer){_observable2.default.call(this),this.layer_=layer};_index2.default.inherits(_ol_renderer_Layer_,_observable2.default),_ol_renderer_Layer_.prototype.forEachFeatureAtCoordinate=_index2.default.nullFunction,_ol_renderer_Layer_.prototype.hasFeatureAtCoordinate=_functions2.default.FALSE,_ol_renderer_Layer_.prototype.createLoadedTileFinder=function(source,projection,tiles){return function(zoom,tileRange){return source.forEachLoadedTile(projection,zoom,tileRange,function(tile){tiles[zoom]||(tiles[zoom]={}),tiles[zoom][tile.tileCoord.toString()]=tile})}},_ol_renderer_Layer_.prototype.getLayer=function(){return this.layer_},_ol_renderer_Layer_.prototype.handleImageChange_=function(event){event.target.getState()===_imagestate2.default.LOADED&&this.renderIfReadyAndVisible()},_ol_renderer_Layer_.prototype.loadImage=function(image){var imageState=image.getState();return imageState!=_imagestate2.default.LOADED&&imageState!=_imagestate2.default.ERROR&&_events2.default.listen(image,_eventtype2.default.CHANGE,this.handleImageChange_,this),imageState==_imagestate2.default.IDLE&&(image.load(),imageState=image.getState()),imageState==_imagestate2.default.LOADED},_ol_renderer_Layer_.prototype.renderIfReadyAndVisible=function(){var layer=this.getLayer();layer.getVisible()&&layer.getSourceState()==_state2.default.READY&&this.changed()},_ol_renderer_Layer_.prototype.scheduleExpireCache=function(frameState,tileSource){if(tileSource.canExpireCache()){var postRenderFunction=function(tileSource,map,frameState){var tileSourceKey=_index2.default.getUid(tileSource).toString();tileSourceKey in frameState.usedTiles&&tileSource.expireCache(frameState.viewState.projection,frameState.usedTiles[tileSourceKey])}.bind(null,tileSource);frameState.postRenderFunctions.push(postRenderFunction)}},_ol_renderer_Layer_.prototype.updateLogos=function(frameState,source){var logo=source.getLogo();void 0!==logo&&("string"==typeof logo?frameState.logos[logo]="":logo&&(_asserts2.default.assert("string"==typeof logo.href,44),_asserts2.default.assert("string"==typeof logo.src,45),frameState.logos[logo.src]=logo.href))},_ol_renderer_Layer_.prototype.updateUsedTiles=function(usedTiles,tileSource,z,tileRange){var tileSourceKey=_index2.default.getUid(tileSource).toString(),zKey=z.toString();tileSourceKey in usedTiles?zKey in usedTiles[tileSourceKey]?usedTiles[tileSourceKey][zKey].extend(tileRange):usedTiles[tileSourceKey][zKey]=tileRange:(usedTiles[tileSourceKey]={},usedTiles[tileSourceKey][zKey]=tileRange)},_ol_renderer_Layer_.prototype.manageTilePyramid=function(frameState,tileSource,tileGrid,pixelRatio,projection,extent,currentZ,preload,opt_tileCallback,opt_this){var tileSourceKey=_index2.default.getUid(tileSource).toString();tileSourceKey in frameState.wantedTiles||(frameState.wantedTiles[tileSourceKey]={});var tile,tileRange,tileResolution,x,y,z,wantedTiles=frameState.wantedTiles[tileSourceKey],tileQueue=frameState.tileQueue;for(z=tileGrid.getMinZoom();z<=currentZ;++z)for(tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z,tileRange),tileResolution=tileGrid.getResolution(z),x=tileRange.minX;x<=tileRange.maxX;++x)for(y=tileRange.minY;y<=tileRange.maxY;++y)currentZ-z<=preload?((tile=tileSource.getTile(z,x,y,pixelRatio,projection)).getState()==_tilestate2.default.IDLE&&(wantedTiles[tile.getKey()]=!0,tileQueue.isKeyQueued(tile.getKey())||tileQueue.enqueue([tile,tileSourceKey,tileGrid.getTileCoordCenter(tile.tileCoord),tileResolution])),void 0!==opt_tileCallback&&opt_tileCallback.call(opt_this,tile)):tileSource.useTile(z,x,y,projection)},exports.default=_ol_renderer_Layer_},{"../asserts.js":31,"../events.js":48,"../events/eventtype.js":52,"../functions.js":60,"../imagestate.js":88,"../index.js":89,"../observable.js":127,"../source/state.js":212,"../tilestate.js":242}],191:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_disposable2=_interopRequireDefault(require("../disposable.js")),_events2=_interopRequireDefault(require("../events.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_extent2=_interopRequireDefault(require("../extent.js")),_functions2=_interopRequireDefault(require("../functions.js")),_layer2=_interopRequireDefault(require("../layer/layer.js")),_plugins2=_interopRequireDefault(require("../plugins.js")),_style2=_interopRequireDefault(require("../style.js")),_transform2=_interopRequireDefault(require("../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_Map_=function(container,map){_disposable2.default.call(this),this.map_=map,this.layerRenderers_={},this.layerRendererListeners_={}};_index2.default.inherits(_ol_renderer_Map_,_disposable2.default),_ol_renderer_Map_.prototype.calculateMatrices2D=function(frameState){var viewState=frameState.viewState,coordinateToPixelTransform=frameState.coordinateToPixelTransform,pixelToCoordinateTransform=frameState.pixelToCoordinateTransform;_transform2.default.compose(coordinateToPixelTransform,frameState.size[0]/2,frameState.size[1]/2,1/viewState.resolution,-1/viewState.resolution,-viewState.rotation,-viewState.center[0],-viewState.center[1]),_transform2.default.invert(_transform2.default.setFromArray(pixelToCoordinateTransform,coordinateToPixelTransform))},_ol_renderer_Map_.prototype.removeLayerRenderers=function(){for(var key in this.layerRenderers_)this.removeLayerRendererByKey_(key).dispose()},_ol_renderer_Map_.expireIconCache_=function(map,frameState){_style2.default.iconImageCache.expire()},_ol_renderer_Map_.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg,layerFilter,thisArg2){var result,viewState=frameState.viewState,viewResolution=viewState.resolution;function forEachFeatureAtCoordinate(feature,layer){var key=_index2.default.getUid(feature).toString(),managed=frameState.layerStates[_index2.default.getUid(layer)].managed;if(!(key in frameState.skippedFeatureUids)||managed)return callback.call(thisArg,feature,managed?layer:null)}var projection=viewState.projection,translatedCoordinate=coordinate;if(projection.canWrapX()){var projectionExtent=projection.getExtent(),worldWidth=_extent2.default.getWidth(projectionExtent),x=coordinate[0];if(x<projectionExtent[0]||x>projectionExtent[2])translatedCoordinate=[x+worldWidth*Math.ceil((projectionExtent[0]-x)/worldWidth),coordinate[1]]}var i,layerStates=frameState.layerStatesArray;for(i=layerStates.length-1;0<=i;--i){var layerState=layerStates[i],layer=layerState.layer;if(_layer2.default.visibleAtResolution(layerState,viewResolution)&&layerFilter.call(thisArg2,layer)){var layerRenderer=this.getLayerRenderer(layer);if(layer.getSource()&&(result=layerRenderer.forEachFeatureAtCoordinate(layer.getSource().getWrapX()?translatedCoordinate:coordinate,frameState,hitTolerance,forEachFeatureAtCoordinate,thisArg)),result)return result}}},_ol_renderer_Map_.prototype.forEachLayerAtPixel=function(pixel,frameState,callback,thisArg,layerFilter,thisArg2){},_ol_renderer_Map_.prototype.hasFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,layerFilter,thisArg){return void 0!==this.forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,_functions2.default.TRUE,this,layerFilter,thisArg)},_ol_renderer_Map_.prototype.getLayerRenderer=function(layer){var layerKey=_index2.default.getUid(layer).toString();if(layerKey in this.layerRenderers_)return this.layerRenderers_[layerKey];for(var renderer,layerRendererPlugins=_plugins2.default.getLayerRendererPlugins(),type=this.getType(),i=0,ii=layerRendererPlugins.length;i<ii;++i){var plugin=layerRendererPlugins[i];if(plugin.handles(type,layer)){renderer=plugin.create(this,layer);break}}if(!renderer)throw new Error("Unable to create renderer for layer: "+layer.getType());return this.layerRenderers_[layerKey]=renderer,this.layerRendererListeners_[layerKey]=_events2.default.listen(renderer,_eventtype2.default.CHANGE,this.handleLayerRendererChange_,this),renderer},_ol_renderer_Map_.prototype.getLayerRendererByKey=function(layerKey){return this.layerRenderers_[layerKey]},_ol_renderer_Map_.prototype.getLayerRenderers=function(){return this.layerRenderers_},_ol_renderer_Map_.prototype.getMap=function(){return this.map_},_ol_renderer_Map_.prototype.getType=function(){},_ol_renderer_Map_.prototype.handleLayerRendererChange_=function(){this.map_.render()},_ol_renderer_Map_.prototype.removeLayerRendererByKey_=function(layerKey){var layerRenderer=this.layerRenderers_[layerKey];return delete this.layerRenderers_[layerKey],_events2.default.unlistenByKey(this.layerRendererListeners_[layerKey]),delete this.layerRendererListeners_[layerKey],layerRenderer},_ol_renderer_Map_.prototype.renderFrame=_index2.default.nullFunction,_ol_renderer_Map_.prototype.removeUnusedLayerRenderers_=function(map,frameState){var layerKey;for(layerKey in this.layerRenderers_)frameState&&layerKey in frameState.layerStates||this.removeLayerRendererByKey_(layerKey).dispose()},_ol_renderer_Map_.prototype.scheduleExpireIconCache=function(frameState){frameState.postRenderFunctions.push(_ol_renderer_Map_.expireIconCache_)},_ol_renderer_Map_.prototype.scheduleRemoveUnusedLayerRenderers=function(frameState){var layerKey;for(layerKey in this.layerRenderers_)if(!(layerKey in frameState.layerStates))return void frameState.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this))},_ol_renderer_Map_.sortByZIndex=function(state1,state2){return state1.zIndex-state2.zIndex},exports.default=_ol_renderer_Map_},{"../disposable.js":45,"../events.js":48,"../events/eventtype.js":52,"../extent.js":54,"../functions.js":60,"../index.js":89,"../layer/layer.js":108,"../plugins.js":131,"../style.js":221,"../transform.js":243}],192:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={CANVAS:"canvas",WEBGL:"webgl"}},{}],193:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_imagestate2=_interopRequireDefault(require("../imagestate.js")),_geometrytype2=_interopRequireDefault(require("../geom/geometrytype.js")),_replaytype2=_interopRequireDefault(require("../render/replaytype.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_vector_={defaultOrder:function(feature1,feature2){return _index2.default.getUid(feature1)-_index2.default.getUid(feature2)},getSquaredTolerance:function(resolution,pixelRatio){var tolerance=_ol_renderer_vector_.getTolerance(resolution,pixelRatio);return tolerance*tolerance},getTolerance:function(resolution,pixelRatio){return _index2.default.SIMPLIFY_TOLERANCE*resolution/pixelRatio},renderCircleGeometry_:function(replayGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(fillStyle||strokeStyle){var circleReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.CIRCLE);circleReplay.setFillStrokeStyle(fillStyle,strokeStyle),circleReplay.drawCircle(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}},renderFeature:function(replayGroup,feature,style,squaredTolerance,listener,thisArg){var imageStyle,imageState,loading=!1;return(imageStyle=style.getImage())&&((imageState=imageStyle.getImageState())==_imagestate2.default.LOADED||imageState==_imagestate2.default.ERROR?imageStyle.unlistenImageChange(listener,thisArg):(imageState==_imagestate2.default.IDLE&&imageStyle.load(),imageState=imageStyle.getImageState(),imageStyle.listenImageChange(listener,thisArg),loading=!0)),_ol_renderer_vector_.renderFeature_(replayGroup,feature,style,squaredTolerance),loading},renderFeature_:function(replayGroup,feature,style,squaredTolerance){var geometry=style.getGeometryFunction()(feature);if(geometry){var simplifiedGeometry=geometry.getSimplifiedGeometry(squaredTolerance);if(style.getRenderer())_ol_renderer_vector_.renderGeometry_(replayGroup,simplifiedGeometry,style,feature);else(0,_ol_renderer_vector_.GEOMETRY_RENDERERS_[simplifiedGeometry.getType()])(replayGroup,simplifiedGeometry,style,feature)}},renderGeometry_:function(replayGroup,geometry,style,feature){if(geometry.getType()!=_geometrytype2.default.GEOMETRY_COLLECTION)replayGroup.getReplay(style.getZIndex(),_replaytype2.default.DEFAULT).drawCustom(geometry,feature,style.getRenderer());else for(var geometries=geometry.getGeometries(),i=0,ii=geometries.length;i<ii;++i)_ol_renderer_vector_.renderGeometry_(replayGroup,geometries[i],style,feature)},renderGeometryCollectionGeometry_:function(replayGroup,geometry,style,feature){var i,ii,geometries=geometry.getGeometriesArray();for(i=0,ii=geometries.length;i<ii;++i){(0,_ol_renderer_vector_.GEOMETRY_RENDERERS_[geometries[i].getType()])(replayGroup,geometries[i],style,feature)}},renderLineStringGeometry_:function(replayGroup,geometry,style,feature){var strokeStyle=style.getStroke();if(strokeStyle){var lineStringReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.LINE_STRING);lineStringReplay.setFillStrokeStyle(null,strokeStyle),lineStringReplay.drawLineString(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}},renderMultiLineStringGeometry_:function(replayGroup,geometry,style,feature){var strokeStyle=style.getStroke();if(strokeStyle){var lineStringReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.LINE_STRING);lineStringReplay.setFillStrokeStyle(null,strokeStyle),lineStringReplay.drawMultiLineString(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}},renderMultiPolygonGeometry_:function(replayGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(strokeStyle||fillStyle){var polygonReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.POLYGON);polygonReplay.setFillStrokeStyle(fillStyle,strokeStyle),polygonReplay.drawMultiPolygon(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}},renderPointGeometry_:function(replayGroup,geometry,style,feature){var imageStyle=style.getImage();if(imageStyle){if(imageStyle.getImageState()!=_imagestate2.default.LOADED)return;var imageReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.IMAGE);imageReplay.setImageStyle(imageStyle,replayGroup.addDeclutter(!1)),imageReplay.drawPoint(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!!imageStyle)),textReplay.drawText(geometry,feature)}},renderMultiPointGeometry_:function(replayGroup,geometry,style,feature){var imageStyle=style.getImage();if(imageStyle){if(imageStyle.getImageState()!=_imagestate2.default.LOADED)return;var imageReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.IMAGE);imageReplay.setImageStyle(imageStyle,replayGroup.addDeclutter(!1)),imageReplay.drawMultiPoint(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!!imageStyle)),textReplay.drawText(geometry,feature)}},renderPolygonGeometry_:function(replayGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(fillStyle||strokeStyle){var polygonReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.POLYGON);polygonReplay.setFillStrokeStyle(fillStyle,strokeStyle),polygonReplay.drawPolygon(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),_replaytype2.default.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}};_ol_renderer_vector_.GEOMETRY_RENDERERS_={Point:_ol_renderer_vector_.renderPointGeometry_,LineString:_ol_renderer_vector_.renderLineStringGeometry_,Polygon:_ol_renderer_vector_.renderPolygonGeometry_,MultiPoint:_ol_renderer_vector_.renderMultiPointGeometry_,MultiLineString:_ol_renderer_vector_.renderMultiLineStringGeometry_,MultiPolygon:_ol_renderer_vector_.renderMultiPolygonGeometry_,GeometryCollection:_ol_renderer_vector_.renderGeometryCollectionGeometry_,Circle:_ol_renderer_vector_.renderCircleGeometry_},exports.default=_ol_renderer_vector_},{"../geom/geometrytype.js":79,"../imagestate.js":88,"../index.js":89,"../render/replaytype.js":163}],194:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_fragment2=_interopRequireDefault(require("../../webgl/fragment.js")),_vertex2=_interopRequireDefault(require("../../webgl/vertex.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_webgl_defaultmapshader_={};_ol_renderer_webgl_defaultmapshader_.fragment=new _fragment2.default(_index2.default.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform float u_opacity;\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_texture, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  gl_FragColor.a = texColor.a * u_opacity;\n}\n":"precision mediump float;varying vec2 a;uniform float f;uniform sampler2D g;void main(void){vec4 texColor=texture2D(g,a);gl_FragColor.rgb=texColor.rgb;gl_FragColor.a=texColor.a*f;}"),_ol_renderer_webgl_defaultmapshader_.vertex=new _vertex2.default(_index2.default.DEBUG_WEBGL?"varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat4 u_texCoordMatrix;\nuniform mat4 u_projectionMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\n}\n\n\n":"varying vec2 a;attribute vec2 b;attribute vec2 c;uniform mat4 d;uniform mat4 e;void main(void){gl_Position=e*vec4(b,0.,1.);a=(d*vec4(c,0.,1.)).st;}"),exports.default=_ol_renderer_webgl_defaultmapshader_},{"../../index.js":89,"../../webgl/fragment.js":252,"../../webgl/vertex.js":254}],195:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_index=require("../../../index.js"),_index2=(obj=_index)&&obj.__esModule?obj:{default:obj};exports.default=function(gl,program){this.u_texCoordMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_texCoordMatrix":"d"),this.u_projectionMatrix=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_projectionMatrix":"e"),this.u_opacity=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_opacity":"f"),this.u_texture=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_texture":"g"),this.a_position=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_position":"b"),this.a_texCoord=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_texCoord":"c")}},{"../../../index.js":89}],196:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_layertype2=_interopRequireDefault(require("../../layertype.js")),_viewhint2=_interopRequireDefault(require("../../viewhint.js")),_dom2=_interopRequireDefault(require("../../dom.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_functions2=_interopRequireDefault(require("../../functions.js")),_type2=_interopRequireDefault(require("../type.js")),_layer2=_interopRequireDefault(require("../webgl/layer.js")),_transform2=_interopRequireDefault(require("../../transform.js")),_webgl2=_interopRequireDefault(require("../../webgl.js")),_context2=_interopRequireDefault(require("../../webgl/context.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_webgl_ImageLayer_=function(mapRenderer,imageLayer){_layer2.default.call(this,mapRenderer,imageLayer),this.image_=null,this.hitCanvasContext_=null,this.hitTransformationMatrix_=null};_index2.default.inherits(_ol_renderer_webgl_ImageLayer_,_layer2.default),_ol_renderer_webgl_ImageLayer_.handles=function(type,layer){return type===_type2.default.WEBGL&&layer.getType()===_layertype2.default.IMAGE},_ol_renderer_webgl_ImageLayer_.create=function(mapRenderer,layer){return new _ol_renderer_webgl_ImageLayer_(mapRenderer,layer)},_ol_renderer_webgl_ImageLayer_.prototype.createTexture_=function(image){var imageElement=image.getImage(),gl=this.mapRenderer.getGL();return _context2.default.createTexture(gl,imageElement,_webgl2.default.CLAMP_TO_EDGE,_webgl2.default.CLAMP_TO_EDGE)},_ol_renderer_webgl_ImageLayer_.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){var layer=this.getLayer(),source=layer.getSource(),resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation,skippedFeatureUids=frameState.skippedFeatureUids;return source.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,skippedFeatureUids,function(feature){return callback.call(thisArg,feature,layer)})},_ol_renderer_webgl_ImageLayer_.prototype.prepareFrame=function(frameState,layerState,context){var gl=this.mapRenderer.getGL(),pixelRatio=frameState.pixelRatio,viewState=frameState.viewState,viewCenter=viewState.center,viewResolution=viewState.resolution,viewRotation=viewState.rotation,image=this.image_,texture=this.texture,imageSource=this.getLayer().getSource(),hints=frameState.viewHints,renderedExtent=frameState.extent;if(void 0!==layerState.extent&&(renderedExtent=_extent2.default.getIntersection(renderedExtent,layerState.extent)),!hints[_viewhint2.default.ANIMATING]&&!hints[_viewhint2.default.INTERACTING]&&!_extent2.default.isEmpty(renderedExtent)){var projection=viewState.projection;if(!_index2.default.ENABLE_RASTER_REPROJECTION){var sourceProjection=imageSource.getProjection();sourceProjection&&(projection=sourceProjection)}var image_=imageSource.getImage(renderedExtent,viewResolution,pixelRatio,projection);if(image_)if(this.loadImage(image_)&&(image=image_,texture=this.createTexture_(image_),this.texture)){var postRenderFunction=function(gl,texture){gl.isContextLost()||gl.deleteTexture(texture)}.bind(null,gl,this.texture);frameState.postRenderFunctions.push(postRenderFunction)}}if(image){var canvas=this.mapRenderer.getContext().getCanvas();this.updateProjectionMatrix_(canvas.width,canvas.height,pixelRatio,viewCenter,viewResolution,viewRotation,image.getExtent()),this.hitTransformationMatrix_=null;var texCoordMatrix=this.texCoordMatrix;_transform2.default.reset(texCoordMatrix),_transform2.default.scale(texCoordMatrix,1,-1),_transform2.default.translate(texCoordMatrix,0,-1),this.image_=image,this.texture=texture,this.updateLogos(frameState,imageSource)}return!!image},_ol_renderer_webgl_ImageLayer_.prototype.updateProjectionMatrix_=function(canvasWidth,canvasHeight,pixelRatio,viewCenter,viewResolution,viewRotation,imageExtent){var canvasExtentWidth=canvasWidth*viewResolution,canvasExtentHeight=canvasHeight*viewResolution,projectionMatrix=this.projectionMatrix;_transform2.default.reset(projectionMatrix),_transform2.default.scale(projectionMatrix,2*pixelRatio/canvasExtentWidth,2*pixelRatio/canvasExtentHeight),_transform2.default.rotate(projectionMatrix,-viewRotation),_transform2.default.translate(projectionMatrix,imageExtent[0]-viewCenter[0],imageExtent[1]-viewCenter[1]),_transform2.default.scale(projectionMatrix,(imageExtent[2]-imageExtent[0])/2,(imageExtent[3]-imageExtent[1])/2),_transform2.default.translate(projectionMatrix,1,1)},_ol_renderer_webgl_ImageLayer_.prototype.hasFeatureAtCoordinate=function(coordinate,frameState){return void 0!==this.forEachFeatureAtCoordinate(coordinate,frameState,0,_functions2.default.TRUE,this)},_ol_renderer_webgl_ImageLayer_.prototype.forEachLayerAtPixel=function(pixel,frameState,callback,thisArg){if(this.image_&&this.image_.getImage()){if(this.getLayer().getSource().forEachFeatureAtCoordinate!==_index2.default.nullFunction){var coordinate=_transform2.default.apply(frameState.pixelToCoordinateTransform,pixel.slice());return this.forEachFeatureAtCoordinate(coordinate,frameState,0,_functions2.default.TRUE,this)?callback.call(thisArg,this.getLayer(),null):void 0}var imageSize=[this.image_.getImage().width,this.image_.getImage().height];this.hitTransformationMatrix_||(this.hitTransformationMatrix_=this.getHitTransformationMatrix_(frameState.size,imageSize));var pixelOnFrameBuffer=_transform2.default.apply(this.hitTransformationMatrix_,pixel.slice());if(!(pixelOnFrameBuffer[0]<0||pixelOnFrameBuffer[0]>imageSize[0]||pixelOnFrameBuffer[1]<0||pixelOnFrameBuffer[1]>imageSize[1])){this.hitCanvasContext_||(this.hitCanvasContext_=_dom2.default.createCanvasContext2D(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.image_.getImage(),pixelOnFrameBuffer[0],pixelOnFrameBuffer[1],1,1,0,0,1,1);var imageData=this.hitCanvasContext_.getImageData(0,0,1,1).data;return 0<imageData[3]?callback.call(thisArg,this.getLayer(),imageData):void 0}}},_ol_renderer_webgl_ImageLayer_.prototype.getHitTransformationMatrix_=function(mapSize,imageSize){var mapCoordTransform=_transform2.default.create();_transform2.default.translate(mapCoordTransform,-1,-1),_transform2.default.scale(mapCoordTransform,2/mapSize[0],2/mapSize[1]),_transform2.default.translate(mapCoordTransform,0,mapSize[1]),_transform2.default.scale(mapCoordTransform,1,-1);var projectionMatrixInv=_transform2.default.invert(this.projectionMatrix.slice()),transform=_transform2.default.create();return _transform2.default.translate(transform,0,imageSize[1]),_transform2.default.scale(transform,1,-1),_transform2.default.scale(transform,imageSize[0]/2,imageSize[1]/2),_transform2.default.translate(transform,1,1),_transform2.default.multiply(transform,projectionMatrixInv),_transform2.default.multiply(transform,mapCoordTransform),transform},exports.default=_ol_renderer_webgl_ImageLayer_},{"../../dom.js":46,"../../extent.js":54,"../../functions.js":60,"../../index.js":89,"../../layertype.js":113,"../../transform.js":243,"../../viewhint.js":246,"../../webgl.js":248,"../../webgl/context.js":250,"../type.js":192,"../webgl/layer.js":197}],197:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_event2=_interopRequireDefault(require("../../render/event.js")),_eventtype2=_interopRequireDefault(require("../../render/eventtype.js")),_immediate2=_interopRequireDefault(require("../../render/webgl/immediate.js")),_layer2=_interopRequireDefault(require("../layer.js")),_defaultmapshader2=_interopRequireDefault(require("../webgl/defaultmapshader.js")),_locations2=_interopRequireDefault(require("../webgl/defaultmapshader/locations.js")),_transform2=_interopRequireDefault(require("../../transform.js")),_mat2=_interopRequireDefault(require("../../vec/mat4.js")),_webgl2=_interopRequireDefault(require("../../webgl.js")),_buffer2=_interopRequireDefault(require("../../webgl/buffer.js")),_context2=_interopRequireDefault(require("../../webgl/context.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_webgl_Layer_=function(mapRenderer,layer){_layer2.default.call(this,layer),this.mapRenderer=mapRenderer,this.arrayBuffer_=new _buffer2.default([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),this.texture=null,this.framebuffer=null,this.framebufferDimension=void 0,this.texCoordMatrix=_transform2.default.create(),this.projectionMatrix=_transform2.default.create(),this.tmpMat4_=_mat2.default.create(),this.defaultLocations_=null};_index2.default.inherits(_ol_renderer_webgl_Layer_,_layer2.default),_ol_renderer_webgl_Layer_.prototype.bindFramebuffer=function(frameState,framebufferDimension){var gl=this.mapRenderer.getGL();if(void 0===this.framebufferDimension||this.framebufferDimension!=framebufferDimension){var postRenderFunction=function(gl,framebuffer,texture){gl.isContextLost()||(gl.deleteFramebuffer(framebuffer),gl.deleteTexture(texture))}.bind(null,gl,this.framebuffer,this.texture);frameState.postRenderFunctions.push(postRenderFunction);var texture=_context2.default.createEmptyTexture(gl,framebufferDimension,framebufferDimension),framebuffer=gl.createFramebuffer();gl.bindFramebuffer(_webgl2.default.FRAMEBUFFER,framebuffer),gl.framebufferTexture2D(_webgl2.default.FRAMEBUFFER,_webgl2.default.COLOR_ATTACHMENT0,_webgl2.default.TEXTURE_2D,texture,0),this.texture=texture,this.framebuffer=framebuffer,this.framebufferDimension=framebufferDimension}else gl.bindFramebuffer(_webgl2.default.FRAMEBUFFER,this.framebuffer)},_ol_renderer_webgl_Layer_.prototype.composeFrame=function(frameState,layerState,context){this.dispatchComposeEvent_(_eventtype2.default.PRECOMPOSE,context,frameState),context.bindBuffer(_webgl2.default.ARRAY_BUFFER,this.arrayBuffer_);var locations,gl=context.getGL(),fragmentShader=_defaultmapshader2.default.fragment,vertexShader=_defaultmapshader2.default.vertex,program=context.getProgram(fragmentShader,vertexShader);this.defaultLocations_?locations=this.defaultLocations_:(locations=new _locations2.default(gl,program),this.defaultLocations_=locations),context.useProgram(program)&&(gl.enableVertexAttribArray(locations.a_position),gl.vertexAttribPointer(locations.a_position,2,_webgl2.default.FLOAT,!1,16,0),gl.enableVertexAttribArray(locations.a_texCoord),gl.vertexAttribPointer(locations.a_texCoord,2,_webgl2.default.FLOAT,!1,16,8),gl.uniform1i(locations.u_texture,0)),gl.uniformMatrix4fv(locations.u_texCoordMatrix,!1,_mat2.default.fromTransform(this.tmpMat4_,this.getTexCoordMatrix())),gl.uniformMatrix4fv(locations.u_projectionMatrix,!1,_mat2.default.fromTransform(this.tmpMat4_,this.getProjectionMatrix())),gl.uniform1f(locations.u_opacity,layerState.opacity),gl.bindTexture(_webgl2.default.TEXTURE_2D,this.getTexture()),gl.drawArrays(_webgl2.default.TRIANGLE_STRIP,0,4),this.dispatchComposeEvent_(_eventtype2.default.POSTCOMPOSE,context,frameState)},_ol_renderer_webgl_Layer_.prototype.dispatchComposeEvent_=function(type,context,frameState){var layer=this.getLayer();if(layer.hasListener(type)){var viewState=frameState.viewState,resolution=viewState.resolution,pixelRatio=frameState.pixelRatio,extent=frameState.extent,center=viewState.center,rotation=viewState.rotation,size=frameState.size,render=new _immediate2.default(context,center,resolution,rotation,size,extent,pixelRatio),composeEvent=new _event2.default(type,render,frameState,null,context);layer.dispatchEvent(composeEvent)}},_ol_renderer_webgl_Layer_.prototype.getTexCoordMatrix=function(){return this.texCoordMatrix},_ol_renderer_webgl_Layer_.prototype.getTexture=function(){return this.texture},_ol_renderer_webgl_Layer_.prototype.getProjectionMatrix=function(){return this.projectionMatrix},_ol_renderer_webgl_Layer_.prototype.handleWebGLContextLost=function(){this.texture=null,this.framebuffer=null,this.framebufferDimension=void 0},_ol_renderer_webgl_Layer_.prototype.prepareFrame=function(frameState,layerState,context){},_ol_renderer_webgl_Layer_.prototype.forEachLayerAtPixel=function(pixel,frameState,callback,thisArg){},exports.default=_ol_renderer_webgl_Layer_},{"../../index.js":89,"../../render/event.js":159,"../../render/eventtype.js":160,"../../render/webgl/immediate.js":170,"../../transform.js":243,"../../vec/mat4.js":244,"../../webgl.js":248,"../../webgl/buffer.js":249,"../../webgl/context.js":250,"../layer.js":190,"../webgl/defaultmapshader.js":194,"../webgl/defaultmapshader/locations.js":195}],198:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_array2=_interopRequireDefault(require("../../array.js")),_css2=_interopRequireDefault(require("../../css.js")),_dom2=_interopRequireDefault(require("../../dom.js")),_events2=_interopRequireDefault(require("../../events.js")),_has2=_interopRequireDefault(require("../../has.js")),_layer2=_interopRequireDefault(require("../../layer/layer.js")),_event2=_interopRequireDefault(require("../../render/event.js")),_eventtype2=_interopRequireDefault(require("../../render/eventtype.js")),_immediate2=_interopRequireDefault(require("../../render/webgl/immediate.js")),_map2=_interopRequireDefault(require("../map.js")),_type2=_interopRequireDefault(require("../type.js")),_state2=_interopRequireDefault(require("../../source/state.js")),_lrucache2=_interopRequireDefault(require("../../structs/lrucache.js")),_priorityqueue2=_interopRequireDefault(require("../../structs/priorityqueue.js")),_webgl2=_interopRequireDefault(require("../../webgl.js")),_context2=_interopRequireDefault(require("../../webgl/context.js")),_contexteventtype2=_interopRequireDefault(require("../../webgl/contexteventtype.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_webgl_Map_=function(container,map){_map2.default.call(this,container,map),this.canvas_=document.createElement("CANVAS"),this.canvas_.style.width="100%",this.canvas_.style.height="100%",this.canvas_.style.display="block",this.canvas_.className=_css2.default.CLASS_UNSELECTABLE,container.insertBefore(this.canvas_,container.childNodes[0]||null),this.clipTileCanvasWidth_=0,this.clipTileCanvasHeight_=0,this.clipTileContext_=_dom2.default.createCanvasContext2D(),this.renderedVisible_=!0,this.gl_=_webgl2.default.getContext(this.canvas_,{antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0}),this.context_=new _context2.default(this.canvas_,this.gl_),_events2.default.listen(this.canvas_,_contexteventtype2.default.LOST,this.handleWebGLContextLost,this),_events2.default.listen(this.canvas_,_contexteventtype2.default.RESTORED,this.handleWebGLContextRestored,this),this.textureCache_=new _lrucache2.default,this.focus_=null,this.tileTextureQueue_=new _priorityqueue2.default(function(element){var tileCenter=element[1],tileResolution=element[2],deltaX=tileCenter[0]-this.focus_[0],deltaY=tileCenter[1]-this.focus_[1];return 65536*Math.log(tileResolution)+Math.sqrt(deltaX*deltaX+deltaY*deltaY)/tileResolution}.bind(this),function(element){return element[0].getKey()}),this.loadNextTileTexture_=function(map,frameState){if(!this.tileTextureQueue_.isEmpty()){this.tileTextureQueue_.reprioritize();var element=this.tileTextureQueue_.dequeue(),tile=element[0],tileSize=element[3],tileGutter=element[4];this.bindTileTexture(tile,tileSize,tileGutter,_webgl2.default.LINEAR,_webgl2.default.LINEAR)}return!1}.bind(this),this.textureCacheFrameMarkerCount_=0,this.initializeGL_()};_index2.default.inherits(_ol_renderer_webgl_Map_,_map2.default),_ol_renderer_webgl_Map_.handles=function(type){return _has2.default.WEBGL&&type===_type2.default.WEBGL},_ol_renderer_webgl_Map_.create=function(container,map){return new _ol_renderer_webgl_Map_(container,map)},_ol_renderer_webgl_Map_.prototype.bindTileTexture=function(tile,tileSize,tileGutter,magFilter,minFilter){var gl=this.getGL(),tileKey=tile.getKey();if(this.textureCache_.containsKey(tileKey)){var textureCacheEntry=this.textureCache_.get(tileKey);gl.bindTexture(_webgl2.default.TEXTURE_2D,textureCacheEntry.texture),textureCacheEntry.magFilter!=magFilter&&(gl.texParameteri(_webgl2.default.TEXTURE_2D,_webgl2.default.TEXTURE_MAG_FILTER,magFilter),textureCacheEntry.magFilter=magFilter),textureCacheEntry.minFilter!=minFilter&&(gl.texParameteri(_webgl2.default.TEXTURE_2D,_webgl2.default.TEXTURE_MIN_FILTER,minFilter),textureCacheEntry.minFilter=minFilter)}else{var texture=gl.createTexture();if(gl.bindTexture(_webgl2.default.TEXTURE_2D,texture),0<tileGutter){var clipTileCanvas=this.clipTileContext_.canvas,clipTileContext=this.clipTileContext_;this.clipTileCanvasWidth_!==tileSize[0]||this.clipTileCanvasHeight_!==tileSize[1]?(clipTileCanvas.width=tileSize[0],clipTileCanvas.height=tileSize[1],this.clipTileCanvasWidth_=tileSize[0],this.clipTileCanvasHeight_=tileSize[1]):clipTileContext.clearRect(0,0,tileSize[0],tileSize[1]),clipTileContext.drawImage(tile.getImage(),tileGutter,tileGutter,tileSize[0],tileSize[1],0,0,tileSize[0],tileSize[1]),gl.texImage2D(_webgl2.default.TEXTURE_2D,0,_webgl2.default.RGBA,_webgl2.default.RGBA,_webgl2.default.UNSIGNED_BYTE,clipTileCanvas)}else gl.texImage2D(_webgl2.default.TEXTURE_2D,0,_webgl2.default.RGBA,_webgl2.default.RGBA,_webgl2.default.UNSIGNED_BYTE,tile.getImage());gl.texParameteri(_webgl2.default.TEXTURE_2D,_webgl2.default.TEXTURE_MAG_FILTER,magFilter),gl.texParameteri(_webgl2.default.TEXTURE_2D,_webgl2.default.TEXTURE_MIN_FILTER,minFilter),gl.texParameteri(_webgl2.default.TEXTURE_2D,_webgl2.default.TEXTURE_WRAP_S,_webgl2.default.CLAMP_TO_EDGE),gl.texParameteri(_webgl2.default.TEXTURE_2D,_webgl2.default.TEXTURE_WRAP_T,_webgl2.default.CLAMP_TO_EDGE),this.textureCache_.set(tileKey,{texture:texture,magFilter:magFilter,minFilter:minFilter})}},_ol_renderer_webgl_Map_.prototype.dispatchComposeEvent_=function(type,frameState){var map=this.getMap();if(map.hasListener(type)){var context=this.context_,extent=frameState.extent,size=frameState.size,viewState=frameState.viewState,pixelRatio=frameState.pixelRatio,resolution=viewState.resolution,center=viewState.center,rotation=viewState.rotation,vectorContext=new _immediate2.default(context,center,resolution,rotation,size,extent,pixelRatio),composeEvent=new _event2.default(type,vectorContext,frameState,null,context);map.dispatchEvent(composeEvent)}},_ol_renderer_webgl_Map_.prototype.disposeInternal=function(){var gl=this.getGL();gl.isContextLost()||this.textureCache_.forEach(function(textureCacheEntry){textureCacheEntry&&gl.deleteTexture(textureCacheEntry.texture)}),this.context_.dispose(),_map2.default.prototype.disposeInternal.call(this)},_ol_renderer_webgl_Map_.prototype.expireCache_=function(map,frameState){for(var textureCacheEntry,gl=this.getGL();this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>_index2.default.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK;){if(textureCacheEntry=this.textureCache_.peekLast())gl.deleteTexture(textureCacheEntry.texture);else{if(+this.textureCache_.peekLastKey()==frameState.index)break;--this.textureCacheFrameMarkerCount_}this.textureCache_.pop()}},_ol_renderer_webgl_Map_.prototype.getContext=function(){return this.context_},_ol_renderer_webgl_Map_.prototype.getGL=function(){return this.gl_},_ol_renderer_webgl_Map_.prototype.getTileTextureQueue=function(){return this.tileTextureQueue_},_ol_renderer_webgl_Map_.prototype.getType=function(){return _type2.default.WEBGL},_ol_renderer_webgl_Map_.prototype.handleWebGLContextLost=function(event){event.preventDefault(),this.textureCache_.clear(),this.textureCacheFrameMarkerCount_=0;var renderers=this.getLayerRenderers();for(var id in renderers){renderers[id].handleWebGLContextLost()}},_ol_renderer_webgl_Map_.prototype.handleWebGLContextRestored=function(){this.initializeGL_(),this.getMap().render()},_ol_renderer_webgl_Map_.prototype.initializeGL_=function(){var gl=this.gl_;gl.activeTexture(_webgl2.default.TEXTURE0),gl.blendFuncSeparate(_webgl2.default.SRC_ALPHA,_webgl2.default.ONE_MINUS_SRC_ALPHA,_webgl2.default.ONE,_webgl2.default.ONE_MINUS_SRC_ALPHA),gl.disable(_webgl2.default.CULL_FACE),gl.disable(_webgl2.default.DEPTH_TEST),gl.disable(_webgl2.default.SCISSOR_TEST),gl.disable(_webgl2.default.STENCIL_TEST)},_ol_renderer_webgl_Map_.prototype.isTileTextureLoaded=function(tile){return this.textureCache_.containsKey(tile.getKey())},_ol_renderer_webgl_Map_.prototype.renderFrame=function(frameState){var context=this.getContext(),gl=this.getGL();if(gl.isContextLost())return!1;if(!frameState)return this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1),!1;this.focus_=frameState.focus,this.textureCache_.set((-frameState.index).toString(),null),++this.textureCacheFrameMarkerCount_,this.dispatchComposeEvent_(_eventtype2.default.PRECOMPOSE,frameState);var layerStatesToDraw=[],layerStatesArray=frameState.layerStatesArray;_array2.default.stableSort(layerStatesArray,_map2.default.sortByZIndex);var i,ii,layerState,viewResolution=frameState.viewState.resolution;for(i=0,ii=layerStatesArray.length;i<ii;++i)layerState=layerStatesArray[i],_layer2.default.visibleAtResolution(layerState,viewResolution)&&layerState.sourceState==_state2.default.READY&&this.getLayerRenderer(layerState.layer).prepareFrame(frameState,layerState,context)&&layerStatesToDraw.push(layerState);var width=frameState.size[0]*frameState.pixelRatio,height=frameState.size[1]*frameState.pixelRatio;for(this.canvas_.width==width&&this.canvas_.height==height||(this.canvas_.width=width,this.canvas_.height=height),gl.bindFramebuffer(_webgl2.default.FRAMEBUFFER,null),gl.clearColor(0,0,0,0),gl.clear(_webgl2.default.COLOR_BUFFER_BIT),gl.enable(_webgl2.default.BLEND),gl.viewport(0,0,this.canvas_.width,this.canvas_.height),i=0,ii=layerStatesToDraw.length;i<ii;++i)layerState=layerStatesToDraw[i],this.getLayerRenderer(layerState.layer).composeFrame(frameState,layerState,context);this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0),this.calculateMatrices2D(frameState),this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>_index2.default.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK&&frameState.postRenderFunctions.push(this.expireCache_.bind(this)),this.tileTextureQueue_.isEmpty()||(frameState.postRenderFunctions.push(this.loadNextTileTexture_),frameState.animate=!0),this.dispatchComposeEvent_(_eventtype2.default.POSTCOMPOSE,frameState),this.scheduleRemoveUnusedLayerRenderers(frameState),this.scheduleExpireIconCache(frameState)},_ol_renderer_webgl_Map_.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg,layerFilter,thisArg2){var result;if(this.getGL().isContextLost())return!1;var i,viewState=frameState.viewState,layerStates=frameState.layerStatesArray;for(i=layerStates.length-1;0<=i;--i){var layerState=layerStates[i],layer=layerState.layer;if(_layer2.default.visibleAtResolution(layerState,viewState.resolution)&&layerFilter.call(thisArg2,layer))if(result=this.getLayerRenderer(layer).forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,callback,thisArg))return result}},_ol_renderer_webgl_Map_.prototype.hasFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,layerFilter,thisArg){var hasFeature=!1;if(this.getGL().isContextLost())return!1;var i,viewState=frameState.viewState,layerStates=frameState.layerStatesArray;for(i=layerStates.length-1;0<=i;--i){var layerState=layerStates[i],layer=layerState.layer;if(_layer2.default.visibleAtResolution(layerState,viewState.resolution)&&layerFilter.call(thisArg,layer))if(hasFeature=this.getLayerRenderer(layer).hasFeatureAtCoordinate(coordinate,frameState))return!0}return hasFeature},_ol_renderer_webgl_Map_.prototype.forEachLayerAtPixel=function(pixel,frameState,callback,thisArg,layerFilter,thisArg2){if(this.getGL().isContextLost())return!1;var result,i,viewState=frameState.viewState,layerStates=frameState.layerStatesArray;for(i=layerStates.length-1;0<=i;--i){var layerState=layerStates[i],layer=layerState.layer;if(_layer2.default.visibleAtResolution(layerState,viewState.resolution)&&layerFilter.call(thisArg,layer))if(result=this.getLayerRenderer(layer).forEachLayerAtPixel(pixel,frameState,callback,thisArg))return result}},exports.default=_ol_renderer_webgl_Map_},{"../../array.js":29,"../../css.js":44,"../../dom.js":46,"../../events.js":48,"../../has.js":84,"../../index.js":89,"../../layer/layer.js":108,"../../render/event.js":159,"../../render/eventtype.js":160,"../../render/webgl/immediate.js":170,"../../source/state.js":212,"../../structs/lrucache.js":218,"../../structs/priorityqueue.js":219,"../../webgl.js":248,"../../webgl/context.js":250,"../../webgl/contexteventtype.js":251,"../map.js":191,"../type.js":192}],199:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_layertype2=_interopRequireDefault(require("../../layertype.js")),_tilerange2=_interopRequireDefault(require("../../tilerange.js")),_tilestate2=_interopRequireDefault(require("../../tilestate.js")),_array2=_interopRequireDefault(require("../../array.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_math2=_interopRequireDefault(require("../../math.js")),_type2=_interopRequireDefault(require("../type.js")),_layer2=_interopRequireDefault(require("../webgl/layer.js")),_tilelayershader2=_interopRequireDefault(require("../webgl/tilelayershader.js")),_locations2=_interopRequireDefault(require("../webgl/tilelayershader/locations.js")),_size2=_interopRequireDefault(require("../../size.js")),_transform2=_interopRequireDefault(require("../../transform.js")),_webgl2=_interopRequireDefault(require("../../webgl.js")),_buffer2=_interopRequireDefault(require("../../webgl/buffer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_webgl_TileLayer_=function(mapRenderer,tileLayer){_layer2.default.call(this,mapRenderer,tileLayer),this.fragmentShader_=_tilelayershader2.default.fragment,this.vertexShader_=_tilelayershader2.default.vertex,this.locations_=null,this.renderArrayBuffer_=new _buffer2.default([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]),this.renderedTileRange_=null,this.renderedFramebufferExtent_=null,this.renderedRevision_=-1,this.tmpSize_=[0,0]};_index2.default.inherits(_ol_renderer_webgl_TileLayer_,_layer2.default),_ol_renderer_webgl_TileLayer_.handles=function(type,layer){return type===_type2.default.WEBGL&&layer.getType()===_layertype2.default.TILE},_ol_renderer_webgl_TileLayer_.create=function(mapRenderer,layer){return new _ol_renderer_webgl_TileLayer_(mapRenderer,layer)},_ol_renderer_webgl_TileLayer_.prototype.disposeInternal=function(){this.mapRenderer.getContext().deleteBuffer(this.renderArrayBuffer_),_layer2.default.prototype.disposeInternal.call(this)},_ol_renderer_webgl_TileLayer_.prototype.createLoadedTileFinder=function(source,projection,tiles){var mapRenderer=this.mapRenderer;return function(zoom,tileRange){return source.forEachLoadedTile(projection,zoom,tileRange,function(tile){var loaded=mapRenderer.isTileTextureLoaded(tile);return loaded&&(tiles[zoom]||(tiles[zoom]={}),tiles[zoom][tile.tileCoord.toString()]=tile),loaded})}},_ol_renderer_webgl_TileLayer_.prototype.handleWebGLContextLost=function(){_layer2.default.prototype.handleWebGLContextLost.call(this),this.locations_=null},_ol_renderer_webgl_TileLayer_.prototype.prepareFrame=function(frameState,layerState,context){var framebufferExtent,mapRenderer=this.mapRenderer,gl=context.getGL(),viewState=frameState.viewState,projection=viewState.projection,tileLayer=this.getLayer(),tileSource=tileLayer.getSource(),tileGrid=tileSource.getTileGridForProjection(projection),z=tileGrid.getZForResolution(viewState.resolution),tileResolution=tileGrid.getResolution(z),tilePixelSize=tileSource.getTilePixelSize(z,frameState.pixelRatio,projection),pixelRatio=tilePixelSize[0]/_size2.default.toSize(tileGrid.getTileSize(z),this.tmpSize_)[0],tilePixelResolution=tileResolution/pixelRatio,tileGutter=tileSource.getTilePixelRatio(pixelRatio)*tileSource.getGutter(projection),center=viewState.center,extent=frameState.extent,tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z);if(this.renderedTileRange_&&this.renderedTileRange_.equals(tileRange)&&this.renderedRevision_==tileSource.getRevision())framebufferExtent=this.renderedFramebufferExtent_;else{var tileRangeSize=tileRange.getSize(),maxDimension=Math.max(tileRangeSize[0]*tilePixelSize[0],tileRangeSize[1]*tilePixelSize[1]),framebufferDimension=_math2.default.roundUpToPowerOfTwo(maxDimension),framebufferExtentDimension=tilePixelResolution*framebufferDimension,origin=tileGrid.getOrigin(z),minX=origin[0]+tileRange.minX*tilePixelSize[0]*tilePixelResolution,minY=origin[1]+tileRange.minY*tilePixelSize[1]*tilePixelResolution;framebufferExtent=[minX,minY,minX+framebufferExtentDimension,minY+framebufferExtentDimension],this.bindFramebuffer(frameState,framebufferDimension),gl.viewport(0,0,framebufferDimension,framebufferDimension),gl.clearColor(0,0,0,0),gl.clear(_webgl2.default.COLOR_BUFFER_BIT),gl.disable(_webgl2.default.BLEND);var program=context.getProgram(this.fragmentShader_,this.vertexShader_);context.useProgram(program),this.locations_||(this.locations_=new _locations2.default(gl,program)),context.bindBuffer(_webgl2.default.ARRAY_BUFFER,this.renderArrayBuffer_),gl.enableVertexAttribArray(this.locations_.a_position),gl.vertexAttribPointer(this.locations_.a_position,2,_webgl2.default.FLOAT,!1,16,0),gl.enableVertexAttribArray(this.locations_.a_texCoord),gl.vertexAttribPointer(this.locations_.a_texCoord,2,_webgl2.default.FLOAT,!1,16,8),gl.uniform1i(this.locations_.u_texture,0);var tilesToDrawByZ={};tilesToDrawByZ[z]={};var childTileRange,tile,tileState,x,y,tileExtent,findLoadedTiles=this.createLoadedTileFinder(tileSource,projection,tilesToDrawByZ),useInterimTilesOnError=tileLayer.getUseInterimTilesOnError(),allTilesLoaded=!0,tmpExtent=_extent2.default.createEmpty(),tmpTileRange=new _tilerange2.default(0,0,0,0);for(x=tileRange.minX;x<=tileRange.maxX;++x)for(y=tileRange.minY;y<=tileRange.maxY;++y)if(tile=tileSource.getTile(z,x,y,pixelRatio,projection),void 0===layerState.extent||(tileExtent=tileGrid.getTileCoordExtent(tile.tileCoord,tmpExtent),_extent2.default.intersects(tileExtent,layerState.extent))){if((tileState=tile.getState())==_tilestate2.default.LOADED||tileState==_tilestate2.default.EMPTY||tileState==_tilestate2.default.ERROR&&!useInterimTilesOnError||(tile=tile.getInterimTile()),(tileState=tile.getState())==_tilestate2.default.LOADED){if(mapRenderer.isTileTextureLoaded(tile)){tilesToDrawByZ[z][tile.tileCoord.toString()]=tile;continue}}else if(tileState==_tilestate2.default.EMPTY||tileState==_tilestate2.default.ERROR&&!useInterimTilesOnError)continue;allTilesLoaded=!1,tileGrid.forEachTileCoordParentTileRange(tile.tileCoord,findLoadedTiles,null,tmpTileRange,tmpExtent)||(childTileRange=tileGrid.getTileCoordChildTileRange(tile.tileCoord,tmpTileRange,tmpExtent))&&findLoadedTiles(z+1,childTileRange)}var zs=Object.keys(tilesToDrawByZ).map(Number);zs.sort(_array2.default.numberSafeCompareFunction);var i,ii,tileKey,tilesToDraw,u_tileOffset=new Float32Array(4);for(i=0,ii=zs.length;i<ii;++i)for(tileKey in tilesToDraw=tilesToDrawByZ[zs[i]])tile=tilesToDraw[tileKey],tileExtent=tileGrid.getTileCoordExtent(tile.tileCoord,tmpExtent),u_tileOffset[0]=2*(tileExtent[2]-tileExtent[0])/framebufferExtentDimension,u_tileOffset[1]=2*(tileExtent[3]-tileExtent[1])/framebufferExtentDimension,u_tileOffset[2]=2*(tileExtent[0]-framebufferExtent[0])/framebufferExtentDimension-1,u_tileOffset[3]=2*(tileExtent[1]-framebufferExtent[1])/framebufferExtentDimension-1,gl.uniform4fv(this.locations_.u_tileOffset,u_tileOffset),mapRenderer.bindTileTexture(tile,tilePixelSize,tileGutter*pixelRatio,_webgl2.default.LINEAR,_webgl2.default.LINEAR),gl.drawArrays(_webgl2.default.TRIANGLE_STRIP,0,4);allTilesLoaded?(this.renderedTileRange_=tileRange,this.renderedFramebufferExtent_=framebufferExtent,this.renderedRevision_=tileSource.getRevision()):(this.renderedTileRange_=null,this.renderedFramebufferExtent_=null,this.renderedRevision_=-1,frameState.animate=!0)}this.updateUsedTiles(frameState.usedTiles,tileSource,z,tileRange);var tileTextureQueue=mapRenderer.getTileTextureQueue();this.manageTilePyramid(frameState,tileSource,tileGrid,pixelRatio,projection,extent,z,tileLayer.getPreload(),function(tile){tile.getState()!=_tilestate2.default.LOADED||mapRenderer.isTileTextureLoaded(tile)||tileTextureQueue.isKeyQueued(tile.getKey())||tileTextureQueue.enqueue([tile,tileGrid.getTileCoordCenter(tile.tileCoord),tileGrid.getResolution(tile.tileCoord[0]),tilePixelSize,tileGutter*pixelRatio])},this),this.scheduleExpireCache(frameState,tileSource),this.updateLogos(frameState,tileSource);var texCoordMatrix=this.texCoordMatrix;return _transform2.default.reset(texCoordMatrix),_transform2.default.translate(texCoordMatrix,(Math.round(center[0]/tileResolution)*tileResolution-framebufferExtent[0])/(framebufferExtent[2]-framebufferExtent[0]),(Math.round(center[1]/tileResolution)*tileResolution-framebufferExtent[1])/(framebufferExtent[3]-framebufferExtent[1])),0!==viewState.rotation&&_transform2.default.rotate(texCoordMatrix,viewState.rotation),_transform2.default.scale(texCoordMatrix,frameState.size[0]*viewState.resolution/(framebufferExtent[2]-framebufferExtent[0]),frameState.size[1]*viewState.resolution/(framebufferExtent[3]-framebufferExtent[1])),_transform2.default.translate(texCoordMatrix,-.5,-.5),!0},_ol_renderer_webgl_TileLayer_.prototype.forEachLayerAtPixel=function(pixel,frameState,callback,thisArg){if(this.framebuffer){var pixelOnMapScaled=[pixel[0]/frameState.size[0],(frameState.size[1]-pixel[1])/frameState.size[1]],pixelOnFrameBufferScaled=_transform2.default.apply(this.texCoordMatrix,pixelOnMapScaled.slice()),pixelOnFrameBuffer=[pixelOnFrameBufferScaled[0]*this.framebufferDimension,pixelOnFrameBufferScaled[1]*this.framebufferDimension],gl=this.mapRenderer.getContext().getGL();gl.bindFramebuffer(gl.FRAMEBUFFER,this.framebuffer);var imageData=new Uint8Array(4);return gl.readPixels(pixelOnFrameBuffer[0],pixelOnFrameBuffer[1],1,1,gl.RGBA,gl.UNSIGNED_BYTE,imageData),0<imageData[3]?callback.call(thisArg,this.getLayer(),imageData):void 0}},exports.default=_ol_renderer_webgl_TileLayer_},{"../../array.js":29,"../../extent.js":54,"../../index.js":89,"../../layertype.js":113,"../../math.js":123,"../../size.js":208,"../../tilerange.js":241,"../../tilestate.js":242,"../../transform.js":243,"../../webgl.js":248,"../../webgl/buffer.js":249,"../type.js":192,"../webgl/layer.js":197,"../webgl/tilelayershader.js":200,"../webgl/tilelayershader/locations.js":201}],200:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_fragment2=_interopRequireDefault(require("../../webgl/fragment.js")),_vertex2=_interopRequireDefault(require("../../webgl/vertex.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_webgl_tilelayershader_={};_ol_renderer_webgl_tilelayershader_.fragment=new _fragment2.default(_index2.default.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n":"precision mediump float;varying vec2 a;uniform sampler2D e;void main(void){gl_FragColor=texture2D(e,a);}"),_ol_renderer_webgl_tilelayershader_.vertex=new _vertex2.default(_index2.default.DEBUG_WEBGL?"varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 u_tileOffset;\n\nvoid main(void) {\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\n  v_texCoord = a_texCoord;\n}\n\n\n":"varying vec2 a;attribute vec2 b;attribute vec2 c;uniform vec4 d;void main(void){gl_Position=vec4(b*d.xy+d.zw,0.,1.);a=c;}"),exports.default=_ol_renderer_webgl_tilelayershader_},{"../../index.js":89,"../../webgl/fragment.js":252,"../../webgl/vertex.js":254}],201:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_index=require("../../../index.js"),_index2=(obj=_index)&&obj.__esModule?obj:{default:obj};exports.default=function(gl,program){this.u_tileOffset=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_tileOffset":"d"),this.u_texture=gl.getUniformLocation(program,_index2.default.DEBUG_WEBGL?"u_texture":"e"),this.a_position=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_position":"b"),this.a_texCoord=gl.getAttribLocation(program,_index2.default.DEBUG_WEBGL?"a_texCoord":"c")}},{"../../../index.js":89}],202:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../../index.js")),_layertype2=_interopRequireDefault(require("../../layertype.js")),_viewhint2=_interopRequireDefault(require("../../viewhint.js")),_extent2=_interopRequireDefault(require("../../extent.js")),_replaygroup2=_interopRequireDefault(require("../../render/webgl/replaygroup.js")),_type2=_interopRequireDefault(require("../type.js")),_vector2=_interopRequireDefault(require("../vector.js")),_layer2=_interopRequireDefault(require("../webgl/layer.js")),_transform2=_interopRequireDefault(require("../../transform.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_renderer_webgl_VectorLayer_=function(mapRenderer,vectorLayer){_layer2.default.call(this,mapRenderer,vectorLayer),this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=_extent2.default.createEmpty(),this.renderedRenderOrder_=null,this.replayGroup_=null,this.layerState_=null};_index2.default.inherits(_ol_renderer_webgl_VectorLayer_,_layer2.default),_ol_renderer_webgl_VectorLayer_.handles=function(type,layer){return type===_type2.default.WEBGL&&layer.getType()===_layertype2.default.VECTOR},_ol_renderer_webgl_VectorLayer_.create=function(mapRenderer,layer){return new _ol_renderer_webgl_VectorLayer_(mapRenderer,layer)},_ol_renderer_webgl_VectorLayer_.prototype.composeFrame=function(frameState,layerState,context){this.layerState_=layerState;var viewState=frameState.viewState,replayGroup=this.replayGroup_,size=frameState.size,pixelRatio=frameState.pixelRatio,gl=this.mapRenderer.getGL();replayGroup&&!replayGroup.isEmpty()&&(gl.enable(gl.SCISSOR_TEST),gl.scissor(0,0,size[0]*pixelRatio,size[1]*pixelRatio),replayGroup.replay(context,viewState.center,viewState.resolution,viewState.rotation,size,pixelRatio,layerState.opacity,layerState.managed?frameState.skippedFeatureUids:{}),gl.disable(gl.SCISSOR_TEST))},_ol_renderer_webgl_VectorLayer_.prototype.disposeInternal=function(){var replayGroup=this.replayGroup_;if(replayGroup){var context=this.mapRenderer.getContext();replayGroup.getDeleteResourcesFunction(context)(),this.replayGroup_=null}_layer2.default.prototype.disposeInternal.call(this)},_ol_renderer_webgl_VectorLayer_.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){if(this.replayGroup_&&this.layerState_){var context=this.mapRenderer.getContext(),viewState=frameState.viewState,layer=this.getLayer(),layerState=this.layerState_,features={};return this.replayGroup_.forEachFeatureAtCoordinate(coordinate,context,viewState.center,viewState.resolution,viewState.rotation,frameState.size,frameState.pixelRatio,layerState.opacity,{},function(feature){var key=_index2.default.getUid(feature).toString();if(!(key in features))return features[key]=!0,callback.call(thisArg,feature,layer)})}},_ol_renderer_webgl_VectorLayer_.prototype.hasFeatureAtCoordinate=function(coordinate,frameState){if(this.replayGroup_&&this.layerState_){var context=this.mapRenderer.getContext(),viewState=frameState.viewState,layerState=this.layerState_;return this.replayGroup_.hasFeatureAtCoordinate(coordinate,context,viewState.center,viewState.resolution,viewState.rotation,frameState.size,frameState.pixelRatio,layerState.opacity,frameState.skippedFeatureUids)}return!1},_ol_renderer_webgl_VectorLayer_.prototype.forEachLayerAtPixel=function(pixel,frameState,callback,thisArg){var coordinate=_transform2.default.apply(frameState.pixelToCoordinateTransform,pixel.slice());return this.hasFeatureAtCoordinate(coordinate,frameState)?callback.call(thisArg,this.getLayer(),null):void 0},_ol_renderer_webgl_VectorLayer_.prototype.handleStyleImageChange_=function(event){this.renderIfReadyAndVisible()},_ol_renderer_webgl_VectorLayer_.prototype.prepareFrame=function(frameState,layerState,context){var vectorLayer=this.getLayer(),vectorSource=vectorLayer.getSource();this.updateLogos(frameState,vectorSource);var animating=frameState.viewHints[_viewhint2.default.ANIMATING],interacting=frameState.viewHints[_viewhint2.default.INTERACTING],updateWhileAnimating=vectorLayer.getUpdateWhileAnimating(),updateWhileInteracting=vectorLayer.getUpdateWhileInteracting();if(!this.dirty_&&!updateWhileAnimating&&animating||!updateWhileInteracting&&interacting)return!0;var frameStateExtent=frameState.extent,viewState=frameState.viewState,projection=viewState.projection,resolution=viewState.resolution,pixelRatio=frameState.pixelRatio,vectorLayerRevision=vectorLayer.getRevision(),vectorLayerRenderBuffer=vectorLayer.getRenderBuffer(),vectorLayerRenderOrder=vectorLayer.getRenderOrder();void 0===vectorLayerRenderOrder&&(vectorLayerRenderOrder=_vector2.default.defaultOrder);var extent=_extent2.default.buffer(frameStateExtent,vectorLayerRenderBuffer*resolution);if(!this.dirty_&&this.renderedResolution_==resolution&&this.renderedRevision_==vectorLayerRevision&&this.renderedRenderOrder_==vectorLayerRenderOrder&&_extent2.default.containsExtent(this.renderedExtent_,extent))return!0;this.replayGroup_&&frameState.postRenderFunctions.push(this.replayGroup_.getDeleteResourcesFunction(context)),this.dirty_=!1;var replayGroup=new _replaygroup2.default(_vector2.default.getTolerance(resolution,pixelRatio),extent,vectorLayer.getRenderBuffer());vectorSource.loadFeatures(extent,resolution,projection);var renderFeature=function(feature){var styles,styleFunction=feature.getStyleFunction();if(styleFunction?styles=styleFunction.call(feature,resolution):(styleFunction=vectorLayer.getStyleFunction())&&(styles=styleFunction(feature,resolution)),styles){var dirty=this.renderFeature(feature,resolution,pixelRatio,styles,replayGroup);this.dirty_=this.dirty_||dirty}};if(vectorLayerRenderOrder){var features=[];vectorSource.forEachFeatureInExtent(extent,function(feature){features.push(feature)},this),features.sort(vectorLayerRenderOrder),features.forEach(renderFeature,this)}else vectorSource.forEachFeatureInExtent(extent,renderFeature,this);return replayGroup.finish(context),this.renderedResolution_=resolution,this.renderedRevision_=vectorLayerRevision,this.renderedRenderOrder_=vectorLayerRenderOrder,this.renderedExtent_=extent,this.replayGroup_=replayGroup,!0},_ol_renderer_webgl_VectorLayer_.prototype.renderFeature=function(feature,resolution,pixelRatio,styles,replayGroup){if(!styles)return!1;var loading=!1;if(Array.isArray(styles))for(var i=styles.length-1;0<=i;--i)loading=_vector2.default.renderFeature(replayGroup,feature,styles[i],_vector2.default.getSquaredTolerance(resolution,pixelRatio),this.handleStyleImageChange_,this)||loading;else loading=_vector2.default.renderFeature(replayGroup,feature,styles,_vector2.default.getSquaredTolerance(resolution,pixelRatio),this.handleStyleImageChange_,this)||loading;return loading},exports.default=_ol_renderer_webgl_VectorLayer_},{"../../extent.js":54,"../../index.js":89,"../../layertype.js":113,"../../render/webgl/replaygroup.js":178,"../../transform.js":243,"../../viewhint.js":246,"../type.js":192,"../vector.js":193,"../webgl/layer.js":197}],203:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _dom2=_interopRequireDefault(require("./dom.js")),_extent2=_interopRequireDefault(require("./extent.js")),_math2=_interopRequireDefault(require("./math.js")),_proj2=_interopRequireDefault(require("./proj.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_reproj_={calculateSourceResolution:function(sourceProj,targetProj,targetCenter,targetResolution){var sourceCenter=_proj2.default.transform(targetCenter,targetProj,sourceProj),sourceResolution=_proj2.default.getPointResolution(targetProj,targetResolution,targetCenter),targetMetersPerUnit=targetProj.getMetersPerUnit();void 0!==targetMetersPerUnit&&(sourceResolution*=targetMetersPerUnit);var sourceMetersPerUnit=sourceProj.getMetersPerUnit();void 0!==sourceMetersPerUnit&&(sourceResolution/=sourceMetersPerUnit);var sourceExtent=sourceProj.getExtent();if(!sourceExtent||_extent2.default.containsCoordinate(sourceExtent,sourceCenter)){var compensationFactor=_proj2.default.getPointResolution(sourceProj,sourceResolution,sourceCenter)/sourceResolution;isFinite(compensationFactor)&&0<compensationFactor&&(sourceResolution/=compensationFactor)}return sourceResolution},enlargeClipPoint_:function(centroidX,centroidY,x,y){var dX=x-centroidX,dY=y-centroidY,distance=Math.sqrt(dX*dX+dY*dY);return[Math.round(x+dX/distance),Math.round(y+dY/distance)]},render:function(width,height,pixelRatio,sourceResolution,sourceExtent,targetResolution,targetExtent,triangulation,sources,gutter,opt_renderEdges){var context=_dom2.default.createCanvasContext2D(Math.round(pixelRatio*width),Math.round(pixelRatio*height));if(0===sources.length)return context.canvas;context.scale(pixelRatio,pixelRatio);var sourceDataExtent=_extent2.default.createEmpty();sources.forEach(function(src,i,arr){_extent2.default.extend(sourceDataExtent,src.extent)});var canvasWidthInUnits=_extent2.default.getWidth(sourceDataExtent),canvasHeightInUnits=_extent2.default.getHeight(sourceDataExtent),stitchContext=_dom2.default.createCanvasContext2D(Math.round(pixelRatio*canvasWidthInUnits/sourceResolution),Math.round(pixelRatio*canvasHeightInUnits/sourceResolution)),stitchScale=pixelRatio/sourceResolution;sources.forEach(function(src,i,arr){var xPos=src.extent[0]-sourceDataExtent[0],yPos=-(src.extent[3]-sourceDataExtent[3]),srcWidth=_extent2.default.getWidth(src.extent),srcHeight=_extent2.default.getHeight(src.extent);stitchContext.drawImage(src.image,gutter,gutter,src.image.width-2*gutter,src.image.height-2*gutter,xPos*stitchScale,yPos*stitchScale,srcWidth*stitchScale,srcHeight*stitchScale)});var targetTopLeft=_extent2.default.getTopLeft(targetExtent);return triangulation.getTriangles().forEach(function(triangle,i,arr){var source=triangle.source,target=triangle.target,x0=source[0][0],y0=source[0][1],x1=source[1][0],y1=source[1][1],x2=source[2][0],y2=source[2][1],u0=(target[0][0]-targetTopLeft[0])/targetResolution,v0=-(target[0][1]-targetTopLeft[1])/targetResolution,u1=(target[1][0]-targetTopLeft[0])/targetResolution,v1=-(target[1][1]-targetTopLeft[1])/targetResolution,u2=(target[2][0]-targetTopLeft[0])/targetResolution,v2=-(target[2][1]-targetTopLeft[1])/targetResolution,sourceNumericalShiftX=x0,sourceNumericalShiftY=y0,augmentedMatrix=[[x1-=sourceNumericalShiftX,y1-=sourceNumericalShiftY,y0=x0=0,0,u1-u0],[x2-=sourceNumericalShiftX,y2-=sourceNumericalShiftY,0,0,u2-u0],[0,0,x1,y1,v1-v0],[0,0,x2,y2,v2-v0]],affineCoefs=_math2.default.solveLinearSystem(augmentedMatrix);if(affineCoefs){context.save(),context.beginPath();var centroidX=(u0+u1+u2)/3,centroidY=(v0+v1+v2)/3,p0=_ol_reproj_.enlargeClipPoint_(centroidX,centroidY,u0,v0),p1=_ol_reproj_.enlargeClipPoint_(centroidX,centroidY,u1,v1),p2=_ol_reproj_.enlargeClipPoint_(centroidX,centroidY,u2,v2);context.moveTo(p1[0],p1[1]),context.lineTo(p0[0],p0[1]),context.lineTo(p2[0],p2[1]),context.clip(),context.transform(affineCoefs[0],affineCoefs[2],affineCoefs[1],affineCoefs[3],u0,v0),context.translate(sourceDataExtent[0]-sourceNumericalShiftX,sourceDataExtent[3]-sourceNumericalShiftY),context.scale(sourceResolution/pixelRatio,-sourceResolution/pixelRatio),context.drawImage(stitchContext.canvas,0,0),context.restore()}}),opt_renderEdges&&(context.save(),context.strokeStyle="black",context.lineWidth=1,triangulation.getTriangles().forEach(function(triangle,i,arr){var target=triangle.target,u0=(target[0][0]-targetTopLeft[0])/targetResolution,v0=-(target[0][1]-targetTopLeft[1])/targetResolution,u1=(target[1][0]-targetTopLeft[0])/targetResolution,v1=-(target[1][1]-targetTopLeft[1])/targetResolution,u2=(target[2][0]-targetTopLeft[0])/targetResolution,v2=-(target[2][1]-targetTopLeft[1])/targetResolution;context.beginPath(),context.moveTo(u1,v1),context.lineTo(u0,v0),context.lineTo(u2,v2),context.closePath(),context.stroke()}),context.restore()),context.canvas}};exports.default=_ol_reproj_},{"./dom.js":46,"./extent.js":54,"./math.js":123,"./proj.js":141}],204:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_imagebase2=_interopRequireDefault(require("../imagebase.js")),_imagestate2=_interopRequireDefault(require("../imagestate.js")),_events2=_interopRequireDefault(require("../events.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_extent2=_interopRequireDefault(require("../extent.js")),_reproj2=_interopRequireDefault(require("../reproj.js")),_triangulation2=_interopRequireDefault(require("../reproj/triangulation.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_reproj_Image_=function(sourceProj,targetProj,targetExtent,targetResolution,pixelRatio,getImageFunction){this.targetProj_=targetProj,this.maxSourceExtent_=sourceProj.getExtent();var maxTargetExtent=targetProj.getExtent(),limitedTargetExtent=maxTargetExtent?_extent2.default.getIntersection(targetExtent,maxTargetExtent):targetExtent,targetCenter=_extent2.default.getCenter(limitedTargetExtent),sourceResolution=_reproj2.default.calculateSourceResolution(sourceProj,targetProj,targetCenter,targetResolution),errorThresholdInPixels=_index2.default.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD;this.triangulation_=new _triangulation2.default(sourceProj,targetProj,limitedTargetExtent,this.maxSourceExtent_,sourceResolution*errorThresholdInPixels),this.targetResolution_=targetResolution,this.targetExtent_=targetExtent;var sourceExtent=this.triangulation_.calculateSourceExtent();this.sourceImage_=getImageFunction(sourceExtent,sourceResolution,pixelRatio),this.sourcePixelRatio_=this.sourceImage_?this.sourceImage_.getPixelRatio():1,this.canvas_=null,this.sourceListenerKey_=null;var state=_imagestate2.default.LOADED;this.sourceImage_&&(state=_imagestate2.default.IDLE),_imagebase2.default.call(this,targetExtent,targetResolution,this.sourcePixelRatio_,state)};_index2.default.inherits(_ol_reproj_Image_,_imagebase2.default),_ol_reproj_Image_.prototype.disposeInternal=function(){this.state==_imagestate2.default.LOADING&&this.unlistenSource_(),_imagebase2.default.prototype.disposeInternal.call(this)},_ol_reproj_Image_.prototype.getImage=function(){return this.canvas_},_ol_reproj_Image_.prototype.getProjection=function(){return this.targetProj_},_ol_reproj_Image_.prototype.reproject_=function(){var sourceState=this.sourceImage_.getState();if(sourceState==_imagestate2.default.LOADED){var width=_extent2.default.getWidth(this.targetExtent_)/this.targetResolution_,height=_extent2.default.getHeight(this.targetExtent_)/this.targetResolution_;this.canvas_=_reproj2.default.render(width,height,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=sourceState,this.changed()},_ol_reproj_Image_.prototype.load=function(){if(this.state==_imagestate2.default.IDLE){this.state=_imagestate2.default.LOADING,this.changed();var sourceState=this.sourceImage_.getState();sourceState==_imagestate2.default.LOADED||sourceState==_imagestate2.default.ERROR?this.reproject_():(this.sourceListenerKey_=_events2.default.listen(this.sourceImage_,_eventtype2.default.CHANGE,function(e){var sourceState=this.sourceImage_.getState();sourceState!=_imagestate2.default.LOADED&&sourceState!=_imagestate2.default.ERROR||(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}},_ol_reproj_Image_.prototype.unlistenSource_=function(){_events2.default.unlistenByKey(this.sourceListenerKey_),this.sourceListenerKey_=null},exports.default=_ol_reproj_Image_},{"../events.js":48,"../events/eventtype.js":52,"../extent.js":54,"../imagebase.js":86,"../imagestate.js":88,"../index.js":89,"../reproj.js":203,"../reproj/triangulation.js":205}],205:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_extent2=_interopRequireDefault(require("../extent.js")),_math2=_interopRequireDefault(require("../math.js")),_proj2=_interopRequireDefault(require("../proj.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_reproj_Triangulation_=function(sourceProj,targetProj,targetExtent,maxSourceExtent,errorThreshold){this.sourceProj_=sourceProj,this.targetProj_=targetProj;var transformInvCache={},transformInv=_proj2.default.getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(c){var key=c[0]+"/"+c[1];return transformInvCache[key]||(transformInvCache[key]=transformInv(c)),transformInvCache[key]},this.maxSourceExtent_=maxSourceExtent,this.errorThresholdSquared_=errorThreshold*errorThreshold,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!maxSourceExtent&&!!this.sourceProj_.getExtent()&&_extent2.default.getWidth(maxSourceExtent)==_extent2.default.getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?_extent2.default.getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?_extent2.default.getWidth(this.targetProj_.getExtent()):null;var destinationTopLeft=_extent2.default.getTopLeft(targetExtent),destinationTopRight=_extent2.default.getTopRight(targetExtent),destinationBottomRight=_extent2.default.getBottomRight(targetExtent),destinationBottomLeft=_extent2.default.getBottomLeft(targetExtent),sourceTopLeft=this.transformInv_(destinationTopLeft),sourceTopRight=this.transformInv_(destinationTopRight),sourceBottomRight=this.transformInv_(destinationBottomRight),sourceBottomLeft=this.transformInv_(destinationBottomLeft);if(this.addQuad_(destinationTopLeft,destinationTopRight,destinationBottomRight,destinationBottomLeft,sourceTopLeft,sourceTopRight,sourceBottomRight,sourceBottomLeft,_index2.default.RASTER_REPROJECTION_MAX_SUBDIVISION),this.wrapsXInSource_){var leftBound=1/0;this.triangles_.forEach(function(triangle,i,arr){leftBound=Math.min(leftBound,triangle.source[0][0],triangle.source[1][0],triangle.source[2][0])}),this.triangles_.forEach(function(triangle){if(Math.max(triangle.source[0][0],triangle.source[1][0],triangle.source[2][0])-leftBound>this.sourceWorldWidth_/2){var newTriangle=[[triangle.source[0][0],triangle.source[0][1]],[triangle.source[1][0],triangle.source[1][1]],[triangle.source[2][0],triangle.source[2][1]]];newTriangle[0][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[0][0]-=this.sourceWorldWidth_),newTriangle[1][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[1][0]-=this.sourceWorldWidth_),newTriangle[2][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[2][0]-=this.sourceWorldWidth_);var minX=Math.min(newTriangle[0][0],newTriangle[1][0],newTriangle[2][0]);Math.max(newTriangle[0][0],newTriangle[1][0],newTriangle[2][0])-minX<this.sourceWorldWidth_/2&&(triangle.source=newTriangle)}},this)}transformInvCache={}};_ol_reproj_Triangulation_.prototype.addTriangle_=function(a,b,c,aSrc,bSrc,cSrc){this.triangles_.push({source:[aSrc,bSrc,cSrc],target:[a,b,c]})},_ol_reproj_Triangulation_.prototype.addQuad_=function(a,b,c,d,aSrc,bSrc,cSrc,dSrc,maxSubdivision){var sourceQuadExtent=_extent2.default.boundingExtent([aSrc,bSrc,cSrc,dSrc]),sourceCoverageX=this.sourceWorldWidth_?_extent2.default.getWidth(sourceQuadExtent)/this.sourceWorldWidth_:null,sourceWorldWidth=this.sourceWorldWidth_,wrapsX=this.sourceProj_.canWrapX()&&.5<sourceCoverageX&&sourceCoverageX<1,needsSubdivision=!1;if(0<maxSubdivision){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var targetQuadExtent=_extent2.default.boundingExtent([a,b,c,d]);needsSubdivision|=_extent2.default.getWidth(targetQuadExtent)/this.targetWorldWidth_>_index2.default.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH}!wrapsX&&this.sourceProj_.isGlobal()&&sourceCoverageX&&(needsSubdivision|=sourceCoverageX>_index2.default.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH)}if(needsSubdivision||!this.maxSourceExtent_||_extent2.default.intersects(sourceQuadExtent,this.maxSourceExtent_)){if(!(needsSubdivision||isFinite(aSrc[0])&&isFinite(aSrc[1])&&isFinite(bSrc[0])&&isFinite(bSrc[1])&&isFinite(cSrc[0])&&isFinite(cSrc[1])&&isFinite(dSrc[0])&&isFinite(dSrc[1]))){if(!(0<maxSubdivision))return;needsSubdivision=!0}if(0<maxSubdivision){if(!needsSubdivision){var dx,center=[(a[0]+c[0])/2,(a[1]+c[1])/2],centerSrc=this.transformInv_(center);if(wrapsX)dx=(_math2.default.modulo(aSrc[0],sourceWorldWidth)+_math2.default.modulo(cSrc[0],sourceWorldWidth))/2-_math2.default.modulo(centerSrc[0],sourceWorldWidth);else dx=(aSrc[0]+cSrc[0])/2-centerSrc[0];var dy=(aSrc[1]+cSrc[1])/2-centerSrc[1];needsSubdivision=dx*dx+dy*dy>this.errorThresholdSquared_}if(needsSubdivision){if(Math.abs(a[0]-c[0])<=Math.abs(a[1]-c[1])){var bc=[(b[0]+c[0])/2,(b[1]+c[1])/2],bcSrc=this.transformInv_(bc),da=[(d[0]+a[0])/2,(d[1]+a[1])/2],daSrc=this.transformInv_(da);this.addQuad_(a,b,bc,da,aSrc,bSrc,bcSrc,daSrc,maxSubdivision-1),this.addQuad_(da,bc,c,d,daSrc,bcSrc,cSrc,dSrc,maxSubdivision-1)}else{var ab=[(a[0]+b[0])/2,(a[1]+b[1])/2],abSrc=this.transformInv_(ab),cd=[(c[0]+d[0])/2,(c[1]+d[1])/2],cdSrc=this.transformInv_(cd);this.addQuad_(a,ab,cd,d,aSrc,abSrc,cdSrc,dSrc,maxSubdivision-1),this.addQuad_(ab,b,c,cd,abSrc,bSrc,cSrc,cdSrc,maxSubdivision-1)}return}}if(wrapsX){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(a,c,d,aSrc,cSrc,dSrc),this.addTriangle_(a,b,c,aSrc,bSrc,cSrc)}},_ol_reproj_Triangulation_.prototype.calculateSourceExtent=function(){var extent=_extent2.default.createEmpty();return this.triangles_.forEach(function(triangle,i,arr){var src=triangle.source;_extent2.default.extendCoordinate(extent,src[0]),_extent2.default.extendCoordinate(extent,src[1]),_extent2.default.extendCoordinate(extent,src[2])}),extent},_ol_reproj_Triangulation_.prototype.getTriangles=function(){return this.triangles_},exports.default=_ol_reproj_Triangulation_},{"../extent.js":54,"../index.js":89,"../math.js":123,"../proj.js":141}],206:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _array2=_interopRequireDefault(require("./array.js")),_math2=_interopRequireDefault(require("./math.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_ResolutionConstraint_={createSnapToResolutions:function(resolutions){return function(resolution,delta,direction){if(void 0!==resolution){var z=_array2.default.linearFindNearest(resolutions,resolution,direction);z=_math2.default.clamp(z+delta,0,resolutions.length-1);var index=Math.floor(z);if(z!=index&&index<resolutions.length-1){var power=resolutions[index]/resolutions[index+1];return resolutions[index]/Math.pow(power,z-index)}return resolutions[index]}}},createSnapToPower:function(power,maxResolution,opt_maxLevel){return function(resolution,delta,direction){if(void 0!==resolution){var offset=-direction/2+.5,oldLevel=Math.floor(Math.log(maxResolution/resolution)/Math.log(power)+offset),newLevel=Math.max(oldLevel+delta,0);return void 0!==opt_maxLevel&&(newLevel=Math.min(newLevel,opt_maxLevel)),maxResolution/Math.pow(power,newLevel)}}}};exports.default=_ol_ResolutionConstraint_},{"./array.js":29,"./math.js":123}],207:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_math=require("./math.js"),_math2=(obj=_math)&&obj.__esModule?obj:{default:obj};var _ol_RotationConstraint_={disable:function(rotation,delta){return void 0!==rotation?0:void 0},none:function(rotation,delta){return void 0!==rotation?rotation+delta:void 0},createSnapToN:function(n){var theta=2*Math.PI/n;return function(rotation,delta){return void 0!==rotation?rotation=Math.floor((rotation+delta)/theta+.5)*theta:void 0}},createSnapToZero:function(opt_tolerance){var tolerance=opt_tolerance||_math2.default.toRadians(5);return function(rotation,delta){return void 0!==rotation?Math.abs(rotation+delta)<=tolerance?0:rotation+delta:void 0}}};exports.default=_ol_RotationConstraint_},{"./math.js":123}],208:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_size_={buffer:function(size,buffer,opt_size){return void 0===opt_size&&(opt_size=[0,0]),opt_size[0]=size[0]+2*buffer,opt_size[1]=size[1]+2*buffer,opt_size},hasArea:function(size){return 0<size[0]&&0<size[1]},scale:function(size,ratio,opt_size){return void 0===opt_size&&(opt_size=[0,0]),opt_size[0]=size[0]*ratio+.5|0,opt_size[1]=size[1]*ratio+.5|0,opt_size},toSize:function(size,opt_size){return Array.isArray(size)?size:(void 0===opt_size?opt_size=[size,size]:opt_size[0]=opt_size[1]=size,opt_size)}};exports.default=_ol_size_},{}],209:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_imagestate2=_interopRequireDefault(require("../imagestate.js")),_array2=_interopRequireDefault(require("../array.js")),_event2=_interopRequireDefault(require("../events/event.js")),_extent2=_interopRequireDefault(require("../extent.js")),_proj2=_interopRequireDefault(require("../proj.js")),_image2=_interopRequireDefault(require("../reproj/image.js")),_source2=_interopRequireDefault(require("../source/source.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_source_Image_=function(options){_source2.default.call(this,{attributions:options.attributions,extent:options.extent,logo:options.logo,projection:options.projection,state:options.state}),this.resolutions_=void 0!==options.resolutions?options.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0};_index2.default.inherits(_ol_source_Image_,_source2.default),_ol_source_Image_.prototype.getResolutions=function(){return this.resolutions_},_ol_source_Image_.prototype.findNearestResolution=function(resolution){if(this.resolutions_){var idx=_array2.default.linearFindNearest(this.resolutions_,resolution,0);resolution=this.resolutions_[idx]}return resolution},_ol_source_Image_.prototype.getImage=function(extent,resolution,pixelRatio,projection){var sourceProjection=this.getProjection();if(_index2.default.ENABLE_RASTER_REPROJECTION&&sourceProjection&&projection&&!_proj2.default.equivalent(sourceProjection,projection)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&_proj2.default.equivalent(this.reprojectedImage_.getProjection(),projection)&&this.reprojectedImage_.getResolution()==resolution&&_extent2.default.equals(this.reprojectedImage_.getExtent(),extent))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new _image2.default(sourceProjection,projection,extent,resolution,pixelRatio,function(extent,resolution,pixelRatio){return this.getImageInternal(extent,resolution,pixelRatio,sourceProjection)}.bind(this)),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return sourceProjection&&(projection=sourceProjection),this.getImageInternal(extent,resolution,pixelRatio,projection)},_ol_source_Image_.prototype.getImageInternal=function(extent,resolution,pixelRatio,projection){},_ol_source_Image_.prototype.handleImageChange=function(event){var image=event.target;switch(image.getState()){case _imagestate2.default.LOADING:this.dispatchEvent(new _ol_source_Image_.Event(_ol_source_Image_.EventType_.IMAGELOADSTART,image));break;case _imagestate2.default.LOADED:this.dispatchEvent(new _ol_source_Image_.Event(_ol_source_Image_.EventType_.IMAGELOADEND,image));break;case _imagestate2.default.ERROR:this.dispatchEvent(new _ol_source_Image_.Event(_ol_source_Image_.EventType_.IMAGELOADERROR,image))}},_ol_source_Image_.defaultImageLoadFunction=function(image,src){image.getImage().src=src},_ol_source_Image_.Event=function(type,image){_event2.default.call(this,type),this.image=image},_index2.default.inherits(_ol_source_Image_.Event,_event2.default),_ol_source_Image_.EventType_={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"},exports.default=_ol_source_Image_},{"../array.js":29,"../events/event.js":50,"../extent.js":54,"../imagestate.js":88,"../index.js":89,"../proj.js":141,"../reproj/image.js":204,"../source/source.js":211}],210:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_image2=_interopRequireDefault(require("../image.js")),_imagestate2=_interopRequireDefault(require("../imagestate.js")),_dom2=_interopRequireDefault(require("../dom.js")),_events2=_interopRequireDefault(require("../events.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_extent2=_interopRequireDefault(require("../extent.js")),_proj2=_interopRequireDefault(require("../proj.js")),_image4=_interopRequireDefault(require("../source/image.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_source_ImageStatic_=function(options){var imageExtent=options.imageExtent,crossOrigin=void 0!==options.crossOrigin?options.crossOrigin:null,imageLoadFunction=void 0!==options.imageLoadFunction?options.imageLoadFunction:_image4.default.defaultImageLoadFunction;_image4.default.call(this,{attributions:options.attributions,logo:options.logo,projection:_proj2.default.get(options.projection)}),this.image_=new _image2.default(imageExtent,void 0,1,options.url,crossOrigin,imageLoadFunction),this.imageSize_=options.imageSize?options.imageSize:null,_events2.default.listen(this.image_,_eventtype2.default.CHANGE,this.handleImageChange,this)};_index2.default.inherits(_ol_source_ImageStatic_,_image4.default),_ol_source_ImageStatic_.prototype.getImageInternal=function(extent,resolution,pixelRatio,projection){return _extent2.default.intersects(extent,this.image_.getExtent())?this.image_:null},_ol_source_ImageStatic_.prototype.handleImageChange=function(evt){if(this.image_.getState()==_imagestate2.default.LOADED){var imageWidth,imageHeight,imageExtent=this.image_.getExtent(),image=this.image_.getImage();imageHeight=this.imageSize_?(imageWidth=this.imageSize_[0],this.imageSize_[1]):(imageWidth=image.width,image.height);var resolution=_extent2.default.getHeight(imageExtent)/imageHeight,targetWidth=Math.ceil(_extent2.default.getWidth(imageExtent)/resolution);if(targetWidth!=imageWidth){var context=_dom2.default.createCanvasContext2D(targetWidth,imageHeight),canvas=context.canvas;context.drawImage(image,0,0,imageWidth,imageHeight,0,0,canvas.width,canvas.height),this.image_.setImage(canvas)}}_image4.default.prototype.handleImageChange.call(this,evt)},exports.default=_ol_source_ImageStatic_},{"../dom.js":46,"../events.js":48,"../events/eventtype.js":52,"../extent.js":54,"../image.js":85,"../imagestate.js":88,"../index.js":89,"../proj.js":141,"../source/image.js":209}],211:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_attribution2=_interopRequireDefault(require("../attribution.js")),_object2=_interopRequireDefault(require("../object.js")),_proj2=_interopRequireDefault(require("../proj.js")),_state2=_interopRequireDefault(require("../source/state.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_source_Source_=function(options){_object2.default.call(this),this.projection_=_proj2.default.get(options.projection),this.attributions_=null,this.attributions2_=this.adaptAttributions_(options.attributions),this.logo_=options.logo,this.state_=void 0!==options.state?options.state:_state2.default.READY,this.wrapX_=void 0!==options.wrapX&&options.wrapX};_index2.default.inherits(_ol_source_Source_,_object2.default),_ol_source_Source_.prototype.adaptAttributions_=function(attributionLike){if(!attributionLike)return null;if(attributionLike instanceof _attribution2.default)return this.attributions_=[attributionLike],function(frameState){return[attributionLike.getHTML()]};if(Array.isArray(attributionLike)){if(attributionLike[0]instanceof _attribution2.default){var attributions=(this.attributions_=attributionLike).map(function(attribution){return attribution.getHTML()});return function(frameState){return attributions}}return this.attributions_=attributionLike.map(function(attribution){return new _attribution2.default({html:attribution})}),function(frameState){return attributionLike}}return"function"==typeof attributionLike?attributionLike:(this.attributions_=[new _attribution2.default({html:attributionLike})],function(frameState){return[attributionLike]})},_ol_source_Source_.prototype.forEachFeatureAtCoordinate=_index2.default.nullFunction,_ol_source_Source_.prototype.getAttributions=function(){return this.attributions_},_ol_source_Source_.prototype.getAttributions2=function(){return this.attributions2_},_ol_source_Source_.prototype.getLogo=function(){return this.logo_},_ol_source_Source_.prototype.getProjection=function(){return this.projection_},_ol_source_Source_.prototype.getResolutions=function(){},_ol_source_Source_.prototype.getState=function(){return this.state_},_ol_source_Source_.prototype.getWrapX=function(){return this.wrapX_},_ol_source_Source_.prototype.refresh=function(){this.changed()},_ol_source_Source_.prototype.setAttributions=function(attributions){this.attributions2_=this.adaptAttributions_(attributions),this.changed()},_ol_source_Source_.prototype.setLogo=function(logo){this.logo_=logo},_ol_source_Source_.prototype.setState=function(state){this.state_=state,this.changed()},exports.default=_ol_source_Source_},{"../attribution.js":32,"../index.js":89,"../object.js":125,"../proj.js":141,"../source/state.js":212}],212:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"}},{}],213:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_collection2=_interopRequireDefault(require("../collection.js")),_collectioneventtype2=_interopRequireDefault(require("../collectioneventtype.js")),_objecteventtype2=_interopRequireDefault(require("../objecteventtype.js")),_array2=_interopRequireDefault(require("../array.js")),_asserts2=_interopRequireDefault(require("../asserts.js")),_events2=_interopRequireDefault(require("../events.js")),_event2=_interopRequireDefault(require("../events/event.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_extent2=_interopRequireDefault(require("../extent.js")),_featureloader2=_interopRequireDefault(require("../featureloader.js")),_functions2=_interopRequireDefault(require("../functions.js")),_loadingstrategy2=_interopRequireDefault(require("../loadingstrategy.js")),_obj2=_interopRequireDefault(require("../obj.js")),_source2=_interopRequireDefault(require("../source/source.js")),_state2=_interopRequireDefault(require("../source/state.js")),_vectoreventtype2=_interopRequireDefault(require("../source/vectoreventtype.js")),_rbush2=_interopRequireDefault(require("../structs/rbush.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_source_Vector_=function(opt_options){var options=opt_options||{};_source2.default.call(this,{attributions:options.attributions,logo:options.logo,projection:void 0,state:_state2.default.READY,wrapX:void 0===options.wrapX||options.wrapX}),this.loader_=_index2.default.nullFunction,this.format_=options.format,this.overlaps_=null==options.overlaps||options.overlaps,this.url_=options.url,void 0!==options.loader?this.loader_=options.loader:void 0!==this.url_&&(_asserts2.default.assert(this.format_,7),this.loader_=_featureloader2.default.xhr(this.url_,this.format_)),this.strategy_=void 0!==options.strategy?options.strategy:_loadingstrategy2.default.all;var collection,features,useSpatialIndex=void 0===options.useSpatialIndex||options.useSpatialIndex;this.featuresRtree_=useSpatialIndex?new _rbush2.default:null,this.loadedExtentsRtree_=new _rbush2.default,this.nullGeometryFeatures_={},this.idIndex_={},this.undefIdIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,options.features instanceof _collection2.default?features=(collection=options.features).getArray():Array.isArray(options.features)&&(features=options.features),useSpatialIndex||void 0!==collection||(collection=new _collection2.default(features)),void 0!==features&&this.addFeaturesInternal(features),void 0!==collection&&this.bindFeaturesCollection_(collection)};_index2.default.inherits(_ol_source_Vector_,_source2.default),_ol_source_Vector_.prototype.addFeature=function(feature){this.addFeatureInternal(feature),this.changed()},_ol_source_Vector_.prototype.addFeatureInternal=function(feature){var featureKey=_index2.default.getUid(feature).toString();if(this.addToIndex_(featureKey,feature)){this.setupChangeEvents_(featureKey,feature);var geometry=feature.getGeometry();if(geometry){var extent=geometry.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(extent,feature)}else this.nullGeometryFeatures_[featureKey]=feature;this.dispatchEvent(new _ol_source_Vector_.Event(_vectoreventtype2.default.ADDFEATURE,feature))}},_ol_source_Vector_.prototype.setupChangeEvents_=function(featureKey,feature){this.featureChangeKeys_[featureKey]=[_events2.default.listen(feature,_eventtype2.default.CHANGE,this.handleFeatureChange_,this),_events2.default.listen(feature,_objecteventtype2.default.PROPERTYCHANGE,this.handleFeatureChange_,this)]},_ol_source_Vector_.prototype.addToIndex_=function(featureKey,feature){var valid=!0,id=feature.getId();return void 0!==id?id.toString()in this.idIndex_?valid=!1:this.idIndex_[id.toString()]=feature:(_asserts2.default.assert(!(featureKey in this.undefIdIndex_),30),this.undefIdIndex_[featureKey]=feature),valid},_ol_source_Vector_.prototype.addFeatures=function(features){this.addFeaturesInternal(features),this.changed()},_ol_source_Vector_.prototype.addFeaturesInternal=function(features){var featureKey,i,length,feature,extents=[],newFeatures=[],geometryFeatures=[];for(i=0,length=features.length;i<length;i++)feature=features[i],featureKey=_index2.default.getUid(feature).toString(),this.addToIndex_(featureKey,feature)&&newFeatures.push(feature);for(i=0,length=newFeatures.length;i<length;i++){feature=newFeatures[i],featureKey=_index2.default.getUid(feature).toString(),this.setupChangeEvents_(featureKey,feature);var geometry=feature.getGeometry();if(geometry){var extent=geometry.getExtent();extents.push(extent),geometryFeatures.push(feature)}else this.nullGeometryFeatures_[featureKey]=feature}for(this.featuresRtree_&&this.featuresRtree_.load(extents,geometryFeatures),i=0,length=newFeatures.length;i<length;i++)this.dispatchEvent(new _ol_source_Vector_.Event(_vectoreventtype2.default.ADDFEATURE,newFeatures[i]))},_ol_source_Vector_.prototype.bindFeaturesCollection_=function(collection){var modifyingCollection=!1;_events2.default.listen(this,_vectoreventtype2.default.ADDFEATURE,function(evt){modifyingCollection||(modifyingCollection=!0,collection.push(evt.feature),modifyingCollection=!1)}),_events2.default.listen(this,_vectoreventtype2.default.REMOVEFEATURE,function(evt){modifyingCollection||(modifyingCollection=!0,collection.remove(evt.feature),modifyingCollection=!1)}),_events2.default.listen(collection,_collectioneventtype2.default.ADD,function(evt){modifyingCollection||(modifyingCollection=!0,this.addFeature(evt.element),modifyingCollection=!1)},this),_events2.default.listen(collection,_collectioneventtype2.default.REMOVE,function(evt){modifyingCollection||(modifyingCollection=!0,this.removeFeature(evt.element),modifyingCollection=!1)},this),this.featuresCollection_=collection},_ol_source_Vector_.prototype.clear=function(opt_fast){if(opt_fast){for(var featureId in this.featureChangeKeys_){this.featureChangeKeys_[featureId].forEach(_events2.default.unlistenByKey)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.undefIdIndex_={})}else if(this.featuresRtree_)for(var id in this.featuresRtree_.forEach(this.removeFeatureInternal,this),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[id]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.loadedExtentsRtree_.clear(),this.nullGeometryFeatures_={};var clearEvent=new _ol_source_Vector_.Event(_vectoreventtype2.default.CLEAR);this.dispatchEvent(clearEvent),this.changed()},_ol_source_Vector_.prototype.forEachFeature=function(callback,opt_this){return this.featuresRtree_?this.featuresRtree_.forEach(callback,opt_this):this.featuresCollection_?this.featuresCollection_.forEach(callback,opt_this):void 0},_ol_source_Vector_.prototype.forEachFeatureAtCoordinateDirect=function(coordinate,callback,opt_this){var extent=[coordinate[0],coordinate[1],coordinate[0],coordinate[1]];return this.forEachFeatureInExtent(extent,function(feature){return feature.getGeometry().intersectsCoordinate(coordinate)?callback.call(opt_this,feature):void 0})},_ol_source_Vector_.prototype.forEachFeatureInExtent=function(extent,callback,opt_this){return this.featuresRtree_?this.featuresRtree_.forEachInExtent(extent,callback,opt_this):this.featuresCollection_?this.featuresCollection_.forEach(callback,opt_this):void 0},_ol_source_Vector_.prototype.forEachFeatureIntersectingExtent=function(extent,callback,opt_this){return this.forEachFeatureInExtent(extent,function(feature){if(feature.getGeometry().intersectsExtent(extent)){var result=callback.call(opt_this,feature);if(result)return result}})},_ol_source_Vector_.prototype.getFeaturesCollection=function(){return this.featuresCollection_},_ol_source_Vector_.prototype.getFeatures=function(){var features;return this.featuresCollection_?features=this.featuresCollection_.getArray():this.featuresRtree_&&(features=this.featuresRtree_.getAll(),_obj2.default.isEmpty(this.nullGeometryFeatures_)||_array2.default.extend(features,_obj2.default.getValues(this.nullGeometryFeatures_))),features},_ol_source_Vector_.prototype.getFeaturesAtCoordinate=function(coordinate){var features=[];return this.forEachFeatureAtCoordinateDirect(coordinate,function(feature){features.push(feature)}),features},_ol_source_Vector_.prototype.getFeaturesInExtent=function(extent){return this.featuresRtree_.getInExtent(extent)},_ol_source_Vector_.prototype.getClosestFeatureToCoordinate=function(coordinate,opt_filter){var x=coordinate[0],y=coordinate[1],closestFeature=null,closestPoint=[NaN,NaN],minSquaredDistance=1/0,extent=[-1/0,-1/0,1/0,1/0],filter=opt_filter||_functions2.default.TRUE;return this.featuresRtree_.forEachInExtent(extent,function(feature){if(filter(feature)){var geometry=feature.getGeometry(),previousMinSquaredDistance=minSquaredDistance;if((minSquaredDistance=geometry.closestPointXY(x,y,closestPoint,minSquaredDistance))<previousMinSquaredDistance){closestFeature=feature;var minDistance=Math.sqrt(minSquaredDistance);extent[0]=x-minDistance,extent[1]=y-minDistance,extent[2]=x+minDistance,extent[3]=y+minDistance}}}),closestFeature},_ol_source_Vector_.prototype.getExtent=function(opt_extent){return this.featuresRtree_.getExtent(opt_extent)},_ol_source_Vector_.prototype.getFeatureById=function(id){var feature=this.idIndex_[id.toString()];return void 0!==feature?feature:null},_ol_source_Vector_.prototype.getFormat=function(){return this.format_},_ol_source_Vector_.prototype.getOverlaps=function(){return this.overlaps_},_ol_source_Vector_.prototype.getResolutions=function(){},_ol_source_Vector_.prototype.getUrl=function(){return this.url_},_ol_source_Vector_.prototype.handleFeatureChange_=function(event){var feature=event.target,featureKey=_index2.default.getUid(feature).toString(),geometry=feature.getGeometry();if(geometry){var extent=geometry.getExtent();featureKey in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[featureKey],this.featuresRtree_&&this.featuresRtree_.insert(extent,feature)):this.featuresRtree_&&this.featuresRtree_.update(extent,feature)}else featureKey in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(feature),this.nullGeometryFeatures_[featureKey]=feature);var id=feature.getId();if(void 0!==id){var sid=id.toString();featureKey in this.undefIdIndex_?(delete this.undefIdIndex_[featureKey],this.idIndex_[sid]=feature):this.idIndex_[sid]!==feature&&(this.removeFromIdIndex_(feature),this.idIndex_[sid]=feature)}else featureKey in this.undefIdIndex_||(this.removeFromIdIndex_(feature),this.undefIdIndex_[featureKey]=feature);this.changed(),this.dispatchEvent(new _ol_source_Vector_.Event(_vectoreventtype2.default.CHANGEFEATURE,feature))},_ol_source_Vector_.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&_obj2.default.isEmpty(this.nullGeometryFeatures_)},_ol_source_Vector_.prototype.loadFeatures=function(extent,resolution,projection){var i,ii,loadedExtentsRtree=this.loadedExtentsRtree_,extentsToLoad=this.strategy_(extent,resolution);for(i=0,ii=extentsToLoad.length;i<ii;++i){var extentToLoad=extentsToLoad[i];loadedExtentsRtree.forEachInExtent(extentToLoad,function(object){return _extent2.default.containsExtent(object.extent,extentToLoad)})||(this.loader_.call(this,extentToLoad,resolution,projection),loadedExtentsRtree.insert(extentToLoad,{extent:extentToLoad.slice()}))}},_ol_source_Vector_.prototype.removeLoadedExtent=function(extent){var obj,loadedExtentsRtree=this.loadedExtentsRtree_;loadedExtentsRtree.forEachInExtent(extent,function(object){if(_extent2.default.equals(object.extent,extent))return obj=object,!0}),obj&&loadedExtentsRtree.remove(obj)},_ol_source_Vector_.prototype.removeFeature=function(feature){var featureKey=_index2.default.getUid(feature).toString();featureKey in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[featureKey]:this.featuresRtree_&&this.featuresRtree_.remove(feature),this.removeFeatureInternal(feature),this.changed()},_ol_source_Vector_.prototype.removeFeatureInternal=function(feature){var featureKey=_index2.default.getUid(feature).toString();this.featureChangeKeys_[featureKey].forEach(_events2.default.unlistenByKey),delete this.featureChangeKeys_[featureKey];var id=feature.getId();void 0!==id?delete this.idIndex_[id.toString()]:delete this.undefIdIndex_[featureKey],this.dispatchEvent(new _ol_source_Vector_.Event(_vectoreventtype2.default.REMOVEFEATURE,feature))},_ol_source_Vector_.prototype.removeFromIdIndex_=function(feature){var removed=!1;for(var id in this.idIndex_)if(this.idIndex_[id]===feature){delete this.idIndex_[id],removed=!0;break}return removed},_ol_source_Vector_.prototype.setLoader=function(loader){this.loader_=loader},_ol_source_Vector_.Event=function(type,opt_feature){_event2.default.call(this,type),this.feature=opt_feature},_index2.default.inherits(_ol_source_Vector_.Event,_event2.default),exports.default=_ol_source_Vector_},{"../array.js":29,"../asserts.js":31,"../collection.js":34,"../collectioneventtype.js":35,"../events.js":48,"../events/event.js":50,"../events/eventtype.js":52,"../extent.js":54,"../featureloader.js":58,"../functions.js":60,"../index.js":89,"../loadingstrategy.js":114,"../obj.js":124,"../objecteventtype.js":126,"../source/source.js":211,"../source/state.js":212,"../source/vectoreventtype.js":214,"../structs/rbush.js":220}],214:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"}},{}],215:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _math2=_interopRequireDefault(require("./math.js")),_geometrytype2=_interopRequireDefault(require("./geom/geometrytype.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_Sphere_=function(radius){this.radius=radius};_ol_Sphere_.prototype.geodesicArea=function(coordinates){return _ol_Sphere_.getArea_(coordinates,this.radius)},_ol_Sphere_.prototype.haversineDistance=function(c1,c2){return _ol_Sphere_.getDistance_(c1,c2,this.radius)},_ol_Sphere_.prototype.offset=function(c1,distance,bearing){var lat1=_math2.default.toRadians(c1[1]),lon1=_math2.default.toRadians(c1[0]),dByR=distance/this.radius,lat=Math.asin(Math.sin(lat1)*Math.cos(dByR)+Math.cos(lat1)*Math.sin(dByR)*Math.cos(bearing)),lon=lon1+Math.atan2(Math.sin(bearing)*Math.sin(dByR)*Math.cos(lat1),Math.cos(dByR)-Math.sin(lat1)*Math.sin(lat));return[_math2.default.toDegrees(lon),_math2.default.toDegrees(lat)]},_ol_Sphere_.DEFAULT_RADIUS=6371008.8,_ol_Sphere_.getLength=function(geometry,opt_options){var coordinates,coords,i,ii,j,jj,options=opt_options||{},radius=options.radius||_ol_Sphere_.DEFAULT_RADIUS,projection=options.projection||"EPSG:3857",type=(geometry=geometry.clone().transform(projection,"EPSG:4326")).getType(),length=0;switch(type){case _geometrytype2.default.POINT:case _geometrytype2.default.MULTI_POINT:break;case _geometrytype2.default.LINE_STRING:case _geometrytype2.default.LINEAR_RING:coordinates=geometry.getCoordinates(),length=_ol_Sphere_.getLength_(coordinates,radius);break;case _geometrytype2.default.MULTI_LINE_STRING:case _geometrytype2.default.POLYGON:for(i=0,ii=(coordinates=geometry.getCoordinates()).length;i<ii;++i)length+=_ol_Sphere_.getLength_(coordinates[i],radius);break;case _geometrytype2.default.MULTI_POLYGON:for(i=0,ii=(coordinates=geometry.getCoordinates()).length;i<ii;++i)for(j=0,jj=(coords=coordinates[i]).length;j<jj;++j)length+=_ol_Sphere_.getLength_(coords[j],radius);break;case _geometrytype2.default.GEOMETRY_COLLECTION:var geometries=geometry.getGeometries();for(i=0,ii=geometries.length;i<ii;++i)length+=_ol_Sphere_.getLength(geometries[i],opt_options);break;default:throw new Error("Unsupported geometry type: "+type)}return length},_ol_Sphere_.getLength_=function(coordinates,radius){for(var length=0,i=0,ii=coordinates.length;i<ii-1;++i)length+=_ol_Sphere_.getDistance_(coordinates[i],coordinates[i+1],radius);return length},_ol_Sphere_.getDistance_=function(c1,c2,radius){var lat1=_math2.default.toRadians(c1[1]),lat2=_math2.default.toRadians(c2[1]),deltaLatBy2=(lat2-lat1)/2,deltaLonBy2=_math2.default.toRadians(c2[0]-c1[0])/2,a=Math.sin(deltaLatBy2)*Math.sin(deltaLatBy2)+Math.sin(deltaLonBy2)*Math.sin(deltaLonBy2)*Math.cos(lat1)*Math.cos(lat2);return 2*radius*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))},_ol_Sphere_.getArea=function(geometry,opt_options){var coordinates,coords,i,ii,j,jj,options=opt_options||{},radius=options.radius||_ol_Sphere_.DEFAULT_RADIUS,projection=options.projection||"EPSG:3857",type=(geometry=geometry.clone().transform(projection,"EPSG:4326")).getType(),area=0;switch(type){case _geometrytype2.default.POINT:case _geometrytype2.default.MULTI_POINT:case _geometrytype2.default.LINE_STRING:case _geometrytype2.default.MULTI_LINE_STRING:case _geometrytype2.default.LINEAR_RING:break;case _geometrytype2.default.POLYGON:for(coordinates=geometry.getCoordinates(),area=Math.abs(_ol_Sphere_.getArea_(coordinates[0],radius)),i=1,ii=coordinates.length;i<ii;++i)area-=Math.abs(_ol_Sphere_.getArea_(coordinates[i],radius));break;case _geometrytype2.default.MULTI_POLYGON:for(i=0,ii=(coordinates=geometry.getCoordinates()).length;i<ii;++i)for(coords=coordinates[i],area+=Math.abs(_ol_Sphere_.getArea_(coords[0],radius)),j=1,jj=coords.length;j<jj;++j)area-=Math.abs(_ol_Sphere_.getArea_(coords[j],radius));break;case _geometrytype2.default.GEOMETRY_COLLECTION:var geometries=geometry.getGeometries();for(i=0,ii=geometries.length;i<ii;++i)area+=_ol_Sphere_.getArea(geometries[i],opt_options);break;default:throw new Error("Unsupported geometry type: "+type)}return area},_ol_Sphere_.getArea_=function(coordinates,radius){for(var area=0,len=coordinates.length,x1=coordinates[len-1][0],y1=coordinates[len-1][1],i=0;i<len;i++){var x2=coordinates[i][0],y2=coordinates[i][1];area+=_math2.default.toRadians(x2-x1)*(2+Math.sin(_math2.default.toRadians(y1))+Math.sin(_math2.default.toRadians(y2))),x1=x2,y1=y2}return area*radius*radius/2},exports.default=_ol_Sphere_},{"./geom/geometrytype.js":79,"./math.js":123}],216:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_string_={padNumber:function(number,width,opt_precision){var numberString=void 0!==opt_precision?number.toFixed(opt_precision):""+number,decimal=numberString.indexOf(".");return width<(decimal=-1===decimal?numberString.length:decimal)?numberString:new Array(1+width-decimal).join("0")+numberString},compareVersions:function(v1,v2){for(var s1=(""+v1).split("."),s2=(""+v2).split("."),i=0;i<Math.max(s1.length,s2.length);i++){var n1=parseInt(s1[i]||"0",10),n2=parseInt(s2[i]||"0",10);if(n2<n1)return 1;if(n1<n2)return-1}return 0}};exports.default=_ol_string_},{}],217:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_structs_LinkedList_=function(opt_circular){this.first_=void 0,this.last_=void 0,this.head_=void 0,this.circular_=void 0===opt_circular||opt_circular,this.length_=0};_ol_structs_LinkedList_.prototype.insertItem=function(data){var item={prev:void 0,next:void 0,data:data},head=this.head_;if(head){var next=head.next;item.prev=head,item.next=next,head.next=item,next&&(next.prev=item),head===this.last_&&(this.last_=item)}else this.first_=item,this.last_=item,this.circular_&&((item.next=item).prev=item);this.head_=item,this.length_++},_ol_structs_LinkedList_.prototype.removeItem=function(){var head=this.head_;if(head){var next=head.next,prev=head.prev;next&&(next.prev=prev),prev&&(prev.next=next),this.head_=next||prev,this.first_===this.last_?(this.head_=void 0,this.first_=void 0,this.last_=void 0):this.first_===head?this.first_=this.head_:this.last_===head&&(this.last_=prev?this.head_.prev:this.head_),this.length_--}},_ol_structs_LinkedList_.prototype.firstItem=function(){if(this.head_=this.first_,this.head_)return this.head_.data},_ol_structs_LinkedList_.prototype.lastItem=function(){if(this.head_=this.last_,this.head_)return this.head_.data},_ol_structs_LinkedList_.prototype.nextItem=function(){if(this.head_&&this.head_.next)return this.head_=this.head_.next,this.head_.data},_ol_structs_LinkedList_.prototype.getNextItem=function(){if(this.head_&&this.head_.next)return this.head_.next.data},_ol_structs_LinkedList_.prototype.prevItem=function(){if(this.head_&&this.head_.prev)return this.head_=this.head_.prev,this.head_.data},_ol_structs_LinkedList_.prototype.getPrevItem=function(){if(this.head_&&this.head_.prev)return this.head_.prev.data},_ol_structs_LinkedList_.prototype.getCurrItem=function(){if(this.head_)return this.head_.data},_ol_structs_LinkedList_.prototype.setFirstItem=function(){this.circular_&&this.head_&&(this.first_=this.head_,this.last_=this.head_.prev)},_ol_structs_LinkedList_.prototype.concat=function(list){if(list.head_){if(this.head_){var end=this.head_.next;this.head_.next=list.first_,list.first_.prev=this.head_,end.prev=list.last_,list.last_.next=end,this.length_+=list.length_}else this.head_=list.head_,this.first_=list.first_,this.last_=list.last_,this.length_=list.length_;list.head_=void 0,list.first_=void 0,list.last_=void 0,list.length_=0}},_ol_structs_LinkedList_.prototype.getLength=function(){return this.length_},exports.default=_ol_structs_LinkedList_},{}],218:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_asserts2=_interopRequireDefault(require("../asserts.js")),_eventtarget2=_interopRequireDefault(require("../events/eventtarget.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_structs_LRUCache_=function(opt_highWaterMark){_eventtarget2.default.call(this),this.highWaterMark=void 0!==opt_highWaterMark?opt_highWaterMark:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null};_index2.default.inherits(_ol_structs_LRUCache_,_eventtarget2.default),_ol_structs_LRUCache_.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},_ol_structs_LRUCache_.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(_eventtype2.default.CLEAR)},_ol_structs_LRUCache_.prototype.containsKey=function(key){return this.entries_.hasOwnProperty(key)},_ol_structs_LRUCache_.prototype.forEach=function(f,opt_this){for(var entry=this.oldest_;entry;)f.call(opt_this,entry.value_,entry.key_,this),entry=entry.newer},_ol_structs_LRUCache_.prototype.get=function(key){var entry=this.entries_[key];return _asserts2.default.assert(void 0!==entry,15),entry===this.newest_?entry.value_:(entry===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(entry.newer.older=entry.older,entry.older.newer=entry.newer),entry.newer=null,entry.older=this.newest_,this.newest_.newer=entry,(this.newest_=entry).value_)},_ol_structs_LRUCache_.prototype.remove=function(key){var entry=this.entries_[key];return _asserts2.default.assert(void 0!==entry,15),entry===this.newest_?(this.newest_=entry.older,this.newest_&&(this.newest_.newer=null)):entry===this.oldest_?(this.oldest_=entry.newer,this.oldest_&&(this.oldest_.older=null)):(entry.newer.older=entry.older,entry.older.newer=entry.newer),delete this.entries_[key],--this.count_,entry.value_},_ol_structs_LRUCache_.prototype.getCount=function(){return this.count_},_ol_structs_LRUCache_.prototype.getKeys=function(){var entry,keys=new Array(this.count_),i=0;for(entry=this.newest_;entry;entry=entry.older)keys[i++]=entry.key_;return keys},_ol_structs_LRUCache_.prototype.getValues=function(){var entry,values=new Array(this.count_),i=0;for(entry=this.newest_;entry;entry=entry.older)values[i++]=entry.value_;return values},_ol_structs_LRUCache_.prototype.peekLast=function(){return this.oldest_.value_},_ol_structs_LRUCache_.prototype.peekLastKey=function(){return this.oldest_.key_},_ol_structs_LRUCache_.prototype.peekFirstKey=function(){return this.newest_.key_},_ol_structs_LRUCache_.prototype.pop=function(){var entry=this.oldest_;return delete this.entries_[entry.key_],entry.newer&&(entry.newer.older=null),this.oldest_=entry.newer,this.oldest_||(this.newest_=null),--this.count_,entry.value_},_ol_structs_LRUCache_.prototype.replace=function(key,value){this.get(key),this.entries_[key].value_=value},_ol_structs_LRUCache_.prototype.set=function(key,value){_asserts2.default.assert(!(key in this.entries_),16);var entry={key_:key,newer:null,older:this.newest_,value_:value};this.newest_?this.newest_.newer=entry:this.oldest_=entry,this.newest_=entry,this.entries_[key]=entry,++this.count_},_ol_structs_LRUCache_.prototype.prune=function(){for(;this.canExpireCache();)this.pop()},exports.default=_ol_structs_LRUCache_},{"../asserts.js":31,"../events/eventtarget.js":51,"../events/eventtype.js":52,"../index.js":89}],219:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _asserts2=_interopRequireDefault(require("../asserts.js")),_obj2=_interopRequireDefault(require("../obj.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_structs_PriorityQueue_=function(priorityFunction,keyFunction){this.priorityFunction_=priorityFunction,this.keyFunction_=keyFunction,this.elements_=[],this.priorities_=[],this.queuedElements_={}};_ol_structs_PriorityQueue_.DROP=1/0,_ol_structs_PriorityQueue_.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,_obj2.default.clear(this.queuedElements_)},_ol_structs_PriorityQueue_.prototype.dequeue=function(){var elements=this.elements_,priorities=this.priorities_,element=elements[0];1==elements.length?(elements.length=0,priorities.length=0):(elements[0]=elements.pop(),priorities[0]=priorities.pop(),this.siftUp_(0));var elementKey=this.keyFunction_(element);return delete this.queuedElements_[elementKey],element},_ol_structs_PriorityQueue_.prototype.enqueue=function(element){_asserts2.default.assert(!(this.keyFunction_(element)in this.queuedElements_),31);var priority=this.priorityFunction_(element);return priority!=_ol_structs_PriorityQueue_.DROP&&(this.elements_.push(element),this.priorities_.push(priority),this.queuedElements_[this.keyFunction_(element)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},_ol_structs_PriorityQueue_.prototype.getCount=function(){return this.elements_.length},_ol_structs_PriorityQueue_.prototype.getLeftChildIndex_=function(index){return 2*index+1},_ol_structs_PriorityQueue_.prototype.getRightChildIndex_=function(index){return 2*index+2},_ol_structs_PriorityQueue_.prototype.getParentIndex_=function(index){return index-1>>1},_ol_structs_PriorityQueue_.prototype.heapify_=function(){var i;for(i=(this.elements_.length>>1)-1;0<=i;i--)this.siftUp_(i)},_ol_structs_PriorityQueue_.prototype.isEmpty=function(){return 0===this.elements_.length},_ol_structs_PriorityQueue_.prototype.isKeyQueued=function(key){return key in this.queuedElements_},_ol_structs_PriorityQueue_.prototype.isQueued=function(element){return this.isKeyQueued(this.keyFunction_(element))},_ol_structs_PriorityQueue_.prototype.siftUp_=function(index){for(var elements=this.elements_,priorities=this.priorities_,count=elements.length,element=elements[index],priority=priorities[index],startIndex=index;index<count>>1;){var lIndex=this.getLeftChildIndex_(index),rIndex=this.getRightChildIndex_(index),smallerChildIndex=rIndex<count&&priorities[rIndex]<priorities[lIndex]?rIndex:lIndex;elements[index]=elements[smallerChildIndex],priorities[index]=priorities[smallerChildIndex],index=smallerChildIndex}elements[index]=element,priorities[index]=priority,this.siftDown_(startIndex,index)},_ol_structs_PriorityQueue_.prototype.siftDown_=function(startIndex,index){for(var elements=this.elements_,priorities=this.priorities_,element=elements[index],priority=priorities[index];startIndex<index;){var parentIndex=this.getParentIndex_(index);if(!(priorities[parentIndex]>priority))break;elements[index]=elements[parentIndex],priorities[index]=priorities[parentIndex],index=parentIndex}elements[index]=element,priorities[index]=priority},_ol_structs_PriorityQueue_.prototype.reprioritize=function(){var element,i,priority,priorityFunction=this.priorityFunction_,elements=this.elements_,priorities=this.priorities_,index=0,n=elements.length;for(i=0;i<n;++i)(priority=priorityFunction(element=elements[i]))==_ol_structs_PriorityQueue_.DROP?delete this.queuedElements_[this.keyFunction_(element)]:(priorities[index]=priority,elements[index++]=element);elements.length=index,priorities.length=index,this.heapify_()},exports.default=_ol_structs_PriorityQueue_},{"../asserts.js":31,"../obj.js":124}],220:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_rbush2=_interopRequireDefault(require("rbush")),_extent2=_interopRequireDefault(require("../extent.js")),_obj2=_interopRequireDefault(require("../obj.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_structs_RBush_=function(opt_maxEntries){this.rbush_=(0,_rbush2.default)(opt_maxEntries),this.items_={}};_ol_structs_RBush_.prototype.insert=function(extent,value){var item={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3],value:value};this.rbush_.insert(item),this.items_[_index2.default.getUid(value)]=item},_ol_structs_RBush_.prototype.load=function(extents,values){for(var items=new Array(values.length),i=0,l=values.length;i<l;i++){var extent=extents[i],value=values[i],item={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3],value:value};items[i]=item,this.items_[_index2.default.getUid(value)]=item}this.rbush_.load(items)},_ol_structs_RBush_.prototype.remove=function(value){var uid=_index2.default.getUid(value),item=this.items_[uid];return delete this.items_[uid],null!==this.rbush_.remove(item)},_ol_structs_RBush_.prototype.update=function(extent,value){var item=this.items_[_index2.default.getUid(value)],bbox=[item.minX,item.minY,item.maxX,item.maxY];_extent2.default.equals(bbox,extent)||(this.remove(value),this.insert(extent,value))},_ol_structs_RBush_.prototype.getAll=function(){return this.rbush_.all().map(function(item){return item.value})},_ol_structs_RBush_.prototype.getInExtent=function(extent){var bbox={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3]};return this.rbush_.search(bbox).map(function(item){return item.value})},_ol_structs_RBush_.prototype.forEach=function(callback,opt_this){return this.forEach_(this.getAll(),callback,opt_this)},_ol_structs_RBush_.prototype.forEachInExtent=function(extent,callback,opt_this){return this.forEach_(this.getInExtent(extent),callback,opt_this)},_ol_structs_RBush_.prototype.forEach_=function(values,callback,opt_this){for(var result,i=0,l=values.length;i<l;i++)if(result=callback.call(opt_this,values[i]))return result;return result},_ol_structs_RBush_.prototype.isEmpty=function(){return _obj2.default.isEmpty(this.items_)},_ol_structs_RBush_.prototype.clear=function(){this.rbush_.clear(),this.items_={}},_ol_structs_RBush_.prototype.getExtent=function(opt_extent){var data=this.rbush_.data;return _extent2.default.createOrUpdate(data.minX,data.minY,data.maxX,data.maxY,opt_extent)},_ol_structs_RBush_.prototype.concat=function(rbush){for(var i in this.rbush_.load(rbush.rbush_.all()),rbush.items_)this.items_[0|i]=rbush.items_[0|i]},exports.default=_ol_structs_RBush_},{"../extent.js":54,"../index.js":89,"../obj.js":124,rbush:258}],221:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_iconimagecache=require("./style/iconimagecache.js"),_iconimagecache2=(obj=_iconimagecache)&&obj.__esModule?obj:{default:obj};var _ol_style_={};_ol_style_.iconImageCache=new _iconimagecache2.default,exports.default=_ol_style_},{"./style/iconimagecache.js":229}],222:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_dom=require("../dom.js"),_dom2=(obj=_dom)&&obj.__esModule?obj:{default:obj};var _ol_style_Atlas_=function(size,space){this.space_=space,this.emptyBlocks_=[{x:0,y:0,width:size,height:size}],this.entries_={},this.context_=_dom2.default.createCanvasContext2D(size,size),this.canvas_=this.context_.canvas};_ol_style_Atlas_.prototype.get=function(id){return this.entries_[id]||null},_ol_style_Atlas_.prototype.add=function(id,width,height,renderCallback,opt_this){var block,i,ii;for(i=0,ii=this.emptyBlocks_.length;i<ii;++i)if((block=this.emptyBlocks_[i]).width>=width+this.space_&&block.height>=height+this.space_){var entry={offsetX:block.x+this.space_,offsetY:block.y+this.space_,image:this.canvas_};return this.entries_[id]=entry,renderCallback.call(opt_this,this.context_,block.x+this.space_,block.y+this.space_),this.split_(i,block,width+this.space_,height+this.space_),entry}return null},_ol_style_Atlas_.prototype.split_=function(index,block,width,height){var newBlock1,newBlock2,deltaWidth=block.width-width;newBlock2=block.height-height<deltaWidth?(newBlock1={x:block.x+width,y:block.y,width:block.width-width,height:block.height},{x:block.x,y:block.y+height,width:width,height:block.height-height}):(newBlock1={x:block.x+width,y:block.y,width:block.width-width,height:height},{x:block.x,y:block.y+height,width:block.width,height:block.height-height}),this.updateBlocks_(index,newBlock1,newBlock2)},_ol_style_Atlas_.prototype.updateBlocks_=function(index,newBlock1,newBlock2){var args=[index,1];0<newBlock1.width&&0<newBlock1.height&&args.push(newBlock1),0<newBlock2.width&&0<newBlock2.height&&args.push(newBlock2),this.emptyBlocks_.splice.apply(this.emptyBlocks_,args)},exports.default=_ol_style_Atlas_},{"../dom.js":46}],223:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_atlas2=_interopRequireDefault(require("../style/atlas.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_style_AtlasManager_=function(opt_options){var options=opt_options||{};this.currentSize_=void 0!==options.initialSize?options.initialSize:_index2.default.INITIAL_ATLAS_SIZE,this.maxSize_=void 0!==options.maxSize?options.maxSize:-1!=_index2.default.MAX_ATLAS_SIZE?_index2.default.MAX_ATLAS_SIZE:void 0!==_index2.default.WEBGL_MAX_TEXTURE_SIZE?_index2.default.WEBGL_MAX_TEXTURE_SIZE:2048,this.space_=void 0!==options.space?options.space:1,this.atlases_=[new _atlas2.default(this.currentSize_,this.space_)],this.currentHitSize_=this.currentSize_,this.hitAtlases_=[new _atlas2.default(this.currentHitSize_,this.space_)]};_ol_style_AtlasManager_.prototype.getInfo=function(id){var info=this.getInfo_(this.atlases_,id);if(!info)return null;var hitInfo=this.getInfo_(this.hitAtlases_,id);return this.mergeInfos_(info,hitInfo)},_ol_style_AtlasManager_.prototype.getInfo_=function(atlases,id){var info,i,ii;for(i=0,ii=atlases.length;i<ii;++i)if(info=atlases[i].get(id))return info;return null},_ol_style_AtlasManager_.prototype.mergeInfos_=function(info,hitInfo){return{offsetX:info.offsetX,offsetY:info.offsetY,image:info.image,hitImage:hitInfo.image}},_ol_style_AtlasManager_.prototype.add=function(id,width,height,renderCallback,opt_renderHitCallback,opt_this){if(width+this.space_>this.maxSize_||height+this.space_>this.maxSize_)return null;var info=this.add_(!1,id,width,height,renderCallback,opt_this);if(!info)return null;var renderHitCallback=void 0!==opt_renderHitCallback?opt_renderHitCallback:_index2.default.nullFunction,hitInfo=this.add_(!0,id,width,height,renderHitCallback,opt_this);return this.mergeInfos_(info,hitInfo)},_ol_style_AtlasManager_.prototype.add_=function(isHitAtlas,id,width,height,renderCallback,opt_this){var atlas,info,i,ii,atlases=isHitAtlas?this.hitAtlases_:this.atlases_;for(i=0,ii=atlases.length;i<ii;++i){if(info=(atlas=atlases[i]).add(id,width,height,renderCallback,opt_this))return info;var size;info||i!==ii-1||(isHitAtlas?(size=Math.min(2*this.currentHitSize_,this.maxSize_),this.currentHitSize_=size):(size=Math.min(2*this.currentSize_,this.maxSize_),this.currentSize_=size),atlas=new _atlas2.default(size,this.space_),atlases.push(atlas),++ii)}return null},exports.default=_ol_style_AtlasManager_},{"../index.js":89,"../style/atlas.js":222}],224:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_regularshape2=_interopRequireDefault(require("../style/regularshape.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_style_Circle_=function(opt_options){var options=opt_options||{};_regularshape2.default.call(this,{points:1/0,fill:options.fill,radius:options.radius,snapToPixel:options.snapToPixel,stroke:options.stroke,atlasManager:options.atlasManager})};_index2.default.inherits(_ol_style_Circle_,_regularshape2.default),_ol_style_Circle_.prototype.clone=function(){var style=new _ol_style_Circle_({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),snapToPixel:this.getSnapToPixel(),atlasManager:this.atlasManager_});return style.setOpacity(this.getOpacity()),style.setScale(this.getScale()),style},_ol_style_Circle_.prototype.setRadius=function(radius){this.radius_=radius,this.render_(this.atlasManager_)},exports.default=_ol_style_Circle_},{"../index.js":89,"../style/regularshape.js":232}],225:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_color2=_interopRequireDefault(require("../color.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_style_Fill_=function(opt_options){var options=opt_options||{};this.color_=void 0!==options.color?options.color:null,this.checksum_=void 0};_ol_style_Fill_.prototype.clone=function(){var color=this.getColor();return new _ol_style_Fill_({color:color&&color.slice?color.slice():color||void 0})},_ol_style_Fill_.prototype.getColor=function(){return this.color_},_ol_style_Fill_.prototype.setColor=function(color){this.color_=color,this.checksum_=void 0},_ol_style_Fill_.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.color_ instanceof CanvasPattern||this.color_ instanceof CanvasGradient?this.checksum_=_index2.default.getUid(this.color_).toString():this.checksum_="f"+(this.color_?_color2.default.asString(this.color_):"-")),this.checksum_},exports.default=_ol_style_Fill_},{"../color.js":36,"../index.js":89}],226:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_imagestate2=_interopRequireDefault(require("../imagestate.js")),_asserts2=_interopRequireDefault(require("../asserts.js")),_color2=_interopRequireDefault(require("../color.js")),_events2=_interopRequireDefault(require("../events.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_iconanchorunits2=_interopRequireDefault(require("../style/iconanchorunits.js")),_iconimage2=_interopRequireDefault(require("../style/iconimage.js")),_iconorigin2=_interopRequireDefault(require("../style/iconorigin.js")),_image2=_interopRequireDefault(require("../style/image.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_style_Icon_=function(opt_options){var options=opt_options||{};this.anchor_=void 0!==options.anchor?options.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==options.anchorOrigin?options.anchorOrigin:_iconorigin2.default.TOP_LEFT,this.anchorXUnits_=void 0!==options.anchorXUnits?options.anchorXUnits:_iconanchorunits2.default.FRACTION,this.anchorYUnits_=void 0!==options.anchorYUnits?options.anchorYUnits:_iconanchorunits2.default.FRACTION,this.crossOrigin_=void 0!==options.crossOrigin?options.crossOrigin:null;var image=void 0!==options.img?options.img:null,imgSize=void 0!==options.imgSize?options.imgSize:null,src=options.src;_asserts2.default.assert(!(void 0!==src&&image),4),_asserts2.default.assert(!image||image&&imgSize,5),void 0!==src&&0!==src.length||!image||(src=image.src||_index2.default.getUid(image).toString()),_asserts2.default.assert(void 0!==src&&0<src.length,6);var imageState=void 0!==options.src?_imagestate2.default.IDLE:_imagestate2.default.LOADED;this.color_=void 0!==options.color?_color2.default.asArray(options.color):null,this.iconImage_=_iconimage2.default.get(image,src,imgSize,this.crossOrigin_,imageState,this.color_),this.offset_=void 0!==options.offset?options.offset:[0,0],this.offsetOrigin_=void 0!==options.offsetOrigin?options.offsetOrigin:_iconorigin2.default.TOP_LEFT,this.origin_=null,this.size_=void 0!==options.size?options.size:null;var opacity=void 0!==options.opacity?options.opacity:1,rotateWithView=void 0!==options.rotateWithView&&options.rotateWithView,rotation=void 0!==options.rotation?options.rotation:0,scale=void 0!==options.scale?options.scale:1,snapToPixel=void 0===options.snapToPixel||options.snapToPixel;_image2.default.call(this,{opacity:opacity,rotation:rotation,scale:scale,snapToPixel:snapToPixel,rotateWithView:rotateWithView})};_index2.default.inherits(_ol_style_Icon_,_image2.default),_ol_style_Icon_.prototype.clone=function(){return new _ol_style_Icon_({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),snapToPixel:this.getSnapToPixel(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},_ol_style_Icon_.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var anchor=this.anchor_,size=this.getSize();if(this.anchorXUnits_==_iconanchorunits2.default.FRACTION||this.anchorYUnits_==_iconanchorunits2.default.FRACTION){if(!size)return null;anchor=this.anchor_.slice(),this.anchorXUnits_==_iconanchorunits2.default.FRACTION&&(anchor[0]*=size[0]),this.anchorYUnits_==_iconanchorunits2.default.FRACTION&&(anchor[1]*=size[1])}if(this.anchorOrigin_!=_iconorigin2.default.TOP_LEFT){if(!size)return null;anchor===this.anchor_&&(anchor=this.anchor_.slice()),this.anchorOrigin_!=_iconorigin2.default.TOP_RIGHT&&this.anchorOrigin_!=_iconorigin2.default.BOTTOM_RIGHT||(anchor[0]=-anchor[0]+size[0]),this.anchorOrigin_!=_iconorigin2.default.BOTTOM_LEFT&&this.anchorOrigin_!=_iconorigin2.default.BOTTOM_RIGHT||(anchor[1]=-anchor[1]+size[1])}return this.normalizedAnchor_=anchor,this.normalizedAnchor_},_ol_style_Icon_.prototype.getColor=function(){return this.color_},_ol_style_Icon_.prototype.getImage=function(pixelRatio){return this.iconImage_.getImage(pixelRatio)},_ol_style_Icon_.prototype.getImageSize=function(){return this.iconImage_.getSize()},_ol_style_Icon_.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},_ol_style_Icon_.prototype.getImageState=function(){return this.iconImage_.getImageState()},_ol_style_Icon_.prototype.getHitDetectionImage=function(pixelRatio){return this.iconImage_.getHitDetectionImage(pixelRatio)},_ol_style_Icon_.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var offset=this.offset_;if(this.offsetOrigin_!=_iconorigin2.default.TOP_LEFT){var size=this.getSize(),iconImageSize=this.iconImage_.getSize();if(!size||!iconImageSize)return null;offset=offset.slice(),this.offsetOrigin_!=_iconorigin2.default.TOP_RIGHT&&this.offsetOrigin_!=_iconorigin2.default.BOTTOM_RIGHT||(offset[0]=iconImageSize[0]-size[0]-offset[0]),this.offsetOrigin_!=_iconorigin2.default.BOTTOM_LEFT&&this.offsetOrigin_!=_iconorigin2.default.BOTTOM_RIGHT||(offset[1]=iconImageSize[1]-size[1]-offset[1])}return this.origin_=offset,this.origin_},_ol_style_Icon_.prototype.getSrc=function(){return this.iconImage_.getSrc()},_ol_style_Icon_.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},_ol_style_Icon_.prototype.listenImageChange=function(listener,thisArg){return _events2.default.listen(this.iconImage_,_eventtype2.default.CHANGE,listener,thisArg)},_ol_style_Icon_.prototype.load=function(){this.iconImage_.load()},_ol_style_Icon_.prototype.unlistenImageChange=function(listener,thisArg){_events2.default.unlisten(this.iconImage_,_eventtype2.default.CHANGE,listener,thisArg)},exports.default=_ol_style_Icon_},{"../asserts.js":31,"../color.js":36,"../events.js":48,"../events/eventtype.js":52,"../imagestate.js":88,"../index.js":89,"../style/iconanchorunits.js":227,"../style/iconimage.js":228,"../style/iconorigin.js":230,"../style/image.js":231}],227:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={FRACTION:"fraction",PIXELS:"pixels"}},{}],228:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_dom2=_interopRequireDefault(require("../dom.js")),_events2=_interopRequireDefault(require("../events.js")),_eventtarget2=_interopRequireDefault(require("../events/eventtarget.js")),_eventtype2=_interopRequireDefault(require("../events/eventtype.js")),_imagestate2=_interopRequireDefault(require("../imagestate.js")),_style2=_interopRequireDefault(require("../style.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_style_IconImage_=function(image,src,size,crossOrigin,imageState,color){_eventtarget2.default.call(this),this.hitDetectionImage_=null,this.image_=image||new Image,null!==crossOrigin&&(this.image_.crossOrigin=crossOrigin),this.canvas_=color?document.createElement("CANVAS"):null,this.color_=color,this.imageListenerKeys_=null,this.imageState_=imageState,this.size_=size,this.src_=src,this.tainting_=!1,this.imageState_==_imagestate2.default.LOADED&&this.determineTainting_()};_index2.default.inherits(_ol_style_IconImage_,_eventtarget2.default),_ol_style_IconImage_.get=function(image,src,size,crossOrigin,imageState,color){var iconImageCache=_style2.default.iconImageCache,iconImage=iconImageCache.get(src,crossOrigin,color);return iconImage||(iconImage=new _ol_style_IconImage_(image,src,size,crossOrigin,imageState,color),iconImageCache.set(src,crossOrigin,color,iconImage)),iconImage},_ol_style_IconImage_.prototype.determineTainting_=function(){var context=_dom2.default.createCanvasContext2D(1,1);try{context.drawImage(this.image_,0,0),context.getImageData(0,0,1,1)}catch(e){this.tainting_=!0}},_ol_style_IconImage_.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(_eventtype2.default.CHANGE)},_ol_style_IconImage_.prototype.handleImageError_=function(){this.imageState_=_imagestate2.default.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},_ol_style_IconImage_.prototype.handleImageLoad_=function(){this.imageState_=_imagestate2.default.LOADED,this.size_&&(this.image_.width=this.size_[0],this.image_.height=this.size_[1]),this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.determineTainting_(),this.replaceColor_(),this.dispatchChangeEvent_()},_ol_style_IconImage_.prototype.getImage=function(pixelRatio){return this.canvas_?this.canvas_:this.image_},_ol_style_IconImage_.prototype.getImageState=function(){return this.imageState_},_ol_style_IconImage_.prototype.getHitDetectionImage=function(pixelRatio){if(!this.hitDetectionImage_)if(this.tainting_){var width=this.size_[0],height=this.size_[1],context=_dom2.default.createCanvasContext2D(width,height);context.fillRect(0,0,width,height),this.hitDetectionImage_=context.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},_ol_style_IconImage_.prototype.getSize=function(){return this.size_},_ol_style_IconImage_.prototype.getSrc=function(){return this.src_},_ol_style_IconImage_.prototype.load=function(){if(this.imageState_==_imagestate2.default.IDLE){this.imageState_=_imagestate2.default.LOADING,this.imageListenerKeys_=[_events2.default.listenOnce(this.image_,_eventtype2.default.ERROR,this.handleImageError_,this),_events2.default.listenOnce(this.image_,_eventtype2.default.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(e){this.handleImageError_()}}},_ol_style_IconImage_.prototype.replaceColor_=function(){if(!this.tainting_&&null!==this.color_){this.canvas_.width=this.image_.width,this.canvas_.height=this.image_.height;var ctx=this.canvas_.getContext("2d");ctx.drawImage(this.image_,0,0);for(var imgData=ctx.getImageData(0,0,this.image_.width,this.image_.height),data=imgData.data,r=this.color_[0]/255,g=this.color_[1]/255,b=this.color_[2]/255,i=0,ii=data.length;i<ii;i+=4)data[i]*=r,data[i+1]*=g,data[i+2]*=b;ctx.putImageData(imgData,0,0)}},_ol_style_IconImage_.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(_events2.default.unlistenByKey),this.imageListenerKeys_=null},exports.default=_ol_style_IconImage_},{"../dom.js":46,"../events.js":48,"../events/eventtarget.js":51,"../events/eventtype.js":52,"../imagestate.js":88,"../index.js":89,"../style.js":221}],229:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_color=require("../color.js"),_color2=(obj=_color)&&obj.__esModule?obj:{default:obj};var _ol_style_IconImageCache_=function(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32};_ol_style_IconImageCache_.getKey=function(src,crossOrigin,color){return crossOrigin+":"+src+":"+(color?_color2.default.asString(color):"null")},_ol_style_IconImageCache_.prototype.clear=function(){this.cache_={},this.cacheSize_=0},_ol_style_IconImageCache_.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var key,iconImage,i=0;for(key in this.cache_)iconImage=this.cache_[key],0!=(3&i++)||iconImage.hasListener()||(delete this.cache_[key],--this.cacheSize_)}},_ol_style_IconImageCache_.prototype.get=function(src,crossOrigin,color){var key=_ol_style_IconImageCache_.getKey(src,crossOrigin,color);return key in this.cache_?this.cache_[key]:null},_ol_style_IconImageCache_.prototype.set=function(src,crossOrigin,color,iconImage){var key=_ol_style_IconImageCache_.getKey(src,crossOrigin,color);this.cache_[key]=iconImage,++this.cacheSize_},_ol_style_IconImageCache_.prototype.setSize=function(maxCacheSize){this.maxCacheSize_=maxCacheSize,this.expire()},exports.default=_ol_style_IconImageCache_},{"../color.js":36}],230:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"}},{}],231:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_style_Image_=function(options){this.opacity_=options.opacity,this.rotateWithView_=options.rotateWithView,this.rotation_=options.rotation,this.scale_=options.scale,this.snapToPixel_=options.snapToPixel};_ol_style_Image_.prototype.getOpacity=function(){return this.opacity_},_ol_style_Image_.prototype.getRotateWithView=function(){return this.rotateWithView_},_ol_style_Image_.prototype.getRotation=function(){return this.rotation_},_ol_style_Image_.prototype.getScale=function(){return this.scale_},_ol_style_Image_.prototype.getSnapToPixel=function(){return this.snapToPixel_},_ol_style_Image_.prototype.getAnchor=function(){},_ol_style_Image_.prototype.getImage=function(pixelRatio){},_ol_style_Image_.prototype.getHitDetectionImage=function(pixelRatio){},_ol_style_Image_.prototype.getImageState=function(){},_ol_style_Image_.prototype.getImageSize=function(){},_ol_style_Image_.prototype.getHitDetectionImageSize=function(){},_ol_style_Image_.prototype.getOrigin=function(){},_ol_style_Image_.prototype.getSize=function(){},_ol_style_Image_.prototype.setOpacity=function(opacity){this.opacity_=opacity},_ol_style_Image_.prototype.setRotateWithView=function(rotateWithView){this.rotateWithView_=rotateWithView},_ol_style_Image_.prototype.setRotation=function(rotation){this.rotation_=rotation},_ol_style_Image_.prototype.setScale=function(scale){this.scale_=scale},_ol_style_Image_.prototype.setSnapToPixel=function(snapToPixel){this.snapToPixel_=snapToPixel},_ol_style_Image_.prototype.listenImageChange=function(listener,thisArg){},_ol_style_Image_.prototype.load=function(){},_ol_style_Image_.prototype.unlistenImageChange=function(listener,thisArg){},exports.default=_ol_style_Image_},{}],232:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_colorlike2=_interopRequireDefault(require("../colorlike.js")),_dom2=_interopRequireDefault(require("../dom.js")),_has2=_interopRequireDefault(require("../has.js")),_imagestate2=_interopRequireDefault(require("../imagestate.js")),_canvas2=_interopRequireDefault(require("../render/canvas.js")),_image2=_interopRequireDefault(require("../style/image.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_style_RegularShape_=function(options){this.checksums_=null,this.canvas_=null,this.hitDetectionCanvas_=null,this.fill_=void 0!==options.fill?options.fill:null,this.origin_=[0,0],this.points_=options.points,this.radius_=void 0!==options.radius?options.radius:options.radius1,this.radius2_=options.radius2,this.angle_=void 0!==options.angle?options.angle:0,this.stroke_=void 0!==options.stroke?options.stroke:null,this.anchor_=null,this.size_=null,this.imageSize_=null,this.hitDetectionImageSize_=null,this.atlasManager_=options.atlasManager,this.render_(this.atlasManager_);var snapToPixel=void 0===options.snapToPixel||options.snapToPixel,rotateWithView=void 0!==options.rotateWithView&&options.rotateWithView;_image2.default.call(this,{opacity:1,rotateWithView:rotateWithView,rotation:void 0!==options.rotation?options.rotation:0,scale:1,snapToPixel:snapToPixel})};_index2.default.inherits(_ol_style_RegularShape_,_image2.default),_ol_style_RegularShape_.prototype.clone=function(){var style=new _ol_style_RegularShape_({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),snapToPixel:this.getSnapToPixel(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});return style.setOpacity(this.getOpacity()),style.setScale(this.getScale()),style},_ol_style_RegularShape_.prototype.getAnchor=function(){return this.anchor_},_ol_style_RegularShape_.prototype.getAngle=function(){return this.angle_},_ol_style_RegularShape_.prototype.getFill=function(){return this.fill_},_ol_style_RegularShape_.prototype.getHitDetectionImage=function(pixelRatio){return this.hitDetectionCanvas_},_ol_style_RegularShape_.prototype.getImage=function(pixelRatio){return this.canvas_},_ol_style_RegularShape_.prototype.getImageSize=function(){return this.imageSize_},_ol_style_RegularShape_.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},_ol_style_RegularShape_.prototype.getImageState=function(){return _imagestate2.default.LOADED},_ol_style_RegularShape_.prototype.getOrigin=function(){return this.origin_},_ol_style_RegularShape_.prototype.getPoints=function(){return this.points_},_ol_style_RegularShape_.prototype.getRadius=function(){return this.radius_},_ol_style_RegularShape_.prototype.getRadius2=function(){return this.radius2_},_ol_style_RegularShape_.prototype.getSize=function(){return this.size_},_ol_style_RegularShape_.prototype.getStroke=function(){return this.stroke_},_ol_style_RegularShape_.prototype.listenImageChange=function(listener,thisArg){},_ol_style_RegularShape_.prototype.load=function(){},_ol_style_RegularShape_.prototype.unlistenImageChange=function(listener,thisArg){},_ol_style_RegularShape_.prototype.render_=function(atlasManager){var imageSize,strokeStyle,lineCap="",lineJoin="",miterLimit=0,lineDash=null,lineDashOffset=0,strokeWidth=0;this.stroke_&&(null===(strokeStyle=this.stroke_.getColor())&&(strokeStyle=_canvas2.default.defaultStrokeStyle),strokeStyle=_colorlike2.default.asColorLike(strokeStyle),void 0===(strokeWidth=this.stroke_.getWidth())&&(strokeWidth=_canvas2.default.defaultLineWidth),lineDash=this.stroke_.getLineDash(),lineDashOffset=this.stroke_.getLineDashOffset(),_has2.default.CANVAS_LINE_DASH||(lineDash=null,lineDashOffset=0),void 0===(lineJoin=this.stroke_.getLineJoin())&&(lineJoin=_canvas2.default.defaultLineJoin),void 0===(lineCap=this.stroke_.getLineCap())&&(lineCap=_canvas2.default.defaultLineCap),void 0===(miterLimit=this.stroke_.getMiterLimit())&&(miterLimit=_canvas2.default.defaultMiterLimit));var size=2*(this.radius_+strokeWidth)+1,renderOptions={strokeStyle:strokeStyle,strokeWidth:strokeWidth,size:size,lineCap:lineCap,lineDash:lineDash,lineDashOffset:lineDashOffset,lineJoin:lineJoin,miterLimit:miterLimit};if(void 0===atlasManager){var context=_dom2.default.createCanvasContext2D(size,size);this.canvas_=context.canvas,imageSize=size=this.canvas_.width,this.draw_(renderOptions,context,0,0),this.createHitDetectionCanvas_(renderOptions)}else{size=Math.round(size);var renderHitDetectionCallback,hasCustomHitDetectionImage=!this.fill_;hasCustomHitDetectionImage&&(renderHitDetectionCallback=this.drawHitDetectionCanvas_.bind(this,renderOptions));var id=this.getChecksum(),info=atlasManager.add(id,size,size,this.draw_.bind(this,renderOptions),renderHitDetectionCallback);this.canvas_=info.image,this.origin_=[info.offsetX,info.offsetY],imageSize=info.image.width,this.hitDetectionImageSize_=hasCustomHitDetectionImage?(this.hitDetectionCanvas_=info.hitImage,[info.hitImage.width,info.hitImage.height]):(this.hitDetectionCanvas_=this.canvas_,[imageSize,imageSize])}this.anchor_=[size/2,size/2],this.size_=[size,size],this.imageSize_=[imageSize,imageSize]},_ol_style_RegularShape_.prototype.draw_=function(renderOptions,context,x,y){var i,angle0,radiusC;context.setTransform(1,0,0,1,0,0),context.translate(x,y),context.beginPath();var points=this.points_;if(points===1/0)context.arc(renderOptions.size/2,renderOptions.size/2,this.radius_,0,2*Math.PI,!0);else{var radius2=void 0!==this.radius2_?this.radius2_:this.radius_;for(radius2!==this.radius_&&(points*=2),i=0;i<=points;i++)angle0=2*i*Math.PI/points-Math.PI/2+this.angle_,radiusC=i%2==0?this.radius_:radius2,context.lineTo(renderOptions.size/2+radiusC*Math.cos(angle0),renderOptions.size/2+radiusC*Math.sin(angle0))}if(this.fill_){var color=this.fill_.getColor();null===color&&(color=_canvas2.default.defaultFillStyle),context.fillStyle=_colorlike2.default.asColorLike(color),context.fill()}this.stroke_&&(context.strokeStyle=renderOptions.strokeStyle,context.lineWidth=renderOptions.strokeWidth,renderOptions.lineDash&&(context.setLineDash(renderOptions.lineDash),context.lineDashOffset=renderOptions.lineDashOffset),context.lineCap=renderOptions.lineCap,context.lineJoin=renderOptions.lineJoin,context.miterLimit=renderOptions.miterLimit,context.stroke()),context.closePath()},_ol_style_RegularShape_.prototype.createHitDetectionCanvas_=function(renderOptions){if(this.hitDetectionImageSize_=[renderOptions.size,renderOptions.size],this.fill_)this.hitDetectionCanvas_=this.canvas_;else{var context=_dom2.default.createCanvasContext2D(renderOptions.size,renderOptions.size);this.hitDetectionCanvas_=context.canvas,this.drawHitDetectionCanvas_(renderOptions,context,0,0)}},_ol_style_RegularShape_.prototype.drawHitDetectionCanvas_=function(renderOptions,context,x,y){context.setTransform(1,0,0,1,0,0),context.translate(x,y),context.beginPath();var points=this.points_;if(points===1/0)context.arc(renderOptions.size/2,renderOptions.size/2,this.radius_,0,2*Math.PI,!0);else{var i,radiusC,angle0,radius2=void 0!==this.radius2_?this.radius2_:this.radius_;for(radius2!==this.radius_&&(points*=2),i=0;i<=points;i++)angle0=2*i*Math.PI/points-Math.PI/2+this.angle_,radiusC=i%2==0?this.radius_:radius2,context.lineTo(renderOptions.size/2+radiusC*Math.cos(angle0),renderOptions.size/2+radiusC*Math.sin(angle0))}context.fillStyle=_canvas2.default.defaultFillStyle,context.fill(),this.stroke_&&(context.strokeStyle=renderOptions.strokeStyle,context.lineWidth=renderOptions.strokeWidth,renderOptions.lineDash&&(context.setLineDash(renderOptions.lineDash),context.lineDashOffset=renderOptions.lineDashOffset),context.stroke()),context.closePath()},_ol_style_RegularShape_.prototype.getChecksum=function(){var strokeChecksum=this.stroke_?this.stroke_.getChecksum():"-",fillChecksum=this.fill_?this.fill_.getChecksum():"-";if(!this.checksums_||strokeChecksum!=this.checksums_[1]||fillChecksum!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6]){var checksum="r"+strokeChecksum+fillChecksum+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-");this.checksums_=[checksum,strokeChecksum,fillChecksum,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]},exports.default=_ol_style_RegularShape_},{"../colorlike.js":37,"../dom.js":46,"../has.js":84,"../imagestate.js":88,"../index.js":89,"../render/canvas.js":150,"../style/image.js":231}],233:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_index=require("../index.js"),_index2=(obj=_index)&&obj.__esModule?obj:{default:obj};var _ol_style_Stroke_=function(opt_options){var options=opt_options||{};this.color_=void 0!==options.color?options.color:null,this.lineCap_=options.lineCap,this.lineDash_=void 0!==options.lineDash?options.lineDash:null,this.lineDashOffset_=options.lineDashOffset,this.lineJoin_=options.lineJoin,this.miterLimit_=options.miterLimit,this.width_=options.width,this.checksum_=void 0};_ol_style_Stroke_.prototype.clone=function(){var color=this.getColor();return new _ol_style_Stroke_({color:color&&color.slice?color.slice():color||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},_ol_style_Stroke_.prototype.getColor=function(){return this.color_},_ol_style_Stroke_.prototype.getLineCap=function(){return this.lineCap_},_ol_style_Stroke_.prototype.getLineDash=function(){return this.lineDash_},_ol_style_Stroke_.prototype.getLineDashOffset=function(){return this.lineDashOffset_},_ol_style_Stroke_.prototype.getLineJoin=function(){return this.lineJoin_},_ol_style_Stroke_.prototype.getMiterLimit=function(){return this.miterLimit_},_ol_style_Stroke_.prototype.getWidth=function(){return this.width_},_ol_style_Stroke_.prototype.setColor=function(color){this.color_=color,this.checksum_=void 0},_ol_style_Stroke_.prototype.setLineCap=function(lineCap){this.lineCap_=lineCap,this.checksum_=void 0},_ol_style_Stroke_.prototype.setLineDash=function(lineDash){this.lineDash_=lineDash,this.checksum_=void 0},_ol_style_Stroke_.prototype.setLineDashOffset=function(lineDashOffset){this.lineDashOffset_=lineDashOffset,this.checksum_=void 0},_ol_style_Stroke_.prototype.setLineJoin=function(lineJoin){this.lineJoin_=lineJoin,this.checksum_=void 0},_ol_style_Stroke_.prototype.setMiterLimit=function(miterLimit){this.miterLimit_=miterLimit,this.checksum_=void 0},_ol_style_Stroke_.prototype.setWidth=function(width){this.width_=width,this.checksum_=void 0},_ol_style_Stroke_.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.checksum_="s",this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=_index2.default.getUid(this.color_).toString():this.checksum_+="-",this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")),this.checksum_},exports.default=_ol_style_Stroke_},{"../index.js":89}],234:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _asserts2=_interopRequireDefault(require("../asserts.js")),_geometrytype2=_interopRequireDefault(require("../geom/geometrytype.js")),_circle2=_interopRequireDefault(require("../style/circle.js")),_fill2=_interopRequireDefault(require("../style/fill.js")),_stroke2=_interopRequireDefault(require("../style/stroke.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_style_Style_=function(opt_options){var options=opt_options||{};this.geometry_=null,this.geometryFunction_=_ol_style_Style_.defaultGeometryFunction,void 0!==options.geometry&&this.setGeometry(options.geometry),this.fill_=void 0!==options.fill?options.fill:null,this.image_=void 0!==options.image?options.image:null,this.renderer_=void 0!==options.renderer?options.renderer:null,this.stroke_=void 0!==options.stroke?options.stroke:null,this.text_=void 0!==options.text?options.text:null,this.zIndex_=options.zIndex};_ol_style_Style_.prototype.clone=function(){var geometry=this.getGeometry();return geometry&&geometry.clone&&(geometry=geometry.clone()),new _ol_style_Style_({geometry:geometry,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},_ol_style_Style_.prototype.getRenderer=function(){return this.renderer_},_ol_style_Style_.prototype.setRenderer=function(renderer){this.renderer_=renderer},_ol_style_Style_.prototype.getGeometry=function(){return this.geometry_},_ol_style_Style_.prototype.getGeometryFunction=function(){return this.geometryFunction_},_ol_style_Style_.prototype.getFill=function(){return this.fill_},_ol_style_Style_.prototype.setFill=function(fill){this.fill_=fill},_ol_style_Style_.prototype.getImage=function(){return this.image_},_ol_style_Style_.prototype.setImage=function(image){this.image_=image},_ol_style_Style_.prototype.getStroke=function(){return this.stroke_},_ol_style_Style_.prototype.setStroke=function(stroke){this.stroke_=stroke},_ol_style_Style_.prototype.getText=function(){return this.text_},_ol_style_Style_.prototype.setText=function(text){this.text_=text},_ol_style_Style_.prototype.getZIndex=function(){return this.zIndex_},_ol_style_Style_.prototype.setGeometry=function(geometry){"function"==typeof geometry?this.geometryFunction_=geometry:"string"==typeof geometry?this.geometryFunction_=function(feature){return feature.get(geometry)}:geometry?void 0!==geometry&&(this.geometryFunction_=function(){return geometry}):this.geometryFunction_=_ol_style_Style_.defaultGeometryFunction,this.geometry_=geometry},_ol_style_Style_.prototype.setZIndex=function(zIndex){this.zIndex_=zIndex},_ol_style_Style_.createFunction=function(obj){var styleFunction,styles;"function"==typeof obj?styleFunction=obj:(styles=Array.isArray(obj)?obj:(_asserts2.default.assert(obj instanceof _ol_style_Style_,41),[obj]),styleFunction=function(){return styles});return styleFunction},_ol_style_Style_.default_=null,_ol_style_Style_.defaultFunction=function(feature,resolution){if(!_ol_style_Style_.default_){var fill=new _fill2.default({color:"rgba(255,255,255,0.4)"}),stroke=new _stroke2.default({color:"#3399CC",width:1.25});_ol_style_Style_.default_=[new _ol_style_Style_({image:new _circle2.default({fill:fill,stroke:stroke,radius:5}),fill:fill,stroke:stroke})]}return _ol_style_Style_.default_},_ol_style_Style_.createDefaultEditing=function(){var styles={},white=[255,255,255,1],blue=[0,153,255,1];return styles[_geometrytype2.default.POLYGON]=[new _ol_style_Style_({fill:new _fill2.default({color:[255,255,255,.5]})})],styles[_geometrytype2.default.MULTI_POLYGON]=styles[_geometrytype2.default.POLYGON],styles[_geometrytype2.default.LINE_STRING]=[new _ol_style_Style_({stroke:new _stroke2.default({color:white,width:5})}),new _ol_style_Style_({stroke:new _stroke2.default({color:blue,width:3})})],styles[_geometrytype2.default.MULTI_LINE_STRING]=styles[_geometrytype2.default.LINE_STRING],styles[_geometrytype2.default.CIRCLE]=styles[_geometrytype2.default.POLYGON].concat(styles[_geometrytype2.default.LINE_STRING]),styles[_geometrytype2.default.POINT]=[new _ol_style_Style_({image:new _circle2.default({radius:6,fill:new _fill2.default({color:blue}),stroke:new _stroke2.default({color:white,width:1.5})}),zIndex:1/0})],styles[_geometrytype2.default.MULTI_POINT]=styles[_geometrytype2.default.POINT],styles[_geometrytype2.default.GEOMETRY_COLLECTION]=styles[_geometrytype2.default.POLYGON].concat(styles[_geometrytype2.default.LINE_STRING],styles[_geometrytype2.default.POINT]),styles},_ol_style_Style_.defaultGeometryFunction=function(feature){return feature.getGeometry()},exports.default=_ol_style_Style_},{"../asserts.js":31,"../geom/geometrytype.js":79,"../style/circle.js":224,"../style/fill.js":225,"../style/stroke.js":233}],235:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _fill2=_interopRequireDefault(require("../style/fill.js")),_textplacement2=_interopRequireDefault(require("../style/textplacement.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_style_Text_=function(opt_options){var options=opt_options||{};this.font_=options.font,this.rotation_=options.rotation,this.rotateWithView_=options.rotateWithView,this.scale_=options.scale,this.text_=options.text,this.textAlign_=options.textAlign,this.textBaseline_=options.textBaseline,this.fill_=void 0!==options.fill?options.fill:new _fill2.default({color:_ol_style_Text_.DEFAULT_FILL_COLOR_}),this.maxAngle_=void 0!==options.maxAngle?options.maxAngle:Math.PI/4,this.placement_=void 0!==options.placement?options.placement:_textplacement2.default.POINT;var overflow=void 0===options.overflow?options.exceedLength:options.overflow;this.overflow_=void 0!==overflow&&overflow,this.stroke_=void 0!==options.stroke?options.stroke:null,this.offsetX_=void 0!==options.offsetX?options.offsetX:0,this.offsetY_=void 0!==options.offsetY?options.offsetY:0,this.backgroundFill_=options.backgroundFill?options.backgroundFill:null,this.backgroundStroke_=options.backgroundStroke?options.backgroundStroke:null,this.padding_=void 0===options.padding?null:options.padding};_ol_style_Text_.DEFAULT_FILL_COLOR_="#333",_ol_style_Text_.prototype.clone=function(){return new _ol_style_Text_({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY()})},_ol_style_Text_.prototype.getOverflow=function(){return this.overflow_},_ol_style_Text_.prototype.getFont=function(){return this.font_},_ol_style_Text_.prototype.getMaxAngle=function(){return this.maxAngle_},_ol_style_Text_.prototype.getPlacement=function(){return this.placement_},_ol_style_Text_.prototype.getOffsetX=function(){return this.offsetX_},_ol_style_Text_.prototype.getOffsetY=function(){return this.offsetY_},_ol_style_Text_.prototype.getFill=function(){return this.fill_},_ol_style_Text_.prototype.getRotateWithView=function(){return this.rotateWithView_},_ol_style_Text_.prototype.getRotation=function(){return this.rotation_},_ol_style_Text_.prototype.getScale=function(){return this.scale_},_ol_style_Text_.prototype.getStroke=function(){return this.stroke_},_ol_style_Text_.prototype.getText=function(){return this.text_},_ol_style_Text_.prototype.getTextAlign=function(){return this.textAlign_},_ol_style_Text_.prototype.getTextBaseline=function(){return this.textBaseline_},_ol_style_Text_.prototype.getBackgroundFill=function(){return this.backgroundFill_},_ol_style_Text_.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},_ol_style_Text_.prototype.getPadding=function(){return this.padding_},_ol_style_Text_.prototype.setOverflow=function(overflow){this.overflow_=overflow},_ol_style_Text_.prototype.setFont=function(font){this.font_=font},_ol_style_Text_.prototype.setMaxAngle=function(maxAngle){this.maxAngle_=maxAngle},_ol_style_Text_.prototype.setOffsetX=function(offsetX){this.offsetX_=offsetX},_ol_style_Text_.prototype.setOffsetY=function(offsetY){this.offsetY_=offsetY},_ol_style_Text_.prototype.setPlacement=function(placement){this.placement_=placement},_ol_style_Text_.prototype.setFill=function(fill){this.fill_=fill},_ol_style_Text_.prototype.setRotation=function(rotation){this.rotation_=rotation},_ol_style_Text_.prototype.setScale=function(scale){this.scale_=scale},_ol_style_Text_.prototype.setStroke=function(stroke){this.stroke_=stroke},_ol_style_Text_.prototype.setText=function(text){this.text_=text},_ol_style_Text_.prototype.setTextAlign=function(textAlign){this.textAlign_=textAlign},_ol_style_Text_.prototype.setTextBaseline=function(textBaseline){this.textBaseline_=textBaseline},_ol_style_Text_.prototype.setBackgroundFill=function(fill){this.backgroundFill_=fill},_ol_style_Text_.prototype.setBackgroundStroke=function(stroke){this.backgroundStroke_=stroke},_ol_style_Text_.prototype.setPadding=function(padding){this.padding_=padding},exports.default=_ol_style_Text_},{"../style/fill.js":225,"../style/textplacement.js":236}],236:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={POINT:"point",LINE:"line"}},{}],237:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_tilecoord_={createOrUpdate:function(z,x,y,opt_tileCoord){return void 0!==opt_tileCoord?(opt_tileCoord[0]=z,opt_tileCoord[1]=x,opt_tileCoord[2]=y,opt_tileCoord):[z,x,y]},getKeyZXY:function(z,x,y){return z+"/"+x+"/"+y},getKey:function(tileCoord){return _ol_tilecoord_.getKeyZXY(tileCoord[0],tileCoord[1],tileCoord[2])},fromKey:function(key){return key.split("/").map(Number)},hash:function(tileCoord){return(tileCoord[1]<<tileCoord[0])+tileCoord[2]},quadKey:function(tileCoord){var i,charCode,z=tileCoord[0],digits=new Array(z),mask=1<<z-1;for(i=0;i<z;++i)charCode=48,tileCoord[1]&mask&&(charCode+=1),tileCoord[2]&mask&&(charCode+=2),digits[i]=String.fromCharCode(charCode),mask>>=1;return digits.join("")},withinExtentAndZ:function(tileCoord,tileGrid){var z=tileCoord[0],x=tileCoord[1],y=tileCoord[2];if(tileGrid.getMinZoom()>z||z>tileGrid.getMaxZoom())return!1;var tileRange,extent=tileGrid.getExtent();return!(tileRange=extent?tileGrid.getTileRangeForExtentAndZ(extent,z):tileGrid.getFullTileRange(z))||tileRange.containsXY(x,y)}};exports.default=_ol_tilecoord_},{}],238:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_size2=_interopRequireDefault(require("./size.js")),_extent2=_interopRequireDefault(require("./extent.js")),_corner2=_interopRequireDefault(require("./extent/corner.js")),_obj2=_interopRequireDefault(require("./obj.js")),_proj2=_interopRequireDefault(require("./proj.js")),_units2=_interopRequireDefault(require("./proj/units.js")),_tilegrid2=_interopRequireDefault(require("./tilegrid/tilegrid.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_tilegrid_={getForProjection:function(projection){var tileGrid=projection.getDefaultTileGrid();return tileGrid||(tileGrid=_ol_tilegrid_.createForProjection(projection),projection.setDefaultTileGrid(tileGrid)),tileGrid},wrapX:function(tileGrid,tileCoord,projection){var z=tileCoord[0],center=tileGrid.getTileCoordCenter(tileCoord),projectionExtent=_ol_tilegrid_.extentFromProjection(projection);if(_extent2.default.containsCoordinate(projectionExtent,center))return tileCoord;var worldWidth=_extent2.default.getWidth(projectionExtent),worldsAway=Math.ceil((projectionExtent[0]-center[0])/worldWidth);return center[0]+=worldWidth*worldsAway,tileGrid.getTileCoordForCoordAndZ(center,z)},createForExtent:function(extent,opt_maxZoom,opt_tileSize,opt_corner){var corner=void 0!==opt_corner?opt_corner:_corner2.default.TOP_LEFT,resolutions=_ol_tilegrid_.resolutionsFromExtent(extent,opt_maxZoom,opt_tileSize);return new _tilegrid2.default({extent:extent,origin:_extent2.default.getCorner(extent,corner),resolutions:resolutions,tileSize:opt_tileSize})},createXYZ:function(opt_options){var options={};return _obj2.default.assign(options,void 0!==opt_options?opt_options:{}),void 0===options.extent&&(options.extent=_proj2.default.get("EPSG:3857").getExtent()),options.resolutions=_ol_tilegrid_.resolutionsFromExtent(options.extent,options.maxZoom,options.tileSize),delete options.maxZoom,new _tilegrid2.default(options)},resolutionsFromExtent:function(extent,opt_maxZoom,opt_tileSize){for(var maxZoom=void 0!==opt_maxZoom?opt_maxZoom:_index2.default.DEFAULT_MAX_ZOOM,height=_extent2.default.getHeight(extent),width=_extent2.default.getWidth(extent),tileSize=_size2.default.toSize(void 0!==opt_tileSize?opt_tileSize:_index2.default.DEFAULT_TILE_SIZE),maxResolution=Math.max(width/tileSize[0],height/tileSize[1]),length=maxZoom+1,resolutions=new Array(length),z=0;z<length;++z)resolutions[z]=maxResolution/Math.pow(2,z);return resolutions},createForProjection:function(projection,opt_maxZoom,opt_tileSize,opt_corner){var extent=_ol_tilegrid_.extentFromProjection(projection);return _ol_tilegrid_.createForExtent(extent,opt_maxZoom,opt_tileSize,opt_corner)},extentFromProjection:function(projection){var extent=(projection=_proj2.default.get(projection)).getExtent();if(!extent){var half=180*_proj2.default.METERS_PER_UNIT[_units2.default.DEGREES]/projection.getMetersPerUnit();extent=_extent2.default.createOrUpdate(-half,-half,half,half)}return extent}};exports.default=_ol_tilegrid_},{"./extent.js":54,"./extent/corner.js":55,"./index.js":89,"./obj.js":124,"./proj.js":141,"./proj/units.js":148,"./size.js":208,"./tilegrid/tilegrid.js":239}],239:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_asserts2=_interopRequireDefault(require("../asserts.js")),_tilerange2=_interopRequireDefault(require("../tilerange.js")),_array2=_interopRequireDefault(require("../array.js")),_extent2=_interopRequireDefault(require("../extent.js")),_math2=_interopRequireDefault(require("../math.js")),_size2=_interopRequireDefault(require("../size.js")),_tilecoord2=_interopRequireDefault(require("../tilecoord.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_tilegrid_TileGrid_=function(options){var zoomFactor;if(this.minZoom=void 0!==options.minZoom?options.minZoom:0,this.resolutions_=options.resolutions,_asserts2.default.assert(_array2.default.isSorted(this.resolutions_,function(a,b){return b-a},!0),17),!options.origins)for(var i=0,ii=this.resolutions_.length-1;i<ii;++i)if(zoomFactor){if(this.resolutions_[i]/this.resolutions_[i+1]!==zoomFactor){zoomFactor=void 0;break}}else zoomFactor=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=zoomFactor,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==options.origin?options.origin:null,this.origins_=null,void 0!==options.origins&&(this.origins_=options.origins,_asserts2.default.assert(this.origins_.length==this.resolutions_.length,20));var extent=options.extent;void 0===extent||this.origin_||this.origins_||(this.origin_=_extent2.default.getTopLeft(extent)),_asserts2.default.assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==options.tileSizes&&(this.tileSizes_=options.tileSizes,_asserts2.default.assert(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==options.tileSize?options.tileSize:this.tileSizes_?null:_index2.default.DEFAULT_TILE_SIZE,_asserts2.default.assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==extent?extent:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==options.sizes?this.fullTileRanges_=options.sizes.map(function(size,z){return new _tilerange2.default(Math.min(0,size[0]),Math.max(size[0]-1,-1),Math.min(0,size[1]),Math.max(size[1]-1,-1))},this):extent&&this.calculateTileRanges_(extent)};_ol_tilegrid_TileGrid_.tmpTileCoord_=[0,0,0],_ol_tilegrid_TileGrid_.prototype.forEachTileCoord=function(extent,zoom,callback){for(var tileRange=this.getTileRangeForExtentAndZ(extent,zoom),i=tileRange.minX,ii=tileRange.maxX;i<=ii;++i)for(var j=tileRange.minY,jj=tileRange.maxY;j<=jj;++j)callback([zoom,i,j])},_ol_tilegrid_TileGrid_.prototype.forEachTileCoordParentTileRange=function(tileCoord,callback,opt_this,opt_tileRange,opt_extent){var tileRange,x,y,tileCoordExtent=null,z=tileCoord[0]-1;for(2===this.zoomFactor_?(x=tileCoord[1],y=tileCoord[2]):tileCoordExtent=this.getTileCoordExtent(tileCoord,opt_extent);z>=this.minZoom;){if(tileRange=2===this.zoomFactor_?(x=Math.floor(x/2),y=Math.floor(y/2),_tilerange2.default.createOrUpdate(x,x,y,y,opt_tileRange)):this.getTileRangeForExtentAndZ(tileCoordExtent,z,opt_tileRange),callback.call(opt_this,z,tileRange))return!0;--z}return!1},_ol_tilegrid_TileGrid_.prototype.getExtent=function(){return this.extent_},_ol_tilegrid_TileGrid_.prototype.getMaxZoom=function(){return this.maxZoom},_ol_tilegrid_TileGrid_.prototype.getMinZoom=function(){return this.minZoom},_ol_tilegrid_TileGrid_.prototype.getOrigin=function(z){return this.origin_?this.origin_:this.origins_[z]},_ol_tilegrid_TileGrid_.prototype.getResolution=function(z){return this.resolutions_[z]},_ol_tilegrid_TileGrid_.prototype.getResolutions=function(){return this.resolutions_},_ol_tilegrid_TileGrid_.prototype.getTileCoordChildTileRange=function(tileCoord,opt_tileRange,opt_extent){if(tileCoord[0]<this.maxZoom){if(2===this.zoomFactor_){var minX=2*tileCoord[1],minY=2*tileCoord[2];return _tilerange2.default.createOrUpdate(minX,minX+1,minY,minY+1,opt_tileRange)}var tileCoordExtent=this.getTileCoordExtent(tileCoord,opt_extent);return this.getTileRangeForExtentAndZ(tileCoordExtent,tileCoord[0]+1,opt_tileRange)}return null},_ol_tilegrid_TileGrid_.prototype.getTileRangeExtent=function(z,tileRange,opt_extent){var origin=this.getOrigin(z),resolution=this.getResolution(z),tileSize=_size2.default.toSize(this.getTileSize(z),this.tmpSize_),minX=origin[0]+tileRange.minX*tileSize[0]*resolution,maxX=origin[0]+(tileRange.maxX+1)*tileSize[0]*resolution,minY=origin[1]+tileRange.minY*tileSize[1]*resolution,maxY=origin[1]+(tileRange.maxY+1)*tileSize[1]*resolution;return _extent2.default.createOrUpdate(minX,minY,maxX,maxY,opt_extent)},_ol_tilegrid_TileGrid_.prototype.getTileRangeForExtentAndZ=function(extent,z,opt_tileRange){var tileCoord=_ol_tilegrid_TileGrid_.tmpTileCoord_;this.getTileCoordForXYAndZ_(extent[0],extent[1],z,!1,tileCoord);var minX=tileCoord[1],minY=tileCoord[2];return this.getTileCoordForXYAndZ_(extent[2],extent[3],z,!0,tileCoord),_tilerange2.default.createOrUpdate(minX,tileCoord[1],minY,tileCoord[2],opt_tileRange)},_ol_tilegrid_TileGrid_.prototype.getTileCoordCenter=function(tileCoord){var origin=this.getOrigin(tileCoord[0]),resolution=this.getResolution(tileCoord[0]),tileSize=_size2.default.toSize(this.getTileSize(tileCoord[0]),this.tmpSize_);return[origin[0]+(tileCoord[1]+.5)*tileSize[0]*resolution,origin[1]+(tileCoord[2]+.5)*tileSize[1]*resolution]},_ol_tilegrid_TileGrid_.prototype.getTileCoordExtent=function(tileCoord,opt_extent){var origin=this.getOrigin(tileCoord[0]),resolution=this.getResolution(tileCoord[0]),tileSize=_size2.default.toSize(this.getTileSize(tileCoord[0]),this.tmpSize_),minX=origin[0]+tileCoord[1]*tileSize[0]*resolution,minY=origin[1]+tileCoord[2]*tileSize[1]*resolution,maxX=minX+tileSize[0]*resolution,maxY=minY+tileSize[1]*resolution;return _extent2.default.createOrUpdate(minX,minY,maxX,maxY,opt_extent)},_ol_tilegrid_TileGrid_.prototype.getTileCoordForCoordAndResolution=function(coordinate,resolution,opt_tileCoord){return this.getTileCoordForXYAndResolution_(coordinate[0],coordinate[1],resolution,!1,opt_tileCoord)},_ol_tilegrid_TileGrid_.prototype.getTileCoordForXYAndResolution_=function(x,y,resolution,reverseIntersectionPolicy,opt_tileCoord){var z=this.getZForResolution(resolution),scale=resolution/this.getResolution(z),origin=this.getOrigin(z),tileSize=_size2.default.toSize(this.getTileSize(z),this.tmpSize_),adjustX=reverseIntersectionPolicy?.5:0,adjustY=reverseIntersectionPolicy?0:.5,xFromOrigin=Math.floor((x-origin[0])/resolution+adjustX),yFromOrigin=Math.floor((y-origin[1])/resolution+adjustY),tileCoordX=scale*xFromOrigin/tileSize[0],tileCoordY=scale*yFromOrigin/tileSize[1];return tileCoordY=reverseIntersectionPolicy?(tileCoordX=Math.ceil(tileCoordX)-1,Math.ceil(tileCoordY)-1):(tileCoordX=Math.floor(tileCoordX),Math.floor(tileCoordY)),_tilecoord2.default.createOrUpdate(z,tileCoordX,tileCoordY,opt_tileCoord)},_ol_tilegrid_TileGrid_.prototype.getTileCoordForXYAndZ_=function(x,y,z,reverseIntersectionPolicy,opt_tileCoord){var origin=this.getOrigin(z),resolution=this.getResolution(z),tileSize=_size2.default.toSize(this.getTileSize(z),this.tmpSize_),adjustX=reverseIntersectionPolicy?.5:0,adjustY=reverseIntersectionPolicy?0:.5,xFromOrigin=Math.floor((x-origin[0])/resolution+adjustX),yFromOrigin=Math.floor((y-origin[1])/resolution+adjustY),tileCoordX=xFromOrigin/tileSize[0],tileCoordY=yFromOrigin/tileSize[1];return tileCoordY=reverseIntersectionPolicy?(tileCoordX=Math.ceil(tileCoordX)-1,Math.ceil(tileCoordY)-1):(tileCoordX=Math.floor(tileCoordX),Math.floor(tileCoordY)),_tilecoord2.default.createOrUpdate(z,tileCoordX,tileCoordY,opt_tileCoord)},_ol_tilegrid_TileGrid_.prototype.getTileCoordForCoordAndZ=function(coordinate,z,opt_tileCoord){return this.getTileCoordForXYAndZ_(coordinate[0],coordinate[1],z,!1,opt_tileCoord)},_ol_tilegrid_TileGrid_.prototype.getTileCoordResolution=function(tileCoord){return this.resolutions_[tileCoord[0]]},_ol_tilegrid_TileGrid_.prototype.getTileSize=function(z){return this.tileSize_?this.tileSize_:this.tileSizes_[z]},_ol_tilegrid_TileGrid_.prototype.getFullTileRange=function(z){return this.fullTileRanges_?this.fullTileRanges_[z]:null},_ol_tilegrid_TileGrid_.prototype.getZForResolution=function(resolution,opt_direction){var z=_array2.default.linearFindNearest(this.resolutions_,resolution,opt_direction||0);return _math2.default.clamp(z,this.minZoom,this.maxZoom)},_ol_tilegrid_TileGrid_.prototype.calculateTileRanges_=function(extent){for(var length=this.resolutions_.length,fullTileRanges=new Array(length),z=this.minZoom;z<length;++z)fullTileRanges[z]=this.getTileRangeForExtentAndZ(extent,z);this.fullTileRanges_=fullTileRanges},exports.default=_ol_tilegrid_TileGrid_},{"../array.js":29,"../asserts.js":31,"../extent.js":54,"../index.js":89,"../math.js":123,"../size.js":208,"../tilecoord.js":237,"../tilerange.js":241}],240:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_tilestate2=_interopRequireDefault(require("./tilestate.js")),_events2=_interopRequireDefault(require("./events.js")),_eventtype2=_interopRequireDefault(require("./events/eventtype.js")),_priorityqueue2=_interopRequireDefault(require("./structs/priorityqueue.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_TileQueue_=function(tilePriorityFunction,tileChangeCallback){_priorityqueue2.default.call(this,function(element){return tilePriorityFunction.apply(null,element)},function(element){return element[0].getKey()}),this.tileChangeCallback_=tileChangeCallback,this.tilesLoading_=0,this.tilesLoadingKeys_={}};_index2.default.inherits(_ol_TileQueue_,_priorityqueue2.default),_ol_TileQueue_.prototype.enqueue=function(element){var added=_priorityqueue2.default.prototype.enqueue.call(this,element);if(added){var tile=element[0];_events2.default.listen(tile,_eventtype2.default.CHANGE,this.handleTileChange,this)}return added},_ol_TileQueue_.prototype.getTilesLoading=function(){return this.tilesLoading_},_ol_TileQueue_.prototype.handleTileChange=function(event){var tile=event.target,state=tile.getState();if(state===_tilestate2.default.LOADED||state===_tilestate2.default.ERROR||state===_tilestate2.default.EMPTY||state===_tilestate2.default.ABORT){_events2.default.unlisten(tile,_eventtype2.default.CHANGE,this.handleTileChange,this);var tileKey=tile.getKey();tileKey in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[tileKey],--this.tilesLoading_),this.tileChangeCallback_()}},_ol_TileQueue_.prototype.loadMoreTiles=function(maxTotalLoading,maxNewLoads){for(var state,tile,tileKey,newLoads=0,abortedTiles=!1;this.tilesLoading_<maxTotalLoading&&newLoads<maxNewLoads&&0<this.getCount();)tileKey=(tile=this.dequeue()[0]).getKey(),(state=tile.getState())===_tilestate2.default.ABORT?abortedTiles=!0:state!==_tilestate2.default.IDLE||tileKey in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[tileKey]=!0,++this.tilesLoading_,++newLoads,tile.load());0===newLoads&&abortedTiles&&this.tileChangeCallback_()},exports.default=_ol_TileQueue_},{"./events.js":48,"./events/eventtype.js":52,"./index.js":89,"./structs/priorityqueue.js":219,"./tilestate.js":242}],241:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_TileRange_=function(minX,maxX,minY,maxY){this.minX=minX,this.maxX=maxX,this.minY=minY,this.maxY=maxY};_ol_TileRange_.createOrUpdate=function(minX,maxX,minY,maxY,tileRange){return void 0!==tileRange?(tileRange.minX=minX,tileRange.maxX=maxX,tileRange.minY=minY,tileRange.maxY=maxY,tileRange):new _ol_TileRange_(minX,maxX,minY,maxY)},_ol_TileRange_.prototype.contains=function(tileCoord){return this.containsXY(tileCoord[1],tileCoord[2])},_ol_TileRange_.prototype.containsTileRange=function(tileRange){return this.minX<=tileRange.minX&&tileRange.maxX<=this.maxX&&this.minY<=tileRange.minY&&tileRange.maxY<=this.maxY},_ol_TileRange_.prototype.containsXY=function(x,y){return this.minX<=x&&x<=this.maxX&&this.minY<=y&&y<=this.maxY},_ol_TileRange_.prototype.equals=function(tileRange){return this.minX==tileRange.minX&&this.minY==tileRange.minY&&this.maxX==tileRange.maxX&&this.maxY==tileRange.maxY},_ol_TileRange_.prototype.extend=function(tileRange){tileRange.minX<this.minX&&(this.minX=tileRange.minX),tileRange.maxX>this.maxX&&(this.maxX=tileRange.maxX),tileRange.minY<this.minY&&(this.minY=tileRange.minY),tileRange.maxY>this.maxY&&(this.maxY=tileRange.maxY)},_ol_TileRange_.prototype.getHeight=function(){return this.maxY-this.minY+1},_ol_TileRange_.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},_ol_TileRange_.prototype.getWidth=function(){return this.maxX-this.minX+1},_ol_TileRange_.prototype.intersects=function(tileRange){return this.minX<=tileRange.maxX&&this.maxX>=tileRange.minX&&this.minY<=tileRange.maxY&&this.maxY>=tileRange.minY},exports.default=_ol_TileRange_},{}],242:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5}},{}],243:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_asserts=require("./asserts.js"),_asserts2=(obj=_asserts)&&obj.__esModule?obj:{default:obj};var _ol_transform_={};_ol_transform_.tmp_=new Array(6),_ol_transform_.create=function(){return[1,0,0,1,0,0]},_ol_transform_.reset=function(transform){return _ol_transform_.set(transform,1,0,0,1,0,0)},_ol_transform_.multiply=function(transform1,transform2){var a1=transform1[0],b1=transform1[1],c1=transform1[2],d1=transform1[3],e1=transform1[4],f1=transform1[5],a2=transform2[0],b2=transform2[1],c2=transform2[2],d2=transform2[3],e2=transform2[4],f2=transform2[5];return transform1[0]=a1*a2+c1*b2,transform1[1]=b1*a2+d1*b2,transform1[2]=a1*c2+c1*d2,transform1[3]=b1*c2+d1*d2,transform1[4]=a1*e2+c1*f2+e1,transform1[5]=b1*e2+d1*f2+f1,transform1},_ol_transform_.set=function(transform,a,b,c,d,e,f){return transform[0]=a,transform[1]=b,transform[2]=c,transform[3]=d,transform[4]=e,transform[5]=f,transform},_ol_transform_.setFromArray=function(transform1,transform2){return transform1[0]=transform2[0],transform1[1]=transform2[1],transform1[2]=transform2[2],transform1[3]=transform2[3],transform1[4]=transform2[4],transform1[5]=transform2[5],transform1},_ol_transform_.apply=function(transform,coordinate){var x=coordinate[0],y=coordinate[1];return coordinate[0]=transform[0]*x+transform[2]*y+transform[4],coordinate[1]=transform[1]*x+transform[3]*y+transform[5],coordinate},_ol_transform_.rotate=function(transform,angle){var cos=Math.cos(angle),sin=Math.sin(angle);return _ol_transform_.multiply(transform,_ol_transform_.set(_ol_transform_.tmp_,cos,sin,-sin,cos,0,0))},_ol_transform_.scale=function(transform,x,y){return _ol_transform_.multiply(transform,_ol_transform_.set(_ol_transform_.tmp_,x,0,0,y,0,0))},_ol_transform_.translate=function(transform,dx,dy){return _ol_transform_.multiply(transform,_ol_transform_.set(_ol_transform_.tmp_,1,0,0,1,dx,dy))},_ol_transform_.compose=function(transform,dx1,dy1,sx,sy,angle,dx2,dy2){var sin=Math.sin(angle),cos=Math.cos(angle);return transform[0]=sx*cos,transform[1]=sy*sin,transform[2]=-sx*sin,transform[3]=sy*cos,transform[4]=dx2*sx*cos-dy2*sx*sin+dx1,transform[5]=dx2*sy*sin+dy2*sy*cos+dy1,transform},_ol_transform_.invert=function(transform){var det=_ol_transform_.determinant(transform);_asserts2.default.assert(0!==det,32);var a=transform[0],b=transform[1],c=transform[2],d=transform[3],e=transform[4],f=transform[5];return transform[0]=d/det,transform[1]=-b/det,transform[2]=-c/det,transform[3]=a/det,transform[4]=(c*f-d*e)/det,transform[5]=-(a*f-b*e)/det,transform},_ol_transform_.determinant=function(mat){return mat[0]*mat[3]-mat[1]*mat[2]},exports.default=_ol_transform_},{"./asserts.js":31}],244:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_vec_Mat4_={create:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},fromTransform:function(mat4,transform){return mat4[0]=transform[0],mat4[1]=transform[1],mat4[4]=transform[2],mat4[5]=transform[3],mat4[12]=transform[4],mat4[13]=transform[5],mat4}};exports.default=_ol_vec_Mat4_},{}],245:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("./index.js")),_centerconstraint2=_interopRequireDefault(require("./centerconstraint.js")),_object2=_interopRequireDefault(require("./object.js")),_resolutionconstraint2=_interopRequireDefault(require("./resolutionconstraint.js")),_rotationconstraint2=_interopRequireDefault(require("./rotationconstraint.js")),_viewhint2=_interopRequireDefault(require("./viewhint.js")),_viewproperty2=_interopRequireDefault(require("./viewproperty.js")),_array2=_interopRequireDefault(require("./array.js")),_asserts2=_interopRequireDefault(require("./asserts.js")),_coordinate2=_interopRequireDefault(require("./coordinate.js")),_easing2=_interopRequireDefault(require("./easing.js")),_extent2=_interopRequireDefault(require("./extent.js")),_geometrytype2=_interopRequireDefault(require("./geom/geometrytype.js")),_polygon2=_interopRequireDefault(require("./geom/polygon.js")),_simplegeometry2=_interopRequireDefault(require("./geom/simplegeometry.js")),_math2=_interopRequireDefault(require("./math.js")),_obj2=_interopRequireDefault(require("./obj.js")),_proj2=_interopRequireDefault(require("./proj.js")),_units2=_interopRequireDefault(require("./proj/units.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_View_=function(opt_options){_object2.default.call(this);var options=_obj2.default.assign({},opt_options);this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.updateAnimations_=this.updateAnimations_.bind(this),this.projection_=_proj2.default.createProjection(options.projection,"EPSG:3857"),this.applyOptions_(options)};_index2.default.inherits(_ol_View_,_object2.default),_ol_View_.prototype.applyOptions_=function(options){var properties={};properties[_viewproperty2.default.CENTER]=void 0!==options.center?options.center:null;var resolutionConstraintInfo=_ol_View_.createResolutionConstraint_(options);this.maxResolution_=resolutionConstraintInfo.maxResolution,this.minResolution_=resolutionConstraintInfo.minResolution,this.zoomFactor_=resolutionConstraintInfo.zoomFactor,this.resolutions_=options.resolutions,this.minZoom_=resolutionConstraintInfo.minZoom;var centerConstraint=_ol_View_.createCenterConstraint_(options),resolutionConstraint=resolutionConstraintInfo.constraint,rotationConstraint=_ol_View_.createRotationConstraint_(options);this.constraints_={center:centerConstraint,resolution:resolutionConstraint,rotation:rotationConstraint},void 0!==options.resolution?properties[_viewproperty2.default.RESOLUTION]=options.resolution:void 0!==options.zoom&&(properties[_viewproperty2.default.RESOLUTION]=this.constrainResolution(this.maxResolution_,options.zoom-this.minZoom_),this.resolutions_&&(properties[_viewproperty2.default.RESOLUTION]=_math2.default.clamp(Number(this.getResolution()||properties[_viewproperty2.default.RESOLUTION]),this.minResolution_,this.maxResolution_))),properties[_viewproperty2.default.ROTATION]=void 0!==options.rotation?options.rotation:0,this.setProperties(properties),this.options_=options},_ol_View_.prototype.getUpdatedOptions_=function(newOptions){var options=_obj2.default.assign({},this.options_);return void 0!==options.resolution?options.resolution=this.getResolution():options.zoom=this.getZoom(),options.center=this.getCenter(),options.rotation=this.getRotation(),_obj2.default.assign({},options,newOptions)},_ol_View_.prototype.animate=function(var_args){var callback,animationCount=arguments.length;if(1<animationCount&&"function"==typeof arguments[animationCount-1]&&(callback=arguments[animationCount-1],--animationCount),!this.isDef()){var state=arguments[animationCount-1];return state.center&&this.setCenter(state.center),void 0!==state.zoom&&this.setZoom(state.zoom),void 0!==state.rotation&&this.setRotation(state.rotation),void(callback&&callback(!0))}for(var start=Date.now(),center=this.getCenter().slice(),resolution=this.getResolution(),rotation=this.getRotation(),series=[],i=0;i<animationCount;++i){var options=arguments[i],animation={start:start,complete:!1,anchor:options.anchor,duration:void 0!==options.duration?options.duration:1e3,easing:options.easing||_easing2.default.inAndOut};if(options.center&&(animation.sourceCenter=center,animation.targetCenter=options.center,center=animation.targetCenter),void 0!==options.zoom?(animation.sourceResolution=resolution,animation.targetResolution=this.constrainResolution(this.maxResolution_,options.zoom-this.minZoom_,0),resolution=animation.targetResolution):options.resolution&&(animation.sourceResolution=resolution,animation.targetResolution=options.resolution,resolution=animation.targetResolution),void 0!==options.rotation){animation.sourceRotation=rotation;var delta=_math2.default.modulo(options.rotation-rotation+Math.PI,2*Math.PI)-Math.PI;animation.targetRotation=rotation+delta,rotation=animation.targetRotation}animation.callback=callback,_ol_View_.isNoopAnimation(animation)?animation.complete=!0:start+=animation.duration,series.push(animation)}this.animations_.push(series),this.setHint(_viewhint2.default.ANIMATING,1),this.updateAnimations_()},_ol_View_.prototype.getAnimating=function(){return 0<this.hints_[_viewhint2.default.ANIMATING]},_ol_View_.prototype.getInteracting=function(){return 0<this.hints_[_viewhint2.default.INTERACTING]},_ol_View_.prototype.cancelAnimations=function(){this.setHint(_viewhint2.default.ANIMATING,-this.hints_[_viewhint2.default.ANIMATING]);for(var i=0,ii=this.animations_.length;i<ii;++i){var series=this.animations_[i];series[0].callback&&series[0].callback(!1)}this.animations_.length=0},_ol_View_.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var now=Date.now(),more=!1,i=this.animations_.length-1;0<=i;--i){for(var series=this.animations_[i],seriesComplete=!0,j=0,jj=series.length;j<jj;++j){var animation=series[j];if(!animation.complete){var elapsed=now-animation.start,fraction=0<animation.duration?elapsed/animation.duration:1;1<=fraction?(animation.complete=!0,fraction=1):seriesComplete=!1;var progress=animation.easing(fraction);if(animation.sourceCenter){var x0=animation.sourceCenter[0],y0=animation.sourceCenter[1],x=x0+progress*(animation.targetCenter[0]-x0),y=y0+progress*(animation.targetCenter[1]-y0);this.set(_viewproperty2.default.CENTER,[x,y])}if(animation.sourceResolution&&animation.targetResolution){var resolution=1===progress?animation.targetResolution:animation.sourceResolution+progress*(animation.targetResolution-animation.sourceResolution);animation.anchor&&this.set(_viewproperty2.default.CENTER,this.calculateCenterZoom(resolution,animation.anchor)),this.set(_viewproperty2.default.RESOLUTION,resolution)}if(void 0!==animation.sourceRotation&&void 0!==animation.targetRotation){var rotation=1===progress?_math2.default.modulo(animation.targetRotation+Math.PI,2*Math.PI)-Math.PI:animation.sourceRotation+progress*(animation.targetRotation-animation.sourceRotation);animation.anchor&&this.set(_viewproperty2.default.CENTER,this.calculateCenterRotate(rotation,animation.anchor)),this.set(_viewproperty2.default.ROTATION,rotation)}if(more=!0,!animation.complete)break}}if(seriesComplete){this.animations_[i]=null,this.setHint(_viewhint2.default.ANIMATING,-1);var callback=series[0].callback;callback&&callback(!0)}}this.animations_=this.animations_.filter(Boolean),more&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}},_ol_View_.prototype.calculateCenterRotate=function(rotation,anchor){var center,currentCenter=this.getCenter();return void 0!==currentCenter&&(center=[currentCenter[0]-anchor[0],currentCenter[1]-anchor[1]],_coordinate2.default.rotate(center,rotation-this.getRotation()),_coordinate2.default.add(center,anchor)),center},_ol_View_.prototype.calculateCenterZoom=function(resolution,anchor){var center,currentCenter=this.getCenter(),currentResolution=this.getResolution();void 0!==currentCenter&&void 0!==currentResolution&&(center=[anchor[0]-resolution*(anchor[0]-currentCenter[0])/currentResolution,anchor[1]-resolution*(anchor[1]-currentCenter[1])/currentResolution]);return center},_ol_View_.prototype.getSizeFromViewport_=function(){var size=[100,100],selector='.ol-viewport[data-view="'+_index2.default.getUid(this)+'"]',element=document.querySelector(selector);if(element){var metrics=getComputedStyle(element);size[0]=parseInt(metrics.width,10),size[1]=parseInt(metrics.height,10)}return size},_ol_View_.prototype.constrainCenter=function(center){return this.constraints_.center(center)},_ol_View_.prototype.constrainResolution=function(resolution,opt_delta,opt_direction){var delta=opt_delta||0,direction=opt_direction||0;return this.constraints_.resolution(resolution,delta,direction)},_ol_View_.prototype.constrainRotation=function(rotation,opt_delta){var delta=opt_delta||0;return this.constraints_.rotation(rotation,delta)},_ol_View_.prototype.getCenter=function(){return this.get(_viewproperty2.default.CENTER)},_ol_View_.prototype.getConstraints=function(){return this.constraints_},_ol_View_.prototype.getHints=function(opt_hints){return void 0!==opt_hints?(opt_hints[0]=this.hints_[0],opt_hints[1]=this.hints_[1],opt_hints):this.hints_.slice()},_ol_View_.prototype.calculateExtent=function(opt_size){var size=opt_size||this.getSizeFromViewport_(),center=this.getCenter();_asserts2.default.assert(center,1);var resolution=this.getResolution();_asserts2.default.assert(void 0!==resolution,2);var rotation=this.getRotation();return _asserts2.default.assert(void 0!==rotation,3),_extent2.default.getForViewAndSize(center,resolution,rotation,size)},_ol_View_.prototype.getMaxResolution=function(){return this.maxResolution_},_ol_View_.prototype.getMinResolution=function(){return this.minResolution_},_ol_View_.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},_ol_View_.prototype.setMaxZoom=function(zoom){this.applyOptions_(this.getUpdatedOptions_({maxZoom:zoom}))},_ol_View_.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},_ol_View_.prototype.setMinZoom=function(zoom){this.applyOptions_(this.getUpdatedOptions_({minZoom:zoom}))},_ol_View_.prototype.getProjection=function(){return this.projection_},_ol_View_.prototype.getResolution=function(){return this.get(_viewproperty2.default.RESOLUTION)},_ol_View_.prototype.getResolutions=function(){return this.resolutions_},_ol_View_.prototype.getResolutionForExtent=function(extent,opt_size){var size=opt_size||this.getSizeFromViewport_(),xResolution=_extent2.default.getWidth(extent)/size[0],yResolution=_extent2.default.getHeight(extent)/size[1];return Math.max(xResolution,yResolution)},_ol_View_.prototype.getResolutionForValueFunction=function(opt_power){var power=opt_power||2,maxResolution=this.maxResolution_,minResolution=this.minResolution_,max=Math.log(maxResolution/minResolution)/Math.log(power);return function(value){return maxResolution/Math.pow(power,value*max)}},_ol_View_.prototype.getRotation=function(){return this.get(_viewproperty2.default.ROTATION)},_ol_View_.prototype.getValueForResolutionFunction=function(opt_power){var power=opt_power||2,maxResolution=this.maxResolution_,minResolution=this.minResolution_,max=Math.log(maxResolution/minResolution)/Math.log(power);return function(resolution){return Math.log(maxResolution/resolution)/Math.log(power)/max}},_ol_View_.prototype.getState=function(){var center=this.getCenter(),projection=this.getProjection(),resolution=this.getResolution(),rotation=this.getRotation();return{center:center.slice(),projection:void 0!==projection?projection:null,resolution:resolution,rotation:rotation,zoom:this.getZoom()}},_ol_View_.prototype.getZoom=function(){var zoom,resolution=this.getResolution();return void 0!==resolution&&(zoom=this.getZoomForResolution(resolution)),zoom},_ol_View_.prototype.getZoomForResolution=function(resolution){var max,zoomFactor,offset=this.minZoom_||0;if(this.resolutions_){var nearest=_array2.default.linearFindNearest(this.resolutions_,resolution,1);offset=nearest,max=this.resolutions_[nearest],zoomFactor=nearest==this.resolutions_.length-1?2:max/this.resolutions_[nearest+1]}else max=this.maxResolution_,zoomFactor=this.zoomFactor_;return offset+Math.log(max/resolution)/Math.log(zoomFactor)},_ol_View_.prototype.getResolutionForZoom=function(zoom){return this.constrainResolution(this.maxResolution_,zoom-this.minZoom_,0)},_ol_View_.prototype.fit=function(geometryOrExtent,opt_options){var geometry,options=opt_options||{},size=options.size;size||(size=this.getSizeFromViewport_()),geometryOrExtent instanceof _simplegeometry2.default?geometryOrExtent.getType()===_geometrytype2.default.CIRCLE?(geometryOrExtent=geometryOrExtent.getExtent(),(geometry=_polygon2.default.fromExtent(geometryOrExtent)).rotate(this.getRotation(),_extent2.default.getCenter(geometryOrExtent))):geometry=geometryOrExtent:(_asserts2.default.assert(Array.isArray(geometryOrExtent),24),_asserts2.default.assert(!_extent2.default.isEmpty(geometryOrExtent),25),geometry=_polygon2.default.fromExtent(geometryOrExtent));var minResolution,padding=void 0!==options.padding?options.padding:[0,0,0,0],constrainResolution=void 0===options.constrainResolution||options.constrainResolution,nearest=void 0!==options.nearest&&options.nearest;minResolution=void 0!==options.minResolution?options.minResolution:void 0!==options.maxZoom?this.constrainResolution(this.maxResolution_,options.maxZoom-this.minZoom_,0):0;for(var coords=geometry.getFlatCoordinates(),rotation=this.getRotation(),cosAngle=Math.cos(-rotation),sinAngle=Math.sin(-rotation),minRotX=1/0,minRotY=1/0,maxRotX=-1/0,maxRotY=-1/0,stride=geometry.getStride(),i=0,ii=coords.length;i<ii;i+=stride){var rotX=coords[i]*cosAngle-coords[i+1]*sinAngle,rotY=coords[i]*sinAngle+coords[i+1]*cosAngle;minRotX=Math.min(minRotX,rotX),minRotY=Math.min(minRotY,rotY),maxRotX=Math.max(maxRotX,rotX),maxRotY=Math.max(maxRotY,rotY)}var resolution=this.getResolutionForExtent([minRotX,minRotY,maxRotX,maxRotY],[size[0]-padding[1]-padding[3],size[1]-padding[0]-padding[2]]);if(resolution=isNaN(resolution)?minResolution:Math.max(resolution,minResolution),constrainResolution){var constrainedResolution=this.constrainResolution(resolution,0,0);!nearest&&constrainedResolution<resolution&&(constrainedResolution=this.constrainResolution(constrainedResolution,-1,0)),resolution=constrainedResolution}sinAngle=-sinAngle;var centerRotX=(minRotX+maxRotX)/2,centerRotY=(minRotY+maxRotY)/2,center=[(centerRotX+=(padding[1]-padding[3])/2*resolution)*cosAngle-(centerRotY+=(padding[0]-padding[2])/2*resolution)*sinAngle,centerRotY*cosAngle+centerRotX*sinAngle],callback=options.callback?options.callback:_index2.default.nullFunction;void 0!==options.duration?this.animate({resolution:resolution,center:center,duration:options.duration,easing:options.easing},callback):(this.setResolution(resolution),this.setCenter(center),setTimeout(callback.bind(void 0,!0),0))},_ol_View_.prototype.centerOn=function(coordinate,size,position){var rotation=this.getRotation(),cosAngle=Math.cos(-rotation),sinAngle=Math.sin(-rotation),rotX=coordinate[0]*cosAngle-coordinate[1]*sinAngle,rotY=coordinate[1]*cosAngle+coordinate[0]*sinAngle,resolution=this.getResolution(),centerX=(rotX+=(size[0]/2-position[0])*resolution)*cosAngle-(rotY+=(position[1]-size[1]/2)*resolution)*(sinAngle=-sinAngle),centerY=rotY*cosAngle+rotX*sinAngle;this.setCenter([centerX,centerY])},_ol_View_.prototype.isDef=function(){return!!this.getCenter()&&void 0!==this.getResolution()},_ol_View_.prototype.rotate=function(rotation,opt_anchor){if(void 0!==opt_anchor){var center=this.calculateCenterRotate(rotation,opt_anchor);this.setCenter(center)}this.setRotation(rotation)},_ol_View_.prototype.setCenter=function(center){this.set(_viewproperty2.default.CENTER,center),this.getAnimating()&&this.cancelAnimations()},_ol_View_.prototype.setHint=function(hint,delta){return this.hints_[hint]+=delta,this.changed(),this.hints_[hint]},_ol_View_.prototype.setResolution=function(resolution){this.set(_viewproperty2.default.RESOLUTION,resolution),this.getAnimating()&&this.cancelAnimations()},_ol_View_.prototype.setRotation=function(rotation){this.set(_viewproperty2.default.ROTATION,rotation),this.getAnimating()&&this.cancelAnimations()},_ol_View_.prototype.setZoom=function(zoom){this.setResolution(this.getResolutionForZoom(zoom))},_ol_View_.createCenterConstraint_=function(options){return void 0!==options.extent?_centerconstraint2.default.createExtent(options.extent):_centerconstraint2.default.none},_ol_View_.createResolutionConstraint_=function(options){var resolutionConstraint,maxResolution,minResolution,minZoom=void 0!==options.minZoom?options.minZoom:_index2.default.DEFAULT_MIN_ZOOM,maxZoom=void 0!==options.maxZoom?options.maxZoom:28,zoomFactor=void 0!==options.zoomFactor?options.zoomFactor:2;if(void 0!==options.resolutions){var resolutions=options.resolutions;maxResolution=resolutions[minZoom],minResolution=void 0!==resolutions[maxZoom]?resolutions[maxZoom]:resolutions[resolutions.length-1],resolutionConstraint=_resolutionconstraint2.default.createSnapToResolutions(resolutions)}else{var projection=_proj2.default.createProjection(options.projection,"EPSG:3857"),extent=projection.getExtent(),defaultMaxResolution=(extent?Math.max(_extent2.default.getWidth(extent),_extent2.default.getHeight(extent)):360*_proj2.default.METERS_PER_UNIT[_units2.default.DEGREES]/projection.getMetersPerUnit())/_index2.default.DEFAULT_TILE_SIZE/Math.pow(2,_index2.default.DEFAULT_MIN_ZOOM),defaultMinResolution=defaultMaxResolution/Math.pow(2,28-_index2.default.DEFAULT_MIN_ZOOM);void 0!==(maxResolution=options.maxResolution)?minZoom=0:maxResolution=defaultMaxResolution/Math.pow(zoomFactor,minZoom),void 0===(minResolution=options.minResolution)&&(minResolution=void 0!==options.maxZoom?void 0!==options.maxResolution?maxResolution/Math.pow(zoomFactor,maxZoom):defaultMaxResolution/Math.pow(zoomFactor,maxZoom):defaultMinResolution),maxZoom=minZoom+Math.floor(Math.log(maxResolution/minResolution)/Math.log(zoomFactor)),minResolution=maxResolution/Math.pow(zoomFactor,maxZoom-minZoom),resolutionConstraint=_resolutionconstraint2.default.createSnapToPower(zoomFactor,maxResolution,maxZoom-minZoom)}return{constraint:resolutionConstraint,maxResolution:maxResolution,minResolution:minResolution,minZoom:minZoom,zoomFactor:zoomFactor}},_ol_View_.createRotationConstraint_=function(options){if(void 0===options.enableRotation||options.enableRotation){var constrainRotation=options.constrainRotation;return void 0===constrainRotation||!0===constrainRotation?_rotationconstraint2.default.createSnapToZero():!1===constrainRotation?_rotationconstraint2.default.none:"number"==typeof constrainRotation?_rotationconstraint2.default.createSnapToN(constrainRotation):_rotationconstraint2.default.none}return _rotationconstraint2.default.disable},_ol_View_.isNoopAnimation=function(animation){return!(animation.sourceCenter&&animation.targetCenter&&!_coordinate2.default.equals(animation.sourceCenter,animation.targetCenter))&&(animation.sourceResolution===animation.targetResolution&&animation.sourceRotation===animation.targetRotation)},exports.default=_ol_View_},{"./array.js":29,"./asserts.js":31,"./centerconstraint.js":33,"./coordinate.js":43,"./easing.js":47,"./extent.js":54,"./geom/geometrytype.js":79,"./geom/polygon.js":82,"./geom/simplegeometry.js":83,"./index.js":89,"./math.js":123,"./obj.js":124,"./object.js":125,"./proj.js":141,"./proj/units.js":148,"./resolutionconstraint.js":206,"./rotationconstraint.js":207,"./viewhint.js":246,"./viewproperty.js":247}],246:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={ANIMATING:0,INTERACTING:1}},{}],247:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"}},{}],248:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ol_webgl_={ONE:1,SRC_ALPHA:770,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,TRIANGLES:4,TRIANGLE_STRIP:5,ONE_MINUS_SRC_ALPHA:771,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,CULL_FACE:2884,BLEND:3042,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126,RGBA:6408,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,LINK_STATUS:35714,LINEAR:9729,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE0:33984,CLAMP_TO_EDGE:33071,COMPILE_STATUS:35713,FRAMEBUFFER:36160,CONTEXT_IDS_:["experimental-webgl","webgl","webkit-3d","moz-webgl"],getContext:function(canvas,opt_attributes){var context,i,ii=_ol_webgl_.CONTEXT_IDS_.length;for(i=0;i<ii;++i)try{if(context=canvas.getContext(_ol_webgl_.CONTEXT_IDS_[i],opt_attributes))return context}catch(e){}return null}};exports.default=_ol_webgl_},{}],249:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_webgl=require("../webgl.js"),_webgl2=(obj=_webgl)&&obj.__esModule?obj:{default:obj};var _ol_webgl_Buffer_=function(opt_arr,opt_usage){this.arr_=void 0!==opt_arr?opt_arr:[],this.usage_=void 0!==opt_usage?opt_usage:_ol_webgl_Buffer_.Usage_.STATIC_DRAW};_ol_webgl_Buffer_.prototype.getArray=function(){return this.arr_},_ol_webgl_Buffer_.prototype.getUsage=function(){return this.usage_},_ol_webgl_Buffer_.Usage_={STATIC_DRAW:_webgl2.default.STATIC_DRAW,STREAM_DRAW:_webgl2.default.STREAM_DRAW,DYNAMIC_DRAW:_webgl2.default.DYNAMIC_DRAW},exports.default=_ol_webgl_Buffer_},{"../webgl.js":248}],250:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_disposable2=_interopRequireDefault(require("../disposable.js")),_array2=_interopRequireDefault(require("../array.js")),_events2=_interopRequireDefault(require("../events.js")),_obj2=_interopRequireDefault(require("../obj.js")),_webgl2=_interopRequireDefault(require("../webgl.js")),_contexteventtype2=_interopRequireDefault(require("../webgl/contexteventtype.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_webgl_Context_=function(canvas,gl){this.canvas_=canvas,this.gl_=gl,this.bufferCache_={},this.shaderCache_={},this.programCache_={},this.currentProgram_=null,this.hitDetectionFramebuffer_=null,this.hitDetectionTexture_=null,this.hitDetectionRenderbuffer_=null,this.hasOESElementIndexUint=_array2.default.includes(_index2.default.WEBGL_EXTENSIONS,"OES_element_index_uint"),this.hasOESElementIndexUint&&gl.getExtension("OES_element_index_uint"),_events2.default.listen(this.canvas_,_contexteventtype2.default.LOST,this.handleWebGLContextLost,this),_events2.default.listen(this.canvas_,_contexteventtype2.default.RESTORED,this.handleWebGLContextRestored,this)};_index2.default.inherits(_ol_webgl_Context_,_disposable2.default),_ol_webgl_Context_.prototype.bindBuffer=function(target,buf){var gl=this.getGL(),arr=buf.getArray(),bufferKey=String(_index2.default.getUid(buf));if(bufferKey in this.bufferCache_){var bufferCacheEntry=this.bufferCache_[bufferKey];gl.bindBuffer(target,bufferCacheEntry.buffer)}else{var arrayBuffer,buffer=gl.createBuffer();gl.bindBuffer(target,buffer),target==_webgl2.default.ARRAY_BUFFER?arrayBuffer=new Float32Array(arr):target==_webgl2.default.ELEMENT_ARRAY_BUFFER&&(arrayBuffer=this.hasOESElementIndexUint?new Uint32Array(arr):new Uint16Array(arr)),gl.bufferData(target,arrayBuffer,buf.getUsage()),this.bufferCache_[bufferKey]={buf:buf,buffer:buffer}}},_ol_webgl_Context_.prototype.deleteBuffer=function(buf){var gl=this.getGL(),bufferKey=String(_index2.default.getUid(buf)),bufferCacheEntry=this.bufferCache_[bufferKey];gl.isContextLost()||gl.deleteBuffer(bufferCacheEntry.buffer),delete this.bufferCache_[bufferKey]},_ol_webgl_Context_.prototype.disposeInternal=function(){_events2.default.unlistenAll(this.canvas_);var gl=this.getGL();if(!gl.isContextLost()){var key;for(key in this.bufferCache_)gl.deleteBuffer(this.bufferCache_[key].buffer);for(key in this.programCache_)gl.deleteProgram(this.programCache_[key]);for(key in this.shaderCache_)gl.deleteShader(this.shaderCache_[key]);gl.deleteFramebuffer(this.hitDetectionFramebuffer_),gl.deleteRenderbuffer(this.hitDetectionRenderbuffer_),gl.deleteTexture(this.hitDetectionTexture_)}},_ol_webgl_Context_.prototype.getCanvas=function(){return this.canvas_},_ol_webgl_Context_.prototype.getGL=function(){return this.gl_},_ol_webgl_Context_.prototype.getHitDetectionFramebuffer=function(){return this.hitDetectionFramebuffer_||this.initHitDetectionFramebuffer_(),this.hitDetectionFramebuffer_},_ol_webgl_Context_.prototype.getShader=function(shaderObject){var shaderKey=String(_index2.default.getUid(shaderObject));if(shaderKey in this.shaderCache_)return this.shaderCache_[shaderKey];var gl=this.getGL(),shader=gl.createShader(shaderObject.getType());return gl.shaderSource(shader,shaderObject.getSource()),gl.compileShader(shader),this.shaderCache_[shaderKey]=shader},_ol_webgl_Context_.prototype.getProgram=function(fragmentShaderObject,vertexShaderObject){var programKey=_index2.default.getUid(fragmentShaderObject)+"/"+_index2.default.getUid(vertexShaderObject);if(programKey in this.programCache_)return this.programCache_[programKey];var gl=this.getGL(),program=gl.createProgram();return gl.attachShader(program,this.getShader(fragmentShaderObject)),gl.attachShader(program,this.getShader(vertexShaderObject)),gl.linkProgram(program),this.programCache_[programKey]=program},_ol_webgl_Context_.prototype.handleWebGLContextLost=function(){_obj2.default.clear(this.bufferCache_),_obj2.default.clear(this.shaderCache_),_obj2.default.clear(this.programCache_),this.currentProgram_=null,this.hitDetectionFramebuffer_=null,this.hitDetectionTexture_=null,this.hitDetectionRenderbuffer_=null},_ol_webgl_Context_.prototype.handleWebGLContextRestored=function(){},_ol_webgl_Context_.prototype.initHitDetectionFramebuffer_=function(){var gl=this.gl_,framebuffer=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer);var texture=_ol_webgl_Context_.createEmptyTexture(gl,1,1),renderbuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,renderbuffer),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,1,1),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,renderbuffer),gl.bindTexture(gl.TEXTURE_2D,null),gl.bindRenderbuffer(gl.RENDERBUFFER,null),gl.bindFramebuffer(gl.FRAMEBUFFER,null),this.hitDetectionFramebuffer_=framebuffer,this.hitDetectionTexture_=texture,this.hitDetectionRenderbuffer_=renderbuffer},_ol_webgl_Context_.prototype.useProgram=function(program){return program!=this.currentProgram_&&(this.getGL().useProgram(program),this.currentProgram_=program,!0)},_ol_webgl_Context_.createTexture_=function(gl,opt_wrapS,opt_wrapT){var texture=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),void 0!==opt_wrapS&&gl.texParameteri(_webgl2.default.TEXTURE_2D,_webgl2.default.TEXTURE_WRAP_S,opt_wrapS),void 0!==opt_wrapT&&gl.texParameteri(_webgl2.default.TEXTURE_2D,_webgl2.default.TEXTURE_WRAP_T,opt_wrapT),texture},_ol_webgl_Context_.createEmptyTexture=function(gl,width,height,opt_wrapS,opt_wrapT){var texture=_ol_webgl_Context_.createTexture_(gl,opt_wrapS,opt_wrapT);return gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null),texture},_ol_webgl_Context_.createTexture=function(gl,image,opt_wrapS,opt_wrapT){var texture=_ol_webgl_Context_.createTexture_(gl,opt_wrapS,opt_wrapT);return gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image),texture},exports.default=_ol_webgl_Context_},{"../array.js":29,"../disposable.js":45,"../events.js":48,"../index.js":89,"../obj.js":124,"../webgl.js":248,"../webgl/contexteventtype.js":251}],251:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"}},{}],252:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_webgl2=_interopRequireDefault(require("../webgl.js")),_shader2=_interopRequireDefault(require("../webgl/shader.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_webgl_Fragment_=function(source){_shader2.default.call(this,source)};_index2.default.inherits(_ol_webgl_Fragment_,_shader2.default),_ol_webgl_Fragment_.prototype.getType=function(){return _webgl2.default.FRAGMENT_SHADER},exports.default=_ol_webgl_Fragment_},{"../index.js":89,"../webgl.js":248,"../webgl/shader.js":253}],253:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_functions=require("../functions.js"),_functions2=(obj=_functions)&&obj.__esModule?obj:{default:obj};var _ol_webgl_Shader_=function(source){this.source_=source};_ol_webgl_Shader_.prototype.getType=function(){},_ol_webgl_Shader_.prototype.getSource=function(){return this.source_},_ol_webgl_Shader_.prototype.isAnimated=_functions2.default.FALSE,exports.default=_ol_webgl_Shader_},{"../functions.js":60}],254:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index2=_interopRequireDefault(require("../index.js")),_webgl2=_interopRequireDefault(require("../webgl.js")),_shader2=_interopRequireDefault(require("../webgl/shader.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _ol_webgl_Vertex_=function(source){_shader2.default.call(this,source)};_index2.default.inherits(_ol_webgl_Vertex_,_shader2.default),_ol_webgl_Vertex_.prototype.getType=function(){return _webgl2.default.VERTEX_SHADER},exports.default=_ol_webgl_Vertex_},{"../index.js":89,"../webgl.js":248,"../webgl/shader.js":253}],255:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var obj,_array=require("./array.js"),_array2=(obj=_array)&&obj.__esModule?obj:{default:obj};var _ol_xml_={};_ol_xml_.DOCUMENT=document.implementation.createDocument("","",null),_ol_xml_.createElementNS=function(namespaceURI,qualifiedName){return _ol_xml_.DOCUMENT.createElementNS(namespaceURI,qualifiedName)},_ol_xml_.getAllTextContent=function(node,normalizeWhitespace){return _ol_xml_.getAllTextContent_(node,normalizeWhitespace,[]).join("")},_ol_xml_.getAllTextContent_=function(node,normalizeWhitespace,accumulator){var n;if(node.nodeType==Node.CDATA_SECTION_NODE||node.nodeType==Node.TEXT_NODE)normalizeWhitespace?accumulator.push(String(node.nodeValue).replace(/(\r\n|\r|\n)/g,"")):accumulator.push(node.nodeValue);else for(n=node.firstChild;n;n=n.nextSibling)_ol_xml_.getAllTextContent_(n,normalizeWhitespace,accumulator);return accumulator},_ol_xml_.isDocument=function(value){return value instanceof Document},_ol_xml_.isNode=function(value){return value instanceof Node},_ol_xml_.getAttributeNS=function(node,namespaceURI,name){return node.getAttributeNS(namespaceURI,name)||""},_ol_xml_.setAttributeNS=function(node,namespaceURI,name,value){node.setAttributeNS(namespaceURI,name,value)},_ol_xml_.parse=function(xml){return(new DOMParser).parseFromString(xml,"application/xml")},_ol_xml_.makeArrayExtender=function(valueReader,opt_this){return function(node,objectStack){var value=valueReader.call(opt_this,node,objectStack);if(void 0!==value){var array=objectStack[objectStack.length-1];_array2.default.extend(array,value)}}},_ol_xml_.makeArrayPusher=function(valueReader,opt_this){return function(node,objectStack){var value=valueReader.call(void 0!==opt_this?opt_this:this,node,objectStack);void 0!==value&&objectStack[objectStack.length-1].push(value)}},_ol_xml_.makeReplacer=function(valueReader,opt_this){return function(node,objectStack){var value=valueReader.call(void 0!==opt_this?opt_this:this,node,objectStack);void 0!==value&&(objectStack[objectStack.length-1]=value)}},_ol_xml_.makeObjectPropertyPusher=function(valueReader,opt_property,opt_this){return function(node,objectStack){var value=valueReader.call(void 0!==opt_this?opt_this:this,node,objectStack);if(void 0!==value){var object=objectStack[objectStack.length-1],property=void 0!==opt_property?opt_property:node.localName;(property in object?object[property]:object[property]=[]).push(value)}}},_ol_xml_.makeObjectPropertySetter=function(valueReader,opt_property,opt_this){return function(node,objectStack){var value=valueReader.call(void 0!==opt_this?opt_this:this,node,objectStack);void 0!==value&&(objectStack[objectStack.length-1][void 0!==opt_property?opt_property:node.localName]=value)}},_ol_xml_.makeChildAppender=function(nodeWriter,opt_this){return function(node,value,objectStack){nodeWriter.call(void 0!==opt_this?opt_this:this,node,value,objectStack),objectStack[objectStack.length-1].node.appendChild(node)}},_ol_xml_.makeArraySerializer=function(nodeWriter,opt_this){var serializersNS,nodeFactory;return function(node,value,objectStack){if(void 0===serializersNS){serializersNS={};var serializers={};serializers[node.localName]=nodeWriter,serializersNS[node.namespaceURI]=serializers,nodeFactory=_ol_xml_.makeSimpleNodeFactory(node.localName)}_ol_xml_.serialize(serializersNS,nodeFactory,value,objectStack)}},_ol_xml_.makeSimpleNodeFactory=function(opt_nodeName,opt_namespaceURI){var fixedNodeName=opt_nodeName;return function(value,objectStack,opt_nodeName){var node=objectStack[objectStack.length-1].node,nodeName=fixedNodeName;void 0===nodeName&&(nodeName=opt_nodeName);var namespaceURI=opt_namespaceURI;return void 0===opt_namespaceURI&&(namespaceURI=node.namespaceURI),_ol_xml_.createElementNS(namespaceURI,nodeName)}},_ol_xml_.OBJECT_PROPERTY_NODE_FACTORY=_ol_xml_.makeSimpleNodeFactory(),_ol_xml_.makeSequence=function(object,orderedKeys){for(var length=orderedKeys.length,sequence=new Array(length),i=0;i<length;++i)sequence[i]=object[orderedKeys[i]];return sequence},_ol_xml_.makeStructureNS=function(namespaceURIs,structure,opt_structureNS){var i,ii,structureNS=void 0!==opt_structureNS?opt_structureNS:{};for(i=0,ii=namespaceURIs.length;i<ii;++i)structureNS[namespaceURIs[i]]=structure;return structureNS},_ol_xml_.parseNode=function(parsersNS,node,objectStack,opt_this){var n;for(n=node.firstElementChild;n;n=n.nextElementSibling){var parsers=parsersNS[n.namespaceURI];if(void 0!==parsers){var parser=parsers[n.localName];void 0!==parser&&parser.call(opt_this,n,objectStack)}}},_ol_xml_.pushParseAndPop=function(object,parsersNS,node,objectStack,opt_this){return objectStack.push(object),_ol_xml_.parseNode(parsersNS,node,objectStack,opt_this),objectStack.pop()},_ol_xml_.serialize=function(serializersNS,nodeFactory,values,objectStack,opt_keys,opt_this){for(var value,node,length=(void 0!==opt_keys?opt_keys:values).length,i=0;i<length;++i)void 0!==(value=values[i])&&void 0!==(node=nodeFactory.call(opt_this,value,objectStack,void 0!==opt_keys?opt_keys[i]:void 0))&&serializersNS[node.namespaceURI][node.localName].call(opt_this,node,value,objectStack)},_ol_xml_.pushSerializeAndPop=function(object,serializersNS,nodeFactory,values,objectStack,opt_keys,opt_this){return objectStack.push(object),_ol_xml_.serialize(serializersNS,nodeFactory,values,objectStack,opt_keys,opt_this),objectStack.pop()},exports.default=_ol_xml_},{"./array.js":29}],256:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],257:[function(require,module,exports){var global,factory;global=this,factory=function(){"use strict";function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:b<a?1:0}return function(arr,k,left,right,compare){!function quickselectStep(arr,k,left,right,compare){for(;left<right;){if(600<right-left){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1),newLeft=Math.max(left,Math.floor(k-m*s/n+sd)),newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));quickselectStep(arr,k,newLeft,newRight,compare)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),0<compare(arr[right],t)&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;0<compare(arr[j],t);)j--}0===compare(arr[left],t)?swap(arr,left,j):swap(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}(arr,k,left||0,right||arr.length-1,compare||defaultCompare)}},"object"==typeof exports&&void 0!==module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.quickselect=factory()},{}],258:[function(require,module,exports){"use strict";module.exports=rbush;var quickselect=require("quickselect");function rbush(maxEntries,format){if(!(this instanceof rbush))return new rbush(maxEntries,format);this._maxEntries=Math.max(4,maxEntries||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),format&&this._initFormat(format),this.clear()}function findItem(item,items,equalsFn){if(!equalsFn)return items.indexOf(item);for(var i=0;i<items.length;i++)if(equalsFn(item,items[i]))return i;return-1}function calcBBox(node,toBBox){distBBox(node,0,node.children.length,toBBox,node)}function distBBox(node,k,p,toBBox,destNode){destNode||(destNode=createNode(null)),destNode.minX=1/0,destNode.minY=1/0,destNode.maxX=-1/0,destNode.maxY=-1/0;for(var child,i=k;i<p;i++)child=node.children[i],extend(destNode,node.leaf?toBBox(child):child);return destNode}function extend(a,b){return a.minX=Math.min(a.minX,b.minX),a.minY=Math.min(a.minY,b.minY),a.maxX=Math.max(a.maxX,b.maxX),a.maxY=Math.max(a.maxY,b.maxY),a}function compareNodeMinX(a,b){return a.minX-b.minX}function compareNodeMinY(a,b){return a.minY-b.minY}function bboxArea(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function bboxMargin(a){return a.maxX-a.minX+(a.maxY-a.minY)}function contains(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function intersects(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function createNode(children){return{children:children,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(arr,left,right,n,compare){for(var mid,stack=[left,right];stack.length;)(right=stack.pop())-(left=stack.pop())<=n||(mid=left+Math.ceil((right-left)/n/2)*n,quickselect(arr,mid,left,right,compare),stack.push(left,mid,mid,right))}rbush.prototype={all:function(){return this._all(this.data,[])},search:function(bbox){var node=this.data,result=[],toBBox=this.toBBox;if(!intersects(bbox,node))return result;for(var i,len,child,childBBox,nodesToSearch=[];node;){for(i=0,len=node.children.length;i<len;i++)child=node.children[i],intersects(bbox,childBBox=node.leaf?toBBox(child):child)&&(node.leaf?result.push(child):contains(bbox,childBBox)?this._all(child,result):nodesToSearch.push(child));node=nodesToSearch.pop()}return result},collides:function(bbox){var node=this.data,toBBox=this.toBBox;if(!intersects(bbox,node))return!1;for(var i,len,child,childBBox,nodesToSearch=[];node;){for(i=0,len=node.children.length;i<len;i++)if(child=node.children[i],intersects(bbox,childBBox=node.leaf?toBBox(child):child)){if(node.leaf||contains(bbox,childBBox))return!0;nodesToSearch.push(child)}node=nodesToSearch.pop()}return!1},load:function(data){if(!data||!data.length)return this;if(data.length<this._minEntries){for(var i=0,len=data.length;i<len;i++)this.insert(data[i]);return this}var node=this._build(data.slice(),0,data.length-1,0);if(this.data.children.length)if(this.data.height===node.height)this._splitRoot(this.data,node);else{if(this.data.height<node.height){var tmpNode=this.data;this.data=node,node=tmpNode}this._insert(node,this.data.height-node.height-1,!0)}else this.data=node;return this},insert:function(item){return item&&this._insert(item,this.data.height-1),this},clear:function(){return this.data=createNode([]),this},remove:function(item,equalsFn){if(!item)return this;for(var i,parent,index,goingUp,node=this.data,bbox=this.toBBox(item),path=[],indexes=[];node||path.length;){if(node||(node=path.pop(),parent=path[path.length-1],i=indexes.pop(),goingUp=!0),node.leaf&&-1!==(index=findItem(item,node.children,equalsFn)))return node.children.splice(index,1),path.push(node),this._condense(path),this;goingUp||node.leaf||!contains(node,bbox)?parent?(i++,node=parent.children[i],goingUp=!1):node=null:(path.push(node),indexes.push(i),i=0,node=(parent=node).children[0])}return this},toBBox:function(item){return item},compareMinX:compareNodeMinX,compareMinY:compareNodeMinY,toJSON:function(){return this.data},fromJSON:function(data){return this.data=data,this},_all:function(node,result){for(var nodesToSearch=[];node;)node.leaf?result.push.apply(result,node.children):nodesToSearch.push.apply(nodesToSearch,node.children),node=nodesToSearch.pop();return result},_build:function(items,left,right,height){var node,N=right-left+1,M=this._maxEntries;if(N<=M)return calcBBox(node=createNode(items.slice(left,right+1)),this.toBBox),node;height||(height=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,height-1))),(node=createNode([])).leaf=!1,node.height=height;var i,j,right2,right3,N2=Math.ceil(N/M),N1=N2*Math.ceil(Math.sqrt(M));for(multiSelect(items,left,right,N1,this.compareMinX),i=left;i<=right;i+=N1)for(multiSelect(items,i,right2=Math.min(i+N1-1,right),N2,this.compareMinY),j=i;j<=right2;j+=N2)right3=Math.min(j+N2-1,right2),node.children.push(this._build(items,j,right3,height-1));return calcBBox(node,this.toBBox),node},_chooseSubtree:function(bbox,node,level,path){for(var i,len,child,targetNode,area,enlargement,minArea,minEnlargement,a,b;path.push(node),!node.leaf&&path.length-1!==level;){for(minArea=minEnlargement=1/0,i=0,len=node.children.length;i<len;i++)area=bboxArea(child=node.children[i]),a=bbox,b=child,(enlargement=(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY))-area)<minEnlargement?(minEnlargement=enlargement,minArea=area<minArea?area:minArea,targetNode=child):enlargement===minEnlargement&&area<minArea&&(minArea=area,targetNode=child);node=targetNode||node.children[0]}return node},_insert:function(item,level,isNode){var toBBox=this.toBBox,bbox=isNode?item:toBBox(item),insertPath=[],node=this._chooseSubtree(bbox,this.data,level,insertPath);for(node.children.push(item),extend(node,bbox);0<=level&&insertPath[level].children.length>this._maxEntries;)this._split(insertPath,level),level--;this._adjustParentBBoxes(bbox,insertPath,level)},_split:function(insertPath,level){var node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);var splitIndex=this._chooseSplitIndex(node,m,M),newNode=createNode(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height,newNode.leaf=node.leaf,calcBBox(node,this.toBBox),calcBBox(newNode,this.toBBox),level?insertPath[level-1].children.push(newNode):this._splitRoot(node,newNode)},_splitRoot:function(node,newNode){this.data=createNode([node,newNode]),this.data.height=node.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)},_chooseSplitIndex:function(node,m,M){var i,bbox1,bbox2,overlap,area,minOverlap,minArea,index,a,b,minX,minY,maxX,maxY;for(minOverlap=minArea=1/0,i=m;i<=M-m;i++)bbox1=distBBox(node,0,i,this.toBBox),bbox2=distBBox(node,i,M,this.toBBox),a=bbox1,b=bbox2,void 0,minX=Math.max(a.minX,b.minX),minY=Math.max(a.minY,b.minY),maxX=Math.min(a.maxX,b.maxX),maxY=Math.min(a.maxY,b.maxY),overlap=Math.max(0,maxX-minX)*Math.max(0,maxY-minY),area=bboxArea(bbox1)+bboxArea(bbox2),overlap<minOverlap?(minOverlap=overlap,index=i,minArea=area<minArea?area:minArea):overlap===minOverlap&&area<minArea&&(minArea=area,index=i);return index},_chooseSplitAxis:function(node,m,M){var compareMinX=node.leaf?this.compareMinX:compareNodeMinX,compareMinY=node.leaf?this.compareMinY:compareNodeMinY;this._allDistMargin(node,m,M,compareMinX)<this._allDistMargin(node,m,M,compareMinY)&&node.children.sort(compareMinX)},_allDistMargin:function(node,m,M,compare){node.children.sort(compare);var i,child,toBBox=this.toBBox,leftBBox=distBBox(node,0,m,toBBox),rightBBox=distBBox(node,M-m,M,toBBox),margin=bboxMargin(leftBBox)+bboxMargin(rightBBox);for(i=m;i<M-m;i++)child=node.children[i],extend(leftBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(leftBBox);for(i=M-m-1;m<=i;i--)child=node.children[i],extend(rightBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(rightBBox);return margin},_adjustParentBBoxes:function(bbox,path,level){for(var i=level;0<=i;i--)extend(path[i],bbox)},_condense:function(path){for(var siblings,i=path.length-1;0<=i;i--)0===path[i].children.length?0<i?(siblings=path[i-1].children).splice(siblings.indexOf(path[i]),1):this.clear():calcBBox(path[i],this.toBBox)},_initFormat:function(format){var compareArr=["return a"," - b",";"];this.compareMinX=new Function("a","b",compareArr.join(format[0])),this.compareMinY=new Function("a","b",compareArr.join(format[1])),this.toBBox=new Function("a","return {minX: a"+format[0]+", minY: a"+format[1]+", maxX: a"+format[2]+", maxY: a"+format[3]+"};")}}},{quickselect:257}]},{},[1]);
